{"version":3,"file":"notification.js","sources":["notification.js"],"sourcesContent":["\"use strict\";\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nrequire(\"./index.less\");\r\nvar react_1 = __importDefault(require(\"react\"));\r\nvar react_dom_1 = __importDefault(require(\"react-dom\"));\r\nvar uuid_1 = require(\"uuid\");\r\nvar selectorPrefix = 'adhere-ui-notification';\r\n/**\r\n * Notification\r\n * @class Notification\r\n * @classdesc Notification\r\n */\r\nvar Notification = /** @class */ (function () {\r\n    function Notification(container, config) {\r\n        this.config = {\r\n            style: 'material',\r\n            type: 'top',\r\n        };\r\n        // 存放所有的notification\r\n        this.notifications = {};\r\n        this.key = false;\r\n        this.container = container;\r\n        this.config = Object.assign(this.config, config);\r\n        this.createInnerContainer();\r\n        this.init();\r\n        this.initEvents();\r\n    }\r\n    /**\r\n     * createInnerContainer\r\n     * @private\r\n     */\r\n    Notification.prototype.createInnerContainer = function () {\r\n        var innerContainer = this.container.querySelector(\".\" + selectorPrefix);\r\n        if (innerContainer) {\r\n            // @ts-ignore\r\n            innerContainer.parentElement.removeChild(innerContainer);\r\n        }\r\n        this.innerContainer = document.createElement('div');\r\n        this.innerContainer.className = selectorPrefix;\r\n        this.notificationContainer = document.createElement('ul');\r\n        this.innerContainer.appendChild(this.notificationContainer);\r\n        this.container.appendChild(this.innerContainer);\r\n    };\r\n    /**\r\n     * init\r\n     * @private\r\n     */\r\n    Notification.prototype.init = function () {\r\n        var config = this.config;\r\n        // @ts-ignore\r\n        this.innerContainer.classList.remove(\r\n        // @ts-ignore\r\n        [selectorPrefix].concat([config.type === 'top' ? 'bottom' : 'top', config.style]).join('-'));\r\n        // @ts-ignore\r\n        this.innerContainer.classList.add(\r\n        // @ts-ignore\r\n        [selectorPrefix].concat([config.type, config.style]).join('-'));\r\n    };\r\n    /**\r\n     * initEvents\r\n     * @private\r\n     */\r\n    Notification.prototype.initEvents = function () {\r\n        var self = this;\r\n        // @ts-ignore\r\n        this.notificationContainer.addEventListener('click', function (e) {\r\n            // @ts-ignore\r\n            if (e.target.classList.contains('closeBtn')) {\r\n                // @ts-ignore\r\n                self.closeNotification.call(self, e.target.parentNode.dataset.id);\r\n            }\r\n        });\r\n    };\r\n    /**\r\n     * closeNotification - 点击删除通知\r\n     * closeNotification\r\n     * @param {string} id\r\n     * @access private\r\n     */\r\n    Notification.prototype.closeNotification = function (id) {\r\n        var self = this;\r\n        if (self.key)\r\n            return;\r\n        self.key = true;\r\n        var n = self.notifications[id];\r\n        function transitionendAction() {\r\n            n.removeEventListener('transitionend', transitionendAction);\r\n            // @ts-ignore\r\n            self.notificationContainer.removeChild(n);\r\n            self.key = false;\r\n            // closeAfter\r\n            self.trigger('onCloseAfter', n);\r\n        }\r\n        // closeBefore\r\n        self.trigger('onCloseBefore', n);\r\n        n.addEventListener('transitionend', transitionendAction);\r\n        n.style.overflow = 'hidden';\r\n        n.querySelector('.info').style.opacity = '0';\r\n        n.style.height = '0';\r\n    };\r\n    /**\r\n     * buildCustom\r\n     * @param config\r\n     * @return string\r\n     * @private\r\n     */\r\n    Notification.prototype.buildCustom = function (config) {\r\n        var closed = config.closed, children = config.children;\r\n        // console.log('IShowConfig', config);\r\n        var id = uuid_1.v1();\r\n        var n = document.createElement('li');\r\n        n.dataset.id = id;\r\n        var Component = function () { return (react_1.default.createElement(react_1.default.Fragment, null,\r\n            react_1.default.createElement(\"div\", { className: \"info\" }, children),\r\n            closed ? react_1.default.createElement(\"span\", { className: \"closeBtn\" }) : null)); };\r\n        // @ts-ignore\r\n        react_dom_1.default.render(react_1.default.createElement(Component, null), n);\r\n        return this.build(id, n);\r\n    };\r\n    /**\r\n     * buildStandard\r\n     * @param config\r\n     * @return string\r\n     * @private\r\n     */\r\n    Notification.prototype.buildStandard = function (config) {\r\n        var _a = config.headerLabel, headerLabel = _a === void 0 ? '' : _a, _b = config.headerIcon, headerIcon = _b === void 0 ? '' : _b, _c = config.title, title = _c === void 0 ? '' : _c, _d = config.text, text = _d === void 0 ? '' : _d, _e = config.icon, icon = _e === void 0 ? '' : _e, _f = config.closed, closed = _f === void 0 ? true : _f, _g = config.datetime, datetime = _g === void 0 ? '' : _g;\r\n        // console.log('IShowStandardConfig', config);\r\n        var id = uuid_1.v1();\r\n        var n = document.createElement('li');\r\n        n.dataset.id = id;\r\n        var Component = function () { return (react_1.default.createElement(react_1.default.Fragment, null,\r\n            react_1.default.createElement(\"div\", { className: \"info\" },\r\n                react_1.default.createElement(\"div\", { className: selectorPrefix + \"-standard-header\" },\r\n                    react_1.default.createElement(\"div\", { className: selectorPrefix + \"-standard-header-icon\" }, headerIcon ? react_1.default.createElement(\"img\", { src: headerIcon, alt: \"\" }) : null),\r\n                    react_1.default.createElement(\"div\", { className: selectorPrefix + \"-standard-header-label\" }, headerLabel || '')),\r\n                react_1.default.createElement(\"div\", { className: selectorPrefix + \"-standard-content\" },\r\n                    react_1.default.createElement(\"div\", { className: selectorPrefix + \"-standard-content-media-l\" }, icon ? react_1.default.createElement(\"img\", { src: icon, alt: \"\" }) : null),\r\n                    react_1.default.createElement(\"div\", { className: selectorPrefix + \"-standard-content-row\" },\r\n                        react_1.default.createElement(\"div\", { className: selectorPrefix + \"-standard-content-row-title\" }, title || ''),\r\n                        react_1.default.createElement(\"div\", { className: selectorPrefix + \"-standard-content-row-text\" }, text || '')),\r\n                    react_1.default.createElement(\"div\", { className: selectorPrefix + \"-standard-content-media-r\" }, datetime || ''))),\r\n            closed ? react_1.default.createElement(\"span\", { className: \"closeBtn\" }) : null)); };\r\n        // @ts-ignore\r\n        react_dom_1.default.render(react_1.default.createElement(Component, null), n);\r\n        return this.build(id, n);\r\n    };\r\n    /**\r\n     * build\r\n     * @param id\r\n     * @param n\r\n     * @return string\r\n     * @private\r\n     */\r\n    Notification.prototype.build = function (id, n) {\r\n        var self = this;\r\n        this.notifications[id] = n;\r\n        // @ts-ignore\r\n        this.notificationContainer.appendChild(n);\r\n        // onCreate\r\n        self.trigger('onCreate', n);\r\n        n.style.height = 'auto';\r\n        var targetHeight = n.clientHeight;\r\n        // 会有最小高度的限制\r\n        if (self.config.style === 'material') {\r\n            if (targetHeight < 40) {\r\n                targetHeight = 40;\r\n            }\r\n        }\r\n        else if (self.config.style === 'ios') {\r\n            if (targetHeight < 70) {\r\n                targetHeight = 70;\r\n            }\r\n        }\r\n        n.style.height = '0';\r\n        setTimeout(function () {\r\n            n.style.height = targetHeight + \"px\";\r\n            n.querySelector('.info').style.opacity = '1';\r\n            self.trigger('onShow', n);\r\n        }, 100);\r\n        return id;\r\n    };\r\n    /**\r\n     * trigger\r\n     * @param action\r\n     * @param params\r\n     * @private\r\n     */\r\n    Notification.prototype.trigger = function (action, params) {\r\n        if (this.config[action]) {\r\n            this.config[action](params);\r\n        }\r\n    };\r\n    /**\r\n     * show\r\n     * @param {Object} config\r\n     * @return {string} id\r\n     */\r\n    Notification.prototype.show = function (config) {\r\n        return this.buildCustom(config);\r\n    };\r\n    /**\r\n     * showStandard\r\n     * @param {Object} config\r\n     * @return {string} id\r\n     */\r\n    Notification.prototype.showStandard = function (config) {\r\n        return this.buildStandard(config);\r\n    };\r\n    /**\r\n     * close\r\n     * @param {string} id\r\n     */\r\n    Notification.prototype.close = function (id) {\r\n        this.closeNotification(id);\r\n    };\r\n    return Notification;\r\n}());\r\n/**\r\n * NotificationFactory\r\n */\r\nexports.default = {\r\n    /**\r\n     * build\r\n     * @param container\r\n     * @param config\r\n     * @return Notification\r\n     */\r\n    build: function (container, config) {\r\n        return new Notification(container, config);\r\n    },\r\n};\r\n"],"names":["__importDefault","this","mod","__esModule","default","Object","defineProperty","exports","value","require","react_1","react_dom_1","uuid_1","selectorPrefix","Notification","container","config","style","type","notifications","key","assign","createInnerContainer","init","initEvents","prototype","innerContainer","querySelector","parentElement","removeChild","document","createElement","className","notificationContainer","appendChild","classList","remove","concat","join","add","self","addEventListener","e","target","contains","closeNotification","call","parentNode","dataset","id","n","trigger","transitionendAction","removeEventListener","overflow","opacity","height","buildCustom","closed","children","v1","render","Fragment","build","buildStandard","_a","headerLabel","_b","headerIcon","_c","title","_d","text","_e","icon","_f","_g","datetime","src","alt","targetHeight","clientHeight","setTimeout","action","params","show","showStandard","close"],"mappings":"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"}