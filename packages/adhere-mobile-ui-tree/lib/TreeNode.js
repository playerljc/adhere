"use strict";var __assign=function(){return(__assign=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},__createBinding=Object.create?function(e,t,n,r){void 0===r&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&("get"in a?t.__esModule:!a.writable&&!a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){e[r=void 0===r?n:r]=t[n]},__setModuleDefault=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t},__importStar=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&__createBinding(t,e,n);return __setModuleDefault(t,e),t},__spreadArray=function(e,t,n){if(n||2===arguments.length)for(var r,a=0,c=t.length;a<c;a++)!r&&a in t||((r=r||Array.prototype.slice.call(t,0,a))[a]=t[a]);return e.concat(r||Array.prototype.slice.call(t))},__importDefault=function(e){return e&&e.__esModule?e:{default:e}},ahooks_1=(Object.defineProperty(exports,"__esModule",{value:!0}),require("ahooks")),antd_mobile_1=require("antd-mobile"),antd_mobile_icons_1=require("antd-mobile-icons"),classnames_1=__importDefault(require("classnames")),react_1=__importStar(require("react")),icons_1=require("@ant-design/icons"),adhere_ui_configprovider_1=__importDefault(require("@baifendian/adhere-ui-configprovider")),adhere_ui_space_1=__importDefault(require("@baifendian/adhere-ui-space")),adhere_util_1=__importDefault(require("@baifendian/adhere-util")),Constant_1=require("./Constant"),TreeContext_1=__importDefault(require("./TreeContext")),TreeNodeContext_1=__importDefault(require("./TreeNodeContext")),useChecked_1=__importDefault(require("./useChecked")),useLoadedLocks_1=__importDefault(require("./useLoadedLocks")),useUtil_1=__importDefault(require("./useUtil")),selectorPrefix="adhere-mobile-ui-tree-node",TreeNode=(0,react_1.memo)(function(e){var a=e.id,t=e.level,n=e.isLeaf,U=e.title,r=e.checkable,c=e.disabled,l=e.selectable,o=e.props,i=e.checkboxWidth,u=e.checkboxGap,d=e.titleGap,G=e.iconGap,j=e.indent,s=e.children,e=(0,react_1.useContext)(TreeContext_1.default),_=e.setSelectedKeys,w=e.setExpandedKeys,S=e.setCheckedKeys,F=e.setLoadedKeys,f=e.selectedKeys,p=e.expandedKeys,m=e.checkedKeys,B=e.loadedKeys,h=e.loadData,k=e.size,R=e.multiple,z=e.checkable,W=e.checkStrictly,y=e.treeData,H=e.icon,V=e.checkboxWidth,J=e.checkboxGap,Q=e.titleGap,X=e.iconGap,Y=e.indent,Z=e.rowGap,$=e.titleRender,v=e.switcherIcon,x=e.onSelect,b=e.onExpand,E=e.onCheck,ee=(0,ahooks_1.useUpdate)(),e=(0,useLoadedLocks_1.default)(),te=e.lock,ne=e.unLock,C=e.isLock,N=(0,react_1.useContext)(adhere_ui_configprovider_1.default.Context).media,D=(0,react_1.useMemo)(function(){return{key:a,level:t,disabled:c,selectable:l,checkable:r,isLeaf:!(null!=s&&s.length),props:o}},[a,t,c,l,r,o,s]),e=(0,react_1.useMemo)(function(){return null==H?void 0:H(D)},[D]),g=(0,react_1.useContext)(TreeNodeContext_1.default),re=g.updateParentChecked,g=g.existsCheckableNodeInParentChildren,P=(0,useChecked_1.default)(),ae=P.handleCheck,ce=P.updateParentChecked,le=P.existsCheckableNodeInParentChildren,P=(0,useUtil_1.default)(),T=P.getTreeNodesByKeys,oe=P.getLeafKeys,L=(P.checkTreeDataSimpleModeFromObject,P.getValueWithUnit),M=(0,react_1.useMemo)(function(){return adhere_util_1.default.isEmpty(c)?Constant_1.DEFAULT_DISABLED:c},[c]),ie=(0,react_1.useMemo)(function(){return adhere_util_1.default.isEmpty(l)?Constant_1.DEFAULT_SELECTABLE:l},[l]),P=(0,react_1.useMemo)(function(){return adhere_util_1.default.isEmpty(r)?Constant_1.DEFAULT_TREE_NODE_CHECKABLE:r},[r]),A=(0,react_1.useMemo)(function(){return null!=s?s:[]},[s]),ue=(0,react_1.useMemo)(function(){return void 0===n?!!A.length:!n},[A]),O=(0,react_1.useMemo)(function(){var e;return null!=(e=L(i,N))?e:V()},[i,V(),N]),de=(0,react_1.useMemo)(function(){var e;return null!=(e=L(u,N))?e:J()},[u,J(),N]),se=(0,react_1.useMemo)(function(){var e;return null!=(e=L(d,N))?e:Q()},[d,Q(),N]),_e=(0,react_1.useMemo)(function(){var e;return null!=(e=L(G,N))?e:X()},[G,X(),N]),fe=(0,react_1.useMemo)(function(){var e;return null!=(e=L(j,N))?e:Y()},[j,Y(),N]),pe=(0,react_1.useMemo)(function(){return Z()},[Z()]),me=(0,react_1.useMemo)(function(){return A.map(function(e){return react_1.default.createElement(TreeNodeContext_1.default.Provider,{value:{updateParentChecked:function(e){var t=e.key,n=e.checked,e=e.checkedKeys;ce({key:t,checked:n,checkedKeys:e,childrenData:A,parentId:a,next:re})},existsCheckableNodeInParentChildren:function(){return le(A)}}},react_1.default.createElement(TreeNode,__assign({level:t+1,id:e[Constant_1.DEFAULT_TREE_UTIL_CONFIG.keyAttr]},e)))})},[A]),he=(0,react_1.useMemo)(function(){return m().includes(a)},[m(),a]),q=p().includes(a),K=f().includes(a);function I(n){function t(e){var t;return{expanded:!q,expandedNodes:T({treeData:null!=(t=y())?t:[],keys:e}),node:D,event:n}}w(q?function(e){e=(null!=e?e:[]).filter(function(e){return e!==a});return null!=b&&b(e,t(e)),e}:function(e){e=__spreadArray(__spreadArray([],null!=e?e:[],!0),[a],!1);return null!=b&&b(e,t(e)),e})}return react_1.default.createElement("li",{key:a,className:(0,classnames_1.default)(selectorPrefix,"".concat(selectorPrefix,"-").concat(k()),((p={})["".concat(selectorPrefix,"-disabled")]=M,p))},react_1.default.createElement(adhere_ui_space_1.default.Group,{direction:"vertical",size:pe},react_1.default.createElement("div",{className:"".concat(selectorPrefix,"-info")},z()&&P&&react_1.default.createElement("span",{className:(0,classnames_1.default)("".concat(selectorPrefix,"-info-checkbox")),style:{width:O,marginInlineEnd:de}},react_1.default.createElement(antd_mobile_1.Checkbox,{value:a,checked:he,disabled:M,onChange:function(e){var t,n=m(),r=(ae({node:((r={})[Constant_1.DEFAULT_TREE_UTIL_CONFIG.keyAttr]=a,r.children=s,r),checked:e,checkedKeys:n,checkStrictly:W(),next:re}),S(__spreadArray([],n,!0)),__spreadArray([],n,!0));E&&W()&&(r=oe({treeData:null!=(t=y())?t:[],keys:n})),null!=E&&E(r,{checked:e,checkedNodes:T({treeData:null!=(t=y())?t:[],keys:r}),node:D})}})),z()&&!P&&g()&&react_1.default.createElement("span",{className:(0,classnames_1.default)("".concat(selectorPrefix,"-info-checkbox"))}),ue&&react_1.default.createElement("span",{className:"".concat(selectorPrefix,"-info-expanded"),onClick:function(e){var t,n;!q&&h?(t=e,C(a)||(B().includes(a)?I(t):(te(a),ee(),null!=(n=null==h?void 0:h(D))&&n.then(function(){I(t),ne(a),F(function(e){return __spreadArray(__spreadArray([],e,!0),[a],!1)})}).catch(function(e){throw m().includes(a)&&F(function(e){return e.filter(function(e){return e!==a})}),ne(a),ee(),new Error(e)})))):I(e)}},C(a)&&react_1.default.createElement(icons_1.LoadingOutlined,{className:"".concat(selectorPrefix,"-info-load")}),!C(a)&&q&&(null!=(f=null==v?void 0:v(q,D))?f:react_1.default.createElement(antd_mobile_icons_1.MinusOutline,null)),!C(a)&&!q&&(null!=(k=null==v?void 0:v(q,D))?k:react_1.default.createElement(antd_mobile_icons_1.AddOutline,null))),react_1.default.createElement("span",{className:(0,classnames_1.default)("".concat(selectorPrefix,"-info-title-wrapper"),((p={})["".concat(selectorPrefix,"-info-title-selected")]=ie&&K,p)),style:{padding:se},onClick:function(n){if(ie&&!M)return R()?K?void _(function(e){e=(null!=e?e:[]).filter(function(e){return e!==a});return null!=x&&x(e,t(e)),e}):void _(function(e){e=__spreadArray(__spreadArray([],null!=e?e:[],!0),[a],!1);return null!=x&&x(e,t(e)),e}):void(K?(_([]),null!=x&&x([],t([]))):(_([a]),null!=x&&x([a],t([a]))));function t(e){var t;return{selected:!K,selectedNodes:T({treeData:null!=(t=y())?t:[],keys:e}),node:D,event:n}}}},!!e&&react_1.default.createElement("span",{className:"".concat(selectorPrefix,"-info-icon"),style:{marginInlineEnd:_e}},e),react_1.default.createElement("span",{className:"".concat(selectorPrefix,"-info-title")},null!=(O=null==$?void 0:$(D))?O:U))),ue&&q&&react_1.default.createElement("ul",{className:"".concat(selectorPrefix,"-children"),style:{paddingInlineStart:fe}},react_1.default.createElement(adhere_ui_space_1.default.Group,{direction:"vertical",size:pe},me))))});TreeNode.displayName="TreeNode",exports.default=TreeNode;
//# sourceMappingURL=TreeNode.js.map
