"use strict";var __assign=function(){return(__assign=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},__createBinding=Object.create?function(e,t,n,r){void 0===r&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&("get"in a?t.__esModule:!a.writable&&!a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){e[r=void 0===r?n:r]=t[n]},__setModuleDefault=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t},__importStar=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&__createBinding(t,e,n);return __setModuleDefault(t,e),t},__spreadArray=function(e,t,n){if(n||2===arguments.length)for(var r,a=0,l=t.length;a<l;a++)!r&&a in t||((r=r||Array.prototype.slice.call(t,0,a))[a]=t[a]);return e.concat(r||Array.prototype.slice.call(t))},__importDefault=function(e){return e&&e.__esModule?e:{default:e}},ahooks_1=(Object.defineProperty(exports,"__esModule",{value:!0}),require("ahooks")),antd_mobile_1=require("antd-mobile"),antd_mobile_icons_1=require("antd-mobile-icons"),classnames_1=__importDefault(require("classnames")),react_1=__importStar(require("react")),icons_1=require("@ant-design/icons"),adhere_ui_configprovider_1=__importDefault(require("@baifendian/adhere-ui-configprovider")),adhere_ui_space_1=__importDefault(require("@baifendian/adhere-ui-space")),adhere_util_1=__importDefault(require("@baifendian/adhere-util")),Constant_1=require("./Constant"),TreeContext_1=__importDefault(require("./TreeContext")),TreeNodeContext_1=__importDefault(require("./TreeNodeContext")),useChecked_1=__importDefault(require("./useChecked")),useLoadedLocks_1=__importDefault(require("./useLoadedLocks")),useUtil_1=__importDefault(require("./useUtil")),selectorPrefix="adhere-mobile-ui-tree-node",TreeNode=(0,react_1.memo)(function(e){var a=e.id,t=e.level,n=e.isLeaf,K=e.title,r=e.checkable,l=e.disabled,c=e.selectable,i=e.props,o=e.checkboxWidth,u=e.checkboxGap,S=e.titleGap,F=e.iconGap,G=e.indent,d=e.children,e=(0,react_1.useContext)(TreeContext_1.default),s=e.setSelectedKeys,j=e.setExpandedKeys,w=e.setCheckedKeys,B=e.setLoadedKeys,R=e.setTreeData,_=e.selectedKeys,f=e.expandedKeys,p=e.checkedKeys,z=e.loadedKeys,m=e.teeDataSimpleMode,h=e.loadData,y=e.size,W=e.multiple,J=e.checkable,H=e.checkStrictly,k=e.treeData,V=e.icon,Q=e.checkboxWidth,X=e.checkboxGap,Y=e.titleGap,Z=e.iconGap,$=e.indent,ee=e.rowGap,te=e.titleRender,E=e.switcherIcon,C=e.onSelect,v=e.onExpand,b=e.onCheck,ne=(0,ahooks_1.useUpdate)(),e=(0,useLoadedLocks_1.default)(),re=e.lock,ae=e.unLock,x=e.isLock,T=(0,react_1.useContext)(adhere_ui_configprovider_1.default.Context).media,N=(0,react_1.useMemo)(function(){return{key:a,level:t,disabled:l,selectable:c,checkable:r,isLeaf:!(null!=d&&d.length),props:i}},[a,t,l,c,r,i,d]),e=(0,react_1.useMemo)(function(){return null==V?void 0:V(N)},[N]),D=(0,react_1.useContext)(TreeNodeContext_1.default),le=D.updateParentChecked,D=D.existsCheckableNodeInParentChildren,A=(0,useChecked_1.default)(),ce=A.handleCheck,ie=A.updateParentChecked,oe=A.existsCheckableNodeInParentChildren,A=(0,useUtil_1.default)(),L=A.getTreeNodesByKeys,ue=A.getLeafKeys,de=A.checkTreeDataSimpleModeFromObject,g=A.getValueWithUnit,P=(0,react_1.useMemo)(function(){return adhere_util_1.default.isEmpty(l)?Constant_1.DEFAULT_DISABLED:l},[l]),se=(0,react_1.useMemo)(function(){return adhere_util_1.default.isEmpty(c)?Constant_1.DEFAULT_SELECTABLE:c},[c]),A=(0,react_1.useMemo)(function(){return adhere_util_1.default.isEmpty(r)?Constant_1.DEFAULT_TREE_NODE_CHECKABLE:r},[r]),O=(0,react_1.useMemo)(function(){return null!=d?d:[]},[d]),_e=(0,react_1.useMemo)(function(){return void 0===n?!!O.length:!n},[O]),M=(0,react_1.useMemo)(function(){var e;return null!=(e=g(o,T))?e:Q()},[o,Q(),T]),fe=(0,react_1.useMemo)(function(){var e;return null!=(e=g(u,T))?e:X()},[u,X(),T]),pe=(0,react_1.useMemo)(function(){var e;return null!=(e=g(S,T))?e:Y()},[S,Y(),T]),me=(0,react_1.useMemo)(function(){var e;return null!=(e=g(F,T))?e:Z()},[F,Z(),T]),he=(0,react_1.useMemo)(function(){var e;return null!=(e=g(G,T))?e:$()},[G,$(),T]),ye=(0,react_1.useMemo)(function(){return ee()},[ee()]),ke=(0,react_1.useMemo)(function(){return O.map(function(e){return react_1.default.createElement(TreeNodeContext_1.default.Provider,{value:{updateParentChecked:function(e){var t=e.key,n=e.checked,e=e.checkedKeys;ie({key:t,checked:n,checkedKeys:e,childrenData:O,parentId:a,next:le})},existsCheckableNodeInParentChildren:function(){return oe(O)}}},react_1.default.createElement(TreeNode,__assign({level:t+1,id:e[Constant_1.DEFAULT_TREE_UTIL_CONFIG.keyAttr]},e)))})},[O]),Ee=(0,react_1.useMemo)(function(){return p().includes(a)},[p(),a]),I=f().includes(a),U=_().includes(a);function q(n){function t(e){var t;return{expanded:!I,expandedNodes:L({treeData:null!=(t=k())?t:[],keys:e}),node:N,event:n}}j(I?function(e){e=(null!=e?e:[]).filter(function(e){return e!==a});return null!=v&&v(e,t(e)),e}:function(e){e=__spreadArray(__spreadArray([],null!=e?e:[],!0),[a],!1);return null!=v&&v(e,t(e)),e})}return react_1.default.createElement("li",{key:a,className:(0,classnames_1.default)(selectorPrefix,"".concat(selectorPrefix,"-").concat(y()),((f={})["".concat(selectorPrefix,"-disabled")]=P,f))},react_1.default.createElement(adhere_ui_space_1.default.Group,{direction:"vertical",size:ye},react_1.default.createElement("div",{className:"".concat(selectorPrefix,"-info")},J()&&A&&react_1.default.createElement("span",{className:(0,classnames_1.default)("".concat(selectorPrefix,"-info-checkbox")),style:{width:M,marginInlineEnd:fe}},react_1.default.createElement(antd_mobile_1.Checkbox,{value:a,checked:Ee,disabled:P,onChange:function(e){var t,n=p(),r=(ce({node:((r={})[Constant_1.DEFAULT_TREE_UTIL_CONFIG.keyAttr]=a,r.children=d,r),checked:e,checkedKeys:n,checkStrictly:H(),next:le}),w(__spreadArray([],n,!0)),__spreadArray([],n,!0));b&&H()&&(r=ue({treeData:null!=(t=k())?t:[],keys:n})),null!=b&&b(r,{checked:e,checkedNodes:L({treeData:null!=(t=k())?t:[],keys:r}),node:N})}})),J()&&!A&&D()&&react_1.default.createElement("span",{className:(0,classnames_1.default)("".concat(selectorPrefix,"-info-checkbox"))}),_e&&react_1.default.createElement("span",{className:"".concat(selectorPrefix,"-info-expanded"),onClick:function(e){var t,n;!I&&h?(t=e,x(a)||(z().includes(a)?q(t):(re(a),ne(),null!=(n=null==h?void 0:h(N))&&n.then(function(r){R(function(e){var t=r,n=!(null==m||!m()),n=(n&&(adhere_util_1.default.isBoolean(n)?n&&(t=adhere_util_1.default.arrayToAntdTreeSelect(t,Constant_1.DEFAULT_TREE_UTIL_CONFIG)):adhere_util_1.default.isObject(n)&&de(n)&&(t=adhere_util_1.default.arrayToAntdTreeSelect(t,null==m?void 0:m()))),adhere_util_1.default.findNodeByKey(e,N[Constant_1.DEFAULT_TREE_UTIL_CONFIG.keyAttr],{keyAttr:Constant_1.DEFAULT_TREE_UTIL_CONFIG.keyAttr}));return n&&(n.children=null!=t?t:[]),JSON.parse(JSON.stringify(e))}),q(t),ae(a),B(function(e){return __spreadArray(__spreadArray([],e,!0),[a],!1)})}).catch(function(e){throw p().includes(a)&&B(function(e){return e.filter(function(e){return e!==a})}),ae(a),ne(),new Error(e)})))):q(e)}},x(a)&&react_1.default.createElement(icons_1.LoadingOutlined,{className:"".concat(selectorPrefix,"-info-load")}),!x(a)&&I&&(null!=(_=null==E?void 0:E(I,N))?_:react_1.default.createElement(antd_mobile_icons_1.MinusOutline,null)),!x(a)&&!I&&(null!=(y=null==E?void 0:E(I,N))?y:react_1.default.createElement(antd_mobile_icons_1.AddOutline,null))),react_1.default.createElement("span",{className:(0,classnames_1.default)("".concat(selectorPrefix,"-info-title-wrapper"),((f={})["".concat(selectorPrefix,"-info-title-selected")]=se&&U,f)),style:{padding:pe},onClick:function(n){if(se&&!P)return W()?U?void s(function(e){e=(null!=e?e:[]).filter(function(e){return e!==a});return null!=C&&C(e,t(e)),e}):void s(function(e){e=__spreadArray(__spreadArray([],null!=e?e:[],!0),[a],!1);return null!=C&&C(e,t(e)),e}):void(U?(s([]),null!=C&&C([],t([]))):(s([a]),null!=C&&C([a],t([a]))));function t(e){var t;return{selected:!U,selectedNodes:L({treeData:null!=(t=k())?t:[],keys:e}),node:N,event:n}}}},!!e&&react_1.default.createElement("span",{className:"".concat(selectorPrefix,"-info-icon"),style:{marginInlineEnd:me}},e),react_1.default.createElement("span",{className:"".concat(selectorPrefix,"-info-title")},null!=(M=null==te?void 0:te(N))?M:K))),_e&&I&&react_1.default.createElement("ul",{className:"".concat(selectorPrefix,"-children"),style:{paddingInlineStart:he}},react_1.default.createElement(adhere_ui_space_1.default.Group,{direction:"vertical",size:ye},ke))))});TreeNode.displayName="TreeNode",exports.default=TreeNode;
//# sourceMappingURL=TreeNode.js.map
