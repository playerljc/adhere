"use strict";var __assign=function(){return(__assign=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},__createBinding=Object.create?function(e,t,n,r){void 0===r&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&("get"in a?t.__esModule:!a.writable&&!a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){e[r=void 0===r?n:r]=t[n]},__setModuleDefault=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t},__importStar=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&__createBinding(t,e,n);return __setModuleDefault(t,e),t},__spreadArray=function(e,t,n){if(n||2===arguments.length)for(var r,a=0,c=t.length;a<c;a++)!r&&a in t||((r=r||Array.prototype.slice.call(t,0,a))[a]=t[a]);return e.concat(r||Array.prototype.slice.call(t))},__importDefault=function(e){return e&&e.__esModule?e:{default:e}},ahooks_1=(Object.defineProperty(exports,"__esModule",{value:!0}),require("ahooks")),antd_mobile_1=require("antd-mobile"),antd_mobile_icons_1=require("antd-mobile-icons"),classnames_1=__importDefault(require("classnames")),react_1=__importStar(require("react")),icons_1=require("@ant-design/icons"),adhere_ui_configprovider_1=__importDefault(require("@baifendian/adhere-ui-configprovider")),adhere_ui_space_1=__importDefault(require("@baifendian/adhere-ui-space")),adhere_util_1=__importDefault(require("@baifendian/adhere-util")),Constant_1=require("./Constant"),TreeContext_1=__importDefault(require("./TreeContext")),TreeNodeContext_1=__importDefault(require("./TreeNodeContext")),useChecked_1=__importDefault(require("./useChecked")),useLoadedLocks_1=__importDefault(require("./useLoadedLocks")),useUtil_1=__importDefault(require("./useUtil")),selectorPrefix="adhere-mobile-ui-tree-node",TreeNode=(0,react_1.memo)(function(e){var a=e.id,t=e.level,n=e.isLeaf,j=e.title,r=e.checkable,c=e.disabled,l=e.selectable,i=e.props,o=e.checkboxWidth,u=e.checkboxGap,d=e.titleGap,G=e.iconGap,I=e.indent,s=e.children,e=(0,react_1.useContext)(TreeContext_1.default),_=e.setSelectedKeys,S=e.setExpandedKeys,U=e.setCheckedKeys,B=e.setLoadedKeys,f=e.selectedKeys,p=e.expandedKeys,m=e.checkedKeys,z=e.loadedKeys,h=e.loadData,y=e.size,F=e.multiple,W=e.checkable,R=e.checkStrictly,k=e.treeData,H=e.icon,V=e.checkboxWidth,J=e.checkboxGap,Q=e.titleGap,X=e.iconGap,Y=e.indent,Z=e.rowGap,$=e.titleRender,v=e.switcherIcon,x=e.onSelect,b=e.onExpand,C=e.onCheck,ee=(0,ahooks_1.useUpdate)(),e=(0,useLoadedLocks_1.default)(),te=e.lock,ne=e.unLock,E=e.isLock,g=(0,react_1.useContext)(adhere_ui_configprovider_1.default.Context).media,N=(0,react_1.useMemo)(function(){return{key:a,level:t,disabled:c,selectable:l,checkable:r,isLeaf:!(null!=s&&s.length),props:i}},[a,t,c,l,r,i,s]),e=(0,react_1.useMemo)(function(){return null==H?void 0:H(N)},[N]),P=(0,react_1.useContext)(TreeNodeContext_1.default),re=P.updateParentChecked,P=P.existsCheckableNodeInParentChildren,D=(0,useChecked_1.default)(),ae=D.handleCheck,ce=D.updateParentChecked,le=D.existsCheckableNodeInParentChildren,D=(0,useUtil_1.default)(),M=D.getTreeNodesByKeys,ie=D.getLeafKeys,L=D.getValueWithUnit,A=(0,react_1.useMemo)(function(){return adhere_util_1.default.isEmpty(c)?Constant_1.DEFAULT_DISABLED:c},[c]),oe=(0,react_1.useMemo)(function(){return adhere_util_1.default.isEmpty(l)?Constant_1.DEFAULT_SELECTABLE:l},[l]),D=(0,react_1.useMemo)(function(){return adhere_util_1.default.isEmpty(r)?Constant_1.DEFAULT_TREE_NODE_CHECKABLE:r},[r]),T=(0,react_1.useMemo)(function(){return null!=s?s:[]},[s]),ue=(0,react_1.useMemo)(function(){return void 0===n?!!T.length:!n},[T]),O=(0,react_1.useMemo)(function(){var e;return null!=(e=L(o,g))?e:V()},[o,V(),g]),de=(0,react_1.useMemo)(function(){var e;return null!=(e=L(u,g))?e:J()},[u,J(),g]),se=(0,react_1.useMemo)(function(){var e;return null!=(e=L(d,g))?e:Q()},[d,Q(),g]),_e=(0,react_1.useMemo)(function(){var e;return null!=(e=L(G,g))?e:X()},[G,X(),g]),fe=(0,react_1.useMemo)(function(){var e;return null!=(e=L(I,g))?e:Y()},[I,Y(),g]),pe=(0,react_1.useMemo)(function(){return Z()},[Z()]),me=(0,react_1.useMemo)(function(){return T.map(function(e){return react_1.default.createElement(TreeNodeContext_1.default.Provider,{value:{updateParentChecked:function(e){var t=e.key,n=e.checked,e=e.checkedKeys;ce({key:t,checked:n,checkedKeys:e,childrenData:T,parentId:a,next:re})},existsCheckableNodeInParentChildren:function(){return le(T)}}},react_1.default.createElement(TreeNode,__assign({level:t+1,id:e.key},e)))})},[T]),he=(0,react_1.useMemo)(function(){return m().includes(a)},[m(),a]),q=p().includes(a),K=f().includes(a);function w(n){function t(e){var t;return{expanded:!q,expandedNodes:M({treeData:null!=(t=k())?t:[],keys:e}),node:N,event:n}}S(q?function(e){e=(null!=e?e:[]).filter(function(e){return e!==a});return null!=b&&b(e,t(e)),e}:function(e){e=__spreadArray(__spreadArray([],null!=e?e:[],!0),[a],!1);return null!=b&&b(e,t(e)),e})}return react_1.default.createElement("li",{key:a,className:(0,classnames_1.default)(selectorPrefix,"".concat(selectorPrefix,"-").concat(y()),((p={})["".concat(selectorPrefix,"-disabled")]=A,p))},react_1.default.createElement(adhere_ui_space_1.default.Group,{direction:"vertical",size:pe},react_1.default.createElement("div",{className:"".concat(selectorPrefix,"-info")},W()&&D&&react_1.default.createElement("span",{className:(0,classnames_1.default)("".concat(selectorPrefix,"-info-checkbox")),style:{width:O,marginInlineEnd:de}},react_1.default.createElement(antd_mobile_1.Checkbox,{value:a,checked:he,disabled:A,onChange:function(e){var t,n=m(),r=(ae({node:{key:a,children:s},checked:e,checkedKeys:n,checkStrictly:R(),next:re}),U(__spreadArray([],n,!0)),__spreadArray([],n,!0));C&&R()&&(r=ie({treeData:null!=(t=k())?t:[],keys:n})),null!=C&&C(r,{checked:e,checkedNodes:M({treeData:null!=(t=k())?t:[],keys:r}),node:N})}})),W()&&!D&&P()&&react_1.default.createElement("span",{className:(0,classnames_1.default)("".concat(selectorPrefix,"-info-checkbox"))}),ue&&react_1.default.createElement("span",{className:"".concat(selectorPrefix,"-info-expanded"),onClick:function(e){var t,n;!q&&h?(t=e,E(a)||(z().includes(a)?w(t):(te(a),ee(),null!=(n=null==h?void 0:h(N))&&n.then(function(){w(t),ne(a),B(function(e){return __spreadArray(__spreadArray([],e,!0),[a],!1)})}).catch(function(e){throw m().includes(a)&&B(function(e){return e.filter(function(e){return e!==a})}),ne(a),ee(),new Error(e)})))):w(e)}},E(a)&&react_1.default.createElement(icons_1.LoadingOutlined,{className:"".concat(selectorPrefix,"-info-load")}),!E(a)&&q&&(null!=(f=null==v?void 0:v(q,N))?f:react_1.default.createElement(antd_mobile_icons_1.MinusOutline,null)),!E(a)&&!q&&(null!=(y=null==v?void 0:v(q,N))?y:react_1.default.createElement(antd_mobile_icons_1.AddOutline,null))),react_1.default.createElement("span",{className:(0,classnames_1.default)("".concat(selectorPrefix,"-info-title-wrapper"),((p={})["".concat(selectorPrefix,"-info-title-selected")]=oe&&K,p)),style:{padding:se},onClick:function(n){if(oe&&!A)return F()?K?void _(function(e){e=(null!=e?e:[]).filter(function(e){return e!==a});return null!=x&&x(e,t(e)),e}):void _(function(e){e=__spreadArray(__spreadArray([],null!=e?e:[],!0),[a],!1);return null!=x&&x(e,t(e)),e}):void(K?(_([]),null!=x&&x([],t([]))):(_([a]),null!=x&&x([a],t([a]))));function t(e){var t;return{selected:!K,selectedNodes:M({treeData:null!=(t=k())?t:[],keys:e}),node:N,event:n}}}},!!e&&react_1.default.createElement("span",{className:"".concat(selectorPrefix,"-info-icon"),style:{marginInlineEnd:_e}},e),react_1.default.createElement("span",{className:"".concat(selectorPrefix,"-info-title")},null!=(O=null==$?void 0:$(N))?O:j))),ue&&q&&react_1.default.createElement("ul",{className:"".concat(selectorPrefix,"-children"),style:{paddingInlineStart:fe}},react_1.default.createElement(adhere_ui_space_1.default.Group,{direction:"vertical",size:pe},me))))});TreeNode.displayName="TreeNode",exports.default=TreeNode;
//# sourceMappingURL=TreeNode.js.map
