{"version":3,"file":"useChecked.js","sources":["useChecked.js"],"sourcesContent":["\"use strict\";\n\nvar __spreadArray = void 0 && (void 0).__spreadArray || function (to, from, pack) {\n  if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n    if (ar || !(i in from)) {\n      if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n      ar[i] = from[i];\n    }\n  }\n  return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar __importDefault = void 0 && (void 0).__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar lodash_uniq_1 = __importDefault(require(\"lodash.uniq\"));\nvar adhere_util_1 = __importDefault(require(\"@baifendian/adhere-util\"));\nvar Constant_1 = require(\"./Constant\");\n/**\n * useChecked\n */\nfunction useChecked() {\n  function targetChildren(children) {\n    var _a;\n    return (_a = children === null || children === void 0 ? void 0 : children.filter(function (node) {\n      if (!('checkable' in node)) return true;\n      return node.checkable;\n    })) === null || _a === void 0 ? void 0 : _a.filter(function (node) {\n      if (!('disabled' in node)) return true;\n      return !node.disabled;\n    });\n  }\n  /**\n   * getChildrenKeys\n   * @description 递归获取所有子节点的key\n   * @param {TreeDataItem} node 触发时候的节点数据\n   * @return {string[]}\n   */\n  function getChildrenKeys(node) {\n    var _a;\n    var keys = [node[Constant_1.DEFAULT_TREE_UTIL_CONFIG.keyAttr]];\n    var children = targetChildren((_a = node.children) !== null && _a !== void 0 ? _a : []);\n    if (children) {\n      children.forEach(function (child) {\n        keys = keys.concat(getChildrenKeys(child));\n      });\n    }\n    return keys;\n  }\n  /**\n   * getDefaultCheckedKeysWithCheckStrictly\n   * @description 获取受控状态下的defaultCheckedKeys\n   * @param {TreeData} treeData\n   * @param {string[]} defaultCheckedKeys\n   * @return {string[]}\n   */\n  function getDefaultCheckedKeysWithCheckStrictly(treeData, defaultCheckedKeys) {\n    var checkedKeys = __spreadArray([], defaultCheckedKeys, true);\n    function up(_a) {\n      var key = _a.key,\n        checkedKeys = _a.checkedKeys,\n        parentId = _a.parentId,\n        childrenData = _a.childrenData;\n      var childrenKeys = childrenData === null || childrenData === void 0 ? void 0 : childrenData.filter(function (_a) {\n        var itemKey = _a.key;\n        return itemKey !== key;\n      }).map(function (node) {\n        return node[Constant_1.DEFAULT_TREE_UTIL_CONFIG.keyAttr];\n      });\n      var selfChecked;\n      selfChecked = childrenKeys.every(function (key) {\n        return checkedKeys.includes(key);\n      });\n      if (selfChecked) {\n        if (!checkedKeys.includes(parentId)) {\n          checkedKeys.push(parentId);\n        }\n      }\n      // @ts-ignore\n      var parentNodeData = adhere_util_1.default.findParentNodeByKey(treeData, parentId, {\n        keyAttr: Constant_1.DEFAULT_TREE_UTIL_CONFIG.keyAttr\n      });\n      if (parentNodeData) {\n        up({\n          key: parentId,\n          checkedKeys: checkedKeys,\n          parentId: parentNodeData.key,\n          childrenData: targetChildren(parentNodeData.children)\n        });\n      }\n    }\n    defaultCheckedKeys.forEach(function (checkedKey) {\n      // @ts-ignore\n      var nodeData = adhere_util_1.default.findNodeByKey(treeData, checkedKey, {\n        keyAttr: Constant_1.DEFAULT_TREE_UTIL_CONFIG.keyAttr\n      });\n      if (nodeData) {\n        var descendants = getChildrenKeys(nodeData);\n        // 自己加子孙 向下所有的\n        checkedKeys.push.apply(checkedKeys, __spreadArray([checkedKey], descendants, false));\n      }\n      // @ts-ignore\n      var parentNodeData = adhere_util_1.default.findParentNodeByKey(treeData, checkedKey, {\n        keyAttr: Constant_1.DEFAULT_TREE_UTIL_CONFIG.keyAttr\n      });\n      if (parentNodeData) {\n        up({\n          key: checkedKey,\n          checkedKeys: checkedKeys,\n          parentId: parentNodeData.key,\n          childrenData: targetChildren(parentNodeData.children)\n        });\n      }\n    });\n    return (0, lodash_uniq_1.default)(checkedKeys);\n  }\n  /**\n   * updateParentChecked\n   * @description 向上处理\n   * @param {string} key 触发checked的节点key\n   * @param {boolean} checked 触发的时候选中状态\n   * @param {string[]} checkedKeys 存放所有checked的keys\n   * @param {string} parentId key的父亲key\n   * @param {TreeDataItem[]} childrenData key父亲的孩子\n   * @param {updateParentChecked} next updateParentChecked\n   */\n  function updateParentChecked(_a) {\n    // console.log('key', key);\n    // console.log('parentId', parentId);\n    // console.log('childrenData', childrenData);\n    // console.log('checked', checked);\n    var _b;\n    var key = _a.key,\n      checked = _a.checked,\n      checkedKeys = _a.checkedKeys,\n      parentId = _a.parentId,\n      childrenData = _a.childrenData,\n      next = _a.next;\n    var selfChecked = false;\n    var targetChildrenData = targetChildren(childrenData);\n    if (checked) {\n      var childrenKeys = targetChildrenData === null || targetChildrenData === void 0 ? void 0 : targetChildrenData.filter(function (_a) {\n        var itemKey = _a.key;\n        return itemKey !== key;\n      }).map(function (_a) {\n        var key = _a.key;\n        return key;\n      });\n      selfChecked = childrenKeys.every(function (key) {\n        return checkedKeys.includes(key);\n      });\n      if (selfChecked) {\n        if (!checkedKeys.includes(parentId)) {\n          checkedKeys.push(parentId);\n        }\n      }\n    } else {\n      if (checkedKeys.includes(parentId)) {\n        checkedKeys.splice(checkedKeys.findIndex(function (itemKey) {\n          return itemKey === parentId;\n        }), 1);\n      }\n    }\n    // 调用parent的updateParentChecked\n    next === null || next === void 0 ? void 0 : next((_b = {}, _b[Constant_1.DEFAULT_TREE_UTIL_CONFIG.keyAttr] = parentId, _b.checked = selfChecked, _b.checkedKeys = checkedKeys, _b));\n  }\n  /**\n   * handleCheck\n   * @description 处理选中逻辑\n   * @param {TreeDataItem} node 触发的节点nodeData\n   * @param {boolean} checked 触发的时候选中状态\n   * @param {string[]} checkedKeys 存放所有checked的keys\n   * @param {boolean} checkStrictly 是否受控\n   * @param {updateParentChecked} next\n   */\n  function handleCheck(_a) {\n    var _b;\n    var node = _a.node,\n      checked = _a.checked,\n      checkedKeys = _a.checkedKeys,\n      checkStrictly = _a.checkStrictly,\n      next = _a.next;\n    // 不受控\n    if (!checkStrictly) {\n      if (checked) {\n        if (!checkedKeys.includes(node[Constant_1.DEFAULT_TREE_UTIL_CONFIG.keyAttr])) {\n          checkedKeys.push(node[Constant_1.DEFAULT_TREE_UTIL_CONFIG.keyAttr]);\n        }\n      } else {\n        if (checkedKeys.includes(node[Constant_1.DEFAULT_TREE_UTIL_CONFIG.keyAttr])) {\n          checkedKeys.splice(checkedKeys.indexOf(node[Constant_1.DEFAULT_TREE_UTIL_CONFIG.keyAttr]), 1);\n        }\n      }\n      return;\n    }\n    // 获取当前节点子孙的keys\n    var childrenKeys = getChildrenKeys(node);\n    if (checked) {\n      // 添加当前节点及其子节点\n      childrenKeys.forEach(function (key) {\n        if (!checkedKeys.includes(key)) {\n          checkedKeys.push(key);\n        }\n      });\n    } else {\n      // 移除当前节点及其子节点\n      childrenKeys.forEach(function (key) {\n        var index = checkedKeys.indexOf(key);\n        if (index > -1) {\n          checkedKeys.splice(index, 1);\n        }\n      });\n    }\n    // 更新父节点的状态\n    next === null || next === void 0 ? void 0 : next((_b = {}, _b[Constant_1.DEFAULT_TREE_UTIL_CONFIG.keyAttr] = node[Constant_1.DEFAULT_TREE_UTIL_CONFIG.keyAttr], _b.checked = checked, _b.checkedKeys = checkedKeys, _b));\n  }\n  /**\n   * existsCheckableNodeInParentChildren\n   * @description 在parentChildren中是否存在checkable的节点\n   * @param children\n   */\n  function existsCheckableNodeInParentChildren(children) {\n    if (!children) return false;\n    return children === null || children === void 0 ? void 0 : children.some(function (node) {\n      if (!('checkable' in node)) return true;\n      return !!node.checkable;\n    });\n  }\n  return {\n    handleCheck: handleCheck,\n    updateParentChecked: updateParentChecked,\n    existsCheckableNodeInParentChildren: existsCheckableNodeInParentChildren,\n    getDefaultCheckedKeysWithCheckStrictly: getDefaultCheckedKeysWithCheckStrictly\n  };\n}\nexports.default = useChecked;"],"names":["__spreadArray","to","from","pack","arguments","length","ar","i","l","Array","prototype","slice","call","concat","__importDefault","mod","__esModule","default","lodash_uniq_1","Object","defineProperty","exports","value","require","adhere_util_1","Constant_1","useChecked","targetChildren","children","_a","filter","node","checkable","disabled","getChildrenKeys","keys","DEFAULT_TREE_UTIL_CONFIG","keyAttr","forEach","child","handleCheck","checked","checkedKeys","checkStrictly","next","childrenKeys","key","includes","push","index","indexOf","splice","_b","updateParentChecked","parentId","childrenData","selfChecked","targetChildrenData","map","every","findIndex","itemKey","existsCheckableNodeInParentChildren","some","getDefaultCheckedKeysWithCheckStrictly","treeData","defaultCheckedKeys","checkedKey","nodeData","findNodeByKey","parentNodeData","descendants","apply","findParentNodeByKey","up"],"mappings":"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"}