import _SearchBar from"antd-mobile/es/components/search-bar";import _ErrorBlock from"antd-mobile/es/components/error-block";var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};import{useLatest,useUpdateEffect}from"ahooks";import classNames from"classnames";import React,{memo,useContext,useMemo,useState}from"react";import ConfigProvider from"@baifendian/adhere-ui-configprovider";import Hooks from"@baifendian/adhere-ui-hooks";import Space from"@baifendian/adhere-ui-space";import Util from"@baifendian/adhere-util";import Intl from"@baifendian/adhere-util-intl";import{DEFAULT_CHECKBOX_GAP,DEFAULT_CHECKBOX_WIDTH,DEFAULT_CHECKSTRICTLY,DEFAULT_FILTER_KEY,DEFAULT_ICON_GAP,DEFAULT_INDENT,DEFAULT_MULTIPLE,DEFAULT_ROW_GAP,DEFAULT_SHOW_SEARCH,DEFAULT_SIZE,DEFAULT_TITLE_GAP,DEFAULT_TREE_CHECKABLE,DEFAULT_TREE_UTIL_CONFIG}from"./Constant";import TreeContext from"./TreeContext";import TreeNode from"./TreeNode";import TreeNodeContext from"./TreeNodeContext";import TreeSelect from"./TreeSelect";import useChecked from"./useChecked";import useUtil from"./useUtil";var selectorPrefix="adhere-mobile-ui-tree",usePropToState=Hooks.usePropToState,InternalTree=memo(function(e){var t=e.className,K=e.style,r=e.treeData,n=(e.expandAll,e.expandedKeys),o=e.selectedKeys,i=e.switcherIcon,a=e.titleRender,G=e.icon,O=e.renderEmpty,c=e.size,l=e.checkable,u=e.checkedKeys,s=e.multiple,m=e.checkStrictly,f=e.treeDataSimpleMode,g=e.loadData,E=e.loadedKeys,T=e.showSearch,d=e.filterKey,p=e.rowGap,_=e.checkboxWidth,U=e.checkboxGap,h=e.titleGap,C=e.iconGap,L=e.indent,H=e.onSelect,B=e.onExpand,W=e.onCheck,A=useContext(ConfigProvider.Context).media,e=useUtil(),D=e.omitDisabledKeys,S=e.getValueWithUnit,w=e.checkTreeDataSimpleModeFromObject,e=useChecked(),j=e.getDefaultCheckedKeysWithCheckStrictly,X=e.existsCheckableNodeInParentChildren,F=useMemo(function(){return!(!Util.isBoolean(f)&&!Util.isObject(f))&&f},[f]),y=useMemo(function(){return null!=c?c:DEFAULT_SIZE},[c]),Y=useMemo(function(){return Util.isEmpty(l)?DEFAULT_TREE_CHECKABLE:l},[l]),z=useMemo(function(){return Util.isEmpty(s)?DEFAULT_MULTIPLE:s},[s]),I=useMemo(function(){return Util.isEmpty(m)?DEFAULT_CHECKSTRICTLY:m},[m]),e=useState(!1),Z=e[0],V=e[1],e=useState(""),R=e[0],q=e[1],e=useMemo(function(){return Util.isEmpty(T)?DEFAULT_SHOW_SEARCH:T},[T]),J=useMemo(function(){return Util.isEmpty(d)?DEFAULT_FILTER_KEY:d},[d]),N=useMemo(function(){var e=null!=r?r:[],e=(Util.isBoolean(F)?F&&(e=Util.arrayToAntdTreeSelect(e,DEFAULT_TREE_UTIL_CONFIG)):Util.isObject(F)&&w(F)&&(e=Util.arrayToAntdTreeSelect(e,F)),null!=e?e:[]);return Z&&R?Util.filterTree(e,R,__assign(__assign({},DEFAULT_TREE_UTIL_CONFIG),{filterAttr:J,titleAttr:J})):e},[R,Z,F,r]),k=useMemo(function(){return null!=n?n:[]},[n]),k=usePropToState(k),Q=k[0],$=k[1],k=useMemo(function(){return D(N,null!=o?o:[])},[o]),k=usePropToState(k),ee=k[0],te=k[1],k=useMemo(function(){var e=D(N,null!=u?u:[]).filter(function(e){return!!e});return I?j(N,e):e},[u,I]),k=usePropToState(k),M=k[0],re=k[1],ne=useLatest(M),k=(useUpdateEffect(function(){var e=D(N,null!=(e=ne.current)?e:[]).filter(function(e){return!!e});re(I?j(N,e):e)},[N,I]),useMemo(function(){return D(N,null!=E?E:[]).filter(function(e){return!!e})},[N,E])),k=usePropToState(k),P=k[0],oe=k[1],ie=useLatest(P),ae=(useUpdateEffect(function(){var e;oe(D(N,null!=(e=ie.current)?e:[]).filter(function(e){return!!e}))},[N]),useMemo(function(){return S(null!=_?_:DEFAULT_CHECKBOX_WIDTH,A)},[_,A])),ce=useMemo(function(){return S(null!=U?U:DEFAULT_CHECKBOX_GAP,A)},[U,A]),le=useMemo(function(){return S(null!=h?h:DEFAULT_TITLE_GAP,A)},[h,A]),ue=useMemo(function(){return S(null!=C?C:DEFAULT_ICON_GAP,A)},[C,A]),se=useMemo(function(){return S(null!=L?L:DEFAULT_INDENT,A)},[L,A]),x=useMemo(function(){return null!=p?p:new Map([["small",5],["middle",15],["large",25]]).get(y)},[y,p]),b=useMemo(function(){return N.map(function(e){return React.createElement(TreeNodeContext.Provider,{value:{existsCheckableNodeInParentChildren:function(){return X(e.children)}}},React.createElement(TreeNode,__assign({level:0,id:e[DEFAULT_TREE_UTIL_CONFIG.keyAttr]},e)))})},[N,i,a]),k=useMemo(function(){return!b.length},[b]),v=useMemo(function(){return{expandedKeys:function(){return Q},selectedKeys:function(){return ee},checkedKeys:function(){return M},loadedKeys:function(){return P},setSelectedKeys:te,setExpandedKeys:$,setCheckedKeys:re,setLoadedKeys:oe,loadData:g,size:function(){return y},rowGap:function(){return null!=x?x:DEFAULT_ROW_GAP},multiple:function(){return z},checkable:function(){return Y},treeData:function(){var e=r;return Util.isBoolean(F)?F&&(e=Util.arrayToAntdTreeSelect(e,DEFAULT_TREE_UTIL_CONFIG)):Util.isObject(F)&&w(F)&&(e=Util.arrayToAntdTreeSelect(e,F)),e},checkStrictly:function(){return I},teeDataSimpleMode:function(){return F},icon:G,checkboxWidth:function(){return ae},checkboxGap:function(){return ce},titleGap:function(){return le},iconGap:function(){return ue},indent:function(){return se},titleRender:a,switcherIcon:i,onSelect:H,onExpand:B,onCheck:W}},[Q,ee,M,P,x,y,z,Y,r,g,m,G,ae,ce,le,ue,se,a,i,H,B,W]),t=React.createElement(TreeContext.Provider,{value:v},React.createElement("ul",{className:classNames(selectorPrefix,t),style:null!=K?K:{}},React.createElement(Space.Group,{direction:"vertical",size:x},k&&React.createElement("li",null,null!=(v=null==O?void 0:O())?v:React.createElement(_ErrorBlock,{status:"empty"})),!k&&b)));return React.createElement(React.Fragment,null,e&&React.createElement("div",{className:classNames("".concat(selectorPrefix,"-wrapper"))},React.createElement("div",{className:classNames("".concat(selectorPrefix,"-search"))},React.createElement(_SearchBar,{placeholder:Intl.v("请输入"),showCancelButton:!0,value:R,onChange:q,onSearch:function(){V(!0)},onClear:function(){q(""),V(!1)}})),React.createElement("div",{className:classNames("".concat(selectorPrefix,"-body"))},t)),!e&&t)}),Tree=InternalTree;Tree.TreeSelect=TreeSelect,Tree.displayName="Tree";export default Tree;
//# sourceMappingURL=Tree.js.map
