import _AddOutline from"antd-mobile-icons/es/AddOutline";import _MinusOutline from"antd-mobile-icons/es/MinusOutline";import _Checkbox from"antd-mobile/es/components/checkbox";var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var c in t=arguments[n])Object.prototype.hasOwnProperty.call(t,c)&&(e[c]=t[c]);return e}).apply(this,arguments)},__spreadArray=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,c=0,o=t.length;c<o;c++)!r&&c in t||((r=r||Array.prototype.slice.call(t,0,c))[c]=t[c]);return e.concat(r||Array.prototype.slice.call(t))};import{useUpdate}from"ahooks";import classNames from"classnames";import React,{memo,useContext,useMemo}from"react";import{LoadingOutlined}from"@ant-design/icons";import ConfigProvider from"@baifendian/adhere-ui-configprovider";import Space from"@baifendian/adhere-ui-space";import Util from"@baifendian/adhere-util";import{DEFAULT_DISABLED,DEFAULT_SELECTABLE,DEFAULT_TREE_NODE_CHECKABLE,DEFAULT_TREE_UTIL_CONFIG}from"./Constant";import TreeContext from"./TreeContext";import TreeNodeContext from"./TreeNodeContext";import useChecked from"./useChecked";import useLoadedLocks from"./useLoadedLocks";import useUtil from"./useUtil";var selectorPrefix="adhere-mobile-ui-tree-node",TreeNode=memo(function(e){var c=e.id,t=e.level,n=e.isLeaf,K=e.title,r=e.checkable,o=e.disabled,a=e.selectable,i=e.props,l=e.checkboxWidth,s=e.checkboxGap,u=e.titleGap,F=e.iconGap,S=e.indent,d=e.children,e=useContext(TreeContext),m=e.setSelectedKeys,G=e.setExpandedKeys,w=e.setCheckedKeys,B=e.setLoadedKeys,f=e.selectedKeys,p=e.expandedKeys,h=e.checkedKeys,j=e.loadedKeys,E=e.loadData,k=e.size,z=e.multiple,W=e.checkable,H=e.checkStrictly,_=e.treeData,V=e.icon,q=e.checkboxWidth,J=e.checkboxGap,Q=e.titleGap,X=e.iconGap,Y=e.indent,Z=e.rowGap,$=e.titleRender,y=e.switcherIcon,x=e.onSelect,C=e.onExpand,v=e.onCheck,ee=useUpdate(),e=useLoadedLocks(),te=e.lock,ne=e.unLock,N=e.isLock,L=useContext(ConfigProvider.Context).media,T=useMemo(function(){return{key:c,level:t,disabled:o,selectable:a,checkable:r,isLeaf:!(null!=d&&d.length),props:i}},[c,t,o,a,r,i,d]),e=useMemo(function(){return null==V?void 0:V(T)},[T]),A=useContext(TreeNodeContext),re=A.updateParentChecked,A=A.existsCheckableNodeInParentChildren,b=useChecked(),ce=b.handleCheck,oe=b.updateParentChecked,ae=b.existsCheckableNodeInParentChildren,b=useUtil(),g=b.getTreeNodesByKeys,ie=b.getLeafKeys,P=(b.checkTreeDataSimpleModeFromObject,b.getValueWithUnit),R=useMemo(function(){return Util.isEmpty(o)?DEFAULT_DISABLED:o},[o]),le=useMemo(function(){return Util.isEmpty(a)?DEFAULT_SELECTABLE:a},[a]),b=useMemo(function(){return Util.isEmpty(r)?DEFAULT_TREE_NODE_CHECKABLE:r},[r]),D=useMemo(function(){return null!=d?d:[]},[d]),se=useMemo(function(){return void 0===n?!!D.length:!n},[D]),U=useMemo(function(){var e;return null!=(e=P(l,L))?e:q()},[l,q(),L]),ue=useMemo(function(){var e;return null!=(e=P(s,L))?e:J()},[s,J(),L]),de=useMemo(function(){var e;return null!=(e=P(u,L))?e:Q()},[u,Q(),L]),me=useMemo(function(){var e;return null!=(e=P(F,L))?e:X()},[F,X(),L]),fe=useMemo(function(){var e;return null!=(e=P(S,L))?e:Y()},[S,Y(),L]),pe=useMemo(function(){return Z()},[Z()]),he=useMemo(function(){return D.map(function(e){return React.createElement(TreeNodeContext.Provider,{value:{updateParentChecked:function(e){var t=e.key,n=e.checked,e=e.checkedKeys;oe({key:t,checked:n,checkedKeys:e,childrenData:D,parentId:c,next:re})},existsCheckableNodeInParentChildren:function(){return ae(D)}}},React.createElement(TreeNode,__assign({level:t+1,id:e[DEFAULT_TREE_UTIL_CONFIG.keyAttr]},e)))})},[D]),Ee=useMemo(function(){return h().includes(c)},[h(),c]),M=p().includes(c),O=f().includes(c);function I(n){function t(e){var t;return{expanded:!M,expandedNodes:g({treeData:null!=(t=_())?t:[],keys:e}),node:T,event:n}}G(M?function(e){e=(null!=e?e:[]).filter(function(e){return e!==c});return null!=C&&C(e,t(e)),e}:function(e){e=__spreadArray(__spreadArray([],null!=e?e:[],!0),[c],!1);return null!=C&&C(e,t(e)),e})}return React.createElement("li",{key:c,className:classNames(selectorPrefix,"".concat(selectorPrefix,"-").concat(k()),((p={})["".concat(selectorPrefix,"-disabled")]=R,p))},React.createElement(Space.Group,{direction:"vertical",size:pe},React.createElement("div",{className:"".concat(selectorPrefix,"-info")},W()&&b&&React.createElement("span",{className:classNames("".concat(selectorPrefix,"-info-checkbox")),style:{width:U,marginInlineEnd:ue}},React.createElement(_Checkbox,{value:c,checked:Ee,disabled:R,onChange:function(e){var t,n=h(),r=(ce({node:((r={})[DEFAULT_TREE_UTIL_CONFIG.keyAttr]=c,r.children=d,r),checked:e,checkedKeys:n,checkStrictly:H(),next:re}),w(__spreadArray([],n,!0)),__spreadArray([],n,!0));v&&H()&&(r=ie({treeData:null!=(t=_())?t:[],keys:n})),null!=v&&v(r,{checked:e,checkedNodes:g({treeData:null!=(t=_())?t:[],keys:r}),node:T})}})),W()&&!b&&A()&&React.createElement("span",{className:classNames("".concat(selectorPrefix,"-info-checkbox"))}),se&&React.createElement("span",{className:"".concat(selectorPrefix,"-info-expanded"),onClick:function(e){var t,n;!M&&E?(t=e,N(c)||(j().includes(c)?I(t):(te(c),ee(),null!=(n=null==E?void 0:E(T))&&n.then(function(){I(t),ne(c),B(function(e){return __spreadArray(__spreadArray([],e,!0),[c],!1)})}).catch(function(e){throw h().includes(c)&&B(function(e){return e.filter(function(e){return e!==c})}),ne(c),ee(),new Error(e)})))):I(e)}},N(c)&&React.createElement(LoadingOutlined,{className:"".concat(selectorPrefix,"-info-load")}),!N(c)&&M&&(null!=(f=null==y?void 0:y(M,T))?f:React.createElement(_MinusOutline,null)),!N(c)&&!M&&(null!=(k=null==y?void 0:y(M,T))?k:React.createElement(_AddOutline,null))),React.createElement("span",{className:classNames("".concat(selectorPrefix,"-info-title-wrapper"),((p={})["".concat(selectorPrefix,"-info-title-selected")]=le&&O,p)),style:{padding:de},onClick:function(n){if(le&&!R)return z()?O?void m(function(e){e=(null!=e?e:[]).filter(function(e){return e!==c});return null!=x&&x(e,t(e)),e}):void m(function(e){e=__spreadArray(__spreadArray([],null!=e?e:[],!0),[c],!1);return null!=x&&x(e,t(e)),e}):void(O?(m([]),null!=x&&x([],t([]))):(m([c]),null!=x&&x([c],t([c]))));function t(e){var t;return{selected:!O,selectedNodes:g({treeData:null!=(t=_())?t:[],keys:e}),node:T,event:n}}}},!!e&&React.createElement("span",{className:"".concat(selectorPrefix,"-info-icon"),style:{marginInlineEnd:me}},e),React.createElement("span",{className:"".concat(selectorPrefix,"-info-title")},null!=(U=null==$?void 0:$(T))?U:K))),se&&M&&React.createElement("ul",{className:"".concat(selectorPrefix,"-children"),style:{paddingInlineStart:fe}},React.createElement(Space.Group,{direction:"vertical",size:pe},he))))});TreeNode.displayName="TreeNode";export default TreeNode;
//# sourceMappingURL=TreeNode.js.map
