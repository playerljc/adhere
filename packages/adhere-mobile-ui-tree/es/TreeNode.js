import _AddOutline from"antd-mobile-icons/es/AddOutline";import _MinusOutline from"antd-mobile-icons/es/MinusOutline";import _Checkbox from"antd-mobile/es/components/checkbox";var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var c in t=arguments[n])Object.prototype.hasOwnProperty.call(t,c)&&(e[c]=t[c]);return e}).apply(this,arguments)},__spreadArray=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,c=0,o=t.length;c<o;c++)!r&&c in t||((r=r||Array.prototype.slice.call(t,0,c))[c]=t[c]);return e.concat(r||Array.prototype.slice.call(t))};import{useUpdate}from"ahooks";import classNames from"classnames";import React,{memo,useContext,useMemo}from"react";import{LoadingOutlined}from"@ant-design/icons";import ConfigProvider from"@baifendian/adhere-ui-configprovider";import Space from"@baifendian/adhere-ui-space";import Util from"@baifendian/adhere-util";import{DEFAULT_DISABLED,DEFAULT_SELECTABLE,DEFAULT_TREE_NODE_CHECKABLE,DEFAULT_TREE_UTIL_CONFIG}from"./Constant";import TreeContext from"./TreeContext";import TreeNodeContext from"./TreeNodeContext";import useChecked from"./useChecked";import useLoadedLocks from"./useLoadedLocks";import useUtil from"./useUtil";var selectorPrefix="adhere-mobile-ui-tree-node",TreeNode=memo(function(e){var c=e.id,t=e.level,n=e.isLeaf,F=e.title,r=e.checkable,o=e.disabled,a=e.selectable,l=e.props,i=e.checkboxWidth,s=e.checkboxGap,S=e.titleGap,K=e.iconGap,G=e.indent,u=e.children,e=useContext(TreeContext),d=e.setSelectedKeys,B=e.setExpandedKeys,w=e.setCheckedKeys,j=e.setLoadedKeys,z=e.setTreeData,m=e.selectedKeys,f=e.expandedKeys,p=e.checkedKeys,W=e.loadedKeys,h=e.teeDataSimpleMode,E=e.loadData,_=e.size,H=e.multiple,J=e.checkable,V=e.checkStrictly,k=e.treeData,q=e.icon,Q=e.checkboxWidth,X=e.checkboxGap,Y=e.titleGap,Z=e.iconGap,$=e.indent,ee=e.rowGap,te=e.titleRender,y=e.switcherIcon,x=e.onSelect,C=e.onExpand,T=e.onCheck,ne=useUpdate(),e=useLoadedLocks(),re=e.lock,ce=e.unLock,N=e.isLock,v=useContext(ConfigProvider.Context).media,A=useMemo(function(){return{key:c,level:t,disabled:o,selectable:a,checkable:r,isLeaf:!(null!=u&&u.length),props:l}},[c,t,o,a,r,l,u]),e=useMemo(function(){return null==q?void 0:q(A)},[A]),L=useContext(TreeNodeContext),oe=L.updateParentChecked,L=L.existsCheckableNodeInParentChildren,U=useChecked(),ae=U.handleCheck,le=U.updateParentChecked,ie=U.existsCheckableNodeInParentChildren,U=useUtil(),b=U.getTreeNodesByKeys,se=U.getLeafKeys,ue=U.checkTreeDataSimpleModeFromObject,D=U.getValueWithUnit,R=useMemo(function(){return Util.isEmpty(o)?DEFAULT_DISABLED:o},[o]),de=useMemo(function(){return Util.isEmpty(a)?DEFAULT_SELECTABLE:a},[a]),U=useMemo(function(){return Util.isEmpty(r)?DEFAULT_TREE_NODE_CHECKABLE:r},[r]),g=useMemo(function(){return null!=u?u:[]},[u]),me=useMemo(function(){return void 0===n?!!g.length:!n},[g]),P=useMemo(function(){var e;return null!=(e=D(i,v))?e:Q()},[i,Q(),v]),fe=useMemo(function(){var e;return null!=(e=D(s,v))?e:X()},[s,X(),v]),pe=useMemo(function(){var e;return null!=(e=D(S,v))?e:Y()},[S,Y(),v]),he=useMemo(function(){var e;return null!=(e=D(K,v))?e:Z()},[K,Z(),v]),Ee=useMemo(function(){var e;return null!=(e=D(G,v))?e:$()},[G,$(),v]),_e=useMemo(function(){return ee()},[ee()]),ke=useMemo(function(){return g.map(function(e){return React.createElement(TreeNodeContext.Provider,{value:{updateParentChecked:function(e){var t=e.key,n=e.checked,e=e.checkedKeys;le({key:t,checked:n,checkedKeys:e,childrenData:g,parentId:c,next:oe})},existsCheckableNodeInParentChildren:function(){return ie(g)}}},React.createElement(TreeNode,__assign({level:t+1,id:e[DEFAULT_TREE_UTIL_CONFIG.keyAttr]},e)))})},[g]),ye=useMemo(function(){return p().includes(c)},[p(),c]),O=f().includes(c),I=m().includes(c);function M(n){function t(e){var t;return{expanded:!O,expandedNodes:b({treeData:null!=(t=k())?t:[],keys:e}),node:A,event:n}}B(O?function(e){e=(null!=e?e:[]).filter(function(e){return e!==c});return null!=C&&C(e,t(e)),e}:function(e){e=__spreadArray(__spreadArray([],null!=e?e:[],!0),[c],!1);return null!=C&&C(e,t(e)),e})}return React.createElement("li",{key:c,className:classNames(selectorPrefix,"".concat(selectorPrefix,"-").concat(_()),((f={})["".concat(selectorPrefix,"-disabled")]=R,f))},React.createElement(Space.Group,{direction:"vertical",size:_e},React.createElement("div",{className:"".concat(selectorPrefix,"-info")},J()&&U&&React.createElement("span",{className:classNames("".concat(selectorPrefix,"-info-checkbox")),style:{width:P,marginInlineEnd:fe}},React.createElement(_Checkbox,{value:c,checked:ye,disabled:R,onChange:function(e){var t,n=p(),r=(ae({node:((r={})[DEFAULT_TREE_UTIL_CONFIG.keyAttr]=c,r.children=u,r),checked:e,checkedKeys:n,checkStrictly:V(),next:oe}),w(__spreadArray([],n,!0)),__spreadArray([],n,!0));T&&V()&&(r=se({treeData:null!=(t=k())?t:[],keys:n})),null!=T&&T(r,{checked:e,checkedNodes:b({treeData:null!=(t=k())?t:[],keys:r}),node:A})}})),J()&&!U&&L()&&React.createElement("span",{className:classNames("".concat(selectorPrefix,"-info-checkbox"))}),me&&React.createElement("span",{className:"".concat(selectorPrefix,"-info-expanded"),onClick:function(e){var t,n;!O&&E?(t=e,N(c)||(W().includes(c)?M(t):(re(c),ne(),null!=(n=null==E?void 0:E(A))&&n.then(function(r){z(function(e){var t=r,n=!(null==h||!h()),n=(n&&(Util.isBoolean(n)?n&&(t=Util.arrayToAntdTreeSelect(t,DEFAULT_TREE_UTIL_CONFIG)):Util.isObject(n)&&ue(n)&&(t=Util.arrayToAntdTreeSelect(t,null==h?void 0:h()))),Util.findNodeByKey(e,A[DEFAULT_TREE_UTIL_CONFIG.keyAttr],{keyAttr:DEFAULT_TREE_UTIL_CONFIG.keyAttr}));return n&&(n.children=null!=t?t:[]),JSON.parse(JSON.stringify(e))}),M(t),ce(c),j(function(e){return __spreadArray(__spreadArray([],e,!0),[c],!1)})}).catch(function(e){throw p().includes(c)&&j(function(e){return e.filter(function(e){return e!==c})}),ce(c),ne(),new Error(e)})))):M(e)}},N(c)&&React.createElement(LoadingOutlined,{className:"".concat(selectorPrefix,"-info-load")}),!N(c)&&O&&(null!=(m=null==y?void 0:y(O,A))?m:React.createElement(_MinusOutline,null)),!N(c)&&!O&&(null!=(_=null==y?void 0:y(O,A))?_:React.createElement(_AddOutline,null))),React.createElement("span",{className:classNames("".concat(selectorPrefix,"-info-title-wrapper"),((f={})["".concat(selectorPrefix,"-info-title-selected")]=de&&I,f)),style:{padding:pe},onClick:function(n){if(de&&!R)return H()?I?void d(function(e){e=(null!=e?e:[]).filter(function(e){return e!==c});return null!=x&&x(e,t(e)),e}):void d(function(e){e=__spreadArray(__spreadArray([],null!=e?e:[],!0),[c],!1);return null!=x&&x(e,t(e)),e}):void(I?(d([]),null!=x&&x([],t([]))):(d([c]),null!=x&&x([c],t([c]))));function t(e){var t;return{selected:!I,selectedNodes:b({treeData:null!=(t=k())?t:[],keys:e}),node:A,event:n}}}},!!e&&React.createElement("span",{className:"".concat(selectorPrefix,"-info-icon"),style:{marginInlineEnd:he}},e),React.createElement("span",{className:"".concat(selectorPrefix,"-info-title")},null!=(P=null==te?void 0:te(A))?P:F))),me&&O&&React.createElement("ul",{className:"".concat(selectorPrefix,"-children"),style:{paddingInlineStart:Ee}},React.createElement(Space.Group,{direction:"vertical",size:_e},ke))))});TreeNode.displayName="TreeNode";export default TreeNode;
//# sourceMappingURL=TreeNode.js.map
