import _AddOutline from"antd-mobile-icons/es/AddOutline";import _MinusOutline from"antd-mobile-icons/es/MinusOutline";import _Checkbox from"antd-mobile/es/components/checkbox";var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var c in t=arguments[n])Object.prototype.hasOwnProperty.call(t,c)&&(e[c]=t[c]);return e}).apply(this,arguments)},__spreadArray=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,c=0,o=t.length;c<o;c++)!r&&c in t||((r=r||Array.prototype.slice.call(t,0,c))[c]=t[c]);return e.concat(r||Array.prototype.slice.call(t))};import{useUpdate}from"ahooks";import classNames from"classnames";import React,{memo,useContext,useMemo}from"react";import{LoadingOutlined}from"@ant-design/icons";import ConfigProvider from"@baifendian/adhere-ui-configprovider";import Space from"@baifendian/adhere-ui-space";import Util from"@baifendian/adhere-util";import{DEFAULT_DISABLED,DEFAULT_SELECTABLE,DEFAULT_TREE_NODE_CHECKABLE}from"./Constant";import TreeContext from"./TreeContext";import TreeNodeContext from"./TreeNodeContext";import useChecked from"./useChecked";import useLoadedLocks from"./useLoadedLocks";import useUtil from"./useUtil";var selectorPrefix="adhere-mobile-ui-tree-node",TreeNode=memo(function(e){var c=e.id,t=e.level,n=e.isLeaf,S=e.title,r=e.checkable,o=e.disabled,a=e.selectable,i=e.props,l=e.checkboxWidth,s=e.checkboxGap,u=e.titleGap,I=e.iconGap,G=e.indent,d=e.children,e=useContext(TreeContext),m=e.setSelectedKeys,w=e.setExpandedKeys,B=e.setCheckedKeys,F=e.setLoadedKeys,f=e.selectedKeys,p=e.expandedKeys,h=e.checkedKeys,z=e.loadedKeys,k=e.loadData,y=e.size,W=e.multiple,j=e.checkable,H=e.checkStrictly,E=e.treeData,V=e.icon,q=e.checkboxWidth,J=e.checkboxGap,Q=e.titleGap,X=e.iconGap,Y=e.indent,Z=e.rowGap,$=e.titleRender,x=e.switcherIcon,_=e.onSelect,C=e.onExpand,v=e.onCheck,ee=useUpdate(),e=useLoadedLocks(),te=e.lock,ne=e.unLock,N=e.isLock,b=useContext(ConfigProvider.Context).media,L=useMemo(function(){return{key:c,level:t,disabled:o,selectable:a,checkable:r,isLeaf:!(null!=d&&d.length),props:i}},[c,t,o,a,r,i,d]),e=useMemo(function(){return null==V?void 0:V(L)},[L]),A=useContext(TreeNodeContext),re=A.updateParentChecked,A=A.existsCheckableNodeInParentChildren,g=useChecked(),ce=g.handleCheck,oe=g.updateParentChecked,ae=g.existsCheckableNodeInParentChildren,g=useUtil(),P=g.getTreeNodesByKeys,ie=g.getLeafKeys,T=g.getValueWithUnit,R=useMemo(function(){return Util.isEmpty(o)?DEFAULT_DISABLED:o},[o]),le=useMemo(function(){return Util.isEmpty(a)?DEFAULT_SELECTABLE:a},[a]),g=useMemo(function(){return Util.isEmpty(r)?DEFAULT_TREE_NODE_CHECKABLE:r},[r]),D=useMemo(function(){return null!=d?d:[]},[d]),se=useMemo(function(){return void 0===n?!!D.length:!n},[D]),M=useMemo(function(){var e;return null!=(e=T(l,b))?e:q()},[l,q(),b]),ue=useMemo(function(){var e;return null!=(e=T(s,b))?e:J()},[s,J(),b]),de=useMemo(function(){var e;return null!=(e=T(u,b))?e:Q()},[u,Q(),b]),me=useMemo(function(){var e;return null!=(e=T(I,b))?e:X()},[I,X(),b]),fe=useMemo(function(){var e;return null!=(e=T(G,b))?e:Y()},[G,Y(),b]),pe=useMemo(function(){return Z()},[Z()]),he=useMemo(function(){return D.map(function(e){return React.createElement(TreeNodeContext.Provider,{value:{updateParentChecked:function(e){var t=e.key,n=e.checked,e=e.checkedKeys;oe({key:t,checked:n,checkedKeys:e,childrenData:D,parentId:c,next:re})},existsCheckableNodeInParentChildren:function(){return ae(D)}}},React.createElement(TreeNode,__assign({level:t+1,id:e.key},e)))})},[D]),ke=useMemo(function(){return h().includes(c)},[h(),c]),U=p().includes(c),K=f().includes(c);function O(n){function t(e){var t;return{expanded:!U,expandedNodes:P({treeData:null!=(t=E())?t:[],keys:e}),node:L,event:n}}w(U?function(e){e=(null!=e?e:[]).filter(function(e){return e!==c});return null!=C&&C(e,t(e)),e}:function(e){e=__spreadArray(__spreadArray([],null!=e?e:[],!0),[c],!1);return null!=C&&C(e,t(e)),e})}return React.createElement("li",{key:c,className:classNames(selectorPrefix,"".concat(selectorPrefix,"-").concat(y()),((p={})["".concat(selectorPrefix,"-disabled")]=R,p))},React.createElement(Space.Group,{direction:"vertical",size:pe},React.createElement("div",{className:"".concat(selectorPrefix,"-info")},j()&&g&&React.createElement("span",{className:classNames("".concat(selectorPrefix,"-info-checkbox")),style:{width:M,marginInlineEnd:ue}},React.createElement(_Checkbox,{value:c,checked:ke,disabled:R,onChange:function(e){var t,n=h(),r=(ce({node:{key:c,children:d},checked:e,checkedKeys:n,checkStrictly:H(),next:re}),B(__spreadArray([],n,!0)),__spreadArray([],n,!0));v&&H()&&(r=ie({treeData:null!=(t=E())?t:[],keys:n})),null!=v&&v(r,{checked:e,checkedNodes:P({treeData:null!=(t=E())?t:[],keys:r}),node:L})}})),j()&&!g&&A()&&React.createElement("span",{className:classNames("".concat(selectorPrefix,"-info-checkbox"))}),se&&React.createElement("span",{className:"".concat(selectorPrefix,"-info-expanded"),onClick:function(e){var t,n;!U&&k?(t=e,N(c)||(z().includes(c)?O(t):(te(c),ee(),null!=(n=null==k?void 0:k(L))&&n.then(function(){O(t),ne(c),F(function(e){return __spreadArray(__spreadArray([],e,!0),[c],!1)})}).catch(function(e){throw h().includes(c)&&F(function(e){return e.filter(function(e){return e!==c})}),ne(c),ee(),new Error(e)})))):O(e)}},N(c)&&React.createElement(LoadingOutlined,{className:"".concat(selectorPrefix,"-info-load")}),!N(c)&&U&&(null!=(f=null==x?void 0:x(U,L))?f:React.createElement(_MinusOutline,null)),!N(c)&&!U&&(null!=(y=null==x?void 0:x(U,L))?y:React.createElement(_AddOutline,null))),React.createElement("span",{className:classNames("".concat(selectorPrefix,"-info-title-wrapper"),((p={})["".concat(selectorPrefix,"-info-title-selected")]=le&&K,p)),style:{padding:de},onClick:function(n){if(le&&!R)return W()?K?void m(function(e){e=(null!=e?e:[]).filter(function(e){return e!==c});return null!=_&&_(e,t(e)),e}):void m(function(e){e=__spreadArray(__spreadArray([],null!=e?e:[],!0),[c],!1);return null!=_&&_(e,t(e)),e}):void(K?(m([]),null!=_&&_([],t([]))):(m([c]),null!=_&&_([c],t([c]))));function t(e){var t;return{selected:!K,selectedNodes:P({treeData:null!=(t=E())?t:[],keys:e}),node:L,event:n}}}},!!e&&React.createElement("span",{className:"".concat(selectorPrefix,"-info-icon"),style:{marginInlineEnd:me}},e),React.createElement("span",{className:"".concat(selectorPrefix,"-info-title")},null!=(M=null==$?void 0:$(L))?M:S))),se&&U&&React.createElement("ul",{className:"".concat(selectorPrefix,"-children"),style:{paddingInlineStart:fe}},React.createElement(Space.Group,{direction:"vertical",size:pe},he))))});TreeNode.displayName="TreeNode";export default TreeNode;
//# sourceMappingURL=TreeNode.js.map
