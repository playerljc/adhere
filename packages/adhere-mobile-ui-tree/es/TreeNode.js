import _AddOutline from"antd-mobile-icons/es/AddOutline";import _MinusOutline from"antd-mobile-icons/es/MinusOutline";import _Checkbox from"antd-mobile/es/components/checkbox";var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var c in t=arguments[n])Object.prototype.hasOwnProperty.call(t,c)&&(e[c]=t[c]);return e}).apply(this,arguments)},__spreadArray=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,c=0,a=t.length;c<a;c++)!r&&c in t||((r=r||Array.prototype.slice.call(t,0,c))[c]=t[c]);return e.concat(r||Array.prototype.slice.call(t))};import classNames from"classnames";import React,{memo,useContext,useMemo}from"react";import Space from"@baifendian/adhere-ui-space";import Util from"@baifendian/adhere-util";import{DEFAULT_DISABLED,DEFAULT_SELECTABLE,DEFAULT_TREE_NODE_CHECKABLE}from"./Constant";import TreeContext from"./TreeContext";import TreeNodeContext from"./TreeNodeContext";import useChecked from"./useChecked";import useUtil from"./useUtil";var selectorPrefix="adhere-mobile-ui-tree-node",TreeNode=memo(function(e){var c=e.id,t=e.level,n=(e.isLeaf,e.title),r=e.checkable,a=e.disabled,l=e.selectable,o=e.children,e=useContext(TreeContext),i=e.setSelectedKeys,S=e.setExpandedKeys,B=e.setCheckedKeys,s=e.selectedKeys,u=e.expandedKeys,d=e.checkedKeys,m=e.rowGap,f=e.size,I=e.multiple,p=e.checkable,h=e.checkStrictly,E=e.treeData,k=e.icon,y=e.titleRender,_=e.switcherIcon,x=e.onSelect,C=e.onExpand,N=e.onCheck,v=useMemo(function(){return{key:c,level:t,disabled:a,selectable:l,checkable:r,isLeaf:!(null!=o&&o.length)}},[c,t,a,l,r,o]),e=useMemo(function(){return null==k?void 0:k(v)},[v]),b=useContext(TreeNodeContext),A=b.updateParentChecked,b=b.hasCheckableNodeInParentChildren,T=useMemo(function(){return Util.isEmpty(a)?DEFAULT_DISABLED:a},[a]),P=useMemo(function(){return Util.isEmpty(l)?DEFAULT_SELECTABLE:l},[l]),R=useMemo(function(){return Util.isEmpty(r)?DEFAULT_TREE_NODE_CHECKABLE:r},[r]),D=useMemo(function(){return null!=o?o:[]},[o]),L=useMemo(function(){return!!D.length},[D]),g=useChecked(),F=g.handleCheck,w=g.updateParentChecked,z=g.hasCheckableNodeInParentChildren,g=useUtil(),K=g.getTreeNodesByKeys,G=g.getLeafKeys,g=useMemo(function(){return D.map(function(e){return React.createElement(TreeNodeContext.Provider,{value:{updateParentChecked:function(e){var t=e.key,n=e.checked,e=e.checkedKeys;w({key:t,checked:n,checkedKeys:e,childrenData:D,parentId:c,next:A})},hasCheckableNodeInParentChildren:function(){return z(D)}}},React.createElement(TreeNode,__assign({level:t+1,id:e.key},e)))})},[D]),M=useMemo(function(){return d().includes(c)},[d(),c]),U=u().includes(c),O=s().includes(c);return React.createElement("li",{key:c,className:classNames(selectorPrefix,"".concat(selectorPrefix,"-").concat(f()),((u={})["".concat(selectorPrefix,"-disabled")]=T,u))},React.createElement(Space.Group,{direction:"vertical",size:m()},React.createElement("div",{className:"".concat(selectorPrefix,"-info")},p()&&R&&React.createElement("span",{className:classNames("".concat(selectorPrefix,"-info-checkbox"))},React.createElement(_Checkbox,{value:c,checked:M,disabled:T,onChange:function(e){var t,n=d(),r=(F({node:{key:c,children:o},checked:e,checkedKeys:n,checkStrictly:h(),next:A}),B(__spreadArray([],n,!0)),__spreadArray([],n,!0));N&&h()&&(r=G({treeData:null!=(t=E())?t:[],keys:n})),null!=N&&N(r,{checked:e,checkedNodes:K({treeData:null!=(t=E())?t:[],keys:r}),node:v})}})),p()&&!R&&b()&&React.createElement("span",{className:classNames("".concat(selectorPrefix,"-info-checkbox"))}),L&&React.createElement("span",{className:"".concat(selectorPrefix,"-info-expanded"),onClick:function(n){function t(e){var t;return{expanded:!U,expandedNodes:K({treeData:null!=(t=E())?t:[],keys:e}),node:v,event:n}}S(U?function(e){e=(null!=e?e:[]).filter(function(e){return e!==c});return null!=C&&C(e,t(e)),e}:function(e){e=__spreadArray(__spreadArray([],null!=e?e:[],!0),[c],!1);return null!=C&&C(e,t(e)),e})}},U&&(null!=(s=null==_?void 0:_(U,v))?s:React.createElement(_MinusOutline,null)),!U&&(null!=(f=null==_?void 0:_(U,v))?f:React.createElement(_AddOutline,null))),React.createElement("span",{className:classNames("".concat(selectorPrefix,"-info-title-wrapper"),((u={})["".concat(selectorPrefix,"-info-title-selected")]=P&&O,u))},!!e&&React.createElement("span",{className:"".concat(selectorPrefix,"-info-icon")},e),React.createElement("span",{className:"".concat(selectorPrefix,"-info-title"),onClick:function(n){if(P)return I()?O?void i(function(e){e=(null!=e?e:[]).filter(function(e){return e!==c});return null!=x&&x(e,t(e)),e}):void i(function(e){e=__spreadArray(__spreadArray([],null!=e?e:[],!0),[c],!1);return null!=x&&x(e,t(e)),e}):void(O?(i([]),null!=x&&x([],t([]))):(i([c]),null!=x&&x([c],t([c]))));function t(e){var t;return{selected:!O,selectedNodes:K({treeData:null!=(t=E())?t:[],keys:e}),node:v,event:n}}}},null!=(M=null==y?void 0:y(v))?M:n))),L&&U&&React.createElement("ul",{className:"".concat(selectorPrefix,"-children")},React.createElement(Space.Group,{direction:"vertical",size:m()},g))))});TreeNode.displayName="TreeNode";export default TreeNode;
//# sourceMappingURL=TreeNode.js.map
