{"version":3,"file":"ConfigProvider.js","sources":["ConfigProvider.js"],"sourcesContent":["import init from '@baifendian/adhere-ui-css';\nimport { useUpdateEffect, useUpdateLayoutEffect } from 'ahooks';\nimport classNames from 'classnames';\nimport React, { createContext, memo, useLayoutEffect, useRef, useState } from 'react';\nimport ConditionalRender from '@baifendian/adhere-ui-conditionalrender';\nimport Hooks from '@baifendian/adhere-ui-hooks';\nimport Intl from '@baifendian/adhere-util-intl';\nimport Resource from '@baifendian/adhere-util-resource';\nexport var Context = createContext({});\nvar useForceUpdate = Hooks.useForceUpdate;\nvar selectorPrefix = 'adhere-ui-config-provider';\n/**\n * ConfigProvider\n * @constructor\n * @classdesc 全局配置 国际化、字典配置\n */\nvar InternalConfigProvider = memo(function (props) {\n    var _a = props.intl, lang = _a.lang, locales = _a.locales, prefix = _a.prefix, mainLanguage = _a.mainLanguage, theme = props.theme, children = props.children, onIntlInit = props.onIntlInit;\n    var wrapperELRef = useRef(null);\n    var _b = useState(false), isIntlInit = _b[0], setIntlInit = _b[1];\n    var forceUpdate = useForceUpdate();\n    function initIntl() {\n        return Intl.init({\n            prefix: prefix || 'local',\n            currentLocale: lang,\n            locales: locales !== null && locales !== void 0 ? locales : {},\n            mainLanguage: mainLanguage || 'zh_CN',\n        }, Intl.isInit());\n    }\n    useUpdateEffect(function () {\n        initIntl().then(function () {\n            Resource.Dict.value.LocalsMoment.value[lang]();\n            forceUpdate();\n        });\n    }, [lang, locales, prefix, mainLanguage]);\n    useLayoutEffect(function () {\n        // console.log('useLayoutEffect');\n        initIntl().then(function () {\n            Resource.Dict.value.LocalsMoment.value[lang]();\n            // console.log('initIntl');\n            setIntlInit(true);\n            if (onIntlInit)\n                onIntlInit();\n        });\n    }, []);\n    useUpdateLayoutEffect(function () {\n        // console.log('useUpdateLayoutEffect');\n        if (isIntlInit && wrapperELRef.current) {\n            init(theme, wrapperELRef.current);\n        }\n    }, [theme, isIntlInit]);\n    return (React.createElement(ConditionalRender, { conditional: isIntlInit }, function () {\n        var _a, _b;\n        return (React.createElement(Context.Provider, { value: {\n                intl: {\n                    lang: lang,\n                    prefix: prefix,\n                    locales: locales !== null && locales !== void 0 ? locales : {},\n                },\n            } },\n            React.createElement(\"div\", { \n                // @ts-ignore\n                ref: wrapperELRef, className: classNames(selectorPrefix, (_a = props.className) !== null && _a !== void 0 ? _a : ''), style: (_b = props.style) !== null && _b !== void 0 ? _b : {} }, children())));\n    }));\n});\nvar ConfigProvider = InternalConfigProvider;\nConfigProvider.Context = Context;\nConfigProvider.displayName = 'ConfigProvider';\nexport default ConfigProvider;\n"],"names":["init","useUpdateEffect","useUpdateLayoutEffect","classNames","React","createContext","memo","useLayoutEffect","useRef","useState","ConditionalRender","Hooks","Intl","Resource","Context","useForceUpdate","selectorPrefix","InternalConfigProvider","props","_a","intl","lang","locales","prefix","mainLanguage","theme","children","onIntlInit","wrapperELRef","_b","isIntlInit","setIntlInit","forceUpdate","initIntl","currentLocale","isInit","then","Dict","value","LocalsMoment","current","createElement","conditional","Provider","ref","className","style","ConfigProvider","displayName"],"mappings":"OAAOA,SAAU,mCACRC,gBAAiBC,qBAAqC,KAAR,gBAChDC,eAAgB,oBAChBC,OAASC,cAAeC,KAAMC,gBAAiBC,OAAQC,QAAuB,KAAP,eACvEC,sBAAuB,iDACvBC,UAAW,qCACXC,SAAU,sCACVC,aAAc,mCACd,IAAIC,QAAUT,cAAc,EAAE,EACjCU,eAAiBJ,MAAMI,eACvBC,eAAiB,4BAMjBC,uBAAyBX,KAAK,SAAUY,GACxC,IAAIC,EAAKD,EAAME,KAAMC,EAAOF,EAAGE,KAAMC,EAAUH,EAAGG,QAASC,EAASJ,EAAGI,OAAQC,EAAeL,EAAGK,aAAcC,EAAQP,EAAMO,MAAOC,EAAWR,EAAMQ,SAAUC,EAAaT,EAAMS,WAC9KC,EAAepB,OAAO,IAAI,EAC1BqB,EAAKpB,SAAS,CAAA,CAAK,EAAGqB,EAAaD,EAAG,GAAIE,EAAcF,EAAG,GAC3DG,EAAcjB,eAAe,EACjC,SAASkB,IACL,OAAOrB,KAAKZ,KAAK,CACbuB,OAAQA,GAAU,QAClBW,cAAeb,EACfC,QAASA,MAAAA,EAAyCA,EAAU,GAC5DE,aAAcA,GAAgB,OAClC,EAAGZ,KAAKuB,OAAO,CAAC,CACpB,CAuBA,OAtBAlC,gBAAgB,WACZgC,EAAS,EAAEG,KAAK,WACZvB,SAASwB,KAAKC,MAAMC,aAAaD,MAAMjB,GAAM,EAC7CW,EAAY,CAChB,CAAC,CACL,EAAG,CAACX,EAAMC,EAASC,EAAQC,EAAa,EACxCjB,gBAAgB,WAEZ0B,EAAS,EAAEG,KAAK,WACZvB,SAASwB,KAAKC,MAAMC,aAAaD,MAAMjB,GAAM,EAE7CU,EAAY,CAAA,CAAI,EACZJ,GACAA,EAAW,CACnB,CAAC,CACL,EAAG,EAAE,EACLzB,sBAAsB,WAEd4B,GAAcF,EAAaY,SAC3BxC,KAAKyB,EAAOG,EAAaY,OAAO,CAExC,EAAG,CAACf,EAAOK,EAAW,EACd1B,MAAMqC,cAAc/B,kBAAmB,CAAEgC,YAAaZ,CAAW,EAAG,WACxE,IAAQD,EACR,OAAQzB,MAAMqC,cAAc3B,QAAQ6B,SAAU,CAAEL,MAAO,CAC/ClB,KAAM,CACFC,KAAMA,EACNE,OAAQA,EACRD,QAASA,MAAAA,EAAyCA,EAAU,EAChE,CACJ,CAAE,EACFlB,MAAMqC,cAAc,MAAO,CAEvBG,IAAKhB,EAAciB,UAAW1C,WAAWa,eAAgB,OAACG,EAAKD,EAAM2B,WAAuC1B,EAAK,EAAE,EAAG2B,MAAO,OAACjB,EAAKX,EAAM4B,OAAmCjB,EAAK,EAAG,EAAGH,EAAS,CAAC,CAAE,CAC/M,CAAE,CACN,CAAC,EACGqB,eAAiB9B,uBACrB8B,eAAejC,QAAUA,QACzBiC,eAAeC,YAAc,gCACdD,sBA5DJjC,OA4DkB"}