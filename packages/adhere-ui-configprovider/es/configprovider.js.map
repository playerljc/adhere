{"version":3,"file":"ConfigProvider.js","sources":["ConfigProvider.js"],"sourcesContent":["var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nimport init from '@baifendian/adhere-ui-css';\nimport { useUpdateEffect, useUpdateLayoutEffect } from 'ahooks';\nimport classNames from 'classnames';\nimport React, { createContext, memo, useLayoutEffect, useMemo, useRef, useState } from 'react';\nimport ConditionalRender from '@baifendian/adhere-ui-conditionalrender';\nimport Hooks from '@baifendian/adhere-ui-hooks';\nimport Intl from '@baifendian/adhere-util-intl';\nimport Resource from '@baifendian/adhere-util-resource';\nexport var Context = createContext({});\nvar useForceUpdate = Hooks.useForceUpdate;\nvar selectorPrefix = 'adhere-ui-config-provider';\n/**\n * ConfigProvider\n * @constructor\n * @classdesc 全局配置 国际化、字典配置\n */\nvar InternalConfigProvider = memo(function (props) {\n    var _a = props.intl, lang = _a.lang, locales = _a.locales, prefix = _a.prefix, mainLanguage = _a.mainLanguage, theme = props.theme, media = props.media, children = props.children, onIntlInit = props.onIntlInit, _b = props.isUseWrapper, isUseWrapper = _b === void 0 ? true : _b;\n    var wrapperELRef = useRef(null);\n    var _c = useState(false), isIntlInit = _c[0], setIntlInit = _c[1];\n    var providerValue = useMemo(function () { return ({\n        intl: {\n            lang: lang,\n            prefix: prefix,\n            locales: locales !== null && locales !== void 0 ? locales : {},\n        },\n        media: __assign({\n            isUseMedia: false,\n            designWidth: 192,\n        }, (media !== null && media !== void 0 ? media : {})),\n    }); }, [lang, prefix, locales, media]);\n    var forceUpdate = useForceUpdate();\n    var targetChildren = useMemo(function () {\n        var _a, _b;\n        if (isUseWrapper) {\n            return (React.createElement(\"div\", { \n                // @ts-ignore\n                ref: wrapperELRef, className: classNames(selectorPrefix, (_a = props.className) !== null && _a !== void 0 ? _a : ''), style: (_b = props.style) !== null && _b !== void 0 ? _b : {} }, children()));\n        }\n        return children();\n    }, [isUseWrapper, children, props.className, props.style]);\n    function initIntl() {\n        return Intl.init({\n            prefix: prefix || 'local',\n            currentLocale: lang,\n            locales: locales !== null && locales !== void 0 ? locales : {},\n            mainLanguage: mainLanguage || 'zh_CN',\n        }, Intl.isInit());\n    }\n    useUpdateEffect(function () {\n        initIntl().then(function () {\n            Resource.Dict.value.LocalsMoment.value[lang]();\n            forceUpdate();\n        });\n    }, [lang, locales, prefix, mainLanguage]);\n    useLayoutEffect(function () {\n        initIntl().then(function () {\n            Resource.Dict.value.LocalsMoment.value[lang]();\n            setIntlInit(true);\n            if (onIntlInit)\n                onIntlInit();\n        });\n    }, []);\n    useUpdateLayoutEffect(function () {\n        if (isIntlInit && wrapperELRef.current) {\n            // 初始化css变量\n            init(theme, wrapperELRef.current, media);\n        }\n    }, [theme, isIntlInit]);\n    return (React.createElement(ConditionalRender, { conditional: isIntlInit }, function () { return React.createElement(Context.Provider, { value: providerValue }, targetChildren); }));\n});\nvar ConfigProvider = InternalConfigProvider;\nConfigProvider.Context = Context;\nConfigProvider.displayName = 'ConfigProvider';\nexport default ConfigProvider;\n"],"names":["__assign","this","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","init","useUpdateEffect","useUpdateLayoutEffect","classNames","React","createContext","memo","useLayoutEffect","useMemo","useRef","useState","ConditionalRender","Hooks","Intl","Resource","Context","useForceUpdate","selectorPrefix","InternalConfigProvider","props","_a","intl","lang","locales","prefix","mainLanguage","theme","media","children","onIntlInit","_b","isUseWrapper","wrapperELRef","_c","isIntlInit","setIntlInit","providerValue","isUseMedia","designWidth","forceUpdate","targetChildren","createElement","ref","className","style","initIntl","currentLocale","isInit","then","Dict","value","LocalsMoment","current","conditional","Provider","ConfigProvider","displayName"],"mappings":"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"}