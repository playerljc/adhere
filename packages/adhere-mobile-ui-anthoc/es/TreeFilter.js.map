{"version":3,"file":"TreeFilter.js","sources":["TreeFilter.js"],"sourcesContent":["import _ErrorBlock from \"antd-mobile/es/components/error-block\";\nimport _SearchBar from \"antd-mobile/es/components/search-bar\";\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n    return t;\n  };\n  return __assign.apply(this, arguments);\n};\nimport classNames from 'classnames';\nimport React, { useCallback, useMemo, useState } from 'react';\nimport Util from '@baifendian/adhere-util';\nvar selectorPrefix = 'adhere-mobile-ui-ant-hoc-tree-filter';\nexport var treeTransformConfig = {\n  keyAttr: 'value',\n  titleAttr: 'label',\n  parentIdAttr: 'pId',\n  rootParentId: 0\n};\nfunction TreeFilter(_a) {\n  var _b;\n  var treeData = _a.treeData,\n    _c = _a.treeDataSimpleMode,\n    treeDataSimpleMode = _c === void 0 ? false : _c,\n    filterProps = _a.filterProps,\n    wrapperClassName = _a.wrapperClassName,\n    wrapperStyle = _a.wrapperStyle,\n    filterWrapperClassName = _a.filterWrapperClassName,\n    filterWrapperStyle = _a.filterWrapperStyle,\n    bodyWrapperClassName = _a.bodyWrapperClassName,\n    bodyWrapperStyle = _a.bodyWrapperStyle,\n    renderEmpty = _a.renderEmpty,\n    children = _a.children;\n  var _d = useState(''),\n    filterValue = _d[0],\n    setFilterValue = _d[1];\n  function filter(_filterValue, option) {\n    var _a;\n    return option[(_a = filterProps === null || filterProps === void 0 ? void 0 : filterProps.optionFilterProp) !== null && _a !== void 0 ? _a : 'label'].includes(_filterValue);\n  }\n  var flatTreeData = useMemo(function () {\n    return treeDataSimpleMode ? treeData : Util.treeToArray(treeData, {\n      parentIdAttr: treeTransformConfig.parentIdAttr,\n      rootParentId: treeTransformConfig.rootParentId\n    }, treeTransformConfig.keyAttr);\n  }, [treeData, treeDataSimpleMode]);\n  var targetTreeData = useMemo(function () {\n    var _filterFlatTreeData;\n    // 对数据进行筛选\n    if (!filterValue) {\n      _filterFlatTreeData = flatTreeData !== null && flatTreeData !== void 0 ? flatTreeData : [];\n    }\n    // 是bool值\n    else if (typeof (filterProps === null || filterProps === void 0 ? void 0 : filterProps.filterOption) === 'boolean' && filterProps.filterOption) {\n      _filterFlatTreeData = (flatTreeData !== null && flatTreeData !== void 0 ? flatTreeData : []).filter(function (_option) {\n        return filter(filterValue, _option);\n      });\n    }\n    // 是函数\n    else if (Util.isFunction(filterProps === null || filterProps === void 0 ? void 0 : filterProps.filterOption)) {\n      _filterFlatTreeData = (flatTreeData !== null && flatTreeData !== void 0 ? flatTreeData : []).filter(function (_option) {\n        return (filterProps === null || filterProps === void 0 ? void 0 : filterProps.filterOption)(filterValue, _option);\n      });\n    } else {\n      _filterFlatTreeData = (flatTreeData !== null && flatTreeData !== void 0 ? flatTreeData : []).filter(function (_option) {\n        return filter(filterValue, _option);\n      });\n    }\n    // 筛选完补全\n    var fullTreeData = Util.completionIncompleteFlatArr(flatTreeData !== null && flatTreeData !== void 0 ? flatTreeData : [], _filterFlatTreeData, treeTransformConfig);\n    if (treeDataSimpleMode) {\n      return Util.treeToArray(fullTreeData, treeTransformConfig, treeTransformConfig.keyAttr);\n    }\n    return fullTreeData;\n  }, [filterValue, filterProps === null || filterProps === void 0 ? void 0 : filterProps.filterOption, filterProps === null || filterProps === void 0 ? void 0 : filterProps.optionFilterProp, flatTreeData]);\n  var isEmpty = useCallback(function () {\n    return !targetTreeData.length;\n  }, [targetTreeData]);\n  function onSearch(value) {\n    setFilterValue(value);\n  }\n  function onClear() {\n    setFilterValue('');\n  }\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: classNames(selectorPrefix, wrapperClassName !== null && wrapperClassName !== void 0 ? wrapperClassName : ''),\n    style: wrapperStyle !== null && wrapperStyle !== void 0 ? wrapperStyle : {}\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: classNames(\"\".concat(selectorPrefix, \"-search\"), filterWrapperClassName !== null && filterWrapperClassName !== void 0 ? filterWrapperClassName : ''),\n    style: filterWrapperStyle !== null && filterWrapperStyle !== void 0 ? filterWrapperStyle : {}\n  }, /*#__PURE__*/React.createElement(_SearchBar, __assign({\n    onSearch: onSearch,\n    onClear: onClear\n  }, filterProps))), /*#__PURE__*/React.createElement(\"div\", {\n    className: classNames(\"\".concat(selectorPrefix, \"-tree\"), bodyWrapperClassName !== null && bodyWrapperClassName !== void 0 ? bodyWrapperClassName : ''),\n    style: bodyWrapperStyle !== null && bodyWrapperStyle !== void 0 ? bodyWrapperStyle : {}\n  }, isEmpty() && ((_b = renderEmpty === null || renderEmpty === void 0 ? void 0 : renderEmpty()) !== null && _b !== void 0 ? _b : /*#__PURE__*/React.createElement(_ErrorBlock, {\n    status: \"empty\"\n  })), children === null || children === void 0 ? void 0 : children(targetTreeData, filterValue)));\n}\nexport default TreeFilter;"],"names":["_ErrorBlock","_SearchBar","__assign","this","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","classNames","React","useCallback","useMemo","useState","Util","selectorPrefix","treeTransformConfig","keyAttr","titleAttr","parentIdAttr","rootParentId","TreeFilter","_a","treeData","_c","treeDataSimpleMode","filterProps","wrapperClassName","wrapperStyle","filterWrapperClassName","filterWrapperStyle","bodyWrapperClassName","bodyWrapperStyle","renderEmpty","children","_d","filterValue","setFilterValue","filter","_filterValue","option","optionFilterProp","includes","flatTreeData","treeToArray","targetTreeData","_filterFlatTreeData","filterOption","_option","isFunction","fullTreeData","completionIncompleteFlatArr","isEmpty","createElement","className","style","concat","onSearch","value","onClear","_b","status"],"mappings":"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"}