{"version":3,"file":"show.js","sources":["popup/show.js"],"sourcesContent":["var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n    return t;\n  };\n  return __assign.apply(this, arguments);\n};\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\nimport { useMount, useUpdateEffect } from 'ahooks';\nimport { Button, Popup } from 'antd-mobile';\nimport classNames from 'classnames';\nimport React, { useState } from 'react';\nimport ReactDOM from 'react-dom/client';\nvar lock;\nvar popupHandlers = new Map();\nvar selectorPrefix = 'adhere-mobile-ui-ant-hoc-show-popup-inner';\n/**\n * PopupWrapper\n * @param actions\n * @param closeOnAction\n * @param title\n * @param close\n * @param children\n * @param popupProps\n * @constructor\n */\nfunction PopupWrapper(_a) {\n  var actions = _a.actions,\n    _b = _a.closeOnAction,\n    closeOnAction = _b === void 0 ? false : _b,\n    title = _a.title,\n    close = _a.close,\n    children = _a.children,\n    popupProps = __rest(_a, [\"actions\", \"closeOnAction\", \"title\", \"close\", \"children\"]);\n  var _c = popupProps.showCloseButton,\n    showCloseButton = _c === void 0 ? true : _c;\n  var _d = useState(popupProps.visible),\n    visible = _d[0],\n    setVisible = _d[1];\n  useMount(function () {\n    setVisible(true);\n  });\n  useUpdateEffect(function () {\n    setVisible(false);\n  }, [popupProps.visible]);\n  return /*#__PURE__*/React.createElement(Popup, __assign({}, popupProps, {\n    visible: visible,\n    onMaskClick: function onMaskClick(argv) {\n      var _a;\n      setVisible(false);\n      (_a = popupProps === null || popupProps === void 0 ? void 0 : popupProps.onMaskClick) === null || _a === void 0 ? void 0 : _a.call(popupProps, argv);\n    },\n    onClose: function onClose() {\n      var _a;\n      setVisible(false);\n      (_a = popupProps === null || popupProps === void 0 ? void 0 : popupProps.onClose) === null || _a === void 0 ? void 0 : _a.call(popupProps);\n    },\n    afterClose: function afterClose() {\n      var _a;\n      close();\n      (_a = popupProps === null || popupProps === void 0 ? void 0 : popupProps.afterClose) === null || _a === void 0 ? void 0 : _a.call(popupProps);\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: selectorPrefix\n  }, (showCloseButton || !!title) && /*#__PURE__*/React.createElement(\"div\", {\n    className: \"\".concat(selectorPrefix, \"-header\")\n  }, title), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"\".concat(selectorPrefix, \"-body\")\n  }, children), !!(actions === null || actions === void 0 ? void 0 : actions.length) && /*#__PURE__*/React.createElement(\"ul\", {\n    className: \"\".concat(selectorPrefix, \"-actions\")\n  }, actions.map(function (_a) {\n    var key = _a.key,\n      className = _a.className,\n      style = _a.style,\n      text = _a.text,\n      _b = _a.primary,\n      primary = _b === void 0 ? false : _b,\n      _c = _a.disabled,\n      disabled = _c === void 0 ? false : _c,\n      _d = _a.danger,\n      danger = _d === void 0 ? false : _d,\n      _onClick = _a.onClick;\n    return /*#__PURE__*/React.createElement(\"li\", {\n      key: key,\n      className: classNames(\"\".concat(selectorPrefix, \"-action\"), className !== null && className !== void 0 ? className : ''),\n      style: style !== null && style !== void 0 ? style : {}\n    }, /*#__PURE__*/React.createElement(Button, {\n      block: true,\n      loading: \"auto\",\n      color: primary ? 'primary' : danger ? 'danger' : 'default',\n      disabled: disabled,\n      onClick: function onClick() {\n        var result = _onClick === null || _onClick === void 0 ? void 0 : _onClick();\n        if (result && result.then) {\n          result.then(function () {\n            if (closeOnAction) {\n              setVisible(false);\n            }\n          });\n        } else {\n          if (closeOnAction) {\n            setVisible(false);\n          }\n        }\n      }\n    }, text));\n  }))));\n}\n/**\n * show\n * @param {PopupShowProps} props\n * @return PopupShowHandler\n */\nexport function show(props) {\n  if (lock) return;\n  lock = true;\n  function render(visible) {\n    root.render( /*#__PURE__*/React.createElement(PopupWrapper, __assign({\n      visible: visible,\n      getContainer: function getContainer() {\n        return el;\n      },\n      close: close\n    }, popupConfig)));\n  }\n  function close() {\n    render(false);\n    setTimeout(function () {\n      popupHandlers.delete(el);\n      root.unmount();\n      lock = false;\n    }, 300);\n  }\n  var popupConfig = __assign({}, props);\n  var el = document.createElement('div');\n  document.body.appendChild(el);\n  var root = ReactDOM.createRoot(el);\n  render(false);\n  popupHandlers.set(el, root);\n  return {\n    close: close,\n    setConfig: function setConfig(callback) {\n      popupConfig = callback(popupConfig);\n      render(true);\n    }\n  };\n}\n/**\n * clear\n */\nexport function clear() {\n  try {\n    Array.from(popupHandlers.values()).forEach(function (root) {\n      if (root) {\n        root.unmount();\n      }\n    });\n    lock = false;\n    popupHandlers.clear();\n  } catch (e) {\n    console.error(e);\n  }\n}"],"names":["lock","__assign","this","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","__rest","e","indexOf","getOwnPropertySymbols","propertyIsEnumerable","useMount","useUpdateEffect","Button","Popup","classNames","React","useState","ReactDOM","popupHandlers","Map","selectorPrefix","PopupWrapper","_a","actions","_b","closeOnAction","title","close","children","popupProps","_c","showCloseButton","_d","visible","setVisible","createElement","onMaskClick","argv","onClose","afterClose","className","concat","map","key","style","text","primary","disabled","danger","_onClick","onClick","block","loading","color","result","then","show","props","popupConfig","el","root","document","body","appendChild","createRoot","render","set","setConfig","callback","getContainer","setTimeout","delete","unmount","clear","Array","from","values","forEach","console","error"],"mappings":"AAAA,IAuBIA,KAvBAC,SAAWC,MAAQA,KAAKD,UAAY,WAQtC,OAPAA,SAAWE,OAAOC,QAAU,SAAUC,GACpC,IAAK,IAAIC,EAAGC,EAAI,EAAGC,EAAIC,UAAUC,OAAQH,EAAIC,EAAGD,CAAC,GAE/C,IAAK,IAAII,KADTL,EAAIG,UAAUF,GACOJ,OAAOS,UAAUC,eAAeC,KAAKR,EAAGK,CAAC,IAAGN,EAAEM,GAAKL,EAAEK,IAE5E,OAAON,CACT,GACgBU,MAAMb,KAAMO,SAAS,CACvC,EACIO,OAASd,MAAQA,KAAKc,QAAU,SAAUV,EAAGW,GAC/C,IAAIZ,EAAI,GACR,IAASM,KAAKL,EAAOH,OAAOS,UAAUC,eAAeC,KAAKR,EAAGK,CAAC,GAAKM,EAAEC,QAAQP,CAAC,EAAI,IAAGN,EAAEM,GAAKL,EAAEK,IAC9F,GAAS,MAALL,GAAqD,YAAxC,OAAOH,OAAOgB,sBAAsC,IAAK,IAAIZ,EAAI,EAAGI,EAAIR,OAAOgB,sBAAsBb,CAAC,EAAGC,EAAII,EAAED,OAAQH,CAAC,GACnIU,EAAEC,QAAQP,EAAEJ,EAAE,EAAI,GAAKJ,OAAOS,UAAUQ,qBAAqBN,KAAKR,EAAGK,EAAEJ,EAAE,IAAGF,EAAEM,EAAEJ,IAAMD,EAAEK,EAAEJ,KAEhG,OAAOF,CACT,SACSgB,SAAUC,eAA+B,KAAR,gBACjCC,OAAQC,KAA0B,KAAb,qBACvBC,eAAgB,oBAChBC,OAASC,QAAuB,KAAP,eACzBC,aAAc,mBAErB,IAAIC,cAAgB,IAAIC,IACpBC,eAAiB,4CAWrB,SAASC,aAAaC,GACpB,IAAIC,EAAUD,EAAGC,QACfC,EAAKF,EAAGG,cACRA,EAAuB,KAAA,IAAPD,GAAwBA,EACxCE,EAAQJ,EAAGI,MACXC,EAAQL,EAAGK,MACXC,EAAWN,EAAGM,SACdC,EAAaxB,OAAOiB,EAAI,CAAC,UAAW,gBAAiB,QAAS,QAAS,WAAW,EAChFQ,EAAKD,EAAWE,gBAClBA,EAAyB,KAAA,IAAPD,GAAuBA,EACvCE,EAAKhB,SAASa,EAAWI,OAAO,EAClCA,EAAUD,EAAG,GACbE,EAAaF,EAAG,GAOlB,OANAtB,SAAS,WACPwB,EAAW,CAAA,CAAI,CACjB,CAAC,EACDvB,gBAAgB,WACduB,EAAW,CAAA,CAAK,CAClB,EAAG,CAACL,EAAWI,QAAQ,EACHlB,MAAMoB,cAActB,MAAOvB,SAAS,GAAIuC,EAAY,CACtEI,QAASA,EACTG,YAAa,SAAqBC,GAChC,IAAIf,EACJY,EAAW,CAAA,CAAK,EAChB,OAACZ,EAAKO,MAAAA,EAA+C,KAAA,EAASA,EAAWO,cAAkDd,EAAGnB,KAAK0B,EAAYQ,CAAI,CACrJ,EACAC,QAAS,WACP,IAAIhB,EACJY,EAAW,CAAA,CAAK,EAChB,OAACZ,EAAKO,MAAAA,EAA+C,KAAA,EAASA,EAAWS,UAA8ChB,EAAGnB,KAAK0B,CAAU,CAC3I,EACAU,WAAY,WACV,IAAIjB,EACJK,EAAM,EACN,OAACL,EAAKO,MAAAA,EAA+C,KAAA,EAASA,EAAWU,aAAiDjB,EAAGnB,KAAK0B,CAAU,CAC9I,CACF,CAAC,EAAgBd,MAAMoB,cAAc,MAAO,CAC1CK,UAAWpB,cACb,GAAIW,GAAmB,CAAC,CAACL,IAAuBX,MAAMoB,cAAc,MAAO,CACzEK,UAAW,GAAGC,OAAOrB,eAAgB,SAAS,CAChD,EAAGM,CAAK,EAAgBX,MAAMoB,cAAc,MAAO,CACjDK,UAAW,GAAGC,OAAOrB,eAAgB,OAAO,CAC9C,EAAGQ,CAAQ,EAAG,EAAGL,MAAAA,GAAkDA,CAAAA,EAAQxB,SAAwBgB,MAAMoB,cAAc,KAAM,CAC3HK,UAAW,GAAGC,OAAOrB,eAAgB,UAAU,CACjD,EAAGG,EAAQmB,IAAI,SAAUpB,GACvB,IAAIqB,EAAMrB,EAAGqB,IACXH,EAAYlB,EAAGkB,UACfI,EAAQtB,EAAGsB,MACXC,EAAOvB,EAAGuB,KACVrB,EAAKF,EAAGwB,QACRA,EAAiB,KAAA,IAAPtB,GAAwBA,EAClCM,EAAKR,EAAGyB,SACRA,EAAkB,KAAA,IAAPjB,GAAwBA,EACnCE,EAAKV,EAAG0B,OACRA,EAAgB,KAAA,IAAPhB,GAAwBA,EACjCiB,EAAW3B,EAAG4B,QAChB,OAAoBnC,MAAMoB,cAAc,KAAM,CAC5CQ,IAAKA,EACLH,UAAW1B,WAAW,GAAG2B,OAAOrB,eAAgB,SAAS,EAAGoB,MAAAA,EAA6CA,EAAY,EAAE,EACvHI,MAAOA,MAAAA,EAAqCA,EAAQ,EACtD,EAAgB7B,MAAMoB,cAAcvB,OAAQ,CAC1CuC,MAAO,CAAA,EACPC,QAAS,OACTC,MAAOP,EAAU,UAAYE,EAAS,SAAW,UACjDD,SAAUA,EACVG,QAAS,WACP,IAAII,EAASL,MAAAA,EAA2C,KAAA,EAASA,EAAS,EACtEK,GAAUA,EAAOC,KACnBD,EAAOC,KAAK,WACN9B,GACFS,EAAW,CAAA,CAAK,CAEpB,CAAC,EAEGT,GACFS,EAAW,CAAA,CAAK,CAGtB,CACF,EAAGW,CAAI,CAAC,CACV,CAAC,CAAC,CAAC,CAAC,CACN,CAMO,SAASW,KAAKC,GACnB,IAmBIC,EACAC,EAEAC,EAtBJ,GAAIvE,CAAAA,KAyBJ,OAxBAA,KAAO,CAAA,EAkBHqE,EAAcpE,SAAS,GAAImE,CAAK,EAChCE,EAAKE,SAAS1B,cAAc,KAAK,EACrC0B,SAASC,KAAKC,YAAYJ,CAAE,EACxBC,EAAO3C,SAAS+C,WAAWL,CAAE,EACjCM,EAAO,CAAA,CAAK,EACZ/C,cAAcgD,IAAIP,EAAIC,CAAI,EACnB,CACLjC,MAAOA,EACPwC,UAAW,SAAmBC,GAC5BV,EAAcU,EAASV,CAAW,EAClCO,EAAO,CAAA,CAAI,CACb,CACF,EA7BA,SAASA,EAAOhC,GACd2B,EAAKK,OAAqBlD,MAAMoB,cAAcd,aAAc/B,SAAS,CACnE2C,QAASA,EACToC,aAAc,WACZ,OAAOV,CACT,EACAhC,MAAOA,CACT,EAAG+B,CAAW,CAAC,CAAC,CAClB,CACA,SAAS/B,IACPsC,EAAO,CAAA,CAAK,EACZK,WAAW,WACTpD,cAAcqD,OAAOZ,CAAE,EACvBC,EAAKY,QAAQ,EACbnF,KAAO,CAAA,CACT,EAAG,GAAG,CACR,CAcF,CAIO,SAASoF,QACd,IACEC,MAAMC,KAAKzD,cAAc0D,OAAO,CAAC,EAAEC,QAAQ,SAAUjB,GAC/CA,GACFA,EAAKY,QAAQ,CAEjB,CAAC,EACDnF,KAAO,CAAA,EACP6B,cAAcuD,MAAM,CAGtB,CAFE,MAAOnE,GACPwE,QAAQC,MAAMzE,CAAC,CACjB,CACF,QAjDgBkD,KAqCAiB,KAYhB"}