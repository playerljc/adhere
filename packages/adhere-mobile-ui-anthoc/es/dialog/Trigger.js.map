{"version":3,"file":"Trigger.js","sources":["dialog/Trigger.js"],"sourcesContent":["import _Dialog from \"antd-mobile/es/components/dialog\";\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n    return t;\n  };\n  return __assign.apply(this, arguments);\n};\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\nimport classNames from 'classnames';\nimport React, { memo, useCallback, useMemo, useRef, useState } from 'react';\nimport { createPortal } from 'react-dom';\nimport Intl from '@baifendian/adhere-util-intl';\nimport PopoverTrigger from '../PopoverTrigger';\nimport { ValueHOC } from '../util';\nimport Context from './Context';\nvar selectorPrefix = 'adhere-mobile-ui-ant-hoc-dialog-trigger';\n/**\n * InternalDialogTrigger\n */\nvar InternalDialogTrigger = /*#__PURE__*/memo(function (_a) {\n  var _b, _c, _d;\n  var _e = _a.showCloseButton,\n    showCloseButton = _e === void 0 ? true : _e,\n    closeActionText = _a.closeActionText,\n    closeActionKey = _a.closeActionKey,\n    value = _a.value,\n    _f = _a.disabled,\n    disabled = _f === void 0 ? false : _f,\n    onChange = _a.onChange,\n    actions = _a.actions,\n    children = _a.children,\n    popoverTriggerProps = _a.popoverTriggerProps,\n    dialogProps = __rest(_a, [\"showCloseButton\", \"closeActionText\", \"closeActionKey\", \"value\", \"disabled\", \"onChange\", \"actions\", \"children\", \"popoverTriggerProps\"]);\n  var _g = useState(false),\n    visible = _g[0],\n    setVisible = _g[1];\n  var valueHOCRef = useRef();\n  /**\n   * onConfirm\n   * @param onClick\n   */\n  function onConfirm(onClick) {\n    var _a;\n    (_a = onClick === null || onClick === void 0 ? void 0 : onClick()) === null || _a === void 0 ? void 0 : _a.then(function (result) {\n      var _a;\n      close();\n      onChange === null || onChange === void 0 ? void 0 : onChange(result !== undefined ? result === null ? undefined : result : (_a = valueHOCRef.current) === null || _a === void 0 ? void 0 : _a.getValue());\n    });\n  }\n  var targetActions = useMemo(function () {\n    var result = (actions !== null && actions !== void 0 ? actions : []).map(function (_action) {\n      return __assign(__assign({}, _action), {\n        onClick: function onClick() {\n          return onConfirm(_action.onClick);\n        }\n      });\n    });\n    if (showCloseButton) {\n      result.push({\n        key: closeActionKey !== null && closeActionKey !== void 0 ? closeActionKey : 'close',\n        text: closeActionText !== null && closeActionText !== void 0 ? closeActionText : Intl.v('关闭'),\n        onClick: function onClick() {}\n      });\n    }\n    return result;\n  }, [actions, showCloseButton]);\n  var targetDialogProps = useMemo(function () {\n    return __assign(__assign({\n      visible: visible,\n      destroyOnClose: true,\n      closeOnMaskClick: true,\n      closeOnAction: showCloseButton\n    }, dialogProps), {\n      actions: targetActions,\n      content: children && /*#__PURE__*/React.createElement(ValueHOC, {\n        className: \"\".concat(selectorPrefix, \"-value-hoc\"),\n        // @ts-ignore\n        ref: valueHOCRef,\n        defaultFormItemValue: value\n      }, children),\n      afterClose: function afterClose() {\n        var _a;\n        (_a = dialogProps === null || dialogProps === void 0 ? void 0 : dialogProps.afterClose) === null || _a === void 0 ? void 0 : _a.call(dialogProps);\n      },\n      onClose: function onClose() {\n        var _a;\n        close();\n        (_a = dialogProps === null || dialogProps === void 0 ? void 0 : dialogProps.onClose) === null || _a === void 0 ? void 0 : _a.call(dialogProps);\n      }\n    });\n  }, [dialogProps, targetActions, children, value, onChange, visible]);\n  /**\n   * renderPopover\n   */\n  var renderPopover = useCallback(function () {\n    setVisible(true);\n  }, [targetDialogProps]);\n  function close() {\n    setVisible(false);\n  }\n  return /*#__PURE__*/React.createElement(Context.Provider, {\n    value: {\n      close: close\n    }\n  }, /*#__PURE__*/createPortal( /*#__PURE__*/React.createElement(_Dialog, __assign({}, targetDialogProps, {\n    bodyClassName: classNames(\"\".concat(selectorPrefix, \"-modal-body\"), targetDialogProps.bodyClassName)\n  })),\n  // @ts-ignore\n  (_c = (_b = targetDialogProps === null || targetDialogProps === void 0 ? void 0 : targetDialogProps.getContainer) === null || _b === void 0 ? void 0 : _b.call(targetDialogProps)) !== null && _c !== void 0 ? _c : document.body), /*#__PURE__*/React.createElement(PopoverTrigger, __assign({\n    className: classNames(selectorPrefix, (_d = popoverTriggerProps === null || popoverTriggerProps === void 0 ? void 0 : popoverTriggerProps.className) !== null && _d !== void 0 ? _d : ''),\n    value: value,\n    renderPopover: renderPopover,\n    disabled: disabled !== null && disabled !== void 0 ? disabled : false\n  }, popoverTriggerProps !== null && popoverTriggerProps !== void 0 ? popoverTriggerProps : {})));\n});\nvar DialogTrigger = InternalDialogTrigger;\nDialogTrigger.displayName = 'DialogTrigger';\nexport default DialogTrigger;"],"names":["_Dialog","__assign","this","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","__rest","e","indexOf","getOwnPropertySymbols","propertyIsEnumerable","classNames","React","memo","useCallback","useMemo","useRef","useState","createPortal","Intl","PopoverTrigger","ValueHOC","Context","selectorPrefix","InternalDialogTrigger","_a","_c","_e","showCloseButton","closeActionText","closeActionKey","value","_f","disabled","onChange","actions","children","popoverTriggerProps","dialogProps","_g","visible","setVisible","valueHOCRef","targetActions","result","map","_action","onClick","then","close","undefined","current","getValue","push","key","text","v","targetDialogProps","destroyOnClose","closeOnMaskClick","closeOnAction","content","createElement","className","concat","ref","defaultFormItemValue","afterClose","onClose","renderPopover","Provider","bodyClassName","_b","getContainer","document","body","_d","DialogTrigger","displayName"],"mappings":"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"}