var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var n,o=1,r=arguments.length;o<r;o++)for(var t in n=arguments[o])Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t]);return e}).apply(this,arguments)},__rest=this&&this.__rest||function(e,n){var o={};for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&n.indexOf(t)<0&&(o[t]=e[t]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,t=Object.getOwnPropertySymbols(e);r<t.length;r++)n.indexOf(t[r])<0&&Object.prototype.propertyIsEnumerable.call(e,t[r])&&(o[t[r]]=e[t[r]]);return o};import{useUpdateEffect}from"ahooks";import{Dialog}from"antd-mobile";import classNames from"classnames";import React,{cloneElement,memo,useCallback,useMemo,useRef}from"react";import Intl from"@baifendian/adhere-util-intl";import PopoverTrigger from"../PopoverTrigger";var selectorPrefix="adhere-mobile-ui-ant-hoc-dialog-trigger",InternalDialogTrigger=memo(function(e){var n,o=e.showCloseButton,r=void 0===o||o,t=e.closeActionText,l=e.closeActionKey,i=e.value,a=e.onChange,s=e.actions,c=e.children,o=e.popoverTriggerProps,u=__rest(e,["showCloseButton","closeActionText","closeActionKey","value","onChange","actions","children","popoverTriggerProps"]),g=useRef(null);var p=useMemo(function(){var e=(null!=s?s:[]).map(function(r){return __assign(__assign({},r),{onClick:function(){var e,n,o;n=r.onClick,o=null==(e=g.current)?void 0:e.close,null!=(n=null==n?void 0:n())&&n.then(function(e){null!=a&&a(e),setTimeout(function(){o()},300)})}})});return r&&e.push({key:null!=l?l:"close",text:null!=t?t:Intl.v("关闭"),onClick:function(){}}),e},[s,r]),f=useMemo(function(){return __assign(__assign({closeOnMaskClick:!0,closeOnAction:r},u),{actions:p,content:c&&cloneElement(c,__assign(__assign({},c.props),{value:i}),c.props.children),afterClose:function(){var e;(g.current=null)!=(e=null==u?void 0:u.afterClose)&&e.call(u)}})},[u,p,c,i]),e=useCallback(function(){g.current=Dialog.show(f)},[f]);return useUpdateEffect(function(){g.current&&g.current.replace(React.createElement(Dialog,__assign({},f)))},[u]),React.createElement(PopoverTrigger,__assign({className:classNames(selectorPrefix,null!=(n=null==o?void 0:o.className)?n:""),renderPopover:e},null!=o?o:{}))}),DialogTrigger=InternalDialogTrigger;DialogTrigger.displayName="DialogTrigger";export default DialogTrigger;
//# sourceMappingURL=Trigger.js.map
