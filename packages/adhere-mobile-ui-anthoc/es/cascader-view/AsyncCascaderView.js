var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var a in n=arguments[t])Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a]);return e}).apply(this,arguments)},__rest=this&&this.__rest||function(e,n){var t={};for(a in e)Object.prototype.hasOwnProperty.call(e,a)&&n.indexOf(a)<0&&(t[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,a=Object.getOwnPropertySymbols(e);r<a.length;r++)n.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(t[a[r]]=e[a[r]]);return t};import{useMount,useUpdateEffect}from"ahooks";import difference from"lodash.difference";import React,{memo,useMemo,useRef,useState}from"react";import{useImmer}from"use-immer";import Util from"@baifendian/adhere-util";import{treeTransformConfig}from"../TreeFilter";import InternalCascaderView from"./InternalCascaderView";var InternalAsyncCascader=memo(function(e){var l=e.loadData,n=e.onDataSourceChange,t=e.isEveryAsync,i=void 0!==t&&t,u=__rest(e,["loadData","onDataSourceChange","isEveryAsync"]),t=useImmer([]),r=t[0],c=t[1],e=useState(!1),t=e[0],s=e[1],f=useRef(null!=(e=u.value)?e:u.defaultValue),d=useMemo(function(){return u.treeDataSimpleMode?r:Util.treeToArray(null!=r?r:[],treeTransformConfig)},[r,u.treeDataSimpleMode]);function p(e,a){return u.treeDataSimpleMode?e.find(function(e){return e.value===a}):function e(n){for(var t=0;t<n.length;t++){var r=n[t];if(r.value===a)return r;if(r.children&&(r=e(r.children)))return r}}(e)}function m(a,e){var o=[];!function e(n){for(var t=0;t<a.length;t++){var r=a[t];r.pId===n&&(o.push(t),e(r.value))}}(e),o.forEach(function(e){a.splice(e,1)})}return useUpdateEffect(function(){c(u.options)},[u.options]),useUpdateEffect(function(){var e;f.current=null!=(e=u.value)?e:u.defaultValue},[u.defaultValue,u.value]),useUpdateEffect(function(){null!=n&&n(r)},[r]),useMount(function(){var e;null!=(e=null==l?void 0:l(void 0))&&e.then(function(e){c(e)})}),React.createElement(InternalCascaderView,__assign({loading:t},u,{onChange:function(n,t){var e,r,a,o=difference(n,f.current);o.length<=0?(f.current=n,null!=(e=null==u?void 0:u.onChange)&&e.call(u,n,t)):(r=d.find(function(e){return e.value===o[0]}))?(f.current=n,(a=!i&&r.isLoaded?a:null==l?void 0:l(r.value))?(s(!0),a.then(function(t){s(!1),c(function(e){var n=p(e,r.value);n&&(n.isLoaded=!0,u.treeDataSimpleMode?(m(e,n.value),e.push.apply(e,t.map(function(e){return __assign(__assign({},e),{pId:n.value})}))):n.children=t)})}).catch(function(){s(!1)}).finally(function(){var e;null!=(e=null==u?void 0:u.onChange)&&e.call(u,n,t)})):null!=(e=null==u?void 0:u.onChange)&&e.call(u,n,t)):(f.current=n,null!=(a=null==u?void 0:u.onChange)&&a.call(u,n,t))},options:r}))}),AsyncCascaderView=InternalAsyncCascader;AsyncCascaderView.displayName="AsyncCascaderView";export default AsyncCascaderView;
//# sourceMappingURL=AsyncCascaderView.js.map
