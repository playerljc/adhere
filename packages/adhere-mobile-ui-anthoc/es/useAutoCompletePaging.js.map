{"version":3,"file":"useAutoCompletePaging.js","sources":["useAutoCompletePaging.js"],"sourcesContent":["import { useUpdateEffect } from 'ahooks';\nimport { useCallback, useMemo, useRef, useState } from 'react';\nimport { DEFAULT_LIMIT } from './Paging';\n/**\n * UseAutoCompletePaging\n * @description 适配 AutoComplete 的 props\n * @param defaultSearchDataSource\n * @param pagingComponentProps\n * @param loadData\n * @param onDataSourceChange\n * @constructor\n */\nfunction UseAutoCompletePaging(_a) {\n  var _b;\n  var defaultSearchDataSource = _a.defaultSearchDataSource,\n    pagingComponentProps = _a.pagingComponentProps,\n    loadData = _a.loadData,\n    onDataSourceChange = _a.onDataSourceChange;\n  // 是否是第一次加载\n  var isFirst = useRef(false);\n  // 查询关键字\n  var kw = useRef(undefined);\n  // 查询数据\n  var _c = useState({\n      data: defaultSearchDataSource !== null && defaultSearchDataSource !== void 0 ? defaultSearchDataSource : [],\n      total: (defaultSearchDataSource !== null && defaultSearchDataSource !== void 0 ? defaultSearchDataSource : []).length\n    }),\n    searchDataSource = _c[0],\n    setSearchDataSource = _c[1];\n  // 是否是本地分页\n  var isLocal = useMemo(function () {\n    var _a;\n    return 'isLocal' in (pagingComponentProps === null || pagingComponentProps === void 0 ? void 0 : pagingComponentProps.pagingProps) ? (_a = pagingComponentProps === null || pagingComponentProps === void 0 ? void 0 : pagingComponentProps.pagingProps) === null || _a === void 0 ? void 0 : _a.isLocal : true;\n  }, [(_b = pagingComponentProps === null || pagingComponentProps === void 0 ? void 0 : pagingComponentProps.pagingProps) === null || _b === void 0 ? void 0 : _b.isLocal]);\n  // 适配 AutoComplete 的 props\n  var targetPagingComponentProps = useMemo(function () {\n    var result = pagingComponentProps;\n    // 如果不是本地分页，就不需要加载数据\n    if (!isLocal) {\n      result.pagingProps.onLoad = function (_page, _limit) {\n        return new Promise(function (resolve) {\n          var _a, _b;\n          if (isFirst.current) {\n            isFirst.current = false;\n            resolve(searchDataSource);\n            return;\n          }\n          (_b = (_a = loadData === null || loadData === void 0 ? void 0 : loadData(kw.current, _page, _limit)) === null || _a === void 0 ? void 0 : _a.then) === null || _b === void 0 ? void 0 : _b.call(_a, function (_pagingData) {\n            onDataSourceChange === null || onDataSourceChange === void 0 ? void 0 : onDataSourceChange(kw.current, _pagingData.data);\n            resolve(_pagingData);\n          });\n        });\n      };\n    }\n    return result;\n  }, [pagingComponentProps, isLocal, searchDataSource, loadData]);\n  // AutoCompleteLoadData\n  var autoCompleteLoadData = useCallback(function (_kw) {\n    var _a, _b, _c, _d, _e;\n    isFirst.current = true;\n    kw.current = _kw;\n    var params = [_kw, undefined, undefined];\n    if (!isLocal) {\n      params.push(1, (_c = (_b = (_a = pagingComponentProps === null || pagingComponentProps === void 0 ? void 0 : pagingComponentProps.pagingProps) === null || _a === void 0 ? void 0 : _a.defaultPaging) === null || _b === void 0 ? void 0 : _b.limit) !== null && _c !== void 0 ? _c : DEFAULT_LIMIT);\n    }\n    // @ts-ignore\n    return (_e = (_d = loadData === null || loadData === void 0 ? void 0 : loadData.apply(void 0, params.filter(function (t) {\n      return !!t;\n    }))) === null || _d === void 0 ? void 0 : _d.then) === null || _e === void 0 ? void 0 : _e.call(_d, function (_pagingData) {\n      setSearchDataSource(_pagingData);\n      onDataSourceChange === null || onDataSourceChange === void 0 ? void 0 : onDataSourceChange(1, _pagingData.data);\n      return _pagingData;\n    });\n  }, [isLocal, loadData, pagingComponentProps]);\n  useUpdateEffect(function () {\n    setSearchDataSource({\n      data: defaultSearchDataSource !== null && defaultSearchDataSource !== void 0 ? defaultSearchDataSource : [],\n      total: (defaultSearchDataSource !== null && defaultSearchDataSource !== void 0 ? defaultSearchDataSource : []).length\n    });\n  }, [defaultSearchDataSource]);\n  return {\n    searchDataSource: searchDataSource,\n    targetPagingComponentProps: targetPagingComponentProps,\n    autoCompleteLoadData: autoCompleteLoadData\n  };\n}\nexport default UseAutoCompletePaging;"],"names":["useUpdateEffect","useCallback","useMemo","useRef","useState","DEFAULT_LIMIT","UseAutoCompletePaging","_a","defaultSearchDataSource","pagingComponentProps","loadData","onDataSourceChange","isFirst","kw","undefined","_c","data","total","length","searchDataSource","setSearchDataSource","isLocal","pagingProps","_b","targetPagingComponentProps","result","onLoad","_page","_limit","Promise","resolve","current","then","call","_pagingData","autoCompleteLoadData","_kw","_d","params","push","defaultPaging","limit","_e","apply","filter","t"],"mappings":"OAASA,eAA+B,KAAR,gBACvBC,YAAaC,QAASC,OAAQC,QAAuB,KAAP,eAC9CC,aAA+B,KAAV,WAU9B,SAASC,sBAAsBC,GAC7B,IACIC,EAA0BD,EAAGC,wBAC/BC,EAAuBF,EAAGE,qBAC1BC,EAAWH,EAAGG,SACdC,EAAqBJ,EAAGI,mBAEtBC,EAAUT,OAAO,CAAA,CAAK,EAEtBU,EAAKV,OAAOW,KAAAA,CAAS,EAErBC,EAAKX,SAAS,CACdY,KAAMR,MAAAA,EAAyEA,EAA0B,GACzGS,OAAQT,MAAAA,EAAyEA,EAA0B,IAAIU,MACjH,CAAC,EACDC,EAAmBJ,EAAG,GACtBK,EAAsBL,EAAG,GAEvBM,EAAUnB,QAAQ,WACpB,IAAIK,EACJ,MAAO,EAAA,YAAcE,MAAAA,EAAmE,KAAA,EAASA,EAAqBa,gBAAe,OAACf,EAAKE,MAAAA,EAAmE,KAAA,EAASA,EAAqBa,aAAyC,KAAA,EAASf,EAAGc,QACnS,EAAG,CAAC,OAACE,EAAKd,MAAAA,EAAmE,KAAA,EAASA,EAAqBa,aAAyC,KAAA,EAASC,EAAGF,QAAQ,EAEpKG,EAA6BtB,QAAQ,WACvC,IAAIuB,EAAShB,EAkBb,OAhBKY,IACHI,EAAOH,YAAYI,OAAS,SAAUC,EAAOC,GAC3C,OAAO,IAAIC,QAAQ,SAAUC,GAC3B,IAAIvB,EAAIgB,EACJX,EAAQmB,SACVnB,EAAQmB,QAAU,CAAA,EAClBD,EAAQX,CAAgB,GAG1B,OAACI,EAAK,OAAChB,EAAKG,MAAAA,EAA2C,KAAA,EAASA,EAASG,EAAGkB,QAASJ,EAAOC,CAAM,GAA+B,KAAA,EAASrB,EAAGyB,OAA2CT,EAAGU,KAAK1B,EAAI,SAAU2B,GAC5MvB,MAAAA,GAAwEA,EAAmBE,EAAGkB,QAASG,EAAYlB,IAAI,EACvHc,EAAQI,CAAW,CACrB,CAAC,CACH,CAAC,CACH,GAEKT,CACT,EAAG,CAAChB,EAAsBY,EAASF,EAAkBT,EAAS,EAE1DyB,EAAuBlC,YAAY,SAAUmC,GAE/CxB,EAAQmB,QAAU,CAAA,EADlB,IAAgBM,EAGZC,EAAS,CADbzB,EAAGkB,QAAUK,EACMtB,KAAAA,EAAWA,KAAAA,GAK9B,OAJKO,GACHiB,EAAOC,KAAK,EAAG,OAACxB,EAAK,OAACQ,EAAK,OAAChB,EAAKE,MAAAA,EAAmE,KAAA,EAASA,EAAqBa,aAAyC,KAAA,EAASf,EAAGiC,eAA2C,KAAA,EAASjB,EAAGkB,OAAmC1B,EAAKV,aAAa,EAG9R,OAACqC,EAAK,OAACL,EAAK3B,MAAAA,EAA2C,KAAA,EAASA,EAASiC,MAAM,KAAA,EAAQL,EAAOM,OAAO,SAAUC,GACpH,MAAO,CAAC,CAACA,CACX,CAAC,CAAC,GAA+B,KAAA,EAASR,EAAGL,MAAkC,KAAA,EAASU,EAAGT,KAAKI,EAAI,SAAUH,GAG5G,OAFAd,EAAoBc,CAAW,EAC/BvB,MAAAA,GAAwEA,EAAmB,EAAGuB,EAAYlB,IAAI,EACvGkB,CACT,CAAC,CACH,EAAG,CAACb,EAASX,EAAUD,EAAqB,EAO5C,OANAT,gBAAgB,WACdoB,EAAoB,CAClBJ,KAAMR,MAAAA,EAAyEA,EAA0B,GACzGS,OAAQT,MAAAA,EAAyEA,EAA0B,IAAIU,MACjH,CAAC,CACH,EAAG,CAACV,EAAwB,EACrB,CACLW,iBAAkBA,EAClBK,2BAA4BA,EAC5BW,qBAAsBA,CACxB,CACF,gBACe7B"}