{"version":3,"file":"show.js","sources":["popup/show.js"],"sourcesContent":["\"use strict\";\n\nvar __assign = void 0 && (void 0).__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n    return t;\n  };\n  return __assign.apply(this, arguments);\n};\nvar __createBinding = void 0 && (void 0).__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n    desc = {\n      enumerable: true,\n      get: function get() {\n        return m[k];\n      }\n    };\n  }\n  Object.defineProperty(o, k2, desc);\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\nvar __setModuleDefault = void 0 && (void 0).__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\nvar __importStar = void 0 && (void 0).__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  __setModuleDefault(result, mod);\n  return result;\n};\nvar __rest = void 0 && (void 0).__rest || function (s, e) {\n  var t = {};\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\nvar __importDefault = void 0 && (void 0).__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.clear = exports.show = void 0;\nvar ahooks_1 = require(\"ahooks\");\nvar antd_mobile_1 = require(\"antd-mobile\");\nvar classnames_1 = __importDefault(require(\"classnames\"));\nvar react_1 = __importStar(require(\"react\"));\nvar client_1 = __importDefault(require(\"react-dom/client\"));\nvar lock;\nvar popupHandlers = new Map();\nvar selectorPrefix = 'adhere-mobile-ui-ant-hoc-show-popup-inner';\n/**\n * PopupWrapper\n * @param actions\n * @param closeOnAction\n * @param title\n * @param header\n * @param close\n * @param children\n * @param popupProps\n * @constructor\n */\nfunction PopupWrapper(_a) {\n  var actions = _a.actions,\n    _b = _a.closeOnAction,\n    closeOnAction = _b === void 0 ? false : _b,\n    title = _a.title,\n    header = _a.header,\n    close = _a.close,\n    children = _a.children,\n    popupProps = __rest(_a, [\"actions\", \"closeOnAction\", \"title\", \"header\", \"close\", \"children\"]);\n  var _c = popupProps.showCloseButton,\n    showCloseButton = _c === void 0 ? true : _c;\n  var _d = (0, react_1.useState)(popupProps.visible),\n    visible = _d[0],\n    setVisible = _d[1];\n  (0, ahooks_1.useMount)(function () {\n    setVisible(true);\n  });\n  (0, ahooks_1.useUpdateEffect)(function () {\n    setVisible(false);\n  }, [popupProps.visible]);\n  return react_1.default.createElement(antd_mobile_1.Popup, __assign({}, popupProps, {\n    visible: visible,\n    onMaskClick: function onMaskClick(argv) {\n      var _a;\n      setVisible(false);\n      (_a = popupProps === null || popupProps === void 0 ? void 0 : popupProps.onMaskClick) === null || _a === void 0 ? void 0 : _a.call(popupProps, argv);\n    },\n    onClose: function onClose() {\n      var _a;\n      setVisible(false);\n      (_a = popupProps === null || popupProps === void 0 ? void 0 : popupProps.onClose) === null || _a === void 0 ? void 0 : _a.call(popupProps);\n    },\n    afterClose: function afterClose() {\n      var _a;\n      close();\n      (_a = popupProps === null || popupProps === void 0 ? void 0 : popupProps.afterClose) === null || _a === void 0 ? void 0 : _a.call(popupProps);\n    }\n  }), react_1.default.createElement(\"div\", {\n    className: selectorPrefix\n  }, (showCloseButton || !!title) && react_1.default.createElement(\"div\", {\n    className: \"\".concat(selectorPrefix, \"-title\")\n  }, title), !!header && react_1.default.createElement(\"div\", {\n    className: \"\".concat(selectorPrefix, \"-header\")\n  }, header), react_1.default.createElement(\"div\", {\n    className: \"\".concat(selectorPrefix, \"-body\")\n  }, children), !!(actions === null || actions === void 0 ? void 0 : actions.length) && react_1.default.createElement(\"ul\", {\n    className: \"\".concat(selectorPrefix, \"-actions\")\n  }, actions.map(function (_a) {\n    var key = _a.key,\n      className = _a.className,\n      style = _a.style,\n      text = _a.text,\n      _b = _a.primary,\n      primary = _b === void 0 ? false : _b,\n      _c = _a.disabled,\n      disabled = _c === void 0 ? false : _c,\n      _d = _a.danger,\n      danger = _d === void 0 ? false : _d,\n      _onClick = _a.onClick;\n    return react_1.default.createElement(\"li\", {\n      key: key,\n      className: (0, classnames_1.default)(\"\".concat(selectorPrefix, \"-action\"), className !== null && className !== void 0 ? className : ''),\n      style: style !== null && style !== void 0 ? style : {}\n    }, react_1.default.createElement(antd_mobile_1.Button, {\n      block: true,\n      loading: \"auto\",\n      color: danger ? 'danger' : 'primary',\n      fill: primary ? 'solid' : 'none',\n      disabled: disabled,\n      onClick: function onClick() {\n        var result = _onClick === null || _onClick === void 0 ? void 0 : _onClick();\n        if (result && result.then) {\n          result.then(function () {\n            if (closeOnAction) {\n              setVisible(false);\n            }\n          });\n        } else {\n          if (closeOnAction) {\n            setVisible(false);\n          }\n        }\n      }\n    }, text));\n  }))));\n}\n/**\n * show\n * @param {PopupShowProps} props\n * @return PopupShowHandler\n */\nfunction show(props) {\n  if (lock) return;\n  lock = true;\n  function render(visible) {\n    root.render(react_1.default.createElement(PopupWrapper, __assign({\n      visible: visible,\n      getContainer: function getContainer() {\n        return el;\n      },\n      close: close\n    }, popupConfig)));\n  }\n  function close() {\n    render(false);\n    setTimeout(function () {\n      popupHandlers.delete(el);\n      root.unmount();\n      lock = false;\n    }, 300);\n  }\n  var popupConfig = __assign({}, props);\n  var el = document.createElement('div');\n  document.body.appendChild(el);\n  var root = client_1.default.createRoot(el);\n  render(false);\n  popupHandlers.set(el, root);\n  return {\n    close: close,\n    setConfig: function setConfig(callback) {\n      popupConfig = callback(popupConfig);\n      render(true);\n    }\n  };\n}\nexports.show = show;\n/**\n * clear\n */\nfunction clear() {\n  try {\n    Array.from(popupHandlers.values()).forEach(function (root) {\n      if (root) {\n        root.unmount();\n      }\n    });\n    lock = false;\n    popupHandlers.clear();\n  } catch (e) {\n    console.error(e);\n  }\n}\nexports.clear = clear;"],"names":["lock","__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","this","__createBinding","create","o","m","k","k2","undefined","desc","getOwnPropertyDescriptor","__esModule","writable","configurable","enumerable","get","defineProperty","__setModuleDefault","v","value","__importStar","mod","result","__rest","e","indexOf","getOwnPropertySymbols","propertyIsEnumerable","__importDefault","default","ahooks_1","exports","clear","show","require","antd_mobile_1","classnames_1","react_1","client_1","popupHandlers","Map","selectorPrefix","PopupWrapper","_a","actions","_b","closeOnAction","title","header","close","children","popupProps","_c","showCloseButton","_d","useState","visible","setVisible","useMount","useUpdateEffect","createElement","Popup","onMaskClick","argv","onClose","afterClose","className","concat","map","key","style","text","primary","disabled","danger","_onClick","onClick","Button","block","loading","color","fill","then","props","popupConfig","el","root","document","body","appendChild","createRoot","render","set","setConfig","callback","getContainer","setTimeout","delete","unmount","Array","from","values","forEach","console","error"],"mappings":"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"}