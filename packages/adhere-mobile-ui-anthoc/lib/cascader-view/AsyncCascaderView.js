"use strict";var __assign=function(){return(__assign=Object.assign||function(e){for(var r,t=1,n=arguments.length;t<n;t++)for(var a in r=arguments[t])Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a]);return e}).apply(this,arguments)},__createBinding=Object.create?function(e,r,t,n){void 0===n&&(n=t);var a=Object.getOwnPropertyDescriptor(r,t);a&&("get"in a?r.__esModule:!a.writable&&!a.configurable)||(a={enumerable:!0,get:function(){return r[t]}}),Object.defineProperty(e,n,a)}:function(e,r,t,n){e[n=void 0===n?t:n]=r[t]},__setModuleDefault=Object.create?function(e,r){Object.defineProperty(e,"default",{enumerable:!0,value:r})}:function(e,r){e.default=r},__importStar=function(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)"default"!==t&&Object.prototype.hasOwnProperty.call(e,t)&&__createBinding(r,e,t);return __setModuleDefault(r,e),r},__rest=function(e,r){var t={};for(a in e)Object.prototype.hasOwnProperty.call(e,a)&&r.indexOf(a)<0&&(t[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var n=0,a=Object.getOwnPropertySymbols(e);n<a.length;n++)r.indexOf(a[n])<0&&Object.prototype.propertyIsEnumerable.call(e,a[n])&&(t[a[n]]=e[a[n]]);return t},__importDefault=function(e){return e&&e.__esModule?e:{default:e}},ahooks_1=(Object.defineProperty(exports,"__esModule",{value:!0}),require("ahooks")),difference_1=__importDefault(require("lodash/difference")),react_1=__importStar(require("react")),use_immer_1=require("use-immer"),adhere_util_1=__importDefault(require("@baifendian/adhere-util")),TreeFilter_1=require("../TreeFilter"),InternalCascaderView_1=__importDefault(require("./InternalCascaderView")),InternalAsyncCascader=(0,react_1.memo)(function(e){var l=e.loadData,r=e.onDataSourceChange,t=e.isEveryAsync,o=void 0!==t&&t,i=__rest(e,["loadData","onDataSourceChange","isEveryAsync"]),t=(0,use_immer_1.useImmer)(i.options),n=t[0],c=t[1],e=(0,react_1.useState)(!1),t=e[0],f=e[1],s=(0,react_1.useRef)(null!=(e=i.value)?e:i.defaultValue),d=(0,react_1.useMemo)(function(){return i.treeDataSimpleMode?n:adhere_util_1.default.treeToArray(null!=n?n:[],TreeFilter_1.treeTransformConfig)},[n,i.treeDataSimpleMode]);function _(e,a){return i.treeDataSimpleMode?e.find(function(e){return e.value===a}):function e(r){for(var t=0;t<r.length;t++){var n=r[t];if(n.value===a)return n;if(n.children&&(n=e(n.children)))return n}}(e)}function p(a,e){var u=[];!function e(r){for(var t=0;t<a.length;t++){var n=a[t];n.pId===r&&(u.push(t),e(n.value))}}(e),u.forEach(function(e){a.splice(e,1)})}return(0,ahooks_1.useUpdateEffect)(function(){c(i.options)},[i.options]),(0,ahooks_1.useUpdateEffect)(function(){var e;s.current=null!=(e=i.value)?e:i.defaultValue},[i.defaultValue,i.value]),(0,ahooks_1.useUpdateEffect)(function(){null!=r&&r(n)},[n]),react_1.default.createElement(InternalCascaderView_1.default,__assign({loading:t},i,{onChange:function(r,t){var e,n,a,u=(0,difference_1.default)(r,s.current);u.length<=0?(s.current=r,null!=(e=null==i?void 0:i.onChange)&&e.call(i,r,t)):(n=d.find(function(e){return e.value===u[0]}))?(s.current=r,(a=!o&&n.isLoaded?a:null==l?void 0:l(n.value))?(f(!0),a.then(function(t){f(!1),c(function(e){var r=_(e,n.value);r&&(r.isLoaded=!0,i.treeDataSimpleMode?(p(e,r.value),e.push.apply(e,t.map(function(e){return __assign(__assign({},e),{pId:r.value})}))):r.children=t)})}).catch(function(){f(!1)}).finally(function(){var e;null!=(e=null==i?void 0:i.onChange)&&e.call(i,r,t)})):null!=(e=null==i?void 0:i.onChange)&&e.call(i,r,t)):(s.current=r,null!=(a=null==i?void 0:i.onChange)&&a.call(i,r,t))},options:n}))}),AsyncCascaderView=InternalAsyncCascader;AsyncCascaderView.displayName="AsyncCascaderView",exports.default=AsyncCascaderView;
//# sourceMappingURL=AsyncCascaderView.js.map
