"use strict";var __assign=function(){return(__assign=Object.assign||function(e){for(var n,r=1,t=arguments.length;r<t;r++)for(var a in n=arguments[r])Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a]);return e}).apply(this,arguments)},__createBinding=Object.create?function(e,n,r,t){void 0===t&&(t=r);var a=Object.getOwnPropertyDescriptor(n,r);a&&("get"in a?n.__esModule:!a.writable&&!a.configurable)||(a={enumerable:!0,get:function(){return n[r]}}),Object.defineProperty(e,t,a)}:function(e,n,r,t){e[t=void 0===t?r:t]=n[r]},__setModuleDefault=Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n},__importStar=function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding(n,e,r);return __setModuleDefault(n,e),n},__rest=function(e,n){var r={};for(a in e)Object.prototype.hasOwnProperty.call(e,a)&&n.indexOf(a)<0&&(r[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var t=0,a=Object.getOwnPropertySymbols(e);t<a.length;t++)n.indexOf(a[t])<0&&Object.prototype.propertyIsEnumerable.call(e,a[t])&&(r[a[t]]=e[a[t]]);return r},__importDefault=function(e){return e&&e.__esModule?e:{default:e}},ahooks_1=(Object.defineProperty(exports,"__esModule",{value:!0}),require("ahooks")),difference_1=__importDefault(require("lodash/difference")),react_1=__importStar(require("react")),use_immer_1=require("use-immer"),adhere_util_1=__importDefault(require("@baifendian/adhere-util")),TreeFilter_1=require("../TreeFilter"),InternalCascaderView_1=__importDefault(require("./InternalCascaderView")),InternalAsyncCascader=(0,react_1.memo)(function(e){var l=e.loadData,n=e.onDataSourceChange,r=e.isEveryAsync,o=void 0!==r&&r,i=__rest(e,["loadData","onDataSourceChange","isEveryAsync"]),r=(0,use_immer_1.useImmer)([]),t=r[0],c=r[1],e=(0,react_1.useState)(!1),r=e[0],f=e[1],s=(0,react_1.useRef)(null!=(e=i.value)?e:i.defaultValue),d=(0,react_1.useMemo)(function(){return i.treeDataSimpleMode?t:adhere_util_1.default.treeToArray(null!=t?t:[],TreeFilter_1.treeTransformConfig)},[t,i.treeDataSimpleMode]);function _(e,a){return i.treeDataSimpleMode?e.find(function(e){return e.value===a}):function e(n){for(var r=0;r<n.length;r++){var t=n[r];if(t.value===a)return t;if(t.children&&(t=e(t.children)))return t}}(e)}function p(a,e){var u=[];!function e(n){for(var r=0;r<a.length;r++){var t=a[r];t.pId===n&&(u.push(r),e(t.value))}}(e),u.forEach(function(e){a.splice(e,1)})}return(0,ahooks_1.useUpdateEffect)(function(){c(i.options)},[i.options]),(0,ahooks_1.useUpdateEffect)(function(){var e;s.current=null!=(e=i.value)?e:i.defaultValue},[i.defaultValue,i.value]),(0,ahooks_1.useUpdateEffect)(function(){null!=n&&n(t)},[t]),(0,ahooks_1.useMount)(function(){var e;null!=(e=null==l?void 0:l(void 0))&&e.then(function(e){c(e)})}),react_1.default.createElement(InternalCascaderView_1.default,__assign({loading:r},i,{onChange:function(n,r){var e,t,a,u=(0,difference_1.default)(n,s.current);u.length<=0?(s.current=n,null!=(e=null==i?void 0:i.onChange)&&e.call(i,n,r)):(t=d.find(function(e){return e.value===u[0]}))?(s.current=n,(a=!o&&t.isLoaded?a:null==l?void 0:l(t.value))?(f(!0),a.then(function(r){f(!1),c(function(e){var n=_(e,t.value);n&&(n.isLoaded=!0,i.treeDataSimpleMode?(p(e,n.value),e.push.apply(e,r.map(function(e){return __assign(__assign({},e),{pId:n.value})}))):n.children=r)})}).catch(function(){f(!1)}).finally(function(){var e;null!=(e=null==i?void 0:i.onChange)&&e.call(i,n,r)})):null!=(e=null==i?void 0:i.onChange)&&e.call(i,n,r)):(s.current=n,null!=(a=null==i?void 0:i.onChange)&&a.call(i,n,r))},options:t}))}),AsyncCascaderView=InternalAsyncCascader;AsyncCascaderView.displayName="AsyncCascaderView",exports.default=AsyncCascaderView;
//# sourceMappingURL=AsyncCascaderView.js.map
