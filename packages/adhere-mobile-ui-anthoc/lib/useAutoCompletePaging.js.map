{"version":3,"file":"useAutoCompletePaging.js","sources":["useAutoCompletePaging.js"],"sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar ahooks_1 = require(\"ahooks\");\nvar react_1 = require(\"react\");\nvar Paging_1 = require(\"./Paging\");\n/**\n * UseAutoCompletePaging\n * @description 适配 AutoComplete 的 props\n * @param defaultSearchDataSource\n * @param pagingComponentProps\n * @param loadData\n * @param onDataSourceChange\n * @constructor\n */\nfunction UseAutoCompletePaging(_a) {\n  var _b;\n  var defaultSearchDataSource = _a.defaultSearchDataSource,\n    pagingComponentProps = _a.pagingComponentProps,\n    loadData = _a.loadData,\n    onDataSourceChange = _a.onDataSourceChange;\n  // 是否是第一次加载\n  var isFirst = (0, react_1.useRef)(false);\n  // 查询关键字\n  var kw = (0, react_1.useRef)(undefined);\n  // 查询数据\n  var _c = (0, react_1.useState)({\n      data: defaultSearchDataSource !== null && defaultSearchDataSource !== void 0 ? defaultSearchDataSource : [],\n      total: (defaultSearchDataSource !== null && defaultSearchDataSource !== void 0 ? defaultSearchDataSource : []).length\n    }),\n    searchDataSource = _c[0],\n    setSearchDataSource = _c[1];\n  // 是否是本地分页\n  var isLocal = (0, react_1.useMemo)(function () {\n    var _a;\n    return 'isLocal' in (pagingComponentProps === null || pagingComponentProps === void 0 ? void 0 : pagingComponentProps.pagingProps) ? (_a = pagingComponentProps === null || pagingComponentProps === void 0 ? void 0 : pagingComponentProps.pagingProps) === null || _a === void 0 ? void 0 : _a.isLocal : true;\n  }, [(_b = pagingComponentProps === null || pagingComponentProps === void 0 ? void 0 : pagingComponentProps.pagingProps) === null || _b === void 0 ? void 0 : _b.isLocal]);\n  // 适配 AutoComplete 的 props\n  var targetPagingComponentProps = (0, react_1.useMemo)(function () {\n    var result = pagingComponentProps;\n    // 如果不是本地分页，就不需要加载数据\n    if (!isLocal) {\n      result.pagingProps.onLoad = function (_page, _limit) {\n        return new Promise(function (resolve) {\n          var _a, _b;\n          if (isFirst.current) {\n            isFirst.current = false;\n            resolve(searchDataSource);\n            return;\n          }\n          (_b = (_a = loadData === null || loadData === void 0 ? void 0 : loadData(kw.current, _page, _limit)) === null || _a === void 0 ? void 0 : _a.then) === null || _b === void 0 ? void 0 : _b.call(_a, function (_pagingData) {\n            onDataSourceChange === null || onDataSourceChange === void 0 ? void 0 : onDataSourceChange(kw.current, _pagingData.data);\n            resolve(_pagingData);\n          });\n        });\n      };\n    }\n    return result;\n  }, [pagingComponentProps, isLocal, searchDataSource, loadData]);\n  // AutoCompleteLoadData\n  var autoCompleteLoadData = (0, react_1.useCallback)(function (_kw) {\n    var _a, _b, _c, _d, _e;\n    isFirst.current = true;\n    kw.current = _kw;\n    var params = [_kw, undefined, undefined];\n    if (!isLocal) {\n      params.push(1, (_c = (_b = (_a = pagingComponentProps === null || pagingComponentProps === void 0 ? void 0 : pagingComponentProps.pagingProps) === null || _a === void 0 ? void 0 : _a.defaultPaging) === null || _b === void 0 ? void 0 : _b.limit) !== null && _c !== void 0 ? _c : Paging_1.DEFAULT_LIMIT);\n    }\n    // @ts-ignore\n    return (_e = (_d = loadData === null || loadData === void 0 ? void 0 : loadData.apply(void 0, params.filter(function (t) {\n      return !!t;\n    }))) === null || _d === void 0 ? void 0 : _d.then) === null || _e === void 0 ? void 0 : _e.call(_d, function (_pagingData) {\n      setSearchDataSource(_pagingData);\n      onDataSourceChange === null || onDataSourceChange === void 0 ? void 0 : onDataSourceChange(1, _pagingData.data);\n      return _pagingData;\n    });\n  }, [isLocal, loadData, pagingComponentProps]);\n  (0, ahooks_1.useUpdateEffect)(function () {\n    setSearchDataSource({\n      data: defaultSearchDataSource !== null && defaultSearchDataSource !== void 0 ? defaultSearchDataSource : [],\n      total: (defaultSearchDataSource !== null && defaultSearchDataSource !== void 0 ? defaultSearchDataSource : []).length\n    });\n  }, [defaultSearchDataSource]);\n  return {\n    searchDataSource: searchDataSource,\n    targetPagingComponentProps: targetPagingComponentProps,\n    autoCompleteLoadData: autoCompleteLoadData\n  };\n}\nexports.default = UseAutoCompletePaging;"],"names":["Object","defineProperty","exports","value","ahooks_1","require","react_1","Paging_1","UseAutoCompletePaging","_a","defaultSearchDataSource","pagingComponentProps","loadData","onDataSourceChange","isFirst","useRef","kw","undefined","_c","useState","data","total","length","searchDataSource","setSearchDataSource","isLocal","useMemo","pagingProps","_b","targetPagingComponentProps","result","onLoad","_page","_limit","Promise","resolve","current","then","call","_pagingData","autoCompleteLoadData","useCallback","_kw","_d","params","push","defaultPaging","limit","DEFAULT_LIMIT","_e","apply","filter","t","useUpdateEffect","default"],"mappings":"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"}