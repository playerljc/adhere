import React,{memo,useContext,useEffect,useRef,useState}from"react";import ConditionalRender from"@baifendian/adhere-ui-conditionalrender";import Util from"@baifendian/adhere-util";import{AnchorNavigationContext}from"./AnchorNavigationContext";var selectPrefix="adhere-ui-playground-anchor-navigation",AnchorNavigation=function(e){var t=e.anchors,n=void 0===t?[]:t,t=e.anchorPosition,o=void 0===t?{top:77,width:120}:t,t=e.children,c=useState(e.activeAnchor||""),a=c[0],r=c[1],i=useRef(null),l=useRef([]),u=useContext(AnchorNavigationContext).scrollEl;return useEffect(function(){if("undefined"!=typeof window)return window.addEventListener("hashchange",e),function(){"undefined"!=typeof window&&window.removeEventListener("hashchange",e)};function e(){r(window.location.hash.substring(1))}},[]),useEffect(function(){var c;if(u)return u&&(c=u,l.current=[],(n||[]).forEach(function(e,t){var e=e.anchor,n=document.getElementById(e);n&&(n={anchor:e,range:{top:e=Util.getTopUntil({el:n,untilEl:c}),bottom:t===l.current.length-1?e+n.offsetHeight:void 0}},l.current.push(n),0!==t&&(l.current[t-1].range.bottom=e))})),u.addEventListener("scroll",e),function(){u&&u.removeEventListener("scroll",e)};function e(){var e,t,n;u&&i.current&&(e=u.scrollTop,n=e,(t=l.current.find(function(e){return n>=e.range.top&&n<=e.range.bottom}))&&r(t.anchor),0===e?null!=(t=null==(e=null==(t=i.current)?void 0:t.classList)?void 0:e.remove)&&t.call(e,"".concat(selectPrefix,"-affix")):(null!=(t=null==(e=null==(t=i.current)?void 0:t.classList)?void 0:e.add)&&t.call(e,"".concat(selectPrefix,"-affix")),i.current.style&&(i.current.style.top="".concat(o.top,"px"))))}},[u]),useEffect(function(){r(e.activeAnchor||"")},[e.activeAnchor]),React.createElement("div",{className:selectPrefix},React.createElement("div",{className:"".concat(selectPrefix,"-auto")},React.createElement("div",{className:"".concat(selectPrefix,"-inner")},t)),React.createElement(ConditionalRender,{conditional:!!(n||[]).length},function(){return React.createElement("div",{className:"".concat(selectPrefix,"-fixed"),style:{width:"".concat(o.width,"px")}},React.createElement("ul",{className:"".concat(selectPrefix,"-anchor"),ref:i},(n||[]).map(function(e){return React.createElement("li",{className:e.anchor===a?"".concat(selectPrefix,"-active"):"",title:e.name},React.createElement("a",{href:"#".concat(e.anchor)},e.name))})))}))};export default memo(AnchorNavigation);
//# sourceMappingURL=AnchorNavigation.js.map
