{"version":3,"file":"AnchorNavigation.js","sources":["AnchorNavigation.js"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport Util from '@baifendian/adhere-util';\r\nimport { AnchorNavigationContext } from './AnchorNavigationContext';\r\nvar selectPrefix = 'adhere-ui-playground-anchor-navigation';\r\n/**\r\n * AnchorNavigation\r\n * @classdesc 带有锚点导航的面板\r\n * @constructor\r\n */\r\nfunction AnchorNavigation(props) {\r\n    var _a = useState(props.activeAnchor), activeAnchor = _a[0], setActiveAnchor = _a[1];\r\n    var _b = useState(null), scrollEl = _b[0], setScrollEl = _b[1];\r\n    var anchorRef = useRef();\r\n    var anchorDimensionIndex = useRef([]);\r\n    /**\r\n     * createAnchorDimensionIndex\r\n     */\r\n    function createAnchorDimensionIndex() {\r\n        if (!scrollEl)\r\n            return;\r\n        var container = scrollEl;\r\n        anchorDimensionIndex.current = [];\r\n        props.anchors.forEach(function (_a, index) {\r\n            var anchor = _a.anchor;\r\n            var el = document.getElementById(anchor);\r\n            if (!el)\r\n                return;\r\n            var top = Util.getTopUntil({ el: el, untilEl: container });\r\n            var entry = {\r\n                anchor: anchor,\r\n                range: {\r\n                    top: top,\r\n                    bottom: undefined,\r\n                },\r\n            };\r\n            anchorDimensionIndex.current.push(entry);\r\n            if (index !== 0) {\r\n                // @ts-ignore\r\n                anchorDimensionIndex.current[index - 1].range.bottom = top;\r\n            }\r\n            if (index === anchorDimensionIndex.current.length - 1) {\r\n                // @ts-ignore\r\n                entry.range.bottom = top + el.offsetHeight;\r\n            }\r\n        });\r\n    }\r\n    /**\r\n     * findAnchorByScrollVal\r\n     * @param scrollVal\r\n     */\r\n    function findAnchorByScrollVal(scrollVal) {\r\n        return anchorDimensionIndex.current.find(function (anchorIndexItem) {\r\n            // @ts-ignore\r\n            return scrollVal >= anchorIndexItem.range.top && scrollVal <= anchorIndexItem.range.bottom;\r\n        });\r\n    }\r\n    /**\r\n     * useEffect\r\n     * @description mount\r\n     */\r\n    useEffect(function () {\r\n        /**\r\n         * onHashChange\r\n         */\r\n        function onHashChange() {\r\n            setActiveAnchor(window.location.hash.substring(1));\r\n        }\r\n        window.addEventListener('hashchange', onHashChange);\r\n        return function () {\r\n            window.removeEventListener('hashchange', onHashChange);\r\n        };\r\n    }, []);\r\n    /**\r\n     * useEffect\r\n     * @description scrollEl change\r\n     */\r\n    useEffect(function () {\r\n        if (!scrollEl)\r\n            return;\r\n        /**\r\n         * onWrapScroll\r\n         */\r\n        function onWrapScroll() {\r\n            if (!scrollEl)\r\n                return;\r\n            var scrollTop = scrollEl.scrollTop;\r\n            var anchor = findAnchorByScrollVal(scrollTop);\r\n            if (anchor) {\r\n                setActiveAnchor(anchor.anchor);\r\n            }\r\n            if (scrollTop === 0) {\r\n                anchorRef.current.classList.remove(selectPrefix + \"-affix\");\r\n                // (anchorRef.current as HTMLElement).style.top = '0';\r\n            }\r\n            else {\r\n                anchorRef.current.classList.add(selectPrefix + \"-affix\");\r\n                anchorRef.current.style.top = props.anchorPosition.top + \"px\";\r\n            }\r\n        }\r\n        createAnchorDimensionIndex();\r\n        scrollEl.addEventListener('scroll', onWrapScroll);\r\n        return function () {\r\n            if (!scrollEl)\r\n                return;\r\n            scrollEl.removeEventListener('scroll', onWrapScroll);\r\n        };\r\n    }, [scrollEl]);\r\n    /**\r\n     * useEffect\r\n     * @description activeAnchor change\r\n     */\r\n    useEffect(function () {\r\n        setActiveAnchor(props.activeAnchor);\r\n    }, [props.activeAnchor]);\r\n    /**\r\n     * render jsx\r\n     */\r\n    return (React.createElement(AnchorNavigationContext.Consumer, null, function (_a) {\r\n        var _scrollEl = _a.scrollEl;\r\n        // @ts-ignore\r\n        setScrollEl(_scrollEl);\r\n        return (\r\n        // @ts-ignore\r\n        React.createElement(\"div\", { className: selectPrefix },\r\n            React.createElement(\"div\", { className: selectPrefix + \"-auto\" },\r\n                React.createElement(\"div\", { className: selectPrefix + \"-inner\" }, props.children)),\r\n            React.createElement(\"div\", { className: selectPrefix + \"-fixed\", style: { width: props.anchorPosition.width + \"px\" } },\r\n                React.createElement(\"ul\", { className: selectPrefix + \"-anchor\", \r\n                    // @ts-ignore\r\n                    ref: anchorRef }, props.anchors.map(function (anchor) { return (React.createElement(\"li\", { className: anchor.anchor === activeAnchor ? selectPrefix + \"-active\" : '', title: anchor.name },\r\n                    React.createElement(\"a\", { href: \"#\" + anchor.anchor }, anchor.name))); })))));\r\n    }));\r\n}\r\nAnchorNavigation.defaultProps = {\r\n    activeAnchor: '',\r\n    anchors: [],\r\n    anchorPosition: {\r\n        top: 77,\r\n        width: 120,\r\n    },\r\n};\r\nAnchorNavigation.propTypes = {\r\n    activeAnchor: PropTypes.string,\r\n    anchors: PropTypes.arrayOf(PropTypes.shape({\r\n        name: PropTypes.oneOfType([PropTypes.string, PropTypes.node]),\r\n        anchor: PropTypes.string,\r\n    })),\r\n    anchorPosition: PropTypes.shape({\r\n        top: PropTypes.number,\r\n        width: PropTypes.number,\r\n    }),\r\n};\r\nexport default AnchorNavigation;\r\n"],"names":["React","useEffect","useRef","useState","PropTypes","Util","AnchorNavigationContext","selectPrefix","AnchorNavigation","props","_a","activeAnchor","setActiveAnchor","_b","scrollEl","setScrollEl","anchorRef","anchorDimensionIndex","onHashChange","window","location","hash","substring","addEventListener","removeEventListener","container","current","anchors","forEach","index","anchor","el","document","getElementById","top","getTopUntil","untilEl","push","entry","range","bottom","undefined","length","offsetHeight","onWrapScroll","scrollTop","scrollVal","find","anchorIndexItem","classList","remove","add","style","anchorPosition","createElement","Consumer","_scrollEl","className","children","width","ref","map","title","name","href","defaultProps","propTypes","string","arrayOf","shape","oneOfType","node","number"],"mappings":"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"}