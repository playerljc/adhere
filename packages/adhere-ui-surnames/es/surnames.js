var __extends=this&&this.__extends||function(){var i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};return function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}(),__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};import React from"react";import PropTypes from"prop-types";import classNames from"classnames";import Util from"@baifendian/adhere-util";var selectorPrefix="adhere-ui-surnames",DURATION=100,Surnames=function(e){function t(){var i=null!==e&&e.apply(this,arguments)||this;return i.key=!1,i.isMouseClicked=!1,i.isMouseMoved=!1,i.onClick=function(e){e.preventDefault(),e.stopPropagation(),i.clickDetail(e)},i.onTouchmove=function(e){e.preventDefault();var t=e.changedTouches[0].pageY,n=e.changedTouches[0].pageX,e=e.target,e=Util.getTopDom(e,selectorPrefix+"-index-item");i.curIndexName=e.dataset.name,i.moveDetail(n,t)},i.onTouchend=function(){i.highlightedEl.style.display="none",i.highlightedEl.innerText="",i.highlightedEl.style.transform="translate3d(0,0,0)"},i.onMousedown=function(e){e.preventDefault(),i.startY=e.pageY,i.startX=e.pageX;e=e.target,e=Util.getTopDom(e,selectorPrefix+"-index-item");console.log("按下获取索引名称",e.dataset.name),i.curIndexName=e.dataset.name,i.isMouseClicked=!0},i.onMousemove=function(e){if(!i.isMouseClicked)return!1;i.isMouseMoved=!0,e.preventDefault();var t=e.pageY,e=e.pageX;i.moveDetail(e,t)},i.onMouseleave=function(){i.isMouseClicked=!1,i.isMouseMoved=!1,i.highlightedEl.style.display="none",i.highlightedEl.innerText="",i.highlightedEl.style.transform="translate3d(0,0,0)"},i.onMouseup=function(e){if(i.isMouseMoved)return i.isMouseClicked=!1,i.isMouseMoved=!1,i.highlightedEl.style.display="none",i.highlightedEl.innerText="",!(i.highlightedEl.style.transform="translate3d(0,0,0)");e.preventDefault(),i.clickDetail(e)},i.onResize=function(){i.update()},i}return __extends(t,e),t.prototype.componentDidMount=function(){this.initEvent(),this.createMask(),this.adapterDimension(),this.createIndexPosition()},t.prototype.componentDidUpdate=function(e,t,n){this.adapterDimension(),this.createIndexPosition()},t.prototype.componentWillUnmount=function(){this.maskEl&&this.maskEl.parentElement.removeChild(this.maskEl)},t.prototype.clickDetail=function(e){var t=e.target;if(e.preventDefault(),this.key)return!1;this.key=!0,this.maskEl.style.display="block",this.scrollToAnimation(t.dataset.name)},t.prototype.moveDetail=function(e,t){var n,t=this.findIndex(e,t);t&&(console.log(t.name),this.highlightedEl.innerText=t.name,this.highlightedEl.style.display="block","vertical"===this.getDirection()?(n=t.offsetTop+Math.floor(t.height/2),this.highlightedEl.style.transform="translate3d(0,"+n+"px,0)"):(n=t.offsetLeft+t.width,this.highlightedEl.style.transform="translate3d("+n+"px,0,0)"),this.scrollTo(t.name))},t.prototype.initEvent=function(){Util.isTouch()?(this.indexInnerEl.addEventListener("click",this.onClick),this.indexInnerEl.addEventListener("touchmove",this.onTouchmove),this.indexInnerEl.addEventListener("touchend",this.onTouchend)):(this.indexInnerEl.addEventListener("mousedown",this.onMousedown),this.indexInnerEl.addEventListener("mousemove",this.onMousemove),this.indexInnerEl.addEventListener("mouseleave",this.onMouseleave),this.indexInnerEl.addEventListener("mouseup",this.onMouseup),"undefined"!=typeof window&&window.addEventListener("resize",this.onResize))},t.prototype.adapterDimension=function(){var e,t;"vertical"===this.getDirection()?(null!==(e=this.el)&&void 0!==e&&(e.style.height=(null===(t=this.indexInnerEl)||void 0===t?void 0:t.offsetHeight)+50+"px"),null!==(t=this.el)&&void 0!==t&&(t.style.width="100%")):null!==(t=this.el)&&void 0!==t&&(t.style.height="100%")},t.prototype.createIndexPosition=function(){var e=this.indexInnerEl.querySelectorAll("."+selectorPrefix+"-index-item");this.indexPositionMap=[];for(var t=0;t<e.length;t++){var n=e[t],i=n.dataset.name,o=n.getBoundingClientRect();this.indexPositionMap.push({name:i,top:o.top,bottom:o.bottom,left:o.left,right:o.right,offsetTop:n.offsetTop,offsetLeft:n.offsetLeft,width:n.offsetWidth,height:n.offsetHeight})}console.log(this.indexPositionMap)},t.prototype.createMask=function(){var e=document.createElement("div");e.innerHTML="<div class='"+selectorPrefix+"-mask'></div>",this.maskEl=e.firstElementChild,document.body.appendChild(this.maskEl)},t.prototype.scrollToAnimation=function(n,e){void 0===e&&(e=100);var i=this,t=this.props,o=t.onScroll,r=t.onBeforeScroll,t=i.contentEl.querySelector("."+selectorPrefix+"-group-title[data-name='"+n+"']"),s=i.contentEl.scrollTop,a=s,l=t.offsetTop,t=screen.updateInterval,d=i.el.scrollHeight/((DURATION|e)/(t||16.7)+((DURATION|e)%(t||16.7)!=0?1:0));r&&r(n),"undefined"!=typeof window&&window.requestAnimationFrame(function e(){function t(){i.key=!1,i.isMouseClicked=!1,i.maskEl.style.display="none",o&&o(n)}s<l?l<a+d?a=l:a+=d:a-d<l?a=l:a-=d,i.contentEl.scrollTop=a,s<l?l<=a?t():"undefined"!=typeof window&&window.requestAnimationFrame(e):a<=l?t():"undefined"!=typeof window&&window.requestAnimationFrame(e)})},t.prototype.scrollTo=function(e){this.contentEl.scrollTop=this.contentEl.querySelector("."+selectorPrefix+"-group-title[data-name='"+e+"']").offsetTop;var t=this.props.onScroll;t&&t(e)},t.prototype.getDirection=function(){var e=this.props.position;return"left"===e||"right"===e?"vertical":"horizontal"},t.prototype.findIndex=function(e,t){var n=this,i=this.getDirection(),o="vertical"===i?t-this.startY:e-this.startX,r=this.indexPositionMap.find(function(e){return e.name===n.curIndexName});console.log("获取增量",o),console.log("移动获取当前索引信息",r);for(var s,a=0,l=this.indexPositionMap.length-1;a<=l&&a<=this.indexPositionMap.length-1&&l<=this.indexPositionMap.length-1;){var d,c=this.indexPositionMap[d=l+a>>1],p=void 0,h=void 0,u=void 0,f=void 0,f="vertical"===i?(p=r.top+o,h=r.bottom+o,u=c.top,c.bottom):(p=r.left+o,h=r.right+o,u=c.left,c.right);if(console.log(p,h,u,f),u<=p&&p<=f){s=c;break}p<u?l=d-1:a=1+d}return s||null},t.prototype.update=function(){this.adapterDimension(),this.createIndexPosition()},t.prototype.renderIndex=function(){return this.props.indexes.map(function(e){return React.createElement("a",{key:e.index,className:selectorPrefix+"-index-item","data-name":e.index},e.renderIndex?e.renderIndex(e):e.index)})},t.prototype.renderContent=function(){var e=this.props,n=e.indexes;return e.dataSource.map(function(t){var e=n.find(function(e){return e.index===t.index});return React.createElement("div",{key:t.index,className:selectorPrefix+"-group"},React.createElement("a",{className:selectorPrefix+"-group-title","data-name":t.index},e.renderTitle?e.renderTitle(t):e.index),React.createElement("div",{className:selectorPrefix+"-group-inner"},e.renderContent?e.renderContent(t):null))})},t.prototype.render=function(){var t=this,e=this.props,n=e.position,i=e.className,e=e.style;return React.createElement("div",{className:classNames(selectorPrefix,selectorPrefix+"-config-position-"+n,i.split(" ")),style:__assign({},e),ref:function(e){return t.el=e}},React.createElement("div",{className:selectorPrefix+"-highlighted",ref:function(e){return t.highlightedEl=e}}),React.createElement("div",{className:selectorPrefix+"-content",ref:function(e){return t.contentEl=e}},this.renderContent()),React.createElement("div",{className:selectorPrefix+"-index",ref:function(e){return t.indexEl=e}},React.createElement("div",{className:selectorPrefix+"-index-inner",ref:function(e){return t.indexInnerEl=e}},this.renderIndex())))},t}(React.Component);Surnames.defaultProps={className:"",style:{},position:"right",indexes:[],dataSource:[],onBeforeScroll:function(){},onScroll:function(){}},Surnames.propTypes={className:PropTypes.string,style:PropTypes.object,position:PropTypes.oneOf(["top","right","bottom","left"]),indexes:PropTypes.arrayOf(PropTypes.shape({index:PropTypes.string,renderIndex:PropTypes.func,renderTitle:PropTypes.func,renderContent:PropTypes.func})),dataSource:PropTypes.arrayOf(PropTypes.shape({index:PropTypes.string,data:PropTypes.arrayOf(PropTypes.object)})),onBeforeScroll:PropTypes.func,onScroll:PropTypes.func};export default Surnames;
//# sourceMappingURL=surnames.js.map
