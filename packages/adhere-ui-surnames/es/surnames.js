import classNames from"classnames";import React,{forwardRef,memo,useCallback,useImperativeHandle,useLayoutEffect,useRef}from"react";import Util from"@baifendian/adhere-util";var selectorPrefix="adhere-ui-surnames",DURATION=100,Surnames=memo(forwardRef(function(e,H){var t=e.position,n=void 0===t?"right":t,t=e.className,t=void 0===t?"":t,r=e.style,r=void 0===r?{}:r,l=e.indexClassName,l=void 0===l?"":l,c=e.indexStyle,c=void 0===c?{}:c,o=e.contentClassName,o=void 0===o?"":o,u=e.contentStyle,a=e.indexes,i=void 0===a?[]:a,a=e.dataSource,s=void 0===a?[]:a,d=e.onScroll,f=e.onBeforeScroll,v=useRef(null),m=useRef(null),p=useRef(null),a=useRef(null),h=useRef(null),x=useRef(null),g=useRef(!1),y=useRef(!1),E=useRef(!1),R=useRef(0),w=useRef(0),T=useRef(""),L=useRef([]);function N(){return"left"===n||"right"===n?"vertical":"horizontal"}function P(){"vertical"===N()?(v.current.style.height="".concat(h.current.offsetHeight+50,"px"),v.current.style.width="100%"):v.current.style.height="100%"}var e=useCallback(function(){return s.map(function(t){var e=i.find(function(e){return e.index===t.index});return React.createElement("div",{key:t.index,className:"".concat(selectorPrefix,"-group")},React.createElement("a",{className:"".concat(selectorPrefix,"-group-title"),"data-name":t.index},null!=e&&e.renderTitle?e.renderTitle(t):null==e?void 0:e.index),React.createElement("div",{className:"".concat(selectorPrefix,"-group-inner")},null!=e&&e.renderContent?null==e?void 0:e.renderContent(t):null))})},[s,i]),z=useCallback(function(){return i.map(function(e){return React.createElement("a",{key:e.index,className:"".concat(selectorPrefix,"-index-item"),"data-name":e.index},e.renderIndex?e.renderIndex(e):e.index)})},[i]);function b(){var e,t,n=null==(t=null==(e=h.current)?void 0:e.querySelectorAll)?void 0:t.call(e,".".concat(selectorPrefix,"-index-item"));L.current=[];for(var r=0;r<n.length;r++){var l=n[r],c=l.dataset.name,o=l.getBoundingClientRect();L.current.push({name:c,top:o.top,bottom:o.bottom,left:o.left,right:o.right,offsetTop:l.offsetTop,offsetLeft:l.offsetLeft,width:l.offsetWidth,height:l.offsetHeight})}}function S(e){var t=e.target;e.preventDefault(),g.current||(g.current=!0,x.current.style.display="block",C(t.dataset.name))}function k(e,t){e=function(e,t){for(var n,r=N(),l="vertical"===r?t-R.current:e-w.current,c=L.current.find(function(e){return e.name===T.current}),o=0,u=L.current.length-1;o<=u&&o<=L.current.length-1&&u<=L.current.length-1;){var a,i=L.current[a=u+o>>1],s=void 0,d=void 0,f=void 0,f="vertical"===r?(s=c.top+l,c.bottom,d=i.top,i.bottom):(s=c.left+l,c.right,d=i.left,i.right);if(d<=s&&s<=f){n=i;break}s<d?u=a-1:o=1+a}return n||null}(e,t);e&&(m.current.innerText=e.name,m.current.style.display="block","vertical"===N()?(t=e.offsetTop+Math.floor(e.height/2),m.current.style.transform="translate3d(0,".concat(t,"px,0)")):(t=e.offsetLeft+e.width,m.current.style.transform="translate3d(".concat(t,"px,0,0)")),D(e.name))}function C(n,e){void 0===e&&(e=100);var t=null==(t=null==(o=p.current)?void 0:o.querySelector)?void 0:t.call(o,".".concat(selectorPrefix,"-group-title[data-name='").concat(n,"']")),r=null==(o=p.current)?void 0:o.scrollTop,l=r,c=t.offsetTop,o=screen.updateInterval,u=v.current.scrollHeight/((DURATION|e)/(o||16.7)+((DURATION|e)%(o||16.7)!=0?1:0));f&&f(n),"undefined"!=typeof window&&window.requestAnimationFrame(function e(){function t(){g.current=!1,y.current=!1,x.current.style.display="none",d&&d(n)}r<c?c<l+u?l=c:l+=u:l-u<c?l=c:l-=u,p.current.scrollTop=l,r<c?c<=l?t():"undefined"!=typeof window&&window.requestAnimationFrame(e):l<=c?t():"undefined"!=typeof window&&window.requestAnimationFrame(e)})}function D(e){var t,n;p.current.scrollTop=(null==(n=null==(t=p.current)?void 0:t.querySelector)?void 0:n.call(t,".".concat(selectorPrefix,"-group-title[data-name='").concat(e,"']"))).offsetTop,d&&d(e)}function A(e){e.preventDefault(),e.stopPropagation(),S(e)}function I(e){e.preventDefault();var t=e.changedTouches[0].pageY,n=e.changedTouches[0].pageX,e=e.target,e=Util.getTopDom(e,"".concat(selectorPrefix,"-index-item"));T.current=e.dataset.name,k(n,t)}function U(){m.current.style.display="none",m.current.innerText="",m.current.style.transform="translate3d(0,0,0)"}function q(e){e.preventDefault(),R.current=e.pageY,w.current=e.pageX;e=e.target,e=Util.getTopDom(e,"".concat(selectorPrefix,"-index-item"));T.current=null==e?void 0:e.dataset.name,y.current=!0}function F(e){if(!y.current)return!1;E.current=!0,e.preventDefault();var t=e.pageY;k(e.pageX,t)}function O(){y.current=!1,E.current=!1,m.current.style.display="none",m.current.innerText="",m.current.style.transform="translate3d(0,0,0)"}function X(e){if(E.current)return y.current=!1,E.current=!1,m.current.style.display="none",m.current.innerText="",!(m.current.style.transform="translate3d(0,0,0)");e.preventDefault(),S(e)}function Y(){P(),b()}return useImperativeHandle(H,function(){return{scrollToAnimation:C,scrollTo:D}}),useLayoutEffect(function(){var e;return(e=document.createElement("div")).innerHTML="<div class='".concat(selectorPrefix,"-mask'></div>"),x.current=e.firstElementChild,document.body.appendChild(x.current),P(),b(),function(){var e,t;null!=(t=null==(e=null==(e=x.current)?void 0:e.parentElement)?void 0:e.removeChild)&&t.call(e,x.current)}},[]),useLayoutEffect(function(){var e,t;return Util.isTouch()?(null!=(t=null==(e=h.current)?void 0:e.addEventListener)&&t.call(e,"click",A),null!=(e=null==(t=h.current)?void 0:t.addEventListener)&&e.call(t,"touchmove",I),null!=(t=null==(e=h.current)?void 0:e.addEventListener)&&t.call(e,"touchend",U)):(null!=(e=null==(t=h.current)?void 0:t.addEventListener)&&e.call(t,"mousedown",q),null!=(t=null==(e=h.current)?void 0:e.addEventListener)&&t.call(e,"mousemove",F),null!=(e=null==(t=h.current)?void 0:t.addEventListener)&&e.call(t,"mouseleave",O),null!=(t=null==(e=h.current)?void 0:e.addEventListener)&&t.call(e,"mouseup",X),"undefined"!=typeof window&&window.addEventListener("resize",Y)),P(),b(),function(){var e,t;null!=(t=null==(e=h.current)?void 0:e.removeEventListener)&&t.call(e,"click",A),null!=(e=null==(t=h.current)?void 0:t.removeEventListener)&&e.call(t,"touchmove",I),null!=(t=null==(e=h.current)?void 0:e.removeEventListener)&&t.call(e,"touchend",U),null!=(e=null==(t=h.current)?void 0:t.removeEventListener)&&e.call(t,"mousedown",q),null!=(t=null==(e=h.current)?void 0:e.removeEventListener)&&t.call(e,"mousemove",F),null!=(e=null==(t=h.current)?void 0:t.removeEventListener)&&e.call(t,"mouseleave",O),null!=(t=null==(e=h.current)?void 0:e.removeEventListener)&&t.call(e,"mouseup",X),"undefined"!=typeof window&&window.removeEventListener("resize",Y)}}),React.createElement("div",{className:classNames(selectorPrefix,"".concat(selectorPrefix,"-config-position-").concat(n),null!=t?t:""),style:null!=r?r:{},ref:v},React.createElement("div",{className:"".concat(selectorPrefix,"-highlighted"),ref:m}),React.createElement("div",{className:classNames("".concat(selectorPrefix,"-content"),o),style:null!=u?u:{},ref:p},e()),React.createElement("div",{className:classNames("".concat(selectorPrefix,"-index"),l),style:null!=c?c:{},ref:a},React.createElement("div",{className:"".concat(selectorPrefix,"-index-inner"),ref:h},z())))}));Surnames.displayName="Surnames";export default Surnames;
//# sourceMappingURL=Surnames.js.map
