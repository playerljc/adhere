var __extends=this&&this.__extends||function(){var o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};return function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}(),__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};import React from"react";import PropTypes from"prop-types";import classNames from"classnames";var selectorPrefix="adhere-ui-surnames",DURATION=100;function isTouch(){return"ontouchend"in document}function getTopDom(e,t){if(!e||!t)return null;if(-1!==e.className.indexOf(t))return e;for(var n=e;(n=n.parentElement)&&-1===n.className.indexOf(t)&&n!==document.body;);return!n||n===document.body?null:n}var Surnames=function(e){function t(){var o=null!==e&&e.apply(this,arguments)||this;return o.key=!1,o.isMouseClicked=!1,o.isMouseMoved=!1,o.onClick=function(e){e.preventDefault(),e.stopPropagation(),o.clickDetail(e)},o.onTouchmove=function(e){e.preventDefault();var t=e.changedTouches[0].pageY,n=e.changedTouches[0].pageX,e=getTopDom(e.target,selectorPrefix+"-index-item");o.curIndexName=e.dataset.name,o.moveDetail(n,t)},o.onTouchend=function(){o.highlightedEl.style.display="none",o.highlightedEl.innerText="",o.highlightedEl.style.transform="translate3d(0,0,0)"},o.onMousedown=function(e){e.preventDefault(),o.startY=e.pageY,o.startX=e.pageX;e=getTopDom(e.target,selectorPrefix+"-index-item");console.log("按下获取索引名称",e.dataset.name),o.curIndexName=e.dataset.name,o.isMouseClicked=!0},o.onMousemove=function(e){if(!o.isMouseClicked)return!1;o.isMouseMoved=!0,e.preventDefault();var t=e.pageY,e=e.pageX;o.moveDetail(e,t)},o.onMouseleave=function(){o.isMouseClicked=!1,o.isMouseMoved=!1,o.highlightedEl.style.display="none",o.highlightedEl.innerText="",o.highlightedEl.style.transform="translate3d(0,0,0)"},o.onMouseup=function(e){if(o.isMouseMoved)return o.isMouseClicked=!1,o.isMouseMoved=!1,o.highlightedEl.style.display="none",o.highlightedEl.innerText="",!(o.highlightedEl.style.transform="translate3d(0,0,0)");e.preventDefault(),o.clickDetail(e)},o.onResize=function(){o.update()},o}return __extends(t,e),t.prototype.componentDidMount=function(){this.initEvent(),this.createMask(),this.adapterDimension(),this.createIndexPosition()},t.prototype.componentDidUpdate=function(e,t,n){this.adapterDimension(),this.createIndexPosition()},t.prototype.componentWillUnmount=function(){this.maskEl&&this.maskEl.parentElement.removeChild(this.maskEl)},t.prototype.clickDetail=function(e){var t=e.target;if(e.preventDefault(),this.key)return!1;this.key=!0,this.maskEl.style.display="block",this.scrollToAnimation(t.dataset.name)},t.prototype.moveDetail=function(e,t){var n,t=this.findIndex(e,t);t&&(console.log(t.name),this.highlightedEl.innerText=t.name,this.highlightedEl.style.display="block","vertical"===this.getDirection()?(n=t.offsetTop+Math.floor(t.height/2),this.highlightedEl.style.transform="translate3d(0,"+n+"px,0)"):(n=t.offsetLeft+t.width,this.highlightedEl.style.transform="translate3d("+n+"px,0,0)"),this.scrollTo(t.name))},t.prototype.initEvent=function(){isTouch()?(this.indexInnerEl.addEventListener("click",this.onClick),this.indexInnerEl.addEventListener("touchmove",this.onTouchmove),this.indexInnerEl.addEventListener("touchend",this.onTouchend)):(this.indexInnerEl.addEventListener("mousedown",this.onMousedown),this.indexInnerEl.addEventListener("mousemove",this.onMousemove),this.indexInnerEl.addEventListener("mouseleave",this.onMouseleave),this.indexInnerEl.addEventListener("mouseup",this.onMouseup),window.addEventListener("resize",this.onResize))},t.prototype.adapterDimension=function(){var e,t;"vertical"===this.getDirection()?(null!==(e=this.el)&&void 0!==e&&(e.style.height=(null===(t=this.indexInnerEl)||void 0===t?void 0:t.offsetHeight)+50+"px"),null!==(t=this.el)&&void 0!==t&&(t.style.width="100%")):null!==(t=this.el)&&void 0!==t&&(t.style.height="100%")},t.prototype.createIndexPosition=function(){var e=this.indexInnerEl.querySelectorAll("."+selectorPrefix+"-index-item");this.indexPositionMap=[];for(var t=0;t<e.length;t++){var n=e[t],o=n.dataset.name,i=n.getBoundingClientRect();this.indexPositionMap.push({name:o,top:i.top,bottom:i.bottom,left:i.left,right:i.right,offsetTop:n.offsetTop,offsetLeft:n.offsetLeft,width:n.offsetWidth,height:n.offsetHeight})}console.log(this.indexPositionMap)},t.prototype.createMask=function(){var e=document.createElement("div");e.innerHTML="<div class='"+selectorPrefix+"-mask'></div>",this.maskEl=e.firstElementChild,document.body.appendChild(this.maskEl)},t.prototype.scrollToAnimation=function(n,e){void 0===e&&(e=100);var o=this,t=this.props,i=t.onScroll,r=t.onBeforeScroll,t=o.contentEl.querySelector("."+selectorPrefix+"-group-title[data-name='"+n+"']"),s=o.contentEl.scrollTop,a=s,l=t.offsetTop,t=screen.updateInterval,c=o.el.scrollHeight/((DURATION|e)/(t||16.7)+((DURATION|e)%(t||16.7)!=0?1:0));r&&r(n),window.requestAnimationFrame(function e(){function t(){o.key=!1,o.isMouseClicked=!1,o.maskEl.style.display="none",i&&i(n)}s<l?l<a+c?a=l:a+=c:a-c<l?a=l:a-=c,o.contentEl.scrollTop=a,s<l?l<=a?t():window.requestAnimationFrame(e):a<=l?t():window.requestAnimationFrame(e)})},t.prototype.scrollTo=function(e){this.contentEl.scrollTop=this.contentEl.querySelector("."+selectorPrefix+"-group-title[data-name='"+e+"']").offsetTop;var t=this.props.onScroll;t&&t(e)},t.prototype.getDirection=function(){var e=this.props.position;return"left"===e||"right"===e?"vertical":"horizontal"},t.prototype.findIndex=function(e,t){var n=this,o=this.getDirection(),i="vertical"===o?t-this.startY:e-this.startX,r=this.indexPositionMap.find(function(e){return e.name===n.curIndexName});console.log("获取增量",i),console.log("移动获取当前索引信息",r);for(var s,a=0,l=this.indexPositionMap.length-1;a<=l&&a<=this.indexPositionMap.length-1&&l<=this.indexPositionMap.length-1;){var c,d=this.indexPositionMap[c=l+a>>1],p=void 0,h=void 0,u=void 0,f=void 0,f="vertical"===o?(p=r.top+i,h=r.bottom+i,u=d.top,d.bottom):(p=r.left+i,h=r.right+i,u=d.left,d.right);if(console.log(p,h,u,f),u<=p&&p<=f){s=d;break}p<u?l=c-1:a=1+c}return s||null},t.prototype.update=function(){this.adapterDimension(),this.createIndexPosition()},t.prototype.renderIndex=function(){return this.props.indexes.map(function(e){return React.createElement("a",{key:e.index,className:selectorPrefix+"-index-item","data-name":e.index},e.renderIndex?e.renderIndex(e):e.index)})},t.prototype.renderContent=function(){var e=this.props,n=e.indexes;return e.dataSource.map(function(t){var e=n.find(function(e){return e.index===t.index});return React.createElement("div",{key:t.index,className:selectorPrefix+"-group"},React.createElement("a",{className:selectorPrefix+"-group-title","data-name":t.index},e.renderTitle?e.renderTitle(t):e.index),React.createElement("div",{className:selectorPrefix+"-group-inner"},e.renderContent?e.renderContent(t):null))})},t.prototype.render=function(){var t=this,e=this.props,n=e.position,o=e.className,e=e.style;return React.createElement("div",{className:classNames(selectorPrefix,selectorPrefix+"-config-position-"+n,o.split(" ")),style:__assign({},e),ref:function(e){return t.el=e}},React.createElement("div",{className:selectorPrefix+"-highlighted",ref:function(e){return t.highlightedEl=e}}),React.createElement("div",{className:selectorPrefix+"-content",ref:function(e){return t.contentEl=e}},this.renderContent()),React.createElement("div",{className:selectorPrefix+"-index",ref:function(e){return t.indexEl=e}},React.createElement("div",{className:selectorPrefix+"-index-inner",ref:function(e){return t.indexInnerEl=e}},this.renderIndex())))},t}(React.Component);Surnames.defaultProps={className:"",style:{},position:"right",indexes:[],dataSource:[],onBeforeScroll:function(){},onScroll:function(){}},Surnames.propTypes={className:PropTypes.string,style:PropTypes.object,position:PropTypes.oneOf(["top","right","bottom","left"]),indexes:PropTypes.arrayOf(PropTypes.shape({index:PropTypes.string,renderIndex:PropTypes.func,renderTitle:PropTypes.func,renderContent:PropTypes.func})),dataSource:PropTypes.arrayOf(PropTypes.shape({index:PropTypes.string,data:PropTypes.arrayOf(PropTypes.object)})),onBeforeScroll:PropTypes.func,onScroll:PropTypes.func};export default Surnames;
//# sourceMappingURL=surnames.js.map
