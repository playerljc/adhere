"use strict";var __spreadArray=function(e,r,t){if(t||2===arguments.length)for(var n,a=0,u=r.length;a<u;a++)!n&&a in r||((n=n||Array.prototype.slice.call(r,0,a))[a]=r[a]);return e.concat(n||Array.prototype.slice.call(r))},__importDefault=function(e){return e&&e.__esModule?e:{default:e}},ahooks_1=(Object.defineProperty(exports,"__esModule",{value:!0}),exports.useCascaderData=exports.useAsyncCascader=exports.useAsyncTreeSelect=exports.useTreeSelectLeaf=void 0,require("ahooks")),react_1=require("react"),adhere_util_1=__importDefault(require("@baifendian/adhere-util")),adhere_util_dict_1=__importDefault(require("@baifendian/adhere-util-dict")),util_1=require("./util"),useTreeSelectLeaf=function(r){return(0,react_1.useMemo)(function(){var e=JSON.parse(JSON.stringify(r));return function r(e){(e||[]).forEach(function(e){e.disabled=!("leaf"in e&&e.leaf),r(e.children)})}(e),e},[r])},useAsyncTreeSelect=(exports.useTreeSelectLeaf=useTreeSelectLeaf,function(e,r){function a(e,a){return function e(r){for(var t,n=0;n<r.length;n++){if(r[n].value===a){t=r[n];break}if(t=e(r[n].children||[]))break}return t}(e)}function t(){p(null!=l?l:"",i).then(function(e){_(e)})}function n(){Promise.all([u(l),null==o?void 0:o(f,i)]).then(function(e){var r=e[0],r=void 0===r?[]:r,e=e[1],t=void 0===e?[]:e;_(__spreadArray(__spreadArray([],null!=t?t:[],!0),(null!=r?r:[]).filter(function(e){return!(null!=t?t:[]).map(function(e){return e.value}).includes(e.value)}),!0))})}function u(e){return p(e,i).then(function(e){return e})}var i=r.cascadeParams,c=r.onDataSourceChange,o=r.fetchBranch,l=r.defaultId,f=r.value,d=r.treeDataSimpleMode,r=(0,react_1.useState)([]),s=r[0],_=r[1],h=(0,react_1.useRef)(),p=adhere_util_dict_1.default.value[e].value;return(0,ahooks_1.useMount)(function(){(f&&(!Array.isArray(f)||f.length)?n:t)()}),(0,ahooks_1.useUpdateEffect)(function(){h.current||n()},[f]),(0,ahooks_1.useUpdateEffect)(function(){(f?n:t)()},[(0,util_1.deepDep)(i)]),(0,ahooks_1.useUpdateEffect)(function(){null!=c&&c(s)},[s]),{treeData:s,onLoadData:function(e){var n=e.value;return new Promise(function(e){setTimeout(function(){u(n).then(function(r){_(function(e){var t;return d?__spreadArray(__spreadArray([],r,!0),e.filter(function(e){return e.pId!==n}),!0):((t=a(e,n)).children&&Array.isArray(t.children)&&t.children.length?t.children=__spreadArray(__spreadArray([],t.children,!0),r.filter(function(r){return t.children.find(function(e){return e.value!==r.value})}),!0):t.children=r,__spreadArray([],e,!0))})}),e(void 0)},300)})},onChange:function(e,r){h.current=r,e.apply(void 0,r)}}});function useAsyncCascader(e,r){function a(e,a){return function e(r){for(var t,n=0;n<r.length;n++){if(r[n].value===a){t=r[n];break}if(t=e(r[n].children||[]))break}return t}(e)}function t(){p(null!=l?l:"",i).then(function(e){_(e)})}function n(){Promise.all([u(l),null==o?void 0:o(f,i)]).then(function(e){var r=e[0],t=e[1];_(__spreadArray(__spreadArray([],t,!0),r.filter(function(e){return!t.map(function(e){return e.value}).includes(e.value)}),!0))})}function u(e){return p(e,i).then(function(e){return e})}var i=r.cascadeParams,c=r.onDataSourceChange,o=r.fetchBranch,l=r.defaultId,f=r.value,d=r.treeDataSimpleMode,r=(0,react_1.useState)([]),s=r[0],_=r[1],h=(0,react_1.useRef)(),p=adhere_util_dict_1.default.value[e].value;return(0,ahooks_1.useMount)(function(){(f&&(!Array.isArray(f)||f.length)?n:t)()}),(0,ahooks_1.useUpdateEffect)(function(){h.current||n()},[f]),(0,ahooks_1.useUpdateEffect)(function(){(f?n:t)()},[(0,util_1.deepDep)(i)]),(0,ahooks_1.useUpdateEffect)(function(){null!=c&&c(s)},[s]),{treeData:s,onLoadData:function(r){return new Promise(function(e){var n=r[r.length-1].value;setTimeout(function(){u(n).then(function(r){_(function(e){var t;return d?__spreadArray(__spreadArray([],r,!0),e.filter(function(e){return e.pId!==n}),!0):((t=a(e,n)).children&&Array.isArray(t.children)&&t.children.length?t.children=__spreadArray(__spreadArray([],t.children,!0),r.filter(function(r){return t.children.find(function(e){return e.value!==r.value})}),!0):t.children=r,__spreadArray([],e,!0))})}),e(void 0)},300)})},onChange:function(e,r){h.current=r,e.apply(void 0,r)}}}function useCascaderData(e){var r=e.options,t=e.treeDataSimpleMode,n=e.config,e=(0,react_1.useCallback)(function(){var e;return adhere_util_1.default.arrayToAntdTreeSelect(r,{keyAttr:null!=(e=null==n?void 0:n.keyAttr)?e:"value",titleAttr:null!=(e=null==n?void 0:n.titleAttr)?e:"value",rootParentId:null!=(e=null==n?void 0:n.rootParentId)?e:0,parentIdAttr:null!=(e=null==n?void 0:n.parentIdAttr)?e:"pId"})},[r]);return t?e():r}exports.useAsyncTreeSelect=useAsyncTreeSelect,exports.useAsyncCascader=useAsyncCascader,exports.useCascaderData=useCascaderData;
//# sourceMappingURL=hooks.js.map
