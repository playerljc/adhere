{"version":3,"file":"Util.js","sources":["cropping/Util.js"],"sourcesContent":["var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n    return t;\n  };\n  return __assign.apply(this, arguments);\n};\nimport { SelectType } from '../types';\n/**\n * drawCircle\n * @param {CanvasRenderingContext2D} ctx\n * @param {ICircleData} data\n */\nexport function drawCircle(ctx, data) {\n  var _a, _b;\n  ctx === null || ctx === void 0 ? void 0 : ctx.beginPath();\n  ctx === null || ctx === void 0 ? void 0 : ctx.ellipse(((_a = data.data.center) === null || _a === void 0 ? void 0 : _a.x) || 0, ((_b = data.data.center) === null || _b === void 0 ? void 0 : _b.y) || 0, data.data.radius, data.data.radius, 45 * Math.PI / 180, 0, 2 * Math.PI);\n  ctx === null || ctx === void 0 ? void 0 : ctx.closePath();\n}\n/**\n * getCircleRectangle\n * @param {ICircleData} circleData\n * @return {RectangleData}\n */\nexport function getCircleRectangle(circleData) {\n  return getSelfRectangle({\n    leftTopPoint: {\n      x: circleData.center.x - circleData.radius,\n      y: circleData.center.y - circleData.radius\n    },\n    width: circleData.radius * 2,\n    height: circleData.radius * 2\n  });\n}\n/**\n * drawRectangle\n * @param {CanvasRenderingContext2D} ctx\n * @param {IRectangleData} data\n */\nexport function drawRectangle(ctx, data) {\n  var _a, _b;\n  ctx === null || ctx === void 0 ? void 0 : ctx.beginPath();\n  ctx.rect(((_a = data.data.leftTopPoint) === null || _a === void 0 ? void 0 : _a.x) || 0, ((_b = data.data.leftTopPoint) === null || _b === void 0 ? void 0 : _b.y) || 0, data.data.width, data.data.height);\n  ctx === null || ctx === void 0 ? void 0 : ctx.closePath();\n}\n/**\n * getSelfRectangle\n * @param {IRectangleData} rectangleData\n * @return {RectangleData}\n */\nexport function getSelfRectangle(rectangleData) {\n  return __assign({}, rectangleData);\n}\n/**\n * drawDiamond\n * @param {CanvasRenderingContext2D} ctx\n * @param {IDiamondData} data\n */\nexport function drawDiamond(ctx, data) {\n  ctx === null || ctx === void 0 ? void 0 : ctx.beginPath();\n  var widthHalf = data.data.width / 2;\n  var heightHalf = data.data.height / 2;\n  // 顺时针方向绘制\n  ctx.moveTo(data.data.leftTopPoint.x, data.data.leftTopPoint.y + heightHalf);\n  ctx.lineTo(data.data.leftTopPoint.x + widthHalf, data.data.leftTopPoint.y);\n  ctx.lineTo(data.data.leftTopPoint.x + data.data.width, data.data.leftTopPoint.y + heightHalf);\n  ctx.lineTo(data.data.leftTopPoint.x + widthHalf, data.data.leftTopPoint.y + data.data.height);\n  ctx === null || ctx === void 0 ? void 0 : ctx.closePath();\n}\n/**\n * getDiamondRectangle\n * @param {IDiamondData} diamondData\n * @return {RectangleData}\n */\nexport function getDiamondRectangle(diamondData) {\n  return __assign({}, diamondData);\n}\n/**\n * drawStart\n * @param {CanvasRenderingContext2D} ctx\n * @param {IStartData} data\n */\nexport function drawStart(ctx, data) {\n  ctx === null || ctx === void 0 ? void 0 : ctx.beginPath();\n  var startCount = 5;\n  var spend = 360 / startCount;\n  var min = 90 - spend;\n  var max = spend - min;\n  for (var i = 0; i < startCount; i++) {\n    ctx.lineTo(Math.cos((min + i * spend) / 180 * Math.PI) * data.data.outRadius + data.data.center.x, -Math.sin((min + i * spend) / 180 * Math.PI) * data.data.outRadius + data.data.center.y);\n    ctx.lineTo(Math.cos((max + i * spend) / 180 * Math.PI) * data.data.innerRadius + data.data.center.x, -Math.sin((max + i * spend) / 180 * Math.PI) * data.data.innerRadius + data.data.center.y);\n  }\n  ctx === null || ctx === void 0 ? void 0 : ctx.closePath();\n}\n/**\n * getStartRectangle\n * @param {IStartData} startData\n * @return {RectangleData}\n */\nexport function getStartRectangle(startData) {\n  return getCircleRectangle({\n    center: startData.center,\n    radius: startData.outRadius\n  });\n}\n/**\n * drawTriangle\n * @param {CanvasRenderingContext2D} ctx\n * @param {ITriangleData} data\n */\nexport function drawTriangle(ctx, data) {\n  ctx === null || ctx === void 0 ? void 0 : ctx.beginPath();\n  ctx.moveTo(data.data.points[0].x, data.data.points[0].y);\n  ctx.lineTo(data.data.points[1].x, data.data.points[1].y);\n  ctx.lineTo(data.data.points[2].x, data.data.points[2].y);\n  ctx === null || ctx === void 0 ? void 0 : ctx.closePath();\n}\n/**\n * getTriangleRectangle\n * @param {ITriangleData} triangleData\n * @return {RectangleData}\n */\nexport function getTriangleRectangle(triangleData) {\n  return getSelfRectangle({\n    leftTopPoint: {\n      x: triangleData.points[0].x,\n      y: triangleData.points[1].y\n    },\n    width: triangleData.points[2].x - triangleData.points[0].x,\n    height: triangleData.points[2].y - triangleData.points[1].y\n  });\n}\n/**\n * drawPolygon\n * @param {CanvasRenderingContext2D} ctx\n * @param {IPolygonData} data\n */\nexport function drawPolygon(ctx, data) {\n  ctx.beginPath();\n  ((data === null || data === void 0 ? void 0 : data.data) || []).forEach(function (point, index) {\n    if (index === 0) {\n      ctx.moveTo(point.x, point.y);\n    } else {\n      ctx.lineTo(point.x, point.y);\n    }\n  });\n  ctx === null || ctx === void 0 ? void 0 : ctx.closePath();\n}\n/**\n * getPolygonRectangle\n * @param {IPolygonData} polygonData\n * @return {RectangleData}\n */\nexport function getPolygonRectangle(polygonData) {\n  var arrX = polygonData.map(function (_a) {\n    var x = _a.x;\n    return x;\n  });\n  var arrY = polygonData.map(function (_a) {\n    var y = _a.y;\n    return y;\n  });\n  var getMinMaxX = function () {\n    return {\n      minX: Math.min.apply(Math, arrX),\n      maxX: Math.max.apply(Math, arrX)\n    };\n  };\n  var getMinMaxY = function () {\n    return {\n      minY: Math.min.apply(Math, arrY),\n      maxY: Math.max.apply(Math, arrY)\n    };\n  };\n  var _a = getMinMaxX(),\n    minX = _a.minX,\n    maxX = _a.maxX;\n  var _b = getMinMaxY(),\n    minY = _b.minY,\n    maxY = _b.maxY;\n  return {\n    leftTopPoint: {\n      x: minX,\n      y: minY\n    },\n    width: maxX - minX,\n    height: maxY - minY\n  };\n}\n/**\n * getClipDataUrl\n * @param {IActionData} data\n * @param {CanvasRenderingContext2D} clipCtx\n * @return {string}\n */\nexport function getClipDataUrl(_a) {\n  var _b;\n  var data = _a.data,\n    clipCtx = _a.clipCtx;\n  var map = new Map([[SelectType.Circle, getCircleRectangle], [SelectType.Rectangle, getSelfRectangle], [SelectType.Diamond, getDiamondRectangle], [SelectType.Start, getStartRectangle], [SelectType.Triangle, getTriangleRectangle], [SelectType.Polygon, getPolygonRectangle]]);\n  // 根据类型获取矩形数据\n  var rectangleData = (_b = map.get(data.data.type)) === null || _b === void 0 ? void 0 : _b(data.data.data);\n  // clipImageData = getImageData\n  var clipImageData = clipCtx.getImageData(rectangleData.leftTopPoint.x, rectangleData.leftTopPoint.y, rectangleData.width, rectangleData.height);\n  // put clipImageData to canvas\n  var canvas = document.createElement('canvas');\n  canvas.width = rectangleData.width;\n  canvas.height = rectangleData.height;\n  var ctx = canvas.getContext('2d');\n  ctx.putImageData(clipImageData, 0, 0);\n  // canvas to dataUrl\n  return canvas.toDataURL('image/png', 1);\n}\n/**\n * sort\n * @param {Array<{ [key: string]: any; sort?: number }>} arr\n * @returns {Array<any>}\n */\nexport function sort(arr) {\n  var result = Array.from({\n    length: arr.length\n  }).fill(null);\n  var sortArr = [];\n  arr.forEach(function (t, index) {\n    if ('sort' in t) {\n      sortArr.push(t);\n    } else {\n      result[index] = t;\n    }\n  });\n  sortArr.forEach(function (t) {\n    result.splice(t.sort, 0, t);\n  });\n  return result.filter(function (t) {\n    return !!t;\n  });\n}"],"names":["__assign","this","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","SelectType","drawCircle","ctx","data","_b","beginPath","ellipse","_a","center","x","y","radius","Math","PI","closePath","getCircleRectangle","circleData","getSelfRectangle","leftTopPoint","width","height","drawRectangle","rect","rectangleData","drawDiamond","widthHalf","heightHalf","moveTo","lineTo","getDiamondRectangle","diamondData","drawStart","spend","cos","outRadius","sin","innerRadius","getStartRectangle","startData","drawTriangle","points","getTriangleRectangle","triangleData","drawPolygon","forEach","point","index","getPolygonRectangle","polygonData","arrX","map","arrY","minX","min","maxX","max","minY","maxY","getClipDataUrl","clipCtx","Map","Circle","Rectangle","Diamond","Start","Triangle","Polygon","get","type","clipImageData","getImageData","canvas","document","createElement","getContext","putImageData","toDataURL","sort","arr","result","Array","from","fill","sortArr","push","splice","filter"],"mappings":"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"}