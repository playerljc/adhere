{"version":3,"file":"CroppingCore.js","sources":["cropping/CroppingCore.js"],"sourcesContent":["import _Space from \"antd/es/space\";\nimport _Card from \"antd/es/card\";\nimport _Button from \"antd/es/button\";\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n    return t;\n  };\n  return __assign.apply(this, arguments);\n};\nimport { useUpdateLayoutEffect } from 'ahooks';\nimport classNames from 'classnames';\nimport React, { forwardRef, memo, useCallback, useImperativeHandle, useLayoutEffect, useMemo, useRef, useState } from 'react';\nimport FlexLayout from '@baifendian/adhere-ui-flexlayout';\nimport Intl from '@baifendian/adhere-util-intl';\nimport CircleDrawAction from '../draw/CircleDrawAction';\nimport DiamondDrawAction from '../draw/DiamondDrawAction';\nimport PolygonDrawAction from '../draw/PolygonDrawAction';\nimport RectangleDrawAction from '../draw/RectangleDrawAction';\nimport StartDrawAction from '../draw/StartDrawAction';\nimport TriangleDrawAction from '../draw/TriangleDrawAction';\nimport PolygonSelection from '../index';\nimport CircleModifyAction from '../modify/CircleModifyAction';\nimport DiamondModifyAction from '../modify/DiamondModifyAction';\nimport PolygonModifyAction from '../modify/PolygonModifyAction';\nimport RectangleModifyAction from '../modify/RectangleModifyAction';\nimport StartModifyAction from '../modify/StartModifyAction';\nimport TriangleModifyAction from '../modify/TriangleModifyAction';\nimport { ActionEvents, PolygonSelectionActions, SelectType } from '../types';\nimport { drawCircle, drawDiamond, drawPolygon, drawRectangle, drawStart, drawTriangle, getClipDataUrl, sort } from './util';\nvar selectorPrefix = 'adhere-ui-cropping-core';\n/**\n * CroppingCore\n * @param props\n * @param ref\n * @constructor\n */\nvar CroppingCore = function CroppingCore(_a, ref) {\n  var _b;\n  var className = _a.className,\n    wrapStyle = _a.style,\n    wrapProps = _a.wrapProps,\n    toolProps = _a.toolProps,\n    areaProps = _a.areaProps,\n    _c = _a.minHeight,\n    minHeight = _c === void 0 ? 200 : _c,\n    toolBarConfig = _a.toolBarConfig;\n  var _d = useState(null),\n    type = _d[0],\n    setType = _d[1];\n  var _e = useState(''),\n    base64 = _e[0],\n    setBase64 = _e[1];\n  var base64Ref = useRef(null);\n  var wrapRef = useRef(null);\n  var clipRef = useRef(null);\n  var clipCanvasEL = useRef(null);\n  var clipCanvasCtx = useRef();\n  var geometryRef = useRef(null);\n  var polygonSelection = useRef();\n  var curAction = useRef(null);\n  var inputFileFieldRef = useRef(null);\n  var data = useRef(null);\n  var layoutMap = new Map([['left', function () {\n    return /*#__PURE__*/React.createElement(FlexLayout.TRBLC.LCLayout, __assign({}, defaultProps, wrapProps, {\n      lProps: __assign(__assign(__assign({}, defaultToolbarProps), toolProps), {\n        render: renderTool\n      }),\n      cProps: __assign(__assign(__assign({}, defaultCProps), areaProps), {\n        render: renderArea\n      })\n    }));\n  }], ['right', function () {\n    return /*#__PURE__*/React.createElement(FlexLayout.TRBLC.CRLayout, __assign({}, defaultProps, wrapProps, {\n      rProps: __assign(__assign(__assign({}, defaultToolbarProps), toolProps), {\n        render: renderTool\n      }),\n      cProps: __assign(__assign(__assign({}, defaultCProps), areaProps), {\n        render: renderArea\n      })\n    }));\n  }], ['top', function () {\n    return /*#__PURE__*/React.createElement(FlexLayout.TRBLC.TCLayout, __assign({}, defaultProps, wrapProps, {\n      tProps: __assign(__assign(__assign({}, defaultToolbarProps), toolProps), {\n        render: renderTool\n      }),\n      cProps: __assign(__assign(__assign({}, defaultCProps), areaProps), {\n        render: renderArea\n      })\n    }));\n  }], ['bottom', function () {\n    return /*#__PURE__*/React.createElement(FlexLayout.TRBLC.CBLayout, __assign({}, defaultProps, wrapProps, {\n      bProps: __assign(__assign(__assign({}, defaultToolbarProps), toolProps), {\n        render: renderTool\n      }),\n      cProps: __assign(__assign(__assign({}, defaultCProps), areaProps), {\n        render: renderArea\n      })\n    }));\n  }]]);\n  // ActionType\n  var typeActionMap = useMemo(function () {\n    return new Map([[SelectType.Polygon, PolygonModifyAction], [SelectType.Circle, CircleModifyAction], [SelectType.Rectangle, RectangleModifyAction], [SelectType.Triangle, TriangleModifyAction], [SelectType.Diamond, DiamondModifyAction], [SelectType.Start, StartModifyAction]]);\n  }, []);\n  var style = useMemo(function () {\n    return {\n      fillStyle: 'transparent',\n      // 描边颜色\n      strokeStyle: '#fff',\n      // 描边大小\n      lineWidth: 1,\n      lineCap: 'round',\n      lineJoin: 'round',\n      lineDash: [\n        /*5, 4, 3*/\n      ],\n      lineDashOffset: -1,\n      globalAlpha: 1\n    };\n  }, []);\n  var anchorStyle = {\n    fillStyle: '#fff'\n  };\n  /**\n   * defaultProps\n   */\n  var defaultProps = useMemo(function () {\n    return {\n      gutter: 20,\n      wrapClassName: \"\".concat(selectorPrefix, \"-inner\")\n    };\n  }, []);\n  /**\n   * defaultToolbarProps\n   */\n  var defaultToolbarProps = useMemo(function () {\n    return {\n      fit: true\n    };\n  }, []);\n  /**\n   * defaultCProps\n   */\n  var defaultCProps = useMemo(function () {\n    return {\n      autoFixed: true\n    };\n  }, []);\n  /**\n   * renderTool\n   */\n  var renderTool = useCallback(function () {\n    var _a, _b, _c;\n    var getType = function getType(_type) {\n      return _type === type ? 'primary' : 'default';\n    };\n    var onBeforeClick = function onBeforeClick(_type) {\n      var _a, _b;\n      if (_type !== type) {\n        clearClip();\n        (_b = (_a = polygonSelection === null || polygonSelection === void 0 ? void 0 : polygonSelection.current) === null || _a === void 0 ? void 0 : _a.clearCanvasAll) === null || _b === void 0 ? void 0 : _b.call(_a);\n        data.current = null;\n        setType(_type);\n      }\n      return _type !== type ? Promise.resolve() : Promise.reject();\n    };\n    var onClickHOC = function onClickHOC(type, ActionClass) {\n      return function () {\n        onBeforeClick(type).then(function () {\n          var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m;\n          curAction.current = new ActionClass();\n          if (!curAction.current) return;\n          curAction.current.setAnchorStyle(__assign({}, anchorStyle));\n          curAction.current.setMoveGemStyle(__assign({}, anchorStyle));\n          (_b = (_a = curAction === null || curAction === void 0 ? void 0 : curAction.current) === null || _a === void 0 ? void 0 : _a.on) === null || _b === void 0 ? void 0 : _b.call(_a, ActionEvents.DrawBeforeStart, function (e) {\n            // console.log('绘制开始前', JSON.stringify(e));\n            clip(e);\n          });\n          (_d = (_c = curAction === null || curAction === void 0 ? void 0 : curAction.current) === null || _c === void 0 ? void 0 : _c.on) === null || _d === void 0 ? void 0 : _d.call(_c, ActionEvents.DrawStart, function (e) {\n            // console.log('绘制开始', JSON.stringify(e));\n            clip(e);\n          });\n          (_f = (_e = curAction === null || curAction === void 0 ? void 0 : curAction.current) === null || _e === void 0 ? void 0 : _e.on) === null || _f === void 0 ? void 0 : _f.call(_e, ActionEvents.Drawing, function (e) {\n            // console.log('绘制中', JSON.stringify(e));\n            clip(e);\n          });\n          (_h = (_g = curAction === null || curAction === void 0 ? void 0 : curAction.current) === null || _g === void 0 ? void 0 : _g.on) === null || _h === void 0 ? void 0 : _h.call(_g, ActionEvents.DrawEnd, function (e) {\n            // curAction.current.start(data?.style);\n            // console.log('绘制完成', JSON.stringify(e));\n            clip(e);\n          });\n          (_k = (_j = polygonSelection === null || polygonSelection === void 0 ? void 0 : polygonSelection.current) === null || _j === void 0 ? void 0 : _j.changeAction) === null || _k === void 0 ? void 0 : _k.call(_j, curAction.current);\n          (_m = (_l = curAction === null || curAction === void 0 ? void 0 : curAction.current) === null || _l === void 0 ? void 0 : _l.start) === null || _m === void 0 ? void 0 : _m.call(_l, style);\n        });\n      };\n    };\n    /**\n     * renderCroppingTools\n     * @returns\n     */\n    var renderCroppingTools = function renderCroppingTools() {\n      var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t;\n      var tools = [{\n        key: 'rectangle',\n        value: (!toolBarConfig || !('rectangle' in toolBarConfig) || !('hide' in toolBarConfig.rectangle) || !((_a = toolBarConfig === null || toolBarConfig === void 0 ? void 0 : toolBarConfig.rectangle) === null || _a === void 0 ? void 0 : _a.hide)) && (((_c = (_b = toolBarConfig === null || toolBarConfig === void 0 ? void 0 : toolBarConfig.rectangle) === null || _b === void 0 ? void 0 : _b.render) === null || _c === void 0 ? void 0 : _c.call(_b, onClickHOC(SelectType.Rectangle, RectangleDrawAction))) || /*#__PURE__*/React.createElement(_Button, {\n          key: \"rectangle\",\n          block: true,\n          size: \"large\",\n          type: getType(SelectType.Rectangle),\n          onClick: onClickHOC(SelectType.Rectangle, RectangleDrawAction)\n        }, Intl.v('矩形剪裁')))\n      }, {\n        key: 'circle',\n        value: (!toolBarConfig || !('circle' in toolBarConfig) || !('hide' in toolBarConfig.circle) || !((_d = toolBarConfig === null || toolBarConfig === void 0 ? void 0 : toolBarConfig.circle) === null || _d === void 0 ? void 0 : _d.hide)) && (((_f = (_e = toolBarConfig === null || toolBarConfig === void 0 ? void 0 : toolBarConfig.circle) === null || _e === void 0 ? void 0 : _e.render) === null || _f === void 0 ? void 0 : _f.call(_e, onClickHOC(SelectType.Circle, CircleDrawAction))) || /*#__PURE__*/React.createElement(_Button, {\n          key: \"circle\",\n          block: true,\n          size: \"large\",\n          type: getType(SelectType.Circle),\n          onClick: onClickHOC(SelectType.Circle, CircleDrawAction)\n        }, Intl.v('圆形剪裁')))\n      }, {\n        key: 'start',\n        value: (!toolBarConfig || !('start' in toolBarConfig) || !('hide' in toolBarConfig.start) || !((_g = toolBarConfig === null || toolBarConfig === void 0 ? void 0 : toolBarConfig.start) === null || _g === void 0 ? void 0 : _g.hide)) && (((_j = (_h = toolBarConfig === null || toolBarConfig === void 0 ? void 0 : toolBarConfig.start) === null || _h === void 0 ? void 0 : _h.render) === null || _j === void 0 ? void 0 : _j.call(_h, onClickHOC(SelectType.Start, StartDrawAction))) || /*#__PURE__*/React.createElement(_Button, {\n          key: \"start\",\n          block: true,\n          size: \"large\",\n          type: getType(SelectType.Start),\n          onClick: onClickHOC(SelectType.Start, StartDrawAction)\n        }, Intl.v('五角星剪裁')))\n      }, {\n        key: 'triangle',\n        value: (!toolBarConfig || !('triangle' in toolBarConfig) || !('hide' in toolBarConfig.triangle) || !((_k = toolBarConfig === null || toolBarConfig === void 0 ? void 0 : toolBarConfig.triangle) === null || _k === void 0 ? void 0 : _k.hide)) && (((_m = (_l = toolBarConfig === null || toolBarConfig === void 0 ? void 0 : toolBarConfig.triangle) === null || _l === void 0 ? void 0 : _l.render) === null || _m === void 0 ? void 0 : _m.call(_l, onClickHOC(SelectType.Triangle, TriangleDrawAction))) || /*#__PURE__*/React.createElement(_Button, {\n          key: \"triangle\",\n          block: true,\n          size: \"large\",\n          type: getType(SelectType.Triangle),\n          onClick: onClickHOC(SelectType.Triangle, TriangleDrawAction)\n        }, Intl.v('三角形剪裁')))\n      }, {\n        key: 'diamond',\n        value: (!toolBarConfig || !('diamond' in toolBarConfig) || !('hide' in toolBarConfig.diamond) || !((_o = toolBarConfig === null || toolBarConfig === void 0 ? void 0 : toolBarConfig.diamond) === null || _o === void 0 ? void 0 : _o.hide)) && (((_q = (_p = toolBarConfig === null || toolBarConfig === void 0 ? void 0 : toolBarConfig.diamond) === null || _p === void 0 ? void 0 : _p.render) === null || _q === void 0 ? void 0 : _q.call(_p, onClickHOC(SelectType.Diamond, DiamondDrawAction))) || /*#__PURE__*/React.createElement(_Button, {\n          key: \"diamond\",\n          block: true,\n          size: \"large\",\n          type: getType(SelectType.Diamond),\n          onClick: onClickHOC(SelectType.Diamond, DiamondDrawAction)\n        }, Intl.v('菱形剪裁')))\n      }, {\n        key: 'polygon',\n        value: (!toolBarConfig || !('polygon' in toolBarConfig) || !('hide' in toolBarConfig.polygon) || !((_r = toolBarConfig === null || toolBarConfig === void 0 ? void 0 : toolBarConfig.polygon) === null || _r === void 0 ? void 0 : _r.hide)) && (((_t = (_s = toolBarConfig === null || toolBarConfig === void 0 ? void 0 : toolBarConfig.polygon) === null || _s === void 0 ? void 0 : _s.render) === null || _t === void 0 ? void 0 : _t.call(_s, onClickHOC(SelectType.Polygon, PolygonDrawAction))) || /*#__PURE__*/React.createElement(_Button, {\n          key: \"polygon\",\n          block: true,\n          size: \"large\",\n          type: getType(SelectType.Polygon),\n          onClick: onClickHOC(SelectType.Polygon, PolygonDrawAction)\n        }, Intl.v('多边形剪裁')))\n      }];\n      return tools.filter(function (t) {\n        return !!t.value;\n      });\n    };\n    var toolsArr = [{\n      key: 'open',\n      value: ((_b = (_a = toolBarConfig === null || toolBarConfig === void 0 ? void 0 : toolBarConfig.open) === null || _a === void 0 ? void 0 : _a.render) === null || _b === void 0 ? void 0 : _b.call(_a, function () {\n        var _a;\n        (_a = inputFileFieldRef.current) === null || _a === void 0 ? void 0 : _a.click();\n      })) || /*#__PURE__*/React.createElement(_Button, {\n        key: \"open\",\n        block: true,\n        size: \"large\",\n        type: \"primary\",\n        onClick: function onClick() {\n          var _a;\n          (_a = inputFileFieldRef.current) === null || _a === void 0 ? void 0 : _a.click();\n        }\n      }, Intl.v('打开'))\n    }, base64 ? renderCroppingTools() : [{\n      key: '',\n      value: null\n    }]].flat().filter(function (t) {\n      return !!t.value;\n    });\n    toolsArr = sort(toolsArr.map(function (t) {\n      var _a;\n      if ('sort' in ((_a = toolBarConfig === null || toolBarConfig === void 0 ? void 0 : toolBarConfig[t.key]) !== null && _a !== void 0 ? _a : {})) {\n        return __assign(__assign({}, t), {\n          sort: toolBarConfig === null || toolBarConfig === void 0 ? void 0 : toolBarConfig[t.key].sort\n        });\n      }\n      return t;\n    })).map(function (t) {\n      return t.value;\n    });\n    var direction = ['left', 'right'].includes((_c = toolBarConfig === null || toolBarConfig === void 0 ? void 0 : toolBarConfig.direction) !== null && _c !== void 0 ? _c : 'left') ? 'vertical' : 'horizontal';\n    return /*#__PURE__*/React.createElement(_Card, null, /*#__PURE__*/React.createElement(_Space, {\n      direction: direction,\n      size: 20\n    }, /*#__PURE__*/React.createElement(\"input\", {\n      type: \"file\",\n      ref: inputFileFieldRef,\n      accept: \"\",\n      style: {\n        display: 'none'\n      }\n    }), toolsArr));\n  }, [type, toolProps, base64, toolBarConfig]);\n  /**\n   * renderArea\n   */\n  var renderArea = useCallback(function () {\n    return /*#__PURE__*/React.createElement(_Card, null, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"\".concat(selectorPrefix, \"-background\"),\n      style: {\n        minHeight: minHeight || 200\n      }\n    }, base64 && /*#__PURE__*/React.createElement(\"div\", {\n      className: \"\".concat(selectorPrefix, \"-background-inner\")\n    }, /*#__PURE__*/React.createElement(\"img\", {\n      ref: base64Ref,\n      src: base64,\n      alt: \"\"\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"\".concat(selectorPrefix, \"-background-mask\")\n    }))), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"\".concat(selectorPrefix, \"-geometry\"),\n      ref: geometryRef\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"\".concat(selectorPrefix, \"-clip\"),\n      ref: clipRef\n    }));\n  }, [base64, areaProps]);\n  var image = useCallback(function () {\n    var img = new Image();\n    img.src = base64;\n    return img;\n  }, [base64]);\n  /**\n   * useUpdateLayoutEffect\n   */\n  useUpdateLayoutEffect(function () {\n    setType(null);\n    if (base64Ref.current) {\n      base64Ref.current.onload = function () {\n        if (polygonSelection.current) {\n          data.current = null;\n          destroyClip();\n          destroySelection();\n        }\n        createClip();\n        createSelection();\n      };\n    }\n  }, [base64]);\n  /**\n   * useLayoutEffect\n   */\n  useLayoutEffect(function () {\n    var _a;\n    var onChange = function onChange(e) {\n      var file = e.target.files[0];\n      var read = new FileReader();\n      read.onload = function (e) {\n        var _a;\n        setBase64((_a = e.target) === null || _a === void 0 ? void 0 : _a.result);\n      };\n      read.readAsDataURL(file);\n    };\n    (_a = inputFileFieldRef.current) === null || _a === void 0 ? void 0 : _a.addEventListener('change', onChange);\n    return function () {\n      var _a;\n      (_a = inputFileFieldRef.current) === null || _a === void 0 ? void 0 : _a.removeEventListener('change', onChange);\n    };\n  }, []);\n  useImperativeHandle(ref, function () {\n    return {\n      /**\n       * save\n       * @return {string}\n       */\n      save: function save() {\n        // 通过data获取外接矩形数据\n        // 创建一个canvas，绘制base64\n        // getImageData(矩形数据)\n        if (!data.current || !data.current.data || !base64) return '';\n        return getClipDataUrl({\n          data: data.current,\n          clipCtx: clipCanvasCtx.current\n        });\n      }\n    };\n  });\n  /**\n   * clip\n   * @param {IActionData} e\n   * @return void\n   */\n  var clip = function clip(e) {\n    var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m;\n    if (!e.data) return;\n    data.current = e;\n    (_b = (_a = clipCanvasCtx.current) === null || _a === void 0 ? void 0 : _a.restore) === null || _b === void 0 ? void 0 : _b.call(_a);\n    (_d = (_c = clipCanvasCtx.current) === null || _c === void 0 ? void 0 : _c.save) === null || _d === void 0 ? void 0 : _d.call(_c);\n    (_e = clipCanvasCtx.current) === null || _e === void 0 ? void 0 : _e.clearRect(0, 0, (_f = clipCanvasEL.current) === null || _f === void 0 ? void 0 : _f.width, (_g = clipCanvasEL.current) === null || _g === void 0 ? void 0 : _g.height);\n    var drawMap = new Map([[SelectType.Circle, drawCircle], [SelectType.Rectangle, drawRectangle], [SelectType.Diamond, drawDiamond], [SelectType.Start, drawStart], [SelectType.Triangle, drawTriangle], [SelectType.Polygon, drawPolygon]]);\n    (_h = drawMap.get(e.selectType)) === null || _h === void 0 ? void 0 : _h(clipCanvasCtx.current, e.data);\n    (_j = clipCanvasCtx === null || clipCanvasCtx === void 0 ? void 0 : clipCanvasCtx.current) === null || _j === void 0 ? void 0 : _j.clip();\n    (_k = clipCanvasCtx === null || clipCanvasCtx === void 0 ? void 0 : clipCanvasCtx.current) === null || _k === void 0 ? void 0 : _k.drawImage(image(), 0, 0, (_l = clipCanvasEL.current) === null || _l === void 0 ? void 0 : _l.width, (_m = clipCanvasEL.current) === null || _m === void 0 ? void 0 : _m.height);\n  };\n  /**\n   * clearClip\n   */\n  var clearClip = function clearClip() {\n    var _a, _b, _c, _d, _e;\n    (_a = clipCanvasCtx.current) === null || _a === void 0 ? void 0 : _a.restore();\n    (_c = (_b = clipCanvasCtx.current) === null || _b === void 0 ? void 0 : _b.clearRect) === null || _c === void 0 ? void 0 : _c.call(_b, 0, 0, (_d = clipCanvasEL.current) === null || _d === void 0 ? void 0 : _d.width, (_e = clipCanvasEL.current) === null || _e === void 0 ? void 0 : _e.height);\n  };\n  /**\n   * destroyClip\n   * @returns\n   */\n  var destroyClip = function destroyClip() {\n    if (!clipRef.current) return;\n    clipRef.current.innerHTML = '';\n  };\n  /**\n   * createClip\n   */\n  var createClip = function createClip() {\n    var _a, _b, _c, _d, _e, _f;\n    clipCanvasEL.current = document.createElement('canvas');\n    clipCanvasEL.current.width = (_a = base64Ref.current) === null || _a === void 0 ? void 0 : _a.offsetWidth;\n    clipCanvasEL.current.height = (_b = base64Ref.current) === null || _b === void 0 ? void 0 : _b.offsetHeight;\n    clipCanvasCtx.current = (_d = (_c = clipCanvasEL.current) === null || _c === void 0 ? void 0 : _c.getContext) === null || _d === void 0 ? void 0 : _d.call(_c, '2d');\n    (_f = (_e = clipRef.current) === null || _e === void 0 ? void 0 : _e.appendChild) === null || _f === void 0 ? void 0 : _f.call(_e, clipCanvasEL.current);\n  };\n  /**\n   * destroySelection\n   */\n  var destroySelection = function destroySelection() {\n    var _a, _b;\n    (_b = (_a = polygonSelection === null || polygonSelection === void 0 ? void 0 : polygonSelection.current) === null || _a === void 0 ? void 0 : _a.destroy) === null || _b === void 0 ? void 0 : _b.call(_a);\n  };\n  /**\n   * createSelection\n   * @returns\n   */\n  var createSelection = function createSelection() {\n    var _a, _b;\n    if (!geometryRef.current) return;\n    geometryRef.current.style.width = \"\".concat((_a = base64Ref === null || base64Ref === void 0 ? void 0 : base64Ref.current) === null || _a === void 0 ? void 0 : _a.offsetWidth, \"px\");\n    geometryRef.current.style.height = \"\".concat((_b = base64Ref === null || base64Ref === void 0 ? void 0 : base64Ref.current) === null || _b === void 0 ? void 0 : _b.offsetHeight, \"px\");\n    polygonSelection.current = new PolygonSelection.PolygonSelection(geometryRef.current);\n    /**\n     * CanvasClickGeometry\n     */\n    polygonSelection.current.on(PolygonSelectionActions.CanvasClickGeometry, function (data) {\n      // 多边形数据据\n      // const d = {\n      //   selectType: 'Polygon',\n      //   actionType: 'Draw',\n      //   data: {\n      //     id: 'fd4ef30f-8add-4cc1-8f36-d861e77b5354',\n      //     type: 'Polygon',\n      //     data: [\n      //       { x: 148.34375, y: 33 },\n      //       { x: 120.34375, y: 198 },\n      //       { x: 360.34375, y: 181 },\n      //     ],\n      //     style: {\n      //       fillStyle: 'red',\n      //       strokeStyle: '#000',\n      //       lineWidth: 2,\n      //       lineCap: 'round',\n      //       lineJoin: 'round',\n      //       lineDash: [],\n      //       lineDashOffset: -1,\n      //     },\n      //   },\n      // };\n      //\n      // polygonSelection.current.clearDraw();\n      // polygonSelection.current.addHistoryData(d.data);\n      // polygonSelection.current.drawHistoryData();\n      //\n      // const action = new PolygonModifyAction(d);\n      // action.on(ActionEvents.End, () => {\n      //   action.start();\n      // });\n      // polygonSelection.current.changeAction(action);\n      // action.start();\n      var _a;\n      // console.log('click');\n      var Component = typeActionMap.get(data.type);\n      var action = new Component({\n        selectType: data.type,\n        actionType: 'Draw',\n        data: data\n      });\n      action.setAnchorStyle(__assign({}, anchorStyle));\n      action.setMoveGemStyle(__assign({}, anchorStyle));\n      action.on(ActionEvents.ModifyBeforeStart, function (e) {\n        // console.log('修改开始前', JSON.stringify(e));\n        clip(e);\n      });\n      action.on(ActionEvents.ModifyStart, function (e) {\n        // console.log('修改开始', JSON.stringify(e));\n        clip(e);\n      });\n      action.on(ActionEvents.Modifying, function (e) {\n        // console.log('修改中', JSON.stringify(e));\n        clip(e);\n      });\n      action.on(ActionEvents.ModifyEnd, function (e) {\n        // console.log('修改完成', JSON.stringify(e));\n        clip(e);\n        action.start();\n      });\n      action.on(ActionEvents.Moving, function (e) {\n        // console.log('移动中', JSON.stringify(e));\n        clip(e);\n      });\n      action.on(ActionEvents.MoveEnd, function (e) {\n        // console.log('移动完成', JSON.stringify(e));\n        clip(e);\n      });\n      (_a = polygonSelection === null || polygonSelection === void 0 ? void 0 : polygonSelection.current) === null || _a === void 0 ? void 0 : _a.changeAction(action);\n      action.start();\n    });\n    /**\n     * CanvasClickEmpty\n     */\n    polygonSelection.current.on(PolygonSelectionActions.CanvasClickEmpty, function () {\n      var _a, _b, _c;\n      // console.log('clickEmpty');\n      (_a = polygonSelection === null || polygonSelection === void 0 ? void 0 : polygonSelection.current) === null || _a === void 0 ? void 0 : _a.clearDraw();\n      (_b = polygonSelection === null || polygonSelection === void 0 ? void 0 : polygonSelection.current) === null || _b === void 0 ? void 0 : _b.clearAssistDraw();\n      (_c = polygonSelection === null || polygonSelection === void 0 ? void 0 : polygonSelection.current) === null || _c === void 0 ? void 0 : _c.drawHistoryData();\n    });\n  };\n  var children = (_b = layoutMap.get((toolBarConfig === null || toolBarConfig === void 0 ? void 0 : toolBarConfig.direction) || 'left')) === null || _b === void 0 ? void 0 : _b();\n  return /*#__PURE__*/React.createElement(\"div\", {\n    ref: wrapRef,\n    className: \"\".concat(classNames(selectorPrefix, className || '')),\n    style: wrapStyle || {}\n  }, children);\n};\nvar CroppingCoreHOC = /*#__PURE__*/memo( /*#__PURE__*/forwardRef(CroppingCore));\nexport default CroppingCoreHOC;"],"names":["_Space","_Card","_Button","__assign","this","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","useUpdateLayoutEffect","classNames","React","forwardRef","memo","useCallback","useImperativeHandle","useLayoutEffect","useMemo","useRef","useState","FlexLayout","Intl","CircleDrawAction","DiamondDrawAction","PolygonDrawAction","RectangleDrawAction","StartDrawAction","TriangleDrawAction","PolygonSelection","CircleModifyAction","DiamondModifyAction","PolygonModifyAction","RectangleModifyAction","StartModifyAction","TriangleModifyAction","ActionEvents","PolygonSelectionActions","SelectType","drawCircle","drawDiamond","drawPolygon","drawRectangle","drawStart","drawTriangle","getClipDataUrl","sort","selectorPrefix","CroppingCore","_a","ref","className","wrapStyle","style","wrapProps","toolProps","areaProps","_c","minHeight","toolBarConfig","_d","type","setType","_e","base64","setBase64","base64Ref","wrapRef","clipRef","clipCanvasEL","clipCanvasCtx","geometryRef","polygonSelection","curAction","inputFileFieldRef","data","layoutMap","Map","createElement","TRBLC","LCLayout","defaultProps","lProps","defaultToolbarProps","render","renderTool","cProps","defaultCProps","renderArea","CRLayout","rProps","TCLayout","tProps","CBLayout","bProps","typeActionMap","Polygon","Circle","Rectangle","Triangle","Diamond","Start","fillStyle","strokeStyle","lineWidth","lineCap","lineJoin","lineDash","lineDashOffset","globalAlpha","anchorStyle","gutter","wrapClassName","concat","fit","autoFixed","_s","getType","_type","onClickHOC","ActionClass","_b","clearClip","current","clearCanvasAll","Promise","resolve","reject","then","_l","_m","setAnchorStyle","setMoveGemStyle","on","DrawBeforeStart","e","clip","DrawStart","_f","Drawing","_h","_g","DrawEnd","_k","_j","changeAction","start","toolsArr","key","value","open","click","block","size","onClick","v","rectangle","hide","circle","triangle","diamond","_o","_q","_p","polygon","_r","_t","filter","flat","map","direction","includes","accept","display","src","alt","image","img","Image","onload","destroyClip","destroySelection","createClip","createSelection","onChange","file","target","files","read","FileReader","result","readAsDataURL","addEventListener","removeEventListener","save","clipCtx","restore","clearRect","width","height","get","selectType","drawImage","innerHTML","document","offsetWidth","offsetHeight","getContext","appendChild","destroy","CanvasClickGeometry","action","actionType","ModifyBeforeStart","ModifyStart","Modifying","ModifyEnd","Moving","MoveEnd","CanvasClickEmpty","clearDraw","clearAssistDraw","drawHistoryData","children","CroppingCoreHOC"],"mappings":"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"}