{"version":3,"file":"CroppingCore.js","sources":["cropping/CroppingCore.js"],"sourcesContent":["import _Space from \"antd/es/space\";\nimport _Card from \"antd/es/card\";\nimport _Button from \"antd/es/button\";\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n    return t;\n  };\n  return __assign.apply(this, arguments);\n};\nimport { useUpdateLayoutEffect } from 'ahooks';\nimport classNames from 'classnames';\nimport React, { forwardRef, useCallback, useImperativeHandle, useLayoutEffect, useMemo, useRef, useState } from 'react';\nimport FlexLayout from '@baifendian/adhere-ui-flexlayout';\nimport Intl from '@baifendian/adhere-util-intl';\nimport CircleDrawAction from '../draw/CircleDrawAction';\nimport DiamondDrawAction from '../draw/DiamondDrawAction';\nimport PolygonDrawAction from '../draw/PolygonDrawAction';\nimport RectangleDrawAction from '../draw/RectangleDrawAction';\nimport StartDrawAction from '../draw/StartDrawAction';\nimport TriangleDrawAction from '../draw/TriangleDrawAction';\nimport PolygonSelection from '../index';\nimport CircleModifyAction from '../modify/CircleModifyAction';\nimport DiamondModifyAction from '../modify/DiamondModifyAction';\nimport PolygonModifyAction from '../modify/PolygonModifyAction';\nimport RectangleModifyAction from '../modify/RectangleModifyAction';\nimport StartModifyAction from '../modify/StartModifyAction';\nimport TriangleModifyAction from '../modify/TriangleModifyAction';\nimport { ActionEvents, PolygonSelectionActions, SelectType } from '../types';\nimport { drawCircle, drawDiamond, drawPolygon, drawRectangle, drawStart, drawTriangle, getClipDataUrl, sort } from './Util';\nvar selectorPrefix = 'adhere-ui-cropping-core';\n/**\n * CroppingCore\n * @param props\n * @param ref\n * @constructor\n */\nvar CroppingCore = /*#__PURE__*/forwardRef(function (_a, ref) {\n  var _b;\n  var className = _a.className,\n    wrapStyle = _a.style,\n    wrapProps = _a.wrapProps,\n    toolProps = _a.toolProps,\n    areaProps = _a.areaProps,\n    _c = _a.minHeight,\n    minHeight = _c === void 0 ? 200 : _c,\n    toolBarConfig = _a.toolBarConfig;\n  var _d = useState(null),\n    type = _d[0],\n    setType = _d[1];\n  var _e = useState(''),\n    base64 = _e[0],\n    setBase64 = _e[1];\n  var base64Ref = useRef(null);\n  var wrapRef = useRef(null);\n  var clipRef = useRef(null);\n  var clipCanvasEL = useRef(null);\n  var clipCanvasCtx = useRef();\n  var geometryRef = useRef(null);\n  var polygonSelection = useRef();\n  var curAction = useRef(null);\n  var inputFileFieldRef = useRef(null);\n  var data = useRef(null);\n  var layoutMap = new Map([['left', function () {\n    return /*#__PURE__*/React.createElement(FlexLayout.TRBLC.LCLayout, __assign({}, defaultProps, wrapProps, {\n      lProps: __assign(__assign(__assign({}, defaultToolbarProps), toolProps), {\n        children: renderTool\n      }),\n      cProps: __assign(__assign(__assign({}, defaultCProps), areaProps), {\n        children: renderArea\n      })\n    }));\n  }], ['right', function () {\n    return /*#__PURE__*/React.createElement(FlexLayout.TRBLC.CRLayout, __assign({}, defaultProps, wrapProps, {\n      rProps: __assign(__assign(__assign({}, defaultToolbarProps), toolProps), {\n        children: renderTool\n      }),\n      cProps: __assign(__assign(__assign({}, defaultCProps), areaProps), {\n        children: renderArea\n      })\n    }));\n  }], ['top', function () {\n    return /*#__PURE__*/React.createElement(FlexLayout.TRBLC.TCLayout, __assign({}, defaultProps, wrapProps, {\n      tProps: __assign(__assign(__assign({}, defaultToolbarProps), toolProps), {\n        children: renderTool\n      }),\n      cProps: __assign(__assign(__assign({}, defaultCProps), areaProps), {\n        children: renderArea\n      })\n    }));\n  }], ['bottom', function () {\n    return /*#__PURE__*/React.createElement(FlexLayout.TRBLC.CBLayout, __assign({}, defaultProps, wrapProps, {\n      bProps: __assign(__assign(__assign({}, defaultToolbarProps), toolProps), {\n        children: renderTool\n      }),\n      cProps: __assign(__assign(__assign({}, defaultCProps), areaProps), {\n        children: renderArea\n      })\n    }));\n  }]]);\n  // ActionType\n  var typeActionMap = useMemo(function () {\n    return new Map([[SelectType.Polygon, PolygonModifyAction], [SelectType.Circle, CircleModifyAction], [SelectType.Rectangle, RectangleModifyAction], [SelectType.Triangle, TriangleModifyAction], [SelectType.Diamond, DiamondModifyAction], [SelectType.Start, StartModifyAction]]);\n  }, []);\n  var style = useMemo(function () {\n    return {\n      fillStyle: 'transparent',\n      // 描边颜色\n      strokeStyle: '#fff',\n      // 描边大小\n      lineWidth: 1,\n      lineCap: 'round',\n      lineJoin: 'round',\n      lineDash: [\n        /*5, 4, 3*/\n      ],\n      lineDashOffset: -1,\n      globalAlpha: 1\n    };\n  }, []);\n  var anchorStyle = {\n    fillStyle: '#fff'\n  };\n  /**\n   * defaultProps\n   */\n  var defaultProps = useMemo(function () {\n    return {\n      gutter: 20,\n      wrapClassName: \"\".concat(selectorPrefix, \"-inner\")\n    };\n  }, []);\n  /**\n   * defaultToolbarProps\n   */\n  var defaultToolbarProps = useMemo(function () {\n    return {\n      fit: true\n    };\n  }, []);\n  /**\n   * defaultCProps\n   */\n  var defaultCProps = useMemo(function () {\n    return {\n      autoFixed: true\n    };\n  }, []);\n  /**\n   * renderTool\n   */\n  var renderTool = useMemo(function () {\n    var _a, _b, _c;\n    var getType = function getType(_type) {\n      return _type === type ? 'primary' : 'default';\n    };\n    var onBeforeClick = function onBeforeClick(_type) {\n      var _a, _b;\n      if (_type !== type) {\n        clearClip();\n        (_b = (_a = polygonSelection === null || polygonSelection === void 0 ? void 0 : polygonSelection.current) === null || _a === void 0 ? void 0 : _a.clearCanvasAll) === null || _b === void 0 ? void 0 : _b.call(_a);\n        data.current = null;\n        setType(_type);\n      }\n      return _type !== type ? Promise.resolve() : Promise.reject();\n    };\n    var onClickHOC = function onClickHOC(type, ActionClass) {\n      return function () {\n        onBeforeClick(type).then(function () {\n          var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m;\n          curAction.current = new ActionClass();\n          if (!curAction.current) return;\n          curAction.current.setAnchorStyle(__assign({}, anchorStyle));\n          curAction.current.setMoveGemStyle(__assign({}, anchorStyle));\n          (_b = (_a = curAction === null || curAction === void 0 ? void 0 : curAction.current) === null || _a === void 0 ? void 0 : _a.on) === null || _b === void 0 ? void 0 : _b.call(_a, ActionEvents.DrawBeforeStart, function (e) {\n            // console.log('绘制开始前', JSON.stringify(e));\n            clip(e);\n          });\n          (_d = (_c = curAction === null || curAction === void 0 ? void 0 : curAction.current) === null || _c === void 0 ? void 0 : _c.on) === null || _d === void 0 ? void 0 : _d.call(_c, ActionEvents.DrawStart, function (e) {\n            // console.log('绘制开始', JSON.stringify(e));\n            clip(e);\n          });\n          (_f = (_e = curAction === null || curAction === void 0 ? void 0 : curAction.current) === null || _e === void 0 ? void 0 : _e.on) === null || _f === void 0 ? void 0 : _f.call(_e, ActionEvents.Drawing, function (e) {\n            // console.log('绘制中', JSON.stringify(e));\n            clip(e);\n          });\n          (_h = (_g = curAction === null || curAction === void 0 ? void 0 : curAction.current) === null || _g === void 0 ? void 0 : _g.on) === null || _h === void 0 ? void 0 : _h.call(_g, ActionEvents.DrawEnd, function (e) {\n            // curAction.current.start(data?.style);\n            // console.log('绘制完成', JSON.stringify(e));\n            clip(e);\n          });\n          (_k = (_j = polygonSelection === null || polygonSelection === void 0 ? void 0 : polygonSelection.current) === null || _j === void 0 ? void 0 : _j.changeAction) === null || _k === void 0 ? void 0 : _k.call(_j, curAction.current);\n          (_m = (_l = curAction === null || curAction === void 0 ? void 0 : curAction.current) === null || _l === void 0 ? void 0 : _l.start) === null || _m === void 0 ? void 0 : _m.call(_l, style);\n        });\n      };\n    };\n    /**\n     * renderCroppingTools\n     * @returns\n     */\n    var renderCroppingTools = function renderCroppingTools() {\n      var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t;\n      var tools = [{\n        key: 'rectangle',\n        value: (!toolBarConfig || !('rectangle' in toolBarConfig) || !('hide' in toolBarConfig.rectangle) || !((_a = toolBarConfig === null || toolBarConfig === void 0 ? void 0 : toolBarConfig.rectangle) === null || _a === void 0 ? void 0 : _a.hide)) && (((_c = (_b = toolBarConfig === null || toolBarConfig === void 0 ? void 0 : toolBarConfig.rectangle) === null || _b === void 0 ? void 0 : _b.render) === null || _c === void 0 ? void 0 : _c.call(_b, onClickHOC(SelectType.Rectangle, RectangleDrawAction))) || /*#__PURE__*/React.createElement(_Button, {\n          key: \"rectangle\",\n          block: true,\n          size: \"large\",\n          type: getType(SelectType.Rectangle),\n          onClick: onClickHOC(SelectType.Rectangle, RectangleDrawAction)\n        }, Intl.v('矩形剪裁')))\n      }, {\n        key: 'circle',\n        value: (!toolBarConfig || !('circle' in toolBarConfig) || !('hide' in toolBarConfig.circle) || !((_d = toolBarConfig === null || toolBarConfig === void 0 ? void 0 : toolBarConfig.circle) === null || _d === void 0 ? void 0 : _d.hide)) && (((_f = (_e = toolBarConfig === null || toolBarConfig === void 0 ? void 0 : toolBarConfig.circle) === null || _e === void 0 ? void 0 : _e.render) === null || _f === void 0 ? void 0 : _f.call(_e, onClickHOC(SelectType.Circle, CircleDrawAction))) || /*#__PURE__*/React.createElement(_Button, {\n          key: \"circle\",\n          block: true,\n          size: \"large\",\n          type: getType(SelectType.Circle),\n          onClick: onClickHOC(SelectType.Circle, CircleDrawAction)\n        }, Intl.v('圆形剪裁')))\n      }, {\n        key: 'start',\n        value: (!toolBarConfig || !('start' in toolBarConfig) || !('hide' in toolBarConfig.start) || !((_g = toolBarConfig === null || toolBarConfig === void 0 ? void 0 : toolBarConfig.start) === null || _g === void 0 ? void 0 : _g.hide)) && (((_j = (_h = toolBarConfig === null || toolBarConfig === void 0 ? void 0 : toolBarConfig.start) === null || _h === void 0 ? void 0 : _h.render) === null || _j === void 0 ? void 0 : _j.call(_h, onClickHOC(SelectType.Start, StartDrawAction))) || /*#__PURE__*/React.createElement(_Button, {\n          key: \"start\",\n          block: true,\n          size: \"large\",\n          type: getType(SelectType.Start),\n          onClick: onClickHOC(SelectType.Start, StartDrawAction)\n        }, Intl.v('五角星剪裁')))\n      }, {\n        key: 'triangle',\n        value: (!toolBarConfig || !('triangle' in toolBarConfig) || !('hide' in toolBarConfig.triangle) || !((_k = toolBarConfig === null || toolBarConfig === void 0 ? void 0 : toolBarConfig.triangle) === null || _k === void 0 ? void 0 : _k.hide)) && (((_m = (_l = toolBarConfig === null || toolBarConfig === void 0 ? void 0 : toolBarConfig.triangle) === null || _l === void 0 ? void 0 : _l.render) === null || _m === void 0 ? void 0 : _m.call(_l, onClickHOC(SelectType.Triangle, TriangleDrawAction))) || /*#__PURE__*/React.createElement(_Button, {\n          key: \"triangle\",\n          block: true,\n          size: \"large\",\n          type: getType(SelectType.Triangle),\n          onClick: onClickHOC(SelectType.Triangle, TriangleDrawAction)\n        }, Intl.v('三角形剪裁')))\n      }, {\n        key: 'diamond',\n        value: (!toolBarConfig || !('diamond' in toolBarConfig) || !('hide' in toolBarConfig.diamond) || !((_o = toolBarConfig === null || toolBarConfig === void 0 ? void 0 : toolBarConfig.diamond) === null || _o === void 0 ? void 0 : _o.hide)) && (((_q = (_p = toolBarConfig === null || toolBarConfig === void 0 ? void 0 : toolBarConfig.diamond) === null || _p === void 0 ? void 0 : _p.render) === null || _q === void 0 ? void 0 : _q.call(_p, onClickHOC(SelectType.Diamond, DiamondDrawAction))) || /*#__PURE__*/React.createElement(_Button, {\n          key: \"diamond\",\n          block: true,\n          size: \"large\",\n          type: getType(SelectType.Diamond),\n          onClick: onClickHOC(SelectType.Diamond, DiamondDrawAction)\n        }, Intl.v('菱形剪裁')))\n      }, {\n        key: 'polygon',\n        value: (!toolBarConfig || !('polygon' in toolBarConfig) || !('hide' in toolBarConfig.polygon) || !((_r = toolBarConfig === null || toolBarConfig === void 0 ? void 0 : toolBarConfig.polygon) === null || _r === void 0 ? void 0 : _r.hide)) && (((_t = (_s = toolBarConfig === null || toolBarConfig === void 0 ? void 0 : toolBarConfig.polygon) === null || _s === void 0 ? void 0 : _s.render) === null || _t === void 0 ? void 0 : _t.call(_s, onClickHOC(SelectType.Polygon, PolygonDrawAction))) || /*#__PURE__*/React.createElement(_Button, {\n          key: \"polygon\",\n          block: true,\n          size: \"large\",\n          type: getType(SelectType.Polygon),\n          onClick: onClickHOC(SelectType.Polygon, PolygonDrawAction)\n        }, Intl.v('多边形剪裁')))\n      }];\n      return tools.filter(function (t) {\n        return !!t.value;\n      });\n    };\n    var toolsArr = [{\n      key: 'open',\n      value: ((_b = (_a = toolBarConfig === null || toolBarConfig === void 0 ? void 0 : toolBarConfig.open) === null || _a === void 0 ? void 0 : _a.render) === null || _b === void 0 ? void 0 : _b.call(_a, function () {\n        var _a;\n        (_a = inputFileFieldRef.current) === null || _a === void 0 ? void 0 : _a.click();\n      })) || /*#__PURE__*/React.createElement(_Button, {\n        key: \"open\",\n        block: true,\n        size: \"large\",\n        type: \"primary\",\n        onClick: function onClick() {\n          var _a;\n          (_a = inputFileFieldRef.current) === null || _a === void 0 ? void 0 : _a.click();\n        }\n      }, Intl.v('打开'))\n    }, base64 ? renderCroppingTools() : [{\n      key: '',\n      value: null\n    }]].flat().filter(function (t) {\n      return !!t.value;\n    });\n    toolsArr = sort(toolsArr.map(function (t) {\n      var _a;\n      if ('sort' in ((_a = toolBarConfig === null || toolBarConfig === void 0 ? void 0 : toolBarConfig[t.key]) !== null && _a !== void 0 ? _a : {})) {\n        return __assign(__assign({}, t), {\n          sort: toolBarConfig === null || toolBarConfig === void 0 ? void 0 : toolBarConfig[t.key].sort\n        });\n      }\n      return t;\n    })).map(function (t) {\n      return t.value;\n    });\n    var direction = ['left', 'right'].includes((_c = toolBarConfig === null || toolBarConfig === void 0 ? void 0 : toolBarConfig.direction) !== null && _c !== void 0 ? _c : 'left') ? 'vertical' : 'horizontal';\n    return /*#__PURE__*/React.createElement(_Card, null, /*#__PURE__*/React.createElement(_Space, {\n      direction: direction,\n      size: 20\n    }, /*#__PURE__*/React.createElement(\"input\", {\n      type: \"file\",\n      ref: inputFileFieldRef,\n      accept: \"image/*\",\n      style: {\n        display: 'none'\n      }\n    }), toolsArr));\n  }, [type, toolProps, base64, toolBarConfig]);\n  /**\n   * renderArea\n   */\n  var renderArea = useMemo(function () {\n    return /*#__PURE__*/React.createElement(_Card, null, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"\".concat(selectorPrefix, \"-background\"),\n      style: {\n        minHeight: minHeight || 200\n      }\n    }, base64 && /*#__PURE__*/React.createElement(\"div\", {\n      className: \"\".concat(selectorPrefix, \"-background-inner\")\n    }, /*#__PURE__*/React.createElement(\"img\", {\n      ref: base64Ref,\n      src: base64,\n      alt: \"\"\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"\".concat(selectorPrefix, \"-background-mask\")\n    }))), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"\".concat(selectorPrefix, \"-geometry\"),\n      ref: geometryRef\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"\".concat(selectorPrefix, \"-clip\"),\n      ref: clipRef\n    }));\n  }, [base64, areaProps]);\n  var image = useCallback(function () {\n    var img = new Image();\n    img.src = base64;\n    return img;\n  }, [base64]);\n  /**\n   * useUpdateLayoutEffect\n   */\n  useUpdateLayoutEffect(function () {\n    setType(null);\n    if (base64Ref.current) {\n      base64Ref.current.onload = function () {\n        if (polygonSelection.current) {\n          data.current = null;\n          destroyClip();\n          destroySelection();\n        }\n        createClip();\n        createSelection();\n      };\n    }\n  }, [base64]);\n  /**\n   * useLayoutEffect\n   */\n  useLayoutEffect(function () {\n    var _a;\n    var onChange = function onChange(e) {\n      var file = e.target.files[0];\n      var read = new FileReader();\n      read.onload = function (e) {\n        var _a;\n        setBase64((_a = e.target) === null || _a === void 0 ? void 0 : _a.result);\n      };\n      read.readAsDataURL(file);\n    };\n    (_a = inputFileFieldRef.current) === null || _a === void 0 ? void 0 : _a.addEventListener('change', onChange);\n    return function () {\n      var _a;\n      (_a = inputFileFieldRef.current) === null || _a === void 0 ? void 0 : _a.removeEventListener('change', onChange);\n    };\n  }, []);\n  useImperativeHandle(ref, function () {\n    return {\n      /**\n       * save\n       * @return {string}\n       */\n      save: function save() {\n        // 通过data获取外接矩形数据\n        // 创建一个canvas，绘制base64\n        // getImageData(矩形数据)\n        if (!data.current || !data.current.data || !base64) return '';\n        return getClipDataUrl({\n          data: data.current,\n          clipCtx: clipCanvasCtx.current\n        });\n      }\n    };\n  });\n  /**\n   * clip\n   * @param {IActionData} e\n   * @return void\n   */\n  var clip = function clip(e) {\n    var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m;\n    if (!e.data) return;\n    data.current = e;\n    (_b = (_a = clipCanvasCtx.current) === null || _a === void 0 ? void 0 : _a.restore) === null || _b === void 0 ? void 0 : _b.call(_a);\n    (_d = (_c = clipCanvasCtx.current) === null || _c === void 0 ? void 0 : _c.save) === null || _d === void 0 ? void 0 : _d.call(_c);\n    (_e = clipCanvasCtx.current) === null || _e === void 0 ? void 0 : _e.clearRect(0, 0, (_f = clipCanvasEL.current) === null || _f === void 0 ? void 0 : _f.width, (_g = clipCanvasEL.current) === null || _g === void 0 ? void 0 : _g.height);\n    var drawMap = new Map([[SelectType.Circle, drawCircle], [SelectType.Rectangle, drawRectangle], [SelectType.Diamond, drawDiamond], [SelectType.Start, drawStart], [SelectType.Triangle, drawTriangle], [SelectType.Polygon, drawPolygon]]);\n    (_h = drawMap.get(e.selectType)) === null || _h === void 0 ? void 0 : _h(clipCanvasCtx.current, e.data);\n    (_j = clipCanvasCtx === null || clipCanvasCtx === void 0 ? void 0 : clipCanvasCtx.current) === null || _j === void 0 ? void 0 : _j.clip();\n    (_k = clipCanvasCtx === null || clipCanvasCtx === void 0 ? void 0 : clipCanvasCtx.current) === null || _k === void 0 ? void 0 : _k.drawImage(image(), 0, 0, (_l = clipCanvasEL.current) === null || _l === void 0 ? void 0 : _l.width, (_m = clipCanvasEL.current) === null || _m === void 0 ? void 0 : _m.height);\n  };\n  /**\n   * clearClip\n   */\n  var clearClip = function clearClip() {\n    var _a, _b, _c, _d, _e;\n    (_a = clipCanvasCtx.current) === null || _a === void 0 ? void 0 : _a.restore();\n    (_c = (_b = clipCanvasCtx.current) === null || _b === void 0 ? void 0 : _b.clearRect) === null || _c === void 0 ? void 0 : _c.call(_b, 0, 0, (_d = clipCanvasEL.current) === null || _d === void 0 ? void 0 : _d.width, (_e = clipCanvasEL.current) === null || _e === void 0 ? void 0 : _e.height);\n  };\n  /**\n   * destroyClip\n   * @returns\n   */\n  var destroyClip = function destroyClip() {\n    if (!clipRef.current) return;\n    clipRef.current.innerHTML = '';\n  };\n  /**\n   * createClip\n   */\n  var createClip = function createClip() {\n    var _a, _b, _c, _d, _e, _f;\n    clipCanvasEL.current = document.createElement('canvas');\n    clipCanvasEL.current.width = (_a = base64Ref.current) === null || _a === void 0 ? void 0 : _a.offsetWidth;\n    clipCanvasEL.current.height = (_b = base64Ref.current) === null || _b === void 0 ? void 0 : _b.offsetHeight;\n    clipCanvasCtx.current = (_d = (_c = clipCanvasEL.current) === null || _c === void 0 ? void 0 : _c.getContext) === null || _d === void 0 ? void 0 : _d.call(_c, '2d');\n    (_f = (_e = clipRef.current) === null || _e === void 0 ? void 0 : _e.appendChild) === null || _f === void 0 ? void 0 : _f.call(_e, clipCanvasEL.current);\n  };\n  /**\n   * destroySelection\n   */\n  var destroySelection = function destroySelection() {\n    var _a, _b;\n    (_b = (_a = polygonSelection === null || polygonSelection === void 0 ? void 0 : polygonSelection.current) === null || _a === void 0 ? void 0 : _a.destroy) === null || _b === void 0 ? void 0 : _b.call(_a);\n  };\n  /**\n   * createSelection\n   * @returns\n   */\n  var createSelection = function createSelection() {\n    var _a, _b;\n    if (!geometryRef.current) return;\n    geometryRef.current.style.width = \"\".concat((_a = base64Ref === null || base64Ref === void 0 ? void 0 : base64Ref.current) === null || _a === void 0 ? void 0 : _a.offsetWidth, \"px\");\n    geometryRef.current.style.height = \"\".concat((_b = base64Ref === null || base64Ref === void 0 ? void 0 : base64Ref.current) === null || _b === void 0 ? void 0 : _b.offsetHeight, \"px\");\n    polygonSelection.current = new PolygonSelection.PolygonSelection(geometryRef.current);\n    /**\n     * CanvasClickGeometry\n     */\n    polygonSelection.current.on(PolygonSelectionActions.CanvasClickGeometry, function (data) {\n      // 多边形数据据\n      // const d = {\n      //   selectType: 'Polygon',\n      //   actionType: 'Draw',\n      //   data: {\n      //     id: 'fd4ef30f-8add-4cc1-8f36-d861e77b5354',\n      //     type: 'Polygon',\n      //     data: [\n      //       { x: 148.34375, y: 33 },\n      //       { x: 120.34375, y: 198 },\n      //       { x: 360.34375, y: 181 },\n      //     ],\n      //     style: {\n      //       fillStyle: 'red',\n      //       strokeStyle: '#000',\n      //       lineWidth: 2,\n      //       lineCap: 'round',\n      //       lineJoin: 'round',\n      //       lineDash: [],\n      //       lineDashOffset: -1,\n      //     },\n      //   },\n      // };\n      //\n      // polygonSelection.current.clearDraw();\n      // polygonSelection.current.addHistoryData(d.data);\n      // polygonSelection.current.drawHistoryData();\n      //\n      // const action = new PolygonModifyAction(d);\n      // action.on(ActionEvents.End, () => {\n      //   action.start();\n      // });\n      // polygonSelection.current.changeAction(action);\n      // action.start();\n      var _a;\n      // console.log('click');\n      var Component = typeActionMap.get(data.type);\n      var action = new Component({\n        selectType: data.type,\n        actionType: 'Draw',\n        data: data\n      });\n      action.setAnchorStyle(__assign({}, anchorStyle));\n      action.setMoveGemStyle(__assign({}, anchorStyle));\n      action.on(ActionEvents.ModifyBeforeStart, function (e) {\n        // console.log('修改开始前', JSON.stringify(e));\n        clip(e);\n      });\n      action.on(ActionEvents.ModifyStart, function (e) {\n        // console.log('修改开始', JSON.stringify(e));\n        clip(e);\n      });\n      action.on(ActionEvents.Modifying, function (e) {\n        // console.log('修改中', JSON.stringify(e));\n        clip(e);\n      });\n      action.on(ActionEvents.ModifyEnd, function (e) {\n        // console.log('修改完成', JSON.stringify(e));\n        clip(e);\n        action.start();\n      });\n      action.on(ActionEvents.Moving, function (e) {\n        // console.log('移动中', JSON.stringify(e));\n        clip(e);\n      });\n      action.on(ActionEvents.MoveEnd, function (e) {\n        // console.log('移动完成', JSON.stringify(e));\n        clip(e);\n      });\n      (_a = polygonSelection === null || polygonSelection === void 0 ? void 0 : polygonSelection.current) === null || _a === void 0 ? void 0 : _a.changeAction(action);\n      action.start();\n    });\n    /**\n     * CanvasClickEmpty\n     */\n    polygonSelection.current.on(PolygonSelectionActions.CanvasClickEmpty, function () {\n      var _a, _b, _c;\n      // console.log('clickEmpty');\n      (_a = polygonSelection === null || polygonSelection === void 0 ? void 0 : polygonSelection.current) === null || _a === void 0 ? void 0 : _a.clearDraw();\n      (_b = polygonSelection === null || polygonSelection === void 0 ? void 0 : polygonSelection.current) === null || _b === void 0 ? void 0 : _b.clearAssistDraw();\n      (_c = polygonSelection === null || polygonSelection === void 0 ? void 0 : polygonSelection.current) === null || _c === void 0 ? void 0 : _c.drawHistoryData();\n    });\n  };\n  var children = (_b = layoutMap.get((toolBarConfig === null || toolBarConfig === void 0 ? void 0 : toolBarConfig.direction) || 'left')) === null || _b === void 0 ? void 0 : _b();\n  return /*#__PURE__*/React.createElement(\"div\", {\n    ref: wrapRef,\n    className: \"\".concat(classNames(selectorPrefix, className !== null && className !== void 0 ? className : '')),\n    style: wrapStyle !== null && wrapStyle !== void 0 ? wrapStyle : {}\n  }, children);\n});\nCroppingCore.displayName = 'CroppingCore';\nexport default CroppingCore;"],"names":["_Space","_Card","_Button","__assign","this","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","useUpdateLayoutEffect","classNames","React","forwardRef","useCallback","useImperativeHandle","useLayoutEffect","useMemo","useRef","useState","FlexLayout","Intl","CircleDrawAction","DiamondDrawAction","PolygonDrawAction","RectangleDrawAction","StartDrawAction","TriangleDrawAction","PolygonSelection","CircleModifyAction","DiamondModifyAction","PolygonModifyAction","RectangleModifyAction","StartModifyAction","TriangleModifyAction","ActionEvents","PolygonSelectionActions","SelectType","drawCircle","drawDiamond","drawPolygon","drawRectangle","drawStart","drawTriangle","getClipDataUrl","sort","selectorPrefix","CroppingCore","_a","ref","className","wrapStyle","style","wrapProps","toolProps","areaProps","_c","minHeight","toolBarConfig","_d","type","setType","_e","base64","setBase64","base64Ref","wrapRef","clipRef","clipCanvasEL","clipCanvasCtx","geometryRef","polygonSelection","curAction","inputFileFieldRef","data","layoutMap","Map","createElement","TRBLC","LCLayout","defaultProps","lProps","defaultToolbarProps","children","renderTool","cProps","defaultCProps","renderArea","CRLayout","rProps","TCLayout","tProps","CBLayout","bProps","typeActionMap","Polygon","Circle","Rectangle","Triangle","Diamond","Start","fillStyle","strokeStyle","lineWidth","lineCap","lineJoin","lineDash","lineDashOffset","globalAlpha","anchorStyle","gutter","wrapClassName","concat","fit","autoFixed","getType","_type","onClickHOC","ActionClass","onBeforeClick","then","_l","_m","current","setAnchorStyle","setMoveGemStyle","_b","on","DrawBeforeStart","e","clip","DrawStart","_f","Drawing","_h","_g","DrawEnd","_k","_j","changeAction","start","_s","clearClip","clearCanvasAll","Promise","resolve","reject","toolsArr","key","value","open","render","click","block","size","onClick","v","rectangle","hide","circle","triangle","diamond","_o","_q","_p","polygon","_r","_t","filter","flat","map","direction","includes","accept","display","src","alt","image","img","Image","onload","destroyClip","destroySelection","createClip","createSelection","onChange","file","target","files","read","FileReader","result","readAsDataURL","addEventListener","removeEventListener","save","clipCtx","restore","clearRect","width","height","get","selectType","drawImage","innerHTML","document","offsetWidth","offsetHeight","getContext","appendChild","destroy","CanvasClickGeometry","action","actionType","ModifyBeforeStart","ModifyStart","Modifying","ModifyEnd","Moving","MoveEnd","CanvasClickEmpty","clearDraw","clearAssistDraw","drawHistoryData","displayName"],"mappings":"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"}