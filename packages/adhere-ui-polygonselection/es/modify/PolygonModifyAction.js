var __extends=this&&this.__extends||function(){var a=function(t,n){return(a=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,n){t.__proto__=n}:function(t,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}))(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}a(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var n,o=1,a=arguments.length;o<a;o++)for(var i in n=arguments[o])Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t}).apply(this,arguments)},__spreadArray=this&&this.__spreadArray||function(t,n,o){if(o||2===arguments.length)for(var a,i=0,r=n.length;i<r;i++)!a&&i in n||((a=a||Array.prototype.slice.call(n,0,i))[i]=n[i]);return t.concat(a||Array.prototype.slice.call(n))};import MathUtil from"@baifendian/adhere-util";import*as turf from"@turf/turf";import PolygonDrawAction from"../draw/PolygonDrawAction";import{SelectType}from"../types";import ModifyAction from"./ModifyAction";var PolygonModifyAction=function(n){function t(t){t=n.call(this,t)||this;return t.startIndex=-1,t}return __extends(t,n),t.prototype.drawAnchors=function(){var t;if(this.context){var n=this.context.getCtx();if(n)for(var o=(null==(t=null==(t=null==this?void 0:this.data)?void 0:t.data)?void 0:t.data)||[],a=0;a<o.length;a++){var i=o[a];n.beginPath(),this.setAnchorCircleStyle(),n.ellipse(i.x,i.y,this.anchorRadius,this.anchorRadius,45*Math.PI/180,0,2*Math.PI),n.closePath(),n.stroke(),n.fill()}}},t.prototype.getPointInAnchor=function(t){if(!this.data)return null;for(var n=null,o=-1,a=this.data.data.data,i=0;i<a.length;i++){var r=a[i],e=this.anchorRadius+this.anchorLineWidth;if(MathUtil.isPointInCircle(t,{center:r,radius:e})){n=r,o=i;break}}return n&&-1!==o?{point:n,index:o}:null},t.prototype.setResizeCursorByIndex=function(t){var n,o;this.context&&(n=this.context.getCanvasEl(),o=this.context.getAssistCanvasEl(),n)&&o&&(n.style.cursor=o.style.cursor="nesw-resize")},t.prototype.drawModify=function(t){var n=this.context,o=null==n?void 0:n.getCtx();n&&o&&this.data&&this.startPoint&&-1!==this.startIndex&&(o=n.getHistoryDataById(this.data.data.id))&&(o.data[this.startIndex]=t,this.data.data=o,n.clearDraw(),n.drawHistoryData(),this.drawAnchors())},t.prototype.drawMove=function(t,n){var o,a,i=this.context,r=null==i?void 0:i.getCtx();i&&r&&this.data&&(r=i.getHistoryDataById(this.data.data.id))&&(o=n.x-t.x,a=n.y-t.y,r.data.forEach(function(t){t.x+=o,t.y+=a}),this.data.data=r,i.clearDraw(),i.drawHistoryData(),this.drawAnchors())},t.prototype.getSelectType=function(){return SelectType.Polygon},t.prototype.isCanMove=function(t){var n,o;return!!this.data&&((o=__spreadArray([],null==(o=null==(o=null==this?void 0:this.data)?void 0:o.data)?void 0:o.data,!0)).push(o[0]),n=turf.point([t.x,t.y]),o=turf.polygon([o.map(function(t){return[t.x,t.y]})]),turf.booleanPointInPolygon(n,o))&&!this.getPointInAnchor(t)},t.prototype.drawMoveGeometry=function(){this.context&&this.data&&PolygonDrawAction.draw(this.context.getAssistCtx(),this.data)},t.prototype.drawMoveGeometry=function(t,n){var o,a,i;return this.context&&this.data&&t&&n?((o=JSON.parse(JSON.stringify(this.data.data))).data=o.data.map(function(t){return __assign({},t)}),a=n.x-t.x,i=n.y-t.y,o.data&&o.data.length&&(o.data.forEach(function(t){t.x+=a,t.y+=i}),n=__assign(__assign({},this.moveGemStyle),o.style||{}),o.style.lineWidth=n.lineWidth,o.style.lineJoin=n.lineJoin,o.style.lineCap=n.lineCap,o.lineDash=n.lineDash,o.style.lineDashOffset=n.lineDashOffset,o.style.strokeStyle=n.strokeStyle,o.style.fillStyle=n.fillStyle,o.style.globalAlpha=null!=(t=n.globalAlpha)?t:1,PolygonDrawAction.draw(this.context.getAssistCtx(),o)),o):null},t}(ModifyAction);export default PolygonModifyAction;
//# sourceMappingURL=PolygonModifyAction.js.map
