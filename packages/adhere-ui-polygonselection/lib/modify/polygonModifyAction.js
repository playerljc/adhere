var __extends=this&&this.__extends||function(){var a=function(t,o){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var r in o)o.hasOwnProperty(r)&&(t[r]=o[r])})(t,o)};return function(t,o){function r(){this.constructor=t}a(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}(),__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var o,r=1,a=arguments.length;r<a;r++)for(var n in o=arguments[r])Object.prototype.hasOwnProperty.call(o,n)&&(t[n]=o[n]);return t}).apply(this,arguments)},__spreadArrays=this&&this.__spreadArrays||function(){for(var t=0,o=0,r=arguments.length;o<r;o++)t+=arguments[o].length;for(var a=Array(t),n=0,o=0;o<r;o++)for(var i=arguments[o],e=0,s=i.length;e<s;e++,n++)a[n]=i[e];return a};import*as turf from"@turf/turf";import MathUtil from"@baifendian/adhere-util/lib/math";import{SelectType}from"../types";import ModifyAction from"./modifyAction";import PolygonDrawAction from"../draw/polygonDrawAction";var PolygonModifyAction=function(o){function t(t){t=o.call(this,t)||this;return t.startIndex=-1,t}return __extends(t,o),t.prototype.drawAnchors=function(){var t;if(this.context){var o=this.context.getCtx();if(o)for(var r=(null===(t=null===(t=null==this?void 0:this.data)||void 0===t?void 0:t.data)||void 0===t?void 0:t.data)||[],a=0;a<r.length;a++){var n=r[a];o.beginPath(),this.setAnchorStyle(),o.ellipse(n.x,n.y,this.anchorRadius,this.anchorRadius,45*Math.PI/180,0,2*Math.PI),o.stroke(),o.fill()}}},t.prototype.getPointInAnchor=function(t){if(!this.data)return null;for(var o=null,r=-1,a=this.data.data.data,n=0;n<a.length;n++){var i=a[n],e=this.anchorRadius+this.anchorLineWidth;if(MathUtil.isPointInCircle(t,{center:i,radius:e})){o=i,r=n;break}}return o&&-1!==r?{point:o,index:r}:null},t.prototype.setResizeCursorByIndex=function(t){var o,r;this.context&&(o=this.context.getCanvasEl(),r=this.context.getAssistCanvasEl(),o&&r&&(o.style.cursor=r.style.cursor="nesw-resize"))},t.prototype.drawModify=function(t){var o=this.context,r=null==o?void 0:o.getCtx();o&&r&&this.data&&this.startPoint&&-1!==this.startIndex&&((r=o.getHistoryDataById(this.data.data.id))&&(r.data[this.startIndex]=t,o.clearDraw(),o.drawHistoryData(),this.drawAnchors()))},t.prototype.drawMove=function(t,o){var r,a,n=this.context,i=null==n?void 0:n.getCtx();n&&i&&this.data&&((i=n.getHistoryDataById(this.data.data.id))&&(r=o.x-t.x,a=o.y-t.y,i.data.forEach(function(t){t.x+=r,t.y+=a}),n.clearDraw(),n.drawHistoryData(),this.drawAnchors()))},t.prototype.getSelectType=function(){return SelectType.Polygon},t.prototype.isCanMove=function(t){if(!this.data)return!1;var o=__spreadArrays(null===(o=null===(o=null==this?void 0:this.data)||void 0===o?void 0:o.data)||void 0===o?void 0:o.data);o.push(o[0]);t=turf.point([t.x,t.y]),o=turf.polygon([o.map(function(t){return[t.x,t.y]})]);return turf.booleanPointInPolygon(t,o)},t.prototype.drawMoveGeometry=function(){this.context&&this.data&&PolygonDrawAction.draw(this.context.getAssistCtx(),this.data)},t.prototype.drawMoveGeometry=function(t,o){var r,a,n;this.context&&this.data&&t&&o&&((r=__assign({},this.data.data)).data=r.data.map(function(t){return __assign({},t)}),a=o.x-t.x,n=o.y-t.y,r.data&&r.data.length&&(r.data.forEach(function(t){t.x+=a,t.y+=n}),PolygonDrawAction.draw(this.context.getAssistCtx(),r)))},t}(ModifyAction);export default PolygonModifyAction;
//# sourceMappingURL=polygonModifyAction.js.map
