var __extends=this&&this.__extends||function(){var o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(t,n)};return function(t,n){function e(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}}();import MathUtil from"@baifendian/adhere-util/lib/math";import Emitter from"@baifendian/adhere-util-emitter/lib/events";import{ActionStatus,ActionEvents,ActionType}from"../types";var ModifyAction=function(e){function t(t){var n=e.call(this)||this;return n.startPoint=null,n.startIndex=-1,n.context=null,n.data=null,n.status=ActionStatus.UnStart,n.EmitActions={CONTEXT:"CONTEXT"},n.anchorRadius=5,n.anchorLineWidth=2,n.anchorStrokeStyle="blue",n.anchorFillStyle="rgba(0,0,0,.1)",n.data=t,n.onContext=n.onContext.bind(n),n.onCanvasMousedown=n.onCanvasMousedown.bind(n),n.onCanvasMousemove=n.onCanvasMousemove.bind(n),n.onCanvasMouseup=n.onCanvasMouseup.bind(n),n.on(n.EmitActions.CONTEXT,n.onContext),n}return __extends(t,e),t.prototype.setAnchorStyle=function(){var t;!this.context||(t=this.context.getCtx())&&(t.strokeStyle=this.anchorStrokeStyle,t.fillStyle=this.anchorFillStyle,t.lineWidth=this.anchorLineWidth)},t.prototype.onContext=function(){this.drawAnchors()},t.prototype.onCanvasMousedown=function(t){var n;!this.context||(n=this.context.getCanvasEl())&&this.context.getCtx()&&(t=MathUtil.clientToCtxPoint({event:t,rect:null==n?void 0:n.getBoundingClientRect()}),(t=this.getPointInAnchor(t))&&(this.startPoint=t.point,this.startIndex=t.index,null!=n&&n.addEventListener("mousemove",this.onCanvasMousemove),null!=n&&n.addEventListener("mouseup",this.onCanvasMouseup)))},t.prototype.onCanvasMousemove=function(t){var n;!this.context||(n=this.context.getCanvasEl())&&this.context.getCtx()&&this.startPoint&&(n=MathUtil.clientToCtxPoint({event:t,rect:null==n?void 0:n.getBoundingClientRect()}),this.draw(n))},t.prototype.onCanvasMouseup=function(t){this.end(t)},t.prototype.start=function(){var t;!this.context||[ActionStatus.Running,ActionStatus.Destroy].includes(this.status)||(t=this.context.getCanvasEl())&&(this.trigger(ActionEvents.BeforeStart,{selectType:this.getSelectType(),actionType:ActionType.Modify}),null!=t&&t.addEventListener("mousedown",this.onCanvasMousedown),this.status=ActionStatus.Running,this.trigger(ActionEvents.Start,{selectType:this.getSelectType(),actionType:ActionType.Modify}))},t.prototype.end=function(t){var n;t&&(!(n=this.context)||(n=n.getCanvasEl())&&(n.removeEventListener("mousedown",this.onCanvasMousedown),n.removeEventListener("mousemove",this.onCanvasMousemove),n.removeEventListener("mouseup",this.onCanvasMouseup),n=MathUtil.clientToCtxPoint({event:t,rect:null==n?void 0:n.getBoundingClientRect()}),this.draw(n),this.status=ActionStatus.End,this.startPoint=null,this.trigger(ActionEvents.End,{selectType:this.getSelectType(),actionType:ActionType.Modify,data:n})))},t.prototype.destroy=function(){var t,n=this.context;!n||(t=n.getCanvasEl())&&(this.remove(this.EmitActions.CONTEXT,this.onContext),null!=t&&t.removeEventListener("mousedown",this.onCanvasMousedown),null!=t&&t.removeEventListener("mousemove",this.onCanvasMousemove),null!=t&&t.removeEventListener("mouseup",this.onCanvasMouseup),n.clearDraw(),n.drawHistoryData(),this.status=ActionStatus.Destroy,this.startPoint=null,this.trigger(ActionEvents.Destroy,{selectType:this.getSelectType(),actionType:ActionType.Modify}))},t.prototype.setContext=function(t){this.context=t,this.trigger(this.EmitActions.CONTEXT)},t.prototype.getStatus=function(){return this.status},t}(Emitter);export default ModifyAction;
//# sourceMappingURL=modifyAction.js.map
