{"version":3,"file":"Util.js","sources":["cropping/Util.js"],"sourcesContent":["\"use strict\";\n\nvar __assign = void 0 && (void 0).__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n    return t;\n  };\n  return __assign.apply(this, arguments);\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.sort = exports.getClipDataUrl = exports.getPolygonRectangle = exports.drawPolygon = exports.getTriangleRectangle = exports.drawTriangle = exports.getStartRectangle = exports.drawStart = exports.getDiamondRectangle = exports.drawDiamond = exports.getSelfRectangle = exports.drawRectangle = exports.getCircleRectangle = exports.drawCircle = void 0;\nvar types_1 = require(\"../types\");\n/**\n * drawCircle\n * @param {CanvasRenderingContext2D} ctx\n * @param {ICircleData} data\n */\nfunction drawCircle(ctx, data) {\n  var _a, _b;\n  ctx === null || ctx === void 0 ? void 0 : ctx.beginPath();\n  ctx === null || ctx === void 0 ? void 0 : ctx.ellipse(((_a = data.data.center) === null || _a === void 0 ? void 0 : _a.x) || 0, ((_b = data.data.center) === null || _b === void 0 ? void 0 : _b.y) || 0, data.data.radius, data.data.radius, 45 * Math.PI / 180, 0, 2 * Math.PI);\n  ctx === null || ctx === void 0 ? void 0 : ctx.closePath();\n}\nexports.drawCircle = drawCircle;\n/**\n * getCircleRectangle\n * @param {ICircleData} circleData\n * @return {RectangleData}\n */\nfunction getCircleRectangle(circleData) {\n  return getSelfRectangle({\n    leftTopPoint: {\n      x: circleData.center.x - circleData.radius,\n      y: circleData.center.y - circleData.radius\n    },\n    width: circleData.radius * 2,\n    height: circleData.radius * 2\n  });\n}\nexports.getCircleRectangle = getCircleRectangle;\n/**\n * drawRectangle\n * @param {CanvasRenderingContext2D} ctx\n * @param {IRectangleData} data\n */\nfunction drawRectangle(ctx, data) {\n  var _a, _b;\n  ctx === null || ctx === void 0 ? void 0 : ctx.beginPath();\n  ctx.rect(((_a = data.data.leftTopPoint) === null || _a === void 0 ? void 0 : _a.x) || 0, ((_b = data.data.leftTopPoint) === null || _b === void 0 ? void 0 : _b.y) || 0, data.data.width, data.data.height);\n  ctx === null || ctx === void 0 ? void 0 : ctx.closePath();\n}\nexports.drawRectangle = drawRectangle;\n/**\n * getSelfRectangle\n * @param {IRectangleData} rectangleData\n * @return {RectangleData}\n */\nfunction getSelfRectangle(rectangleData) {\n  return __assign({}, rectangleData);\n}\nexports.getSelfRectangle = getSelfRectangle;\n/**\n * drawDiamond\n * @param {CanvasRenderingContext2D} ctx\n * @param {IDiamondData} data\n */\nfunction drawDiamond(ctx, data) {\n  ctx === null || ctx === void 0 ? void 0 : ctx.beginPath();\n  var widthHalf = data.data.width / 2;\n  var heightHalf = data.data.height / 2;\n  // 顺时针方向绘制\n  ctx.moveTo(data.data.leftTopPoint.x, data.data.leftTopPoint.y + heightHalf);\n  ctx.lineTo(data.data.leftTopPoint.x + widthHalf, data.data.leftTopPoint.y);\n  ctx.lineTo(data.data.leftTopPoint.x + data.data.width, data.data.leftTopPoint.y + heightHalf);\n  ctx.lineTo(data.data.leftTopPoint.x + widthHalf, data.data.leftTopPoint.y + data.data.height);\n  ctx === null || ctx === void 0 ? void 0 : ctx.closePath();\n}\nexports.drawDiamond = drawDiamond;\n/**\n * getDiamondRectangle\n * @param {IDiamondData} diamondData\n * @return {RectangleData}\n */\nfunction getDiamondRectangle(diamondData) {\n  return __assign({}, diamondData);\n}\nexports.getDiamondRectangle = getDiamondRectangle;\n/**\n * drawStart\n * @param {CanvasRenderingContext2D} ctx\n * @param {IStartData} data\n */\nfunction drawStart(ctx, data) {\n  ctx === null || ctx === void 0 ? void 0 : ctx.beginPath();\n  var startCount = 5;\n  var spend = 360 / startCount;\n  var min = 90 - spend;\n  var max = spend - min;\n  for (var i = 0; i < startCount; i++) {\n    ctx.lineTo(Math.cos((min + i * spend) / 180 * Math.PI) * data.data.outRadius + data.data.center.x, -Math.sin((min + i * spend) / 180 * Math.PI) * data.data.outRadius + data.data.center.y);\n    ctx.lineTo(Math.cos((max + i * spend) / 180 * Math.PI) * data.data.innerRadius + data.data.center.x, -Math.sin((max + i * spend) / 180 * Math.PI) * data.data.innerRadius + data.data.center.y);\n  }\n  ctx === null || ctx === void 0 ? void 0 : ctx.closePath();\n}\nexports.drawStart = drawStart;\n/**\n * getStartRectangle\n * @param {IStartData} startData\n * @return {RectangleData}\n */\nfunction getStartRectangle(startData) {\n  return getCircleRectangle({\n    center: startData.center,\n    radius: startData.outRadius\n  });\n}\nexports.getStartRectangle = getStartRectangle;\n/**\n * drawTriangle\n * @param {CanvasRenderingContext2D} ctx\n * @param {ITriangleData} data\n */\nfunction drawTriangle(ctx, data) {\n  ctx === null || ctx === void 0 ? void 0 : ctx.beginPath();\n  ctx.moveTo(data.data.points[0].x, data.data.points[0].y);\n  ctx.lineTo(data.data.points[1].x, data.data.points[1].y);\n  ctx.lineTo(data.data.points[2].x, data.data.points[2].y);\n  ctx === null || ctx === void 0 ? void 0 : ctx.closePath();\n}\nexports.drawTriangle = drawTriangle;\n/**\n * getTriangleRectangle\n * @param {ITriangleData} triangleData\n * @return {RectangleData}\n */\nfunction getTriangleRectangle(triangleData) {\n  return getSelfRectangle({\n    leftTopPoint: {\n      x: triangleData.points[0].x,\n      y: triangleData.points[1].y\n    },\n    width: triangleData.points[2].x - triangleData.points[0].x,\n    height: triangleData.points[2].y - triangleData.points[1].y\n  });\n}\nexports.getTriangleRectangle = getTriangleRectangle;\n/**\n * drawPolygon\n * @param {CanvasRenderingContext2D} ctx\n * @param {IPolygonData} data\n */\nfunction drawPolygon(ctx, data) {\n  ctx.beginPath();\n  ((data === null || data === void 0 ? void 0 : data.data) || []).forEach(function (point, index) {\n    if (index === 0) {\n      ctx.moveTo(point.x, point.y);\n    } else {\n      ctx.lineTo(point.x, point.y);\n    }\n  });\n  ctx === null || ctx === void 0 ? void 0 : ctx.closePath();\n}\nexports.drawPolygon = drawPolygon;\n/**\n * getPolygonRectangle\n * @param {IPolygonData} polygonData\n * @return {RectangleData}\n */\nfunction getPolygonRectangle(polygonData) {\n  var arrX = polygonData.map(function (_a) {\n    var x = _a.x;\n    return x;\n  });\n  var arrY = polygonData.map(function (_a) {\n    var y = _a.y;\n    return y;\n  });\n  var getMinMaxX = function getMinMaxX() {\n    return {\n      minX: Math.min.apply(Math, arrX),\n      maxX: Math.max.apply(Math, arrX)\n    };\n  };\n  var getMinMaxY = function getMinMaxY() {\n    return {\n      minY: Math.min.apply(Math, arrY),\n      maxY: Math.max.apply(Math, arrY)\n    };\n  };\n  var _a = getMinMaxX(),\n    minX = _a.minX,\n    maxX = _a.maxX;\n  var _b = getMinMaxY(),\n    minY = _b.minY,\n    maxY = _b.maxY;\n  return {\n    leftTopPoint: {\n      x: minX,\n      y: minY\n    },\n    width: maxX - minX,\n    height: maxY - minY\n  };\n}\nexports.getPolygonRectangle = getPolygonRectangle;\n/**\n * getClipDataUrl\n * @param {IActionData} data\n * @param {CanvasRenderingContext2D} clipCtx\n * @return {string}\n */\nfunction getClipDataUrl(_a) {\n  var _b;\n  var data = _a.data,\n    clipCtx = _a.clipCtx;\n  var map = new Map([[types_1.SelectType.Circle, getCircleRectangle], [types_1.SelectType.Rectangle, getSelfRectangle], [types_1.SelectType.Diamond, getDiamondRectangle], [types_1.SelectType.Start, getStartRectangle], [types_1.SelectType.Triangle, getTriangleRectangle], [types_1.SelectType.Polygon, getPolygonRectangle]]);\n  // 根据类型获取矩形数据\n  var rectangleData = (_b = map.get(data.data.type)) === null || _b === void 0 ? void 0 : _b(data.data.data);\n  // clipImageData = getImageData\n  var clipImageData = clipCtx.getImageData(rectangleData.leftTopPoint.x, rectangleData.leftTopPoint.y, rectangleData.width, rectangleData.height);\n  // put clipImageData to canvas\n  var canvas = document.createElement('canvas');\n  canvas.width = rectangleData.width;\n  canvas.height = rectangleData.height;\n  var ctx = canvas.getContext('2d');\n  ctx.putImageData(clipImageData, 0, 0);\n  // canvas to dataUrl\n  return canvas.toDataURL('image/png', 1);\n}\nexports.getClipDataUrl = getClipDataUrl;\n/**\n * sort\n * @param {Array<{ [key: string]: any; sort?: number }>} arr\n * @returns {Array<any>}\n */\nfunction sort(arr) {\n  var result = Array.from({\n    length: arr.length\n  }).fill(null);\n  var sortArr = [];\n  arr.forEach(function (t, index) {\n    if ('sort' in t) {\n      sortArr.push(t);\n    } else {\n      result[index] = t;\n    }\n  });\n  sortArr.forEach(function (t) {\n    result.splice(t.sort, 0, t);\n  });\n  return result.filter(function (t) {\n    return !!t;\n  });\n}\nexports.sort = sort;"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","this","types_1","defineProperty","exports","value","sort","getClipDataUrl","getPolygonRectangle","drawPolygon","getTriangleRectangle","drawTriangle","getStartRectangle","drawStart","getDiamondRectangle","drawDiamond","getSelfRectangle","drawRectangle","getCircleRectangle","drawCircle","require","ctx","data","_b","beginPath","ellipse","_a","center","x","y","radius","Math","PI","closePath","circleData","leftTopPoint","width","height","rect","rectangleData","widthHalf","heightHalf","moveTo","lineTo","diamondData","spend","cos","outRadius","sin","innerRadius","startData","points","triangleData","forEach","point","index","polygonData","arrX","map","arrY","minX","min","maxX","max","minY","maxY","clipCtx","Map","SelectType","Circle","Rectangle","Diamond","Start","Triangle","Polygon","get","type","clipImageData","getImageData","canvas","document","createElement","getContext","putImageData","toDataURL","arr","result","Array","from","fill","sortArr","push","splice","filter"],"mappings":"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"}