{"version":3,"file":"CroppingCore.js","sources":["cropping/CroppingCore.js"],"sourcesContent":["\"use strict\";\n\nvar __assign = void 0 && (void 0).__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n    return t;\n  };\n  return __assign.apply(this, arguments);\n};\nvar __createBinding = void 0 && (void 0).__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n    desc = {\n      enumerable: true,\n      get: function get() {\n        return m[k];\n      }\n    };\n  }\n  Object.defineProperty(o, k2, desc);\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\nvar __setModuleDefault = void 0 && (void 0).__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\nvar __importStar = void 0 && (void 0).__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  __setModuleDefault(result, mod);\n  return result;\n};\nvar __importDefault = void 0 && (void 0).__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar ahooks_1 = require(\"ahooks\");\nvar antd_1 = require(\"antd\");\nvar classnames_1 = __importDefault(require(\"classnames\"));\nvar react_1 = __importStar(require(\"react\"));\nvar adhere_ui_flexlayout_1 = __importDefault(require(\"@baifendian/adhere-ui-flexlayout\"));\nvar adhere_util_intl_1 = __importDefault(require(\"@baifendian/adhere-util-intl\"));\nvar CircleDrawAction_1 = __importDefault(require(\"../draw/CircleDrawAction\"));\nvar DiamondDrawAction_1 = __importDefault(require(\"../draw/DiamondDrawAction\"));\nvar PolygonDrawAction_1 = __importDefault(require(\"../draw/PolygonDrawAction\"));\nvar RectangleDrawAction_1 = __importDefault(require(\"../draw/RectangleDrawAction\"));\nvar StartDrawAction_1 = __importDefault(require(\"../draw/StartDrawAction\"));\nvar TriangleDrawAction_1 = __importDefault(require(\"../draw/TriangleDrawAction\"));\nvar index_1 = __importDefault(require(\"../index\"));\nvar CircleModifyAction_1 = __importDefault(require(\"../modify/CircleModifyAction\"));\nvar DiamondModifyAction_1 = __importDefault(require(\"../modify/DiamondModifyAction\"));\nvar PolygonModifyAction_1 = __importDefault(require(\"../modify/PolygonModifyAction\"));\nvar RectangleModifyAction_1 = __importDefault(require(\"../modify/RectangleModifyAction\"));\nvar StartModifyAction_1 = __importDefault(require(\"../modify/StartModifyAction\"));\nvar TriangleModifyAction_1 = __importDefault(require(\"../modify/TriangleModifyAction\"));\nvar types_1 = require(\"../types\");\nvar util_1 = require(\"./util\");\nvar selectorPrefix = 'adhere-ui-cropping-core';\n/**\n * CroppingCore\n * @param props\n * @param ref\n * @constructor\n */\nvar CroppingCore = function CroppingCore(_a, ref) {\n  var _b;\n  var className = _a.className,\n    wrapStyle = _a.style,\n    wrapProps = _a.wrapProps,\n    toolProps = _a.toolProps,\n    areaProps = _a.areaProps,\n    _c = _a.minHeight,\n    minHeight = _c === void 0 ? 200 : _c,\n    toolBarConfig = _a.toolBarConfig;\n  var _d = (0, react_1.useState)(null),\n    type = _d[0],\n    setType = _d[1];\n  var _e = (0, react_1.useState)(''),\n    base64 = _e[0],\n    setBase64 = _e[1];\n  var base64Ref = (0, react_1.useRef)(null);\n  var wrapRef = (0, react_1.useRef)(null);\n  var clipRef = (0, react_1.useRef)(null);\n  var clipCanvasEL = (0, react_1.useRef)(null);\n  var clipCanvasCtx = (0, react_1.useRef)();\n  var geometryRef = (0, react_1.useRef)(null);\n  var polygonSelection = (0, react_1.useRef)();\n  var curAction = (0, react_1.useRef)(null);\n  var inputFileFieldRef = (0, react_1.useRef)(null);\n  var data = (0, react_1.useRef)(null);\n  var layoutMap = new Map([['left', function () {\n    return react_1.default.createElement(adhere_ui_flexlayout_1.default.TRBLC.LCLayout, __assign({}, defaultProps, wrapProps, {\n      lProps: __assign(__assign(__assign({}, defaultToolbarProps), toolProps), {\n        children: renderTool\n      }),\n      cProps: __assign(__assign(__assign({}, defaultCProps), areaProps), {\n        children: renderArea\n      })\n    }));\n  }], ['right', function () {\n    return react_1.default.createElement(adhere_ui_flexlayout_1.default.TRBLC.CRLayout, __assign({}, defaultProps, wrapProps, {\n      rProps: __assign(__assign(__assign({}, defaultToolbarProps), toolProps), {\n        children: renderTool\n      }),\n      cProps: __assign(__assign(__assign({}, defaultCProps), areaProps), {\n        children: renderArea\n      })\n    }));\n  }], ['top', function () {\n    return react_1.default.createElement(adhere_ui_flexlayout_1.default.TRBLC.TCLayout, __assign({}, defaultProps, wrapProps, {\n      tProps: __assign(__assign(__assign({}, defaultToolbarProps), toolProps), {\n        children: renderTool\n      }),\n      cProps: __assign(__assign(__assign({}, defaultCProps), areaProps), {\n        children: renderArea\n      })\n    }));\n  }], ['bottom', function () {\n    return react_1.default.createElement(adhere_ui_flexlayout_1.default.TRBLC.CBLayout, __assign({}, defaultProps, wrapProps, {\n      bProps: __assign(__assign(__assign({}, defaultToolbarProps), toolProps), {\n        children: renderTool\n      }),\n      cProps: __assign(__assign(__assign({}, defaultCProps), areaProps), {\n        children: renderArea\n      })\n    }));\n  }]]);\n  // ActionType\n  var typeActionMap = (0, react_1.useMemo)(function () {\n    return new Map([[types_1.SelectType.Polygon, PolygonModifyAction_1.default], [types_1.SelectType.Circle, CircleModifyAction_1.default], [types_1.SelectType.Rectangle, RectangleModifyAction_1.default], [types_1.SelectType.Triangle, TriangleModifyAction_1.default], [types_1.SelectType.Diamond, DiamondModifyAction_1.default], [types_1.SelectType.Start, StartModifyAction_1.default]]);\n  }, []);\n  var style = (0, react_1.useMemo)(function () {\n    return {\n      fillStyle: 'transparent',\n      // 描边颜色\n      strokeStyle: '#fff',\n      // 描边大小\n      lineWidth: 1,\n      lineCap: 'round',\n      lineJoin: 'round',\n      lineDash: [\n        /*5, 4, 3*/\n      ],\n      lineDashOffset: -1,\n      globalAlpha: 1\n    };\n  }, []);\n  var anchorStyle = {\n    fillStyle: '#fff'\n  };\n  /**\n   * defaultProps\n   */\n  var defaultProps = (0, react_1.useMemo)(function () {\n    return {\n      gutter: 20,\n      wrapClassName: \"\".concat(selectorPrefix, \"-inner\")\n    };\n  }, []);\n  /**\n   * defaultToolbarProps\n   */\n  var defaultToolbarProps = (0, react_1.useMemo)(function () {\n    return {\n      fit: true\n    };\n  }, []);\n  /**\n   * defaultCProps\n   */\n  var defaultCProps = (0, react_1.useMemo)(function () {\n    return {\n      autoFixed: true\n    };\n  }, []);\n  /**\n   * renderTool\n   */\n  var renderTool = (0, react_1.useMemo)(function () {\n    var _a, _b, _c;\n    var getType = function getType(_type) {\n      return _type === type ? 'primary' : 'default';\n    };\n    var onBeforeClick = function onBeforeClick(_type) {\n      var _a, _b;\n      if (_type !== type) {\n        clearClip();\n        (_b = (_a = polygonSelection === null || polygonSelection === void 0 ? void 0 : polygonSelection.current) === null || _a === void 0 ? void 0 : _a.clearCanvasAll) === null || _b === void 0 ? void 0 : _b.call(_a);\n        data.current = null;\n        setType(_type);\n      }\n      return _type !== type ? Promise.resolve() : Promise.reject();\n    };\n    var onClickHOC = function onClickHOC(type, ActionClass) {\n      return function () {\n        onBeforeClick(type).then(function () {\n          var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m;\n          curAction.current = new ActionClass();\n          if (!curAction.current) return;\n          curAction.current.setAnchorStyle(__assign({}, anchorStyle));\n          curAction.current.setMoveGemStyle(__assign({}, anchorStyle));\n          (_b = (_a = curAction === null || curAction === void 0 ? void 0 : curAction.current) === null || _a === void 0 ? void 0 : _a.on) === null || _b === void 0 ? void 0 : _b.call(_a, types_1.ActionEvents.DrawBeforeStart, function (e) {\n            // console.log('绘制开始前', JSON.stringify(e));\n            clip(e);\n          });\n          (_d = (_c = curAction === null || curAction === void 0 ? void 0 : curAction.current) === null || _c === void 0 ? void 0 : _c.on) === null || _d === void 0 ? void 0 : _d.call(_c, types_1.ActionEvents.DrawStart, function (e) {\n            // console.log('绘制开始', JSON.stringify(e));\n            clip(e);\n          });\n          (_f = (_e = curAction === null || curAction === void 0 ? void 0 : curAction.current) === null || _e === void 0 ? void 0 : _e.on) === null || _f === void 0 ? void 0 : _f.call(_e, types_1.ActionEvents.Drawing, function (e) {\n            // console.log('绘制中', JSON.stringify(e));\n            clip(e);\n          });\n          (_h = (_g = curAction === null || curAction === void 0 ? void 0 : curAction.current) === null || _g === void 0 ? void 0 : _g.on) === null || _h === void 0 ? void 0 : _h.call(_g, types_1.ActionEvents.DrawEnd, function (e) {\n            // curAction.current.start(data?.style);\n            // console.log('绘制完成', JSON.stringify(e));\n            clip(e);\n          });\n          (_k = (_j = polygonSelection === null || polygonSelection === void 0 ? void 0 : polygonSelection.current) === null || _j === void 0 ? void 0 : _j.changeAction) === null || _k === void 0 ? void 0 : _k.call(_j, curAction.current);\n          (_m = (_l = curAction === null || curAction === void 0 ? void 0 : curAction.current) === null || _l === void 0 ? void 0 : _l.start) === null || _m === void 0 ? void 0 : _m.call(_l, style);\n        });\n      };\n    };\n    /**\n     * renderCroppingTools\n     * @returns\n     */\n    var renderCroppingTools = function renderCroppingTools() {\n      var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t;\n      var tools = [{\n        key: 'rectangle',\n        value: (!toolBarConfig || !('rectangle' in toolBarConfig) || !('hide' in toolBarConfig.rectangle) || !((_a = toolBarConfig === null || toolBarConfig === void 0 ? void 0 : toolBarConfig.rectangle) === null || _a === void 0 ? void 0 : _a.hide)) && (((_c = (_b = toolBarConfig === null || toolBarConfig === void 0 ? void 0 : toolBarConfig.rectangle) === null || _b === void 0 ? void 0 : _b.render) === null || _c === void 0 ? void 0 : _c.call(_b, onClickHOC(types_1.SelectType.Rectangle, RectangleDrawAction_1.default))) || react_1.default.createElement(antd_1.Button, {\n          key: \"rectangle\",\n          block: true,\n          size: \"large\",\n          type: getType(types_1.SelectType.Rectangle),\n          onClick: onClickHOC(types_1.SelectType.Rectangle, RectangleDrawAction_1.default)\n        }, adhere_util_intl_1.default.v('矩形剪裁')))\n      }, {\n        key: 'circle',\n        value: (!toolBarConfig || !('circle' in toolBarConfig) || !('hide' in toolBarConfig.circle) || !((_d = toolBarConfig === null || toolBarConfig === void 0 ? void 0 : toolBarConfig.circle) === null || _d === void 0 ? void 0 : _d.hide)) && (((_f = (_e = toolBarConfig === null || toolBarConfig === void 0 ? void 0 : toolBarConfig.circle) === null || _e === void 0 ? void 0 : _e.render) === null || _f === void 0 ? void 0 : _f.call(_e, onClickHOC(types_1.SelectType.Circle, CircleDrawAction_1.default))) || react_1.default.createElement(antd_1.Button, {\n          key: \"circle\",\n          block: true,\n          size: \"large\",\n          type: getType(types_1.SelectType.Circle),\n          onClick: onClickHOC(types_1.SelectType.Circle, CircleDrawAction_1.default)\n        }, adhere_util_intl_1.default.v('圆形剪裁')))\n      }, {\n        key: 'start',\n        value: (!toolBarConfig || !('start' in toolBarConfig) || !('hide' in toolBarConfig.start) || !((_g = toolBarConfig === null || toolBarConfig === void 0 ? void 0 : toolBarConfig.start) === null || _g === void 0 ? void 0 : _g.hide)) && (((_j = (_h = toolBarConfig === null || toolBarConfig === void 0 ? void 0 : toolBarConfig.start) === null || _h === void 0 ? void 0 : _h.render) === null || _j === void 0 ? void 0 : _j.call(_h, onClickHOC(types_1.SelectType.Start, StartDrawAction_1.default))) || react_1.default.createElement(antd_1.Button, {\n          key: \"start\",\n          block: true,\n          size: \"large\",\n          type: getType(types_1.SelectType.Start),\n          onClick: onClickHOC(types_1.SelectType.Start, StartDrawAction_1.default)\n        }, adhere_util_intl_1.default.v('五角星剪裁')))\n      }, {\n        key: 'triangle',\n        value: (!toolBarConfig || !('triangle' in toolBarConfig) || !('hide' in toolBarConfig.triangle) || !((_k = toolBarConfig === null || toolBarConfig === void 0 ? void 0 : toolBarConfig.triangle) === null || _k === void 0 ? void 0 : _k.hide)) && (((_m = (_l = toolBarConfig === null || toolBarConfig === void 0 ? void 0 : toolBarConfig.triangle) === null || _l === void 0 ? void 0 : _l.render) === null || _m === void 0 ? void 0 : _m.call(_l, onClickHOC(types_1.SelectType.Triangle, TriangleDrawAction_1.default))) || react_1.default.createElement(antd_1.Button, {\n          key: \"triangle\",\n          block: true,\n          size: \"large\",\n          type: getType(types_1.SelectType.Triangle),\n          onClick: onClickHOC(types_1.SelectType.Triangle, TriangleDrawAction_1.default)\n        }, adhere_util_intl_1.default.v('三角形剪裁')))\n      }, {\n        key: 'diamond',\n        value: (!toolBarConfig || !('diamond' in toolBarConfig) || !('hide' in toolBarConfig.diamond) || !((_o = toolBarConfig === null || toolBarConfig === void 0 ? void 0 : toolBarConfig.diamond) === null || _o === void 0 ? void 0 : _o.hide)) && (((_q = (_p = toolBarConfig === null || toolBarConfig === void 0 ? void 0 : toolBarConfig.diamond) === null || _p === void 0 ? void 0 : _p.render) === null || _q === void 0 ? void 0 : _q.call(_p, onClickHOC(types_1.SelectType.Diamond, DiamondDrawAction_1.default))) || react_1.default.createElement(antd_1.Button, {\n          key: \"diamond\",\n          block: true,\n          size: \"large\",\n          type: getType(types_1.SelectType.Diamond),\n          onClick: onClickHOC(types_1.SelectType.Diamond, DiamondDrawAction_1.default)\n        }, adhere_util_intl_1.default.v('菱形剪裁')))\n      }, {\n        key: 'polygon',\n        value: (!toolBarConfig || !('polygon' in toolBarConfig) || !('hide' in toolBarConfig.polygon) || !((_r = toolBarConfig === null || toolBarConfig === void 0 ? void 0 : toolBarConfig.polygon) === null || _r === void 0 ? void 0 : _r.hide)) && (((_t = (_s = toolBarConfig === null || toolBarConfig === void 0 ? void 0 : toolBarConfig.polygon) === null || _s === void 0 ? void 0 : _s.render) === null || _t === void 0 ? void 0 : _t.call(_s, onClickHOC(types_1.SelectType.Polygon, PolygonDrawAction_1.default))) || react_1.default.createElement(antd_1.Button, {\n          key: \"polygon\",\n          block: true,\n          size: \"large\",\n          type: getType(types_1.SelectType.Polygon),\n          onClick: onClickHOC(types_1.SelectType.Polygon, PolygonDrawAction_1.default)\n        }, adhere_util_intl_1.default.v('多边形剪裁')))\n      }];\n      return tools.filter(function (t) {\n        return !!t.value;\n      });\n    };\n    var toolsArr = [{\n      key: 'open',\n      value: ((_b = (_a = toolBarConfig === null || toolBarConfig === void 0 ? void 0 : toolBarConfig.open) === null || _a === void 0 ? void 0 : _a.render) === null || _b === void 0 ? void 0 : _b.call(_a, function () {\n        var _a;\n        (_a = inputFileFieldRef.current) === null || _a === void 0 ? void 0 : _a.click();\n      })) || react_1.default.createElement(antd_1.Button, {\n        key: \"open\",\n        block: true,\n        size: \"large\",\n        type: \"primary\",\n        onClick: function onClick() {\n          var _a;\n          (_a = inputFileFieldRef.current) === null || _a === void 0 ? void 0 : _a.click();\n        }\n      }, adhere_util_intl_1.default.v('打开'))\n    }, base64 ? renderCroppingTools() : [{\n      key: '',\n      value: null\n    }]].flat().filter(function (t) {\n      return !!t.value;\n    });\n    toolsArr = (0, util_1.sort)(toolsArr.map(function (t) {\n      var _a;\n      if ('sort' in ((_a = toolBarConfig === null || toolBarConfig === void 0 ? void 0 : toolBarConfig[t.key]) !== null && _a !== void 0 ? _a : {})) {\n        return __assign(__assign({}, t), {\n          sort: toolBarConfig === null || toolBarConfig === void 0 ? void 0 : toolBarConfig[t.key].sort\n        });\n      }\n      return t;\n    })).map(function (t) {\n      return t.value;\n    });\n    var direction = ['left', 'right'].includes((_c = toolBarConfig === null || toolBarConfig === void 0 ? void 0 : toolBarConfig.direction) !== null && _c !== void 0 ? _c : 'left') ? 'vertical' : 'horizontal';\n    return react_1.default.createElement(antd_1.Card, null, react_1.default.createElement(antd_1.Space, {\n      direction: direction,\n      size: 20\n    }, react_1.default.createElement(\"input\", {\n      type: \"file\",\n      ref: inputFileFieldRef,\n      accept: \"image/*\",\n      style: {\n        display: 'none'\n      }\n    }), toolsArr));\n  }, [type, toolProps, base64, toolBarConfig]);\n  /**\n   * renderArea\n   */\n  var renderArea = (0, react_1.useMemo)(function () {\n    return react_1.default.createElement(antd_1.Card, null, react_1.default.createElement(\"div\", {\n      className: \"\".concat(selectorPrefix, \"-background\"),\n      style: {\n        minHeight: minHeight || 200\n      }\n    }, base64 && react_1.default.createElement(\"div\", {\n      className: \"\".concat(selectorPrefix, \"-background-inner\")\n    }, react_1.default.createElement(\"img\", {\n      ref: base64Ref,\n      src: base64,\n      alt: \"\"\n    }), react_1.default.createElement(\"div\", {\n      className: \"\".concat(selectorPrefix, \"-background-mask\")\n    }))), react_1.default.createElement(\"div\", {\n      className: \"\".concat(selectorPrefix, \"-geometry\"),\n      ref: geometryRef\n    }), react_1.default.createElement(\"div\", {\n      className: \"\".concat(selectorPrefix, \"-clip\"),\n      ref: clipRef\n    }));\n  }, [base64, areaProps]);\n  var image = (0, react_1.useCallback)(function () {\n    var img = new Image();\n    img.src = base64;\n    return img;\n  }, [base64]);\n  /**\n   * useUpdateLayoutEffect\n   */\n  (0, ahooks_1.useUpdateLayoutEffect)(function () {\n    setType(null);\n    if (base64Ref.current) {\n      base64Ref.current.onload = function () {\n        if (polygonSelection.current) {\n          data.current = null;\n          destroyClip();\n          destroySelection();\n        }\n        createClip();\n        createSelection();\n      };\n    }\n  }, [base64]);\n  /**\n   * useLayoutEffect\n   */\n  (0, react_1.useLayoutEffect)(function () {\n    var _a;\n    var onChange = function onChange(e) {\n      var file = e.target.files[0];\n      var read = new FileReader();\n      read.onload = function (e) {\n        var _a;\n        setBase64((_a = e.target) === null || _a === void 0 ? void 0 : _a.result);\n      };\n      read.readAsDataURL(file);\n    };\n    (_a = inputFileFieldRef.current) === null || _a === void 0 ? void 0 : _a.addEventListener('change', onChange);\n    return function () {\n      var _a;\n      (_a = inputFileFieldRef.current) === null || _a === void 0 ? void 0 : _a.removeEventListener('change', onChange);\n    };\n  }, []);\n  (0, react_1.useImperativeHandle)(ref, function () {\n    return {\n      /**\n       * save\n       * @return {string}\n       */\n      save: function save() {\n        // 通过data获取外接矩形数据\n        // 创建一个canvas，绘制base64\n        // getImageData(矩形数据)\n        if (!data.current || !data.current.data || !base64) return '';\n        return (0, util_1.getClipDataUrl)({\n          data: data.current,\n          clipCtx: clipCanvasCtx.current\n        });\n      }\n    };\n  });\n  /**\n   * clip\n   * @param {IActionData} e\n   * @return void\n   */\n  var clip = function clip(e) {\n    var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m;\n    if (!e.data) return;\n    data.current = e;\n    (_b = (_a = clipCanvasCtx.current) === null || _a === void 0 ? void 0 : _a.restore) === null || _b === void 0 ? void 0 : _b.call(_a);\n    (_d = (_c = clipCanvasCtx.current) === null || _c === void 0 ? void 0 : _c.save) === null || _d === void 0 ? void 0 : _d.call(_c);\n    (_e = clipCanvasCtx.current) === null || _e === void 0 ? void 0 : _e.clearRect(0, 0, (_f = clipCanvasEL.current) === null || _f === void 0 ? void 0 : _f.width, (_g = clipCanvasEL.current) === null || _g === void 0 ? void 0 : _g.height);\n    var drawMap = new Map([[types_1.SelectType.Circle, util_1.drawCircle], [types_1.SelectType.Rectangle, util_1.drawRectangle], [types_1.SelectType.Diamond, util_1.drawDiamond], [types_1.SelectType.Start, util_1.drawStart], [types_1.SelectType.Triangle, util_1.drawTriangle], [types_1.SelectType.Polygon, util_1.drawPolygon]]);\n    (_h = drawMap.get(e.selectType)) === null || _h === void 0 ? void 0 : _h(clipCanvasCtx.current, e.data);\n    (_j = clipCanvasCtx === null || clipCanvasCtx === void 0 ? void 0 : clipCanvasCtx.current) === null || _j === void 0 ? void 0 : _j.clip();\n    (_k = clipCanvasCtx === null || clipCanvasCtx === void 0 ? void 0 : clipCanvasCtx.current) === null || _k === void 0 ? void 0 : _k.drawImage(image(), 0, 0, (_l = clipCanvasEL.current) === null || _l === void 0 ? void 0 : _l.width, (_m = clipCanvasEL.current) === null || _m === void 0 ? void 0 : _m.height);\n  };\n  /**\n   * clearClip\n   */\n  var clearClip = function clearClip() {\n    var _a, _b, _c, _d, _e;\n    (_a = clipCanvasCtx.current) === null || _a === void 0 ? void 0 : _a.restore();\n    (_c = (_b = clipCanvasCtx.current) === null || _b === void 0 ? void 0 : _b.clearRect) === null || _c === void 0 ? void 0 : _c.call(_b, 0, 0, (_d = clipCanvasEL.current) === null || _d === void 0 ? void 0 : _d.width, (_e = clipCanvasEL.current) === null || _e === void 0 ? void 0 : _e.height);\n  };\n  /**\n   * destroyClip\n   * @returns\n   */\n  var destroyClip = function destroyClip() {\n    if (!clipRef.current) return;\n    clipRef.current.innerHTML = '';\n  };\n  /**\n   * createClip\n   */\n  var createClip = function createClip() {\n    var _a, _b, _c, _d, _e, _f;\n    clipCanvasEL.current = document.createElement('canvas');\n    clipCanvasEL.current.width = (_a = base64Ref.current) === null || _a === void 0 ? void 0 : _a.offsetWidth;\n    clipCanvasEL.current.height = (_b = base64Ref.current) === null || _b === void 0 ? void 0 : _b.offsetHeight;\n    clipCanvasCtx.current = (_d = (_c = clipCanvasEL.current) === null || _c === void 0 ? void 0 : _c.getContext) === null || _d === void 0 ? void 0 : _d.call(_c, '2d');\n    (_f = (_e = clipRef.current) === null || _e === void 0 ? void 0 : _e.appendChild) === null || _f === void 0 ? void 0 : _f.call(_e, clipCanvasEL.current);\n  };\n  /**\n   * destroySelection\n   */\n  var destroySelection = function destroySelection() {\n    var _a, _b;\n    (_b = (_a = polygonSelection === null || polygonSelection === void 0 ? void 0 : polygonSelection.current) === null || _a === void 0 ? void 0 : _a.destroy) === null || _b === void 0 ? void 0 : _b.call(_a);\n  };\n  /**\n   * createSelection\n   * @returns\n   */\n  var createSelection = function createSelection() {\n    var _a, _b;\n    if (!geometryRef.current) return;\n    geometryRef.current.style.width = \"\".concat((_a = base64Ref === null || base64Ref === void 0 ? void 0 : base64Ref.current) === null || _a === void 0 ? void 0 : _a.offsetWidth, \"px\");\n    geometryRef.current.style.height = \"\".concat((_b = base64Ref === null || base64Ref === void 0 ? void 0 : base64Ref.current) === null || _b === void 0 ? void 0 : _b.offsetHeight, \"px\");\n    polygonSelection.current = new index_1.default.PolygonSelection(geometryRef.current);\n    /**\n     * CanvasClickGeometry\n     */\n    polygonSelection.current.on(types_1.PolygonSelectionActions.CanvasClickGeometry, function (data) {\n      // 多边形数据据\n      // const d = {\n      //   selectType: 'Polygon',\n      //   actionType: 'Draw',\n      //   data: {\n      //     id: 'fd4ef30f-8add-4cc1-8f36-d861e77b5354',\n      //     type: 'Polygon',\n      //     data: [\n      //       { x: 148.34375, y: 33 },\n      //       { x: 120.34375, y: 198 },\n      //       { x: 360.34375, y: 181 },\n      //     ],\n      //     style: {\n      //       fillStyle: 'red',\n      //       strokeStyle: '#000',\n      //       lineWidth: 2,\n      //       lineCap: 'round',\n      //       lineJoin: 'round',\n      //       lineDash: [],\n      //       lineDashOffset: -1,\n      //     },\n      //   },\n      // };\n      //\n      // polygonSelection.current.clearDraw();\n      // polygonSelection.current.addHistoryData(d.data);\n      // polygonSelection.current.drawHistoryData();\n      //\n      // const action = new PolygonModifyAction(d);\n      // action.on(ActionEvents.End, () => {\n      //   action.start();\n      // });\n      // polygonSelection.current.changeAction(action);\n      // action.start();\n      var _a;\n      // console.log('click');\n      var Component = typeActionMap.get(data.type);\n      var action = new Component({\n        selectType: data.type,\n        actionType: 'Draw',\n        data: data\n      });\n      action.setAnchorStyle(__assign({}, anchorStyle));\n      action.setMoveGemStyle(__assign({}, anchorStyle));\n      action.on(types_1.ActionEvents.ModifyBeforeStart, function (e) {\n        // console.log('修改开始前', JSON.stringify(e));\n        clip(e);\n      });\n      action.on(types_1.ActionEvents.ModifyStart, function (e) {\n        // console.log('修改开始', JSON.stringify(e));\n        clip(e);\n      });\n      action.on(types_1.ActionEvents.Modifying, function (e) {\n        // console.log('修改中', JSON.stringify(e));\n        clip(e);\n      });\n      action.on(types_1.ActionEvents.ModifyEnd, function (e) {\n        // console.log('修改完成', JSON.stringify(e));\n        clip(e);\n        action.start();\n      });\n      action.on(types_1.ActionEvents.Moving, function (e) {\n        // console.log('移动中', JSON.stringify(e));\n        clip(e);\n      });\n      action.on(types_1.ActionEvents.MoveEnd, function (e) {\n        // console.log('移动完成', JSON.stringify(e));\n        clip(e);\n      });\n      (_a = polygonSelection === null || polygonSelection === void 0 ? void 0 : polygonSelection.current) === null || _a === void 0 ? void 0 : _a.changeAction(action);\n      action.start();\n    });\n    /**\n     * CanvasClickEmpty\n     */\n    polygonSelection.current.on(types_1.PolygonSelectionActions.CanvasClickEmpty, function () {\n      var _a, _b, _c;\n      // console.log('clickEmpty');\n      (_a = polygonSelection === null || polygonSelection === void 0 ? void 0 : polygonSelection.current) === null || _a === void 0 ? void 0 : _a.clearDraw();\n      (_b = polygonSelection === null || polygonSelection === void 0 ? void 0 : polygonSelection.current) === null || _b === void 0 ? void 0 : _b.clearAssistDraw();\n      (_c = polygonSelection === null || polygonSelection === void 0 ? void 0 : polygonSelection.current) === null || _c === void 0 ? void 0 : _c.drawHistoryData();\n    });\n  };\n  var children = (_b = layoutMap.get((toolBarConfig === null || toolBarConfig === void 0 ? void 0 : toolBarConfig.direction) || 'left')) === null || _b === void 0 ? void 0 : _b();\n  return react_1.default.createElement(\"div\", {\n    ref: wrapRef,\n    className: \"\".concat((0, classnames_1.default)(selectorPrefix, className !== null && className !== void 0 ? className : '')),\n    style: wrapStyle !== null && wrapStyle !== void 0 ? wrapStyle : {}\n  }, children);\n};\nvar CroppingCoreHOC = (0, react_1.memo)((0, react_1.forwardRef)(CroppingCore));\nexports.default = CroppingCoreHOC;"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","this","__createBinding","create","o","m","k","k2","undefined","desc","getOwnPropertyDescriptor","__esModule","writable","configurable","enumerable","get","defineProperty","__setModuleDefault","v","value","__importStar","mod","result","__importDefault","default","ahooks_1","exports","require","antd_1","classnames_1","react_1","adhere_ui_flexlayout_1","adhere_util_intl_1","CircleDrawAction_1","DiamondDrawAction_1","PolygonDrawAction_1","RectangleDrawAction_1","StartDrawAction_1","TriangleDrawAction_1","index_1","CircleModifyAction_1","DiamondModifyAction_1","PolygonModifyAction_1","RectangleModifyAction_1","StartModifyAction_1","TriangleModifyAction_1","types_1","util_1","selectorPrefix","CroppingCore","_a","ref","className","wrapStyle","style","wrapProps","toolProps","areaProps","_c","minHeight","toolBarConfig","_d","useState","type","setType","_e","base64","setBase64","base64Ref","useRef","wrapRef","clipRef","clipCanvasEL","clipCanvasCtx","geometryRef","polygonSelection","curAction","inputFileFieldRef","data","layoutMap","Map","createElement","TRBLC","LCLayout","defaultProps","lProps","defaultToolbarProps","children","renderTool","cProps","defaultCProps","renderArea","CRLayout","rProps","TCLayout","tProps","CBLayout","bProps","typeActionMap","useMemo","SelectType","Polygon","Circle","Rectangle","Triangle","Diamond","Start","fillStyle","strokeStyle","lineWidth","lineCap","lineJoin","lineDash","lineDashOffset","globalAlpha","anchorStyle","gutter","wrapClassName","concat","fit","autoFixed","_s","getType","_type","onClickHOC","ActionClass","_b","clearClip","current","clearCanvasAll","Promise","resolve","reject","then","_l","_m","setAnchorStyle","setMoveGemStyle","on","ActionEvents","DrawBeforeStart","e","clip","DrawStart","_f","Drawing","_h","_g","DrawEnd","_k","_j","changeAction","start","toolsArr","key","open","render","click","Button","block","size","onClick","rectangle","hide","circle","triangle","diamond","_o","_q","_p","polygon","_r","_t","filter","flat","sort","map","direction","includes","Card","Space","accept","display","src","alt","image","useCallback","img","Image","useUpdateLayoutEffect","onload","destroyClip","destroySelection","createClip","createSelection","useLayoutEffect","onChange","file","target","files","read","FileReader","readAsDataURL","addEventListener","removeEventListener","useImperativeHandle","save","getClipDataUrl","clipCtx","restore","clearRect","width","height","drawCircle","drawRectangle","drawDiamond","drawStart","drawTriangle","drawPolygon","selectType","drawImage","innerHTML","document","offsetWidth","offsetHeight","getContext","appendChild","destroy","PolygonSelection","PolygonSelectionActions","CanvasClickGeometry","action","actionType","ModifyBeforeStart","ModifyStart","Modifying","ModifyEnd","Moving","MoveEnd","CanvasClickEmpty","clearDraw","clearAssistDraw","drawHistoryData","CroppingCoreHOC","memo","forwardRef"],"mappings":"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"}