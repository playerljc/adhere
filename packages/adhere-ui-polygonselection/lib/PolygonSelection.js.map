{"version":3,"file":"PolygonSelection.js","sources":["PolygonSelection.js"],"sourcesContent":["var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\nimport Emitter from '@baifendian/adhere-util-emitter/lib/events';\r\nimport { ActionStatus, PolygonSelectionActions, SelectType, } from './types';\r\nimport PolygonDrawAction from './draw/polygonDrawAction';\r\nimport CircleDrawAction from './draw/circleDrawAction';\r\nimport RectangleDrawAction from './draw/rectangleDrawAction';\r\nimport TriangleDrawAction from './draw/triangleDrawAction';\r\nimport DiamondDrawAction from './draw/diamondDrawAction';\r\nimport StartDrawAction from './draw/startDrawAction';\r\nimport FreeDrawAction from './draw/freeDrawAction';\r\nvar selectorPrefix = 'adhere-ui-polygonselection';\r\n/**\r\n * PolygonSelection\r\n * @class\r\n * @classdesc - PolygonSelection\r\n */\r\nvar PolygonSelection = /** @class */ (function (_super) {\r\n    __extends(PolygonSelection, _super);\r\n    /**\r\n     * constructor\r\n     * @param el - 父元素\r\n     * @param defaultData: IActionData[]\r\n     */\r\n    function PolygonSelection(el, defaultData) {\r\n        var _this = _super.call(this) || this;\r\n        // 父元素\r\n        _this.el = null;\r\n        // 当前的Action\r\n        _this.curAction = null;\r\n        // 当前的canvas元素\r\n        _this.canvasEl = null;\r\n        // 当前的ctx对象\r\n        _this.ctx = null;\r\n        // canvas上的所有数据\r\n        _this.canvasData = [];\r\n        // ActionType\r\n        // @ts-ignore\r\n        _this.typeActionMap = new Map([\r\n            [SelectType.Polygon, PolygonDrawAction],\r\n            [SelectType.Circle, CircleDrawAction],\r\n            [SelectType.Rectangle, RectangleDrawAction],\r\n            [SelectType.Triangle, TriangleDrawAction],\r\n            [SelectType.Diamond, DiamondDrawAction],\r\n            [SelectType.Start, StartDrawAction],\r\n            [SelectType.Free, FreeDrawAction],\r\n        ]);\r\n        _this.el = el;\r\n        defaultData && (_this.canvasData = defaultData);\r\n        _this.onResize = _this.onResize.bind(_this);\r\n        // 初始化canvas\r\n        _this.initCanvas();\r\n        return _this;\r\n    }\r\n    /**\r\n     * initCanvas - 初始化Canvas\r\n     */\r\n    PolygonSelection.prototype.initCanvas = function () {\r\n        var _a;\r\n        // 创建一个canvas\r\n        this.canvasEl = document.createElement('canvas');\r\n        this.canvasEl.className = selectorPrefix;\r\n        this.ctx = this.canvasEl.getContext('2d');\r\n        (_a = this.el) === null || _a === void 0 ? void 0 : _a.appendChild(this.canvasEl);\r\n        // 触发canvasMount事件\r\n        this.trigger(PolygonSelectionActions.CanvasMount);\r\n        // 适配canvas\r\n        this.adapterCanvas();\r\n        // window.addEventListener('resize', this.onResize);\r\n    };\r\n    /**\r\n     * adapterCanvas - 适配canvas\r\n     */\r\n    PolygonSelection.prototype.adapterCanvas = function () {\r\n        var _a, _b;\r\n        var canvasEl = this.canvasEl;\r\n        if (canvasEl) {\r\n            canvasEl.width = ((_a = this.el) === null || _a === void 0 ? void 0 : _a.offsetWidth) || 0;\r\n            canvasEl.height = ((_b = this.el) === null || _b === void 0 ? void 0 : _b.offsetHeight) || 0;\r\n            this.clearDraw();\r\n            this.drawHistoryData();\r\n        }\r\n    };\r\n    /**\r\n     * onResize\r\n     */\r\n    PolygonSelection.prototype.onResize = function () {\r\n        this.adapterCanvas();\r\n    };\r\n    /**\r\n     * getCtx\r\n     * @return CanvasRenderingContext2D | null\r\n     */\r\n    PolygonSelection.prototype.getCtx = function () {\r\n        return this.ctx;\r\n    };\r\n    /**\r\n     * getCanvasEl\r\n     * @return HTMLCanvasElement | null\r\n     */\r\n    PolygonSelection.prototype.getCanvasEl = function () {\r\n        return this.canvasEl;\r\n    };\r\n    /**\r\n     * getWidth\r\n     * @return number\r\n     */\r\n    PolygonSelection.prototype.getWidth = function () {\r\n        var _a;\r\n        return ((_a = this === null || this === void 0 ? void 0 : this.el) === null || _a === void 0 ? void 0 : _a.offsetWidth) || 0;\r\n    };\r\n    /**\r\n     * getHeight\r\n     * @return number\r\n     */\r\n    PolygonSelection.prototype.getHeight = function () {\r\n        var _a;\r\n        return ((_a = this === null || this === void 0 ? void 0 : this.el) === null || _a === void 0 ? void 0 : _a.offsetHeight) || 0;\r\n    };\r\n    /**\r\n     * addHistoryData - 添加一个ActionData到canvasData中\r\n     * @param data\r\n     * @return void\r\n     */\r\n    PolygonSelection.prototype.addHistoryData = function (data) {\r\n        this.canvasData.push(data);\r\n    };\r\n    /**\r\n     * removeHistoryDataById - 删除一个ActionData中的数据\r\n     * @param actionDataId\r\n     * @return IActionData[]\r\n     */\r\n    PolygonSelection.prototype.removeHistoryDataById = function (actionDataId) {\r\n        var index = this.canvasData.findIndex(function (data) { return data.id === actionDataId; });\r\n        if (index === -1)\r\n            return [];\r\n        return this.canvasData.splice(index, 1);\r\n    };\r\n    /**\r\n     * drawHistoryData - 绘制历史数据\r\n     * @return void\r\n     */\r\n    PolygonSelection.prototype.drawHistoryData = function () {\r\n        var _this = this;\r\n        this.canvasData.forEach(function (data) {\r\n            var _a;\r\n            var ctx = _this.ctx;\r\n            if (!ctx || !data)\r\n                return;\r\n            if (data.style) {\r\n                // 设置上下文属性\r\n                ctx.lineWidth = data.style.lineWidth;\r\n                ctx.lineJoin = data.style.lineJoin;\r\n                ctx.lineCap = data.style.lineCap;\r\n                ctx.setLineDash(data.style.lineDash);\r\n                ctx.lineDashOffset = data.style.lineDashOffset;\r\n                ctx.strokeStyle = data.style.strokeStyle;\r\n                ctx.fillStyle = data.style.fillStyle;\r\n            }\r\n            // 绘制指定类型的路径\r\n            // @ts-ignore\r\n            (_a = _this.typeActionMap.get(data.type)) === null || _a === void 0 ? void 0 : _a.drawHistoryPath(ctx, data.data);\r\n            // 描边\r\n            ctx.stroke();\r\n            // 填充\r\n            ctx.fill();\r\n        });\r\n    };\r\n    /**\r\n     * getHistoryDataById\r\n     * @param id\r\n     * @return IActionData | null | undefined\r\n     */\r\n    PolygonSelection.prototype.getHistoryDataById = function (id) {\r\n        return this.canvasData.find(function (data) { return data.id === id; });\r\n    };\r\n    /**\r\n     * getHistoryData\r\n     * @return IActionData []\r\n     */\r\n    PolygonSelection.prototype.getHistoryData = function () {\r\n        return __spreadArrays(this.canvasData);\r\n    };\r\n    /**\r\n     * setHistoryData\r\n     * @param data\r\n     */\r\n    PolygonSelection.prototype.setHistoryData = function (data) {\r\n        this.canvasData = data;\r\n    };\r\n    /**\r\n     * changeAction - 切换一个Action\r\n     * @param action - action对象\r\n     * @return void\r\n     */\r\n    PolygonSelection.prototype.changeAction = function (action) {\r\n        // 如果当前和传入一致则跳过\r\n        if (action === this.curAction)\r\n            return;\r\n        // 只有是未开始才能切换\r\n        if (action.getStatus() !== ActionStatus.UnStart)\r\n            return;\r\n        if (this.curAction) {\r\n            this.curAction.destroy();\r\n        }\r\n        action === null || action === void 0 ? void 0 : action.setContext(this);\r\n        this.curAction = action;\r\n    };\r\n    /**\r\n     * start - 开始\r\n     * @param style\r\n     * @return void\r\n     */\r\n    PolygonSelection.prototype.start = function (style) {\r\n        if (!this.curAction)\r\n            return;\r\n        this.curAction.start(style);\r\n    };\r\n    /**\r\n     * end - 结束\r\n     * @return void\r\n     */\r\n    PolygonSelection.prototype.end = function () {\r\n        if (!this.curAction)\r\n            return;\r\n        this.curAction.end();\r\n    };\r\n    /**\r\n     * clear\r\n     */\r\n    PolygonSelection.prototype.clearDraw = function () {\r\n        var ctx = this.ctx;\r\n        if (!ctx)\r\n            return;\r\n        ctx.clearRect(0, 0, this.getWidth(), this.getHeight());\r\n    };\r\n    /**\r\n     * destroy - 销毁\r\n     * @return void\r\n     */\r\n    PolygonSelection.prototype.destroy = function () {\r\n        window.removeEventListener('resize', this.onResize);\r\n        if (this.curAction) {\r\n            this.curAction.destroy();\r\n        }\r\n    };\r\n    return PolygonSelection;\r\n}(Emitter));\r\nexport default PolygonSelection;\r\n"],"names":["__extends","this","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","__spreadArrays","s","i","il","arguments","length","r","k","a","j","jl","Emitter","ActionStatus","PolygonSelectionActions","SelectType","PolygonDrawAction","CircleDrawAction","RectangleDrawAction","TriangleDrawAction","DiamondDrawAction","StartDrawAction","FreeDrawAction","selectorPrefix","PolygonSelection","_super","el","defaultData","_this","call","curAction","canvasEl","ctx","canvasData","typeActionMap","Map","Polygon","Circle","Rectangle","Triangle","Diamond","Start","Free","onResize","bind","initCanvas","_a","document","createElement","className","getContext","appendChild","trigger","CanvasMount","adapterCanvas","width","offsetWidth","height","_b","offsetHeight","clearDraw","drawHistoryData","getCtx","getCanvasEl","getWidth","getHeight","addHistoryData","data","push","removeHistoryDataById","actionDataId","index","findIndex","id","splice","forEach","style","lineWidth","lineJoin","lineCap","setLineDash","lineDash","lineDashOffset","strokeStyle","fillStyle","get","type","drawHistoryPath","stroke","fill","getHistoryDataById","find","getHistoryData","setHistoryData","changeAction","action","getStatus","UnStart","destroy","setContext","start","end","clearRect","window","removeEventListener"],"mappings":"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"}