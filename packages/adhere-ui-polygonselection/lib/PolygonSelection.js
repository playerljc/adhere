var __extends=this&&this.__extends||function(){var i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};return function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),__spreadArrays=this&&this.__spreadArrays||function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var i=Array(t),o=0,e=0;e<n;e++)for(var r=arguments[e],a=0,s=r.length;a<s;a++,o++)i[o]=r[a];return i};import Emitter from"@baifendian/adhere-util-emitter/lib/events";import{ActionStatus,PolygonSelectionActions,SelectType}from"./types";import PolygonDrawAction from"./draw/polygonDrawAction";import CircleDrawAction from"./draw/circleDrawAction";import RectangleDrawAction from"./draw/rectangleDrawAction";import TriangleDrawAction from"./draw/triangleDrawAction";import DiamondDrawAction from"./draw/diamondDrawAction";import StartDrawAction from"./draw/startDrawAction";import FreeDrawAction from"./draw/freeDrawAction";var selectorPrefix="adhere-ui-polygonselection",PolygonSelection=function(i){function t(t,e){var n=i.call(this)||this;return n.el=null,n.curAction=null,n.canvasEl=null,n.ctx=null,n.canvasData=[],n.typeActionMap=new Map([[SelectType.Polygon,PolygonDrawAction],[SelectType.Circle,CircleDrawAction],[SelectType.Rectangle,RectangleDrawAction],[SelectType.Triangle,TriangleDrawAction],[SelectType.Diamond,DiamondDrawAction],[SelectType.Start,StartDrawAction],[SelectType.Free,FreeDrawAction]]),n.el=t,e&&(n.canvasData=e),n.onResize=n.onResize.bind(n),n.initCanvas(),n}return __extends(t,i),t.prototype.initCanvas=function(){var t;this.canvasEl=document.createElement("canvas"),this.canvasEl.className=selectorPrefix,this.ctx=this.canvasEl.getContext("2d"),null!==(t=this.el)&&void 0!==t&&t.appendChild(this.canvasEl),this.trigger(PolygonSelectionActions.CanvasMount),this.adapterCanvas()},t.prototype.adapterCanvas=function(){var t,e=this.canvasEl;e&&(e.width=(null===(t=this.el)||void 0===t?void 0:t.offsetWidth)||0,e.height=(null===(e=this.el)||void 0===e?void 0:e.offsetHeight)||0,this.clearDraw(),this.drawHistoryData())},t.prototype.onResize=function(){this.adapterCanvas()},t.prototype.getCtx=function(){return this.ctx},t.prototype.getCanvasEl=function(){return this.canvasEl},t.prototype.getWidth=function(){var t;return(null===(t=null==this?void 0:this.el)||void 0===t?void 0:t.offsetWidth)||0},t.prototype.getHeight=function(){var t;return(null===(t=null==this?void 0:this.el)||void 0===t?void 0:t.offsetHeight)||0},t.prototype.addHistoryData=function(t){this.canvasData.push(t)},t.prototype.removeHistoryDataById=function(e){var t=this.canvasData.findIndex(function(t){return t.id===e});return-1===t?[]:this.canvasData.splice(t,1)},t.prototype.drawHistoryData=function(){var i=this;this.canvasData.forEach(function(t){var e,n=i.ctx;n&&t&&(t.style&&(n.lineWidth=t.style.lineWidth,n.lineJoin=t.style.lineJoin,n.lineCap=t.style.lineCap,n.setLineDash(t.style.lineDash),n.lineDashOffset=t.style.lineDashOffset,n.strokeStyle=t.style.strokeStyle,n.fillStyle=t.style.fillStyle),null!==(e=i.typeActionMap.get(t.type))&&void 0!==e&&e.drawHistoryPath(n,t.data),n.stroke(),n.fill())})},t.prototype.getHistoryDataById=function(e){return this.canvasData.find(function(t){return t.id===e})},t.prototype.getHistoryData=function(){return __spreadArrays(this.canvasData)},t.prototype.setHistoryData=function(t){this.canvasData=t},t.prototype.changeAction=function(t){t!==this.curAction&&t.getStatus()===ActionStatus.UnStart&&(this.curAction&&this.curAction.destroy(),null!=t&&t.setContext(this),this.curAction=t)},t.prototype.start=function(t){this.curAction&&this.curAction.start(t)},t.prototype.end=function(){this.curAction&&this.curAction.end()},t.prototype.clearDraw=function(){var t=this.ctx;t&&t.clearRect(0,0,this.getWidth(),this.getHeight())},t.prototype.destroy=function(){window.removeEventListener("resize",this.onResize),this.curAction&&this.curAction.destroy()},t}(Emitter);export default PolygonSelection;
//# sourceMappingURL=PolygonSelection.js.map
