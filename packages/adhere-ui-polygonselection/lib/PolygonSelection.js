"use strict";var __extends=this&&this.__extends||function(){var n=function(t,e){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}))(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),__spreadArray=this&&this.__spreadArray||function(t,e,i){if(i||2===arguments.length)for(var n,a=0,r=e.length;a<r;a++)!n&&a in e||((n=n||Array.prototype.slice.call(e,0,a))[a]=e[a]);return t.concat(n||Array.prototype.slice.call(e))},__importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}},adhere_util_1=(Object.defineProperty(exports,"__esModule",{value:!0}),__importDefault(require("@baifendian/adhere-util"))),adhere_util_emitter_1=__importDefault(require("@baifendian/adhere-util-emitter")),CircleDrawAction_1=__importDefault(require("./draw/CircleDrawAction")),DiamondDrawAction_1=__importDefault(require("./draw/DiamondDrawAction")),FreeDrawAction_1=__importDefault(require("./draw/FreeDrawAction")),PolygonDrawAction_1=__importDefault(require("./draw/PolygonDrawAction")),RectangleDrawAction_1=__importDefault(require("./draw/RectangleDrawAction")),StartDrawAction_1=__importDefault(require("./draw/StartDrawAction")),TriangleDrawAction_1=__importDefault(require("./draw/TriangleDrawAction")),types_1=require("./types"),selectorPrefix="adhere-ui-polygonselection",PolygonSelection=function(a){function t(t,e,i){var n=a.call(this)||this;return n.el=null,n.listeners=null,n.curAction=null,n.canvasEl=null,n.ctx=null,n.assistCanvasEl=null,n.assistCtx=null,n.canvasData=[],n.typeActionMap=new Map([[types_1.SelectType.Polygon,PolygonDrawAction_1.default],[types_1.SelectType.Circle,CircleDrawAction_1.default],[types_1.SelectType.Rectangle,RectangleDrawAction_1.default],[types_1.SelectType.Triangle,TriangleDrawAction_1.default],[types_1.SelectType.Diamond,DiamondDrawAction_1.default],[types_1.SelectType.Start,StartDrawAction_1.default],[types_1.SelectType.Free,FreeDrawAction_1.default]]),n.el=t,n.listeners=i,e&&(n.canvasData=e),n.onResize=n.onResize.bind(n),n.initListeners(),n.initCanvas(),n.initEvents(),n}return __extends(t,a),t.prototype.initListeners=function(){var e=this,i=this.listeners;i&&Object.keys(i).forEach(function(t){e.on(t,i[t])})},t.prototype.initEvents=function(){var s=this;this.el&&this.el.addEventListener("mouseup",function(t){if(t){for(var e=s.getHistoryData(),i=adhere_util_1.default.clientToCtxPoint({event:t,rect:s.el.getBoundingClientRect()}),n=[],a=0;a<e.length;a++){var r=e[a],o=s.typeActionMap.get(r.type);"booleanPointInData"in o&&(null==o?void 0:o.booleanPointInData(i,r))&&n.push(a)}n.length?s.trigger(types_1.PolygonSelectionActions.CanvasClickGeometry,JSON.parse(JSON.stringify(e[n[n.length-1]]))):e.length&&s.trigger(types_1.PolygonSelectionActions.CanvasClickEmpty)}})},t.prototype.initCanvas=function(){this.el&&(this.canvasEl=document.createElement("canvas"),this.canvasEl.className=selectorPrefix,this.ctx=this.canvasEl.getContext("2d"),this.assistCanvasEl=document.createElement("canvas"),this.assistCanvasEl.className="".concat(selectorPrefix,"-assist"),this.assistCtx=this.assistCanvasEl.getContext("2d"),this.el.appendChild(this.canvasEl),this.el.appendChild(this.assistCanvasEl),this.trigger(types_1.PolygonSelectionActions.CanvasMount),this.adapterCanvas())},t.prototype.adapterCanvas=function(){var t=this,e=t.canvasEl,i=t.assistCanvasEl,t=t.el;t&&e&&i&&(e.width=t.offsetWidth||0,e.height=t.offsetHeight||0,i.width=t.offsetWidth||0,i.height=t.offsetHeight||0,this.clearDraw(),this.clearAssistDraw(),this.drawHistoryData())},t.prototype.onResize=function(){this.adapterCanvas()},t.prototype.getCtx=function(){return this.ctx},t.prototype.getCanvasEl=function(){return this.canvasEl},t.prototype.getAssistCanvasEl=function(){return this.assistCanvasEl},t.prototype.getAssistCtx=function(){return this.assistCtx},t.prototype.getWidth=function(){var t;return(null==(t=null==this?void 0:this.el)?void 0:t.offsetWidth)||0},t.prototype.getHeight=function(){var t;return(null==(t=null==this?void 0:this.el)?void 0:t.offsetHeight)||0},t.prototype.addHistoryData=function(t){this.canvasData.push(t)},t.prototype.removeHistoryDataById=function(e){var t=this.canvasData.findIndex(function(t){return t.id===e});return-1===t?[]:this.canvasData.splice(t,1)},t.prototype.drawHistoryData=function(){var n=this;this.canvasData.forEach(function(t){var e,i=n.ctx;i&&t&&(t.style&&(i.lineWidth=t.style.lineWidth,i.lineJoin=t.style.lineJoin,i.lineCap=t.style.lineCap,i.setLineDash(t.style.lineDash),i.lineDashOffset=t.style.lineDashOffset,i.strokeStyle=t.style.strokeStyle,i.fillStyle=t.style.fillStyle),null!=(e=n.typeActionMap.get(t.type))&&e.drawHistoryPath(i,t.data),i.stroke(),i.fill())})},t.prototype.getHistoryDataById=function(e){return this.canvasData.find(function(t){return t.id===e})},t.prototype.getHistoryData=function(){return __spreadArray([],this.canvasData,!0)},t.prototype.setHistoryData=function(t){this.canvasData=t},t.prototype.changeAction=function(t){t!==this.curAction&&t.getStatus()===types_1.ActionStatus.UnStart&&(this.curAction&&this.curAction.destroy(),null!=t&&t.setContext(this),this.curAction=t)},t.prototype.getCurAction=function(){return this.curAction},t.prototype.start=function(t){this.curAction&&this.curAction.start(t)},t.prototype.end=function(){this.curAction&&this.curAction.end()},t.prototype.clearDraw=function(){var t=this.ctx;t&&t.clearRect(0,0,this.getWidth(),this.getHeight())},t.prototype.clearAssistDraw=function(){var t=this.assistCtx;t&&t.clearRect(0,0,this.getWidth(),this.getHeight())},t.prototype.setFrontCanvas=function(t){t.style.zIndex="9999"},t.prototype.setBackCanvas=function(t){t.style.zIndex="1"},t.prototype.destroy=function(){"undefined"!=typeof window&&window.removeEventListener("resize",this.onResize),this.curAction&&this.curAction.destroy()},t}(adhere_util_emitter_1.default.Events);exports.default=PolygonSelection;
//# sourceMappingURL=PolygonSelection.js.map
