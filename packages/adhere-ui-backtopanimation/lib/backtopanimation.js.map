{"version":3,"file":"backtopanimation.js","sources":["backtopanimation.js"],"sourcesContent":["\"use strict\";\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __assign = (this && this.__assign) || function () {\r\n    __assign = Object.assign || function(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n                t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar react_1 = __importDefault(require(\"react\"));\r\nvar prop_types_1 = __importDefault(require(\"prop-types\"));\r\nvar classnames_1 = __importDefault(require(\"classnames\"));\r\n// @ts-ignore\r\nvar adhere_util_resource_1 = __importDefault(require(\"@baifendian/adhere-util-resource\"));\r\nvar selectorPrefix = 'adhere-ui-backtopanimation';\r\n/**\r\n * BackTopAnimation\r\n * @class BackTopAnimation\r\n * @classdesc BackTopAnimation\r\n */\r\nvar BackTopAnimation = /** @class */ (function (_super) {\r\n    __extends(BackTopAnimation, _super);\r\n    function BackTopAnimation() {\r\n        var _this = _super !== null && _super.apply(this, arguments) || this;\r\n        _this.key = false;\r\n        _this.onTrigger = function () {\r\n            var self = _this;\r\n            if (self.key)\r\n                return;\r\n            // @ts-ignore\r\n            var _a = _this.props, onTrigger = _a.onTrigger, onScrollTop = _a.onScrollTop, duration = _a.duration;\r\n            if (!onTrigger)\r\n                return;\r\n            onTrigger().then(function () {\r\n                self.key = true;\r\n                // @ts-ignore\r\n                self.maskEl.style.display = 'block';\r\n                // @ts-ignore\r\n                var srcTop = self.scrollEl.scrollTop;\r\n                var scrollVal = srcTop;\r\n                var targetTop = 0;\r\n                // 一次滚动的步进\r\n                var step = \r\n                // @ts-ignore\r\n                self.scrollEl.scrollHeight /\r\n                    // @ts-ignore\r\n                    (duration / (screen.updateInterval || 16.7) +\r\n                        // @ts-ignore\r\n                        (duration % (screen.updateInterval || 16.7) !== 0 ? 1 : 0));\r\n                /**\r\n                 * 动画的滚动\r\n                 */\r\n                function scrollAnimation() {\r\n                    if (srcTop < targetTop) {\r\n                        if (scrollVal + step > targetTop) {\r\n                            scrollVal = targetTop;\r\n                        }\r\n                        else {\r\n                            scrollVal += step;\r\n                        }\r\n                    }\r\n                    else if (scrollVal - step < targetTop) {\r\n                        scrollVal = targetTop;\r\n                    }\r\n                    else {\r\n                        scrollVal -= step;\r\n                    }\r\n                    // @ts-ignore\r\n                    self.scrollEl.scrollTop = scrollVal;\r\n                    if (onScrollTop) {\r\n                        // @ts-ignore\r\n                        onScrollTop(scrollVal);\r\n                    }\r\n                    if (srcTop < targetTop) {\r\n                        if (scrollVal >= targetTop) {\r\n                            clear();\r\n                        }\r\n                        else {\r\n                            window.requestAnimationFrame(scrollAnimation);\r\n                        }\r\n                    }\r\n                    else if (scrollVal <= targetTop) {\r\n                        clear();\r\n                    }\r\n                    else {\r\n                        window.requestAnimationFrame(scrollAnimation);\r\n                    }\r\n                    function clear() {\r\n                        // @ts-ignore\r\n                        self.maskEl.style.display = 'none';\r\n                        self.key = false;\r\n                    }\r\n                }\r\n                window.requestAnimationFrame(scrollAnimation);\r\n            });\r\n        };\r\n        return _this;\r\n    }\r\n    BackTopAnimation.prototype.componentDidMount = function () {\r\n        this.initScrollEvent();\r\n        this.renderMask();\r\n    };\r\n    BackTopAnimation.prototype.componentWillUnmount = function () {\r\n        if (this.maskEl) {\r\n            // @ts-ignore\r\n            this.maskEl.parentElement.removeChild(this.maskEl);\r\n        }\r\n    };\r\n    BackTopAnimation.prototype.initScrollEvent = function () {\r\n        this.scrollEl = this.props.target();\r\n        var self = this;\r\n        function onScroll() {\r\n            // @ts-ignore\r\n            if (self.scrollEl.scrollTop !== 0) {\r\n                window.requestAnimationFrame(function () {\r\n                    // @ts-ignore\r\n                    self.el.style.display = 'block';\r\n                });\r\n            }\r\n            else {\r\n                window.requestAnimationFrame(function () {\r\n                    // @ts-ignore\r\n                    self.el.style.display = 'none';\r\n                });\r\n            }\r\n        }\r\n        // @ts-ignore\r\n        this.scrollEl.addEventListener('scroll', onScroll, false);\r\n    };\r\n    BackTopAnimation.prototype.renderMask = function () {\r\n        // @ts-ignore\r\n        this.maskEl = document.body.querySelector(\".\" + selectorPrefix + \"-mask\");\r\n        if (!this.maskEl) {\r\n            this.maskEl = document.createElement('div');\r\n            this.maskEl.className = selectorPrefix + \"-mask\";\r\n            document.body.appendChild(this.maskEl);\r\n        }\r\n    };\r\n    BackTopAnimation.prototype.render = function () {\r\n        var _this = this;\r\n        // @ts-ignore\r\n        var _a = this.props, className = _a.className, style = _a.style;\r\n        // @ts-ignore\r\n        return (react_1.default.createElement(\"div\", { className: classnames_1.default(selectorPrefix, \r\n            // @ts-ignore\r\n            className.split(' ')), style: __assign({}, style), ref: function (el) { return (_this.el = el); }, onClick: this.onTrigger }));\r\n    };\r\n    return BackTopAnimation;\r\n}(react_1.default.Component));\r\nBackTopAnimation.defaultProps = {\r\n    className: '',\r\n    style: {},\r\n    zIndex: adhere_util_resource_1.default.Dict.value.ResourceNormalMaxZIndex.value,\r\n    duration: 300,\r\n    target: function () { return window; },\r\n};\r\nBackTopAnimation.propTypes = {\r\n    className: prop_types_1.default.string,\r\n    style: prop_types_1.default.object,\r\n    zIndex: prop_types_1.default.string,\r\n    duration: prop_types_1.default.number,\r\n    target: prop_types_1.default.func,\r\n    onTrigger: prop_types_1.default.func,\r\n    onScrollTop: prop_types_1.default.func,\r\n};\r\nexports.default = BackTopAnimation;\r\n"],"names":["__extends","this","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","__assign","assign","t","s","i","n","arguments","length","call","apply","__importDefault","mod","__esModule","default","defineProperty","exports","value","react_1","require","prop_types_1","classnames_1","adhere_util_resource_1","selectorPrefix","BackTopAnimation","_super","_this","key","onTrigger","_a","onScrollTop","duration","self","props","then","maskEl","style","display","srcTop","scrollEl","scrollTop","scrollVal","targetTop","step","scrollHeight","screen","updateInterval","window","requestAnimationFrame","scrollAnimation","clear","componentDidMount","initScrollEvent","renderMask","componentWillUnmount","parentElement","removeChild","target","addEventListener","el","document","body","querySelector","createElement","className","appendChild","render","split","ref","onClick","Component","defaultProps","zIndex","Dict","ResourceNormalMaxZIndex","propTypes","string","object","number","func"],"mappings":"aACA,IAAIA,UAAaC,MAAQA,KAAKD,WAAc,WACxC,IAAIE,EAAgB,SAAUC,EAAGC,GAI7B,OAHAF,EAAgBG,OAAOC,gBAClB,CAAEC,UAAW,cAAgBC,OAAS,SAAUL,EAAGC,GAAKD,EAAEI,UAAYH,IACvE,SAAUD,EAAGC,GAAK,IAAK,IAAIK,KAAKL,EAAOA,EAAEM,eAAeD,KAAIN,EAAEM,GAAKL,EAAEK,MACpDN,EAAGC,IAE5B,OAAO,SAAUD,EAAGC,GAEhB,SAASO,IAAOV,KAAKW,YAAcT,EADnCD,EAAcC,EAAGC,GAEjBD,EAAEU,UAAkB,OAANT,EAAaC,OAAOS,OAAOV,IAAMO,EAAGE,UAAYT,EAAES,UAAW,IAAIF,IAV3C,GAaxCI,SAAYd,MAAQA,KAAKc,UAAa,WAStC,OARAA,SAAWV,OAAOW,QAAU,SAASC,GACjC,IAAK,IAAIC,EAAGC,EAAI,EAAGC,EAAIC,UAAUC,OAAQH,EAAIC,EAAGD,IAE5C,IAAK,IAAIV,KADTS,EAAIG,UAAUF,GACOd,OAAOQ,UAAUH,eAAea,KAAKL,EAAGT,KACzDQ,EAAER,GAAKS,EAAET,IAEjB,OAAOQ,IAEKO,MAAMvB,KAAMoB,YAE5BI,gBAAmBxB,MAAQA,KAAKwB,iBAAoB,SAAUC,GAC9D,OAAQA,GAAOA,EAAIC,WAAcD,EAAM,CAAEE,QAAWF,IAExDrB,OAAOwB,eAAeC,QAAS,aAAc,CAAEC,OAAO,IACtD,IAAIC,QAAUP,gBAAgBQ,QAAQ,UAClCC,aAAeT,gBAAgBQ,QAAQ,eACvCE,aAAeV,gBAAgBQ,QAAQ,eAEvCG,uBAAyBX,gBAAgBQ,QAAQ,qCACjDI,eAAiB,6BAMjBC,iBAAkC,SAAUC,GAE5C,SAASD,IACL,IAAIE,EAAmB,OAAXD,GAAmBA,EAAOf,MAAMvB,KAAMoB,YAAcpB,KAyEhE,OAxEAuC,EAAMC,KAAM,EACZD,EAAME,UAAY,WACd,IAIIC,EAAkBD,EAA0BE,EAA8BC,EAJ1EC,EAAON,EACPM,EAAKL,MAGaC,GAAlBC,EAAKH,EAAMO,OAAsBL,UAAWE,EAAcD,EAAGC,YAAaC,EAAWF,EAAGE,SACvFH,GAELA,IAAYM,KAAK,WACbF,EAAKL,KAAM,EAEXK,EAAKG,OAAOC,MAAMC,QAAU,QAE5B,IAAIC,EAASN,EAAKO,SAASC,UACvBC,EAAYH,EACZI,EAAY,EAEZC,EAEJX,EAAKO,SAASK,cAETb,GAAYc,OAAOC,gBAAkB,OAEjCf,GAAYc,OAAOC,gBAAkB,OAAU,EAAI,EAAI,IA6ChEC,OAAOC,sBAzCP,SAASC,IAmCL,SAASC,IAELlB,EAAKG,OAAOC,MAAMC,QAAU,OAC5BL,EAAKL,KAAM,EArCXW,EAASI,EACcA,EAAnBD,EAAYE,EACZF,EAAYC,EAGZD,GAAaE,EAGZF,EAAYE,EAAOD,EACxBD,EAAYC,EAGZD,GAAaE,EAGjBX,EAAKO,SAASC,UAAYC,EACtBX,GAEAA,EAAYW,GAEZH,EAASI,EACQA,GAAbD,EACAS,IAGAH,OAAOC,sBAAsBC,GAG5BR,GAAaC,EAClBQ,IAGAH,OAAOC,sBAAsBC,SAWtCvB,EAmDX,OA9HAxC,UAAUsC,EAAkBC,GA6E5BD,EAAiBzB,UAAUoD,kBAAoB,WAC3ChE,KAAKiE,kBACLjE,KAAKkE,cAET7B,EAAiBzB,UAAUuD,qBAAuB,WAC1CnE,KAAKgD,QAELhD,KAAKgD,OAAOoB,cAAcC,YAAYrE,KAAKgD,SAGnDX,EAAiBzB,UAAUqD,gBAAkB,WACzCjE,KAAKoD,SAAWpD,KAAK8C,MAAMwB,SAC3B,IAAIzB,EAAO7C,KAiBXA,KAAKoD,SAASmB,iBAAiB,SAhB/B,WAEoC,IAA5B1B,EAAKO,SAASC,UACdO,OAAOC,sBAAsB,WAEzBhB,EAAK2B,GAAGvB,MAAMC,QAAU,UAI5BU,OAAOC,sBAAsB,WAEzBhB,EAAK2B,GAAGvB,MAAMC,QAAU,WAKe,IAEvDb,EAAiBzB,UAAUsD,WAAa,WAEpClE,KAAKgD,OAASyB,SAASC,KAAKC,cAAc,IAAMvC,eAAiB,SAC5DpC,KAAKgD,SACNhD,KAAKgD,OAASyB,SAASG,cAAc,OACrC5E,KAAKgD,OAAO6B,UAAYzC,eAAiB,QACzCqC,SAASC,KAAKI,YAAY9E,KAAKgD,UAGvCX,EAAiBzB,UAAUmE,OAAS,WAChC,IAAIxC,EAAQvC,KAER0C,EAAK1C,KAAK8C,MAAO+B,EAAYnC,EAAGmC,UAAW5B,EAAQP,EAAGO,MAE1D,OAAQlB,QAAQJ,QAAQiD,cAAc,MAAO,CAAEC,UAAW3C,aAAaP,QAAQS,eAE3EyC,EAAUG,MAAM,MAAO/B,MAAOnC,SAAS,GAAImC,GAAQgC,IAAK,SAAUT,GAAM,OAAQjC,EAAMiC,GAAKA,GAAQU,QAASlF,KAAKyC,aAElHJ,EA/H0B,CAgInCN,QAAQJ,QAAQwD,WAClB9C,iBAAiB+C,aAAe,CAC5BP,UAAW,GACX5B,MAAO,GACPoC,OAAQlD,uBAAuBR,QAAQ2D,KAAKxD,MAAMyD,wBAAwBzD,MAC1Ec,SAAU,IACV0B,OAAQ,WAAc,OAAOV,SAEjCvB,iBAAiBmD,UAAY,CACzBX,UAAW5C,aAAaN,QAAQ8D,OAChCxC,MAAOhB,aAAaN,QAAQ+D,OAC5BL,OAAQpD,aAAaN,QAAQ8D,OAC7B7C,SAAUX,aAAaN,QAAQgE,OAC/BrB,OAAQrC,aAAaN,QAAQiE,KAC7BnD,UAAWR,aAAaN,QAAQiE,KAChCjD,YAAaV,aAAaN,QAAQiE,MAEtC/D,QAAQF,QAAUU"}