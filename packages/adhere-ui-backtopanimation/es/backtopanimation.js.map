{"version":3,"file":"backtopanimation.js","sources":["backtopanimation.js"],"sourcesContent":["var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __assign = (this && this.__assign) || function () {\r\n    __assign = Object.assign || function(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n                t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\nimport React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport classNames from 'classnames';\r\nimport Resource from '@baifendian/adhere-util-resource';\r\nvar selectorPrefix = 'adhere-ui-backtopanimation';\r\n/**\r\n * BackTopAnimation\r\n * @class BackTopAnimation\r\n * @classdesc BackTopAnimation\r\n */\r\nvar BackTopAnimation = /** @class */ (function (_super) {\r\n    __extends(BackTopAnimation, _super);\r\n    function BackTopAnimation() {\r\n        var _this = _super !== null && _super.apply(this, arguments) || this;\r\n        _this.key = false;\r\n        _this.onTrigger = function () {\r\n            var self = _this;\r\n            if (self.key)\r\n                return;\r\n            var _a = _this.props, onTrigger = _a.onTrigger, onScrollTop = _a.onScrollTop, duration = _a.duration;\r\n            if (!onTrigger)\r\n                return;\r\n            onTrigger().then(function () {\r\n                self.key = true;\r\n                self.maskEl.style.display = 'block';\r\n                // @ts-ignore\r\n                var srcTop = self.scrollEl.scrollTop;\r\n                var scrollVal = srcTop;\r\n                var targetTop = 0;\r\n                // 一次滚动的步进\r\n                var step = \r\n                // @ts-ignore\r\n                self.scrollEl.scrollHeight /\r\n                    // @ts-ignore\r\n                    (duration / (screen.updateInterval || 16.7) +\r\n                        // @ts-ignore\r\n                        (duration % (screen.updateInterval || 16.7) !== 0 ? 1 : 0));\r\n                /**\r\n                 * 动画的滚动\r\n                 */\r\n                function scrollAnimation() {\r\n                    if (srcTop < targetTop) {\r\n                        if (scrollVal + step > targetTop) {\r\n                            scrollVal = targetTop;\r\n                        }\r\n                        else {\r\n                            scrollVal += step;\r\n                        }\r\n                    }\r\n                    else if (scrollVal - step < targetTop) {\r\n                        scrollVal = targetTop;\r\n                    }\r\n                    else {\r\n                        scrollVal -= step;\r\n                    }\r\n                    // @ts-ignore\r\n                    self.scrollEl.scrollTop = scrollVal;\r\n                    if (onScrollTop) {\r\n                        onScrollTop(scrollVal);\r\n                    }\r\n                    if (srcTop < targetTop) {\r\n                        if (scrollVal >= targetTop) {\r\n                            clear();\r\n                        }\r\n                        else {\r\n                            typeof window !== 'undefined' && window.requestAnimationFrame(scrollAnimation);\r\n                        }\r\n                    }\r\n                    else if (scrollVal <= targetTop) {\r\n                        clear();\r\n                    }\r\n                    else {\r\n                        typeof window !== 'undefined' && window.requestAnimationFrame(scrollAnimation);\r\n                    }\r\n                    function clear() {\r\n                        self.maskEl.style.display = 'none';\r\n                        self.key = false;\r\n                    }\r\n                }\r\n                typeof window !== 'undefined' && window.requestAnimationFrame(scrollAnimation);\r\n            });\r\n        };\r\n        return _this;\r\n    }\r\n    BackTopAnimation.prototype.componentDidMount = function () {\r\n        this.initScrollEvent();\r\n        this.renderMask();\r\n    };\r\n    BackTopAnimation.prototype.componentWillUnmount = function () {\r\n        if (this.maskEl) {\r\n            try {\r\n                this.maskEl.parentElement.removeChild(this.maskEl);\r\n            }\r\n            catch (e) { }\r\n        }\r\n    };\r\n    BackTopAnimation.prototype.initScrollEvent = function () {\r\n        this.scrollEl = this.props.target();\r\n        var self = this;\r\n        function onScroll() {\r\n            // @ts-ignore\r\n            if (self.scrollEl.scrollTop !== 0) {\r\n                typeof window !== 'undefined' &&\r\n                    window.requestAnimationFrame(function () {\r\n                        self.el.style.display = 'block';\r\n                    });\r\n            }\r\n            else {\r\n                typeof window !== 'undefined' &&\r\n                    window.requestAnimationFrame(function () {\r\n                        self.el.style.display = 'none';\r\n                    });\r\n            }\r\n        }\r\n        this.scrollEl.addEventListener('scroll', onScroll, false);\r\n    };\r\n    BackTopAnimation.prototype.renderMask = function () {\r\n        this.maskEl = document.body.querySelector(\".\" + selectorPrefix + \"-mask\");\r\n        if (!this.maskEl) {\r\n            this.maskEl = document.createElement('div');\r\n            this.maskEl.className = selectorPrefix + \"-mask\";\r\n            this.maskEl.style.zIndex = \"\" + this.props.zIndex;\r\n            document.body.appendChild(this.maskEl);\r\n        }\r\n    };\r\n    BackTopAnimation.prototype.render = function () {\r\n        var _this = this;\r\n        var _a = this.props, className = _a.className, style = _a.style, zIndex = _a.zIndex;\r\n        return (React.createElement(\"div\", { className: classNames(selectorPrefix, className === null || className === void 0 ? void 0 : className.split(/\\s+/)), style: __assign(__assign({}, style), { zIndex: zIndex }), ref: function (el) { return (_this.el = el); }, onClick: this.onTrigger }));\r\n    };\r\n    return BackTopAnimation;\r\n}(React.Component));\r\nBackTopAnimation.defaultProps = {\r\n    className: '',\r\n    style: {},\r\n    zIndex: Resource.Dict.value.ResourceNormalMaxZIndex.value,\r\n    duration: 300,\r\n    target: function () { return window; },\r\n};\r\nBackTopAnimation.propTypes = {\r\n    className: PropTypes.string,\r\n    style: PropTypes.object,\r\n    zIndex: PropTypes.string,\r\n    duration: PropTypes.number,\r\n    target: PropTypes.func,\r\n    onTrigger: PropTypes.func,\r\n    onScrollTop: PropTypes.func,\r\n};\r\nexport default BackTopAnimation;\r\n"],"names":["__extends","this","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","__assign","assign","t","s","i","n","arguments","length","call","apply","React","PropTypes","classNames","Resource","selectorPrefix","BackTopAnimation","_super","_this","key","onTrigger","_a","onScrollTop","duration","self","props","then","maskEl","style","display","srcTop","scrollEl","scrollTop","scrollVal","targetTop","step","scrollHeight","screen","updateInterval","window","requestAnimationFrame","scrollAnimation","clear","componentDidMount","initScrollEvent","renderMask","componentWillUnmount","parentElement","removeChild","e","target","addEventListener","el","document","body","querySelector","createElement","className","zIndex","appendChild","render","split","ref","onClick","Component","defaultProps","Dict","value","ResourceNormalMaxZIndex","propTypes","string","object","number","func"],"mappings":"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"}