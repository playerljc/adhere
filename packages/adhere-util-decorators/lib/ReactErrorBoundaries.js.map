{"version":3,"file":"ReactErrorBoundaries.js","sources":["ReactErrorBoundaries.js"],"sourcesContent":["\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar tslib_1 = require(\"tslib\");\r\nvar antd_1 = require(\"antd\");\r\nvar react_1 = tslib_1.__importDefault(require(\"react\"));\r\nvar adhere_util_1 = tslib_1.__importDefault(require(\"@baifendian/adhere-util\"));\r\nvar adhere_util_intl_1 = tslib_1.__importDefault(require(\"@baifendian/adhere-util-intl\"));\r\n// import errorIcon from './component_error.svg';\r\nvar errorIcon = 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNTkyNzM0NTgwMDkxIiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjMzODMiIHdpZHRoPSI2NCIgaGVpZ2h0PSI2NCIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+PC9zdHlsZT48L2RlZnM+PHBhdGggZD0iTTM1OC4zMjUzODYgNTYzLjA3MzczMW0tNzYuNzgyNzgxIDBhNzYuNzgyNzgxIDc2Ljc4Mjc4MSAwIDEgMCAxNTMuNTY1NTYzIDAgNzYuNzgyNzgxIDc2Ljc4Mjc4MSAwIDEgMC0xNTMuNTY1NTYzIDBaIiBmaWxsPSIjMTM5MjdEIiBwLWlkPSIzMzg0Ij48L3BhdGg+PHBhdGggZD0iTTY2NS40NTY1MTIgNTYzLjA3MzczMW0tNzYuNzgyNzgxIDBhNzYuNzgyNzgxIDc2Ljc4Mjc4MSAwIDEgMCAxNTMuNTY1NTYzIDAgNzYuNzgyNzgxIDc2Ljc4Mjc4MSAwIDEgMC0xNTMuNTY1NTYzIDBaIiBmaWxsPSIjMTM5MjdEIiBwLWlkPSIzMzg1Ij48L3BhdGg+PHBhdGggZD0iTTUxMS44OTA5NDkgMGMyNjguNTYwNTc1IDAgNDg2LjI5MDk0OSAyMTcuNzMwMzc0IDQ4Ni4yOTA5NSA0ODYuMjkwOTQ5IDAgMTE5LjYyNzU3NC00My40NTkwNTQgMjMyLjQ3MjY2OC0xMjAuMjY3NDMxIDMyMC4xODQxOTlsLTcuNzAzODcyIDguNTc0MDc3Vjk3Mi41ODE4OTlhNTEuMTg4NTIxIDUxLjE4ODUyMSAwIDAgMS00Ny4zNzQ5NzYgNTEuMDYwNTQ5bC0zLjgzOTEzOSAwLjEyNzk3MWE1MS4xODg1MjEgNTEuMTg4NTIxIDAgMCAxLTUxLjAzNDk1Ni00Ny4zNzQ5NzZsLTAuMTI3OTcxLTMuODM5MTM5di0xNzguMDg0ODY0YTUxLjE4ODUyMSA1MS4xODg1MjEgMCAwIDEgMTUuMDc1MDItMzYuMjY3MDY3QTM4Mi40ODA2MjkgMzgyLjQ4MDYyOSAwIDAgMCA4OTUuODA0ODU3IDQ4Ni4yOTA5NDljMC0yMTIuMDIyODU0LTE3MS44OTEwNTMtMzgzLjkxMzkwNy0zODMuOTEzOTA4LTM4My45MTM5MDctMjEyLjAyMjg1NCAwLTM4My45MTM5MDcgMTcxLjg5MTA1My0zODMuOTEzOTA3IDM4My45MTM5MDcgMCAxMDMuNDc3NTk1IDQxLjA3ODc4OCAyMDAuMzI2Mjc3IDExMi45MjE4NzcgMjcxLjkzOTAxOGE1MS4xODg1MjEgNTEuMTg4NTIxIDAgMCAxIDE0Ljg0NDY3MSAzMS43MzY4ODNsMC4yMDQ3NTQgNC41MzAxODRWOTcyLjU4MTg5OWE1MS4xODg1MjEgNTEuMTg4NTIxIDAgMCAxLTEwMi4yNDkwNyAzLjgzOTEzOUwxNTMuNTcxMzAyIDk3Mi41ODE4OTl2LTE1Ny41MzI2NzRBNDg0LjY1MjkxNyA0ODQuNjUyOTE3IDAgMCAxIDI1LjcyNzk3MSA0OTcuNTAxMjM1TDI1LjYgNDg2LjI5MDk0OUMyNS42IDIxNy43MzAzNzQgMjQzLjMzMDM3NCAwIDUxMS44OTA5NDkgMHoiIGZpbGw9IiMxMzkyN0QiIHAtaWQ9IjMzODYiPjwvcGF0aD48cGF0aCBkPSJNNTExLjg5MDk0OSA3OTMuNDIyMDc1YTUxLjE4ODUyMSA1MS4xODg1MjEgMCAwIDEgNTEuMDYwNTUgNDcuMzQ5MzgyTDU2My4wNzk0NyA4NDQuNjEwNTk2djEyNy45NzEzMDNhNTEuMTg4NTIxIDUxLjE4ODUyMSAwIDAgMS0xMDIuMjQ5MDcgMy44MzkxMzlMNDYwLjcwMjQyOCA5NzIuNTgxODk5di0xMjcuOTcxMzAzYTUxLjE4ODUyMSA1MS4xODg1MjEgMCAwIDEgNTEuMTg4NTIxLTUxLjE4ODUyMXoiIGZpbGw9IiMxMzkyN0QiIHAtaWQ9IjMzODciPjwvcGF0aD48L3N2Zz4=';\r\n// 缺省的错误UI\r\nvar DEFAULT_ERROR_UI = (react_1.default.createElement(antd_1.Empty, { image: errorIcon, imageStyle: {\r\n        height: 60,\r\n    }, description: adhere_util_intl_1.default.v('糟糕！，出了些问题') }));\r\n/**\r\n * React的边界错误捕获\r\n * @param Component\r\n */\r\nvar ReactErrorBoundariesHOC = function (Component) {\r\n    var ReactErrorBoundaries = /** @class */ (function (_super) {\r\n        tslib_1.__extends(ReactErrorBoundaries, _super);\r\n        function ReactErrorBoundaries() {\r\n            var _this = _super !== null && _super.apply(this, arguments) || this;\r\n            _this.state = {\r\n                hasError: false,\r\n            };\r\n            _this.refIns = null;\r\n            return _this;\r\n        }\r\n        ReactErrorBoundaries.getDerivedStateFromError = function (error) {\r\n            console.error(error);\r\n            // 更新 state 使下一次渲染能够显示降级后的 UI\r\n            return {\r\n                hasError: true,\r\n            };\r\n        };\r\n        ReactErrorBoundaries.prototype.componentDidCatch = function (error, errorInfo) {\r\n            // 你同样可以将错误日志上报给服务器\r\n            console.error(error, errorInfo);\r\n            if (String(error).includes('Loading chunk')) {\r\n                var hash = +new Date();\r\n                window.location.href = \"\".concat(window.location.href).concat(window.location.search ? '&' : '?', \"=_ijt=\").concat(hash);\r\n            }\r\n        };\r\n        ReactErrorBoundaries.prototype.renderErrorUI = function () {\r\n            var refIns = this.refIns;\r\n            // 如果Component的实例提供了getReactErrorBoundariesErrorUI方法则可以自定义错误UI显示\r\n            if (refIns &&\r\n                // @ts-ignore\r\n                refIns.current &&\r\n                // @ts-ignore\r\n                refIns.current.getReactErrorBoundariesErrorUI &&\r\n                // @ts-ignore\r\n                adhere_util_1.default.isFunction(refIns.current.getReactErrorBoundariesErrorUI)) {\r\n                // @ts-ignore\r\n                return refIns.current.getReactErrorBoundariesErrorUI();\r\n            }\r\n            if ('getReactErrorBoundariesErrorUI' in Component &&\r\n                adhere_util_1.default.isFunction(Component.getReactErrorBoundariesErrorUI)) {\r\n                // 如果Component提供了getReactErrorBoundariesErrorUI方法则可以自定义错误UI显示\r\n                return Component.getReactErrorBoundariesErrorUI();\r\n            }\r\n            // 如果没有自定义错误UI则显示全局错误UI\r\n            return DEFAULT_ERROR_UI;\r\n        };\r\n        ReactErrorBoundaries.prototype.render = function () {\r\n            if (this.state.hasError) {\r\n                return this.renderErrorUI();\r\n            }\r\n            var _a = this.props, forwardedRef = _a.forwardedRef, props = tslib_1.__rest(_a, [\"forwardedRef\"]);\r\n            var allProps = tslib_1.__assign({}, props);\r\n            // 如果 Component 是 FunctionComponent 就不赋值ref了\r\n            if (adhere_util_1.default.isArray(Component)) {\r\n                if (Component.prototype.isReactComponent) {\r\n                    this.refIns = forwardedRef || react_1.default.createRef();\r\n                    allProps.ref = this.refIns;\r\n                }\r\n            }\r\n            else if (adhere_util_1.default.isObject(Component)) {\r\n                if (Component.constructor.prototype.isReactComponent) {\r\n                    this.refIns = forwardedRef || react_1.default.createRef();\r\n                    allProps.ref = this.refIns;\r\n                }\r\n            }\r\n            return react_1.default.createElement(Component, tslib_1.__assign({}, allProps));\r\n        };\r\n        return ReactErrorBoundaries;\r\n    }(react_1.default.Component));\r\n    return react_1.default.forwardRef(function (props, ref) {\r\n        return react_1.default.createElement(ReactErrorBoundaries, tslib_1.__assign({}, props, { forwardedRef: ref }));\r\n    });\r\n};\r\n/**\r\n * setDefaultErrorUI - 设置缺省的错误UI\r\n * @param defaultErrorUI\r\n */\r\nReactErrorBoundariesHOC.setDefaultErrorUI = function (defaultErrorUI) {\r\n    DEFAULT_ERROR_UI = defaultErrorUI;\r\n};\r\nexports.default = ReactErrorBoundariesHOC;\r\n//# sourceMappingURL=ReactErrorBoundaries.js.map"],"names":["Object","defineProperty","exports","value","tslib_1","require","antd_1","react_1","__importDefault","adhere_util_1","adhere_util_intl_1","errorIcon","DEFAULT_ERROR_UI","default","createElement","Empty","image","imageStyle","height","description","v","ReactErrorBoundariesHOC","Component","_super","__extends","ReactErrorBoundaries","getDerivedStateFromError","error","console","hasError","prototype","componentDidCatch","errorInfo","String","includes","hash","Date","window","location","href","concat","search","renderErrorUI","refIns","this","current","getReactErrorBoundariesErrorUI","isFunction","render","forwardedRef","allProps","state","_a","props","__rest","__assign","isArray","isReactComponent","createRef","ref","isObject","constructor","_this","apply","arguments","forwardRef","setDefaultErrorUI","defaultErrorUI"],"mappings":"AAAA,aACAA,OAAOC,eAAeC,QAAS,aAAc,CAAEC,MAAO,CAAA,CAAK,CAAC,EAC5D,IAAIC,QAAUC,QAAQ,OAAO,EACzBC,OAASD,QAAQ,MAAM,EACvBE,QAAUH,QAAQI,gBAAgBH,QAAQ,OAAO,CAAC,EAClDI,cAAgBL,QAAQI,gBAAgBH,QAAQ,yBAAyB,CAAC,EAC1EK,mBAAqBN,QAAQI,gBAAgBH,QAAQ,8BAA8B,CAAC,EAEpFM,UAAY,q6EAEZC,iBAAoBL,QAAQM,QAAQC,cAAcR,OAAOS,MAAO,CAAEC,MAAOL,UAAWM,WAAY,CAC5FC,OAAQ,EACZ,EAAGC,YAAaT,mBAAmBG,QAAQO,EAAE,WAAW,CAAE,CAAE,EAK5DC,wBAA0B,SAAUC,GACgBC,EAoElDhB,QAAQM,QAAQS,UAnEdlB,QAAQoB,UAAUC,EAAsBF,CAAM,EAS9CE,EAAqBC,yBAA2B,SAAUC,GAGtD,OAFAC,QAAQD,MAAMA,CAAK,EAEZ,CACHE,SAAU,CAAA,CACd,CACJ,EACAJ,EAAqBK,UAAUC,kBAAoB,SAAUJ,EAAOK,GAEhEJ,QAAQD,MAAMA,EAAOK,CAAS,EAC1BC,OAAON,CAAK,EAAEO,SAAS,eAAe,IAClCC,EAAO,CAAC,IAAIC,KAChBC,OAAOC,SAASC,KAAO,GAAGC,OAAOH,OAAOC,SAASC,IAAI,EAAEC,OAAOH,OAAOC,SAASG,OAAS,IAAM,IAAK,QAAQ,EAAED,OAAOL,CAAI,EAE/H,EACAV,EAAqBK,UAAUY,cAAgB,WAC3C,IAAIC,EAASC,KAAKD,OAElB,OAAIA,GAEAA,EAAOE,SAEPF,EAAOE,QAAQC,gCAEfrC,cAAcI,QAAQkC,WAAWJ,EAAOE,QAAQC,8BAA8B,EAEvEH,EAAOE,QAAQC,+BAA+B,EAErD,mCAAoCxB,GACpCb,cAAcI,QAAQkC,WAAWzB,EAAUwB,8BAA8B,EAElExB,EAAUwB,+BAA+B,EAG7ClC,gBACX,EACAa,EAAqBK,UAAUkB,OAAS,WACpC,IAGqBC,EACjBC,EAJJ,OAAIN,KAAKO,MAAMtB,SACJe,KAAKF,cAAc,GAETO,GAAjBG,EAAKR,KAAKS,OAAyBJ,aAAcI,EAAQjD,QAAQkD,OAAOF,EAAI,CAAC,eAAe,EAC5FF,EAAW9C,QAAQmD,SAAS,GAAIF,CAAK,EAErC5C,cAAcI,QAAQ2C,QAAQlC,CAAS,EACnCA,EAAUQ,UAAU2B,mBACpBb,KAAKD,OAASM,GAAgB1C,QAAQM,QAAQ6C,UAAU,EACxDR,EAASS,IAAMf,KAAKD,QAGnBlC,cAAcI,QAAQ+C,SAAStC,CAAS,GACzCA,EAAUuC,YAAY/B,UAAU2B,mBAChCb,KAAKD,OAASM,GAAgB1C,QAAQM,QAAQ6C,UAAU,EACxDR,EAASS,IAAMf,KAAKD,QAGrBpC,QAAQM,QAAQC,cAAcQ,EAAWlB,QAAQmD,SAAS,GAAIL,CAAQ,CAAC,EAClF,EAlEJ,IAAoD3B,EAAhDE,EAmEOA,EAjEP,SAASA,IACL,IAAIqC,EAAmB,OAAXvC,GAAmBA,EAAOwC,MAAMnB,KAAMoB,SAAS,GAAKpB,KAKhE,OAJAkB,EAAMX,MAAQ,CACVtB,SAAU,CAAA,CACd,EACAiC,EAAMnB,OAAS,KACRmB,CACX,CA4DJ,OAAOvD,QAAQM,QAAQoD,WAAW,SAAUZ,EAAOM,GAC/C,OAAOpD,QAAQM,QAAQC,cAAcW,EAAsBrB,QAAQmD,SAAS,GAAIF,EAAO,CAAEJ,aAAcU,CAAI,CAAC,CAAC,CACjH,CAAC,CACL,EAKAtC,wBAAwB6C,kBAAoB,SAAUC,GAClDvD,iBAAmBuD,CACvB,EACAjE,QAAQW,QAAUQ"}