{"version":3,"file":"ReactErrorBoundaries.js","sources":["ReactErrorBoundaries.js"],"sourcesContent":["\"use strict\";\n\nrequire(\"core-js/modules/es.object.define-property.js\");\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nrequire(\"core-js/modules/es.array.includes.js\");\n\nrequire(\"core-js/modules/es.string.includes.js\");\n\nrequire(\"core-js/modules/es.array.concat.js\");\n\nrequire(\"core-js/modules/es.regexp.exec.js\");\n\nrequire(\"core-js/modules/es.string.search.js\");\n\nvar _empty = _interopRequireDefault(require(\"antd/lib/empty\"));\n\nvar _tslib = require(\"tslib\");\n\nvar _react = _interopRequireDefault(require(\"react\"));\n\nvar _adhereUtilIntl = _interopRequireDefault(require(\"@baifendian/adhere-util-intl\"));\n\nvar _adhereUtil = _interopRequireDefault(require(\"@baifendian/adhere-util\"));\n\n// import errorIcon from './component_error.svg';\nvar errorIcon = 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNTkyNzM0NTgwMDkxIiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjMzODMiIHdpZHRoPSI2NCIgaGVpZ2h0PSI2NCIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+PC9zdHlsZT48L2RlZnM+PHBhdGggZD0iTTM1OC4zMjUzODYgNTYzLjA3MzczMW0tNzYuNzgyNzgxIDBhNzYuNzgyNzgxIDc2Ljc4Mjc4MSAwIDEgMCAxNTMuNTY1NTYzIDAgNzYuNzgyNzgxIDc2Ljc4Mjc4MSAwIDEgMC0xNTMuNTY1NTYzIDBaIiBmaWxsPSIjMTM5MjdEIiBwLWlkPSIzMzg0Ij48L3BhdGg+PHBhdGggZD0iTTY2NS40NTY1MTIgNTYzLjA3MzczMW0tNzYuNzgyNzgxIDBhNzYuNzgyNzgxIDc2Ljc4Mjc4MSAwIDEgMCAxNTMuNTY1NTYzIDAgNzYuNzgyNzgxIDc2Ljc4Mjc4MSAwIDEgMC0xNTMuNTY1NTYzIDBaIiBmaWxsPSIjMTM5MjdEIiBwLWlkPSIzMzg1Ij48L3BhdGg+PHBhdGggZD0iTTUxMS44OTA5NDkgMGMyNjguNTYwNTc1IDAgNDg2LjI5MDk0OSAyMTcuNzMwMzc0IDQ4Ni4yOTA5NSA0ODYuMjkwOTQ5IDAgMTE5LjYyNzU3NC00My40NTkwNTQgMjMyLjQ3MjY2OC0xMjAuMjY3NDMxIDMyMC4xODQxOTlsLTcuNzAzODcyIDguNTc0MDc3Vjk3Mi41ODE4OTlhNTEuMTg4NTIxIDUxLjE4ODUyMSAwIDAgMS00Ny4zNzQ5NzYgNTEuMDYwNTQ5bC0zLjgzOTEzOSAwLjEyNzk3MWE1MS4xODg1MjEgNTEuMTg4NTIxIDAgMCAxLTUxLjAzNDk1Ni00Ny4zNzQ5NzZsLTAuMTI3OTcxLTMuODM5MTM5di0xNzguMDg0ODY0YTUxLjE4ODUyMSA1MS4xODg1MjEgMCAwIDEgMTUuMDc1MDItMzYuMjY3MDY3QTM4Mi40ODA2MjkgMzgyLjQ4MDYyOSAwIDAgMCA4OTUuODA0ODU3IDQ4Ni4yOTA5NDljMC0yMTIuMDIyODU0LTE3MS44OTEwNTMtMzgzLjkxMzkwNy0zODMuOTEzOTA4LTM4My45MTM5MDctMjEyLjAyMjg1NCAwLTM4My45MTM5MDcgMTcxLjg5MTA1My0zODMuOTEzOTA3IDM4My45MTM5MDcgMCAxMDMuNDc3NTk1IDQxLjA3ODc4OCAyMDAuMzI2Mjc3IDExMi45MjE4NzcgMjcxLjkzOTAxOGE1MS4xODg1MjEgNTEuMTg4NTIxIDAgMCAxIDE0Ljg0NDY3MSAzMS43MzY4ODNsMC4yMDQ3NTQgNC41MzAxODRWOTcyLjU4MTg5OWE1MS4xODg1MjEgNTEuMTg4NTIxIDAgMCAxLTEwMi4yNDkwNyAzLjgzOTEzOUwxNTMuNTcxMzAyIDk3Mi41ODE4OTl2LTE1Ny41MzI2NzRBNDg0LjY1MjkxNyA0ODQuNjUyOTE3IDAgMCAxIDI1LjcyNzk3MSA0OTcuNTAxMjM1TDI1LjYgNDg2LjI5MDk0OUMyNS42IDIxNy43MzAzNzQgMjQzLjMzMDM3NCAwIDUxMS44OTA5NDkgMHoiIGZpbGw9IiMxMzkyN0QiIHAtaWQ9IjMzODYiPjwvcGF0aD48cGF0aCBkPSJNNTExLjg5MDk0OSA3OTMuNDIyMDc1YTUxLjE4ODUyMSA1MS4xODg1MjEgMCAwIDEgNTEuMDYwNTUgNDcuMzQ5MzgyTDU2My4wNzk0NyA4NDQuNjEwNTk2djEyNy45NzEzMDNhNTEuMTg4NTIxIDUxLjE4ODUyMSAwIDAgMS0xMDIuMjQ5MDcgMy44MzkxMzlMNDYwLjcwMjQyOCA5NzIuNTgxODk5di0xMjcuOTcxMzAzYTUxLjE4ODUyMSA1MS4xODg1MjEgMCAwIDEgNTEuMTg4NTIxLTUxLjE4ODUyMXoiIGZpbGw9IiMxMzkyN0QiIHAtaWQ9IjMzODciPjwvcGF0aD48L3N2Zz4='; // 缺省的错误UI\n\nvar DEFAULT_ERROR_UI = /*#__PURE__*/_react.default.createElement(_empty.default, {\n  image: errorIcon,\n  imageStyle: {\n    height: 60\n  },\n  description: _adhereUtilIntl.default.v('糟糕！，出了些问题')\n});\n/**\n * React的边界错误捕获\n * @param Component\n */\n\n\nvar ReactErrorBoundariesHOC = function ReactErrorBoundariesHOC(Component) {\n  var ReactErrorBoundaries =\n  /** @class */\n  function (_super) {\n    (0, _tslib.__extends)(ReactErrorBoundaries, _super);\n\n    function ReactErrorBoundaries() {\n      var _this = _super !== null && _super.apply(this, arguments) || this;\n\n      _this.state = {\n        hasError: false\n      };\n      _this.refIns = null;\n      return _this;\n    }\n\n    ReactErrorBoundaries.getDerivedStateFromError = function (error) {\n      console.error(error); // 更新 state 使下一次渲染能够显示降级后的 UI\n\n      return {\n        hasError: true\n      };\n    };\n\n    ReactErrorBoundaries.prototype.componentDidCatch = function (error, errorInfo) {\n      // 你同样可以将错误日志上报给服务器\n      console.error(error, errorInfo);\n\n      if (String(error).includes('Loading chunk')) {\n        var hash = +new Date();\n        window.location.href = \"\".concat(window.location.href).concat(window.location.search ? '&' : '?', \"=_ijt=\").concat(hash);\n      }\n    };\n\n    ReactErrorBoundaries.prototype.renderErrorUI = function () {\n      var refIns = this.refIns; // 如果Component的实例提供了getReactErrorBoundariesErrorUI方法则可以自定义错误UI显示\n\n      if (refIns && // @ts-ignore\n      refIns.current && // @ts-ignore\n      refIns.current.getReactErrorBoundariesErrorUI && // @ts-ignore\n      _adhereUtil.default.isFunction(refIns.current.getReactErrorBoundariesErrorUI)) {\n        // @ts-ignore\n        return refIns.current.getReactErrorBoundariesErrorUI();\n      }\n\n      if ('getReactErrorBoundariesErrorUI' in Component && _adhereUtil.default.isFunction(Component.getReactErrorBoundariesErrorUI)) {\n        // 如果Component提供了getReactErrorBoundariesErrorUI方法则可以自定义错误UI显示\n        return Component.getReactErrorBoundariesErrorUI();\n      } // 如果没有自定义错误UI则显示全局错误UI\n\n\n      return DEFAULT_ERROR_UI;\n    };\n\n    ReactErrorBoundaries.prototype.render = function () {\n      if (this.state.hasError) {\n        return this.renderErrorUI();\n      }\n\n      var _a = this.props,\n          forwardedRef = _a.forwardedRef,\n          props = (0, _tslib.__rest)(_a, [\"forwardedRef\"]);\n      var allProps = (0, _tslib.__assign)({}, props); // 如果 Component 是 FunctionComponent 就不赋值ref了\n\n      if (_adhereUtil.default.isArray(Component)) {\n        if (Component.prototype.isReactComponent) {\n          this.refIns = forwardedRef || /*#__PURE__*/_react.default.createRef();\n          allProps.ref = this.refIns;\n        }\n      } else if (_adhereUtil.default.isObject(Component)) {\n        if (Component.constructor.prototype.isReactComponent) {\n          this.refIns = forwardedRef || /*#__PURE__*/_react.default.createRef();\n          allProps.ref = this.refIns;\n        }\n      }\n\n      return /*#__PURE__*/_react.default.createElement(Component, (0, _tslib.__assign)({}, allProps));\n    };\n\n    return ReactErrorBoundaries;\n  }(_react.default.Component);\n\n  return /*#__PURE__*/_react.default.forwardRef(function (props, ref) {\n    return /*#__PURE__*/_react.default.createElement(ReactErrorBoundaries, (0, _tslib.__assign)({}, props, {\n      forwardedRef: ref\n    }));\n  });\n};\n/**\n * setDefaultErrorUI - 设置缺省的错误UI\n * @param defaultErrorUI\n */\n\n\nReactErrorBoundariesHOC.setDefaultErrorUI = function (defaultErrorUI) {\n  DEFAULT_ERROR_UI = defaultErrorUI;\n};\n\nvar _default = ReactErrorBoundariesHOC;\nexports.default = _default;"],"names":["require","_interopRequireDefault","Object","defineProperty","exports","value","default","_empty","_tslib","_react","_adhereUtilIntl","_adhereUtil","errorIcon","DEFAULT_ERROR_UI","createElement","image","imageStyle","height","description","v","ReactErrorBoundariesHOC","Component","_super","ReactErrorBoundaries","__extends","getDerivedStateFromError","error","console","hasError","prototype","componentDidCatch","errorInfo","String","includes","hash","Date","window","location","href","concat","search","renderErrorUI","refIns","this","current","getReactErrorBoundariesErrorUI","isFunction","render","state","_a","props","forwardedRef","__rest","allProps","__assign","isArray","isReactComponent","createRef","ref","isObject","constructor","_this","apply","arguments","forwardRef","setDefaultErrorUI","defaultErrorUI","_default"],"mappings":"aAEAA,QAAQ,gDAER,IAAIC,uBAAyBD,QAAQ,gDAErCE,OAAOC,eAAeC,QAAS,aAAc,CAC3CC,OAAO,IAETD,QAAQE,aAAU,EAElBN,QAAQ,wCAERA,QAAQ,yCAERA,QAAQ,sCAERA,QAAQ,qCAERA,QAAQ,uCAER,IAAIO,OAASN,uBAAuBD,QAAQ,mBAExCQ,OAASR,QAAQ,SAEjBS,OAASR,uBAAuBD,QAAQ,UAExCU,gBAAkBT,uBAAuBD,QAAQ,iCAEjDW,YAAcV,uBAAuBD,QAAQ,4BAG7CY,UAAY,q6EAEZC,iBAAgCJ,OAAOH,QAAQQ,cAAcP,OAAOD,QAAS,CAC/ES,MAAOH,UACPI,WAAY,CACVC,OAAQ,IAEVC,YAAaR,gBAAgBJ,QAAQa,EAAE,eAQrCC,wBAA0B,SAAiCC,GAC7D,IAEUC,EAFNC,GAEMD,EA6ERb,OAAOH,QAAQe,WA5Ef,EAAIb,OAAOgB,WAAWD,EAAsBD,GAY5CC,EAAqBE,yBAA2B,SAAUC,GAGxD,OAFAC,QAAQD,MAAMA,GAEP,CACLE,UAAU,IAIdL,EAAqBM,UAAUC,kBAAoB,SAAUJ,EAAOK,GAElEJ,QAAQD,MAAMA,EAAOK,GAEjBC,OAAON,GAAOO,SAAS,mBACrBC,GAAQ,IAAIC,KAChBC,OAAOC,SAASC,KAAO,GAAGC,OAAOH,OAAOC,SAASC,MAAMC,OAAOH,OAAOC,SAASG,OAAS,IAAM,IAAK,UAAUD,OAAOL,KAIvHX,EAAqBM,UAAUY,cAAgB,WAC7C,IAAIC,EAASC,KAAKD,OAElB,OAAIA,GACJA,EAAOE,SACPF,EAAOE,QAAQC,gCACflC,YAAYL,QAAQwC,WAAWJ,EAAOE,QAAQC,gCAErCH,EAAOE,QAAQC,iCAGpB,mCAAoCxB,GAAaV,YAAYL,QAAQwC,WAAWzB,EAAUwB,gCAErFxB,EAAUwB,iCAIZhC,kBAGTU,EAAqBM,UAAUkB,OAAS,WACtC,GAAIJ,KAAKK,MAAMpB,SACb,OAAOe,KAAKF,gBAGd,IAAIQ,EAAKN,KAAKO,MACVC,EAAeF,EAAGE,aAClBD,GAAQ,EAAI1C,OAAO4C,QAAQH,EAAI,CAAC,iBAChCI,GAAW,EAAI7C,OAAO8C,UAAU,GAAIJ,GAcxC,OAZIvC,YAAYL,QAAQiD,QAAQlC,GAC1BA,EAAUQ,UAAU2B,mBACtBb,KAAKD,OAASS,GAA6B1C,OAAOH,QAAQmD,YAC1DJ,EAASK,IAAMf,KAAKD,QAEb/B,YAAYL,QAAQqD,SAAStC,IAClCA,EAAUuC,YAAY/B,UAAU2B,mBAClCb,KAAKD,OAASS,GAA6B1C,OAAOH,QAAQmD,YAC1DJ,EAASK,IAAMf,KAAKD,QAIJjC,OAAOH,QAAQQ,cAAcO,GAAW,EAAIb,OAAO8C,UAAU,GAAID,KAGhF9B,GAzEP,SAASA,IACP,IAAIsC,EAAmB,OAAXvC,GAAmBA,EAAOwC,MAAMnB,KAAMoB,YAAcpB,KAMhE,OAJAkB,EAAMb,MAAQ,CACZpB,UAAU,GAEZiC,EAAMnB,OAAS,KACRmB,EAqEX,OAAoBpD,OAAOH,QAAQ0D,WAAW,SAAUd,EAAOQ,GAC7D,OAAoBjD,OAAOH,QAAQQ,cAAcS,GAAsB,EAAIf,OAAO8C,UAAU,GAAIJ,EAAO,CACrGC,aAAcO,QAUpBtC,wBAAwB6C,kBAAoB,SAAUC,GACpDrD,iBAAmBqD,GAGrB,IAAIC,SAAW/C,wBACfhB,QAAQE,QAAU6D"}