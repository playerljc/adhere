{"version":3,"file":"ReactErrorBoundaries.js","sources":["ReactErrorBoundaries.js"],"sourcesContent":["var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        if (typeof b !== \"function\" && b !== null)\r\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __assign = (this && this.__assign) || function () {\r\n    __assign = Object.assign || function(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n                t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\nvar __rest = (this && this.__rest) || function (s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n};\r\nimport { Empty } from 'antd';\r\nimport React from 'react';\r\nimport Util from '@baifendian/adhere-util';\r\nimport intl from '@baifendian/adhere-util-intl';\r\n// import errorIcon from './component_error.svg';\r\nvar errorIcon = 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNTkyNzM0NTgwMDkxIiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjMzODMiIHdpZHRoPSI2NCIgaGVpZ2h0PSI2NCIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+PC9zdHlsZT48L2RlZnM+PHBhdGggZD0iTTM1OC4zMjUzODYgNTYzLjA3MzczMW0tNzYuNzgyNzgxIDBhNzYuNzgyNzgxIDc2Ljc4Mjc4MSAwIDEgMCAxNTMuNTY1NTYzIDAgNzYuNzgyNzgxIDc2Ljc4Mjc4MSAwIDEgMC0xNTMuNTY1NTYzIDBaIiBmaWxsPSIjMTM5MjdEIiBwLWlkPSIzMzg0Ij48L3BhdGg+PHBhdGggZD0iTTY2NS40NTY1MTIgNTYzLjA3MzczMW0tNzYuNzgyNzgxIDBhNzYuNzgyNzgxIDc2Ljc4Mjc4MSAwIDEgMCAxNTMuNTY1NTYzIDAgNzYuNzgyNzgxIDc2Ljc4Mjc4MSAwIDEgMC0xNTMuNTY1NTYzIDBaIiBmaWxsPSIjMTM5MjdEIiBwLWlkPSIzMzg1Ij48L3BhdGg+PHBhdGggZD0iTTUxMS44OTA5NDkgMGMyNjguNTYwNTc1IDAgNDg2LjI5MDk0OSAyMTcuNzMwMzc0IDQ4Ni4yOTA5NSA0ODYuMjkwOTQ5IDAgMTE5LjYyNzU3NC00My40NTkwNTQgMjMyLjQ3MjY2OC0xMjAuMjY3NDMxIDMyMC4xODQxOTlsLTcuNzAzODcyIDguNTc0MDc3Vjk3Mi41ODE4OTlhNTEuMTg4NTIxIDUxLjE4ODUyMSAwIDAgMS00Ny4zNzQ5NzYgNTEuMDYwNTQ5bC0zLjgzOTEzOSAwLjEyNzk3MWE1MS4xODg1MjEgNTEuMTg4NTIxIDAgMCAxLTUxLjAzNDk1Ni00Ny4zNzQ5NzZsLTAuMTI3OTcxLTMuODM5MTM5di0xNzguMDg0ODY0YTUxLjE4ODUyMSA1MS4xODg1MjEgMCAwIDEgMTUuMDc1MDItMzYuMjY3MDY3QTM4Mi40ODA2MjkgMzgyLjQ4MDYyOSAwIDAgMCA4OTUuODA0ODU3IDQ4Ni4yOTA5NDljMC0yMTIuMDIyODU0LTE3MS44OTEwNTMtMzgzLjkxMzkwNy0zODMuOTEzOTA4LTM4My45MTM5MDctMjEyLjAyMjg1NCAwLTM4My45MTM5MDcgMTcxLjg5MTA1My0zODMuOTEzOTA3IDM4My45MTM5MDcgMCAxMDMuNDc3NTk1IDQxLjA3ODc4OCAyMDAuMzI2Mjc3IDExMi45MjE4NzcgMjcxLjkzOTAxOGE1MS4xODg1MjEgNTEuMTg4NTIxIDAgMCAxIDE0Ljg0NDY3MSAzMS43MzY4ODNsMC4yMDQ3NTQgNC41MzAxODRWOTcyLjU4MTg5OWE1MS4xODg1MjEgNTEuMTg4NTIxIDAgMCAxLTEwMi4yNDkwNyAzLjgzOTEzOUwxNTMuNTcxMzAyIDk3Mi41ODE4OTl2LTE1Ny41MzI2NzRBNDg0LjY1MjkxNyA0ODQuNjUyOTE3IDAgMCAxIDI1LjcyNzk3MSA0OTcuNTAxMjM1TDI1LjYgNDg2LjI5MDk0OUMyNS42IDIxNy43MzAzNzQgMjQzLjMzMDM3NCAwIDUxMS44OTA5NDkgMHoiIGZpbGw9IiMxMzkyN0QiIHAtaWQ9IjMzODYiPjwvcGF0aD48cGF0aCBkPSJNNTExLjg5MDk0OSA3OTMuNDIyMDc1YTUxLjE4ODUyMSA1MS4xODg1MjEgMCAwIDEgNTEuMDYwNTUgNDcuMzQ5MzgyTDU2My4wNzk0NyA4NDQuNjEwNTk2djEyNy45NzEzMDNhNTEuMTg4NTIxIDUxLjE4ODUyMSAwIDAgMS0xMDIuMjQ5MDcgMy44MzkxMzlMNDYwLjcwMjQyOCA5NzIuNTgxODk5di0xMjcuOTcxMzAzYTUxLjE4ODUyMSA1MS4xODg1MjEgMCAwIDEgNTEuMTg4NTIxLTUxLjE4ODUyMXoiIGZpbGw9IiMxMzkyN0QiIHAtaWQ9IjMzODciPjwvcGF0aD48L3N2Zz4=';\r\n// 缺省的错误UI\r\nvar DEFAULT_ERROR_UI = (React.createElement(Empty, { image: errorIcon, imageStyle: {\r\n        height: 60,\r\n    }, description: intl.v('糟糕！，出了些问题') }));\r\n/**\r\n * React的边界错误捕获\r\n * @param Component\r\n */\r\nvar ReactErrorBoundariesHOC = function (Component) {\r\n    var ReactErrorBoundaries = /** @class */ (function (_super) {\r\n        __extends(ReactErrorBoundaries, _super);\r\n        function ReactErrorBoundaries() {\r\n            var _this = _super !== null && _super.apply(this, arguments) || this;\r\n            _this.state = {\r\n                hasError: false,\r\n            };\r\n            _this.refIns = null;\r\n            return _this;\r\n        }\r\n        ReactErrorBoundaries.getDerivedStateFromError = function (error) {\r\n            console.error(error);\r\n            // 更新 state 使下一次渲染能够显示降级后的 UI\r\n            return {\r\n                hasError: true,\r\n            };\r\n        };\r\n        ReactErrorBoundaries.prototype.componentDidCatch = function (error, errorInfo) {\r\n            // 你同样可以将错误日志上报给服务器\r\n            console.error(error, errorInfo);\r\n            if (String(error).includes('Loading chunk')) {\r\n                var hash = +new Date();\r\n                window.location.href = \"\".concat(window.location.href).concat(window.location.search ? '&' : '?', \"=_ijt=\").concat(hash);\r\n            }\r\n        };\r\n        ReactErrorBoundaries.prototype.renderErrorUI = function () {\r\n            var refIns = this.refIns;\r\n            // 如果Component的实例提供了getReactErrorBoundariesErrorUI方法则可以自定义错误UI显示\r\n            if (refIns &&\r\n                // @ts-ignore\r\n                refIns.current &&\r\n                // @ts-ignore\r\n                refIns.current.getReactErrorBoundariesErrorUI &&\r\n                // @ts-ignore\r\n                Util.isFunction(refIns.current.getReactErrorBoundariesErrorUI)) {\r\n                // @ts-ignore\r\n                return refIns.current.getReactErrorBoundariesErrorUI();\r\n            }\r\n            if ('getReactErrorBoundariesErrorUI' in Component &&\r\n                Util.isFunction(Component.getReactErrorBoundariesErrorUI)) {\r\n                // 如果Component提供了getReactErrorBoundariesErrorUI方法则可以自定义错误UI显示\r\n                return Component.getReactErrorBoundariesErrorUI();\r\n            }\r\n            // 如果没有自定义错误UI则显示全局错误UI\r\n            return DEFAULT_ERROR_UI;\r\n        };\r\n        ReactErrorBoundaries.prototype.render = function () {\r\n            if (this.state.hasError) {\r\n                return this.renderErrorUI();\r\n            }\r\n            var _a = this.props, forwardedRef = _a.forwardedRef, props = __rest(_a, [\"forwardedRef\"]);\r\n            var allProps = __assign({}, props);\r\n            // 如果 Component 是 FunctionComponent 就不赋值ref了\r\n            if (Util.isArray(Component)) {\r\n                if (Component.prototype.isReactComponent) {\r\n                    this.refIns = forwardedRef || React.createRef();\r\n                    allProps.ref = this.refIns;\r\n                }\r\n            }\r\n            else if (Util.isObject(Component)) {\r\n                if (Component.constructor.prototype.isReactComponent) {\r\n                    this.refIns = forwardedRef || React.createRef();\r\n                    allProps.ref = this.refIns;\r\n                }\r\n            }\r\n            return React.createElement(Component, __assign({}, allProps));\r\n        };\r\n        return ReactErrorBoundaries;\r\n    }(React.Component));\r\n    return React.forwardRef(function (props, ref) {\r\n        return React.createElement(ReactErrorBoundaries, __assign({}, props, { forwardedRef: ref }));\r\n    });\r\n};\r\n/**\r\n * setDefaultErrorUI - 设置缺省的错误UI\r\n * @param defaultErrorUI\r\n */\r\nReactErrorBoundariesHOC.setDefaultErrorUI = function (defaultErrorUI) {\r\n    DEFAULT_ERROR_UI = defaultErrorUI;\r\n};\r\nexport default ReactErrorBoundariesHOC;\r\n"],"names":["__extends","this","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","TypeError","String","__","constructor","create","__assign","assign","t","s","i","n","arguments","length","apply","__rest","e","indexOf","getOwnPropertySymbols","propertyIsEnumerable","Empty","React","Util","intl","errorIcon","DEFAULT_ERROR_UI","createElement","image","imageStyle","height","description","v","ReactErrorBoundariesHOC","Component","_super","ReactErrorBoundaries","getDerivedStateFromError","error","console","hasError","componentDidCatch","errorInfo","includes","hash","Date","window","location","href","concat","search","renderErrorUI","refIns","current","getReactErrorBoundariesErrorUI","isFunction","render","forwardedRef","allProps","state","_a","props","isArray","isReactComponent","createRef","ref","isObject","_this","forwardRef","setDefaultErrorUI","defaultErrorUI"],"mappings":"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"}