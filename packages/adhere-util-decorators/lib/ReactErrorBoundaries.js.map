{"version":3,"file":"ReactErrorBoundaries.js","sources":["ReactErrorBoundaries.js"],"sourcesContent":["\"use strict\";\n\nvar __extends = void 0 && (void 0).__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n    return extendStatics(d, b);\n  };\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    extendStatics(d, b);\n    function __() {\n      this.constructor = d;\n    }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\nvar __assign = void 0 && (void 0).__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n    return t;\n  };\n  return __assign.apply(this, arguments);\n};\nvar __rest = void 0 && (void 0).__rest || function (s, e) {\n  var t = {};\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\nvar __importDefault = void 0 && (void 0).__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar antd_1 = require(\"antd\");\nvar react_1 = __importDefault(require(\"react\"));\nvar adhere_util_1 = __importDefault(require(\"@baifendian/adhere-util\"));\nvar adhere_util_intl_1 = __importDefault(require(\"@baifendian/adhere-util-intl\"));\n// import errorIcon from './component_error.svg';\nvar errorIcon = 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNTkyNzM0NTgwMDkxIiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjMzODMiIHdpZHRoPSI2NCIgaGVpZ2h0PSI2NCIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+PC9zdHlsZT48L2RlZnM+PHBhdGggZD0iTTM1OC4zMjUzODYgNTYzLjA3MzczMW0tNzYuNzgyNzgxIDBhNzYuNzgyNzgxIDc2Ljc4Mjc4MSAwIDEgMCAxNTMuNTY1NTYzIDAgNzYuNzgyNzgxIDc2Ljc4Mjc4MSAwIDEgMC0xNTMuNTY1NTYzIDBaIiBmaWxsPSIjMTM5MjdEIiBwLWlkPSIzMzg0Ij48L3BhdGg+PHBhdGggZD0iTTY2NS40NTY1MTIgNTYzLjA3MzczMW0tNzYuNzgyNzgxIDBhNzYuNzgyNzgxIDc2Ljc4Mjc4MSAwIDEgMCAxNTMuNTY1NTYzIDAgNzYuNzgyNzgxIDc2Ljc4Mjc4MSAwIDEgMC0xNTMuNTY1NTYzIDBaIiBmaWxsPSIjMTM5MjdEIiBwLWlkPSIzMzg1Ij48L3BhdGg+PHBhdGggZD0iTTUxMS44OTA5NDkgMGMyNjguNTYwNTc1IDAgNDg2LjI5MDk0OSAyMTcuNzMwMzc0IDQ4Ni4yOTA5NSA0ODYuMjkwOTQ5IDAgMTE5LjYyNzU3NC00My40NTkwNTQgMjMyLjQ3MjY2OC0xMjAuMjY3NDMxIDMyMC4xODQxOTlsLTcuNzAzODcyIDguNTc0MDc3Vjk3Mi41ODE4OTlhNTEuMTg4NTIxIDUxLjE4ODUyMSAwIDAgMS00Ny4zNzQ5NzYgNTEuMDYwNTQ5bC0zLjgzOTEzOSAwLjEyNzk3MWE1MS4xODg1MjEgNTEuMTg4NTIxIDAgMCAxLTUxLjAzNDk1Ni00Ny4zNzQ5NzZsLTAuMTI3OTcxLTMuODM5MTM5di0xNzguMDg0ODY0YTUxLjE4ODUyMSA1MS4xODg1MjEgMCAwIDEgMTUuMDc1MDItMzYuMjY3MDY3QTM4Mi40ODA2MjkgMzgyLjQ4MDYyOSAwIDAgMCA4OTUuODA0ODU3IDQ4Ni4yOTA5NDljMC0yMTIuMDIyODU0LTE3MS44OTEwNTMtMzgzLjkxMzkwNy0zODMuOTEzOTA4LTM4My45MTM5MDctMjEyLjAyMjg1NCAwLTM4My45MTM5MDcgMTcxLjg5MTA1My0zODMuOTEzOTA3IDM4My45MTM5MDcgMCAxMDMuNDc3NTk1IDQxLjA3ODc4OCAyMDAuMzI2Mjc3IDExMi45MjE4NzcgMjcxLjkzOTAxOGE1MS4xODg1MjEgNTEuMTg4NTIxIDAgMCAxIDE0Ljg0NDY3MSAzMS43MzY4ODNsMC4yMDQ3NTQgNC41MzAxODRWOTcyLjU4MTg5OWE1MS4xODg1MjEgNTEuMTg4NTIxIDAgMCAxLTEwMi4yNDkwNyAzLjgzOTEzOUwxNTMuNTcxMzAyIDk3Mi41ODE4OTl2LTE1Ny41MzI2NzRBNDg0LjY1MjkxNyA0ODQuNjUyOTE3IDAgMCAxIDI1LjcyNzk3MSA0OTcuNTAxMjM1TDI1LjYgNDg2LjI5MDk0OUMyNS42IDIxNy43MzAzNzQgMjQzLjMzMDM3NCAwIDUxMS44OTA5NDkgMHoiIGZpbGw9IiMxMzkyN0QiIHAtaWQ9IjMzODYiPjwvcGF0aD48cGF0aCBkPSJNNTExLjg5MDk0OSA3OTMuNDIyMDc1YTUxLjE4ODUyMSA1MS4xODg1MjEgMCAwIDEgNTEuMDYwNTUgNDcuMzQ5MzgyTDU2My4wNzk0NyA4NDQuNjEwNTk2djEyNy45NzEzMDNhNTEuMTg4NTIxIDUxLjE4ODUyMSAwIDAgMS0xMDIuMjQ5MDcgMy44MzkxMzlMNDYwLjcwMjQyOCA5NzIuNTgxODk5di0xMjcuOTcxMzAzYTUxLjE4ODUyMSA1MS4xODg1MjEgMCAwIDEgNTEuMTg4NTIxLTUxLjE4ODUyMXoiIGZpbGw9IiMxMzkyN0QiIHAtaWQ9IjMzODciPjwvcGF0aD48L3N2Zz4=';\n// 缺省的错误UI\nvar DEFAULT_ERROR_UI = react_1.default.createElement(antd_1.Empty, {\n  image: errorIcon,\n  imageStyle: {\n    height: 60\n  },\n  description: adhere_util_intl_1.default.v('糟糕！，出了些问题')\n});\n/**\n * React的边界错误捕获\n * @param Component\n */\nvar ReactErrorBoundariesHOC = function (Component) {\n  var ReactErrorBoundaries = /** @class */function (_super) {\n    __extends(ReactErrorBoundaries, _super);\n    function ReactErrorBoundaries() {\n      var _this = _super !== null && _super.apply(this, arguments) || this;\n      _this.state = {\n        hasError: false\n      };\n      _this.refIns = null;\n      return _this;\n    }\n    ReactErrorBoundaries.getDerivedStateFromError = function (error) {\n      console.error(error);\n      // 更新 state 使下一次渲染能够显示降级后的 UI\n      return {\n        hasError: true\n      };\n    };\n    ReactErrorBoundaries.prototype.componentDidCatch = function (error, errorInfo) {\n      // 你同样可以将错误日志上报给服务器\n      console.error(error, errorInfo);\n      if (String(error).includes('Loading chunk')) {\n        var hash = +new Date();\n        window.location.href = \"\".concat(window.location.href).concat(window.location.search ? '&' : '?', \"=_ijt=\").concat(hash);\n      }\n    };\n    ReactErrorBoundaries.prototype.renderErrorUI = function () {\n      var refIns = this.refIns;\n      // 如果Component的实例提供了getReactErrorBoundariesErrorUI方法则可以自定义错误UI显示\n      if (refIns &&\n      // @ts-ignore\n      refIns.current &&\n      // @ts-ignore\n      refIns.current.getReactErrorBoundariesErrorUI &&\n      // @ts-ignore\n      adhere_util_1.default.isFunction(refIns.current.getReactErrorBoundariesErrorUI)) {\n        // @ts-ignore\n        return refIns.current.getReactErrorBoundariesErrorUI();\n      }\n      if ('getReactErrorBoundariesErrorUI' in Component && adhere_util_1.default.isFunction(Component.getReactErrorBoundariesErrorUI)) {\n        // 如果Component提供了getReactErrorBoundariesErrorUI方法则可以自定义错误UI显示\n        return Component.getReactErrorBoundariesErrorUI();\n      }\n      // 如果没有自定义错误UI则显示全局错误UI\n      return DEFAULT_ERROR_UI;\n    };\n    ReactErrorBoundaries.prototype.render = function () {\n      if (this.state.hasError) {\n        return this.renderErrorUI();\n      }\n      var _a = this.props,\n        forwardedRef = _a.forwardedRef,\n        props = __rest(_a, [\"forwardedRef\"]);\n      var allProps = __assign({}, props);\n      // 如果 Component 是 FunctionComponent 就不赋值ref了\n      if (adhere_util_1.default.isArray(Component)) {\n        if (Component.prototype.isReactComponent) {\n          this.refIns = forwardedRef || react_1.default.createRef();\n          allProps.ref = this.refIns;\n        }\n      } else if (adhere_util_1.default.isObject(Component)) {\n        if (Component.constructor.prototype.isReactComponent) {\n          this.refIns = forwardedRef || react_1.default.createRef();\n          allProps.ref = this.refIns;\n        }\n      }\n      return react_1.default.createElement(Component, __assign({}, allProps));\n    };\n    return ReactErrorBoundaries;\n  }(react_1.default.Component);\n  return react_1.default.forwardRef(function (props, ref) {\n    return react_1.default.createElement(ReactErrorBoundaries, __assign({}, props, {\n      forwardedRef: ref\n    }));\n  });\n};\n/**\n * setDefaultErrorUI - 设置缺省的错误UI\n * @param defaultErrorUI\n */\nReactErrorBoundariesHOC.setDefaultErrorUI = function (defaultErrorUI) {\n  DEFAULT_ERROR_UI = defaultErrorUI;\n};\nexports.default = ReactErrorBoundariesHOC;"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","TypeError","String","__","this","constructor","create","__assign","assign","t","s","i","n","arguments","length","apply","__rest","e","indexOf","getOwnPropertySymbols","propertyIsEnumerable","__importDefault","mod","__esModule","default","antd_1","defineProperty","exports","value","require","react_1","adhere_util_1","adhere_util_intl_1","errorIcon","DEFAULT_ERROR_UI","createElement","Empty","image","imageStyle","height","description","v","ReactErrorBoundariesHOC","Component","_super","ReactErrorBoundaries","getDerivedStateFromError","error","console","hasError","componentDidCatch","errorInfo","includes","hash","Date","window","location","href","concat","search","renderErrorUI","refIns","current","getReactErrorBoundariesErrorUI","isFunction","render","forwardedRef","allProps","state","_a","props","isArray","isReactComponent","createRef","ref","isObject","_this","forwardRef","setDefaultErrorUI","defaultErrorUI"],"mappings":"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"}