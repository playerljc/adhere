var __spreadArray=this&&this.__spreadArray||function(n,r,e){if(e||2===arguments.length)for(var t,a=0,u=r.length;a<u;a++)!t&&a in r||((t=t||Array.prototype.slice.call(r,0,a))[a]=r[a]);return n.concat(t||Array.prototype.slice.call(r))};import{useMount,useUpdateEffect}from"ahooks";import{useRef,useState}from"react";var useAsyncCascader=function(n){function u(n,a){return function n(r){for(var e,t=0;t<r.length;t++){if(Object.is(r[t].value,a)){e=r[t];break}if(e=n(r[t].children||[]))break}return e}(n)}function r(){o(null!=c?c:"",a).then(function(n){h(n)})}function e(){l&&Promise.all([t(c),null==l?void 0:l(f,a)]).then(function(n){var r=n[0],r=void 0===r?[]:r,n=n[1],e=void 0===n?[]:n;h(__spreadArray(__spreadArray([],null!=e?e:[],!0),(null!=r?r:[]).filter(function(n){return!(null!=e?e:[]).map(function(n){return n.value}).includes(n.value)}),!0))})}function t(n){return o(n,a).then(function(n){return n})}var a=n.cascadeParams,i=n.onDataSourceChange,l=n.fetchBranch,o=n.fetchData,c=n.defaultId,f=n.value,d=n.treeDataSimpleMode,n=useState([]),s=n[0],h=n[1],p=useRef();return useMount(function(){(f&&(!Array.isArray(f)||f.length)?e:r)()}),useUpdateEffect(function(){p.current||e()},[f]),useUpdateEffect(function(){(f?e:r)()},[JSON.stringify(a)]),useUpdateEffect(function(){null!=i&&i(s)},[s]),{treeData:s,onLoadData:function(e){return new Promise(function(n){var a,r=e[e.length-1];r.isLoading||(r.isLoading=!0,a=r.value,setTimeout(function(){t(a).then(function(t){h(function(n){var r,e;return d?__spreadArray(__spreadArray([],null!=t?t:[],!0),null!=(r=null==(r=null==n?void 0:n.filter)?void 0:r.call(n,function(n){return n.pId!==a}))?r:[],!0):((e=u(n,a)).children&&Array.isArray(e.children)&&e.children.length?e.children=__spreadArray(__spreadArray([],e.children,!0),null!=(r=null==(r=null==t?void 0:t.filter)?void 0:r.call(t,function(r){return e.children.find(function(n){return n.value!==r.value})}))?r:[],!0):e.children=t,__spreadArray([],null!=n?n:[],!0))})}),n(void 0)},300))})},onChange:function(n,r){p.current=r,n.apply(void 0,r)}}};export default useAsyncCascader;
//# sourceMappingURL=useAsyncCascader.js.map
