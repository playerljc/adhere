"use strict";var __spreadArray=function(e,r,n){if(n||2===arguments.length)for(var t,a=0,u=r.length;a<u;a++)!t&&a in r||((t=t||Array.prototype.slice.call(r,0,a))[a]=r[a]);return e.concat(t||Array.prototype.slice.call(r))},ahooks_1=(Object.defineProperty(exports,"__esModule",{value:!0}),require("ahooks")),react_1=require("react"),useAsyncTreeSelect=function(e){function u(e,a){return function e(r){for(var n,t=0;t<r.length;t++){if(Object.is(r[t].value,a)){n=r[t];break}if(n=e(r[t].children||[]))break}return n}(e)}function r(){i(null!=c?c:"",a).then(function(e){h(e)})}function n(){o&&Promise.all([t(c),null==o?void 0:o(f,a)]).then(function(e){var r=e[0],r=void 0===r?[]:r,e=e[1],n=void 0===e?[]:e;h(__spreadArray(__spreadArray([],null!=n?n:[],!0),(null!=r?r:[]).filter(function(e){return!(null!=n?n:[]).map(function(e){return e.value}).includes(e.value)}),!0))})}function t(e){return i(e,a).then(function(e){return e})}var a=e.cascadeParams,l=e.onDataSourceChange,o=e.fetchBranch,i=e.fetchData,c=e.defaultId,f=e.value,s=e.treeDataSimpleMode,e=(0,react_1.useState)([]),d=e[0],h=e[1],_=(0,react_1.useRef)();return(0,ahooks_1.useMount)(function(){(f&&(!Array.isArray(f)||f.length)?n:r)()}),(0,ahooks_1.useUpdateEffect)(function(){_.current||n()},[f]),(0,ahooks_1.useUpdateEffect)(function(){(f?n:r)()},[JSON.stringify(a)]),(0,ahooks_1.useUpdateEffect)(function(){null!=l&&l(d)},[d]),{treeData:d,onLoadData:function(e){var a=e.value;return new Promise(function(e){setTimeout(function(){t(a).then(function(t){h(function(e){var r,n;return s?__spreadArray(__spreadArray([],null!=t?t:[],!0),null!=(r=null==(r=null==e?void 0:e.filter)?void 0:r.call(e,function(e){return e.pId!==a}))?r:[],!0):((n=u(e,a)).children&&Array.isArray(n.children)&&n.children.length?n.children=__spreadArray(__spreadArray([],n.children,!0),null!=(r=null==(r=null==t?void 0:t.filter)?void 0:r.call(t,function(r){return n.children.find(function(e){return e.value!==r.value})}))?r:[],!0):n.children=t,__spreadArray([],null!=e?e:[],!0))})}),e(void 0)},300)})},onChange:function(e,r){_.current=r,e.apply(void 0,r)}}};exports.default=useAsyncTreeSelect;
//# sourceMappingURL=useAsyncTreeSelect.js.map
