"use strict";var __spreadArray=function(n,e,r){if(r||2===arguments.length)for(var t,a=0,u=e.length;a<u;a++)!t&&a in e||((t=t||Array.prototype.slice.call(e,0,a))[a]=e[a]);return n.concat(t||Array.prototype.slice.call(e))},ahooks_1=(Object.defineProperty(exports,"__esModule",{value:!0}),require("ahooks")),react_1=require("react"),useAsyncCascader=function(n){function u(n,a){return function n(e){for(var r,t=0;t<e.length;t++){if(Object.is(e[t].value,a)){r=e[t];break}if(r=n(e[t].children||[]))break}return r}(n)}function e(){o(null!=c?c:"",a).then(function(n){h(n)})}function r(){i&&Promise.all([t(c),null==i?void 0:i(f,a)]).then(function(n){var e=n[0],e=void 0===e?[]:e,n=n[1],r=void 0===n?[]:n;h(__spreadArray(__spreadArray([],null!=r?r:[],!0),(null!=e?e:[]).filter(function(n){return!(null!=r?r:[]).map(function(n){return n.value}).includes(n.value)}),!0))})}function t(n){return o(n,a).then(function(n){return n})}var a=n.cascadeParams,l=n.onDataSourceChange,i=n.fetchBranch,o=n.fetchData,c=n.defaultId,f=n.value,s=n.treeDataSimpleMode,n=(0,react_1.useState)([]),d=n[0],h=n[1],_=(0,react_1.useRef)();return(0,ahooks_1.useMount)(function(){(f&&(!Array.isArray(f)||f.length)?r:e)()}),(0,ahooks_1.useUpdateEffect)(function(){_.current||r()},[f]),(0,ahooks_1.useUpdateEffect)(function(){(f?r:e)()},[JSON.stringify(a)]),(0,ahooks_1.useUpdateEffect)(function(){null!=l&&l(d)},[d]),{treeData:d,onLoadData:function(r){return new Promise(function(n){var a,e=r[r.length-1];e.isLoading||(e.isLoading=!0,a=e.value,setTimeout(function(){t(a).then(function(t){h(function(n){var e,r;return s?__spreadArray(__spreadArray([],null!=t?t:[],!0),null!=(e=null==(e=null==n?void 0:n.filter)?void 0:e.call(n,function(n){return n.pId!==a}))?e:[],!0):((r=u(n,a)).children&&Array.isArray(r.children)&&r.children.length?r.children=__spreadArray(__spreadArray([],r.children,!0),null!=(e=null==(e=null==t?void 0:t.filter)?void 0:e.call(t,function(e){return r.children.find(function(n){return n.value!==e.value})}))?e:[],!0):r.children=t,__spreadArray([],null!=n?n:[],!0))})}),n(void 0)},300))})},onChange:function(n,e){_.current=e,n.apply(void 0,e)}}};exports.default=useAsyncCascader;
//# sourceMappingURL=useAsyncCascader.js.map
