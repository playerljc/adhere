import _Select from"antd/es/select";import _Spin from"antd/es/spin";var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var n,r=1,t=arguments.length;r<t;r++)for(var o in n=arguments[r])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e}).apply(this,arguments)},__rest=this&&this.__rest||function(e,n){var r={};for(o in e)Object.prototype.hasOwnProperty.call(e,o)&&n.indexOf(o)<0&&(r[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var t=0,o=Object.getOwnPropertySymbols(e);t<o.length;t++)n.indexOf(o[t])<0&&Object.prototype.propertyIsEnumerable.call(e,o[t])&&(r[o[t]]=e[o[t]]);return r},__spreadArray=this&&this.__spreadArray||function(e,n,r){if(r||2===arguments.length)for(var t,o=0,a=n.length;o<a;o++)!t&&o in n||((t=t||Array.prototype.slice.call(n,0,o))[o]=n[o]);return e.concat(t||Array.prototype.slice.call(n))};import classNames from"classnames";import debounce from"lodash.debounce";import React,{memo,useCallback,useMemo,useRef,useState}from"react";import WatchMemoized from"@baifendian/adhere-util-watchmemoized";var memoized=WatchMemoized.memoized,selectorPrefix="adhere-ui-auto-complete",AutoComplete=function(e){function r(n){var e,r=__spreadArray(__spreadArray([],null!=l?l:[],!0),null!=(e=p.current)?e:[],!0);Array.isArray(n)?p.current=n.map(function(n){return r.find(function(e){return e.value===n})}).filter(function(e){return!!e}):p.current=[r.find(function(e){return e.value===n})].filter(function(e){return!!e}),null!=(e=c.onChange)&&e.call(c,n),h?v.current=Date.now():d(!1)}var n=e.classNameWrap,t=e.styleWrap,o=e.renderLoading,a=e.debounceTimeout,a=void 0===a?300:a,l=e.options,u=e.loadData,i=e.children,c=__rest(e,["classNameWrap","styleWrap","renderLoading","debounceTimeout","options","loadData","children"]),e=useState(!1),s=e[0],f=e[1],e=useState(!1),m=e[0],d=e[1],p=useRef([]),v=useRef(0),h="mode"in c&&"multiple"===c.mode,e=useMemo(function(){var e;return null!=(e=null==o?void 0:o())?e:React.createElement("div",{className:"".concat(selectorPrefix,"-loading")},React.createElement(_Spin,{size:"large"}))},[o]),y=useCallback(memoized.createMemoFun(function(e){f(!0),null!=u&&u(e).then(function(){f(!1)})}),[u]),a=useCallback(debounce(function(e){var n=Date.now();console.log("isMultiple",h),console.log("currentTime",n),console.log("onSelectChangeStartTime.current",v.current),console.log("currentTime - onSelectChangeStartTime.current",n-v.current),h&&0!==v.current&&n-v.current<=400?v.current=0:(v.current=0,n=e.target.value.trim(),y(n))},null!=a?a:300),[a]),_=useMemo(function(){Array.isArray(c.value)?c.value.forEach(function(n){var e=null==(e=null==l?void 0:l.find)?void 0:e.call(l,function(e){return e.value===n});e&&!p.current.find(function(e){return e.value===n})&&p.current.push(e)}):(n=null==(n=null==l?void 0:l.find)?void 0:n.call(l,function(e){return e.value===c.value}))&&!p.current.find(function(e){return e.value===c.value})&&p.current.push(n);var e=__spreadArray(__spreadArray([],null!=l?l:[],!0),null!=(n=p.current)?n:[],!0),n=e.map(function(e){return e.value});return Array.from(new Set(n)).map(function(n){return e.find(function(e){return e.value===n})})},[c.value,l]);return React.createElement("div",{className:classNames(selectorPrefix,null!=n?n:""),style:null!=t?t:{}},React.createElement(_Select,__assign({showSearch:!0,allowClear:!0,notFoundContent:s&&e,filterOption:!1,open:m,options:null!=_?_:[],onInput:a,onClear:function(){null!=u&&u("").then(function(){f(!1)})},dropdownRender:function(e){var n;return null!=(n=null==i?void 0:i({originNode:e,value:c.value,onChange:r,options:null!=_?_:[],loading:s}))?n:e},onDropdownVisibleChange:d},c,{onChange:r})))};export default memo(AutoComplete);
//# sourceMappingURL=AutoComplete.js.map
