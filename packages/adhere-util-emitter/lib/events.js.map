{"version":3,"file":"events.js","sources":["events.js"],"sourcesContent":["\"use strict\";\n/**\n * Events\n * @class Events\n * @classdesc Events\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Events = /** @class */ (function () {\n    /**\n     * @constructor\n     */\n    function Events() {\n        this.Events = Events;\n        this.events = {};\n    }\n    /**\n     * remove\n     * @param {type} type\n     * @param {Function} handler\n     */\n    Events.prototype.remove = function (type, handler) {\n        if (this.hasType(type)) {\n            var index = this.events[type].handlers.findIndex(function (item) {\n                return item === handler;\n            });\n            if (index !== -1) {\n                this.events[type].handlers.splice(index, 1);\n            }\n        }\n    };\n    /**\n     * hasType\n     * @param {string} type\n     * @return {boolean}\n     */\n    Events.prototype.hasType = function (type) {\n        return type in this.events;\n    };\n    /**\n     * clear 清除一个type下的所有handler\n     * @param {string} type\n     */\n    Events.prototype.clear = function (type) {\n        if (this.hasType(type)) {\n            this.events[type].handlers = [];\n        }\n    };\n    /**\n     * 清除所有\n     */\n    Events.prototype.clearAll = function () {\n        this.events = {};\n    };\n    /**\n     * on\n     * @param {string} type\n     * @param {Function} handler\n     * @param {number} makStackSize\n     */\n    Events.prototype.on = function (type, handler, makStackSize) {\n        if (makStackSize === void 0) { makStackSize = 200; }\n        if (!this.hasType(type)) {\n            this.events[type] = {\n                handlers: [],\n            };\n        }\n        // length - 7\n        // 0 1 2 3 4 5 6\n        // maxStackSize - 2\n        var handlers = this.events[type].handlers;\n        if (handlers.length === makStackSize) {\n            handlers.shift();\n        }\n        if (handlers.length > makStackSize) {\n            var length_1 = handlers.length;\n            this.events[type].handlers = handlers.slice(length_1 - makStackSize + 1);\n        }\n        handlers.push(handler);\n    };\n    /**\n     * once\n     * @param type\n     * @param handler\n     */\n    Events.prototype.once = function (type, handler) {\n        var _this = this;\n        if (!this.hasType(type)) {\n            this.events[type] = {\n                handlers: [],\n            };\n        }\n        this.events[type].handlers = [\n            function () {\n                if (handler) {\n                    handler();\n                }\n                _this.clear(type);\n            },\n        ];\n    };\n    /**\n     * all\n     * @param types\n     * @param handler\n     */\n    Events.prototype.all = function (types, handler) {\n        var _this = this;\n        var changeLogs = [];\n        types.forEach(function (type) {\n            var fn = function () {\n                var item = changeLogs.find(function (t) { return t.key === key; });\n                if (item) {\n                    item.status = true;\n                }\n                if (changeLogs.every(function (t) { return t.status; })) {\n                    if (handler) {\n                        changeLogs = changeLogs.map(function (t) { return ({ key: t.key, fn: t.fn, status: false }); });\n                        handler();\n                    }\n                }\n            };\n            var key = Symbol.for(type);\n            changeLogs.push({\n                key: key,\n                status: false,\n                fn: fn,\n            });\n            _this.on(key, fn);\n        });\n        return function () {\n            changeLogs.forEach(function (t) {\n                _this.remove(t.key, t.fn);\n            });\n        };\n    };\n    /**\n     * race\n     * @param types\n     * @param handler\n     */\n    Events.prototype.race = function (types, handler) {\n        var _this = this;\n        var changeLogs = [];\n        types.forEach(function (type) {\n            var key = Symbol.for(type);\n            var fn = function () {\n                var item = changeLogs.find(function (t) { return t.key === key; });\n                if (item) {\n                    item.status = true;\n                }\n                if (changeLogs.some(function (t) { return t.status; })) {\n                    if (handler) {\n                        changeLogs = changeLogs.map(function (t) { return ({ key: t.key, fn: t.fn, status: false }); });\n                        handler();\n                    }\n                }\n            };\n            changeLogs.push({\n                key: key,\n                status: false,\n                fn: fn,\n            });\n            _this.on(key, fn);\n        });\n        return function () {\n            changeLogs.forEach(function (t) {\n                _this.remove(t.key, t.fn);\n            });\n        };\n    };\n    /**\n     * count\n     * @param type\n     * @param count\n     * @param handler\n     */\n    Events.prototype.count = function (type, count, handler) {\n        var _this = this;\n        var number = 0;\n        var key = Symbol.for(type);\n        var fn = function () {\n            number = number + 1;\n            if (number === count) {\n                if (handler) {\n                    handler();\n                }\n                number = 0;\n            }\n        };\n        this.on(key, fn);\n        return function () {\n            _this.remove(key, fn);\n        };\n    };\n    /**\n     * trigger\n     * @param {string} type\n     * @param {Object} params\n     */\n    Events.prototype.trigger = function (type) {\n        var _this = this;\n        var params = [];\n        for (var _i = 1; _i < arguments.length; _i++) {\n            params[_i - 1] = arguments[_i];\n        }\n        var result = null;\n        if (this.hasType(type)) {\n            this.events[type].handlers.forEach(function (handler) {\n                result = handler.apply(void 0, params);\n                // type是字符串的时候发送symbol消息\n                if (typeof type === 'string') {\n                    _this.trigger(Symbol.for(type));\n                }\n            });\n        }\n        return result;\n    };\n    /**\n     * document自定义事件的触发\n     * @param el\n     * @param type\n     * @param params\n     */\n    Events.prototype.dispatchEvent = function (el, type, params) {\n        if (el === void 0) { el = document; }\n        var event = new CustomEvent(type, params);\n        el.dispatchEvent(event);\n    };\n    return Events;\n}());\n/**\n * 消息通知\n */\nexports.default = Events;\n"],"names":["Object","defineProperty","exports","value","Events","this","events","prototype","remove","type","handler","index","hasType","handlers","findIndex","item","splice","clear","clearAll","on","makStackSize","length_1","length","shift","slice","push","once","_this","all","types","changeLogs","forEach","fn","find","t","key","status","every","map","Symbol","for","race","some","count","number","trigger","params","_i","arguments","result","apply","dispatchEvent","el","document","event","CustomEvent","default"],"mappings":"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"}