{"version":3,"file":"events.js","sources":["events.js"],"sourcesContent":["\"use strict\";\r\n/**\r\n * Events\r\n * @class Events\r\n * @classdesc Events\r\n */\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar Events = /** @class */ (function () {\r\n    /**\r\n     * @constructor\r\n     */\r\n    function Events() {\r\n        this.Events = Events;\r\n        this.events = {};\r\n    }\r\n    /**\r\n     * remove\r\n     * @param {type} type\r\n     * @param {Function} handler\r\n     */\r\n    Events.prototype.remove = function (type, handler) {\r\n        if (this.hasType(type)) {\r\n            var index = this.events[type].handlers.findIndex(function (item) {\r\n                return item === handler;\r\n            });\r\n            if (index !== -1) {\r\n                this.events[type].handlers.splice(index, 1);\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * hasType\r\n     * @param {string} type\r\n     * @return {boolean}\r\n     */\r\n    Events.prototype.hasType = function (type) {\r\n        return type in this.events;\r\n    };\r\n    /**\r\n     * clear 清除一个type下的所有handler\r\n     * @param {string} type\r\n     */\r\n    Events.prototype.clear = function (type) {\r\n        if (this.hasType(type)) {\r\n            this.events[type].handlers = [];\r\n        }\r\n    };\r\n    /**\r\n     * 清除所有\r\n     */\r\n    Events.prototype.clearAll = function () {\r\n        this.events = {};\r\n    };\r\n    /**\r\n     * on\r\n     * @param {string} type\r\n     * @param {Function} handler\r\n     * @param {number} makStackSize\r\n     */\r\n    Events.prototype.on = function (type, handler, makStackSize) {\r\n        if (makStackSize === void 0) { makStackSize = 200; }\r\n        if (!this.hasType(type)) {\r\n            this.events[type] = {\r\n                handlers: [],\r\n            };\r\n        }\r\n        // length - 7\r\n        // 0 1 2 3 4 5 6\r\n        // maxStackSize - 2\r\n        var handlers = this.events[type].handlers;\r\n        if (handlers.length === makStackSize) {\r\n            handlers.shift();\r\n        }\r\n        if (handlers.length > makStackSize) {\r\n            var length_1 = handlers.length;\r\n            this.events[type].handlers = handlers.slice(length_1 - makStackSize + 1);\r\n        }\r\n        handlers.push(handler);\r\n    };\r\n    /**\r\n     * once\r\n     * @param type\r\n     * @param handler\r\n     */\r\n    Events.prototype.once = function (type, handler) {\r\n        var _this = this;\r\n        if (!this.hasType(type)) {\r\n            this.events[type] = {\r\n                handlers: [],\r\n            };\r\n        }\r\n        this.events[type].handlers = [\r\n            function () {\r\n                if (handler) {\r\n                    handler();\r\n                }\r\n                _this.clear(type);\r\n            },\r\n        ];\r\n    };\r\n    /**\r\n     * all\r\n     * @param types\r\n     * @param handler\r\n     */\r\n    Events.prototype.all = function (types, handler) {\r\n        var _this = this;\r\n        var changeLogs = [];\r\n        types.forEach(function (type) {\r\n            var fn = function () {\r\n                var item = changeLogs.find(function (t) { return t.key === key; });\r\n                if (item) {\r\n                    item.status = true;\r\n                }\r\n                if (changeLogs.every(function (t) { return t.status; })) {\r\n                    if (handler) {\r\n                        changeLogs = changeLogs.map(function (t) { return ({ key: t.key, fn: t.fn, status: false }); });\r\n                        handler();\r\n                    }\r\n                }\r\n            };\r\n            var key = Symbol.for(type);\r\n            changeLogs.push({\r\n                key: key,\r\n                status: false,\r\n                fn: fn,\r\n            });\r\n            _this.on(key, fn);\r\n        });\r\n        return function () {\r\n            changeLogs.forEach(function (t) {\r\n                _this.remove(t.key, t.fn);\r\n            });\r\n        };\r\n    };\r\n    /**\r\n     * race\r\n     * @param types\r\n     * @param handler\r\n     */\r\n    Events.prototype.race = function (types, handler) {\r\n        var _this = this;\r\n        var changeLogs = [];\r\n        types.forEach(function (type) {\r\n            var key = Symbol.for(type);\r\n            var fn = function () {\r\n                var item = changeLogs.find(function (t) { return t.key === key; });\r\n                if (item) {\r\n                    item.status = true;\r\n                }\r\n                if (changeLogs.some(function (t) { return t.status; })) {\r\n                    if (handler) {\r\n                        changeLogs = changeLogs.map(function (t) { return ({ key: t.key, fn: t.fn, status: false }); });\r\n                        handler();\r\n                    }\r\n                }\r\n            };\r\n            changeLogs.push({\r\n                key: key,\r\n                status: false,\r\n                fn: fn,\r\n            });\r\n            _this.on(key, fn);\r\n        });\r\n        return function () {\r\n            changeLogs.forEach(function (t) {\r\n                _this.remove(t.key, t.fn);\r\n            });\r\n        };\r\n    };\r\n    /**\r\n     * count\r\n     * @param type\r\n     * @param count\r\n     * @param handler\r\n     */\r\n    Events.prototype.count = function (type, count, handler) {\r\n        var _this = this;\r\n        var number = 0;\r\n        var key = Symbol.for(type);\r\n        var fn = function () {\r\n            number = number + 1;\r\n            if (number === count) {\r\n                if (handler) {\r\n                    handler();\r\n                }\r\n                number = 0;\r\n            }\r\n        };\r\n        this.on(key, fn);\r\n        return function () {\r\n            _this.remove(key, fn);\r\n        };\r\n    };\r\n    /**\r\n     * trigger\r\n     * @param {string} type\r\n     * @param {Object} params\r\n     */\r\n    Events.prototype.trigger = function (type) {\r\n        var _this = this;\r\n        var params = [];\r\n        for (var _i = 1; _i < arguments.length; _i++) {\r\n            params[_i - 1] = arguments[_i];\r\n        }\r\n        var result = null;\r\n        if (this.hasType(type)) {\r\n            this.events[type].handlers.forEach(function (handler) {\r\n                result = handler.apply(void 0, params);\r\n                // type是字符串的时候发送symbol消息\r\n                if (typeof type === 'string') {\r\n                    _this.trigger(Symbol.for(type));\r\n                }\r\n            });\r\n        }\r\n        return result;\r\n    };\r\n    /**\r\n     * document自定义事件的触发\r\n     * @param el\r\n     * @param type\r\n     * @param params\r\n     */\r\n    Events.prototype.dispatchEvent = function (el, type, params) {\r\n        if (el === void 0) { el = document; }\r\n        var event = new CustomEvent(type, params);\r\n        el.dispatchEvent(event);\r\n    };\r\n    return Events;\r\n}());\r\n/**\r\n * 消息通知\r\n */\r\nexports.default = Events;\r\n"],"names":["Object","defineProperty","exports","value","Events","this","events","prototype","remove","type","handler","index","hasType","handlers","findIndex","item","splice","clear","clearAll","on","makStackSize","length_1","length","shift","slice","push","once","_this","all","types","changeLogs","forEach","fn","find","t","key","status","every","map","Symbol","for","race","some","count","number","trigger","params","_i","arguments","result","apply","dispatchEvent","el","document","event","CustomEvent","default"],"mappings":"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"}