{"version":3,"file":"events.js","sources":["events.js"],"sourcesContent":["\"use strict\";\r\n/**\r\n * Events\r\n * @class Events\r\n * @classdesc Events\r\n */\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar Events = /** @class */ (function () {\r\n    /**\r\n     * @constructor\r\n     */\r\n    function Events() {\r\n        this.Events = Events;\r\n        this.events = {};\r\n    }\r\n    /**\r\n     * remove\r\n     * @param {type} type\r\n     * @param {Function} handler\r\n     */\r\n    Events.prototype.remove = function (type, handler) {\r\n        if (this.hasType(type)) {\r\n            var index = this.events[type].handlers.findIndex(function (item) {\r\n                return item === handler;\r\n            });\r\n            if (index !== -1) {\r\n                this.events[type].handlers.splice(index, 1);\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * hasType\r\n     * @param {string} type\r\n     * @return {boolean}\r\n     */\r\n    Events.prototype.hasType = function (type) {\r\n        return type in this.events;\r\n    };\r\n    /**\r\n     * clear 清除一个type下的所有handler\r\n     * @param {string} type\r\n     */\r\n    Events.prototype.clear = function (type) {\r\n        if (this.hasType(type)) {\r\n            this.events[type].handlers = [];\r\n        }\r\n    };\r\n    /**\r\n     * 清除所有\r\n     */\r\n    Events.prototype.clearAll = function () {\r\n        this.events = {};\r\n    };\r\n    /**\r\n     * on\r\n     * @param {string} type\r\n     * @param {Function} handler\r\n     * @param {number} makStackSize\r\n     */\r\n    Events.prototype.on = function (type, handler, makStackSize) {\r\n        if (makStackSize === void 0) { makStackSize = 200; }\r\n        if (!this.hasType(type)) {\r\n            this.events[type] = {\r\n                handlers: [],\r\n            };\r\n        }\r\n        // length - 7\r\n        // 0 1 2 3 4 5 6\r\n        // maxStackSize - 2\r\n        var handlers = this.events[type].handlers;\r\n        if (handlers.length === makStackSize) {\r\n            handlers.shift();\r\n        }\r\n        if (handlers.length > makStackSize) {\r\n            var length_1 = handlers.length;\r\n            this.events[type].handlers = handlers.slice(length_1 - makStackSize + 1);\r\n        }\r\n        handlers.push(handler);\r\n    };\r\n    /**\r\n     * once\r\n     * @param type\r\n     * @param handler\r\n     */\r\n    Events.prototype.once = function (type, handler) {\r\n        var _this = this;\r\n        if (!this.hasType(type)) {\r\n            this.events[type] = {\r\n                handlers: [],\r\n            };\r\n        }\r\n        this.events[type].handlers = [\r\n            function () {\r\n                if (handler) {\r\n                    handler();\r\n                }\r\n                _this.clear(type);\r\n            },\r\n        ];\r\n    };\r\n    /**\r\n     * all\r\n     * @param types\r\n     * @param handler\r\n     */\r\n    Events.prototype.all = function (types, handler) {\r\n        var _this = this;\r\n        var changeLogs = [];\r\n        types.forEach(function (type) {\r\n            var fn = function () {\r\n                var item = changeLogs.find(function (t) { return t.key === key; });\r\n                if (item) {\r\n                    item.status = true;\r\n                }\r\n                if (changeLogs.every(function (t) { return t.status; })) {\r\n                    if (handler) {\r\n                        changeLogs = changeLogs.map(function (t) { return ({ key: t.key, fn: t.fn, status: false }); });\r\n                        handler();\r\n                    }\r\n                }\r\n            };\r\n            var key = Symbol.for(type);\r\n            changeLogs.push({\r\n                key: key,\r\n                status: false,\r\n                fn: fn,\r\n            });\r\n            _this.on(key, fn);\r\n        });\r\n        return function () {\r\n            changeLogs.forEach(function (t) {\r\n                _this.remove(t.key, t.fn);\r\n            });\r\n        };\r\n    };\r\n    /**\r\n     * race\r\n     * @param types\r\n     * @param handler\r\n     */\r\n    Events.prototype.race = function (types, handler) {\r\n        var _this = this;\r\n        var changeLogs = [];\r\n        types.forEach(function (type) {\r\n            var key = Symbol.for(type);\r\n            var fn = function () {\r\n                var item = changeLogs.find(function (t) { return t.key === key; });\r\n                if (item) {\r\n                    item.status = true;\r\n                }\r\n                if (changeLogs.some(function (t) { return t.status; })) {\r\n                    if (handler) {\r\n                        changeLogs = changeLogs.map(function (t) { return ({ key: t.key, fn: t.fn, status: false }); });\r\n                        handler();\r\n                    }\r\n                }\r\n            };\r\n            changeLogs.push({\r\n                key: key,\r\n                status: false,\r\n                fn: fn,\r\n            });\r\n            _this.on(key, fn);\r\n        });\r\n        return function () {\r\n            changeLogs.forEach(function (t) {\r\n                _this.remove(t.key, t.fn);\r\n            });\r\n        };\r\n    };\r\n    /**\r\n     * count\r\n     * @param type\r\n     * @param count\r\n     * @param handler\r\n     */\r\n    Events.prototype.count = function (type, count, handler) {\r\n        var _this = this;\r\n        var number = 0;\r\n        var key = Symbol.for(type);\r\n        var fn = function () {\r\n            number = number + 1;\r\n            if (number === count) {\r\n                if (handler) {\r\n                    handler();\r\n                }\r\n                number = 0;\r\n            }\r\n        };\r\n        this.on(key, fn);\r\n        return function () {\r\n            _this.remove(key, fn);\r\n        };\r\n    };\r\n    /**\r\n     * trigger\r\n     * @param {string} type\r\n     * @param {Object} params\r\n     */\r\n    Events.prototype.trigger = function (type) {\r\n        var _this = this;\r\n        var params = [];\r\n        for (var _i = 1; _i < arguments.length; _i++) {\r\n            params[_i - 1] = arguments[_i];\r\n        }\r\n        var result = null;\r\n        if (this.hasType(type)) {\r\n            this.events[type].handlers.forEach(function (handler) {\r\n                result = handler.apply(void 0, params);\r\n                // type是字符串的时候发送symbol消息\r\n                if (typeof type === 'string') {\r\n                    _this.trigger(Symbol.for(type));\r\n                }\r\n            });\r\n        }\r\n        return result;\r\n    };\r\n    /**\r\n     * document自定义事件的触发\r\n     * @param el\r\n     * @param type\r\n     * @param params\r\n     */\r\n    Events.prototype.dispatchEvent = function (el, type, params) {\r\n        if (el === void 0) { el = document; }\r\n        var event = new CustomEvent(type, params);\r\n        el.dispatchEvent(event);\r\n    };\r\n    return Events;\r\n}());\r\n/**\r\n * 消息通知\r\n */\r\nexports.default = Events;\r\n"],"names":["Object","defineProperty","exports","value","Events","this","events","prototype","remove","type","handler","index","hasType","handlers","findIndex","item","splice","clear","clearAll","on","makStackSize","length_1","length","shift","slice","push","once","_this","all","types","changeLogs","forEach","fn","find","t","key","status","every","map","Symbol","for","race","some","count","number","trigger","params","_i","arguments","result","apply","dispatchEvent","el","document","event","CustomEvent","default"],"mappings":"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"}