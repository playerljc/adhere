{"version":3,"file":"events.js","sources":["events.js"],"sourcesContent":["\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n/**\r\n * Events\r\n * @class Events\r\n * @classdesc Events\r\n */\r\nvar Events = /** @class */ (function () {\r\n    /**\r\n     * @constructor\r\n     */\r\n    function Events() {\r\n        this.events = {};\r\n    }\r\n    /**\r\n     * remove\r\n     * @param {type} type\r\n     * @param {Function} handler\r\n     */\r\n    Events.prototype.remove = function (type, handler) {\r\n        if (this.hasType(type)) {\r\n            var index = this.events[type].handlers.findIndex(function (item) {\r\n                return item === handler;\r\n            });\r\n            if (index !== -1) {\r\n                this.events[type].handlers.splice(index, 1);\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * hasType\r\n     * @param {string} type\r\n     * @return {boolean}\r\n     */\r\n    Events.prototype.hasType = function (type) {\r\n        return type in this.events;\r\n    };\r\n    /**\r\n     * clear 清除一个type下的所有handler\r\n     * @param {string} type\r\n     */\r\n    Events.prototype.clear = function (type) {\r\n        if (this.hasType(type)) {\r\n            this.events[type].handlers = [];\r\n        }\r\n    };\r\n    /**\r\n     * 清除所有\r\n     */\r\n    Events.prototype.clearAll = function () {\r\n        this.events = {};\r\n    };\r\n    /**\r\n     * on\r\n     * @param {string} type\r\n     * @param {Function} handler\r\n     * @param {number} makStackSize\r\n     */\r\n    Events.prototype.on = function (type, handler, makStackSize) {\r\n        if (makStackSize === void 0) { makStackSize = 200; }\r\n        if (!this.hasType(type)) {\r\n            this.events[type] = {\r\n                handlers: [],\r\n            };\r\n        }\r\n        // length - 7\r\n        // 0 1 2 3 4 5 6\r\n        // maxStackSize - 2\r\n        var handlers = this.events[type].handlers;\r\n        if (handlers.length === makStackSize) {\r\n            handlers.shift();\r\n        }\r\n        if (handlers.length > makStackSize) {\r\n            var length_1 = handlers.length;\r\n            this.events[type].handlers = handlers.slice(length_1 - makStackSize + 1);\r\n        }\r\n        handlers.push(handler);\r\n    };\r\n    /**\r\n     * once\r\n     * @param type\r\n     * @param handler\r\n     */\r\n    Events.prototype.once = function (type, handler) {\r\n        var _this = this;\r\n        if (!this.hasType(type)) {\r\n            this.events[type] = {\r\n                handlers: [],\r\n            };\r\n        }\r\n        this.events[type].handlers = [\r\n            function () {\r\n                if (handler) {\r\n                    handler();\r\n                }\r\n                _this.clear(type);\r\n            },\r\n        ];\r\n    };\r\n    /**\r\n     * all\r\n     * @param types\r\n     * @param handler\r\n     */\r\n    Events.prototype.all = function (types, handler) {\r\n        var _this = this;\r\n        var changeLogs = [];\r\n        types.forEach(function (type) {\r\n            var key = Symbol.for(type);\r\n            var fn = function () {\r\n                // @ts-ignore\r\n                changeLogs.find(function (t) { return t.key === key; }).status = true;\r\n                if (changeLogs.every(function (t) { return t.status; })) {\r\n                    if (handler) {\r\n                        changeLogs = changeLogs.map(function (t) { return ({ key: t.key, fn: t.fn, status: false }); });\r\n                        handler();\r\n                    }\r\n                }\r\n            };\r\n            changeLogs.push({\r\n                key: key,\r\n                status: false,\r\n                fn: fn,\r\n            });\r\n            _this.on(key, fn);\r\n        });\r\n        return function () {\r\n            changeLogs.forEach(function (t) {\r\n                _this.remove(t.key, t.fn);\r\n            });\r\n        };\r\n    };\r\n    /**\r\n     * race\r\n     * @param types\r\n     * @param handler\r\n     */\r\n    Events.prototype.race = function (types, handler) {\r\n        var _this = this;\r\n        var changeLogs = [];\r\n        types.forEach(function (type) {\r\n            var key = Symbol.for(type);\r\n            var fn = function () {\r\n                // @ts-ignore\r\n                changeLogs.find(function (t) { return t.key === key; }).status = true;\r\n                if (changeLogs.some(function (t) { return t.status; })) {\r\n                    if (handler) {\r\n                        changeLogs = changeLogs.map(function (t) { return ({ key: t.key, fn: t.fn, status: false }); });\r\n                        handler();\r\n                    }\r\n                }\r\n            };\r\n            changeLogs.push({\r\n                key: key,\r\n                status: false,\r\n                fn: fn,\r\n            });\r\n            _this.on(key, fn);\r\n        });\r\n        return function () {\r\n            changeLogs.forEach(function (t) {\r\n                _this.remove(t.key, t.fn);\r\n            });\r\n        };\r\n    };\r\n    /**\r\n     * count\r\n     * @param type\r\n     * @param count\r\n     * @param handler\r\n     */\r\n    Events.prototype.count = function (type, count, handler) {\r\n        var _this = this;\r\n        var number = 0;\r\n        var key = Symbol.for(type);\r\n        var fn = function () {\r\n            number = number + 1;\r\n            if (number === count) {\r\n                if (handler) {\r\n                    handler();\r\n                }\r\n                number = 0;\r\n            }\r\n        };\r\n        this.on(key, fn);\r\n        return function () {\r\n            _this.remove(key, fn);\r\n        };\r\n    };\r\n    /**\r\n     * trigger\r\n     * @param {string} type\r\n     * @param {Object} params\r\n     */\r\n    // @ts-ignore\r\n    Events.prototype.trigger = function (type) {\r\n        var _this = this;\r\n        var params = [];\r\n        for (var _i = 1; _i < arguments.length; _i++) {\r\n            params[_i - 1] = arguments[_i];\r\n        }\r\n        var result;\r\n        if (this.hasType(type)) {\r\n            this.events[type].handlers.forEach(function (handler) {\r\n                // @ts-ignore\r\n                result = handler.apply(void 0, params);\r\n                // type是字符串的时候发送symbol消息\r\n                if (typeof type === 'string') {\r\n                    _this.trigger(Symbol.for(type));\r\n                }\r\n            });\r\n        }\r\n        return result;\r\n    };\r\n    /**\r\n     * document自定义事件的触发\r\n     * @param el\r\n     * @param type\r\n     * @param params\r\n     */\r\n    Events.prototype.dispatchEvent = function (el, type, params) {\r\n        if (el === void 0) { el = document; }\r\n        var event = new CustomEvent(type, params);\r\n        el.dispatchEvent(event);\r\n    };\r\n    return Events;\r\n}());\r\n/**\r\n * 消息通知\r\n */\r\nexports.default = Events;\r\n"],"names":["Object","defineProperty","exports","value","Events","this","events","prototype","remove","type","handler","index","hasType","handlers","findIndex","item","splice","clear","clearAll","on","makStackSize","length_1","length","shift","slice","push","once","_this","all","types","changeLogs","forEach","key","Symbol","for","fn","find","t","status","every","map","race","some","count","number","trigger","result","params","_i","arguments","apply","dispatchEvent","el","document","event","CustomEvent","default"],"mappings":"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"}