{"version":3,"file":"popup.js","sources":["popup.js"],"sourcesContent":["import React from 'react';\nimport ReactDOM from 'react-dom/client';\nimport { v1 } from 'uuid';\nvar selectorPrefix = 'adhere-ui-popup';\nvar prePopup = null;\nvar popups = [];\nvar maskEl;\nvar el = null;\n/**\n * Popup\n * @class Popup\n * @classdesc Popup\n */\nvar Popup = /** @class */ (function () {\n    /**\n     * constructor\n     * @param config {Object} - config\n     */\n    function Popup(config) {\n        this.id = '';\n        this.config = null;\n        this.isShow = false;\n        this.el = null;\n        this.popupEl = null;\n        this.popupHandlers = new WeakMap();\n        this.isShow = false;\n        this.el = PopupFactory.getEl();\n        this.id = v1();\n        this.config = config;\n        this.onInnerElTransitionend = this.onInnerElTransitionend.bind(this);\n        this.render();\n    }\n    /**\n     * createMask\n     */\n    Popup.prototype.createMask = function () {\n        var zIndex = this.config.zIndex;\n        maskEl = document.createElement('div');\n        maskEl.className = \"\".concat(selectorPrefix, \"-mask\");\n        maskEl.style.zIndex = String((zIndex || 11000) - 1500);\n        this.el.appendChild(maskEl);\n    };\n    /**\n     * render\n     */\n    Popup.prototype.render = function () {\n        var _this = this;\n        var _a = this.config, children = _a.children, zIndex = _a.zIndex;\n        this.popupEl = document.createElement('div');\n        this.popupEl.addEventListener('transitionend', this.onInnerElTransitionend);\n        this.popupEl.className = selectorPrefix;\n        this.popupEl.style.zIndex = String(zIndex || 11000);\n        var root = ReactDOM.createRoot(this.popupEl);\n        root.render(React.cloneElement(children, {\n            ref: function () {\n                _this.el.appendChild(_this.popupEl);\n                _this.trigger('onCreate');\n            },\n        }));\n        this.popupHandlers.set(this.popupEl, root);\n    };\n    /**\n     * trigger\n     * @param hookName\n     */\n    Popup.prototype.trigger = function (hookName) {\n        var _a;\n        if ((_a = this.config) === null || _a === void 0 ? void 0 : _a[hookName]) {\n            return this.config[hookName]();\n        }\n    };\n    /**\n     * show - 显示一个popup\n     * @return boolean\n     */\n    Popup.prototype.show = function () {\n        var _this = this;\n        if (!maskEl) {\n            this.createMask();\n        }\n        // if (prePopup) {\n        //   prePopup.close();\n        // }\n        maskEl.style.display = 'block';\n        this.popupEl.style.display = 'block';\n        this.isShow = true;\n        this.trigger('onBeforeShow');\n        setTimeout(function () {\n            maskEl.classList.add('modal-in');\n            _this.popupEl.classList.add('modal-in');\n        }, 100);\n        return true;\n    };\n    /**\n     * show - 显示一个popup\n     * @return boolean\n     */\n    Popup.prototype.showClosePrePopup = function () {\n        var _this = this;\n        if (!maskEl) {\n            this.createMask();\n        }\n        if (prePopup) {\n            prePopup.close();\n        }\n        maskEl.style.display = 'block';\n        this.popupEl.style.display = 'block';\n        this.isShow = true;\n        this.trigger('onBeforeShow');\n        setTimeout(function () {\n            maskEl.classList.add('modal-in');\n            _this.popupEl.classList.add('modal-in');\n        }, 100);\n        return true;\n    };\n    /**\n     * close - 关闭一个popup\n     * @return boolean\n     */\n    Popup.prototype.close = function () {\n        var _this = this;\n        if (!maskEl) {\n            this.createMask();\n        }\n        this.isShow = false;\n        var promise = this.trigger('onBeforeClose');\n        if (promise && 'then' in promise && promise.then instanceof Function) {\n            promise.then(function () {\n                _this.popupEl.classList.remove('modal-in');\n                maskEl.classList.remove('modal-in');\n            });\n        }\n        else {\n            this.popupEl.classList.remove('modal-in');\n            maskEl.classList.remove('modal-in');\n        }\n        return true;\n    };\n    /**\n     * destroy - 销毁一个popup\n     */\n    Popup.prototype.destroy = function () {\n        if (this.popupEl) {\n            var root = this.popupHandlers.get(this.popupEl);\n            if (root) {\n                root.unmount();\n            }\n            this.popupEl = null;\n        }\n        // if (ReactDOM.unmountComponentAtNode(this.popupEl!)) {\n        //   (this.popupEl as HTMLElement).parentNode?.removeChild(this.popupEl!);\n        //   this.popupEl = null;\n        // }\n        this.trigger('onDestroy');\n        return true;\n    };\n    /**\n     * isDestroy - 是否已经销毁\n     * @return {boolean}\n     */\n    Popup.prototype.isDestroy = function () {\n        return !this.popupEl;\n    };\n    /**\n     * getId\n     * @return {string} - id\n     */\n    Popup.prototype.getId = function () {\n        return this.id;\n    };\n    /**\n     * onInnerElTransitionend\n     */\n    Popup.prototype.onInnerElTransitionend = function () {\n        if (!this.isShow) {\n            prePopup = null;\n            this.popupEl.style.display = 'none';\n            maskEl.style.display = 'none';\n            this.trigger('onAfterClose');\n        }\n        else {\n            prePopup = this;\n            this.trigger('onAfterShow');\n        }\n    };\n    return Popup;\n}());\n/**\n * PopupFactory\n */\nvar PopupFactory = {\n    /**\n     * create\n     * @param config\n     * @return Popup\n     */\n    create: function (config) {\n        var ins = new Popup(config);\n        popups.push(ins);\n        return ins;\n    },\n    /**\n     * show - 显示一个popup\n     * @param popup\n     * @return boolean\n     */\n    show: function (popup) {\n        if (!popup)\n            return false;\n        if (popup.isDestroy())\n            return false;\n        if (popup === prePopup)\n            return false;\n        if (prePopup && popup.getId() === prePopup.getId())\n            return false;\n        return popup.show();\n    },\n    /**\n     * showClosePrePopup\n     * @description 关闭之前的显示\n     * @param popup\n     * @return boolean\n     */\n    showClosePrePopup: function (popup) {\n        if (!popup)\n            return false;\n        if (popup.isDestroy())\n            return false;\n        if (popup === prePopup)\n            return false;\n        if (prePopup && popup.getId() === prePopup.getId())\n            return false;\n        if (prePopup) {\n            prePopup.close();\n        }\n        return popup.show();\n    },\n    /**\n     * close - 关闭一个popup\n     * @param {Popup} popup\n     * @return boolean\n     */\n    close: function (popup) {\n        if (!popup)\n            return false;\n        if (popup.isDestroy())\n            return false;\n        return popup.close();\n    },\n    /**\n     * closeAll - 关闭所有\n     * @return boolean\n     */\n    closeAll: function () {\n        var _this = this;\n        var flags = [];\n        popups.forEach(function (p) {\n            var flag = _this.close(p);\n            flags.push(flag);\n        });\n        return flags.every(function (flag) { return flag; });\n    },\n    /**\n     * destroy - 销毁一个popup\n     * @param {Popup} popup\n     * @return bool\n     */\n    destroy: function (popup) {\n        if (!popup)\n            return false;\n        if (popup.isDestroy())\n            return false;\n        var res = popup.destroy();\n        if (res) {\n            var index = popups.findIndex(function (p) { return p === popup; });\n            if (index !== -1) {\n                popups.splice(index, 1);\n            }\n        }\n        return res;\n    },\n    /**\n     * getEl\n     * @return {HTMLElement}\n     */\n    getEl: function () {\n        return el || document.body;\n    },\n    /**\n     * setEl\n     * @param tel\n     */\n    setEl: function (tel) {\n        el = tel;\n    },\n};\nexport default PopupFactory;\n"],"names":["React","ReactDOM","v1","maskEl","selectorPrefix","prePopup","popups","el","Popup","config","this","id","isShow","popupEl","popupHandlers","WeakMap","PopupFactory","getEl","onInnerElTransitionend","bind","render","prototype","createMask","zIndex","document","createElement","className","concat","style","String","appendChild","_this","_a","children","root","addEventListener","createRoot","cloneElement","ref","trigger","set","hookName","show","display","setTimeout","classList","add","showClosePrePopup","close","promise","then","Function","remove","destroy","get","unmount","isDestroy","getId","create","ins","push","popup","closeAll","flags","forEach","p","flag","every","res","index","findIndex","splice","body","setEl","tel"],"mappings":"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"}