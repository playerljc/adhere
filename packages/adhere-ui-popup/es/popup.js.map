{"version":3,"file":"popup.js","sources":["popup.js"],"sourcesContent":["import ReactDOM from 'react-dom';\r\nimport { v1 } from 'uuid';\r\nvar selectorPrefix = 'adhere-ui-popup';\r\nvar prePopup = null;\r\nvar popups = [];\r\nvar maskEl;\r\nvar el = null;\r\n/**\r\n * Popup\r\n * @class Popup\r\n * @classdesc Popup\r\n */\r\nvar Popup = /** @class */ (function () {\r\n    /**\r\n     * constructor\r\n     * @param config {Object} - config\r\n     */\r\n    function Popup(config) {\r\n        this.id = '';\r\n        this.config = null;\r\n        this.isShow = false;\r\n        this.el = null;\r\n        this.popupEl = null;\r\n        this.isShow = false;\r\n        this.el = PopupFactory.getEl();\r\n        this.id = v1();\r\n        this.config = config;\r\n        this.onInnerElTransitionend = this.onInnerElTransitionend.bind(this);\r\n        this.render();\r\n    }\r\n    /**\r\n     * createMask\r\n     */\r\n    Popup.prototype.createMask = function () {\r\n        var zIndex = this.config.zIndex;\r\n        maskEl = document.createElement('div');\r\n        maskEl.className = selectorPrefix + \"-mask\";\r\n        maskEl.style.zIndex = String((zIndex || 11000) - 1500);\r\n        this.el.appendChild(maskEl);\r\n    };\r\n    /**\r\n     * render\r\n     */\r\n    Popup.prototype.render = function () {\r\n        var _this = this;\r\n        var _a = this.config, children = _a.children, zIndex = _a.zIndex;\r\n        this.popupEl = document.createElement('div');\r\n        this.popupEl.addEventListener('transitionend', this.onInnerElTransitionend);\r\n        this.popupEl.className = selectorPrefix;\r\n        this.popupEl.style.zIndex = String(zIndex || 11000);\r\n        ReactDOM.render(children, this.popupEl, function () {\r\n            _this.el.appendChild(_this.popupEl);\r\n            _this.trigger('onCreate');\r\n        });\r\n    };\r\n    /**\r\n     * trigger\r\n     * @param hookName\r\n     */\r\n    Popup.prototype.trigger = function (hookName) {\r\n        var _a;\r\n        if ((_a = this.config) === null || _a === void 0 ? void 0 : _a[hookName]) {\r\n            return this.config[hookName]();\r\n        }\r\n    };\r\n    /**\r\n     * show - 显示一个popup\r\n     * @return boolean\r\n     */\r\n    Popup.prototype.show = function () {\r\n        var _this = this;\r\n        if (!maskEl) {\r\n            this.createMask();\r\n        }\r\n        // if (prePopup) {\r\n        //   prePopup.close();\r\n        // }\r\n        maskEl.style.display = 'block';\r\n        this.popupEl.style.display = 'block';\r\n        this.isShow = true;\r\n        this.trigger('onBeforeShow');\r\n        setTimeout(function () {\r\n            maskEl.classList.add('modal-in');\r\n            _this.popupEl.classList.add('modal-in');\r\n        }, 100);\r\n        return true;\r\n    };\r\n    /**\r\n     * show - 显示一个popup\r\n     * @return boolean\r\n     */\r\n    Popup.prototype.showClosePrePopup = function () {\r\n        var _this = this;\r\n        if (!maskEl) {\r\n            this.createMask();\r\n        }\r\n        if (prePopup) {\r\n            prePopup.close();\r\n        }\r\n        maskEl.style.display = 'block';\r\n        this.popupEl.style.display = 'block';\r\n        this.isShow = true;\r\n        this.trigger('onBeforeShow');\r\n        setTimeout(function () {\r\n            maskEl.classList.add('modal-in');\r\n            _this.popupEl.classList.add('modal-in');\r\n        }, 100);\r\n        return true;\r\n    };\r\n    /**\r\n     * close - 关闭一个popup\r\n     * @return boolean\r\n     */\r\n    Popup.prototype.close = function () {\r\n        var _this = this;\r\n        if (!maskEl) {\r\n            this.createMask();\r\n        }\r\n        this.isShow = false;\r\n        var promise = this.trigger('onBeforeClose');\r\n        if (promise && 'then' in promise && promise.then instanceof Function) {\r\n            promise.then(function () {\r\n                _this.popupEl.classList.remove('modal-in');\r\n                maskEl.classList.remove('modal-in');\r\n            });\r\n        }\r\n        else {\r\n            this.popupEl.classList.remove('modal-in');\r\n            maskEl.classList.remove('modal-in');\r\n        }\r\n        return true;\r\n    };\r\n    /**\r\n     * destroy - 销毁一个popup\r\n     */\r\n    Popup.prototype.destroy = function () {\r\n        var _a;\r\n        if (ReactDOM.unmountComponentAtNode(this.popupEl)) {\r\n            (_a = this.popupEl.parentNode) === null || _a === void 0 ? void 0 : _a.removeChild(this.popupEl);\r\n            this.popupEl = null;\r\n        }\r\n        this.trigger('onDestroy');\r\n        return true;\r\n    };\r\n    /**\r\n     * isDestroy - 是否已经销毁\r\n     * @return {boolean}\r\n     */\r\n    Popup.prototype.isDestroy = function () {\r\n        return !this.popupEl;\r\n    };\r\n    /**\r\n     * getId\r\n     * @return {string} - id\r\n     */\r\n    Popup.prototype.getId = function () {\r\n        return this.id;\r\n    };\r\n    /**\r\n     * onInnerElTransitionend\r\n     */\r\n    Popup.prototype.onInnerElTransitionend = function () {\r\n        if (!this.isShow) {\r\n            prePopup = null;\r\n            this.popupEl.style.display = 'none';\r\n            maskEl.style.display = 'none';\r\n            this.trigger('onAfterClose');\r\n        }\r\n        else {\r\n            prePopup = this;\r\n            this.trigger('onAfterShow');\r\n        }\r\n    };\r\n    return Popup;\r\n}());\r\n/**\r\n * PopupFactory\r\n */\r\nvar PopupFactory = {\r\n    /**\r\n     * create\r\n     * @param config\r\n     * @return Popup\r\n     */\r\n    create: function (config) {\r\n        var ins = new Popup(config);\r\n        popups.push(ins);\r\n        return ins;\r\n    },\r\n    /**\r\n     * show - 显示一个popup\r\n     * @param popup\r\n     * @return boolean\r\n     */\r\n    show: function (popup) {\r\n        if (!popup)\r\n            return false;\r\n        if (popup.isDestroy())\r\n            return false;\r\n        if (popup === prePopup)\r\n            return false;\r\n        if (prePopup && popup.getId() === prePopup.getId())\r\n            return false;\r\n        return popup.show();\r\n    },\r\n    /**\r\n     * showClosePrePopup\r\n     * @description 关闭之前的显示\r\n     * @param popup\r\n     * @return boolean\r\n     */\r\n    showClosePrePopup: function (popup) {\r\n        if (!popup)\r\n            return false;\r\n        if (popup.isDestroy())\r\n            return false;\r\n        if (popup === prePopup)\r\n            return false;\r\n        if (prePopup && popup.getId() === prePopup.getId())\r\n            return false;\r\n        if (prePopup) {\r\n            prePopup.close();\r\n        }\r\n        return popup.show();\r\n    },\r\n    /**\r\n     * close - 关闭一个popup\r\n     * @param {Popup} popup\r\n     * @return boolean\r\n     */\r\n    close: function (popup) {\r\n        if (!popup)\r\n            return false;\r\n        if (popup.isDestroy())\r\n            return false;\r\n        return popup.close();\r\n    },\r\n    /**\r\n     * closeAll - 关闭所有\r\n     * @return boolean\r\n     */\r\n    closeAll: function () {\r\n        var _this = this;\r\n        var flags = [];\r\n        popups.forEach(function (p) {\r\n            var flag = _this.close(p);\r\n            flags.push(flag);\r\n        });\r\n        return flags.every(function (flag) { return flag; });\r\n    },\r\n    /**\r\n     * destroy - 销毁一个popup\r\n     * @param {Popup} popup\r\n     * @return bool\r\n     */\r\n    destroy: function (popup) {\r\n        if (!popup)\r\n            return false;\r\n        if (popup.isDestroy())\r\n            return false;\r\n        var res = popup.destroy();\r\n        if (res) {\r\n            var index = popups.findIndex(function (p) { return p === popup; });\r\n            if (index !== -1) {\r\n                popups.splice(index, 1);\r\n            }\r\n        }\r\n        return res;\r\n    },\r\n    /**\r\n     * getEl\r\n     * @return {HTMLElement}\r\n     */\r\n    getEl: function () {\r\n        return el || document.body;\r\n    },\r\n    /**\r\n     * setEl\r\n     * @param tel\r\n     */\r\n    setEl: function (tel) {\r\n        el = tel;\r\n    },\r\n};\r\nexport default PopupFactory;\r\n"],"names":["ReactDOM","v1","maskEl","selectorPrefix","prePopup","popups","el","Popup","config","this","id","isShow","popupEl","PopupFactory","getEl","onInnerElTransitionend","bind","render","prototype","createMask","zIndex","document","createElement","className","style","String","appendChild","_this","_a","children","addEventListener","trigger","hookName","show","display","setTimeout","classList","add","showClosePrePopup","close","promise","then","Function","remove","destroy","unmountComponentAtNode","parentNode","removeChild","isDestroy","getId","create","ins","push","popup","closeAll","flags","forEach","p","flag","every","res","index","findIndex","splice","body","setEl","tel"],"mappings":"OAAOA,aAAc,mBACZC,EAAgB,KAAN,OACnB,IAGIC,OAHAC,eAAiB,kBACjBC,SAAW,KACXC,OAAS,GAETC,GAAK,KAMLC,MAAuB,WAKvB,SAASA,EAAMC,GACXC,KAAKC,GAAK,GACVD,KAAKD,OAAS,KACdC,KAAKE,OAAS,CAAA,EACdF,KAAKH,GAAK,KACVG,KAAKG,QAAU,KACfH,KAAKE,OAAS,CAAA,EACdF,KAAKH,GAAKO,aAAaC,MAAM,EAC7BL,KAAKC,GAAKT,GAAG,EACbQ,KAAKD,OAASA,EACdC,KAAKM,uBAAyBN,KAAKM,uBAAuBC,KAAKP,IAAI,EACnEA,KAAKQ,OAAO,CAChB,CAgJA,OA5IAV,EAAMW,UAAUC,WAAa,WACzB,IAAIC,EAASX,KAAKD,OAAOY,QACzBlB,OAASmB,SAASC,cAAc,KAAK,GAC9BC,UAAYpB,eAAiB,QACpCD,OAAOsB,MAAMJ,OAASK,QAAQL,GAAU,MAAS,IAAI,EACrDX,KAAKH,GAAGoB,YAAYxB,MAAM,CAC9B,EAIAK,EAAMW,UAAUD,OAAS,WACrB,IAAIU,EAAQlB,KACRmB,EAAKnB,KAAKD,OAAQqB,EAAWD,EAAGC,SAAUT,EAASQ,EAAGR,OAC1DX,KAAKG,QAAUS,SAASC,cAAc,KAAK,EAC3Cb,KAAKG,QAAQkB,iBAAiB,gBAAiBrB,KAAKM,sBAAsB,EAC1EN,KAAKG,QAAQW,UAAYpB,eACzBM,KAAKG,QAAQY,MAAMJ,OAASK,OAAOL,GAAU,IAAK,EAClDpB,SAASiB,OAAOY,EAAUpB,KAAKG,QAAS,WACpCe,EAAMrB,GAAGoB,YAAYC,EAAMf,OAAO,EAClCe,EAAMI,QAAQ,UAAU,CAC5B,CAAC,CACL,EAKAxB,EAAMW,UAAUa,QAAU,SAAUC,GAChC,IAAIJ,EACJ,GAAI,OAACA,EAAKnB,KAAKD,SAA6CoB,EAAGI,GAC3D,OAAOvB,KAAKD,OAAOwB,GAAU,CAErC,EAKAzB,EAAMW,UAAUe,KAAO,WACnB,IAAIN,EAAQlB,KAeZ,OAdKP,QACDO,KAAKU,WAAW,EAKpBjB,OAAOsB,MAAMU,QAAU,QACvBzB,KAAKG,QAAQY,MAAMU,QAAU,QAC7BzB,KAAKE,OAAS,CAAA,EACdF,KAAKsB,QAAQ,cAAc,EAC3BI,WAAW,WACPjC,OAAOkC,UAAUC,IAAI,UAAU,EAC/BV,EAAMf,QAAQwB,UAAUC,IAAI,UAAU,CAC1C,EAAG,GAAG,EACC,CAAA,CACX,EAKA9B,EAAMW,UAAUoB,kBAAoB,WAChC,IAAIX,EAAQlB,KAeZ,OAdKP,QACDO,KAAKU,WAAW,EAEhBf,UACAA,SAASmC,MAAM,EAEnBrC,OAAOsB,MAAMU,QAAU,QACvBzB,KAAKG,QAAQY,MAAMU,QAAU,QAC7BzB,KAAKE,OAAS,CAAA,EACdF,KAAKsB,QAAQ,cAAc,EAC3BI,WAAW,WACPjC,OAAOkC,UAAUC,IAAI,UAAU,EAC/BV,EAAMf,QAAQwB,UAAUC,IAAI,UAAU,CAC1C,EAAG,GAAG,EACC,CAAA,CACX,EAKA9B,EAAMW,UAAUqB,MAAQ,WACpB,IAAIZ,EAAQlB,KAKR+B,GAJCtC,QACDO,KAAKU,WAAW,EAEpBV,KAAKE,OAAS,CAAA,EACAF,KAAKsB,QAAQ,eAAe,GAW1C,OAVIS,GAAW,SAAUA,GAAWA,EAAQC,gBAAgBC,SACxDF,EAAQC,KAAK,WACTd,EAAMf,QAAQwB,UAAUO,OAAO,UAAU,EACzCzC,OAAOkC,UAAUO,OAAO,UAAU,CACtC,CAAC,GAGDlC,KAAKG,QAAQwB,UAAUO,OAAO,UAAU,EACxCzC,OAAOkC,UAAUO,OAAO,UAAU,GAE/B,CAAA,CACX,EAIApC,EAAMW,UAAU0B,QAAU,WACtB,IAAIhB,EAMJ,OALI5B,SAAS6C,uBAAuBpC,KAAKG,OAAO,IAC5C,OAACgB,EAAKnB,KAAKG,QAAQkC,aAAiDlB,EAAGmB,YAAYtC,KAAKG,OAAO,EAC/FH,KAAKG,QAAU,MAEnBH,KAAKsB,QAAQ,WAAW,EACjB,CAAA,CACX,EAKAxB,EAAMW,UAAU8B,UAAY,WACxB,MAAO,CAACvC,KAAKG,OACjB,EAKAL,EAAMW,UAAU+B,MAAQ,WACpB,OAAOxC,KAAKC,EAChB,EAIAH,EAAMW,UAAUH,uBAAyB,WAChCN,KAAKE,QAONP,SAAWK,MACNsB,QAAQ,aAAa,GAP1B3B,SAAW,KACXK,KAAKG,QAAQY,MAAMU,QAAU,OAC7BhC,OAAOsB,MAAMU,QAAU,OACvBzB,KAAKsB,QAAQ,cAAc,EAMnC,EACOxB,CACX,EAAG,EAICM,aAAe,CAMfqC,OAAQ,SAAU1C,GACV2C,EAAM,IAAI5C,MAAMC,CAAM,EAE1B,OADAH,OAAO+C,KAAKD,CAAG,EACRA,CACX,EAMAlB,KAAM,SAAUoB,GACZ,MAAKA,CAAAA,CAAAA,IAEDA,CAAAA,EAAML,UAAU,IAEhBK,IAAUjD,YAEVA,CAAAA,UAAYiD,EAAMJ,MAAM,IAAM7C,SAAS6C,MAAM,IAE1CI,EAAMpB,KAAK,IACtB,EAOAK,kBAAmB,SAAUe,GACzB,MAAKA,CAAAA,CAAAA,IAEDA,CAAAA,EAAML,UAAU,IAEhBK,IAAUjD,YAEVA,CAAAA,UAAYiD,EAAMJ,MAAM,IAAM7C,SAAS6C,MAAM,KAE7C7C,UACAA,SAASmC,MAAM,EAEZc,EAAMpB,KAAK,KACtB,EAMAM,MAAO,SAAUc,GACb,MAAKA,CAAAA,CAAAA,IAEDA,CAAAA,EAAML,UAAU,GAEbK,EAAMd,MAAM,EACvB,EAKAe,SAAU,WACN,IAAI3B,EAAQlB,KACR8C,EAAQ,GAKZ,OAJAlD,OAAOmD,QAAQ,SAAUC,GACjBC,EAAO/B,EAAMY,MAAMkB,CAAC,EACxBF,EAAMH,KAAKM,CAAI,CACnB,CAAC,EACMH,EAAMI,MAAM,SAAUD,GAAQ,OAAOA,CAAM,CAAC,CACvD,EAMAd,QAAS,SAAUS,GACf,IAIIO,EAEIC,EANR,MAAKR,CAAAA,CAAAA,IAEDA,CAAAA,EAAML,UAAU,KAEhBY,EAAMP,EAAMT,QAAQ,IAGN,CAAC,KADXiB,EAAQxD,OAAOyD,UAAU,SAAUL,GAAK,OAAOA,IAAMJ,CAAO,CAAC,IAE7DhD,OAAO0D,OAAOF,EAAO,CAAC,EAGvBD,GACX,EAKA9C,MAAO,WACH,OAAOR,IAAMe,SAAS2C,IAC1B,EAKAC,MAAO,SAAUC,GACb5D,GAAK4D,CACT,CACJ,iBACerD"}