{"version":3,"file":"Popup.js","sources":["Popup.js"],"sourcesContent":["import React from 'react';\nimport ReactDOM from 'react-dom/client';\nimport { v1 } from 'uuid';\nimport Util from '@baifendian/adhere-util';\nimport Trigger from './Trigger';\nimport TriggerPrompt from './TriggerPrompt';\nvar selectorPrefix = 'adhere-ui-popup';\nvar prePopup = null;\nvar popups = [];\nvar maskEl;\nvar el = null;\n/**\n * Popup\n * @class Popup\n * @classdesc Popup\n */\nvar Popup = /** @class */function () {\n  /**\n   * constructor\n   * @param config {Object} - config\n   */\n  function Popup(config) {\n    this.id = '';\n    this.config = null;\n    this.isShow = false;\n    this.el = null;\n    this.popupEl = null;\n    this.popupHandlers = new WeakMap();\n    this.isShow = false;\n    this.el = PopupFactory.getEl();\n    this.id = v1();\n    this.config = config;\n    this.onInnerElTransitionend = this.onInnerElTransitionend.bind(this);\n    this.render();\n  }\n  /**\n   * createMask\n   */\n  Popup.prototype.createMask = function () {\n    var zIndex = this.config.zIndex;\n    maskEl = document.createElement('div');\n    maskEl.className = \"\".concat(selectorPrefix, \"-mask\");\n    maskEl.style.zIndex = String((zIndex || 11000) - 1500);\n    this.el.appendChild(maskEl);\n  };\n  /**\n   * render\n   */\n  Popup.prototype.render = function () {\n    var _this = this;\n    var _a = this.config,\n      children = _a.children,\n      zIndex = _a.zIndex;\n    this.popupEl = document.createElement('div');\n    this.popupEl.addEventListener('transitionend', this.onInnerElTransitionend);\n    this.popupEl.className = selectorPrefix;\n    this.popupEl.style.zIndex = String(zIndex || 11000);\n    var root = ReactDOM.createRoot(this.popupEl);\n    root.render( /*#__PURE__*/React.cloneElement(children, {\n      ref: function ref() {\n        var _a;\n        _this.el.appendChild(_this.popupEl);\n        var configProviderEL = Util.getTopDom(_this.popupEl, 'adhere-ui-config-provider');\n        if (configProviderEL) {\n          _this.popupEl.style.cssText = (_a = configProviderEL === null || configProviderEL === void 0 ? void 0 : configProviderEL.style) === null || _a === void 0 ? void 0 : _a.cssText;\n        }\n        _this.trigger('onCreate');\n      }\n    }));\n    this.popupHandlers.set(this.popupEl, root);\n  };\n  /**\n   * trigger\n   * @param hookName\n   */\n  Popup.prototype.trigger = function (hookName) {\n    var _a, _b, _c;\n    if ((_a = this.config) === null || _a === void 0 ? void 0 : _a[hookName]) {\n      return (_c = (_b = this === null || this === void 0 ? void 0 : this.config) === null || _b === void 0 ? void 0 : _b[hookName]) === null || _c === void 0 ? void 0 : _c.call(_b);\n    }\n  };\n  /**\n   * show - 显示一个popup\n   * @return boolean\n   */\n  Popup.prototype.show = function () {\n    var _this = this;\n    if (!maskEl) {\n      this.createMask();\n    }\n    // if (prePopup) {\n    //   prePopup.close();\n    // }\n    maskEl.style.display = 'block';\n    this.popupEl.style.display = 'block';\n    this.isShow = true;\n    this.trigger('onBeforeShow');\n    setTimeout(function () {\n      maskEl.classList.add('modal-in');\n      _this.popupEl.classList.add('modal-in');\n    }, 100);\n    return true;\n  };\n  /**\n   * show - 显示一个popup\n   * @return boolean\n   */\n  Popup.prototype.showClosePrePopup = function () {\n    var _this = this;\n    if (!maskEl) {\n      this.createMask();\n    }\n    if (prePopup) {\n      prePopup.close();\n    }\n    maskEl.style.display = 'block';\n    this.popupEl.style.display = 'block';\n    this.isShow = true;\n    this.trigger('onBeforeShow');\n    setTimeout(function () {\n      maskEl.classList.add('modal-in');\n      _this.popupEl.classList.add('modal-in');\n    }, 100);\n    return true;\n  };\n  /**\n   * close - 关闭一个popup\n   * @return boolean\n   */\n  Popup.prototype.close = function () {\n    var _this = this;\n    if (!maskEl) {\n      this.createMask();\n    }\n    this.isShow = false;\n    var promise = this.trigger('onBeforeClose');\n    if (promise && 'then' in promise && promise.then instanceof Function) {\n      promise.then(function () {\n        try {\n          _this.popupEl.classList.remove('modal-in');\n        } catch (e) {\n          throw e;\n        }\n        maskEl.classList.remove('modal-in');\n      });\n    } else {\n      this.popupEl.classList.remove('modal-in');\n      maskEl.classList.remove('modal-in');\n    }\n    return true;\n  };\n  /**\n   * destroy - 销毁一个popup\n   */\n  Popup.prototype.destroy = function () {\n    if (this.popupEl) {\n      var root = this.popupHandlers.get(this.popupEl);\n      if (root) {\n        root.unmount();\n      }\n      this.popupEl = null;\n    }\n    // if (ReactDOM.unmountComponentAtNode(this.popupEl!)) {\n    //   (this.popupEl as HTMLElement).parentNode?.removeChild(this.popupEl!);\n    //   this.popupEl = null;\n    // }\n    this.trigger('onDestroy');\n    return true;\n  };\n  /**\n   * isDestroy - 是否已经销毁\n   * @return {boolean}\n   */\n  Popup.prototype.isDestroy = function () {\n    return !this.popupEl;\n  };\n  /**\n   * getId\n   * @return {string} - id\n   */\n  Popup.prototype.getId = function () {\n    return this.id;\n  };\n  /**\n   * onInnerElTransitionend\n   */\n  Popup.prototype.onInnerElTransitionend = function () {\n    if (!this.isShow) {\n      prePopup = null;\n      this.popupEl.style.display = 'none';\n      maskEl.style.display = 'none';\n      this.trigger('onAfterClose');\n    } else {\n      prePopup = this;\n      this.trigger('onAfterShow');\n    }\n  };\n  return Popup;\n}();\n/**\n * PopupFactory\n */\nvar PopupFactory = {\n  /**\n   * create\n   * @param config\n   * @return Popup\n   */\n  create: function create(config) {\n    var ins = new Popup(config);\n    popups.push(ins);\n    return ins;\n  },\n  /**\n   * show - 显示一个popup\n   * @param popup\n   * @return boolean\n   */\n  show: function show(popup) {\n    if (!popup) return false;\n    if (popup.isDestroy()) return false;\n    if (popup === prePopup) return false;\n    if (prePopup && popup.getId() === prePopup.getId()) return false;\n    return popup.show();\n  },\n  /**\n   * showClosePrePopup\n   * @description 关闭之前的显示\n   * @param popup\n   * @return boolean\n   */\n  showClosePrePopup: function showClosePrePopup(popup) {\n    if (!popup) return false;\n    if (popup.isDestroy()) return false;\n    if (popup === prePopup) return false;\n    if (prePopup && popup.getId() === prePopup.getId()) return false;\n    if (prePopup) {\n      prePopup.close();\n    }\n    return popup.show();\n  },\n  /**\n   * close - 关闭一个popup\n   * @param {Popup} popup\n   * @return boolean\n   */\n  close: function close(popup) {\n    try {\n      if (!popup) return false;\n      if (popup.isDestroy()) return false;\n      return popup.close();\n    } catch (e) {\n      throw e;\n    }\n  },\n  /**\n   * closeAll - 关闭所有\n   * @return boolean\n   */\n  closeAll: function closeAll() {\n    var _this = this;\n    var flags = [];\n    popups.forEach(function (p) {\n      var flag = _this.close(p);\n      flags.push(flag);\n    });\n    return flags.every(function (flag) {\n      return flag;\n    });\n  },\n  /**\n   * destroy - 销毁一个popup\n   * @param {Popup} popup\n   * @return bool\n   */\n  destroy: function destroy(popup) {\n    if (!popup) return false;\n    if (popup.isDestroy()) return false;\n    var res = popup.destroy();\n    if (res) {\n      var index = popups.findIndex(function (p) {\n        return p === popup;\n      });\n      if (index !== -1) {\n        popups.splice(index, 1);\n      }\n    }\n    return res;\n  },\n  /**\n   * getEl\n   * @return {HTMLElement}\n   */\n  getEl: function getEl() {\n    return el || document.body;\n  },\n  /**\n   * setEl\n   * @param tel\n   */\n  setEl: function setEl(tel) {\n    el = tel;\n  },\n  /**\n   * Trigger\n   */\n  Trigger: Trigger,\n  /**\n   * TriggerPrompt\n   */\n  TriggerPrompt: TriggerPrompt\n};\nexport default PopupFactory;"],"names":["React","ReactDOM","v1","Util","Trigger","TriggerPrompt","maskEl","selectorPrefix","prePopup","popups","el","Popup","config","this","id","isShow","popupEl","popupHandlers","WeakMap","PopupFactory","getEl","onInnerElTransitionend","bind","render","prototype","createMask","zIndex","document","createElement","className","concat","style","String","appendChild","_this","_a","children","root","addEventListener","createRoot","cloneElement","ref","configProviderEL","getTopDom","cssText","trigger","set","hookName","_b","_c","call","show","display","setTimeout","classList","add","showClosePrePopup","close","promise","then","Function","remove","e","destroy","get","unmount","isDestroy","getId","create","ins","push","popup","closeAll","flags","forEach","p","flag","every","res","index","findIndex","splice","body","setEl","tel"],"mappings":"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"}