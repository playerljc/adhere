var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var n,r=1,t=arguments.length;r<t;r++)for(var c in n=arguments[r])Object.prototype.hasOwnProperty.call(n,c)&&(e[c]=n[c]);return e}).apply(this,arguments)};import{LeftOutline}from"antd-mobile-icons";import classNames from"classnames";import debounce from"lodash.debounce";import{forwardRef,useImperativeHandle}from"react";import React,{useEffect,useMemo,useRef}from"react";import Intl from"@baifendian/adhere-util-intl";import Popup from"./Popup";import SubmitButton from"./SubmitButton";var selectorPrefix="adhere-ui-popup",triggerSelectorPrefix="".concat(selectorPrefix,"-trigger"),triggerSelectorInnerPrefix="".concat(triggerSelectorPrefix,"-inner"),Trigger=forwardRef(function(e,n){var r=e.className,t=e.style,c=e.renderTrigger,l=e.popupConfig,o=e.title,i=e.closeIcon,a=void 0===i||i,s=e.extra,u=e.actions,i=e.isShowCloseAction,f=void 0===i||i,i=e.closeActionPosition,m=void 0===i?"start":i,g=e.children,d=e.value,i=e.disabled,v=void 0!==i&&i,p=e.onChange,P=e.beforeTrigger,h=useRef(),N=useMemo(function(){return g?React.cloneElement(g,__assign(__assign({},g.props),{value:d}),g.props.children):null},[g,d]),R=useMemo(function(){var e=null==(e=(n=null!=u?u:[]).map)?void 0:e.call(n,function(e){return React.createElement("div",{key:e.key,className:classNames("".concat(triggerSelectorInnerPrefix,"-action"))},React.createElement(SubmitButton,__assign({},null!=e?e:{},{onClick:function(){return t=e.onClick,c=function(){var e;return null==(e=null==h?void 0:h.current)?void 0:e.close()},new Promise(function(n,r){var e;null!=(e=null==t?void 0:t())&&e.then(function(e){null!=p&&p(e),setTimeout(function(){n(e),null!=c&&c()},400)}).catch(function(e){return r(e)})});var t,c}})))}),n=f&&React.createElement("div",{key:"close",className:classNames("".concat(triggerSelectorInnerPrefix,"-action"))},React.createElement(SubmitButton,{key:"close",onClick:function(){return new Promise(function(e){setTimeout(function(){var e;null!=(e=h.current)&&e.close()},100),e()})}},Intl.v("关闭")));return n&&["start","end"].includes(m)&&("start"===m?e.unshift(n):e.push(n)),e},[u,f,m]),x=useMemo(function(){return React.createElement("div",{className:classNames(triggerSelectorInnerPrefix)},React.createElement("div",{className:classNames("".concat(triggerSelectorInnerPrefix,"-header"))},React.createElement("div",{className:"".concat(triggerSelectorInnerPrefix,"-close"),onClick:function(){var e;null!=(e=h.current)&&e.close()}},a&&React.createElement("span",{className:"".concat(triggerSelectorInnerPrefix,"-close-inner")},React.createElement(LeftOutline,null))),o&&React.createElement("div",{className:"".concat(triggerSelectorInnerPrefix,"-title")},o),s&&React.createElement("div",{className:"".concat(triggerSelectorInnerPrefix,"-extra")},s)),React.createElement("div",{className:classNames("".concat(triggerSelectorInnerPrefix,"-body"))},N),R.length?React.createElement("div",{className:classNames("".concat(triggerSelectorInnerPrefix,"-actions"))},R):null)},[N,o,s,a,R]);return useEffect(function(){var e;try{null!=(e=h.current)&&e.update(x)}catch(e){}}),useImperativeHandle(n,function(){return{close:function(){h.current.close()}}}),React.createElement("div",{className:classNames(triggerSelectorPrefix,null!=r?r:""),style:null!=t?t:{},onClick:debounce(function(){function e(){var e;h.current=Popup.create(__assign(__assign({},null!=l?l:{}),{onBeforeClose:function(){var e,n;return null!=(n=null==(n=null==(e=null!=l?l:{})?void 0:e.onBeforeClose)?void 0:n.call(e))?n:Promise.resolve()},onAfterClose:function(){var e,n;return null!=(n=null==(n=null==(e=null!=l?l:{})?void 0:e.onAfterClose)?void 0:n.call(e))?n:Popup.destroy(h.current)},children:x})),null!=(e=h.current)&&e.show()}v||(P?P().then(function(){e()}):e())},200)},null==c?void 0:c())});Trigger.displayName="Trigger";export default Trigger;
//# sourceMappingURL=Trigger.js.map
