var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var c in t=arguments[n])Object.prototype.hasOwnProperty.call(t,c)&&(e[c]=t[c]);return e}).apply(this,arguments)};import{LeftOutline}from"antd-mobile-icons";import classNames from"classnames";import debounce from"lodash.debounce";import React,{useEffect,useMemo,useRef}from"react";import Intl from"@baifendian/adhere-util-intl";import Popup from"./Popup";import SubmitButton from"./SubmitButton";var selectorPrefix="adhere-ui-popup",triggerSelectorPrefix="".concat(selectorPrefix,"-trigger"),triggerSelectorInnerPrefix="".concat(triggerSelectorPrefix,"-inner"),Trigger=function(e){var t=e.className,n=e.style,r=e.renderTrigger,c=e.popupConfig,l=e.title,o=e.closeIcon,i=void 0===o||o,a=e.extra,s=e.actions,o=e.isShowCloseAction,u=void 0===o||o,o=e.closeActionPosition,m=void 0===o?"start":o,f=e.children,g=e.value,o=e.disabled,d=void 0!==o&&o,v=e.onChange,p=useRef(),P=useMemo(function(){return f?React.cloneElement(f,__assign(__assign({},f.props),{value:g}),f.props.children):null},[f,g]),h=useMemo(function(){var e=null==(e=(t=null!=s?s:[]).map)?void 0:e.call(t,function(e){return React.createElement("div",{key:e.key,className:classNames("".concat(triggerSelectorInnerPrefix,"-action"))},React.createElement(SubmitButton,__assign({},null!=e?e:{},{onClick:function(){return r=e.onClick,c=function(){var e;return null==(e=null==p?void 0:p.current)?void 0:e.close()},new Promise(function(t,n){var e;null!=(e=null==r?void 0:r())&&e.then(function(e){null!=v&&v(e),setTimeout(function(){t(e),null!=c&&c()},400)}).catch(function(e){return n(e)})});var r,c}})))}),t=u&&React.createElement("div",{key:"close",className:classNames("".concat(triggerSelectorInnerPrefix,"-action"))},React.createElement(SubmitButton,{key:"close",onClick:function(){return new Promise(function(e){setTimeout(function(){var e;null!=(e=p.current)&&e.close()},100),e()})}},Intl.v("关闭")));return t&&["start","end"].includes(m)&&("start"===m?e.unshift(t):e.push(t)),e},[s,u,m]),N=useMemo(function(){return React.createElement("div",{className:classNames(triggerSelectorInnerPrefix)},React.createElement("div",{className:classNames("".concat(triggerSelectorInnerPrefix,"-header"))},React.createElement("div",{className:"".concat(triggerSelectorInnerPrefix,"-close"),onClick:function(){var e;null!=(e=p.current)&&e.close()}},i&&React.createElement("span",{className:"".concat(triggerSelectorInnerPrefix,"-close-inner")},React.createElement(LeftOutline,null))),l&&React.createElement("div",{className:"".concat(triggerSelectorInnerPrefix,"-title")},l),a&&React.createElement("div",{className:"".concat(triggerSelectorInnerPrefix,"-extra")},a)),React.createElement("div",{className:classNames("".concat(triggerSelectorInnerPrefix,"-body"))},P),h.length?React.createElement("div",{className:classNames("".concat(triggerSelectorInnerPrefix,"-actions"))},h):null)},[P,l,a,i,h]);return useEffect(function(){var e;try{null!=(e=p.current)&&e.update(N)}catch(e){}}),React.createElement("div",{className:classNames(triggerSelectorPrefix,null!=t?t:""),style:null!=n?n:{},onClick:debounce(function(){var e;d||(p.current=Popup.create(__assign(__assign({},null!=c?c:{}),{onBeforeClose:function(){var e,t;return null!=(t=null==(t=null==(e=null!=c?c:{})?void 0:e.onBeforeClose)?void 0:t.call(e))?t:Promise.resolve()},onAfterClose:function(){var e,t;return null!=(t=null==(t=null==(e=null!=c?c:{})?void 0:e.onAfterClose)?void 0:t.call(e))?t:Popup.destroy(p.current)},children:N})),null!=(e=p.current)&&e.show())},200)},null==r?void 0:r())};Trigger.displayName="Trigger";export default Trigger;
//# sourceMappingURL=Trigger.js.map
