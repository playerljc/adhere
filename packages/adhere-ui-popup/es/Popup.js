import React from"react";import ReactDOM from"react-dom/client";import{v1}from"uuid";import Util from"@baifendian/adhere-util";import Trigger from"./Trigger";import TriggerPrompt from"./TriggerPrompt";var maskEl,selectorPrefix="adhere-ui-popup",prePopup=null,popups=[],el=null,Popup=function(){function t(t){this.id="",this.config=null,this.isShow=!1,this.el=null,this.popupEl=null,this.root=null,this.popupHandlers=new WeakMap,this.isShow=!1,this.el=PopupFactory.getEl(),this.id=v1(),this.config=t,this.onInnerElTransitionend=this.onInnerElTransitionend.bind(this),this.render()}return t.prototype.createMask=function(){var t=this.config.zIndex;(maskEl=document.createElement("div")).className="".concat(selectorPrefix,"-mask"),maskEl.style.zIndex=String((t||11e3)-1500),this.el.appendChild(maskEl)},t.prototype.render=function(){var o=this,t=this.config,e=t.children,t=t.zIndex;this.popupEl=document.createElement("div"),this.popupEl.addEventListener("transitionend",this.onInnerElTransitionend),this.popupEl.className=selectorPrefix,this.popupEl.style.zIndex=String(t||11e3),this.root=ReactDOM.createRoot(this.popupEl),this.root.render(React.cloneElement(e,{ref:function(){o.el.appendChild(o.popupEl);var t=Util.getTopDom(o.popupEl,"adhere-ui-config-provider");t&&(o.popupEl.style.cssText=null==(t=null==t?void 0:t.style)?void 0:t.cssText),o.trigger("onCreate")}})),this.popupHandlers.set(this.popupEl,this.root)},t.prototype.trigger=function(t){var o;return null==(o=this.config)||!o[t]||null==(t=null==(o=null==this?void 0:this.config)?void 0:o[t])?void 0:t.call(o)},t.prototype.update=function(t){var o,e=this,i=this.config.children;console.log("update"),null!=(o=this.root)&&o.render(React.cloneElement(null!=t?t:i,{ref:function(){e.el.appendChild(e.popupEl);var t=Util.getTopDom(e.popupEl,"adhere-ui-config-provider");t&&(e.popupEl.style.cssText=null==(t=null==t?void 0:t.style)?void 0:t.cssText),e.trigger("onUpdate")}}))},t.prototype.show=function(){var t=this;return maskEl||this.createMask(),maskEl.style.display="block",this.popupEl.style.display="block",this.isShow=!0,this.trigger("onBeforeShow"),setTimeout(function(){maskEl.classList.add("modal-in"),t.popupEl.classList.add("modal-in")},100),!0},t.prototype.showClosePrePopup=function(){var t=this;return maskEl||this.createMask(),prePopup&&prePopup.close(),maskEl.style.display="block",this.popupEl.style.display="block",this.isShow=!0,this.trigger("onBeforeShow"),setTimeout(function(){maskEl.classList.add("modal-in"),t.popupEl.classList.add("modal-in")},100),!0},t.prototype.close=function(){var t=this,o=(maskEl||this.createMask(),this.isShow=!1,this.trigger("onBeforeClose"));return o&&"then"in o&&o.then instanceof Function?o.then(function(){try{t.popupEl.classList.remove("modal-in")}catch(t){throw t}maskEl.classList.remove("modal-in")}):(this.popupEl.classList.remove("modal-in"),maskEl.classList.remove("modal-in")),!0},t.prototype.destroy=function(){var t;return this.popupEl&&((t=this.popupHandlers.get(this.popupEl))&&t.unmount(),this.popupEl=null),this.trigger("onDestroy"),!0},t.prototype.isDestroy=function(){return!this.popupEl},t.prototype.getId=function(){return this.id},t.prototype.onInnerElTransitionend=function(){this.isShow?(prePopup=this).trigger("onAfterShow"):(prePopup=null,this.popupEl.style.display="none",maskEl.style.display="none",this.trigger("onAfterClose"))},t}(),PopupFactory={create:function(t){t=new Popup(t);return popups.push(t),t},show:function(t){return!!t&&!(t.isDestroy()||t===prePopup||prePopup&&t.getId()===prePopup.getId())&&t.show()},showClosePrePopup:function(t){return!!t&&!(t.isDestroy()||t===prePopup||prePopup&&t.getId()===prePopup.getId())&&(prePopup&&prePopup.close(),t.show())},close:function(t){try{return t?!t.isDestroy()&&t.close():!1}catch(t){throw t}},closeAll:function(){var o=this,e=[];return popups.forEach(function(t){t=o.close(t);e.push(t)}),e.every(function(t){return t})},destroy:function(o){var t,e;return!!o&&!o.isDestroy()&&((t=o.destroy())&&-1!==(e=popups.findIndex(function(t){return t===o}))&&popups.splice(e,1),t)},getEl:function(){return el||document.body},setEl:function(t){el=t},Trigger:Trigger,TriggerPrompt:TriggerPrompt};export default PopupFactory;export{Popup};
//# sourceMappingURL=Popup.js.map
