{"version":3,"file":"popup.js","sources":["popup.js"],"sourcesContent":["\"use strict\";\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n// @ts-ignore\r\nvar react_dom_1 = __importDefault(require(\"react-dom\"));\r\nvar uuid_1 = require(\"uuid\");\r\nvar selectorPrefix = 'adhere-ui-popup';\r\n// @ts-ignore\r\nvar prePopup;\r\nvar maskEl;\r\nvar el = document.body;\r\n/**\r\n * Popup\r\n * @class Popup\r\n * @classdesc Popup\r\n */\r\nvar Popup = /** @class */ (function () {\r\n    /**\r\n     * constructor\r\n     * @param config {Object} - config\r\n     */\r\n    function Popup(config) {\r\n        this.id = '';\r\n        this.config = null;\r\n        this.isShow = false;\r\n        this.el = null;\r\n        this.popupEl = null;\r\n        this.isShow = false;\r\n        this.el = el;\r\n        this.id = uuid_1.v1();\r\n        this.config = config;\r\n        this.onMaskElTransitionend = this.onMaskElTransitionend.bind(this);\r\n        this.onInnerElTransitionend = this.onInnerElTransitionend.bind(this);\r\n        this.render();\r\n    }\r\n    /**\r\n     * createMask\r\n     */\r\n    Popup.prototype.createMask = function () {\r\n        // @ts-ignore\r\n        var zIndex = this.config.zIndex;\r\n        maskEl = document.createElement('div');\r\n        maskEl.className = selectorPrefix + \"-mask\";\r\n        maskEl.style.zIndex = String((zIndex || 11000) - 1500);\r\n        el.appendChild(maskEl);\r\n        maskEl.addEventListener('transitionend', this.onMaskElTransitionend);\r\n    };\r\n    /**\r\n     * render\r\n     */\r\n    Popup.prototype.render = function () {\r\n        var _this = this;\r\n        // @ts-ignore\r\n        var _a = this.config, children = _a.children, zIndex = _a.zIndex;\r\n        this.popupEl = document.createElement('div');\r\n        this.popupEl.addEventListener('transitionend', this.onInnerElTransitionend);\r\n        this.popupEl.className = selectorPrefix;\r\n        this.popupEl.style.zIndex = String(zIndex || 11000);\r\n        react_dom_1.default.render(children, this.popupEl, function () {\r\n            // @ts-ignore\r\n            _this.el.appendChild(_this.popupEl);\r\n            _this.trigger('onCreate');\r\n        });\r\n    };\r\n    /**\r\n     * trigger\r\n     * @param hookName\r\n     */\r\n    Popup.prototype.trigger = function (hookName) {\r\n        // @ts-ignore\r\n        if (this.config[hookName]) {\r\n            // @ts-ignore\r\n            return this.config[hookName]();\r\n        }\r\n    };\r\n    /**\r\n     * show - 显示一个popup\r\n     * @return boolean\r\n     */\r\n    Popup.prototype.show = function () {\r\n        var _this = this;\r\n        if (!maskEl) {\r\n            this.createMask();\r\n        }\r\n        if (prePopup) {\r\n            prePopup.close();\r\n        }\r\n        maskEl.style.display = 'block';\r\n        // @ts-ignore\r\n        this.popupEl.style.display = 'block';\r\n        this.isShow = true;\r\n        this.trigger('onBeforeShow');\r\n        setTimeout(function () {\r\n            maskEl.classList.add('modal-in');\r\n            // @ts-ignore\r\n            _this.popupEl.classList.add('modal-in');\r\n        }, 100);\r\n        return true;\r\n    };\r\n    /**\r\n     * close - 关闭一个popup\r\n     * @return boolean\r\n     */\r\n    Popup.prototype.close = function () {\r\n        var _this = this;\r\n        if (!maskEl) {\r\n            this.createMask();\r\n        }\r\n        this.isShow = false;\r\n        var promise = this.trigger('onBeforeClose');\r\n        // @ts-ignore\r\n        if (promise) {\r\n            promise.then(function () {\r\n                // @ts-ignore\r\n                _this.popupEl.classList.remove('modal-in');\r\n                maskEl.classList.remove('modal-in');\r\n            });\r\n        }\r\n        else {\r\n            // @ts-ignore\r\n            this.popupEl.classList.remove('modal-in');\r\n            maskEl.classList.remove('modal-in');\r\n        }\r\n        return true;\r\n    };\r\n    /**\r\n     * destroy - 销毁一个popup\r\n     */\r\n    Popup.prototype.destroy = function () {\r\n        // @ts-ignore\r\n        if (react_dom_1.default.unmountComponentAtNode(this.popupEl)) {\r\n            // @ts-ignore\r\n            this.popupEl.parentNode.removeChild(this.popupEl);\r\n            this.popupEl = null;\r\n        }\r\n        this.trigger('onDestroy');\r\n        return true;\r\n    };\r\n    /**\r\n     * isDestroy - 是否已经销毁\r\n     * @return {boolean}\r\n     */\r\n    Popup.prototype.isDestroy = function () {\r\n        return !this.popupEl;\r\n    };\r\n    /**\r\n     * getId\r\n     * @return {string} - id\r\n     */\r\n    Popup.prototype.getId = function () {\r\n        return this.id;\r\n    };\r\n    /**\r\n     * onInnerElTransitionend\r\n     */\r\n    Popup.prototype.onInnerElTransitionend = function () {\r\n        if (!this.isShow) {\r\n            prePopup = null;\r\n            // @ts-ignore\r\n            this.popupEl.style.display = 'none';\r\n            this.trigger('onAfterClose');\r\n        }\r\n        else {\r\n            prePopup = this;\r\n            this.trigger('onAfterShow');\r\n        }\r\n    };\r\n    /**\r\n     * onMaskElTransitionend\r\n     */\r\n    Popup.prototype.onMaskElTransitionend = function () {\r\n        if (!this.isShow) {\r\n            maskEl.style.display = 'none';\r\n        }\r\n    };\r\n    return Popup;\r\n}());\r\n/**\r\n * PopupFactory\r\n */\r\nvar PopupFactory = {\r\n    /**\r\n     * create\r\n     * @param config\r\n     * @return Popup\r\n     */\r\n    create: function (config) {\r\n        return new Popup(config);\r\n    },\r\n    /**\r\n     * show - 显示一个popup\r\n     * @param popup\r\n     * @return boolean\r\n     */\r\n    show: function (popup) {\r\n        if (!popup)\r\n            return false;\r\n        if (popup.isDestroy())\r\n            return false;\r\n        if (popup === prePopup)\r\n            return false;\r\n        if (prePopup && popup.getId() === prePopup.getId())\r\n            return false;\r\n        return popup.show();\r\n    },\r\n    /**\r\n     * close - 关闭一个popup\r\n     * @param {Popup} popup\r\n     * @return boolean\r\n     */\r\n    close: function (popup) {\r\n        if (!popup)\r\n            return false;\r\n        if (popup.isDestroy())\r\n            return false;\r\n        return popup.close();\r\n    },\r\n    /**\r\n     * closeAll - 关闭所有\r\n     * @return boolean\r\n     */\r\n    closeAll: function () {\r\n        if (prePopup) {\r\n            return this.close(prePopup);\r\n        }\r\n        return false;\r\n    },\r\n    /**\r\n     * destroy - 销毁一个popup\r\n     * @param {Popup} popup\r\n     * @return bool\r\n     */\r\n    destroy: function (popup) {\r\n        if (!popup)\r\n            return false;\r\n        if (popup.isDestroy())\r\n            return false;\r\n        return popup.destroy();\r\n    },\r\n    /**\r\n     * getEl\r\n     * @return {HTMLElement}\r\n     */\r\n    getEl: function () {\r\n        return el;\r\n    },\r\n    /**\r\n     * setEl\r\n     * @param tel\r\n     */\r\n    setEl: function (tel) {\r\n        el = tel;\r\n    },\r\n};\r\nexports.default = PopupFactory;\r\n"],"names":["__importDefault","this","mod","__esModule","default","Object","defineProperty","exports","value","prePopup","maskEl","react_dom_1","require","uuid_1","selectorPrefix","el","document","body","Popup","config","id","isShow","popupEl","v1","onMaskElTransitionend","bind","onInnerElTransitionend","render","prototype","createMask","zIndex","createElement","className","style","String","appendChild","addEventListener","_this","_a","children","trigger","hookName","show","close","display","setTimeout","classList","add","promise","then","remove","destroy","unmountComponentAtNode","parentNode","removeChild","isDestroy","getId","PopupFactory","create","popup","closeAll","getEl","setEl","tel"],"mappings":"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"}