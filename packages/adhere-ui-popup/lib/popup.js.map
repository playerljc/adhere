{"version":3,"file":"popup.js","sources":["popup.js"],"sourcesContent":["\"use strict\";\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar react_dom_1 = __importDefault(require(\"react-dom\"));\r\nvar uuid_1 = require(\"uuid\");\r\nvar selectorPrefix = 'adhere-ui-popup';\r\nvar prePopup = null;\r\nvar popups = [];\r\nvar maskEl;\r\nvar el = null;\r\n/**\r\n * Popup\r\n * @class Popup\r\n * @classdesc Popup\r\n */\r\nvar Popup = /** @class */ (function () {\r\n    /**\r\n     * constructor\r\n     * @param config {Object} - config\r\n     */\r\n    function Popup(config) {\r\n        this.id = '';\r\n        this.config = null;\r\n        this.isShow = false;\r\n        this.el = null;\r\n        this.popupEl = null;\r\n        this.isShow = false;\r\n        this.el = PopupFactory.getEl();\r\n        this.id = uuid_1.v1();\r\n        this.config = config;\r\n        this.onMaskElTransitionend = this.onMaskElTransitionend.bind(this);\r\n        this.onInnerElTransitionend = this.onInnerElTransitionend.bind(this);\r\n        this.render();\r\n    }\r\n    /**\r\n     * createMask\r\n     */\r\n    Popup.prototype.createMask = function () {\r\n        var zIndex = this.config.zIndex;\r\n        maskEl = document.createElement('div');\r\n        maskEl.className = selectorPrefix + \"-mask\";\r\n        maskEl.style.zIndex = String((zIndex || 11000) - 1500);\r\n        this.el.appendChild(maskEl);\r\n        maskEl.addEventListener('transitionend', this.onMaskElTransitionend);\r\n    };\r\n    /**\r\n     * render\r\n     */\r\n    Popup.prototype.render = function () {\r\n        var _this = this;\r\n        var _a = this.config, children = _a.children, zIndex = _a.zIndex;\r\n        this.popupEl = document.createElement('div');\r\n        this.popupEl.addEventListener('transitionend', this.onInnerElTransitionend);\r\n        this.popupEl.className = selectorPrefix;\r\n        this.popupEl.style.zIndex = String(zIndex || 11000);\r\n        react_dom_1.default.render(children, this.popupEl, function () {\r\n            _this.el.appendChild(_this.popupEl);\r\n            _this.trigger('onCreate');\r\n        });\r\n    };\r\n    /**\r\n     * trigger\r\n     * @param hookName\r\n     */\r\n    Popup.prototype.trigger = function (hookName) {\r\n        var _a;\r\n        if ((_a = this.config) === null || _a === void 0 ? void 0 : _a[hookName]) {\r\n            return this.config[hookName]();\r\n        }\r\n    };\r\n    /**\r\n     * show - 显示一个popup\r\n     * @return boolean\r\n     */\r\n    Popup.prototype.show = function () {\r\n        var _this = this;\r\n        if (!maskEl) {\r\n            this.createMask();\r\n        }\r\n        // if (prePopup) {\r\n        //   prePopup.close();\r\n        // }\r\n        maskEl.style.display = 'block';\r\n        this.popupEl.style.display = 'block';\r\n        this.isShow = true;\r\n        this.trigger('onBeforeShow');\r\n        setTimeout(function () {\r\n            maskEl.classList.add('modal-in');\r\n            _this.popupEl.classList.add('modal-in');\r\n        }, 100);\r\n        return true;\r\n    };\r\n    /**\r\n     * show - 显示一个popup\r\n     * @return boolean\r\n     */\r\n    Popup.prototype.showClosePrePopup = function () {\r\n        var _this = this;\r\n        if (!maskEl) {\r\n            this.createMask();\r\n        }\r\n        if (prePopup) {\r\n            prePopup.close();\r\n        }\r\n        maskEl.style.display = 'block';\r\n        this.popupEl.style.display = 'block';\r\n        this.isShow = true;\r\n        this.trigger('onBeforeShow');\r\n        setTimeout(function () {\r\n            maskEl.classList.add('modal-in');\r\n            _this.popupEl.classList.add('modal-in');\r\n        }, 100);\r\n        return true;\r\n    };\r\n    /**\r\n     * close - 关闭一个popup\r\n     * @return boolean\r\n     */\r\n    Popup.prototype.close = function () {\r\n        var _this = this;\r\n        if (!maskEl) {\r\n            this.createMask();\r\n        }\r\n        this.isShow = false;\r\n        var promise = this.trigger('onBeforeClose');\r\n        if (promise && 'then' in promise && promise.then instanceof Function) {\r\n            promise.then(function () {\r\n                _this.popupEl.classList.remove('modal-in');\r\n                maskEl.classList.remove('modal-in');\r\n            });\r\n        }\r\n        else {\r\n            this.popupEl.classList.remove('modal-in');\r\n            maskEl.classList.remove('modal-in');\r\n        }\r\n        return true;\r\n    };\r\n    /**\r\n     * destroy - 销毁一个popup\r\n     */\r\n    Popup.prototype.destroy = function () {\r\n        var _a;\r\n        if (react_dom_1.default.unmountComponentAtNode(this.popupEl)) {\r\n            (_a = this.popupEl.parentNode) === null || _a === void 0 ? void 0 : _a.removeChild(this.popupEl);\r\n            this.popupEl = null;\r\n        }\r\n        this.trigger('onDestroy');\r\n        return true;\r\n    };\r\n    /**\r\n     * isDestroy - 是否已经销毁\r\n     * @return {boolean}\r\n     */\r\n    Popup.prototype.isDestroy = function () {\r\n        return !this.popupEl;\r\n    };\r\n    /**\r\n     * getId\r\n     * @return {string} - id\r\n     */\r\n    Popup.prototype.getId = function () {\r\n        return this.id;\r\n    };\r\n    /**\r\n     * onInnerElTransitionend\r\n     */\r\n    Popup.prototype.onInnerElTransitionend = function () {\r\n        if (!this.isShow) {\r\n            prePopup = null;\r\n            this.popupEl.style.display = 'none';\r\n            this.trigger('onAfterClose');\r\n        }\r\n        else {\r\n            prePopup = this;\r\n            this.trigger('onAfterShow');\r\n        }\r\n    };\r\n    /**\r\n     * onMaskElTransitionend\r\n     */\r\n    Popup.prototype.onMaskElTransitionend = function () {\r\n        if (!this.isShow) {\r\n            maskEl.style.display = 'none';\r\n        }\r\n    };\r\n    return Popup;\r\n}());\r\n/**\r\n * PopupFactory\r\n */\r\nvar PopupFactory = {\r\n    /**\r\n     * create\r\n     * @param config\r\n     * @return Popup\r\n     */\r\n    create: function (config) {\r\n        var ins = new Popup(config);\r\n        popups.push(ins);\r\n        return ins;\r\n    },\r\n    /**\r\n     * show - 显示一个popup\r\n     * @param popup\r\n     * @return boolean\r\n     */\r\n    show: function (popup) {\r\n        if (!popup)\r\n            return false;\r\n        if (popup.isDestroy())\r\n            return false;\r\n        if (popup === prePopup)\r\n            return false;\r\n        if (prePopup && popup.getId() === prePopup.getId())\r\n            return false;\r\n        return popup.show();\r\n    },\r\n    /**\r\n     * showClosePrePopup\r\n     * @description 关闭之前的显示\r\n     * @param popup\r\n     * @return boolean\r\n     */\r\n    showClosePrePopup: function (popup) {\r\n        if (!popup)\r\n            return false;\r\n        if (popup.isDestroy())\r\n            return false;\r\n        if (popup === prePopup)\r\n            return false;\r\n        if (prePopup && popup.getId() === prePopup.getId())\r\n            return false;\r\n        if (prePopup) {\r\n            prePopup.close();\r\n        }\r\n        return popup.show();\r\n    },\r\n    /**\r\n     * close - 关闭一个popup\r\n     * @param {Popup} popup\r\n     * @return boolean\r\n     */\r\n    close: function (popup) {\r\n        if (!popup)\r\n            return false;\r\n        if (popup.isDestroy())\r\n            return false;\r\n        return popup.close();\r\n    },\r\n    /**\r\n     * closeAll - 关闭所有\r\n     * @return boolean\r\n     */\r\n    closeAll: function () {\r\n        var _this = this;\r\n        var flags = [];\r\n        popups.forEach(function (p) {\r\n            var flag = _this.close(p);\r\n            flags.push(flag);\r\n        });\r\n        return flags.every(function (flag) { return flag; });\r\n    },\r\n    /**\r\n     * destroy - 销毁一个popup\r\n     * @param {Popup} popup\r\n     * @return bool\r\n     */\r\n    destroy: function (popup) {\r\n        if (!popup)\r\n            return false;\r\n        if (popup.isDestroy())\r\n            return false;\r\n        var res = popup.destroy();\r\n        if (res) {\r\n            var index = popups.findIndex(function (p) { return p === popup; });\r\n            if (index !== -1) {\r\n                popups.splice(index, 1);\r\n            }\r\n        }\r\n        return res;\r\n    },\r\n    /**\r\n     * getEl\r\n     * @return {HTMLElement}\r\n     */\r\n    getEl: function () {\r\n        return el || document.body;\r\n    },\r\n    /**\r\n     * setEl\r\n     * @param tel\r\n     */\r\n    setEl: function (tel) {\r\n        el = tel;\r\n    },\r\n};\r\nexports.default = PopupFactory;\r\n"],"names":["__importDefault","this","mod","__esModule","default","Object","defineProperty","exports","value","maskEl","react_dom_1","require","uuid_1","selectorPrefix","prePopup","popups","el","Popup","config","id","isShow","popupEl","PopupFactory","getEl","v1","onMaskElTransitionend","bind","onInnerElTransitionend","render","prototype","createMask","zIndex","document","createElement","className","style","String","appendChild","addEventListener","_this","_a","children","trigger","hookName","show","display","setTimeout","classList","add","showClosePrePopup","close","promise","then","Function","remove","destroy","unmountComponentAtNode","parentNode","removeChild","isDestroy","getId","create","ins","push","popup","closeAll","flags","forEach","p","flag","every","index","res","findIndex","splice","body","setEl","tel"],"mappings":"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"}