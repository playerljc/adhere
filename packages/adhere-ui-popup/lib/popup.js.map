{"version":3,"file":"popup.js","sources":["popup.js"],"sourcesContent":["\"use strict\";\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar react_1 = __importDefault(require(\"react\"));\r\nvar client_1 = __importDefault(require(\"react-dom/client\"));\r\nvar uuid_1 = require(\"uuid\");\r\nvar selectorPrefix = 'adhere-ui-popup';\r\nvar prePopup = null;\r\nvar popups = [];\r\nvar maskEl;\r\nvar el = null;\r\n/**\r\n * Popup\r\n * @class Popup\r\n * @classdesc Popup\r\n */\r\nvar Popup = /** @class */ (function () {\r\n    /**\r\n     * constructor\r\n     * @param config {Object} - config\r\n     */\r\n    function Popup(config) {\r\n        this.id = '';\r\n        this.config = null;\r\n        this.isShow = false;\r\n        this.el = null;\r\n        this.popupEl = null;\r\n        this.popupHandlers = new WeakMap();\r\n        this.isShow = false;\r\n        this.el = PopupFactory.getEl();\r\n        this.id = (0, uuid_1.v1)();\r\n        this.config = config;\r\n        this.onInnerElTransitionend = this.onInnerElTransitionend.bind(this);\r\n        this.render();\r\n    }\r\n    /**\r\n     * createMask\r\n     */\r\n    Popup.prototype.createMask = function () {\r\n        var zIndex = this.config.zIndex;\r\n        maskEl = document.createElement('div');\r\n        maskEl.className = \"\".concat(selectorPrefix, \"-mask\");\r\n        maskEl.style.zIndex = String((zIndex || 11000) - 1500);\r\n        this.el.appendChild(maskEl);\r\n    };\r\n    /**\r\n     * render\r\n     */\r\n    Popup.prototype.render = function () {\r\n        var _this = this;\r\n        var _a = this.config, children = _a.children, zIndex = _a.zIndex;\r\n        this.popupEl = document.createElement('div');\r\n        this.popupEl.addEventListener('transitionend', this.onInnerElTransitionend);\r\n        this.popupEl.className = selectorPrefix;\r\n        this.popupEl.style.zIndex = String(zIndex || 11000);\r\n        var root = client_1.default.createRoot(this.popupEl);\r\n        root.render(react_1.default.cloneElement(children, {\r\n            ref: function () {\r\n                _this.el.appendChild(_this.popupEl);\r\n                _this.trigger('onCreate');\r\n            },\r\n        }));\r\n        this.popupHandlers.set(this.popupEl, root);\r\n    };\r\n    /**\r\n     * trigger\r\n     * @param hookName\r\n     */\r\n    Popup.prototype.trigger = function (hookName) {\r\n        var _a;\r\n        if ((_a = this.config) === null || _a === void 0 ? void 0 : _a[hookName]) {\r\n            return this.config[hookName]();\r\n        }\r\n    };\r\n    /**\r\n     * show - 显示一个popup\r\n     * @return boolean\r\n     */\r\n    Popup.prototype.show = function () {\r\n        var _this = this;\r\n        if (!maskEl) {\r\n            this.createMask();\r\n        }\r\n        // if (prePopup) {\r\n        //   prePopup.close();\r\n        // }\r\n        maskEl.style.display = 'block';\r\n        this.popupEl.style.display = 'block';\r\n        this.isShow = true;\r\n        this.trigger('onBeforeShow');\r\n        setTimeout(function () {\r\n            maskEl.classList.add('modal-in');\r\n            _this.popupEl.classList.add('modal-in');\r\n        }, 100);\r\n        return true;\r\n    };\r\n    /**\r\n     * show - 显示一个popup\r\n     * @return boolean\r\n     */\r\n    Popup.prototype.showClosePrePopup = function () {\r\n        var _this = this;\r\n        if (!maskEl) {\r\n            this.createMask();\r\n        }\r\n        if (prePopup) {\r\n            prePopup.close();\r\n        }\r\n        maskEl.style.display = 'block';\r\n        this.popupEl.style.display = 'block';\r\n        this.isShow = true;\r\n        this.trigger('onBeforeShow');\r\n        setTimeout(function () {\r\n            maskEl.classList.add('modal-in');\r\n            _this.popupEl.classList.add('modal-in');\r\n        }, 100);\r\n        return true;\r\n    };\r\n    /**\r\n     * close - 关闭一个popup\r\n     * @return boolean\r\n     */\r\n    Popup.prototype.close = function () {\r\n        var _this = this;\r\n        if (!maskEl) {\r\n            this.createMask();\r\n        }\r\n        this.isShow = false;\r\n        var promise = this.trigger('onBeforeClose');\r\n        if (promise && 'then' in promise && promise.then instanceof Function) {\r\n            promise.then(function () {\r\n                _this.popupEl.classList.remove('modal-in');\r\n                maskEl.classList.remove('modal-in');\r\n            });\r\n        }\r\n        else {\r\n            this.popupEl.classList.remove('modal-in');\r\n            maskEl.classList.remove('modal-in');\r\n        }\r\n        return true;\r\n    };\r\n    /**\r\n     * destroy - 销毁一个popup\r\n     */\r\n    Popup.prototype.destroy = function () {\r\n        if (this.popupEl) {\r\n            var root = this.popupHandlers.get(this.popupEl);\r\n            if (root) {\r\n                root.unmount();\r\n            }\r\n            this.popupEl = null;\r\n        }\r\n        // if (ReactDOM.unmountComponentAtNode(this.popupEl!)) {\r\n        //   (this.popupEl as HTMLElement).parentNode?.removeChild(this.popupEl!);\r\n        //   this.popupEl = null;\r\n        // }\r\n        this.trigger('onDestroy');\r\n        return true;\r\n    };\r\n    /**\r\n     * isDestroy - 是否已经销毁\r\n     * @return {boolean}\r\n     */\r\n    Popup.prototype.isDestroy = function () {\r\n        return !this.popupEl;\r\n    };\r\n    /**\r\n     * getId\r\n     * @return {string} - id\r\n     */\r\n    Popup.prototype.getId = function () {\r\n        return this.id;\r\n    };\r\n    /**\r\n     * onInnerElTransitionend\r\n     */\r\n    Popup.prototype.onInnerElTransitionend = function () {\r\n        if (!this.isShow) {\r\n            prePopup = null;\r\n            this.popupEl.style.display = 'none';\r\n            maskEl.style.display = 'none';\r\n            this.trigger('onAfterClose');\r\n        }\r\n        else {\r\n            prePopup = this;\r\n            this.trigger('onAfterShow');\r\n        }\r\n    };\r\n    return Popup;\r\n}());\r\n/**\r\n * PopupFactory\r\n */\r\nvar PopupFactory = {\r\n    /**\r\n     * create\r\n     * @param config\r\n     * @return Popup\r\n     */\r\n    create: function (config) {\r\n        var ins = new Popup(config);\r\n        popups.push(ins);\r\n        return ins;\r\n    },\r\n    /**\r\n     * show - 显示一个popup\r\n     * @param popup\r\n     * @return boolean\r\n     */\r\n    show: function (popup) {\r\n        if (!popup)\r\n            return false;\r\n        if (popup.isDestroy())\r\n            return false;\r\n        if (popup === prePopup)\r\n            return false;\r\n        if (prePopup && popup.getId() === prePopup.getId())\r\n            return false;\r\n        return popup.show();\r\n    },\r\n    /**\r\n     * showClosePrePopup\r\n     * @description 关闭之前的显示\r\n     * @param popup\r\n     * @return boolean\r\n     */\r\n    showClosePrePopup: function (popup) {\r\n        if (!popup)\r\n            return false;\r\n        if (popup.isDestroy())\r\n            return false;\r\n        if (popup === prePopup)\r\n            return false;\r\n        if (prePopup && popup.getId() === prePopup.getId())\r\n            return false;\r\n        if (prePopup) {\r\n            prePopup.close();\r\n        }\r\n        return popup.show();\r\n    },\r\n    /**\r\n     * close - 关闭一个popup\r\n     * @param {Popup} popup\r\n     * @return boolean\r\n     */\r\n    close: function (popup) {\r\n        if (!popup)\r\n            return false;\r\n        if (popup.isDestroy())\r\n            return false;\r\n        return popup.close();\r\n    },\r\n    /**\r\n     * closeAll - 关闭所有\r\n     * @return boolean\r\n     */\r\n    closeAll: function () {\r\n        var _this = this;\r\n        var flags = [];\r\n        popups.forEach(function (p) {\r\n            var flag = _this.close(p);\r\n            flags.push(flag);\r\n        });\r\n        return flags.every(function (flag) { return flag; });\r\n    },\r\n    /**\r\n     * destroy - 销毁一个popup\r\n     * @param {Popup} popup\r\n     * @return bool\r\n     */\r\n    destroy: function (popup) {\r\n        if (!popup)\r\n            return false;\r\n        if (popup.isDestroy())\r\n            return false;\r\n        var res = popup.destroy();\r\n        if (res) {\r\n            var index = popups.findIndex(function (p) { return p === popup; });\r\n            if (index !== -1) {\r\n                popups.splice(index, 1);\r\n            }\r\n        }\r\n        return res;\r\n    },\r\n    /**\r\n     * getEl\r\n     * @return {HTMLElement}\r\n     */\r\n    getEl: function () {\r\n        return el || document.body;\r\n    },\r\n    /**\r\n     * setEl\r\n     * @param tel\r\n     */\r\n    setEl: function (tel) {\r\n        el = tel;\r\n    },\r\n};\r\nexports.default = PopupFactory;\r\n"],"names":["maskEl","__importDefault","this","mod","__esModule","default","react_1","Object","defineProperty","exports","value","require","client_1","uuid_1","selectorPrefix","prePopup","popups","el","Popup","config","id","isShow","popupEl","popupHandlers","WeakMap","PopupFactory","getEl","v1","onInnerElTransitionend","bind","render","prototype","createMask","zIndex","document","createElement","className","concat","style","String","appendChild","_this","_a","children","root","addEventListener","createRoot","cloneElement","ref","trigger","set","hookName","show","display","setTimeout","classList","add","showClosePrePopup","close","promise","then","Function","remove","destroy","get","unmount","isDestroy","getId","create","ins","push","popup","closeAll","flags","forEach","p","flag","every","res","index","findIndex","splice","body","setEl","tel"],"mappings":"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"}