{"version":3,"file":"Popup.js","sources":["Popup.js"],"sourcesContent":["\"use strict\";\n\nvar __importDefault = void 0 && (void 0).__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Popup = void 0;\nvar react_1 = __importDefault(require(\"react\"));\nvar client_1 = __importDefault(require(\"react-dom/client\"));\nvar uuid_1 = require(\"uuid\");\nvar adhere_util_1 = __importDefault(require(\"@baifendian/adhere-util\"));\nvar Trigger_1 = __importDefault(require(\"./Trigger\"));\nvar TriggerPrompt_1 = __importDefault(require(\"./TriggerPrompt\"));\nvar selectorPrefix = 'adhere-ui-popup';\nvar prePopup = null;\nvar popups = [];\nvar maskEl;\nvar el = null;\nvar renderToWrapper;\n/**\n * Popup\n * @class Popup\n * @classdesc Popup\n */\nvar Popup = /** @class */function () {\n  /**\n   * constructor\n   * @param config {Object} - config\n   */\n  function Popup(config) {\n    this.id = '';\n    this.config = null;\n    this.isShow = false;\n    this.el = null;\n    this.popupEl = null;\n    this.root = null;\n    this.popupHandlers = new WeakMap();\n    this.isShow = false;\n    this.el = PopupFactory.getEl();\n    this.id = (0, uuid_1.v1)();\n    this.config = config;\n    this.onInnerElTransitionend = this.onInnerElTransitionend.bind(this);\n    this.render();\n  }\n  /**\n   * createMask\n   */\n  Popup.prototype.createMask = function () {\n    var zIndex = this.config.zIndex;\n    maskEl = document.createElement('div');\n    maskEl.className = \"\".concat(selectorPrefix, \"-mask\");\n    maskEl.style.zIndex = String((zIndex || 11000) - 1500);\n    this.el.appendChild(maskEl);\n  };\n  /**\n   * render\n   */\n  Popup.prototype.render = function () {\n    var _this = this;\n    var _a;\n    var _b = this.config,\n      children = _b.children,\n      zIndex = _b.zIndex;\n    this.popupEl = document.createElement('div');\n    this.popupEl.addEventListener('transitionend', this.onInnerElTransitionend);\n    this.popupEl.className = selectorPrefix;\n    this.popupEl.style.zIndex = String(zIndex || 11000);\n    this.root = client_1.default.createRoot(this.popupEl);\n    var element = react_1.default.cloneElement(children, {\n      ref: function () {\n        var _a;\n        _this.el.appendChild(_this.popupEl);\n        var configProviderEL = adhere_util_1.default.getTopDom(_this.popupEl, 'adhere-ui-config-provider');\n        if (configProviderEL) {\n          _this.popupEl.style.cssText = (_a = configProviderEL === null || configProviderEL === void 0 ? void 0 : configProviderEL.style) === null || _a === void 0 ? void 0 : _a.cssText;\n        }\n        _this.trigger('onCreate');\n      }\n    });\n    this.root.render((_a = renderToWrapper === null || renderToWrapper === void 0 ? void 0 : renderToWrapper(function () {\n      return element;\n    })) !== null && _a !== void 0 ? _a : element);\n    this.popupHandlers.set(this.popupEl, this.root);\n  };\n  /**\n   * trigger\n   * @param hookName\n   */\n  Popup.prototype.trigger = function (hookName) {\n    var _a, _b, _c;\n    if ((_a = this.config) === null || _a === void 0 ? void 0 : _a[hookName]) {\n      return (_c = (_b = this === null || this === void 0 ? void 0 : this.config) === null || _b === void 0 ? void 0 : _b[hookName]) === null || _c === void 0 ? void 0 : _c.call(_b);\n    }\n  };\n  Popup.prototype.update = function (_children) {\n    var _this = this;\n    var _a, _b;\n    var children = this.config.children;\n    var element = react_1.default.cloneElement(_children !== null && _children !== void 0 ? _children : children, {\n      ref: function () {\n        var _a;\n        _this.el.appendChild(_this.popupEl);\n        var configProviderEL = adhere_util_1.default.getTopDom(_this.popupEl, 'adhere-ui-config-provider');\n        if (configProviderEL) {\n          _this.popupEl.style.cssText = (_a = configProviderEL === null || configProviderEL === void 0 ? void 0 : configProviderEL.style) === null || _a === void 0 ? void 0 : _a.cssText;\n        }\n        _this.trigger('onUpdate');\n      }\n    });\n    (_a = this.root) === null || _a === void 0 ? void 0 : _a.render((_b = renderToWrapper === null || renderToWrapper === void 0 ? void 0 : renderToWrapper(function () {\n      return element;\n    })) !== null && _b !== void 0 ? _b : element);\n  };\n  /**\n   * show - 显示一个popup\n   * @return boolean\n   */\n  Popup.prototype.show = function () {\n    var _this = this;\n    if (!maskEl) {\n      this.createMask();\n    }\n    // if (prePopup) {\n    //   prePopup.close();\n    // }\n    maskEl.style.display = 'block';\n    this.popupEl.style.display = 'block';\n    this.isShow = true;\n    this.trigger('onBeforeShow');\n    setTimeout(function () {\n      maskEl.classList.add('modal-in');\n      _this.popupEl.classList.add('modal-in');\n    }, 100);\n    return true;\n  };\n  /**\n   * show - 显示一个popup\n   * @return boolean\n   */\n  Popup.prototype.showClosePrePopup = function () {\n    var _this = this;\n    if (!maskEl) {\n      this.createMask();\n    }\n    if (prePopup) {\n      prePopup.close();\n    }\n    maskEl.style.display = 'block';\n    this.popupEl.style.display = 'block';\n    this.isShow = true;\n    this.trigger('onBeforeShow');\n    setTimeout(function () {\n      maskEl.classList.add('modal-in');\n      _this.popupEl.classList.add('modal-in');\n    }, 100);\n    return true;\n  };\n  /**\n   * close - 关闭一个popup\n   * @return boolean\n   */\n  Popup.prototype.close = function () {\n    var _this = this;\n    if (!maskEl) {\n      this.createMask();\n    }\n    this.isShow = false;\n    var promise = this.trigger('onBeforeClose');\n    if (promise && 'then' in promise && promise.then instanceof Function) {\n      promise.then(function () {\n        try {\n          _this.popupEl.classList.remove('modal-in');\n        } catch (e) {\n          throw e;\n        }\n        maskEl.classList.remove('modal-in');\n      });\n    } else {\n      this.popupEl.classList.remove('modal-in');\n      maskEl.classList.remove('modal-in');\n    }\n    return true;\n  };\n  /**\n   * destroy - 销毁一个popup\n   */\n  Popup.prototype.destroy = function () {\n    if (this.popupEl) {\n      var root = this.popupHandlers.get(this.popupEl);\n      if (root) {\n        root.unmount();\n      }\n      this.popupEl = null;\n    }\n    // if (ReactDOM.unmountComponentAtNode(this.popupEl!)) {\n    //   (this.popupEl as HTMLElement).parentNode?.removeChild(this.popupEl!);\n    //   this.popupEl = null;\n    // }\n    this.trigger('onDestroy');\n    return true;\n  };\n  /**\n   * isDestroy - 是否已经销毁\n   * @return {boolean}\n   */\n  Popup.prototype.isDestroy = function () {\n    return !this.popupEl;\n  };\n  /**\n   * getId\n   * @return {string} - id\n   */\n  Popup.prototype.getId = function () {\n    return this.id;\n  };\n  /**\n   * onInnerElTransitionend\n   */\n  Popup.prototype.onInnerElTransitionend = function () {\n    if (!this.isShow) {\n      prePopup = null;\n      this.popupEl.style.display = 'none';\n      maskEl.style.display = 'none';\n      this.trigger('onAfterClose');\n    } else {\n      prePopup = this;\n      this.trigger('onAfterShow');\n    }\n  };\n  return Popup;\n}();\nexports.Popup = Popup;\n/**\n * PopupFactory\n */\nvar PopupFactory = {\n  /**\n   * setRenderToWrapper\n   * @description 设置renderToWrapper方法\n   * @param _renderToWrapper\n   */\n  setRenderToWrapper: function (_renderToWrapper) {\n    renderToWrapper = _renderToWrapper;\n  },\n  /**\n   * create\n   * @param config\n   * @return Popup\n   */\n  create: function (config) {\n    var ins = new Popup(config);\n    popups.push(ins);\n    return ins;\n  },\n  /**\n   * show - 显示一个popup\n   * @param popup\n   * @return boolean\n   */\n  show: function (popup) {\n    if (!popup) return false;\n    if (popup.isDestroy()) return false;\n    if (popup === prePopup) return false;\n    if (prePopup && popup.getId() === prePopup.getId()) return false;\n    return popup.show();\n  },\n  /**\n   * showClosePrePopup\n   * @description 关闭之前的显示\n   * @param popup\n   * @return boolean\n   */\n  showClosePrePopup: function (popup) {\n    if (!popup) return false;\n    if (popup.isDestroy()) return false;\n    if (popup === prePopup) return false;\n    if (prePopup && popup.getId() === prePopup.getId()) return false;\n    if (prePopup) {\n      prePopup.close();\n    }\n    return popup.show();\n  },\n  /**\n   * close - 关闭一个popup\n   * @param {Popup} popup\n   * @return boolean\n   */\n  close: function (popup) {\n    try {\n      if (!popup) return false;\n      if (popup.isDestroy()) return false;\n      return popup.close();\n    } catch (e) {\n      throw e;\n    }\n  },\n  /**\n   * closeAll - 关闭所有\n   * @return boolean\n   */\n  closeAll: function () {\n    var _this = this;\n    var flags = [];\n    popups.forEach(function (p) {\n      var flag = _this.close(p);\n      flags.push(flag);\n    });\n    return flags.every(function (flag) {\n      return flag;\n    });\n  },\n  /**\n   * destroy - 销毁一个popup\n   * @param {Popup} popup\n   * @return bool\n   */\n  destroy: function (popup) {\n    if (!popup) return false;\n    if (popup.isDestroy()) return false;\n    var res = popup.destroy();\n    if (res) {\n      var index = popups.findIndex(function (p) {\n        return p === popup;\n      });\n      if (index !== -1) {\n        popups.splice(index, 1);\n      }\n    }\n    return res;\n  },\n  /**\n   * getEl\n   * @return {HTMLElement}\n   */\n  getEl: function () {\n    return el || document.body;\n  },\n  /**\n   * setEl\n   * @param tel\n   */\n  setEl: function (tel) {\n    el = tel;\n  },\n  /**\n   * Trigger\n   */\n  Trigger: Trigger_1.default,\n  /**\n   * TriggerPrompt\n   */\n  TriggerPrompt: TriggerPrompt_1.default\n};\nexports.default = PopupFactory;"],"names":["maskEl","renderToWrapper","__importDefault","mod","__esModule","default","react_1","Object","defineProperty","exports","value","Popup","require","client_1","uuid_1","adhere_util_1","Trigger_1","TriggerPrompt_1","selectorPrefix","prePopup","popups","el","config","this","id","isShow","popupEl","root","popupHandlers","WeakMap","PopupFactory","getEl","v1","onInnerElTransitionend","bind","render","prototype","createMask","zIndex","document","createElement","className","concat","style","String","appendChild","_this","_b","children","element","addEventListener","createRoot","cloneElement","ref","configProviderEL","getTopDom","cssText","_a","trigger","set","hookName","_c","call","update","_children","show","display","setTimeout","classList","add","showClosePrePopup","close","promise","then","Function","remove","e","destroy","get","unmount","isDestroy","getId","setRenderToWrapper","_renderToWrapper","create","ins","push","popup","closeAll","flags","forEach","p","flag","every","res","index","findIndex","splice","body","setEl","tel","Trigger","TriggerPrompt"],"mappings":"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"}