{"version":3,"file":"EditableCell.js","sources":["Extension/EditableCell/EditableCell.js"],"sourcesContent":["\"use strict\";\n\nrequire(\"core-js/modules/es.object.define-property.js\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar tslib_1 = require(\"tslib\");\n\nvar react_1 = tslib_1.__importStar(require(\"react\"));\n\nvar SearchTable_1 = require(\"../../SearchTable\");\n\nvar EditableCellEdit_1 = tslib_1.__importDefault(require(\"./Edit/EditableCellEdit\"));\n\nvar View_1 = tslib_1.__importDefault(require(\"./View\"));\n/**\n * EditableCell\n * @description 单元格编辑\n */\n\n\nvar EditableCell = function EditableCell(props) {\n  var _a;\n\n  var column = props.column;\n  /**\n   * defaultConfig\n   * @description 缺省的单元格配置\n   */\n\n  var defaultConfig = {\n    editable: false,\n    defaultStatus: 'view',\n    type: 'input',\n    props: {},\n    formItemProps: {},\n    useTrigger: true,\n    require: true,\n    dataIndex: column === null || column === void 0 ? void 0 : column.dataIndex,\n    useKeepEdit: false\n  };\n  /**\n   * editableConfig\n   * @description 实际的单元格配置\n   */\n\n  var editableConfig = (0, react_1.useMemo)(function () {\n    return tslib_1.__assign(tslib_1.__assign({}, defaultConfig), (column === null || column === void 0 ? void 0 : column.$editable) || {});\n  }, [column, column === null || column === void 0 ? void 0 : column.dataIndex]);\n  /**\n   * status\n   * @description 单元格的状态\n   */\n\n  var _b = (0, react_1.useState)(editableConfig.defaultStatus),\n      status = _b[0],\n      setStatus = _b[1];\n\n  var context = (0, react_1.useContext)(SearchTable_1.SearchTableContext);\n  /**\n   * 数据改变则切换成查看状态\n   */\n\n  (0, react_1.useEffect)(function () {\n    setStatus(editableConfig === null || editableConfig === void 0 ? void 0 : editableConfig.defaultStatus);\n  }, [(_a = context === null || context === void 0 ? void 0 : context.context) === null || _a === void 0 ? void 0 : _a.getData()]);\n  /**\n   * 缺省状态改变切换到缺省状态\n   */\n\n  (0, react_1.useEffect)(function () {\n    setStatus(editableConfig === null || editableConfig === void 0 ? void 0 : editableConfig.defaultStatus);\n  }, [editableConfig === null || editableConfig === void 0 ? void 0 : editableConfig.defaultStatus]);\n  return function (tdREL) {\n    var res = tdREL; // 单元格不是可编辑的单元格\n\n    if (!editableConfig.editable) {\n      // @ts-ignore\n      res = tdREL;\n    } // 始终保持编辑状态\n    else if (editableConfig.useKeepEdit) {\n      res = react_1.default.cloneElement(tdREL, tdREL.props, [react_1.default.createElement(EditableCellEdit_1.default, tslib_1.__assign({}, props, {\n        editableConfig: editableConfig,\n        onTriggerChange: function onTriggerChange() {\n          var _a, _b; // @ts-ignore\n\n\n          (_b = (_a = context === null || context === void 0 ? void 0 : context.context) === null || _a === void 0 ? void 0 : _a.setActiveValue) === null || _b === void 0 ? void 0 : _b.call(_a, '');\n          setStatus('view');\n        }\n      }))]);\n    } // 查看状态\n    else if (status === 'view') {\n      res = react_1.default.cloneElement(tdREL, tdREL.props, [react_1.default.createElement(View_1.default, tslib_1.__assign({}, props, {\n        editableConfig: editableConfig,\n        onTriggerChange: function onTriggerChange() {\n          var _a, _b;\n\n          (_b = (_a = context === null || context === void 0 ? void 0 : context.context) === null || _a === void 0 ? void 0 : _a.setActiveValue) === null || _b === void 0 ? void 0 : _b.call(_a, props.record[props.column.dataIndex]);\n          setStatus('edit');\n        }\n      }))]);\n    } // 编辑状态\n    else if (status === 'edit') {\n      res = react_1.default.cloneElement(tdREL, tdREL.props, [react_1.default.createElement(EditableCellEdit_1.default, tslib_1.__assign({}, props, {\n        editableConfig: editableConfig,\n        onTriggerChange: function onTriggerChange() {\n          var _a, _b; // @ts-ignore\n\n\n          (_b = (_a = context === null || context === void 0 ? void 0 : context.context) === null || _a === void 0 ? void 0 : _a.setActiveValue) === null || _b === void 0 ? void 0 : _b.call(_a, '');\n          setStatus('view');\n        }\n      }))]);\n    }\n\n    return res;\n  };\n};\n\nexports.default = EditableCell;"],"names":["require","Object","defineProperty","exports","value","tslib_1","react_1","__importStar","SearchTable_1","EditableCellEdit_1","__importDefault","View_1","EditableCell","props","column","defaultConfig","editable","defaultStatus","type","formItemProps","useTrigger","dataIndex","useKeepEdit","editableConfig","useMemo","__assign","$editable","_b","useState","status","setStatus","context","useContext","SearchTableContext","useEffect","_a","getData","tdREL","res","default","cloneElement","createElement","onTriggerChange","setActiveValue","call","record"],"mappings":"AAAA,aAEAA,QAAQ,8CAA8C,EAEtDC,OAAOC,eAAeC,QAAS,aAAc,CAC3CC,MAAO,CAAA,CACT,CAAC,EAED,IAAIC,QAAUL,QAAQ,OAAO,EAEzBM,QAAUD,QAAQE,aAAaP,QAAQ,OAAO,CAAC,EAE/CQ,cAAgBR,QAAQ,mBAAmB,EAE3CS,mBAAqBJ,QAAQK,gBAAgBV,QAAQ,yBAAyB,CAAC,EAE/EW,OAASN,QAAQK,gBAAgBV,QAAQ,QAAQ,CAAC,EAOlDY,aAAe,SAAsBC,GACvC,IAEIC,EAASD,EAAMC,OAMfC,EAAgB,CAClBC,SAAU,CAAA,EACVC,cAAe,OACfC,KAAM,QACNL,MAAO,GACPM,cAAe,GACfC,WAAY,CAAA,EACZpB,QAAS,CAAA,EACTqB,UAAWP,MAAAA,EAAuC,KAAA,EAASA,EAAOO,UAClEC,YAAa,CAAA,CACf,EAMIC,GAAiB,EAAIjB,QAAQkB,SAAS,WACxC,OAAOnB,QAAQoB,SAASpB,QAAQoB,SAAS,GAAIV,CAAa,GAAID,MAAAA,EAAuC,KAAA,EAASA,EAAOY,YAAc,EAAE,CACvI,EAAG,CAACZ,EAAQA,MAAAA,EAAuC,KAAA,EAASA,EAAOO,UAAU,EAMzEM,GAAK,EAAIrB,QAAQsB,UAAUL,EAAeN,aAAa,EACvDY,EAASF,EAAG,GACZG,EAAYH,EAAG,GAEfI,GAAU,EAAIzB,QAAQ0B,YAAYxB,cAAcyB,kBAAkB,EAetE,OAVA,EAAI3B,QAAQ4B,WAAW,WACrBJ,EAAUP,MAAAA,EAAuD,KAAA,EAASA,EAAeN,aAAa,CACxG,EAAG,CAAC,OAACkB,EAAKJ,MAAAA,EAAyC,KAAA,EAASA,EAAQA,SAAqC,KAAA,EAASI,EAAGC,QAAQ,EAAE,GAK/H,EAAI9B,QAAQ4B,WAAW,WACrBJ,EAAUP,MAAAA,EAAuD,KAAA,EAASA,EAAeN,aAAa,CACxG,EAAG,CAACM,MAAAA,EAAuD,KAAA,EAASA,EAAeN,cAAc,EAC1F,SAAUoB,GACf,IAAIC,EAAMD,EA0CV,OAxCKd,EAAeP,SAIXO,EAAeD,YACtBgB,EAAMhC,QAAQiC,QAAQC,aAAaH,EAAOA,EAAMxB,MAAO,CAACP,QAAQiC,QAAQE,cAAchC,mBAAmB8B,QAASlC,QAAQoB,SAAS,GAAIZ,EAAO,CAC5IU,eAAgBA,EAChBmB,gBAAiB,WACf,IAAIP,EAAIR,EAGR,OAACA,EAAK,OAACQ,EAAKJ,MAAAA,EAAyC,KAAA,EAASA,EAAQA,SAAqC,KAAA,EAASI,EAAGQ,iBAAqDhB,EAAGiB,KAAKT,EAAI,EAAE,EAC1LL,EAAU,MAAM,CAClB,CACF,CAAC,CAAC,EAAE,EAEc,SAAXD,EACPS,EAAMhC,QAAQiC,QAAQC,aAAaH,EAAOA,EAAMxB,MAAO,CAACP,QAAQiC,QAAQE,cAAc9B,OAAO4B,QAASlC,QAAQoB,SAAS,GAAIZ,EAAO,CAChIU,eAAgBA,EAChBmB,gBAAiB,WACf,IAAIP,EAAIR,EAER,OAACA,EAAK,OAACQ,EAAKJ,MAAAA,EAAyC,KAAA,EAASA,EAAQA,SAAqC,KAAA,EAASI,EAAGQ,iBAAqDhB,EAAGiB,KAAKT,EAAItB,EAAMgC,OAAOhC,EAAMC,OAAOO,UAAU,EAC5NS,EAAU,MAAM,CAClB,CACF,CAAC,CAAC,EAAE,EAEc,SAAXD,IACPS,EAAMhC,QAAQiC,QAAQC,aAAaH,EAAOA,EAAMxB,MAAO,CAACP,QAAQiC,QAAQE,cAAchC,mBAAmB8B,QAASlC,QAAQoB,SAAS,GAAIZ,EAAO,CAC5IU,eAAgBA,EAChBmB,gBAAiB,WACf,IAAIP,EAAIR,EAGR,OAACA,EAAK,OAACQ,EAAKJ,MAAAA,EAAyC,KAAA,EAASA,EAAQA,SAAqC,KAAA,EAASI,EAAGQ,iBAAqDhB,EAAGiB,KAAKT,EAAI,EAAE,EAC1LL,EAAU,MAAM,CAClB,CACF,CAAC,CAAC,EAAE,GAnCJQ,EAAMD,EAsCDC,CACT,CACF,EAEAnC,QAAQoC,QAAU3B"}