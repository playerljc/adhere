{"version":3,"file":"index.js","sources":["Extension/EditableCell/EditableRowControl/index.js"],"sourcesContent":["\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar tslib_1 = require(\"tslib\");\r\nvar classnames_1 = tslib_1.__importDefault(require(\"classnames\"));\r\nvar react_1 = tslib_1.__importStar(require(\"react\"));\r\nvar adhere_ui_conditionalrender_1 = tslib_1.__importDefault(require(\"@baifendian/adhere-ui-conditionalrender\"));\r\nvar adhere_util_intl_1 = tslib_1.__importDefault(require(\"@baifendian/adhere-util-intl\"));\r\nvar SearchTable_1 = require(\"../../../SearchTable\");\r\nvar EditableRow_1 = require(\"../EditableRow\");\r\n/**\r\n * EditableRowControl\r\n * @description 编辑行的控制器\r\n * @param record\r\n * @param renderCancel\r\n * @param onEditor\r\n * @param onSave\r\n * @param editorRowId\r\n * @param rowKey\r\n * @param className\r\n * @param styles\r\n * @param renderEditableRow\r\n * @param renderSave\r\n * @returns {JSX.Element}\r\n * @constructor\r\n */\r\nvar EditableRowControl = function (_a) {\r\n    var className = _a.className, styles = _a.styles, renderEditorRow = _a.renderEditorRow, renderSave = _a.renderSave, renderCancel = _a.renderCancel, record = _a.record, rowKey = _a.rowKey, editorRowId = _a.editorRowId, onEditor = _a.onEditor, onSave = _a.onSave;\r\n    var context = (0, react_1.useContext)(SearchTable_1.SearchTableContext);\r\n    var form = (0, react_1.useContext)(EditableRow_1.EditableContext);\r\n    var renderDefaultSave = (0, react_1.useCallback)(function () { return react_1.default.createElement(\"a\", null, adhere_util_intl_1.default.v('保存')); }, []);\r\n    var renderDefaultCancel = (0, react_1.useCallback)(function () { return react_1.default.createElement(\"a\", null, adhere_util_intl_1.default.v('取消')); }, []);\r\n    var renderDefaultEditorRow = (0, react_1.useCallback)(function () { return react_1.default.createElement(\"a\", null, adhere_util_intl_1.default.v('编辑行')); }, []);\r\n    var validateFieldsSuccess = (0, react_1.useCallback)(function (values) {\r\n        if (onSave) {\r\n            onSave(values).then(function () { return updateEditorCellRowData(values); });\r\n            return;\r\n        }\r\n        updateEditorCellRowData(values);\r\n    }, []);\r\n    var _onEditor = (0, react_1.useCallback)(function () {\r\n        var _a;\r\n        if (onEditor) {\r\n            (_a = onEditor === null || onEditor === void 0 ? void 0 : onEditor(record[rowKey])) === null || _a === void 0 ? void 0 : _a.then(function () { return updateRowEdit(); });\r\n            return;\r\n        }\r\n        updateRowEdit();\r\n    }, []);\r\n    var updateEditorCellRowData = function (values) {\r\n        var _a, _b;\r\n        // @ts-ignore\r\n        return (_b = (_a = context === null || context === void 0 ? void 0 : context.context) === null || _a === void 0 ? void 0 : _a.updateEditorCellRowData({ values: values, record: record })) === null || _b === void 0 ? void 0 : _b.then(function () { return reset(); });\r\n    };\r\n    var reset = function () {\r\n        var _a;\r\n        return (_a = context === null || context === void 0 ? void 0 : context.context) === null || _a === void 0 ? void 0 : _a.setState({\r\n            editorRowId: '',\r\n        });\r\n    };\r\n    var updateRowEdit = function () {\r\n        var _a;\r\n        return (_a = context === null || context === void 0 ? void 0 : context.context) === null || _a === void 0 ? void 0 : _a.setState({\r\n            editorRowId: record[rowKey],\r\n        });\r\n    };\r\n    return (react_1.default.createElement(\"div\", { className: (0, classnames_1.default)(\"\".concat(SearchTable_1.selectorPrefix, \"-editor-row-control\"), className), style: styles || {} },\r\n        react_1.default.createElement(adhere_ui_conditionalrender_1.default, { conditional: editorRowId !== record[rowKey], noMatch: function () { return (react_1.default.createElement(\"div\", { className: \"\".concat(SearchTable_1.selectorPrefix, \"-editor-row-control-save-cancel\") },\r\n                react_1.default.createElement(\"div\", { className: \"\".concat(SearchTable_1.selectorPrefix, \"-editor-row-control-save-cancel-item\"), onClick: function () { return form === null || form === void 0 ? void 0 : form.validateFields().then(function (values) { return validateFieldsSuccess(values); }); } },\r\n                    react_1.default.createElement(adhere_ui_conditionalrender_1.default, { conditional: !renderSave, noMatch: function () { return renderSave === null || renderSave === void 0 ? void 0 : renderSave(); } }, function () { return renderDefaultSave(); })),\r\n                react_1.default.createElement(\"div\", { className: \"\".concat(SearchTable_1.selectorPrefix, \"-editor-row-control-save-cancel-item\"), onClick: reset },\r\n                    react_1.default.createElement(adhere_ui_conditionalrender_1.default, { conditional: !renderCancel, noMatch: function () { return renderCancel === null || renderCancel === void 0 ? void 0 : renderCancel(); } }, function () { return renderDefaultCancel(); })))); } }, function () { return (react_1.default.createElement(\"div\", { className: \"\".concat(SearchTable_1.selectorPrefix, \"-editor-row-control-edit\"), onClick: _onEditor },\r\n            react_1.default.createElement(adhere_ui_conditionalrender_1.default, { conditional: !renderEditorRow, noMatch: function () { return renderEditorRow === null || renderEditorRow === void 0 ? void 0 : renderEditorRow(); } }, function () { return renderDefaultEditorRow(); }))); })));\r\n};\r\nexports.default = EditableRowControl;\r\n//# sourceMappingURL=index.js.map"],"names":["Object","defineProperty","exports","value","tslib_1","require","classnames_1","__importDefault","react_1","__importStar","adhere_ui_conditionalrender_1","adhere_util_intl_1","SearchTable_1","EditableRow_1","EditableRowControl","_a","className","styles","renderEditorRow","renderSave","renderCancel","record","rowKey","editorRowId","onEditor","onSave","context","useContext","SearchTableContext","form","EditableContext","renderDefaultSave","useCallback","default","createElement","v","renderDefaultCancel","renderDefaultEditorRow","validateFieldsSuccess","values","then","updateEditorCellRowData","_onEditor","updateRowEdit","_b","reset","setState","concat","selectorPrefix","style","conditional","noMatch","onClick","validateFields"],"mappings":"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"}