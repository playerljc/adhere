"use strict";var __assign=function(){return(__assign=Object.assign||function(e){for(var t,r=1,a=arguments.length;r<a;r++)for(var l in t=arguments[r])Object.prototype.hasOwnProperty.call(t,l)&&(e[l]=t[l]);return e}).apply(this,arguments)},__createBinding=Object.create?function(e,t,r,a){void 0===a&&(a=r);var l=Object.getOwnPropertyDescriptor(t,r);l&&("get"in l?t.__esModule:!l.writable&&!l.configurable)||(l={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,l)}:function(e,t,r,a){e[a=void 0===a?r:a]=t[r]},__setModuleDefault=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t},__importStar=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding(t,e,r);return __setModuleDefault(t,e),t},__importDefault=function(e){return e&&e.__esModule?e:{default:e}},antd_1=(Object.defineProperty(exports,"__esModule",{value:!0}),require("antd")),dayjs_1=__importDefault(require("dayjs")),react_1=__importStar(require("react")),icons_1=require("@ant-design/icons"),adhere_ui_conditionalrender_1=__importDefault(require("@baifendian/adhere-ui-conditionalrender")),adhere_util_1=__importDefault(require("@baifendian/adhere-util")),SearchTable_1=require("../../../SearchTable"),EditableRow_1=require("../EditableRow"),EventTypes_1=__importDefault(require("../EventTypes")),FormItemGenerator_1=__importDefault(require("./FormItemGenerator")),EditableCellEdit=function(e){var t,r=e.editableConfig,a=r.useTrigger,l=r.useKeepEdit,n=r.renderSaveTrigger,d=r.renderCancelTrigger,i=r.onSave,o=r.onBeforeCancel,u=r.dataIndex,c=r.type,_=r.render,f=r.rules,r=r.formItemProps,s=e.record,v=e.rowIndex,m=e.onTriggerChange,p=(0,react_1.useContext)(EditableRow_1.EditableContext),b=(0,react_1.useContext)(SearchTable_1.SearchTableContext),x=antd_1.Form.useWatch(u,p);function g(){i?null!=p&&p.validateFields().then(function(e){null!=(e=i({value:x,values:e,record:s,dataIndex:u,rowIndex:v}))&&e.then(function(){return null==m?void 0:m()})}):null!=m&&m()}function E(){var e;o?null!=(e=o({value:x,record:s,dataIndex:u,rowIndex:v}))&&e.then(function(){return null==m?void 0:m()}):null!=m&&m()}function I(){var e;return x instanceof dayjs_1.default?null==(e=null==b?void 0:b.context)?void 0:e.updateEditorCellDateData({record:s,dataIndex:u,value:x}):null==(e=null==b?void 0:b.context)?void 0:e.updateEditorCellDate({record:s,dataIndex:u,value:x})}var h,C,y=(0,react_1.useMemo)(function(){return adhere_util_1.default.isFunction(f)?f({record:s,value:x,rowIndex:v,dataIndex:u}):f},[f,s,x,v,u]);return(0,react_1.useEffect)(function(){var e;null!=p&&p.setFieldValue(u,null==(e=null==b?void 0:b.context)?void 0:e.valueToFormItemValue({type:c,record:s,dataIndex:u}))},[null==(t=null==b?void 0:b.context)?void 0:t.getData()]),react_1.default.createElement("div",{className:"".concat(SearchTable_1.selectorPrefix,"-editable-cell-edit")},react_1.default.createElement("div",{className:"".concat(SearchTable_1.selectorPrefix,"-editable-cell-edit-inner")},react_1.default.createElement(antd_1.Form.Item,__assign({name:u,rules:null!=y?y:[]},null!=r?r:{}),"custom"!==c?(h=adhere_util_1.default.isFunction(e.editableConfig.props)?null!=(C=e.editableConfig.props({record:s,dataIndex:u,rowIndex:v}))?C:{}:null!=(C=e.editableConfig.props)?C:{},C=__assign(__assign({autoFocus:!l},h),EventTypes_1.default.reduce(function(e,t){return e[t]=function(e){h[t]&&h[t](e,{form:p,dataIndex:u,rowIndex:v,updateEditorCellData:I})},e},{})),C=FormItemGenerator_1.default.render({type:c,props:C,dictName:e.editableConfig.dictName,form:p,dataIndex:u,rowIndex:v}),_?_({value:null==s?void 0:s[u],record:s,dataIndex:u,rowIndex:v,form:p,updateEditorCellData:I,children:C}):C):null==_?void 0:_({value:null==s?void 0:s[u],record:s,dataIndex:u,rowIndex:v,form:p,updateEditorCellData:I}))),react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:!!a&&!l},function(){return react_1.default.createElement("div",{className:"".concat(SearchTable_1.selectorPrefix,"-editable-cell-edit-trigger")},react_1.default.createElement("div",{className:"".concat(SearchTable_1.selectorPrefix,"-editable-cell-edit-trigger-inner")},react_1.default.createElement("div",{className:"".concat(SearchTable_1.selectorPrefix,"-editable-cell-edit-trigger-save"),onClick:g},!!n&&(null==n?void 0:n({value:null==s?void 0:s[u],record:s,dataIndex:u,rowIndex:v})),!n&&react_1.default.createElement(icons_1.CheckOutlined,null)),react_1.default.createElement("div",{className:"".concat(SearchTable_1.selectorPrefix,"-editable-cell-edit-trigger-cancel"),onClick:E},!!d&&(null==d?void 0:d({value:null==s?void 0:s[u],record:s,dataIndex:u,rowIndex:v})),!d&&react_1.default.createElement(icons_1.CloseOutlined,null))))}))};EditableCellEdit.displayName="EditableCellEdit",exports.default=EditableCellEdit;
//# sourceMappingURL=EditableCellEdit.js.map
