"use strict";require("core-js/modules/es.object.define-property.js"),require("core-js/modules/es.array.reduce.js"),require("core-js/modules/es.object.to-string.js"),Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),antd_1=require("antd"),moment_1=tslib_1.__importDefault(require("moment")),react_1=tslib_1.__importStar(require("react")),icons_1=require("@ant-design/icons"),adhere_ui_conditionalrender_1=tslib_1.__importDefault(require("@baifendian/adhere-ui-conditionalrender")),SearchTable_1=require("../../../SearchTable"),EditableRow_1=require("../EditableRow"),EventTypes_1=tslib_1.__importDefault(require("../EventTypes")),FormItemGenerator_1=tslib_1.__importDefault(require("./FormItemGenerator")),EditableCellEdit=function(r){var e,t=r.editableConfig,a=t.useTrigger,l=t.useKeepEdit,n=t.renderSaveTrigger,d=t.renderCancelTrigger,i=t.onSave,o=t.onBeforeCancel,c=t.dataIndex,u=t.type,s=t.render,_=t.rules,t=t.formItemProps,f=r.record,m=r.rowIndex,v=r.onTriggerChange,b=(0,react_1.useContext)(EditableRow_1.EditableContext),x=(0,react_1.useContext)(SearchTable_1.SearchTableContext),p=antd_1.Form.useWatch(c,b);function g(){null!=b&&b.validateFields().then(function(e){i?null!=(e=i({value:p,values:e,record:f,dataIndex:c,rowIndex:m}))&&e.then(function(){return null==v?void 0:v()}):null!=v&&v()})}function E(){var e;o?null!=(e=o({value:p,record:f,dataIndex:c,rowIndex:m}))&&e.then(function(){return null==v?void 0:v()}):null!=v&&v()}function I(){var e;return p instanceof moment_1.default?null==(e=null==x?void 0:x.context)?void 0:e.updateEditorCellDateData({record:f,dataIndex:c,value:p}):null==(e=null==x?void 0:x.context)?void 0:e.updateEditorCellDate({record:f,dataIndex:c,value:p})}return(0,react_1.useEffect)(function(){var e;null!=b&&b.setFieldValue(c,null==(e=null==x?void 0:x.context)?void 0:e.valueToFormItemValue({type:u,record:f,dataIndex:c}))},[null==(e=null==x?void 0:x.context)?void 0:e.getData()]),react_1.default.createElement("div",{className:"".concat(SearchTable_1.selectorPrefix,"-editablecell-edit")},react_1.default.createElement("div",{className:"".concat(SearchTable_1.selectorPrefix,"-editablecell-edit-inner")},react_1.default.createElement(antd_1.Form.Item,tslib_1.__assign({name:c,rules:_},t||{}),"custom"!==u?(e=tslib_1.__assign(tslib_1.__assign({autoFocus:!l},r.editableConfig.props),EventTypes_1.default.reduce(function(e,t){return e[t]=function(e){r.editableConfig.props[t]&&r.editableConfig.props[t](e,{form:b,dataIndex:c,rowIndex:m,updateEditorCellData:I})},e},{})),e=FormItemGenerator_1.default.render({type:u,props:e,dictName:r.editableConfig.dictName,renderChildren:r.editableConfig.renderChildren,form:b,dataIndex:c,rowIndex:m}),s?s({value:null==f?void 0:f[c],record:f,dataIndex:c,rowIndex:m,form:b,updateEditorCellData:I,children:e}):e):null==s?void 0:s({value:null==f?void 0:f[c],record:f,dataIndex:c,rowIndex:m,form:b,updateEditorCellData:I}))),react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:!!a&&!l},function(){return react_1.default.createElement("div",{className:"".concat(SearchTable_1.selectorPrefix,"-editablecell-edit-trigger")},react_1.default.createElement("div",{className:"".concat(SearchTable_1.selectorPrefix,"-editablecell-edit-trigger-inner")},react_1.default.createElement("div",{className:"".concat(SearchTable_1.selectorPrefix,"-editablecell-edit-trigger-save"),onClick:g},!!n&&(null==n?void 0:n({value:null==f?void 0:f[c],record:f,dataIndex:c,rowIndex:m})),!n&&react_1.default.createElement(icons_1.CheckOutlined,null)),react_1.default.createElement("div",{className:"".concat(SearchTable_1.selectorPrefix,"-editablecell-edit-trigger-cancel"),onClick:E},!!d&&(null==d?void 0:d({value:null==f?void 0:f[c],record:f,dataIndex:c,rowIndex:m})),!d&&react_1.default.createElement(icons_1.CloseOutlined,null))))}))};exports.default=EditableCellEdit;
//# sourceMappingURL=EditableCellEdit.js.map
