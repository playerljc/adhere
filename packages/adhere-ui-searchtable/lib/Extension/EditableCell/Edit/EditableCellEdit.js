"use strict";require("core-js/modules/es.object.define-property.js"),Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),antd_1=require("antd"),moment_1=tslib_1.__importDefault(require("moment")),react_1=tslib_1.__importStar(require("react")),icons_1=require("@ant-design/icons"),adhere_ui_conditionalrender_1=tslib_1.__importDefault(require("@baifendian/adhere-ui-conditionalrender")),SearchTable_1=require("../../../SearchTable"),EditableRow_1=require("../EditableRow"),FormItemGenerator_1=tslib_1.__importDefault(require("./FormItemGenerator")),EditableCellEdit=function(t){var e=t.editableConfig,r=e.useTrigger,a=e.useKeepEdit,l=e.renderSaveTrigger,n=e.renderCancelTrigger,d=e.onSave,i=e.onBeforeCancel,o=e.dataIndex,c=e.type,u=e.render,s=e.rules,e=e.formItemProps,_=t.record,f=t.rowIndex,m=t.onTriggerChange,b=(0,react_1.useContext)(EditableRow_1.EditableContext),v=(0,react_1.useContext)(SearchTable_1.SearchTableContext),x=antd_1.Form.useWatch(o,b);function g(){null!=b&&b.validateFields().then(function(e){d?null!=(e=d({value:x,values:e,record:_,dataIndex:o,rowIndex:f}))&&e.then(function(){return null==m?void 0:m()}):null!=m&&m()})}function I(){var e;i?null!=(e=i({value:x,record:_,dataIndex:o,rowIndex:f}))&&e.then(function(){return null==m?void 0:m()}):null!=m&&m()}function p(){var e;x instanceof moment_1.default?null!=(e=null==v?void 0:v.context)&&e.updateEditorCellDateData({record:_,dataIndex:o,value:x}):null!=(e=null==v?void 0:v.context)&&e.updateEditorCellDate({record:_,dataIndex:o,value:x})}return(0,react_1.useEffect)(function(){var e;null!=b&&b.setFieldValue(o,null==(e=null==v?void 0:v.context)?void 0:e.valueToFormItemValue({type:c,record:_,dataIndex:o}))},[null==_?void 0:_[o]]),react_1.default.createElement("div",{className:"".concat(SearchTable_1.selectorPrefix,"-editablecell-edit")},react_1.default.createElement("div",{className:"".concat(SearchTable_1.selectorPrefix,"-editablecell-edit-inner")},react_1.default.createElement(antd_1.Form.Item,tslib_1.__assign({name:o,rules:s},e||{}),"custom"!==c?(s=tslib_1.__assign({autoFocus:!a},t.editableConfig.props),!a&&r||(s=tslib_1.__assign(tslib_1.__assign({},s),{onBlur:function(e){t.editableConfig.props.onBlur&&t.editableConfig.props.onBlur(e,{form:b,dataIndex:o,rowIndex:f}),p()},onChange:function(e){t.editableConfig.props.onChange&&t.editableConfig.props.onChange(e,{form:b,dataIndex:o,rowIndex:f}),p()}})),s=FormItemGenerator_1.default.render({type:c,props:s,dictName:t.editableConfig.dictName,renderChildren:t.editableConfig.renderChildren,form:b,dataIndex:o,rowIndex:f}),u?u({value:null==_?void 0:_[o],record:_,dataIndex:o,rowIndex:f,form:b,children:s}):s):null==u?void 0:u({value:null==_?void 0:_[o],record:_,dataIndex:o,rowIndex:f,form:b}))),react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:!!r&&!a},function(){return react_1.default.createElement("div",{className:"".concat(SearchTable_1.selectorPrefix,"-editablecell-edit-trigger")},react_1.default.createElement("div",{className:"".concat(SearchTable_1.selectorPrefix,"-editablecell-edit-trigger-inner")},react_1.default.createElement("div",{className:"".concat(SearchTable_1.selectorPrefix,"-editablecell-edit-trigger-save"),onClick:g},!!l&&(null==l?void 0:l({value:null==_?void 0:_[o],record:_,dataIndex:o,rowIndex:f})),!l&&react_1.default.createElement(icons_1.CheckOutlined,null)),react_1.default.createElement("div",{className:"".concat(SearchTable_1.selectorPrefix,"-editablecell-edit-trigger-cancel"),onClick:I},!!n&&(null==n?void 0:n({value:null==_?void 0:_[o],record:_,dataIndex:o,rowIndex:f})),!n&&react_1.default.createElement(icons_1.CloseOutlined,null))))}))};exports.default=EditableCellEdit;
//# sourceMappingURL=EditableCellEdit.js.map
