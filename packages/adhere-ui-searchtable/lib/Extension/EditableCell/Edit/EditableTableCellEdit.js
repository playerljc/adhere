"use strict";require("core-js/modules/es.object.define-property.js"),Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),antd_1=require("antd"),react_1=tslib_1.__importStar(require("react")),icons_1=require("@ant-design/icons"),adhere_ui_conditionalrender_1=tslib_1.__importDefault(require("@baifendian/adhere-ui-conditionalrender")),SearchTable_1=require("../../../SearchTable"),FormItemGenerator_1=tslib_1.__importDefault(require("./FormItemGenerator")),EditableTableCellEdit=function(e){var l,t=e.editableConfig,a=t.useTrigger,r=t.useKeepEdit,n=t.renderSaveTrigger,d=t.renderCancelTrigger,i=t.onSave,o=t.onBeforeCancel,u=t.dataIndex,c=t.type,s=t.render,v=t.rules,t=t.formItemProps,b=e.record,_=e.rowIndex,f=e.onTriggerChange,m=(0,react_1.useContext)(SearchTable_1.SearchTableContext),x=[null==(x=null==(x=null==(x=null==(x=null==m?void 0:m.editable)?void 0:x.tableEditable)?void 0:x.formList)?void 0:x.fields[_])?void 0:x.name,u],g=tslib_1.__spreadArray(["dataSource"],x,!0),E=antd_1.Form.useWatch(g,null==(l=null==(l=null==m?void 0:m.editable)?void 0:l.tableEditable)?void 0:l.form);function I(){var e,l;i&&null!=(l=null==(e=null==(e=null==(l=null==(l=null==(l=null==m?void 0:m.editable)?void 0:l.tableEditable)?void 0:l.form)?void 0:l.validateFields)?void 0:e.call(l))?void 0:e.then)&&l.call(e,function(e){null!=(e=i({value:E,values:e,record:b,dataIndex:u,rowIndex:_}))&&e.then(function(){return null==f?void 0:f()})}),null!=f&&f()}function h(){var e;o?null!=(e=o({value:E,record:b,dataIndex:u,rowIndex:_}))&&e.then(function(){return null==f?void 0:f()}):null!=f&&f()}return(0,react_1.useEffect)(function(){var e,l;null!=(e=null==(e=null==(e=null==m?void 0:m.editable)?void 0:e.tableEditable)?void 0:e.form)&&e.setFieldValue(g,null==(l=null==(e=null==m?void 0:m.context)?void 0:e.valueToFormItemValue)?void 0:l.call(e,{type:c,record:b,dataIndex:u}))},[null==(l=null==m?void 0:m.context)?void 0:l.getData()]),react_1.default.createElement("div",{className:"".concat(SearchTable_1.selectorPrefix,"-editablecell-edit")},react_1.default.createElement("div",{className:"".concat(SearchTable_1.selectorPrefix,"-editablecell-edit-inner")},react_1.default.createElement(antd_1.Form.Item,tslib_1.__assign({name:x,rules:v},t||{}),"custom"!==c?(l=FormItemGenerator_1.default.render({type:c,props:tslib_1.__assign({autoFocus:!r},e.editableConfig.props),dictName:e.editableConfig.dictName,renderChildren:e.editableConfig.renderChildren,form:null==(l=null==(l=null==m?void 0:m.editable)?void 0:l.tableEditable)?void 0:l.form,dataIndex:u,rowIndex:_}),s?s({value:null==b?void 0:b[u],record:b,dataIndex:u,rowIndex:_,form:null==(x=null==(x=null==m?void 0:m.editable)?void 0:x.tableEditable)?void 0:x.form,children:l}):l):null==s?void 0:s({value:null==b?void 0:b[u],record:b,dataIndex:u,rowIndex:_,form:null==(t=null==(v=null==m?void 0:m.editable)?void 0:v.tableEditable)?void 0:t.form}))),react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:!!a&&!r},function(){return react_1.default.createElement("div",{className:"".concat(SearchTable_1.selectorPrefix,"-editablecell-edit-trigger")},react_1.default.createElement("div",{className:"".concat(SearchTable_1.selectorPrefix,"-editablecell-edit-trigger-inner")},react_1.default.createElement("div",{className:"".concat(SearchTable_1.selectorPrefix,"-editablecell-edit-trigger-save"),onClick:I},!!n&&(null==n?void 0:n({value:null==b?void 0:b[u],record:b,dataIndex:u,rowIndex:_})),!n&&react_1.default.createElement(icons_1.CheckOutlined,null)),react_1.default.createElement("div",{className:"".concat(SearchTable_1.selectorPrefix,"-editablecell-edit-trigger-cancel"),onClick:h},!!d&&(null==d?void 0:d({value:null==b?void 0:b[u],record:b,dataIndex:u,rowIndex:_})),!d&&react_1.default.createElement(icons_1.CloseOutlined,null))))}))};exports.default=EditableTableCellEdit;
//# sourceMappingURL=EditableTableCellEdit.js.map
