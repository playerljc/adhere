"use strict";var __assign=function(){return(__assign=Object.assign||function(r){for(var e,o=1,n=arguments.length;o<n;o++)for(var t in e=arguments[o])Object.prototype.hasOwnProperty.call(e,t)&&(r[t]=e[t]);return r}).apply(this,arguments)},__createBinding=Object.create?function(r,e,o,n){void 0===n&&(n=o);var t=Object.getOwnPropertyDescriptor(e,o);t&&("get"in t?e.__esModule:!t.writable&&!t.configurable)||(t={enumerable:!0,get:function(){return e[o]}}),Object.defineProperty(r,n,t)}:function(r,e,o,n){r[n=void 0===n?o:n]=e[o]},__setModuleDefault=Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e},__importStar=function(r){if(r&&r.__esModule)return r;var e={};if(null!=r)for(var o in r)"default"!==o&&Object.prototype.hasOwnProperty.call(r,o)&&__createBinding(e,r,o);return __setModuleDefault(e,r),e},__importDefault=function(r){return r&&r.__esModule?r:{default:r}},classnames_1=(Object.defineProperty(exports,"__esModule",{value:!0}),__importDefault(require("classnames"))),react_1=require("react"),react_2=__importStar(require("react")),react_dnd_1=require("react-dnd"),Constent_1=require("../../../Constent"),SearchTable_1=require("../../../SearchTable"),Util_1=require("../../../Util"),DragSortRowContext_1=__importDefault(require("./DragSortRowContext")),type="DraggableBodyRow";function ProviderWrapper(r){var e=r.value,r=r.children;return react_2.default.createElement(DragSortRowContext_1.default.Provider,{value:e},r)}var DragSortRow=function(r){var e,o,n,t,a,l,i,d=r.rowIndex,u=r.rowConfig,c=r.record,s=r.columns,g=(0,react_2.useContext)(SearchTable_1.SearchTableContext),r=(0,react_1.useMemo)(function(){return function r(e){for(var o=!1,n=0;n<e.length;n++){var t=e[n];if(t.key===Constent_1.DRAG_SORT_ROW_COLUMN_KEY){o=!0;break}if(t.children&&(o=r(null!=(t=t.children)?t:[])))break}return o}(s)},[s]),r=(0,react_1.useState)(!r),_=r[0],f=r[1],p=(0,react_2.useRef)(null),r={type:type,dropOverDownwardClassName:"".concat(SearchTable_1.selectorPrefix,"-row-drag-sort-drop-over-downward"),dropOverUpwardClasName:"".concat(SearchTable_1.selectorPrefix,"-row-drag-sort-drop-over-upward"),dragConfig:function(){return{type:v.type,item:{index:d,record:c},collect:function(r){return{isDragging:r.isDragging()}},canDrag:function(){return _}}},dropConfig:function(){return{accept:v.type,collect:function(r){var e,o=(null!=(o=r.getItem())?o:{}).index;return __assign({isOver:r.isOver(),dropClassName:o<d?v.dropOverDownwardClassName:v.dropOverUpwardClasName},null!=(e=null==(e=null==(o=null==(o=null==u?void 0:u.$rowDragSort)?void 0:o.dropHooks)?void 0:o.collect)?void 0:e.call(o,r))?e:{})},drop:function(e){var r=null==(r=null==g?void 0:g.context)?void 0:r.getData(),o=null==(o=null==g?void 0:g.context)?void 0:o.getRowKey();(0,Util_1.isSameLevel)({dataSource:r,rowKey:o,sourceId:c[o],targetId:e.record[o]})&&(null!=(o=null==(r=null==u?void 0:u.$rowDragSort)?void 0:r.dropHooks)&&o.drop?null!=(o=null==(r=null==u?void 0:u.$rowDragSort)?void 0:r.dropHooks)&&o.drop({sourceRecord:e.record,targetRecord:c,item:e}).then(function(){var r;null!=(r=null==g?void 0:g.context)&&r.moveRow(e.record,c)}):null!=(r=null==g?void 0:g.context)&&r.moveRow(e.record,c))}}}},v=__assign(__assign({},r),null!=(w=null==(w=null==u?void 0:u.$rowDragSort)?void 0:w.override)?w:{}),w=r.dragConfig(),C=r.dropConfig();null!=(e=null==(e=null==u?void 0:u.$rowDragSort)?void 0:e.override)&&e.dragConfig?v.dragConfig=Object.assign(w,null!=(o=null==(o=null==(e=null==(e=null==u?void 0:u.$rowDragSort)?void 0:e.override)?void 0:e.dragConfig)?void 0:o.call(e,w))?o:{}):v.dragConfig=r.dragConfig(),null!=(w=null==(e=null==u?void 0:u.$rowDragSort)?void 0:e.override)&&w.dropConfig?v.dropConfig=Object.assign(C,null!=(o=null==(w=null==(e=null==(o=null==u?void 0:u.$rowDragSort)?void 0:o.override)?void 0:e.dropConfig)?void 0:w.call(e,C))?o:{}):v.dropConfig=r.dropConfig();try{a=(n=(0,react_dnd_1.useDrag)(v.dragConfig))[1],t=(0,react_dnd_1.useDrop)(v.dropConfig),l=t[0].isOver,i=t[0].dropClassName,(0,t[1])(a(p))}catch(r){console.log(r)}return function(r){var e={cursor:"canDrag"in v.dragConfig&&!v.dragConfig.canDrag()?"no-drop":"move"};return react_2.default.createElement(ProviderWrapper,{value:{dragResult:n,dropResult:t,setCanDrag:f}},Array.isArray(r.props.children)?react_2.default.createElement("tr",__assign({ref:p},r.props,{style:__assign(__assign({},e),null!=(e=r.props.style)?e:{}),className:(0,classnames_1.default)(r.props.className,l?i:"")}),r.props.children):r.props.children)}};exports.default=DragSortRow;
//# sourceMappingURL=DragSortRow.js.map
