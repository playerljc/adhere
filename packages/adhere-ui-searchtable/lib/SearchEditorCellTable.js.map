{"version":3,"file":"SearchEditorCellTable.js","sources":["SearchEditorCellTable.js"],"sourcesContent":["\"use strict\";\n\nrequire(\"core-js/modules/es.object.define-property.js\");\n\nrequire(\"core-js/modules/es.object.to-string.js\");\n\nrequire(\"core-js/modules/es.promise.js\");\n\nrequire(\"core-js/modules/es.array.find.js\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar tslib_1 = require(\"tslib\");\n\nvar lodash_clonedeep_1 = tslib_1.__importDefault(require(\"lodash.clonedeep\"));\n\nvar EditableCell_1 = tslib_1.__importDefault(require(\"./Extension/EditableCell/EditableCell\"));\n\nvar EditableRow_1 = tslib_1.__importDefault(require(\"./Extension/EditableCell/EditableRow\"));\n\nvar SearchTableImplement_1 = require(\"./SearchTableImplement\");\n/**\n * SearchEditorCellTable\n * @class\n * @classdesc 可编辑单元格的表格\n */\n\n\nvar SearchEditorCellTable =\n/** @class */\nfunction (_super) {\n  tslib_1.__extends(SearchEditorCellTable, _super);\n\n  function SearchEditorCellTable(props) {\n    var _this = _super.call(this, props) || this;\n\n    _this.cellReducers = tslib_1.__spreadArray(tslib_1.__spreadArray([], _this.cellReducers, true), [_this.cellEditableReducer], false);\n    return _this;\n  }\n  /**\n   * onComponents\n   * @param columns\n   * @param components\n   */\n\n\n  SearchEditorCellTable.prototype.onComponents = function (columns, components) {\n    var existsEditor = columns.some(function (column) {\n      var _a;\n\n      return '$editable' in column && ((_a = column.$editable) === null || _a === void 0 ? void 0 : _a.editable);\n    });\n\n    if (existsEditor) {\n      components.body = {\n        row: EditableRow_1.default,\n        cell: EditableCell_1.default\n      };\n    }\n\n    return components;\n  };\n  /**\n   * cellEditableReducer\n   * @description 可编辑单元格的onCell处理\n   * @param params\n   */\n\n\n  SearchEditorCellTable.prototype.cellEditableReducer = function (params) {\n    var _a;\n\n    var rowIndex = params.rowIndex,\n        column = params.column,\n        record = params.record; // 如果设置了$editable则调用onEditorCell方法对每个cell进行props注入\n\n    if ('$editable' in column && ((_a = column.$editable) === null || _a === void 0 ? void 0 : _a.editable) && this.onEditorCell) {\n      this.onEditorCell({\n        rowIndex: rowIndex,\n        editorConfig: column.$editable,\n        record: tslib_1.__assign({}, record)\n      });\n      return column;\n    }\n\n    return column;\n  };\n  /**\n   * updateEditorCellDate\n   * @description 更新可编辑单元格的数据\n   * @param record 行数据\n   * @param dataIndex 列索引\n   * @param value 更新的值\n   * @return Promise<void>\n   */\n\n\n  SearchEditorCellTable.prototype.updateEditorCellDate = function (_a) {\n    var _this = this;\n\n    var record = _a.record,\n        dataIndex = _a.dataIndex,\n        value = _a.value;\n    return new Promise(function (resolve) {\n      var _a;\n\n      var listData = (0, lodash_clonedeep_1.default)(_this.props[_this.getServiceName()]);\n      var dataSource = listData[_this.getFetchListPropName()][_this.getDataKey()] || [];\n\n      var rowKey = _this.getRowKey();\n\n      var recordItem = dataSource.find(function (t) {\n        return t[rowKey] === record[rowKey];\n      });\n\n      if (recordItem) {\n        recordItem[dataIndex] = value;\n\n        _this.props.dispatch((_a = {\n          type: \"\".concat(_this.getServiceName(), \"/receive\")\n        }, _a[_this.getServiceName()] = listData, _a)).then(function () {\n          return resolve();\n        });\n      } else resolve();\n    });\n  };\n  /**\n   * updateEditorCellDateData\n   * @description 更新日期类型可编辑单元格的数据\n   * @param record\n   * @param dataIndex\n   * @param value\n   * @return Promise<void>\n   */\n\n\n  SearchEditorCellTable.prototype.updateEditorCellDateData = function (_a) {\n    var _this = this;\n\n    var record = _a.record,\n        dataIndex = _a.dataIndex,\n        value = _a.value;\n    return new Promise(function (resolve) {\n      var _a;\n\n      var listData = (0, lodash_clonedeep_1.default)(_this.props[_this.getServiceName()]);\n      var dataSource = listData[_this.getFetchListPropName()][_this.getDataKey()] || [];\n\n      var rowKey = _this.getRowKey();\n\n      var recordItem = dataSource.find(function (t) {\n        return t[rowKey] === record[rowKey];\n      });\n\n      if (recordItem) {\n        recordItem[dataIndex] = value === null || value === void 0 ? void 0 : value.valueOf();\n\n        _this.props.dispatch((_a = {\n          type: \"\".concat(_this.getServiceName(), \"/receive\")\n        }, _a[_this.getServiceName()] = listData, _a)).then(function () {\n          return resolve();\n        });\n      } else resolve();\n    });\n  };\n\n  return SearchEditorCellTable;\n}(SearchTableImplement_1.SearchTableImplement);\n\nexports.default = SearchEditorCellTable;"],"names":["require","Object","defineProperty","exports","value","tslib_1","lodash_clonedeep_1","__importDefault","EditableCell_1","EditableRow_1","SearchTableImplement_1","SearchEditorCellTable","_super","props","_this","call","this","cellReducers","__spreadArray","cellEditableReducer","__extends","prototype","onComponents","columns","components","some","column","_a","$editable","editable","body","row","default","cell","params","rowIndex","record","onEditorCell","editorConfig","__assign","updateEditorCellDate","dataIndex","Promise","resolve","listData","getServiceName","dataSource","getFetchListPropName","getDataKey","rowKey","getRowKey","recordItem","find","t","dispatch","type","concat","then","updateEditorCellDateData","valueOf","SearchTableImplement"],"mappings":"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"}