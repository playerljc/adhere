{"version":3,"file":"SearchEditableFactory.js","sources":["Editable/SearchEditableFactory.js"],"sourcesContent":["\"use strict\";\n\nvar __extends = void 0 && (void 0).__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n    return _extendStatics(d, b);\n  };\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    _extendStatics(d, b);\n    function __() {\n      this.constructor = d;\n    }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\nvar __assign = void 0 && (void 0).__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n    return t;\n  };\n  return __assign.apply(this, arguments);\n};\nvar __createBinding = void 0 && (void 0).__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n    desc = {\n      enumerable: true,\n      get: function get() {\n        return m[k];\n      }\n    };\n  }\n  Object.defineProperty(o, k2, desc);\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\nvar __setModuleDefault = void 0 && (void 0).__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\nvar __importStar = void 0 && (void 0).__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  __setModuleDefault(result, mod);\n  return result;\n};\nvar __spreadArray = void 0 && (void 0).__spreadArray || function (to, from, pack) {\n  if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n    if (ar || !(i in from)) {\n      if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n      ar[i] = from[i];\n    }\n  }\n  return to.concat(ar || Array.prototype.slice.call(from));\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar antd_1 = require(\"antd\");\nvar react_1 = __importStar(require(\"react\"));\nvar SearchTable_1 = require(\"../SearchTable\");\nvar util_1 = require(\"../util\");\nfunction default_1(SuperClass) {\n  return (/** @class */function (_super) {\n      __extends(class_1, _super);\n      function class_1(props) {\n        var _this = _super.call(this, props) || this;\n        _this.formRef = (0, react_1.createRef)();\n        _this.state = __assign(__assign({}, _this.state), {\n          isTableEditor: false\n        });\n        _this.rowConfigReducers = __spreadArray(__spreadArray([], _this.rowConfigReducers, true), [_this.rowEditableReducer], false);\n        return _this;\n      }\n      class_1.prototype.onTableRowComponentReducers = function (columns) {\n        var existsEditor = columns.some(function (column) {\n          var _a;\n          return '$editable' in column && ((_a = column.$editable) === null || _a === void 0 ? void 0 : _a.editable);\n        });\n        if (existsEditor) {\n          return __spreadArray(__spreadArray([], this.tableRowComponentReducers, true), ['useEditableTableRow'], false);\n        }\n        return this.tableRowComponentReducers;\n      };\n      class_1.prototype.onTableCellComponentReducers = function (columns) {\n        var existsEditor = columns.some(function (column) {\n          var _a;\n          return '$editable' in column && ((_a = column.$editable) === null || _a === void 0 ? void 0 : _a.editable);\n        });\n        if (existsEditor) {\n          return __spreadArray(__spreadArray([], this.tableCellComponentReducers, true), ['useEditableTableCell'], false);\n        }\n        return this.tableCellComponentReducers;\n      };\n      /**\n       * rowEditableReducer\n       * @description 可编辑row的处理\n       * @param params\n       */\n      class_1.prototype.rowEditableReducer = function (params) {\n        var rowConfig = params.rowConfig,\n          rowIndex = params.rowIndex,\n          columns = params.columns,\n          record = params.record;\n        if (this.onEditorRow) {\n          rowConfig.$editable = this.onEditorRow({\n            rowIndex: rowIndex,\n            record: record,\n            columns: columns\n          });\n        }\n        return rowConfig;\n      };\n      /**\n       * onEditorRow\n       * @param params\n       */\n      class_1.prototype.onEditorRow = function (params) {\n        return {\n          editable: true\n        };\n      };\n      /**\n       * onEditorCell\n       * @param record\n       * @param editorConfig\n       */\n      class_1.prototype.onEditorCell = function (_a) {\n        var record = _a.record,\n          editorConfig = _a.editorConfig;\n        if (editorConfig) {\n          editorConfig.useTrigger = false;\n          if (this.state.isTableEditor) {\n            editorConfig.defaultStatus = 'edit';\n          }\n        }\n      };\n      /**\n       * onExpandedRowsChange\n       * @param expandedRows\n       */\n      class_1.prototype.onExpandedRowsChange = function (expandedRows) {\n        var _this = this;\n        return _super.prototype.onExpandedRowsChange.call(this, expandedRows).then(function () {\n          if (_this.state.isTableEditor) {\n            _this.setFieldValues(_this.getData());\n          }\n        });\n      };\n      /**\n       * setFieldValues\n       */\n      class_1.prototype.setFieldValues = function (dataSource) {\n        var _this = this;\n        var _a, _b, _c, _d, _e, _f;\n        // const dataSource = this.getData();\n        var columns = this.getTableColumns();\n        var fields = [];\n        var createFields = function createFields(_record) {\n          var _a;\n          return (columns || []).reduce(function (_r, _a) {\n            var dataIndex = _a.dataIndex,\n              $editable = _a.$editable;\n            if (dataIndex in _record && $editable && 'type' in $editable) {\n              _r[dataIndex] = _this.valueToFormItemValue({\n                type: $editable.type,\n                record: _record,\n                dataIndex: dataIndex\n              });\n            }\n            return _r;\n          }, (_a = {}, _a[_this.getRowKey()] = _record[_this.getRowKey()], _a));\n        };\n        var expandedRowKeys = this.state.expandedRowKeys;\n        var rowKey = this.getRowKey();\n        if (!!expandedRowKeys.length) {\n          var displayEls = (_c = (_b = (_a = this.tableWrapRef) === null || _a === void 0 ? void 0 : _a.current) === null || _b === void 0 ? void 0 : _b.querySelectorAll) === null || _c === void 0 ? void 0 : _c.call(_b, '.ant-table-wrapper tr[data-row-key]');\n          fields = Array.from(displayEls).map(function (el) {\n            var id = el.dataset['rowKey'];\n            var _record = (0, util_1.findRecord)(dataSource, rowKey, id);\n            return createFields(_record);\n          });\n        } else {\n          fields = dataSource.map(function (_record) {\n            return createFields(_record);\n          });\n        }\n        (_f = (_e = (_d = this.formRef) === null || _d === void 0 ? void 0 : _d.current) === null || _e === void 0 ? void 0 : _e.setFieldValue) === null || _f === void 0 ? void 0 : _f.call(_e, 'dataSource', fields);\n      };\n      /**\n       * fetchData\n       */\n      class_1.prototype.fetchData = function () {\n        var _this = this;\n        return _super.prototype.fetchData.call(this).then(function (res) {\n          _this.setFieldValues(res.data[_this.getDataKey()]);\n          _this.setState({\n            isTableEditor: false\n          });\n          return res;\n        });\n      };\n      /**\n       * render\n       * @protected\n       */\n      class_1.prototype.render = function () {\n        var _this = this;\n        return react_1.default.createElement(\"div\", {\n          className: \"\".concat(SearchTable_1.selectorPrefix, \"-wrap\")\n        }, react_1.default.createElement(antd_1.Form\n        // @ts-ignore\n        , {\n          // @ts-ignore\n          ref: this.formRef,\n          className: \"\".concat(SearchTable_1.selectorPrefix, \"-form\"),\n          component: false\n        }, react_1.default.createElement(antd_1.Form.List, {\n          name: \"dataSource\"\n        }, function (fields, operation, meta) {\n          var _a;\n          return react_1.default.createElement(SearchTable_1.SearchTableContext.Provider, {\n            value: {\n              // @ts-ignore\n              context: _this,\n              editable: {\n                tableEditable: {\n                  // @ts-ignore\n                  form: (_a = _this.formRef) === null || _a === void 0 ? void 0 : _a.current,\n                  formList: {\n                    fields: fields,\n                    operation: operation,\n                    meta: meta\n                  }\n                }\n              }\n            }\n          }, _this.renderChildren());\n        })));\n      };\n      return class_1;\n    }(SuperClass)\n  );\n}\nexports.default = default_1;"],"names":["__extends","_extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","TypeError","String","__","this","constructor","create","__assign","assign","t","s","i","n","arguments","length","apply","__createBinding","o","m","k","k2","undefined","desc","getOwnPropertyDescriptor","__esModule","writable","configurable","enumerable","get","defineProperty","__setModuleDefault","v","value","__importStar","mod","result","__spreadArray","to","from","pack","ar","l","slice","concat","antd_1","exports","require","react_1","SearchTable_1","util_1","default_1","SuperClass","class_1","_super","onTableRowComponentReducers","columns","some","column","_a","$editable","editable","tableRowComponentReducers","onTableCellComponentReducers","tableCellComponentReducers","rowEditableReducer","params","rowConfig","rowIndex","record","onEditorRow","onEditorCell","editorConfig","useTrigger","state","isTableEditor","defaultStatus","onExpandedRowsChange","expandedRows","_this","then","setFieldValues","getData","dataSource","createFields","_record","reduce","_r","dataIndex","valueToFormItemValue","type","getRowKey","displayEls","getTableColumns","fields","expandedRowKeys","rowKey","_c","_b","tableWrapRef","current","querySelectorAll","map","el","id","dataset","findRecord","_f","_e","_d","formRef","setFieldValue","fetchData","res","data","getDataKey","setState","render","default","createElement","className","selectorPrefix","Form","ref","component","List","name","operation","meta","SearchTableContext","Provider","context","tableEditable","form","formList","renderChildren","props","createRef","rowConfigReducers"],"mappings":"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"}