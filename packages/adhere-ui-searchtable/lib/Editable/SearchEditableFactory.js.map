{"version":3,"file":"SearchEditableFactory.js","sources":["Editable/SearchEditableFactory.js"],"sourcesContent":["\"use strict\";\n\nrequire(\"core-js/modules/es.object.define-property.js\");\n\nrequire(\"core-js/modules/es.object.to-string.js\");\n\nrequire(\"core-js/modules/es.array.map.js\");\n\nrequire(\"core-js/modules/es.array.reduce.js\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar tslib_1 = require(\"tslib\");\n\nvar antd_1 = require(\"antd\");\n\nvar react_1 = tslib_1.__importStar(require(\"react\"));\n\nvar SearchTable_1 = require(\"../SearchTable\");\n\nfunction default_1(SuperClass) {\n  return (\n    /** @class */\n    function (_super) {\n      tslib_1.__extends(class_1, _super);\n\n      function class_1(props) {\n        var _this = _super.call(this, props) || this;\n\n        _this.formRef = (0, react_1.createRef)();\n        _this.state = tslib_1.__assign(tslib_1.__assign({}, _this.state), {\n          isTableEditor: false\n        });\n        _this.rowConfigReducers = tslib_1.__spreadArray(tslib_1.__spreadArray([], _this.rowConfigReducers, true), [_this.rowEditableReducer], false);\n        return _this;\n      }\n\n      class_1.prototype.onTableRowComponentReducers = function (columns) {\n        var existsEditor = columns.some(function (column) {\n          var _a;\n\n          return '$editable' in column && ((_a = column.$editable) === null || _a === void 0 ? void 0 : _a.editable);\n        });\n\n        if (existsEditor) {\n          return tslib_1.__spreadArray(tslib_1.__spreadArray([], this.tableRowComponentReducers, true), ['useEditableTableRow'], false);\n        }\n\n        return this.tableRowComponentReducers;\n      };\n\n      class_1.prototype.onTableCellComponentReducers = function (columns) {\n        var existsEditor = columns.some(function (column) {\n          var _a;\n\n          return '$editable' in column && ((_a = column.$editable) === null || _a === void 0 ? void 0 : _a.editable);\n        });\n\n        if (existsEditor) {\n          return tslib_1.__spreadArray(tslib_1.__spreadArray([], this.tableCellComponentReducers, true), ['useEditableTableCell'], false);\n        }\n\n        return this.tableCellComponentReducers;\n      };\n      /**\n       * rowEditableReducer\n       * @description 可编辑row的处理\n       * @param params\n       */\n\n\n      class_1.prototype.rowEditableReducer = function (params) {\n        var rowConfig = params.rowConfig,\n            rowIndex = params.rowIndex,\n            columns = params.columns,\n            record = params.record;\n\n        if (this.onEditorRow) {\n          rowConfig.$editable = this.onEditorRow({\n            rowIndex: rowIndex,\n            record: record,\n            columns: columns\n          });\n        }\n\n        return rowConfig;\n      };\n      /**\n       * onEditorRow\n       * @param params\n       */\n\n\n      class_1.prototype.onEditorRow = function (params) {\n        return {\n          editable: true\n        };\n      };\n      /**\n       * onEditorCell\n       * @param record\n       * @param editorConfig\n       */\n\n\n      class_1.prototype.onEditorCell = function (_a) {\n        var record = _a.record,\n            editorConfig = _a.editorConfig;\n\n        if (editorConfig) {\n          editorConfig.useTrigger = false;\n\n          if (this.state.isTableEditor) {\n            editorConfig.defaultStatus = 'edit';\n          }\n        }\n      };\n      /**\n       * setFieldValues\n       */\n\n\n      class_1.prototype.setFieldValues = function () {\n        var _this = this;\n\n        var _a, _b, _c;\n\n        var dataSource = this.getData();\n        var columns = this.getTableColumns();\n        (_c = (_b = (_a = this.formRef) === null || _a === void 0 ? void 0 : _a.current) === null || _b === void 0 ? void 0 : _b.setFieldValue) === null || _c === void 0 ? void 0 : _c.call(_b, 'dataSource', (dataSource || []).map(function (_record) {\n          var _a;\n\n          return (columns || []).reduce(function (_r, _a) {\n            var dataIndex = _a.dataIndex,\n                $editable = _a.$editable;\n\n            if (dataIndex in _record && $editable && 'type' in $editable) {\n              _r[dataIndex] = _this.valueToFormItemValue({\n                type: $editable.type,\n                record: _record,\n                dataIndex: dataIndex\n              });\n            }\n\n            return _r;\n          }, (_a = {}, _a[_this.getRowKey()] = _record[_this.getRowKey()], _a));\n        }));\n      };\n      /**\n       * fetchData\n       */\n\n\n      class_1.prototype.fetchData = function () {\n        var _this = this;\n\n        return _super.prototype.fetchData.call(this).then(function (res) {\n          _this.setFieldValues();\n\n          _this.setState({\n            isTableEditor: false\n          });\n\n          return res;\n        });\n      };\n      /**\n       * render\n       * @protected\n       */\n\n\n      class_1.prototype.render = function () {\n        var _this = this;\n\n        return react_1.default.createElement(\"div\", {\n          className: \"\".concat(SearchTable_1.selectorPrefix, \"-wrap\")\n        }, react_1.default.createElement(antd_1.Form // @ts-ignore\n        , {\n          // @ts-ignore\n          ref: this.formRef,\n          className: \"\".concat(SearchTable_1.selectorPrefix, \"-form\"),\n          component: false\n        }, react_1.default.createElement(antd_1.Form.List, {\n          name: \"dataSource\"\n        }, function (fields, operation, meta) {\n          var _a;\n\n          return react_1.default.createElement(SearchTable_1.SearchTableContext.Provider, {\n            value: {\n              // @ts-ignore\n              context: _this,\n              editable: {\n                tableEditable: {\n                  // @ts-ignore\n                  form: (_a = _this.formRef) === null || _a === void 0 ? void 0 : _a.current,\n                  formList: {\n                    fields: fields,\n                    operation: operation,\n                    meta: meta\n                  }\n                }\n              }\n            }\n          }, _this.renderChildren());\n        })));\n      };\n\n      return class_1;\n    }(SuperClass)\n  );\n}\n\nexports.default = default_1;"],"names":["require","Object","defineProperty","exports","value","tslib_1","antd_1","react_1","__importStar","SearchTable_1","default_1","SuperClass","_super","__extends","class_1","prototype","onTableRowComponentReducers","columns","some","column","_a","$editable","editable","__spreadArray","this","tableRowComponentReducers","onTableCellComponentReducers","tableCellComponentReducers","rowEditableReducer","params","rowConfig","rowIndex","record","onEditorRow","onEditorCell","editorConfig","useTrigger","state","isTableEditor","defaultStatus","setFieldValues","_b","_c","_this","dataSource","getData","getTableColumns","formRef","current","setFieldValue","call","map","_record","reduce","_r","dataIndex","valueToFormItemValue","type","getRowKey","fetchData","then","res","setState","render","default","createElement","className","concat","selectorPrefix","Form","ref","component","List","name","fields","operation","meta","SearchTableContext","Provider","context","tableEditable","form","formList","renderChildren","props","createRef","__assign","rowConfigReducers"],"mappings":"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"}