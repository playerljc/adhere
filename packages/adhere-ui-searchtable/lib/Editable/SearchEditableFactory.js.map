{"version":3,"file":"SearchEditableFactory.js","sources":["Editable/SearchEditableFactory.js"],"sourcesContent":["\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar tslib_1 = require(\"tslib\");\r\nvar antd_1 = require(\"antd\");\r\nvar react_1 = tslib_1.__importStar(require(\"react\"));\r\nvar SearchTable_1 = require(\"../SearchTable\");\r\nfunction default_1(SuperClass) {\r\n    return /** @class */ (function (_super) {\r\n        tslib_1.__extends(class_1, _super);\r\n        function class_1(props) {\r\n            var _this = _super.call(this, props) || this;\r\n            _this.formRef = react_1.createRef();\r\n            _this.state = tslib_1.__assign(tslib_1.__assign({}, _this.state), { isTableEditor: false });\r\n            _this.rowConfigReducers = tslib_1.__spreadArrays(_this.rowConfigReducers, [_this.rowEditableReducer]);\r\n            return _this;\r\n        }\r\n        class_1.prototype.onTableRowComponentReducers = function (columns) {\r\n            var existsEditor = columns.some(function (column) { var _a; return '$editable' in column && ((_a = column.$editable) === null || _a === void 0 ? void 0 : _a.editable); });\r\n            if (existsEditor) {\r\n                return tslib_1.__spreadArrays(this.tableRowComponentReducers, ['useEditableTableRow']);\r\n            }\r\n            return this.tableRowComponentReducers;\r\n        };\r\n        class_1.prototype.onTableCellComponentReducers = function (columns) {\r\n            var existsEditor = columns.some(function (column) { var _a; return '$editable' in column && ((_a = column.$editable) === null || _a === void 0 ? void 0 : _a.editable); });\r\n            if (existsEditor) {\r\n                return tslib_1.__spreadArrays(this.tableCellComponentReducers, ['useEditableTableCell']);\r\n            }\r\n            return this.tableCellComponentReducers;\r\n        };\r\n        /**\r\n         * rowEditableReducer\r\n         * @description 可编辑row的处理\r\n         * @param params\r\n         */\r\n        class_1.prototype.rowEditableReducer = function (params) {\r\n            var rowConfig = params.rowConfig, rowIndex = params.rowIndex, columns = params.columns, record = params.record;\r\n            if (this.onEditorRow) {\r\n                rowConfig.$editable = this.onEditorRow({\r\n                    rowIndex: rowIndex,\r\n                    record: record,\r\n                    columns: columns,\r\n                });\r\n            }\r\n            return rowConfig;\r\n        };\r\n        /**\r\n         * onEditorRow\r\n         * @param params\r\n         */\r\n        class_1.prototype.onEditorRow = function (params) {\r\n            return {\r\n                editable: true,\r\n            };\r\n        };\r\n        /**\r\n         * onEditorCell\r\n         * @param record\r\n         * @param editorConfig\r\n         */\r\n        class_1.prototype.onEditorCell = function (_a) {\r\n            var record = _a.record, editorConfig = _a.editorConfig;\r\n            if (editorConfig) {\r\n                editorConfig.useTrigger = false;\r\n                if (this.state.isTableEditor) {\r\n                    editorConfig.defaultStatus = 'edit';\r\n                }\r\n            }\r\n        };\r\n        /**\r\n         * setFieldValues\r\n         */\r\n        class_1.prototype.setFieldValues = function (dataSource) {\r\n            var _this = this;\r\n            var _a, _b, _c;\r\n            // const dataSource = this.getData();\r\n            var columns = this.getTableColumns();\r\n            (_c = (_b = (_a = this.formRef) === null || _a === void 0 ? void 0 : _a.current) === null || _b === void 0 ? void 0 : _b.setFieldValue) === null || _c === void 0 ? void 0 : _c.call(_b, 'dataSource', (dataSource || []).map(function (_record) {\r\n                var _a;\r\n                return (columns || []).reduce(function (_r, _a) {\r\n                    var dataIndex = _a.dataIndex, $editable = _a.$editable;\r\n                    if (dataIndex in _record && $editable && 'type' in $editable) {\r\n                        _r[dataIndex] = _this.valueToFormItemValue({\r\n                            type: $editable.type,\r\n                            record: _record,\r\n                            dataIndex: dataIndex,\r\n                        });\r\n                    }\r\n                    return _r;\r\n                }, (_a = {}, _a[_this.getRowKey()] = _record[_this.getRowKey()], _a));\r\n            }));\r\n        };\r\n        /**\r\n         * fetchData\r\n         */\r\n        class_1.prototype.fetchData = function () {\r\n            var _this = this;\r\n            return _super.prototype.fetchData.call(this).then(function (res) {\r\n                _this.setFieldValues(res.data[_this.getDataKey()]);\r\n                _this.setState({\r\n                    isTableEditor: false,\r\n                });\r\n                return res;\r\n            });\r\n        };\r\n        /**\r\n         * render\r\n         * @protected\r\n         */\r\n        class_1.prototype.render = function () {\r\n            var _this = this;\r\n            return (react_1.default.createElement(\"div\", { className: SearchTable_1.selectorPrefix + \"-wrap\" },\r\n                react_1.default.createElement(antd_1.Form\r\n                // @ts-ignore\r\n                , { \r\n                    // @ts-ignore\r\n                    ref: this.formRef, className: SearchTable_1.selectorPrefix + \"-form\", component: false },\r\n                    react_1.default.createElement(antd_1.Form.List, { name: \"dataSource\" }, function (fields, operation, meta) {\r\n                        var _a;\r\n                        return (react_1.default.createElement(SearchTable_1.SearchTableContext.Provider, { value: {\r\n                                // @ts-ignore\r\n                                context: _this,\r\n                                editable: {\r\n                                    tableEditable: {\r\n                                        // @ts-ignore\r\n                                        form: (_a = _this.formRef) === null || _a === void 0 ? void 0 : _a.current,\r\n                                        formList: {\r\n                                            fields: fields,\r\n                                            operation: operation,\r\n                                            meta: meta,\r\n                                        },\r\n                                    },\r\n                                },\r\n                            } }, _this.renderChildren()));\r\n                    }))));\r\n        };\r\n        return class_1;\r\n    }(SuperClass));\r\n}\r\nexports.default = default_1;\r\n//# sourceMappingURL=SearchEditableFactory.js.map"],"names":["Object","defineProperty","exports","value","tslib_1","require","antd_1","react_1","__importStar","SearchTable_1","default_1","SuperClass","_super","__extends","class_1","prototype","onTableRowComponentReducers","columns","some","column","_a","$editable","editable","__spreadArrays","this","tableRowComponentReducers","onTableCellComponentReducers","tableCellComponentReducers","rowEditableReducer","params","rowConfig","rowIndex","record","onEditorRow","onEditorCell","editorConfig","useTrigger","state","isTableEditor","defaultStatus","setFieldValues","dataSource","_b","_c","_this","getTableColumns","formRef","current","setFieldValue","call","map","_record","reduce","_r","dataIndex","valueToFormItemValue","type","getRowKey","fetchData","then","res","data","getDataKey","setState","render","default","createElement","className","selectorPrefix","Form","ref","component","List","name","fields","operation","meta","SearchTableContext","Provider","context","tableEditable","form","formList","renderChildren","props","createRef","__assign","rowConfigReducers"],"mappings":"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"}