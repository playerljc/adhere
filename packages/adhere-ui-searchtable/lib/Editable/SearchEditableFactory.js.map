{"version":3,"file":"SearchEditableFactory.js","sources":["Editable/SearchEditableFactory.js"],"sourcesContent":["\"use strict\";\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        if (typeof b !== \"function\" && b !== null)\r\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __assign = (this && this.__assign) || function () {\r\n    __assign = Object.assign || function(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n                t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    var desc = Object.getOwnPropertyDescriptor(m, k);\r\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\r\n      desc = { enumerable: true, get: function() { return m[k]; } };\r\n    }\r\n    Object.defineProperty(o, k2, desc);\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}));\r\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n});\r\nvar __importStar = (this && this.__importStar) || function (mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n};\r\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\r\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\r\n        if (ar || !(i in from)) {\r\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\r\n            ar[i] = from[i];\r\n        }\r\n    }\r\n    return to.concat(ar || Array.prototype.slice.call(from));\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar antd_1 = require(\"antd\");\r\nvar react_1 = __importStar(require(\"react\"));\r\nvar SearchTable_1 = require(\"../SearchTable\");\r\nfunction default_1(SuperClass) {\r\n    return /** @class */ (function (_super) {\r\n        __extends(class_1, _super);\r\n        function class_1(props) {\r\n            var _this = _super.call(this, props) || this;\r\n            _this.formRef = (0, react_1.createRef)();\r\n            _this.state = __assign(__assign({}, _this.state), { isTableEditor: false });\r\n            _this.rowConfigReducers = __spreadArray(__spreadArray([], _this.rowConfigReducers, true), [_this.rowEditableReducer], false);\r\n            return _this;\r\n        }\r\n        class_1.prototype.onTableRowComponentReducers = function (columns) {\r\n            var existsEditor = columns.some(function (column) { var _a; return '$editable' in column && ((_a = column.$editable) === null || _a === void 0 ? void 0 : _a.editable); });\r\n            if (existsEditor) {\r\n                return __spreadArray(__spreadArray([], this.tableRowComponentReducers, true), ['useEditableTableRow'], false);\r\n            }\r\n            return this.tableRowComponentReducers;\r\n        };\r\n        class_1.prototype.onTableCellComponentReducers = function (columns) {\r\n            var existsEditor = columns.some(function (column) { var _a; return '$editable' in column && ((_a = column.$editable) === null || _a === void 0 ? void 0 : _a.editable); });\r\n            if (existsEditor) {\r\n                return __spreadArray(__spreadArray([], this.tableCellComponentReducers, true), ['useEditableTableCell'], false);\r\n            }\r\n            return this.tableCellComponentReducers;\r\n        };\r\n        /**\r\n         * rowEditableReducer\r\n         * @description 可编辑row的处理\r\n         * @param params\r\n         */\r\n        class_1.prototype.rowEditableReducer = function (params) {\r\n            var rowConfig = params.rowConfig, rowIndex = params.rowIndex, columns = params.columns, record = params.record;\r\n            if (this.onEditorRow) {\r\n                rowConfig.$editable = this.onEditorRow({\r\n                    rowIndex: rowIndex,\r\n                    record: record,\r\n                    columns: columns,\r\n                });\r\n            }\r\n            return rowConfig;\r\n        };\r\n        /**\r\n         * onEditorRow\r\n         * @param params\r\n         */\r\n        class_1.prototype.onEditorRow = function (params) {\r\n            return {\r\n                editable: true,\r\n            };\r\n        };\r\n        /**\r\n         * onEditorCell\r\n         * @param record\r\n         * @param editorConfig\r\n         */\r\n        class_1.prototype.onEditorCell = function (_a) {\r\n            var record = _a.record, editorConfig = _a.editorConfig;\r\n            if (editorConfig) {\r\n                editorConfig.useTrigger = false;\r\n                if (this.state.isTableEditor) {\r\n                    editorConfig.defaultStatus = 'edit';\r\n                }\r\n            }\r\n        };\r\n        /**\r\n         * setFieldValues\r\n         */\r\n        class_1.prototype.setFieldValues = function (dataSource) {\r\n            var _this = this;\r\n            var _a, _b, _c;\r\n            // const dataSource = this.getData();\r\n            var columns = this.getTableColumns();\r\n            (_c = (_b = (_a = this.formRef) === null || _a === void 0 ? void 0 : _a.current) === null || _b === void 0 ? void 0 : _b.setFieldValue) === null || _c === void 0 ? void 0 : _c.call(_b, 'dataSource', (dataSource || []).map(function (_record) {\r\n                var _a;\r\n                return (columns || []).reduce(function (_r, _a) {\r\n                    var dataIndex = _a.dataIndex, $editable = _a.$editable;\r\n                    if (dataIndex in _record && $editable && 'type' in $editable) {\r\n                        _r[dataIndex] = _this.valueToFormItemValue({\r\n                            type: $editable.type,\r\n                            record: _record,\r\n                            dataIndex: dataIndex,\r\n                        });\r\n                    }\r\n                    return _r;\r\n                }, (_a = {}, _a[_this.getRowKey()] = _record[_this.getRowKey()], _a));\r\n            }));\r\n        };\r\n        /**\r\n         * fetchData\r\n         */\r\n        class_1.prototype.fetchData = function () {\r\n            var _this = this;\r\n            return _super.prototype.fetchData.call(this).then(function (res) {\r\n                _this.setFieldValues(res.data[_this.getDataKey()]);\r\n                _this.setState({\r\n                    isTableEditor: false,\r\n                });\r\n                return res;\r\n            });\r\n        };\r\n        /**\r\n         * render\r\n         * @protected\r\n         */\r\n        class_1.prototype.render = function () {\r\n            var _this = this;\r\n            return (react_1.default.createElement(\"div\", { className: \"\".concat(SearchTable_1.selectorPrefix, \"-wrap\") },\r\n                react_1.default.createElement(antd_1.Form\r\n                // @ts-ignore\r\n                , { \r\n                    // @ts-ignore\r\n                    ref: this.formRef, className: \"\".concat(SearchTable_1.selectorPrefix, \"-form\"), component: false },\r\n                    react_1.default.createElement(antd_1.Form.List, { name: \"dataSource\" }, function (fields, operation, meta) {\r\n                        var _a;\r\n                        return (react_1.default.createElement(SearchTable_1.SearchTableContext.Provider, { value: {\r\n                                // @ts-ignore\r\n                                context: _this,\r\n                                editable: {\r\n                                    tableEditable: {\r\n                                        // @ts-ignore\r\n                                        form: (_a = _this.formRef) === null || _a === void 0 ? void 0 : _a.current,\r\n                                        formList: {\r\n                                            fields: fields,\r\n                                            operation: operation,\r\n                                            meta: meta,\r\n                                        },\r\n                                    },\r\n                                },\r\n                            } }, _this.renderChildren()));\r\n                    }))));\r\n        };\r\n        return class_1;\r\n    }(SuperClass));\r\n}\r\nexports.default = default_1;\r\n"],"names":["__extends","this","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","TypeError","String","__","constructor","create","__assign","assign","t","s","i","n","arguments","length","apply","__createBinding","o","m","k","k2","undefined","desc","getOwnPropertyDescriptor","__esModule","writable","configurable","enumerable","get","defineProperty","__setModuleDefault","v","value","__importStar","mod","result","__spreadArray","to","from","pack","ar","l","slice","concat","antd_1","exports","require","react_1","SearchTable_1","default_1","SuperClass","class_1","_super","onTableRowComponentReducers","columns","some","column","_a","$editable","editable","tableRowComponentReducers","onTableCellComponentReducers","tableCellComponentReducers","rowEditableReducer","params","rowConfig","rowIndex","record","onEditorRow","onEditorCell","editorConfig","useTrigger","state","isTableEditor","defaultStatus","setFieldValues","dataSource","_b","_c","_this","getTableColumns","formRef","current","setFieldValue","map","_record","reduce","_r","dataIndex","valueToFormItemValue","type","getRowKey","fetchData","then","res","data","getDataKey","setState","render","default","createElement","className","selectorPrefix","Form","ref","component","List","name","fields","operation","meta","SearchTableContext","Provider","context","tableEditable","form","formList","renderChildren","props","createRef","rowConfigReducers"],"mappings":"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"}