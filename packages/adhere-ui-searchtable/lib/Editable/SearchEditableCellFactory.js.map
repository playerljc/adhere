{"version":3,"file":"SearchEditableCellFactory.js","sources":["Editable/SearchEditableCellFactory.js"],"sourcesContent":["\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar tslib_1 = require(\"tslib\");\r\nvar dayjs_1 = tslib_1.__importDefault(require(\"dayjs\"));\r\nfunction default_1(SuperClass) {\r\n    return /** @class */ (function (_super) {\r\n        tslib_1.__extends(class_1, _super);\r\n        function class_1(props) {\r\n            var _this = _super.call(this, props) || this;\r\n            /**\r\n             * valueToFormItemValueMap\r\n             * @description 值和表单控件值之间的转换，现在只涉及到时间控件\r\n             */\r\n            _this.valueToFormItemValueMap = new Map([\r\n                [\r\n                    'rangePicker',\r\n                    function (_a) {\r\n                        var record = _a.record, dataIndex = _a.dataIndex;\r\n                        var value = record === null || record === void 0 ? void 0 : record[dataIndex];\r\n                        return Array.isArray(value) && value.length === 2\r\n                            ? [dayjs_1.default(value[0]), dayjs_1.default(value[1])]\r\n                            : [dayjs_1.default(), dayjs_1.default()];\r\n                    },\r\n                ],\r\n                [\r\n                    'datePicker',\r\n                    function (_a) {\r\n                        var record = _a.record, dataIndex = _a.dataIndex;\r\n                        var value = record === null || record === void 0 ? void 0 : record[dataIndex];\r\n                        return dayjs_1.default(value);\r\n                    },\r\n                ],\r\n                [\r\n                    'timePicker',\r\n                    function (_a) {\r\n                        var record = _a.record, dataIndex = _a.dataIndex;\r\n                        var value = record === null || record === void 0 ? void 0 : record[dataIndex];\r\n                        return dayjs_1.default(value);\r\n                    },\r\n                ],\r\n            ]);\r\n            _this.state = tslib_1.__assign(tslib_1.__assign({}, _this.state), { activeValue: '' });\r\n            _this.cellConfigReducers = tslib_1.__spreadArrays(_this.cellConfigReducers, [_this.cellEditableReducer]);\r\n            return _this;\r\n        }\r\n        /**\r\n         * onTableRowComponentReducers\r\n         * @param columns\r\n         */\r\n        class_1.prototype.onTableRowComponentReducers = function (columns) {\r\n            var existsEditable = columns.some(function (column) { var _a; return '$editable' in column && ((_a = column.$editable) === null || _a === void 0 ? void 0 : _a.editable); });\r\n            if (existsEditable) {\r\n                return tslib_1.__spreadArrays(this.tableRowComponentReducers, ['useEditableRow']);\r\n            }\r\n            return this.tableRowComponentReducers;\r\n        };\r\n        /**\r\n         * onTableCellComponentReducers\r\n         * @param columns\r\n         */\r\n        class_1.prototype.onTableCellComponentReducers = function (columns) {\r\n            var existsEditor = columns.some(function (column) { var _a; return '$editable' in column && ((_a = column.$editable) === null || _a === void 0 ? void 0 : _a.editable); });\r\n            if (existsEditor) {\r\n                return tslib_1.__spreadArrays(this.tableCellComponentReducers, ['useEditableCell']);\r\n            }\r\n            return this.tableCellComponentReducers;\r\n        };\r\n        class_1.prototype.onEditorRow = function (params) {\r\n            return {\r\n                editable: false,\r\n            };\r\n        };\r\n        class_1.prototype.onEditorCell = function (params) { };\r\n        /**\r\n         * cellEditableReducer\r\n         * @description 可编辑单元格的onCell处理\r\n         * @param params\r\n         */\r\n        class_1.prototype.cellEditableReducer = function (params) {\r\n            var _a;\r\n            var rowIndex = params.rowIndex, column = params.column, record = params.record;\r\n            // 如果设置了$editable则调用onEditorCell方法对每个cell进行props注入\r\n            if ('$editable' in column && ((_a = column.$editable) === null || _a === void 0 ? void 0 : _a.editable) && this.onEditorCell) {\r\n                this.onEditorCell({\r\n                    rowIndex: rowIndex,\r\n                    editorConfig: column.$editable,\r\n                    record: tslib_1.__assign({}, record),\r\n                });\r\n                return column;\r\n            }\r\n            return column;\r\n        };\r\n        /**\r\n         * valueToFormItemValue\r\n         * @description 值和表单值的转换\r\n         */\r\n        class_1.prototype.valueToFormItemValue = function (_a) {\r\n            var type = _a.type, record = _a.record, dataIndex = _a.dataIndex;\r\n            var item = this.valueToFormItemValueMap.get(type);\r\n            return item ? item === null || item === void 0 ? void 0 : item({ record: record, dataIndex: dataIndex }) : record === null || record === void 0 ? void 0 : record[dataIndex];\r\n        };\r\n        /**\r\n         * setActiveValue\r\n         * @param activeValue\r\n         */\r\n        class_1.prototype.setActiveValue = function (activeValue) {\r\n            var _this = this;\r\n            return new Promise(function (resolve) {\r\n                _this.setState({\r\n                    activeValue: activeValue,\r\n                }, function () { return resolve(); });\r\n            });\r\n        };\r\n        /**\r\n         * getActiveValue\r\n         */\r\n        class_1.prototype.getActiveValue = function () {\r\n            return this.state.activeValue;\r\n        };\r\n        return class_1;\r\n    }(SuperClass));\r\n}\r\nexports.default = default_1;\r\n//# sourceMappingURL=SearchEditableCellFactory.js.map"],"names":["Object","defineProperty","exports","value","tslib_1","require","dayjs_1","__importDefault","default_1","SuperClass","_super","__extends","class_1","prototype","onTableRowComponentReducers","columns","some","column","_a","$editable","editable","__spreadArrays","this","tableRowComponentReducers","onTableCellComponentReducers","tableCellComponentReducers","onEditorRow","params","onEditorCell","cellEditableReducer","rowIndex","record","editorConfig","__assign","valueToFormItemValue","type","dataIndex","item","valueToFormItemValueMap","get","setActiveValue","activeValue","_this","Promise","resolve","setState","getActiveValue","state","props","call","Map","Array","isArray","length","default","cellConfigReducers"],"mappings":"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"}