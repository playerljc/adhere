{"version":3,"file":"SearchEditorRowStateTable.js","sources":["SearchEditorRowStateTable.js"],"sourcesContent":["\"use strict\";\n\nrequire(\"core-js/modules/es.object.define-property.js\");\n\nrequire(\"core-js/modules/es.array.iterator.js\");\n\nrequire(\"core-js/modules/es.object.to-string.js\");\n\nrequire(\"core-js/modules/web.dom-collections.iterator.js\");\n\nrequire(\"core-js/modules/es.promise.js\");\n\nrequire(\"core-js/modules/es.object.keys.js\");\n\nrequire(\"core-js/modules/web.dom-collections.for-each.js\");\n\nrequire(\"core-js/modules/es.array.find.js\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar tslib_1 = require(\"tslib\");\n\nvar lodash_clonedeep_1 = tslib_1.__importDefault(require(\"lodash.clonedeep\"));\n\nvar moment_1 = tslib_1.__importDefault(require(\"moment\"));\n\nvar SearchEditorCellStateTable_1 = tslib_1.__importDefault(require(\"./SearchEditorCellStateTable\"));\n/**\n * SearchEditorRowTable\n * @class\n * @classdesc 行可编辑的表格\n */\n\n\nvar SearchEditorRowStateTable =\n/** @class */\nfunction (_super) {\n  tslib_1.__extends(SearchEditorRowStateTable, _super);\n\n  function SearchEditorRowStateTable(props) {\n    var _this = _super.call(this, props) || this;\n\n    _this.state = tslib_1.__assign(tslib_1.__assign({}, _this.state), {\n      editorRowId: ''\n    });\n    _this.rowReducers = tslib_1.__spreadArray(tslib_1.__spreadArray([], _this.rowReducers, true), [_this.rowEditableReducer], false);\n    return _this;\n  }\n  /**\n   * updateEditorCellRowData\n   * @description 更新可编辑单元格一行的数据\n   * @param values 一行的数据\n   * @param record\n   * @return Promise<void>\n   */\n\n\n  SearchEditorRowStateTable.prototype.updateEditorCellRowData = function (_a) {\n    var _this = this;\n\n    var values = _a.values,\n        record = _a.record;\n    return new Promise(function (resolve) {\n      var _a;\n\n      var listData = (0, lodash_clonedeep_1.default)(_this.state[_this.getServiceName()]);\n      var dataSource = listData[_this.getFetchListPropName()][_this.getDataKey()] || [];\n\n      var rowKey = _this.getRowKey();\n\n      var keys = Object.keys(values);\n      keys.forEach(function (dataIndex) {\n        var value = values[dataIndex];\n\n        if (value instanceof moment_1.default) {\n          value = value.valueOf();\n        }\n\n        var recordItem = dataSource.find(function (t) {\n          return t[rowKey] === record[rowKey];\n        });\n\n        if (recordItem) {\n          recordItem[dataIndex] = value;\n        }\n      });\n\n      _this.setState((_a = {}, _a[_this.getServiceName()] = listData, _a), function () {\n        return resolve();\n      });\n    });\n  };\n  /**\n   * rowEditableReducer\n   * @description 可编辑row的处理\n   * @param params\n   */\n\n\n  SearchEditorRowStateTable.prototype.rowEditableReducer = function (params) {\n    var rowConfig = params.rowConfig,\n        rowIndex = params.rowIndex,\n        columns = params.columns,\n        record = params.record;\n\n    if (this.onEditorRow) {\n      rowConfig.$editable = this.onEditorRow({\n        rowIndex: rowIndex,\n        record: record,\n        columns: columns\n      });\n    }\n\n    return rowConfig;\n  };\n  /**\n   * onEditorRow\n   * @param params\n   */\n\n\n  SearchEditorRowStateTable.prototype.onEditorRow = function (params) {\n    return {\n      editable: true\n    };\n  };\n  /**\n   * onEditorCell\n   * @param record\n   * @param editorConfig\n   */\n\n\n  SearchEditorRowStateTable.prototype.onEditorCell = function (_a) {\n    var record = _a.record,\n        editorConfig = _a.editorConfig;\n\n    if (editorConfig) {\n      editorConfig.useTrigger = false;\n\n      if (record[this.getRowKey()] === this.state.editorRowId) {\n        editorConfig.defaultStatus = 'edit';\n      }\n    }\n  };\n  /**\n   * fetchData\n   */\n\n\n  SearchEditorRowStateTable.prototype.fetchData = function () {\n    var _this = this;\n\n    return _super.prototype.fetchData.call(this).then(function (res) {\n      _this.setState({\n        editorRowId: ''\n      });\n\n      return res;\n    });\n  };\n\n  return SearchEditorRowStateTable;\n}(SearchEditorCellStateTable_1.default);\n\nexports.default = SearchEditorRowStateTable;"],"names":["require","Object","defineProperty","exports","value","tslib_1","lodash_clonedeep_1","__importDefault","moment_1","SearchEditorCellStateTable_1","SearchEditorRowStateTable","_super","props","_this","call","this","state","__assign","editorRowId","rowReducers","__spreadArray","rowEditableReducer","__extends","prototype","updateEditorCellRowData","_a","values","record","Promise","resolve","listData","default","getServiceName","dataSource","getFetchListPropName","getDataKey","rowKey","getRowKey","keys","forEach","dataIndex","recordItem","valueOf","find","t","setState","params","rowConfig","rowIndex","columns","onEditorRow","$editable","editable","onEditorCell","editorConfig","useTrigger","defaultStatus","fetchData","then","res"],"mappings":"AAAA,aAEAA,QAAQ,8CAA8C,EAEtDA,QAAQ,sCAAsC,EAE9CA,QAAQ,wCAAwC,EAEhDA,QAAQ,iDAAiD,EAEzDA,QAAQ,+BAA+B,EAEvCA,QAAQ,mCAAmC,EAE3CA,QAAQ,iDAAiD,EAEzDA,QAAQ,kCAAkC,EAE1CC,OAAOC,eAAeC,QAAS,aAAc,CAC3CC,MAAO,CAAA,CACT,CAAC,EAED,IAAIC,QAAUL,QAAQ,OAAO,EAEzBM,mBAAqBD,QAAQE,gBAAgBP,QAAQ,kBAAkB,CAAC,EAExEQ,SAAWH,QAAQE,gBAAgBP,QAAQ,QAAQ,CAAC,EAEpDS,6BAA+BJ,QAAQE,gBAAgBP,QAAQ,8BAA8B,CAAC,EAQ9FU,0BAEJ,SAAUC,GAGR,SAASD,EAA0BE,GAC7BC,EAAQF,EAAOG,KAAKC,KAAMH,CAAK,GAAKG,KAMxC,OAJAF,EAAMG,MAAQX,QAAQY,SAASZ,QAAQY,SAAS,GAAIJ,EAAMG,KAAK,EAAG,CAChEE,YAAa,EACf,CAAC,EACDL,EAAMM,YAAcd,QAAQe,cAAcf,QAAQe,cAAc,GAAIP,EAAMM,YAAa,CAAA,CAAI,EAAG,CAACN,EAAMQ,oBAAqB,CAAA,CAAK,EACxHR,CACT,CAmHA,OA7HAR,QAAQiB,UAAUZ,EAA2BC,CAAM,EAoBnDD,EAA0Ba,UAAUC,wBAA0B,SAAUC,GACtE,IAAIZ,EAAQE,KAERW,EAASD,EAAGC,OACZC,EAASF,EAAGE,OAChB,OAAO,IAAIC,QAAQ,SAAUC,GAC3B,IAAIJ,EAEAK,GAAW,EAAIxB,mBAAmByB,SAASlB,EAAMG,MAAMH,EAAMmB,eAAe,EAAE,EAC9EC,EAAaH,EAASjB,EAAMqB,qBAAqB,GAAGrB,EAAMsB,WAAW,IAAM,GAE3EC,EAASvB,EAAMwB,UAAU,EAElBpC,OAAOqC,KAAKZ,CAAM,EACxBa,QAAQ,SAAUC,GACrB,IAAIpC,EAAQsB,EAAOc,GAMfC,GAJArC,aAAiBI,SAASuB,UAC5B3B,EAAQA,EAAMsC,QAAQ,GAGPT,EAAWU,KAAK,SAAUC,GACzC,OAAOA,EAAER,KAAYT,EAAOS,EAC9B,CAAC,GAEGK,IACFA,EAAWD,GAAapC,EAE5B,CAAC,EAEDS,EAAMgC,WAAUpB,EAAK,IAAOZ,EAAMmB,eAAe,GAAKF,EAAUL,GAAK,WACnE,OAAOI,EAAQ,CACjB,CAAC,CACH,CAAC,CACH,EAQAnB,EAA0Ba,UAAUF,mBAAqB,SAAUyB,GACjE,IAAIC,EAAYD,EAAOC,UACnBC,EAAWF,EAAOE,SAClBC,EAAUH,EAAOG,QACjBtB,EAASmB,EAAOnB,OAUpB,OARIZ,KAAKmC,cACPH,EAAUI,UAAYpC,KAAKmC,YAAY,CACrCF,SAAUA,EACVrB,OAAQA,EACRsB,QAASA,CACX,CAAC,GAGIF,CACT,EAOArC,EAA0Ba,UAAU2B,YAAc,SAAUJ,GAC1D,MAAO,CACLM,SAAU,CAAA,CACZ,CACF,EAQA1C,EAA0Ba,UAAU8B,aAAe,SAAU5B,GAC3D,IAAIE,EAASF,EAAGE,OACZ2B,EAAe7B,EAAG6B,aAElBA,IACFA,EAAaC,WAAa,CAAA,EAEtB5B,EAAOZ,KAAKsB,UAAU,KAAOtB,KAAKC,MAAME,cAC1CoC,EAAaE,cAAgB,QAGnC,EAMA9C,EAA0Ba,UAAUkC,UAAY,WAC9C,IAAI5C,EAAQE,KAEZ,OAAOJ,EAAOY,UAAUkC,UAAU3C,KAAKC,IAAI,EAAE2C,KAAK,SAAUC,GAK1D,OAJA9C,EAAMgC,SAAS,CACb3B,YAAa,EACf,CAAC,EAEMyC,CACT,CAAC,CACH,EAEOjD,CACT,EAAED,6BAA6BsB,OAAO,EAEtC5B,QAAQ4B,QAAUrB"}