"use strict";require("core-js/modules/es.array.iterator.js"),require("core-js/modules/es.string.iterator.js"),require("core-js/modules/es.weak-map.js"),require("core-js/modules/esnext.weak-map.delete-all.js"),require("core-js/modules/web.dom-collections.iterator.js"),require("core-js/modules/es.object.define-property.js"),require("core-js/modules/es.object.get-own-property-descriptor.js");var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_typeof=require("@babel/runtime/helpers/typeof");Object.defineProperty(exports,"__esModule",{value:!0}),exports.selectorPrefix=exports.propTypes=exports.defaultProps=exports.default=void 0;var _table=_interopRequireDefault(require("antd/lib/table")),_button=_interopRequireDefault(require("antd/lib/button"));require("core-js/modules/es.array.map.js"),require("core-js/modules/es.object.to-string.js"),require("core-js/modules/es.regexp.to-string.js"),require("core-js/modules/es.array.find.js"),require("core-js/modules/es.array.filter.js"),require("core-js/modules/es.array.concat.js"),require("core-js/modules/es.array.sort.js"),require("core-js/modules/es.regexp.exec.js"),require("core-js/modules/es.string.split.js"),require("core-js/modules/es.symbol.js"),require("core-js/modules/es.symbol.description.js");var _tslib=require("tslib"),_react=_interopRequireWildcard(require("react")),_propTypes=_interopRequireDefault(require("prop-types")),_classnames=_interopRequireDefault(require("classnames")),_adhereUiFlexlayout=_interopRequireDefault(require("@baifendian/adhere-ui-flexlayout")),_adhereUiSuspense=_interopRequireDefault(require("@baifendian/adhere-ui-suspense")),_adhereUtilIntl=_interopRequireDefault(require("@baifendian/adhere-util-intl")),_adhereUiConditionalrender=_interopRequireDefault(require("@baifendian/adhere-ui-conditionalrender")),_ColumnResizable=_interopRequireWildcard(require("./Extension/ColumnResizable")),_ColumnSetting=_interopRequireDefault(require("./Extension/ColumnSetting")),_TableDensitySetting=_interopRequireDefault(require("./Extension/TableDensitySetting")),_types=require("./types"),_searchform=_interopRequireDefault(require("./searchform"));function _getRequireWildcardCache(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(_getRequireWildcardCache=function(e){return e?r:t})(e)}function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==_typeof(e)&&"function"!=typeof e)return{default:e};t=_getRequireWildcardCache(t);if(t&&t.has(e))return t.get(e);var r,a,i={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&((a=l?Object.getOwnPropertyDescriptor(e,r):null)&&(a.get||a.set)?Object.defineProperty(i,r,a):i[r]=e[r]);return i.default=e,t&&t.set(e,i),i}var selectorPrefix="adhere-ui-searchtable";exports.selectorPrefix=selectorPrefix;var Fixed=_adhereUiFlexlayout.default.Fixed,Auto=_adhereUiFlexlayout.default.Auto,SearchTable=function(t){function s(e){var i=t.call(this,e)||this;return i.tableWrapRef=(0,_react.createRef)(),i.components={header:{cell:_ColumnResizable.SearchTableResizableTitle}},i.columnResizable=new _ColumnResizable.default,i.columnObserver=null,i.onTableChange=function(e,t,r){var a;i.setState(((a={})[i.getOrderFieldProp()]=r.field,a[i.getOrderProp()]=r.order,a),function(){r.order&&(i.fetchData(),i.onSubTableChange(e,t,r))})},i.state={page:1,limit:10,expand:e.defaultExpandSearchCollapse,scrollY:0},i.state=(0,_tslib.__assign)((0,_tslib.__assign)({},i.state),{columnSetting:i.getTableColumns().map(function(e,t){return(0,_tslib.__assign)((0,_tslib.__assign)({},e),{sort:t,display:!0})}),tableDensity:i.getTableDensity()}),i.onClear=i.onClear.bind(i),i}return(0,_tslib.__extends)(s,t),s.prototype.componentWillReceiveProps=function(e){t.prototype.componentWillReceiveProps.call(this,e),this.columnSettingEffect(e)},s.prototype.componentDidUpdate=function(e,t,r){this.tableWrapRef.current&&(this.searchTableResizableEffectLayout(),this.fixedHeaderAutoTableEffectLayout(e,t))},s.prototype.searchTableResizableEffectLayout=function(){this.columnObserver||(this.columnObserver=(0,_ColumnResizable.SearchTableResizableObserver)(this))},s.prototype.fixedHeaderAutoTableEffectLayout=function(e,t){var r,a;!this.props.fixedHeaderAutoTable||(a=this.getData())&&a.length&&(0===t.scrollY&&0===this.state.scrollY||t.scrollY!==this.state.scrollY||t.expand!==this.state.expand)&&(t=(null===(a=(r=this.tableWrapRef.current).querySelector(".ant-table-header"))||void 0===a?void 0:a.offsetHeight)||0,a=(null===(a=r.querySelector(".ant-table-pagination"))||void 0===a?void 0:a.offsetHeight)||0,this.setState({scrollY:r.clientHeight-(t+(a?a+32:0))}))},s.prototype.columnSettingEffect=function(e){var t,r,a,i=this,l=this.state.columnSetting||[],n=this.getTableColumns().map(function(e,t){return(0,_tslib.__assign)((0,_tslib.__assign)({},e),{sort:t,display:!0})});l.length===n?(t=l.map(function(e){return e[i.getRowKey()]}),r=n.map(function(e){return e[i.getRowKey()]}),t.toString()!==r.toString()&&(a=this.getRowKey()||"id",this.setState({columnSetting:n.map(function(t){var e=l.find(function(e){return e[a]===t[a]});return(0,_tslib.__assign)((0,_tslib.__assign)({},t),{display:!e||e.display})})}))):this.setState({columnSetting:n})},s.prototype.renderTableNumberColumn=function(e,t){return _react.default.createElement("span",null,e=void 0===e?"":e)},s.prototype.getPagination=function(){var r=this;return{onChange:function(e,t){r.setState({page:e,limit:t},function(){r.fetchData()})},onShowSizeChange:function(e,t){r.setState({page:e,limit:t},function(){r.fetchData()})},total:this.getTotal(),current:this.state.page,pageSize:this.state.limit,showQuickJumper:!0,showTotal:function(e){return _adhereUtilIntl.default.v("当前 {page}-{pageSize}/共 {total}条",{page:r.state.page,pageSize:r.state.limit,total:e})}}},s.prototype.onClear=function(){var e=this;this.setState({page:1,limit:10},function(){e.clear().then(function(){e.fetchData()})})},s.prototype.sortOrder=function(e){return this.state[this.getOrderFieldProp()]===e?this.state[this.getOrderProp()]:""},s.prototype.getTableDensity=function(){return _types.TableDensity.DEFAULT},s.prototype.getTableColumns=function(){var a=this,e=this.isShowNumber(),t=this.getTableNumberColumnWidth(),r=this.getColumns().filter(function(e){return!("authorized"in e)||e.authorized()}).map(function(e,t){return"resizable"in e&&e.resizable?a.columnResizable.searchTableResizableColumnItem(a,t,e):e});if(e){var i=null!==(e=this.getNumberGeneratorRule())&&void 0!==e?e:s.NUMBER_GENERATOR_RULE_ALONE,e=this.state,l=e.page,n=e.limit;return[{title:_adhereUtilIntl.default.v("序号"),dataIndex:"_number",key:"_number",align:"center",width:null!=t?t:80,render:function(e,t,r){return _react.default.createElement(_adhereUiConditionalrender.default,{conditional:i===s.NUMBER_GENERATOR_RULE_ALONE,noMatch:function(){return a.renderTableNumberColumn((l-1)*n+(r+1),{value:e,record:t,index:r})}},function(){return a.renderTableNumberColumn(r+1,{value:e,record:t,index:r})})}}].concat(r)}return r},s.prototype.renderColumnSetting=function(){var e=this,t=(0,_tslib.__spreadArray)([],this.state.columnSetting,!0);return t.sort(function(e,t){return e.sort>t.sort?1:e.sort<t.sort?-1:0}),_react.default.createElement(_ColumnSetting.default,{columns:t,onShowColumns:function(t){e.setState(function(e){return{columnSetting:e.columnSetting.map(function(e){return(0,_tslib.__assign)((0,_tslib.__assign)({},e),{display:t})})}})},onReset:function(){e.setState(function(){return{columnSetting:e.getTableColumns().map(function(e,t){return(0,_tslib.__assign)((0,_tslib.__assign)({},e),{display:!0,sort:t})})}})},onDisplayColumn:function(t,r){e.setState(function(e){return{columnSetting:e.columnSetting.map(function(e){return(0,_tslib.__assign)((0,_tslib.__assign)({},e),{display:e.key===t.key?r:e.display})})}})},onSortEnd:function(t){e.setState(function(e){return{columnSetting:e.columnSetting.map(function(e){return(0,_tslib.__assign)((0,_tslib.__assign)({},e),{sort:t.get(e.key)})})}})}})},s.prototype.renderTableDensitySetting=function(){var t=this;return _react.default.createElement(_TableDensitySetting.default,{density:this.state.tableDensity,onChange:function(e){t.setState({tableDensity:e})},onReset:function(){t.setState({tableDensity:t.getTableDensity()})}})},s.prototype.renderSearchFooter=function(){var e=this,t=this.props.isShowExpandSearch,r=[_react.default.createElement(_button.default,{className:"".concat(selectorPrefix,"-searchfooteritem"),type:"primary",icon:_react.default.createElement("img",{style:{width:16},src:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjMzODYzMzk2MjEzIiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9Ijg4MCIgd2lkdGg9IjMyIiBoZWlnaHQ9IjMyIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+PGRlZnM+PHN0eWxlIHR5cGU9InRleHQvY3NzIj48L3N0eWxlPjwvZGVmcz48cGF0aCBkPSJNOTQ4LjQ4IDgzMy45MmwtMTg1LjYtMTgzLjY4Yy0zLjg0LTMuODQtOC4zMi02LjQtMTMuNDQtNy42OEM4MDEuMjggNTgwLjQ4IDgzMiA1MDEuNzYgODMyIDQxNiA4MzIgMjIxLjQ0IDY3NC41NiA2NCA0ODAgNjQgMjg1LjQ0IDY0IDEyOCAyMjEuNDQgMTI4IDQxNiAxMjggNjEwLjU2IDI4NS40NCA3NjggNDgwIDc2OGM4NS43NiAwIDE2My44NC0zMC43MiAyMjUuMjgtODEuMjggMS45MiA0LjQ4IDQuNDggOC45NiA4LjMyIDEyLjhsMTg1LjYgMTgzLjY4YzE0LjA4IDEzLjQ0IDM1Ljg0IDEzLjQ0IDQ5LjkyIDBTOTYyLjU2IDg0Ny4zNiA5NDguNDggODMzLjkyek00ODAgNzA0QzMyMC42NCA3MDQgMTkyIDU3NS4zNiAxOTIgNDE2IDE5MiAyNTYuNjQgMzIwLjY0IDEyOCA0ODAgMTI4IDYzOS4zNiAxMjggNzY4IDI1Ni42NCA3NjggNDE2IDc2OCA1NzUuMzYgNjM5LjM2IDcwNCA0ODAgNzA0eiIgcC1pZD0iODgxIiBmaWxsPSIjZmZmIj48L3BhdGg+PC9zdmc+",alt:"search"}),onClick:function(){e.setState({page:1},function(){e.onSearch()})}},_adhereUtilIntl.default.v("查询")),_react.default.createElement(_button.default,{className:"".concat(selectorPrefix,"-searchfooteritem"),onClick:this.onClear},_adhereUtilIntl.default.v("重置"))];t&&r.push(_react.default.createElement(_adhereUiConditionalrender.default,{conditional:this.state.expand,noMatch:function(){return _react.default.createElement("a",{style:{display:"flex",alignItems:"center"},onClick:function(){e.setState({expand:!0})}},_react.default.createElement("span",{style:{marginRight:5}},_adhereUtilIntl.default.v("展开")),_react.default.createElement("img",{style:{width:16},src:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjMzODYzMjYyMTM1IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjE1MjQ0IiB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj48ZGVmcz48c3R5bGUgdHlwZT0idGV4dC9jc3MiPjwvc3R5bGU+PC9kZWZzPjxwYXRoIGQ9Ik0xOTkuMzYgNTcyLjc2OGEzMS45MDQgMzEuOTA0IDAgMCAwIDIyLjYyNC05LjM3NmwyOTQuMTQ0LTI5NC4xNDQgMjg1LjcyOCAyODUuNzI4YTMxLjk2OCAzMS45NjggMCAxIDAgNDUuMjQ4LTQ1LjI0OEw1MzguNzUyIDIwMS4zNzZhMzIgMzIgMCAwIDAtNDUuMjggMEwxNzYuNzA0IDUxOC4xNDRhMzEuOTY4IDMxLjk2OCAwIDAgMCAyMi42NTYgNTQuNjI0eiBtMzM5LjQyNC0xMTUuMzkyYTMyIDMyIDAgMCAwLTQ1LjI4IDBMMTc2LjczNiA3NzQuMTQ0YTMxLjk2OCAzMS45NjggMCAxIDAgNDUuMjQ4IDQ1LjI0OGwyOTQuMTQ0LTI5NC4xNDQgMjg1LjcyOCAyODUuNzI4YTMxLjk2OCAzMS45NjggMCAxIDAgNDUuMjQ4LTQ1LjI0OGwtMzA4LjMyLTMwOC4zNTJ6IiBwLWlkPSIxNTI0NSIgZmlsbD0iIzE4OTBmZiI+PC9wYXRoPjwvc3ZnPg==",alt:"up"}))}},function(){return _react.default.createElement("a",{style:{display:"flex",alignItems:"center"},onClick:function(){e.setState({expand:!1})}},_react.default.createElement("span",{style:{marginRight:5}},_adhereUtilIntl.default.v("关闭")),_react.default.createElement("img",{style:{width:16},src:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjMzODYzMTc4MzI5IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjE0ODY3IiB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj48ZGVmcz48c3R5bGUgdHlwZT0idGV4dC9jc3MiPjwvc3R5bGU+PC9kZWZzPjxwYXRoIGQ9Ik00OTMuNTA0IDU1OC4xNDRhMzEuOTA0IDMxLjkwNCAwIDAgMCA0NS4yOCAwbDMwOC4zNTItMzA4LjM1MmEzMS45NjggMzEuOTY4IDAgMSAwLTQ1LjI0OC00NS4yNDhMNTE2LjE2IDQ5MC4yNzIgMjIxLjk4NCAxOTYuMTI4YTMxLjk2OCAzMS45NjggMCAxIDAtNDUuMjQ4IDQ1LjI0OGwzMTYuNzY4IDMxNi43Njh6IiBwLWlkPSIxNDg2OCIgZmlsbD0iIzE4OTBmZiI+PC9wYXRoPjxwYXRoIGQ9Ik04MDEuODg4IDQ2MC41NzZMNTE2LjE2IDc0Ni4zMDQgMjIyLjAxNiA0NTIuMTZhMzEuOTY4IDMxLjk2OCAwIDEgMC00NS4yNDggNDUuMjQ4bDMxNi43NjggMzE2Ljc2OGEzMS45MDQgMzEuOTA0IDAgMCAwIDQ1LjI4IDBsMzA4LjM1Mi0zMDguMzUyYTMyIDMyIDAgMSAwLTQ1LjI4LTQ1LjI0OHoiIHAtaWQ9IjE0ODY5IiBmaWxsPSIjMTg5MGZmIj48L3BhdGg+PC9zdmc+",alt:"down"}))}));r=this.renderSearchFooterItems(r)||(0,_tslib.__spreadArray)([],r,!0);return _react.default.createElement("div",{className:"".concat(selectorPrefix,"-searchfooterwrapper")},r.map(function(e,t){return _react.default.createElement("div",{key:t,className:"".concat(selectorPrefix,"-searchfooteritem")},e)}))},s.prototype.renderTable=function(){var e=this.props,t=e.antdTableProps,r=e.fixedHeaderAutoTable,a=this.state,i=a.columnSetting,e=a.tableDensity,a=this.getTableColumns().map(function(e,t){return(0,_tslib.__assign)((0,_tslib.__assign)({},i[t]),e)}).filter(function(e){return e.display});a.sort(function(e,t){return e.sort>t.sort?1:e.sort<t.sort?-1:0});e=(0,_tslib.__assign)({rowKey:this.getRowKey(),dataSource:this.getData(),columns:a,onChange:this.onTableChange,pagination:this.getPagination(),rowSelection:this.getRowSelection(),components:this.components,size:e},t||{});return r&&(r=this.state.scrollY,t&&t.scroll?e.scroll.y=r:e.scroll={y:r}),_react.default.createElement(_table.default,(0,_tslib.__assign)({},e))},s.prototype.renderInner=function(){var e=this,t=this.props,r=t.className,a=t.style,i=t.tableClassName,l=t.tableStyle,n=t.searchClassName,s=t.searchStyle,o=t.fitSearch,u=t.fitTable,c=t.autoFixed,d=t.fixedTableSpaceBetween,t=this.state.expand;return _react.default.createElement(_adhereUiFlexlayout.default,{direction:"vertical",className:_classnames.default.apply(void 0,(0,_tslib.__spreadArray)([selectorPrefix,d?"fixedtablespacebetween":""],(r||"").split(/\s+/),!1)),style:(0,_tslib.__assign)({},a||{})},_react.default.createElement(Fixed,{className:_classnames.default.apply(void 0,(0,_tslib.__spreadArray)(["".concat(selectorPrefix,"-searchwrapper")],(n||"").split(/\s+/),!1)),style:(0,_tslib.__assign)({},s||{}),fit:o},_react.default.createElement(_adhereUiFlexlayout.default,null,_react.default.createElement(Fixed,null,_react.default.createElement(_adhereUiConditionalrender.default,{conditional:t,noMatch:function(){return null}},function(){return e.renderSearchForm()})),_react.default.createElement(Fixed,null,this.renderSearchFooter()))),_react.default.createElement(_adhereUiConditionalrender.default,{conditional:!!this.renderTableHeader},function(){return _react.default.createElement(Fixed,null,e.renderTableHeader())}),_react.default.createElement(Auto,{className:_classnames.default.apply(void 0,(0,_tslib.__spreadArray)((0,_tslib.__spreadArray)(["".concat(selectorPrefix,"-autowrapper")],(i||"").split(/\s+/),!1),[c?"autofixed":""],!1)),style:(0,_tslib.__assign)({},l||{}),fit:u,autoFixed:c},_react.default.createElement("div",{ref:this.tableWrapRef,className:"".concat(selectorPrefix,"-tablewrapper")},this.renderTable())),_react.default.createElement(_adhereUiConditionalrender.default,{conditional:!!this.renderTableFooter},function(){return _react.default.createElement(Fixed,null,e.renderTableFooter())}))},s.prototype.render=function(){return _react.default.createElement("div",{className:"".concat(selectorPrefix,"-wrap")},t.prototype.render.call(this))},s.SearchForm=_searchform.default,s.NUMBER_GENERATOR_RULE_ALONE=Symbol(),s.NUMBER_GENERATOR_RULE_CONTINUITY=Symbol(),s.ROW_SELECTION_NORMAL_MODE=Symbol(),s.ROW_SELECTION_CONTINUOUS_MODE=Symbol(),s}(_adhereUiSuspense.default),defaultProps={className:"",style:{},tableClassName:"",tableStyle:{},searchClassName:"",searchStyle:{},isFirst:!0,isFirstLoading:null,antdTableProps:{},isShowExpandSearch:!0,defaultExpandSearchCollapse:!0,fitSearch:!0,fitTable:!0,autoFixed:!0,fixedHeaderAutoTable:!1,fixedTableSpaceBetween:!1};exports.defaultProps=defaultProps;var propTypes={className:_propTypes.default.string,style:_propTypes.default.object,tableClassName:_propTypes.default.string,tableStyle:_propTypes.default.object,searchClassName:_propTypes.default.string,searchStyle:_propTypes.default.object,reset:_propTypes.default.bool,firstLoading:_propTypes.default.node,antdTableProps:_propTypes.default.object,isShowExpandSearch:_propTypes.default.bool,defaultExpandSearchCollapse:_propTypes.default.bool,fitSearch:_propTypes.default.bool,fitTable:_propTypes.default.bool,autoFixed:_propTypes.default.bool,fixedHeaderAutoTable:_propTypes.default.bool,fixedTableSpaceBetween:_propTypes.default.bool};exports.propTypes=propTypes,SearchTable.defaultProps=defaultProps,SearchTable.propTypes=propTypes;var _default=SearchTable;exports.default=_default;
//# sourceMappingURL=searchtable.js.map
