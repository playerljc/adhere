"use strict";require("core-js/modules/es.object.define-property.js"),require("core-js/modules/es.array.map.js"),require("core-js/modules/es.object.to-string.js"),require("core-js/modules/es.regexp.to-string.js"),require("core-js/modules/es.array.find.js"),require("core-js/modules/es.array.filter.js"),require("core-js/modules/es.array.concat.js"),require("core-js/modules/es.array.sort.js"),require("core-js/modules/es.regexp.exec.js"),require("core-js/modules/es.string.split.js"),require("core-js/modules/es.symbol.js"),require("core-js/modules/es.symbol.description.js"),Object.defineProperty(exports,"__esModule",{value:!0}),exports.propTypes=exports.defaultProps=exports.selectorPrefix=void 0;var tslib_1=require("tslib"),react_1=tslib_1.__importStar(require("react")),prop_types_1=tslib_1.__importDefault(require("prop-types")),classnames_1=tslib_1.__importDefault(require("classnames")),antd_1=require("antd"),adhere_ui_flexlayout_1=tslib_1.__importDefault(require("@baifendian/adhere-ui-flexlayout")),adhere_ui_suspense_1=tslib_1.__importDefault(require("@baifendian/adhere-ui-suspense")),adhere_util_intl_1=tslib_1.__importDefault(require("@baifendian/adhere-util-intl")),adhere_ui_conditionalrender_1=tslib_1.__importDefault(require("@baifendian/adhere-ui-conditionalrender")),ColumnResizable_1=tslib_1.__importStar(require("./Extension/ColumnResizable")),ColumnSetting_1=tslib_1.__importDefault(require("./Extension/ColumnSetting")),TableDensitySetting_1=tslib_1.__importDefault(require("./Extension/TableDensitySetting")),types_1=require("./types");exports.selectorPrefix="adhere-ui-searchtable";var Fixed=adhere_ui_flexlayout_1.default.Fixed,Auto=adhere_ui_flexlayout_1.default.Auto,SearchTable=function(t){function i(e){var n=t.call(this,e)||this;return n.tableWrapRef=(0,react_1.createRef)(),n.components={header:{cell:ColumnResizable_1.SearchTableResizableTitle}},n.columnResizable=new ColumnResizable_1.default,n.columnObserver=null,n.onTableChange=function(e,t,a){var r;n.setState(((r={})[n.getOrderFieldProp()]=a.field||n.getOrderFieldValue(),r[n.getOrderProp()]=a.order||n.getOrderPropValue(),r),function(){a.order&&(n.fetchData(),n.onSubTableChange(e,t,a))})},n.state={page:1,limit:10,expand:e.defaultExpandSearchCollapse,scrollY:0},n.state=tslib_1.__assign(tslib_1.__assign({},n.state),{columnSetting:n.getTableColumns().map(function(e,t){return tslib_1.__assign(tslib_1.__assign({},e),{sort:t,display:!0})}),tableDensity:n.getTableDensity()}),n.onClear=n.onClear.bind(n),n}return tslib_1.__extends(i,t),i.prototype.componentWillReceiveProps=function(e){t.prototype.componentWillReceiveProps.call(this,e),this.columnSettingEffect(e)},i.prototype.componentDidUpdate=function(e,t,a){this.tableWrapRef.current&&(this.searchTableResizableEffectLayout(),this.fixedHeaderAutoTableEffectLayout(e,t))},i.prototype.searchTableResizableEffectLayout=function(){this.columnObserver||(this.columnObserver=(0,ColumnResizable_1.SearchTableResizableObserver)(this))},i.prototype.fixedHeaderAutoTableEffectLayout=function(e,t){var a,r;!this.props.fixedHeaderAutoTable||(r=this.getData())&&r.length&&(0===t.scrollY&&0===this.state.scrollY||t.scrollY!==this.state.scrollY||t.expand!==this.state.expand)&&(t=(null===(r=(a=this.tableWrapRef.current).querySelector(".ant-table-header"))||void 0===r?void 0:r.offsetHeight)||0,r=(null===(r=a.querySelector(".ant-table-pagination"))||void 0===r?void 0:r.offsetHeight)||0,this.setState({scrollY:a.clientHeight-(t+(r?r+32:0))}))},i.prototype.columnSettingEffect=function(e){var t,a,r,n=this,l=this.state.columnSetting||[],s=this.getTableColumns().map(function(e,t){return tslib_1.__assign(tslib_1.__assign({},e),{sort:t,display:!0})});l.length===s?(t=null===(a=null==l?void 0:l.map)||void 0===a?void 0:a.call(l,function(e){return e[n.getRowKey()]}),a=null===(a=null==s?void 0:s.map)||void 0===a?void 0:a.call(s,function(e){return e[n.getRowKey()]}),t.toString()!==a.toString()&&(r=this.getRowKey()||"id",this.setState({columnSetting:null==s?void 0:s.map(function(t){var e=null==l?void 0:l.find(function(e){return e[r]===t[r]});return tslib_1.__assign(tslib_1.__assign({},t),{display:!e||e.display})})}))):this.setState({columnSetting:s})},i.prototype.renderTableNumberColumn=function(e,t){return react_1.default.createElement("span",null,e=void 0===e?"":e)},i.prototype.getPagination=function(){var a=this;return{onChange:function(e,t){a.setState({page:e,limit:t},function(){a.fetchData()})},onShowSizeChange:function(e,t){a.setState({page:e,limit:t},function(){a.fetchData()})},total:this.getTotal(),current:this.state.page,pageSize:this.state.limit,showQuickJumper:!0,showTotal:function(e){return adhere_util_intl_1.default.v("当前 {page}-{pageSize}/共 {total}条",{page:a.state.page,pageSize:a.state.limit,total:e})}}},i.prototype.onClear=function(){var e=this;this.setState({page:1,limit:10},function(){e.clear().then(function(){e.fetchData()})})},i.prototype.sortOrder=function(e){return this.state[this.getOrderFieldProp()]===e?this.state[this.getOrderProp()]:""},i.prototype.getTableDensity=function(){return types_1.TableDensity.DEFAULT},i.prototype.getTableColumns=function(){var r=this,e=this.isShowNumber(),t=this.getTableNumberColumnWidth(),a=this.getColumns().filter(function(e){return!("authorized"in e)||e.authorized()}).map(function(e,t){return"resizable"in e&&e.resizable?r.columnResizable.searchTableResizableColumnItem(r,t,e):e});if(e){var n=null!==(e=this.getNumberGeneratorRule())&&void 0!==e?e:i.NUMBER_GENERATOR_RULE_ALONE,e=this.state,l=e.page,s=e.limit;return[{title:adhere_util_intl_1.default.v("序号"),dataIndex:"_number",key:"_number",align:"center",width:null!=t?t:80,render:function(e,t,a){return react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:n===i.NUMBER_GENERATOR_RULE_ALONE,noMatch:function(){return r.renderTableNumberColumn((l-1)*s+(a+1),{value:e,record:t,index:a})}},function(){return r.renderTableNumberColumn(a+1,{value:e,record:t,index:a})})}}].concat(a)}return a},i.prototype.renderColumnSetting=function(){var e=this,t=tslib_1.__spreadArray([],this.state.columnSetting,!0);return t.sort(function(e,t){return e.sort>t.sort?1:e.sort<t.sort?-1:0}),react_1.default.createElement(ColumnSetting_1.default,{columns:t,onShowColumns:function(t){e.setState(function(e){return{columnSetting:e.columnSetting.map(function(e){return tslib_1.__assign(tslib_1.__assign({},e),{display:t})})}})},onReset:function(){e.setState(function(){return{columnSetting:e.getTableColumns().map(function(e,t){return tslib_1.__assign(tslib_1.__assign({},e),{display:!0,sort:t})})}})},onDisplayColumn:function(t,a){e.setState(function(e){return{columnSetting:e.columnSetting.map(function(e){return tslib_1.__assign(tslib_1.__assign({},e),{display:e.key===t.key?a:e.display})})}})},onSortEnd:function(t){e.setState(function(e){return{columnSetting:e.columnSetting.map(function(e){return tslib_1.__assign(tslib_1.__assign({},e),{sort:t.get(e.key)})})}})}})},i.prototype.renderTableDensitySetting=function(){var t=this;return react_1.default.createElement(TableDensitySetting_1.default,{density:this.state.tableDensity,onChange:function(e){t.setState({tableDensity:e})},onReset:function(){t.setState({tableDensity:t.getTableDensity()})}})},i.prototype.renderSearchFooter=function(){var e=this,t=this.props.isShowExpandSearch,a=[react_1.default.createElement(antd_1.Button,{className:"".concat(exports.selectorPrefix,"-searchfooteritem"),type:"primary",icon:react_1.default.createElement("i",{className:(0,classnames_1.default)("".concat(exports.selectorPrefix,"-searchfooteritem-search-btn-icon"),"iconfont iconsousuo")}),onClick:function(){e.setState({page:1},function(){e.onSearch()})}},adhere_util_intl_1.default.v("查询")),react_1.default.createElement(antd_1.Button,{className:"".concat(exports.selectorPrefix,"-searchfooteritem"),onClick:this.onClear},adhere_util_intl_1.default.v("重置"))];t&&a.push(react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:this.state.expand,noMatch:function(){return react_1.default.createElement("a",{className:"".concat(exports.selectorPrefix,"-searchfooteritem-expand-search-up-btn"),onClick:function(){e.setState({expand:!0})}},react_1.default.createElement("span",null,adhere_util_intl_1.default.v("展开")),react_1.default.createElement("i",{className:"iconfont iconup"}))}},function(){return react_1.default.createElement("a",{className:"".concat(exports.selectorPrefix,"-searchfooteritem-expand-search-down-btn"),onClick:function(){e.setState({expand:!1})}},react_1.default.createElement("span",null,adhere_util_intl_1.default.v("关闭")),react_1.default.createElement("i",{className:"iconfont icondownarrow"}))}));a=this.renderSearchFooterItems(a)||tslib_1.__spreadArray([],a,!0);return react_1.default.createElement("div",{className:"".concat(exports.selectorPrefix,"-searchfooterwrapper")},a.map(function(e,t){return react_1.default.createElement("div",{key:t,className:"".concat(exports.selectorPrefix,"-searchfooteritem")},e)}))},i.prototype.renderTable=function(){var e=this.props,t=e.antdTableProps,a=e.fixedHeaderAutoTable,r=this.state,n=r.columnSetting,e=r.tableDensity,r=this.getTableColumns().map(function(e,t){return tslib_1.__assign(tslib_1.__assign({},n[t]),e)}).filter(function(e){return e.display});r.sort(function(e,t){return e.sort>t.sort?1:e.sort<t.sort?-1:0});e=tslib_1.__assign({rowKey:this.getRowKey(),dataSource:this.getData(),columns:r,onChange:this.onTableChange,pagination:this.getPagination(),rowSelection:this.getRowSelection(),components:this.components,size:e},t||{});return a&&(a=this.state.scrollY,t&&t.scroll?e.scroll.y=a:e.scroll={y:a}),react_1.default.createElement(antd_1.Table,tslib_1.__assign({},e))},i.prototype.renderInner=function(){var e=this,t=this.props,a=t.className,r=t.style,n=t.tableClassName,l=t.tableStyle,s=t.searchClassName,i=t.searchStyle,o=t.fitSearch,u=t.fitTable,c=t.autoFixed,d=t.fixedTableSpaceBetween,t=this.state.expand;return react_1.default.createElement(adhere_ui_flexlayout_1.default,{direction:"vertical",className:classnames_1.default.apply(void 0,tslib_1.__spreadArray([exports.selectorPrefix,d?"fixedtablespacebetween":""],(a||"").split(/\s+/),!1)),style:tslib_1.__assign({},r||{})},react_1.default.createElement(Fixed,{className:classnames_1.default.apply(void 0,tslib_1.__spreadArray(["".concat(exports.selectorPrefix,"-searchwrapper")],(s||"").split(/\s+/),!1)),style:tslib_1.__assign({},i||{}),fit:o},react_1.default.createElement(adhere_ui_flexlayout_1.default,{direction:"vertical"},react_1.default.createElement(Fixed,null,react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:t,noMatch:function(){return null}},function(){return e.renderSearchForm()})),react_1.default.createElement(Fixed,null,this.renderSearchFooter()))),react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:!!this.renderTableHeader},function(){return react_1.default.createElement(Fixed,null,e.renderTableHeader())}),react_1.default.createElement(Auto,{className:classnames_1.default.apply(void 0,tslib_1.__spreadArray(tslib_1.__spreadArray(["".concat(exports.selectorPrefix,"-autowrapper")],(n||"").split(/\s+/),!1),[c?"autofixed":""],!1)),style:tslib_1.__assign({},l||{}),fit:u,autoFixed:c},react_1.default.createElement("div",{ref:this.tableWrapRef,className:"".concat(exports.selectorPrefix,"-tablewrapper")},this.renderTable())),react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:!!this.renderTableFooter},function(){return react_1.default.createElement(Fixed,null,e.renderTableFooter())}))},i.prototype.render=function(){return react_1.default.createElement("div",{className:"".concat(exports.selectorPrefix,"-wrap")},t.prototype.render.call(this))},i.NUMBER_GENERATOR_RULE_ALONE=Symbol(),i.NUMBER_GENERATOR_RULE_CONTINUITY=Symbol(),i.ROW_SELECTION_NORMAL_MODE=Symbol(),i.ROW_SELECTION_CONTINUOUS_MODE=Symbol(),i}(adhere_ui_suspense_1.default);exports.defaultProps={className:"",style:{},tableClassName:"",tableStyle:{},searchClassName:"",searchStyle:{},isFirst:!0,isFirstLoading:null,antdTableProps:{},isShowExpandSearch:!0,defaultExpandSearchCollapse:!0,fitSearch:!0,fitTable:!0,autoFixed:!0,fixedHeaderAutoTable:!1,fixedTableSpaceBetween:!1},exports.propTypes={className:prop_types_1.default.string,style:prop_types_1.default.object,tableClassName:prop_types_1.default.string,tableStyle:prop_types_1.default.object,searchClassName:prop_types_1.default.string,searchStyle:prop_types_1.default.object,reset:prop_types_1.default.bool,firstLoading:prop_types_1.default.node,antdTableProps:prop_types_1.default.object,isShowExpandSearch:prop_types_1.default.bool,defaultExpandSearchCollapse:prop_types_1.default.bool,fitSearch:prop_types_1.default.bool,fitTable:prop_types_1.default.bool,autoFixed:prop_types_1.default.bool,fixedHeaderAutoTable:prop_types_1.default.bool,fixedTableSpaceBetween:prop_types_1.default.bool},SearchTable.defaultProps=exports.defaultProps,SearchTable.propTypes=exports.propTypes,exports.default=SearchTable;
//# sourceMappingURL=searchtable.js.map
