{"version":3,"file":"SearchEditorCellStateTable.js","sources":["SearchEditorCellStateTable.js"],"sourcesContent":["\"use strict\";\n\nrequire(\"core-js/modules/es.object.define-property.js\");\n\nrequire(\"core-js/modules/es.array.iterator.js\");\n\nrequire(\"core-js/modules/es.map.js\");\n\nrequire(\"core-js/modules/es.object.to-string.js\");\n\nrequire(\"core-js/modules/es.string.iterator.js\");\n\nrequire(\"core-js/modules/esnext.map.delete-all.js\");\n\nrequire(\"core-js/modules/esnext.map.every.js\");\n\nrequire(\"core-js/modules/esnext.map.filter.js\");\n\nrequire(\"core-js/modules/esnext.map.find.js\");\n\nrequire(\"core-js/modules/esnext.map.find-key.js\");\n\nrequire(\"core-js/modules/esnext.map.includes.js\");\n\nrequire(\"core-js/modules/esnext.map.key-of.js\");\n\nrequire(\"core-js/modules/esnext.map.map-keys.js\");\n\nrequire(\"core-js/modules/esnext.map.map-values.js\");\n\nrequire(\"core-js/modules/esnext.map.merge.js\");\n\nrequire(\"core-js/modules/esnext.map.reduce.js\");\n\nrequire(\"core-js/modules/esnext.map.some.js\");\n\nrequire(\"core-js/modules/esnext.map.update.js\");\n\nrequire(\"core-js/modules/web.dom-collections.iterator.js\");\n\nrequire(\"core-js/modules/es.promise.js\");\n\nrequire(\"core-js/modules/es.array.find.js\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar tslib_1 = require(\"tslib\");\n\nvar lodash_clonedeep_1 = tslib_1.__importDefault(require(\"lodash.clonedeep\"));\n\nvar moment_1 = tslib_1.__importDefault(require(\"moment\"));\n\nvar SearchTableStateImplement_1 = require(\"./SearchTableStateImplement\");\n/**\n * SearchEditorCellStateTable\n * @class\n * @classdesc 可编辑单元格的表格\n */\n\n\nvar SearchEditorCellStateTable =\n/** @class */\nfunction (_super) {\n  tslib_1.__extends(SearchEditorCellStateTable, _super);\n\n  function SearchEditorCellStateTable(props) {\n    var _this = _super.call(this, props) || this;\n    /**\n     * valueToFormItemValueMap\n     * @description 值和表单控件值之间的转换，现在只涉及到时间控件\n     */\n\n\n    _this.valueToFormItemValueMap = new Map([['rangePicker', function (_a) {\n      var record = _a.record,\n          dataIndex = _a.dataIndex;\n      var value = record === null || record === void 0 ? void 0 : record[dataIndex];\n      return Array.isArray(value) && value.length === 2 ? [(0, moment_1.default)(value[0]), (0, moment_1.default)(value[1])] : [(0, moment_1.default)(), (0, moment_1.default)()];\n    }], ['datePicker', function (_a) {\n      var record = _a.record,\n          dataIndex = _a.dataIndex;\n      var value = record === null || record === void 0 ? void 0 : record[dataIndex];\n      return (0, moment_1.default)(value);\n    }], ['timePicker', function (_a) {\n      var record = _a.record,\n          dataIndex = _a.dataIndex;\n      var value = record === null || record === void 0 ? void 0 : record[dataIndex];\n      return (0, moment_1.default)(value);\n    }]]);\n    _this.cellConfigReducers = tslib_1.__spreadArray(tslib_1.__spreadArray([], _this.cellConfigReducers, true), [_this.cellEditableReducer], false);\n    return _this;\n  }\n\n  SearchEditorCellStateTable.prototype.onTableRowComponentReducers = function (columns) {\n    var existsEditor = columns.some(function (column) {\n      var _a;\n\n      return '$editable' in column && ((_a = column.$editable) === null || _a === void 0 ? void 0 : _a.editable);\n    });\n\n    if (existsEditor) {\n      return tslib_1.__spreadArray(tslib_1.__spreadArray([], this.tableRowComponentReducers, true), ['useEditableRow'], false);\n    }\n\n    return this.tableRowComponentReducers;\n  };\n\n  SearchEditorCellStateTable.prototype.onTableCellComponentReducers = function (columns) {\n    var existsEditor = columns.some(function (column) {\n      var _a;\n\n      return '$editable' in column && ((_a = column.$editable) === null || _a === void 0 ? void 0 : _a.editable);\n    });\n\n    if (existsEditor) {\n      return tslib_1.__spreadArray(tslib_1.__spreadArray([], this.tableCellComponentReducers, true), ['useEditableCell'], false);\n    }\n\n    return this.tableCellComponentReducers;\n  };\n\n  SearchEditorCellStateTable.prototype.onEditorRow = function (params) {\n    return {\n      editable: false\n    };\n  };\n\n  SearchEditorCellStateTable.prototype.onEditorCell = function (params) {};\n  /**\n   * cellEditableReducer\n   * @description 可编辑单元格的onCell处理\n   * @param params\n   */\n\n\n  SearchEditorCellStateTable.prototype.cellEditableReducer = function (params) {\n    var _a;\n\n    var rowIndex = params.rowIndex,\n        column = params.column,\n        record = params.record; // 如果设置了$editable则调用onEditorCell方法对每个cell进行props注入\n\n    if ('$editable' in column && ((_a = column.$editable) === null || _a === void 0 ? void 0 : _a.editable) && this.onEditorCell) {\n      this.onEditorCell({\n        rowIndex: rowIndex,\n        editorConfig: column.$editable,\n        record: tslib_1.__assign({}, record)\n      });\n      return column;\n    }\n\n    return column;\n  };\n  /**\n   * valueToFormItemValue\n   * @description 值和表单值的转换\n   */\n\n\n  SearchEditorCellStateTable.prototype.valueToFormItemValue = function (_a) {\n    var type = _a.type,\n        record = _a.record,\n        dataIndex = _a.dataIndex;\n    var item = this.valueToFormItemValueMap.get(type);\n    return item ? item === null || item === void 0 ? void 0 : item({\n      record: record,\n      dataIndex: dataIndex\n    }) : record === null || record === void 0 ? void 0 : record[dataIndex];\n  };\n  /**\n   * updateEditorCellDate\n   * @description 更新可编辑单元格的数据\n   * @param record 行数据\n   * @param dataIndex 列索引\n   * @param value 更新的值\n   * @return Promise<void>\n   */\n\n\n  SearchEditorCellStateTable.prototype.updateEditorCellDate = function (_a) {\n    var _this = this;\n\n    var record = _a.record,\n        dataIndex = _a.dataIndex,\n        value = _a.value;\n    return new Promise(function (resolve) {\n      var _a;\n\n      if (record[dataIndex] === value) {\n        resolve();\n        return;\n      }\n\n      var listData = (0, lodash_clonedeep_1.default)(_this.state[_this.getServiceName()]);\n      var dataSource = listData[_this.getFetchListPropName()][_this.getDataKey()] || [];\n\n      var rowKey = _this.getRowKey();\n\n      var recordItem = dataSource.find(function (t) {\n        return t[rowKey] === record[rowKey];\n      });\n\n      if (recordItem) {\n        recordItem[dataIndex] = value;\n\n        _this.setState((_a = {}, _a[_this.getServiceName()] = listData, _a), function () {\n          return resolve();\n        });\n      } else resolve();\n    });\n  };\n  /**\n   * updateEditorCellDateData\n   * @description 更新日期类型可编辑单元格的数据\n   * @param record\n   * @param dataIndex\n   * @param value\n   * @return Promise<void>\n   */\n\n\n  SearchEditorCellStateTable.prototype.updateEditorCellDateData = function (_a) {\n    var _this = this;\n\n    var record = _a.record,\n        dataIndex = _a.dataIndex,\n        value = _a.value;\n    return new Promise(function (resolve) {\n      var _a;\n\n      if (record[dataIndex] === (value === null || value === void 0 ? void 0 : value.valueOf())) {\n        resolve();\n        return;\n      }\n\n      var listData = (0, lodash_clonedeep_1.default)(_this.state[_this.getServiceName()]);\n      var dataSource = listData[_this.getFetchListPropName()][_this.getDataKey()] || [];\n\n      var rowKey = _this.getRowKey();\n\n      var recordItem = dataSource.find(function (t) {\n        return t[rowKey] === record[rowKey];\n      });\n\n      if (recordItem) {\n        recordItem[dataIndex] = value === null || value === void 0 ? void 0 : value.valueOf();\n\n        _this.setState((_a = {}, _a[_this.getServiceName()] = listData, _a), function () {\n          return resolve();\n        });\n      } else resolve();\n    });\n  };\n\n  return SearchEditorCellStateTable;\n}(SearchTableStateImplement_1.SearchTableStateImplement);\n\nexports.default = SearchEditorCellStateTable;"],"names":["require","Object","defineProperty","exports","value","tslib_1","lodash_clonedeep_1","__importDefault","moment_1","SearchTableStateImplement_1","SearchEditorCellStateTable","_super","props","_this","call","this","valueToFormItemValueMap","Map","_a","record","dataIndex","Array","isArray","length","default","cellConfigReducers","__spreadArray","cellEditableReducer","__extends","prototype","onTableRowComponentReducers","columns","some","column","$editable","editable","tableRowComponentReducers","onTableCellComponentReducers","tableCellComponentReducers","onEditorRow","params","onEditorCell","rowIndex","editorConfig","__assign","valueToFormItemValue","type","item","get","updateEditorCellDate","Promise","resolve","listData","rowKey","recordItem","dataSource","state","getServiceName","getFetchListPropName","getDataKey","getRowKey","find","t","setState","updateEditorCellDateData","valueOf","SearchTableStateImplement"],"mappings":"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"}