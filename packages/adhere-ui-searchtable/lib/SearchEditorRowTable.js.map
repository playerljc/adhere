{"version":3,"file":"SearchEditorRowTable.js","sources":["SearchEditorRowTable.js"],"sourcesContent":["\"use strict\";\n\nrequire(\"core-js/modules/es.object.define-property.js\");\n\nrequire(\"core-js/modules/es.array.iterator.js\");\n\nrequire(\"core-js/modules/es.object.to-string.js\");\n\nrequire(\"core-js/modules/web.dom-collections.iterator.js\");\n\nrequire(\"core-js/modules/es.promise.js\");\n\nrequire(\"core-js/modules/es.object.keys.js\");\n\nrequire(\"core-js/modules/web.dom-collections.for-each.js\");\n\nrequire(\"core-js/modules/es.array.find.js\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar tslib_1 = require(\"tslib\");\n\nvar lodash_clonedeep_1 = tslib_1.__importDefault(require(\"lodash.clonedeep\"));\n\nvar moment_1 = tslib_1.__importDefault(require(\"moment\"));\n\nvar SearchEditorCellTable_1 = tslib_1.__importDefault(require(\"./SearchEditorCellTable\"));\n/**\n * SearchEditorRowTable\n * @class\n * @classdesc 行可编辑的表格\n */\n\n\nvar SearchEditorRowTable =\n/** @class */\nfunction (_super) {\n  tslib_1.__extends(SearchEditorRowTable, _super);\n\n  function SearchEditorRowTable(props) {\n    var _this = _super.call(this, props) || this;\n\n    _this.state = tslib_1.__assign(tslib_1.__assign({}, _this.state), {\n      editorRowId: ''\n    });\n    _this.rowConfigReducers = tslib_1.__spreadArray(tslib_1.__spreadArray([], _this.rowConfigReducers, true), [_this.rowEditableReducer], false);\n    return _this;\n  }\n  /**\n   * updateEditorCellRowData\n   * @description 更新可编辑单元格一行的数据\n   * @param values 一行的数据\n   * @param record\n   * @return Promise<void>\n   */\n\n\n  SearchEditorRowTable.prototype.updateEditorCellRowData = function (_a) {\n    var _this = this;\n\n    var values = _a.values,\n        record = _a.record;\n    return new Promise(function (resolve) {\n      var _a;\n\n      var listData = (0, lodash_clonedeep_1.default)(_this.props[_this.getServiceName()]);\n      var dataSource = listData[_this.getFetchListPropName()][_this.getDataKey()] || [];\n\n      var rowKey = _this.getRowKey();\n\n      var keys = Object.keys(values);\n      keys.forEach(function (dataIndex) {\n        var value = values[dataIndex];\n\n        if (value instanceof moment_1.default) {\n          value = value.valueOf();\n        }\n\n        var recordItem = dataSource.find(function (t) {\n          return t[rowKey] === record[rowKey];\n        });\n\n        if (recordItem) {\n          recordItem[dataIndex] = value;\n        }\n      });\n\n      _this.props.dispatch((_a = {\n        type: \"\".concat(_this.getServiceName(), \"/receive\")\n      }, _a[_this.getServiceName()] = listData, _a)).then(function () {\n        return resolve();\n      });\n    });\n  };\n  /**\n   * rowEditableReducer\n   * @description 可编辑row的处理\n   * @param params\n   */\n\n\n  SearchEditorRowTable.prototype.rowEditableReducer = function (params) {\n    var rowConfig = params.rowConfig,\n        rowIndex = params.rowIndex,\n        columns = params.columns,\n        record = params.record;\n\n    if (this.onEditorRow) {\n      rowConfig.$editable = this.onEditorRow({\n        rowIndex: rowIndex,\n        record: record,\n        columns: columns\n      });\n    }\n\n    return rowConfig;\n  };\n  /**\n   * onEditorRow\n   * @param params\n   */\n\n\n  SearchEditorRowTable.prototype.onEditorRow = function (params) {\n    return {\n      editable: true\n    };\n  };\n  /**\n   * onEditorCell\n   * @param record\n   * @param editorConfig\n   */\n\n\n  SearchEditorRowTable.prototype.onEditorCell = function (_a) {\n    var record = _a.record,\n        editorConfig = _a.editorConfig;\n\n    if (editorConfig) {\n      editorConfig.useTrigger = false;\n\n      if (record[this.getRowKey()] === this.state.editorRowId) {\n        editorConfig.defaultStatus = 'edit';\n      }\n    }\n  };\n  /**\n   * fetchData\n   */\n\n\n  SearchEditorRowTable.prototype.fetchData = function () {\n    var _this = this;\n\n    return _super.prototype.fetchData.call(this).then(function (res) {\n      _this.setState({\n        editorRowId: ''\n      });\n\n      return res;\n    });\n  };\n\n  return SearchEditorRowTable;\n}(SearchEditorCellTable_1.default);\n\nexports.default = SearchEditorRowTable;"],"names":["require","Object","defineProperty","exports","value","tslib_1","lodash_clonedeep_1","__importDefault","moment_1","SearchEditorCellTable_1","SearchEditorRowTable","_super","props","_this","call","this","state","__assign","editorRowId","rowConfigReducers","__spreadArray","rowEditableReducer","__extends","prototype","updateEditorCellRowData","_a","values","record","Promise","resolve","listData","default","getServiceName","dataSource","getFetchListPropName","getDataKey","rowKey","getRowKey","keys","forEach","dataIndex","recordItem","valueOf","find","t","dispatch","type","concat","then","params","rowConfig","rowIndex","columns","onEditorRow","$editable","editable","onEditorCell","editorConfig","useTrigger","defaultStatus","fetchData","res","setState"],"mappings":"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"}