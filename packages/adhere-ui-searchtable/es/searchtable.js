import _Table from"antd/es/table";import _Button from"antd/es/button";import"core-js/modules/es.array.map.js";import"core-js/modules/es.object.to-string.js";import"core-js/modules/es.regexp.to-string.js";import"core-js/modules/es.array.find.js";import"core-js/modules/es.promise.js";import"core-js/modules/es.array.filter.js";import"core-js/modules/es.array.concat.js";import"core-js/modules/es.array.sort.js";import"core-js/modules/es.regexp.exec.js";import"core-js/modules/es.string.split.js";import"core-js/modules/es.symbol.js";import"core-js/modules/es.symbol.description.js";import{__assign,__extends,__spreadArray}from"tslib";import React,{createRef}from"react";import PropTypes from"prop-types";import classNames from"classnames";import FlexLayout from"@baifendian/adhere-ui-flexlayout";import Suspense from"@baifendian/adhere-ui-suspense";import Intl from"@baifendian/adhere-util-intl";import ConditionalRender from"@baifendian/adhere-ui-conditionalrender";import ColumnResizable,{SearchTableResizableTitle,SearchTableResizableObserver}from"./Extension/ColumnResizable";import ColumnSetting from"./Extension/ColumnSetting";import TableDensitySetting from"./Extension/TableDensitySetting";import{TableDensity}from"./types";var selectorPrefix="adhere-ui-searchtable",Fixed=FlexLayout.Fixed,Auto=FlexLayout.Auto,SearchTable=function(t){function i(e){var a=t.call(this,e)||this;return a.tableWrapRef=createRef(),a.components={header:{cell:SearchTableResizableTitle}},a.columnResizable=new ColumnResizable,a.columnObserver=null,a.onTableChange=function(e,t,n){var r;a.setState(((r={})[a.getOrderFieldProp()]=n.field||a.getOrderFieldValue(),r[a.getOrderProp()]=n.order||a.getOrderPropValue(),r),function(){n.order&&(a.fetchData(),a.onSubTableChange(e,t,n))})},a.state={page:1,limit:a.getLimit(),expand:e.defaultExpandSearchCollapse,scrollY:0},a.state=__assign(__assign({},a.state),{columnSetting:a.getTableColumns().map(function(e,t){return __assign(__assign({},e),{sort:t,display:!0})}),tableDensity:a.getTableDensity()}),a.onClear=a.onClear.bind(a),a}return __extends(i,t),i.prototype.componentWillReceiveProps=function(e){t.prototype.componentWillReceiveProps.call(this,e),this.columnSettingEffect(e)},i.prototype.componentDidUpdate=function(e,t,n){this.tableWrapRef.current&&(this.searchTableResizableEffectLayout(),this.fixedHeaderAutoTableEffectLayout(e,t))},i.prototype.searchTableResizableEffectLayout=function(){this.columnObserver||(this.columnObserver=SearchTableResizableObserver(this))},i.prototype.fixedHeaderAutoTableEffectLayout=function(e,t){var n,r;!this.props.fixedHeaderAutoTable||(r=this.getData())&&r.length&&(0===t.scrollY&&0===this.state.scrollY||t.scrollY!==this.state.scrollY||t.expand!==this.state.expand)&&(t=(null===(r=(n=this.tableWrapRef.current).querySelector(".ant-table-header"))||void 0===r?void 0:r.offsetHeight)||0,r=(null===(r=n.querySelector(".ant-table-pagination"))||void 0===r?void 0:r.offsetHeight)||0,this.setState({scrollY:n.clientHeight-(t+(r?r+32:0))}))},i.prototype.columnSettingEffect=function(e){var t,n,r,a=this,o=this.state.columnSetting||[],s=this.getTableColumns().map(function(e,t){return __assign(__assign({},e),{sort:t,display:!0})});o.length===s?(t=null===(n=null==o?void 0:o.map)||void 0===n?void 0:n.call(o,function(e){return e[a.getRowKey()]}),n=null===(n=null==s?void 0:s.map)||void 0===n?void 0:n.call(s,function(e){return e[a.getRowKey()]}),t.toString()!==n.toString()&&(r=this.getRowKey()||"id",this.setState({columnSetting:null==s?void 0:s.map(function(t){var e=null==o?void 0:o.find(function(e){return e[r]===t[r]});return __assign(__assign({},t),{display:!e||e.display})})}))):this.setState({columnSetting:s})},i.prototype.renderTableNumberColumn=function(e,t){return void 0===e&&(e=""),React.createElement("span",null,e)},i.prototype.getLimit=function(){return 10},i.prototype.getPagination=function(){var n=this;return{onChange:function(e,t){n.setState({page:e,limit:t},function(){n.fetchData()})},onShowSizeChange:function(e,t){n.setState({page:e,limit:t},function(){n.fetchData()})},total:this.getTotal(),current:this.state.page,pageSize:this.state.limit,showQuickJumper:!0,showTotal:function(e){return Intl.v("当前 {page}-{pageSize}/共 {total}条",{page:n.state.page,pageSize:n.state.limit,total:e})}}},i.prototype.onSearchPanelCollapseBefore=function(){},i.prototype.onSearchPanelCollapseAfter=function(){},i.prototype.onClear=function(){var t=this;return new Promise(function(e){t.setState({page:1,limit:t.getLimit()},function(){t.clear().then(function(){t.fetchData(),e()})})})},i.prototype.sortOrder=function(e){return this.state[this.getOrderFieldProp()]===e?this.state[this.getOrderProp()]:""},i.prototype.getTableDensity=function(){return TableDensity.DEFAULT},i.prototype.getTableColumns=function(){var r=this,e=this.isShowNumber(),t=this.getTableNumberColumnWidth(),n=this.getColumns().filter(function(e){return!("authorized"in e)||e.authorized()}).map(function(e,t){return"resizable"in e&&e.resizable?r.columnResizable.searchTableResizableColumnItem(r,t,e):e});if(e){var a=null!==(e=this.getNumberGeneratorRule())&&void 0!==e?e:i.NUMBER_GENERATOR_RULE_ALONE,e=this.state,o=e.page,s=e.limit;return[{title:Intl.v("序号"),dataIndex:"_number",key:"_number",align:"center",width:null!=t?t:80,render:function(e,t,n){return React.createElement(ConditionalRender,{conditional:a===i.NUMBER_GENERATOR_RULE_ALONE,noMatch:function(){return r.renderTableNumberColumn((o-1)*s+(n+1),{value:e,record:t,index:n})}},function(){return r.renderTableNumberColumn(n+1,{value:e,record:t,index:n})})}}].concat(n)}return n},i.prototype.renderColumnSetting=function(){var e=this,t=__spreadArray([],this.state.columnSetting,!0);return t.sort(function(e,t){return e.sort>t.sort?1:e.sort<t.sort?-1:0}),React.createElement(ColumnSetting,{columns:t,onShowColumns:function(t){e.setState(function(e){return{columnSetting:e.columnSetting.map(function(e){return __assign(__assign({},e),{display:t})})}})},onReset:function(){e.setState(function(){return{columnSetting:e.getTableColumns().map(function(e,t){return __assign(__assign({},e),{display:!0,sort:t})})}})},onDisplayColumn:function(t,n){e.setState(function(e){return{columnSetting:e.columnSetting.map(function(e){return __assign(__assign({},e),{display:e.key===t.key?n:e.display})})}})},onSortEnd:function(t){e.setState(function(e){return{columnSetting:e.columnSetting.map(function(e){return __assign(__assign({},e),{sort:t.get(e.key)})})}})}})},i.prototype.renderTableDensitySetting=function(){var t=this;return React.createElement(TableDensitySetting,{density:this.state.tableDensity,onChange:function(e){t.setState({tableDensity:e})},onReset:function(){t.setState({tableDensity:t.getTableDensity()})}})},i.prototype.renderSearchFooter=function(){var e=this,t=this.props.isShowExpandSearch,n=[React.createElement(_Button,{className:"".concat(selectorPrefix,"-searchfooteritem"),type:"primary",key:"search",icon:React.createElement("i",{className:classNames("".concat(selectorPrefix,"-searchfooteritem-search-btn-icon"),"iconfont iconsousuo")}),onClick:function(){e.setState({page:1},function(){e.onSearch()})}},Intl.v("查询")),React.createElement(_Button,{className:"".concat(selectorPrefix,"-searchfooteritem"),key:"reset",onClick:this.onClear},Intl.v("重置"))];t&&n.push(React.createElement(ConditionalRender,{conditional:this.state.expand,noMatch:function(){return React.createElement("a",{key:"expand",className:"".concat(selectorPrefix,"-searchfooteritem-expand-search-up-btn"),onClick:function(){e.onSearchPanelCollapseBefore&&e.onSearchPanelCollapseBefore(),e.setState({expand:!0},function(){return e.onSearchPanelCollapseAfter&&e.onSearchPanelCollapseAfter()})}},React.createElement("span",null,Intl.v("展开")),React.createElement("i",{className:"iconfont iconup"}))}},function(){return React.createElement("a",{key:"hide",className:"".concat(selectorPrefix,"-searchfooteritem-expand-search-down-btn"),onClick:function(){e.onSearchPanelCollapseBefore&&e.onSearchPanelCollapseBefore(),e.setState({expand:!1},function(){return e.onSearchPanelCollapseAfter&&e.onSearchPanelCollapseAfter()})}},React.createElement("span",null,Intl.v("关闭")),React.createElement("i",{className:"iconfont icondownarrow"}))}));n=this.renderSearchFooterItems(n)||__spreadArray([],n,!0);return React.createElement("div",{className:"".concat(selectorPrefix,"-searchfooterwrapper")},n.map(function(e,t){return React.createElement("div",{key:t,className:"".concat(selectorPrefix,"-searchfooteritem")},e)}))},i.prototype.renderTable=function(){var e=this.props,t=e.antdTableProps,n=e.fixedHeaderAutoTable,r=this.state,a=r.columnSetting,e=r.tableDensity,r=this.getTableColumns().map(function(e,t){return __assign(__assign({},a[t]),e)}).filter(function(e){return e.display});r.sort(function(e,t){return e.sort>t.sort?1:e.sort<t.sort?-1:0});e=__assign({rowKey:this.getRowKey(),dataSource:this.getData(),columns:r,onChange:this.onTableChange,pagination:this.getPagination(),rowSelection:this.getRowSelection(),components:this.components,size:e},t||{});return n&&(n=this.state.scrollY,t&&t.scroll?e.scroll.y=n:e.scroll={y:n}),React.createElement(_Table,__assign({},e))},i.prototype.renderInner=function(){var e=this,t=this.props,n=t.className,r=t.style,a=t.tableClassName,o=t.tableStyle,s=t.searchClassName,i=t.searchStyle,l=t.fitSearch,c=t.fitTable,u=t.autoFixed,p=t.fixedTableSpaceBetween,t=this.state.expand;return React.createElement(FlexLayout,{direction:"vertical",className:classNames.apply(void 0,__spreadArray([selectorPrefix,p?"fixedtablespacebetween":""],(n||"").split(/\s+/),!1)),style:__assign({},r||{})},React.createElement(Fixed,{className:classNames.apply(void 0,__spreadArray(["".concat(selectorPrefix,"-searchwrapper")],(s||"").split(/\s+/),!1)),style:__assign({},i||{}),fit:l},React.createElement(FlexLayout,{direction:"vertical"},React.createElement(ConditionalRender,{conditional:!!this.renderSearchFormBefore},function(){return React.createElement(Fixed,null,e.renderSearchFormBefore())}),React.createElement(Fixed,null,React.createElement(ConditionalRender,{conditional:t,noMatch:function(){return null}},function(){return e.renderSearchForm()})),React.createElement(Fixed,null,this.renderSearchFooter()),React.createElement(ConditionalRender,{conditional:!!this.renderSearchFormAfter},function(){return React.createElement(Fixed,null,e.renderSearchFormAfter())}))),React.createElement(ConditionalRender,{conditional:!!this.renderTableHeader},function(){return React.createElement(Fixed,null,e.renderTableHeader())}),React.createElement(Auto,{className:classNames.apply(void 0,__spreadArray(__spreadArray(["".concat(selectorPrefix,"-autowrapper")],(a||"").split(/\s+/),!1),[u?"autofixed":""],!1)),style:__assign({},o||{}),fit:c,autoFixed:u},React.createElement("div",{ref:this.tableWrapRef,className:"".concat(selectorPrefix,"-tablewrapper")},this.renderTable())),React.createElement(ConditionalRender,{conditional:!!this.renderTableFooter},function(){return React.createElement(Fixed,null,e.renderTableFooter())}))},i.prototype.render=function(){return React.createElement("div",{className:"".concat(selectorPrefix,"-wrap")},t.prototype.render.call(this))},i.NUMBER_GENERATOR_RULE_ALONE=Symbol(),i.NUMBER_GENERATOR_RULE_CONTINUITY=Symbol(),i.ROW_SELECTION_NORMAL_MODE=Symbol(),i.ROW_SELECTION_CONTINUOUS_MODE=Symbol(),i}(Suspense),defaultProps={className:"",style:{},tableClassName:"",tableStyle:{},searchClassName:"",searchStyle:{},isFirst:!0,isFirstLoading:null,antdTableProps:{},isShowExpandSearch:!0,defaultExpandSearchCollapse:!0,fitSearch:!0,fitTable:!0,autoFixed:!0,fixedHeaderAutoTable:!1,fixedTableSpaceBetween:!1},propTypes={className:PropTypes.string,style:PropTypes.object,tableClassName:PropTypes.string,tableStyle:PropTypes.object,searchClassName:PropTypes.string,searchStyle:PropTypes.object,reset:PropTypes.bool,firstLoading:PropTypes.node,antdTableProps:PropTypes.object,isShowExpandSearch:PropTypes.bool,defaultExpandSearchCollapse:PropTypes.bool,fitSearch:PropTypes.bool,fitTable:PropTypes.bool,autoFixed:PropTypes.bool,fixedHeaderAutoTable:PropTypes.bool,fixedTableSpaceBetween:PropTypes.bool};SearchTable.defaultProps=defaultProps,SearchTable.propTypes=propTypes;export default SearchTable;export{selectorPrefix,defaultProps,propTypes};
//# sourceMappingURL=searchtable.js.map
