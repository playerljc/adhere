var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(r){for(var o,e=1,n=arguments.length;e<n;e++)for(var l in o=arguments[e])Object.prototype.hasOwnProperty.call(o,l)&&(r[l]=o[l]);return r}).apply(this,arguments)};import classNames from"classnames";import{useMemo,useState}from"react";import React,{useContext,useRef}from"react";import{useDrag,useDrop}from"react-dnd";import{DRAG_SORT_ROW_COLUMN_KEY}from"../../../Constent";import{SearchTableContext,selectorPrefix}from"../../../SearchTable";import{isSameLevel}from"../../../Util";import DragSortRowContext from"./DragSortRowContext";var type="DraggableBodyRow";function ProviderWrapper(r){var o=r.value,r=r.children;return React.createElement(DragSortRowContext.Provider,{value:o},r)}var DragSortRow=function(r){var o,e,n,l,t,a,i,d=r.rowIndex,s=r.rowConfig,u=r.record,c=r.columns,g=useContext(SearchTableContext),r=useMemo(function(){return function r(o){for(var e=!1,n=0;n<o.length;n++){var l=o[n];if(l.key===DRAG_SORT_ROW_COLUMN_KEY){e=!0;break}if(l.children&&(e=r(null!=(l=l.children)?l:[])))break}return e}(c)},[c]),r=useState(!r),p=r[0],v=r[1],f=useRef(null),r={type:type,dropOverDownwardClassName:"".concat(selectorPrefix,"-row-drag-sort-drop-over-downward"),dropOverUpwardClasName:"".concat(selectorPrefix,"-row-drag-sort-drop-over-upward"),dragConfig:function(){return{type:m.type,item:{index:d,record:u},collect:function(r){return{isDragging:r.isDragging()}},canDrag:function(){return p}}},dropConfig:function(){return{accept:m.type,collect:function(r){var o,e=(null!=(e=r.getItem())?e:{}).index;return __assign({isOver:r.isOver(),dropClassName:e<d?m.dropOverDownwardClassName:m.dropOverUpwardClasName},null!=(o=null==(o=null==(e=null==(e=null==s?void 0:s.$rowDragSort)?void 0:e.dropHooks)?void 0:e.collect)?void 0:o.call(e,r))?o:{})},drop:function(o){var r=null==(r=null==g?void 0:g.context)?void 0:r.getData(),e=null==(e=null==g?void 0:g.context)?void 0:e.getRowKey();isSameLevel({dataSource:r,rowKey:e,sourceId:u[e],targetId:o.record[e]})&&(null!=(e=null==(r=null==s?void 0:s.$rowDragSort)?void 0:r.dropHooks)&&e.drop?null!=(e=null==(r=null==s?void 0:s.$rowDragSort)?void 0:r.dropHooks)&&e.drop({sourceRecord:o.record,targetRecord:u,item:o}).then(function(){var r;null!=(r=null==g?void 0:g.context)&&r.moveRow(o.record,u)}):null!=(r=null==g?void 0:g.context)&&r.moveRow(o.record,u))}}}},m=__assign(__assign({},r),null!=(C=null==(C=null==s?void 0:s.$rowDragSort)?void 0:C.override)?C:{}),C=r.dragConfig(),w=r.dropConfig();null!=(o=null==(o=null==s?void 0:s.$rowDragSort)?void 0:o.override)&&o.dragConfig?m.dragConfig=Object.assign(C,null!=(e=null==(e=null==(o=null==(o=null==s?void 0:s.$rowDragSort)?void 0:o.override)?void 0:o.dragConfig)?void 0:e.call(o,C))?e:{}):m.dragConfig=r.dragConfig(),null!=(C=null==(o=null==s?void 0:s.$rowDragSort)?void 0:o.override)&&C.dropConfig?m.dropConfig=Object.assign(w,null!=(e=null==(C=null==(o=null==(e=null==s?void 0:s.$rowDragSort)?void 0:e.override)?void 0:o.dropConfig)?void 0:C.call(o,w))?e:{}):m.dropConfig=r.dropConfig();try{t=(n=useDrag(m.dragConfig))[1],l=useDrop(m.dropConfig),a=l[0].isOver,i=l[0].dropClassName,(0,l[1])(t(f))}catch(r){console.log(r)}return function(r){var o={cursor:"canDrag"in m.dragConfig&&!m.dragConfig.canDrag()?"no-drop":"move"};return React.createElement(ProviderWrapper,{value:{dragResult:n,dropResult:l,setCanDrag:v}},Array.isArray(r.props.children)?React.createElement("tr",__assign({ref:f},r.props,{style:__assign(__assign({},o),null!=(o=r.props.style)?o:{}),className:classNames(r.props.className,a?i:"")}),r.props.children):r.props.children)}};export default DragSortRow;
//# sourceMappingURL=DragSortRow.js.map
