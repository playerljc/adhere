import _FileExcelOutlined from"@ant-design/icons/es/icons/FileExcelOutlined";import ExcelJS from"exceljs";import FileSaver from"file-saver";import React from"react";import GlobalIndicator from"@baifendian/adhere-ui-globalindicator";import ErrorPrompt from"@baifendian/adhere-ui-prompt-errorprompt";import SuccessPrompt from"@baifendian/adhere-ui-prompt-successprompt";import Util from"@baifendian/adhere-util";import{selectorPrefix}from"../../SearchTable";function isLeaf(e){return!("children"in e)||Array.isArray(e.children)&&!e.children.length}function renderTitle(e){var t=e.worksheet,l=e.title,e=e.columnsLength,e=(t.mergeCells(1,1,1,e),t.getCell("A1"));e.value=l,e.alignment={vertical:"middle",horizontal:"center"},e.font={bold:!0,size:14},e.fill={type:"pattern",pattern:"solid",fgColor:{argb:"8DB4E2"}},e.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}}function renderColumns(e){var d=e.worksheet,s=e.columns,u=e.leafNodes,f=e.level;!function i(a){for(var c,e=0;e<a.length;e++)!function(e){var t,l,r=a[e],e=Util.getNodeLevel(s,r,"key"),o=void 0,n=void 0;(n=isLeaf(r)?{startRow:1+e,startCell:l=u.findIndex(function(e){return e.key===r.key})+1,endRow:1+f,endCell:l}:(t=Util.getLeafNodes(r.children),{startRow:1+e,startCell:l=u.findIndex(function(e){return e.key===t[0].key})+1,endRow:1+e,endCell:l+t.length-1}))&&(d.mergeCells(n.startRow,n.startCell,n.endRow,n.endCell),o=d.getRow(n.startRow).getCell(n.startCell)),o&&(o.value=r.title,o.font={bold:!0,size:12},o.alignment={vertical:"middle",horizontal:"center"},o.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},o.fill={type:"pattern",pattern:"solid",fgColor:{argb:"C5D9F1"}}),i(null!=(c=r.children)?c:[])}(e)}(s)}function renderData(e){var i=e.worksheet,a=e.leafNodes,c=e.level,e=e.dataSource,d=0;(function t(e,o,n){e.forEach(function(l,e){var r=i.getRow(1+c+1+d++);r.indent=2*o,n&&(r.outlineLevel=o),a.forEach(function(e,t){e=e.dataIndex,t=r.getCell(t+1);t.value=l[e],t.font={bold:!1,size:10},t.alignment={vertical:"middle",horizontal:"center"},t.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}}),"children"in l&&Array.isArray(l.children)&&l.children.length&&t(l.children,o+1,r)})})(e,0)}function columnsAdaption(e){e.columns.forEach(function(e){var t,l=0;null!=(t=null==e?void 0:e.eachCell)&&t.call(e,{includeEmpty:!0},function(e){e=e.value?e.value.toString().length:10;l<e&&(l=e)}),e.width=l<10?10:l+2})}function download(e){var t=e.workbook,l=e.title;return t.xlsx.writeBuffer().then(function(e){FileSaver(new Blob([e],{type:"application/octet-stream"}),"".concat(l,".xlsx"))})}function exportExcel(e){var t=e.dataSource,l=e.columns,e=e.title,r=new ExcelJS.Workbook,o=r.addWorksheet(e),n=Util.getLeafNodes(l),i=Util.getTreeLevel(l,"key");return renderTitle({worksheet:o,title:e,columnsLength:n.length}),renderColumns({worksheet:o,leafNodes:n,columns:l,level:i}),renderData({worksheet:o,leafNodes:n,level:i,dataSource:t}),columnsAdaption(o),download({workbook:r,title:e})}var ExportExcel=function(e){var t=e.title,l=void 0===t?"excel":t,r=e.getDataSource,o=e.getColumns;return React.createElement(_FileExcelOutlined,{onClick:function(){var t=GlobalIndicator.show(),e=o();return exportExcel({dataSource:r(),columns:e,title:l}).then(function(){GlobalIndicator.hide(t),SuccessPrompt.openSuccessMessage()}).catch(function(e){GlobalIndicator.hide(t),ErrorPrompt.openErrorMessage(e)})},className:"".concat(selectorPrefix,"-export-excel")})};export default ExportExcel;
//# sourceMappingURL=index.js.map
