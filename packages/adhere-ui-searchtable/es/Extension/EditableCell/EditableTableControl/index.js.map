{"version":3,"file":"index.js","sources":["Extension/EditableCell/EditableTableControl/index.js"],"sourcesContent":["import classNames from 'classnames';\nimport React, { useCallback, useContext } from 'react';\nimport ConditionalRender from '@baifendian/adhere-ui-conditionalrender';\nimport Intl from '@baifendian/adhere-util-intl';\nimport { SearchTableContext, selectorPrefix } from '../../../SearchTable';\n/**\n * EditableTableControl\n * @description 编辑表格的控制器\n * @param className\n * @param styles\n * @param renderEditorTable\n * @param renderSave\n * @param renderCancel\n * @param rowKey\n * @param onEditor\n * @param onSave\n */\n\nvar EditableTableControl = function EditableTableControl(_a) {\n  var className = _a.className,\n      styles = _a.styles,\n      renderEditorTable = _a.renderEditorTable,\n      renderSave = _a.renderSave,\n      renderCancel = _a.renderCancel,\n      onEditor = _a.onEditor,\n      onSave = _a.onSave;\n  var context = useContext(SearchTableContext);\n  var renderDefaultSave = useCallback(function () {\n    return /*#__PURE__*/React.createElement(\"a\", null, Intl.v('保存'));\n  }, []);\n  var renderDefaultCancel = useCallback(function () {\n    return /*#__PURE__*/React.createElement(\"a\", null, Intl.v('取消'));\n  }, []);\n  var renderDefaultEditorTable = useCallback(function () {\n    return /*#__PURE__*/React.createElement(\"a\", null, Intl.v('编辑表格'));\n  }, []);\n  var validateFieldsSuccess = useCallback(function (values) {\n    if (onSave) {\n      onSave(values.dataSource).then(function () {\n        return updateEditorCellTableData(values.dataSource);\n      });\n      return;\n    }\n\n    updateEditorCellTableData(values.dataSource);\n  }, []);\n\n  var _onEditor = useCallback(function () {\n    var _a;\n\n    if (onEditor) {\n      (_a = onEditor === null || onEditor === void 0 ? void 0 : onEditor()) === null || _a === void 0 ? void 0 : _a.then(function () {\n        return updateTableEdit();\n      });\n      return;\n    }\n\n    updateTableEdit();\n  }, []);\n\n  var updateEditorCellTableData = function updateEditorCellTableData(changeData) {\n    var _a, _b; // @ts-ignore\n\n\n    return (_b = (_a = context === null || context === void 0 ? void 0 : context.context) === null || _a === void 0 ? void 0 : _a.updateEditorData(changeData)) === null || _b === void 0 ? void 0 : _b.then(function () {\n      return reset();\n    });\n  };\n\n  var updateTableEdit = function updateTableEdit() {\n    var _a;\n\n    return (_a = context === null || context === void 0 ? void 0 : context.context) === null || _a === void 0 ? void 0 : _a.setState({\n      isTableEditor: true\n    });\n  };\n  /**\n   * reset\n   * @description 取消\n   */\n\n\n  var reset = function reset() {\n    var _a;\n\n    return (_a = context === null || context === void 0 ? void 0 : context.context) === null || _a === void 0 ? void 0 : _a.setState({\n      isTableEditor: false\n    });\n  };\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: classNames(\"\".concat(selectorPrefix, \"-editor-table-control\"), className),\n    style: styles || {}\n  }, /*#__PURE__*/React.createElement(ConditionalRender, {\n    conditional: !(context === null || context === void 0 ? void 0 : context.context.state.isTableEditor),\n    noMatch: function noMatch() {\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"\".concat(selectorPrefix, \"-editor-table-control-save-cancel\")\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"\".concat(selectorPrefix, \"-editor-table-control-save-cancel-item\"),\n        onClick: function onClick() {\n          var _a, _b, _c;\n\n          return (_c = (_b = (_a = context === null || context === void 0 ? void 0 : context.form) === null || _a === void 0 ? void 0 : _a.validateFields()) === null || _b === void 0 ? void 0 : _b.then) === null || _c === void 0 ? void 0 : _c.call(_b, function (values) {\n            return validateFieldsSuccess(values);\n          });\n        }\n      }, /*#__PURE__*/React.createElement(ConditionalRender, {\n        conditional: !renderSave,\n        noMatch: function noMatch() {\n          return renderSave === null || renderSave === void 0 ? void 0 : renderSave();\n        }\n      }, function () {\n        return renderDefaultSave();\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"\".concat(selectorPrefix, \"-editor-table-control-save-cancel-item\"),\n        onClick: reset\n      }, /*#__PURE__*/React.createElement(ConditionalRender, {\n        conditional: !renderCancel,\n        noMatch: function noMatch() {\n          return renderCancel === null || renderCancel === void 0 ? void 0 : renderCancel();\n        }\n      }, function () {\n        return renderDefaultCancel();\n      })));\n    }\n  }, function () {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"\".concat(selectorPrefix, \"-editor-table-control-edit\"),\n      onClick: _onEditor\n    }, /*#__PURE__*/React.createElement(ConditionalRender, {\n      conditional: !renderEditorTable,\n      noMatch: function noMatch() {\n        return renderEditorTable === null || renderEditorTable === void 0 ? void 0 : renderEditorTable();\n      }\n    }, function () {\n      return renderDefaultEditorTable();\n    }));\n  }));\n};\n\nexport default EditableTableControl;"],"names":["classNames","React","useCallback","useContext","ConditionalRender","Intl","SearchTableContext","selectorPrefix","EditableTableControl","_a","className","styles","renderEditorTable","renderSave","renderCancel","onEditor","onSave","context","renderDefaultSave","createElement","v","renderDefaultCancel","renderDefaultEditorTable","validateFieldsSuccess","values","dataSource","then","updateEditorCellTableData","_onEditor","updateTableEdit","changeData","_b","updateEditorData","reset","setState","isTableEditor","concat","style","conditional","state","noMatch","onClick","_c","form","validateFields","call"],"mappings":"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"}