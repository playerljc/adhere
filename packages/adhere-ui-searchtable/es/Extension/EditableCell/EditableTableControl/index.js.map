{"version":3,"file":"index.js","sources":["Extension/EditableCell/EditableTableControl/index.js"],"sourcesContent":["import classNames from 'classnames';\nimport React, { useCallback, useContext } from 'react';\nimport ConditionalRender from '@baifendian/adhere-ui-conditionalrender';\nimport Intl from '@baifendian/adhere-util-intl';\nimport { SearchTableContext, selectorPrefix } from '../../../SearchTable';\n/**\n * EditableTableControl\n * @description 编辑表格的控制器\n * @param className\n * @param styles\n * @param renderEditorTable\n * @param renderSave\n * @param renderCancel\n * @param rowKey\n * @param onEditor\n * @param onSave\n */\nvar EditableTableControl = function EditableTableControl(_a) {\n  var className = _a.className,\n    styles = _a.styles,\n    renderEditorTable = _a.renderEditorTable,\n    renderSave = _a.renderSave,\n    renderCancel = _a.renderCancel,\n    onEditor = _a.onEditor,\n    onSave = _a.onSave;\n  var context = useContext(SearchTableContext);\n  var renderDefaultSave = useCallback(function () {\n    return /*#__PURE__*/React.createElement(\"a\", null, Intl.v('保存'));\n  }, []);\n  var renderDefaultCancel = useCallback(function () {\n    return /*#__PURE__*/React.createElement(\"a\", null, Intl.v('取消'));\n  }, []);\n  var renderDefaultEditorTable = useCallback(function () {\n    return /*#__PURE__*/React.createElement(\"a\", null, Intl.v('编辑表格'));\n  }, []);\n  var validateFieldsSuccess = useCallback(function (values) {\n    if (onSave) {\n      return onSave(values.dataSource).then(function () {\n        return updateEditorCellTableData(values.dataSource);\n      });\n    }\n    return updateEditorCellTableData(values.dataSource);\n  }, []);\n  var _onEditor = useCallback(function () {\n    var _a;\n    if (onEditor) {\n      (_a = onEditor === null || onEditor === void 0 ? void 0 : onEditor()) === null || _a === void 0 ? void 0 : _a.then(function () {\n        return updateTableEdit();\n      });\n      return;\n    }\n    updateTableEdit();\n  }, []);\n  var updateEditorCellTableData = function updateEditorCellTableData(changeData) {\n    var _a, _b;\n    // @ts-ignore\n    return (_b = (_a = context === null || context === void 0 ? void 0 : context.context) === null || _a === void 0 ? void 0 : _a.updateEditorData(changeData)) === null || _b === void 0 ? void 0 : _b.then(function () {\n      return reset();\n    });\n  };\n  var updateTableEdit = function updateTableEdit() {\n    var _a, _b, _c, _d;\n    // @ts-ignore\n    (_b = (_a = context === null || context === void 0 ? void 0 : context.context) === null || _a === void 0 ? void 0 : _a.setFieldValues) === null || _b === void 0 ? void 0 : _b.call(_a, (_c = context === null || context === void 0 ? void 0 : context.context) === null || _c === void 0 ? void 0 : _c.getData());\n    // @ts-ignore\n    (_d = context === null || context === void 0 ? void 0 : context.context) === null || _d === void 0 ? void 0 : _d.setState({\n      isTableEditor: true\n    });\n  };\n  /**\n   * reset\n   * @description 取消\n   */\n  var reset = function reset() {\n    var _a;\n    // @ts-ignore\n    return (_a = context === null || context === void 0 ? void 0 : context.context) === null || _a === void 0 ? void 0 : _a.setState({\n      isTableEditor: false\n    });\n  };\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: classNames(\"\".concat(selectorPrefix, \"-editor-table-control\"), className),\n    style: styles !== null && styles !== void 0 ? styles : {}\n  }, /*#__PURE__*/React.createElement(ConditionalRender, {\n    conditional: !(context === null || context === void 0 ? void 0 : context.context.state.isTableEditor),\n    noMatch: function noMatch() {\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"\".concat(selectorPrefix, \"-editor-table-control-save-cancel\")\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"\".concat(selectorPrefix, \"-editor-table-control-save-cancel-item\"),\n        onClick: function onClick() {\n          var _a, _b, _c, _d, _e;\n          return (_e = (_d = (_c = (_b = (_a = context === null || context === void 0 ? void 0 : context.editable) === null || _a === void 0 ? void 0 : _a.tableEditable) === null || _b === void 0 ? void 0 : _b.form) === null || _c === void 0 ? void 0 : _c.validateFields()) === null || _d === void 0 ? void 0 : _d.then) === null || _e === void 0 ? void 0 : _e.call(_d, function (values) {\n            return validateFieldsSuccess(values);\n          });\n        }\n      }, /*#__PURE__*/React.createElement(ConditionalRender, {\n        conditional: !renderSave,\n        noMatch: function noMatch() {\n          return renderSave === null || renderSave === void 0 ? void 0 : renderSave();\n        }\n      }, function () {\n        return renderDefaultSave();\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"\".concat(selectorPrefix, \"-editor-table-control-save-cancel-item\"),\n        onClick: reset\n      }, /*#__PURE__*/React.createElement(ConditionalRender, {\n        conditional: !renderCancel,\n        noMatch: function noMatch() {\n          return renderCancel === null || renderCancel === void 0 ? void 0 : renderCancel();\n        }\n      }, function () {\n        return renderDefaultCancel();\n      })));\n    }\n  }, function () {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"\".concat(selectorPrefix, \"-editor-table-control-edit\"),\n      onClick: _onEditor\n    }, /*#__PURE__*/React.createElement(ConditionalRender, {\n      conditional: !renderEditorTable,\n      noMatch: function noMatch() {\n        return renderEditorTable === null || renderEditorTable === void 0 ? void 0 : renderEditorTable();\n      }\n    }, function () {\n      return renderDefaultEditorTable();\n    }));\n  }));\n};\nexport default EditableTableControl;"],"names":["classNames","React","useCallback","useContext","ConditionalRender","Intl","SearchTableContext","selectorPrefix","EditableTableControl","_a","className","styles","renderEditorTable","renderSave","renderCancel","onEditor","onSave","context","renderDefaultSave","createElement","v","renderDefaultCancel","renderDefaultEditorTable","validateFieldsSuccess","values","dataSource","then","updateEditorCellTableData","_onEditor","updateTableEdit","changeData","_b","updateEditorData","reset","_c","_d","setFieldValues","call","getData","setState","isTableEditor","concat","style","conditional","state","noMatch","onClick","_e","editable","tableEditable","form","validateFields"],"mappings":"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"}