import _Form from"antd/es/form";import{__assign,__spreadArray}from"tslib";import React,{useContext,useEffect}from"react";import{CheckOutlined,CloseOutlined}from"@ant-design/icons";import ConditionalRender from"@baifendian/adhere-ui-conditionalrender";import{SearchTableContext,selectorPrefix}from"../../../SearchTable";import FormItemGenerator from"./FormItemGenerator";var EditableTableCellEdit=function(e){var l=e.editableConfig,r=l.useTrigger,n=l.useKeepEdit,t=l.renderSaveTrigger,a=l.renderCancelTrigger,o=l.onSave,i=l.onBeforeCancel,d=l.dataIndex,c=l.type,u=l.render,m=l.rules,l=l.formItemProps,s=e.record,v=e.rowIndex,f=e.onTriggerChange,x=useContext(SearchTableContext),g=[null==(g=null==(g=null==x?void 0:x.formList)?void 0:g.fields[v])?void 0:g.name,d],C=__spreadArray(["dataSource"],g,!0),I=_Form.useWatch(C,null==x?void 0:x.form);function b(){var e,l;null!=(l=null==(e=null==(e=null==(l=null==x?void 0:x.form)?void 0:l.validateFields)?void 0:e.call(l))?void 0:e.then)&&l.call(e,function(e){o?null!=(e=o({value:I,values:e,record:s,dataIndex:d,rowIndex:v}))&&e.then(function(){return null==f?void 0:f()}):null!=f&&f()})}function p(){var e;i?null!=(e=i({value:I,record:s,dataIndex:d,rowIndex:v}))&&e.then(function(){return null==f?void 0:f()}):null!=f&&f()}return useEffect(function(){var e,l;null!=(e=null==x?void 0:x.form)&&e.setFieldValue(C,null==(l=null==(e=null==x?void 0:x.context)?void 0:e.valueToFormItemValue)?void 0:l.call(e,{type:c,record:s,dataIndex:d}))},[null==s?void 0:s[d]]),React.createElement("div",{className:"".concat(selectorPrefix,"-editablecell-edit")},React.createElement("div",{className:"".concat(selectorPrefix,"-editablecell-edit-inner")},React.createElement(_Form.Item,__assign({name:g,rules:m},l||{}),"custom"!==c?(g=FormItemGenerator.render({type:c,props:__assign({autoFocus:!n},e.editableConfig.props),dictName:e.editableConfig.dictName,renderChildren:e.editableConfig.renderChildren,form:null==x?void 0:x.form,dataIndex:d,rowIndex:v}),u?u({value:null==s?void 0:s[d],record:s,dataIndex:d,rowIndex:v,form:null==x?void 0:x.form,children:g}):g):null==u?void 0:u({value:null==s?void 0:s[d],record:s,dataIndex:d,rowIndex:v,form:null==x?void 0:x.form}))),React.createElement(ConditionalRender,{conditional:!!r&&!n},function(){return React.createElement("div",{className:"".concat(selectorPrefix,"-editablecell-edit-trigger")},React.createElement("div",{className:"".concat(selectorPrefix,"-editablecell-edit-trigger-inner")},React.createElement("div",{className:"".concat(selectorPrefix,"-editablecell-edit-trigger-save"),onClick:b},!!t&&(null==t?void 0:t({value:null==s?void 0:s[d],record:s,dataIndex:d,rowIndex:v})),!t&&React.createElement(CheckOutlined,null)),React.createElement("div",{className:"".concat(selectorPrefix,"-editablecell-edit-trigger-cancel"),onClick:p},!!a&&(null==a?void 0:a({value:null==s?void 0:s[d],record:s,dataIndex:d,rowIndex:v})),!a&&React.createElement(CloseOutlined,null))))}))};export default EditableTableCellEdit;
//# sourceMappingURL=EditableTableCellEdit.js.map
