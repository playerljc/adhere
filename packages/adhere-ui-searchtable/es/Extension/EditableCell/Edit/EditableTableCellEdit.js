import _CloseOutlined from"@ant-design/icons/es/icons/CloseOutlined";import _CheckOutlined from"@ant-design/icons/es/icons/CheckOutlined";import _Form from"antd/es/form";var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var l,t=1,n=arguments.length;t<n;t++)for(var a in l=arguments[t])Object.prototype.hasOwnProperty.call(l,a)&&(e[a]=l[a]);return e}).apply(this,arguments)},__spreadArray=this&&this.__spreadArray||function(e,l,t){if(t||2===arguments.length)for(var n,a=0,r=l.length;a<r;a++)!n&&a in l||((n=n||Array.prototype.slice.call(l,0,a))[a]=l[a]);return e.concat(n||Array.prototype.slice.call(l))};import React,{useContext,useEffect,useMemo}from"react";import ConditionalRender from"@baifendian/adhere-ui-conditionalrender";import Util from"@baifendian/adhere-util";import{SearchTableContext,selectorPrefix}from"../../../SearchTable";import FormItemGenerator from"./FormItemGenerator";var EditableTableCellEdit=function(e){var l,t=e.editableConfig,n=t.useTrigger,a=t.useKeepEdit,r=t.renderSaveTrigger,i=t.renderCancelTrigger,o=t.onSave,d=t.onBeforeCancel,c=t.dataIndex,u=t.type,s=t.render,v=t.rules,t=t.formItemProps,m=e.record,f=e.rowIndex,b=e.onTriggerChange,p=useContext(SearchTableContext),g=[null==(g=null==(g=null==(g=null==(g=null==p?void 0:p.editable)?void 0:g.tableEditable)?void 0:g.formList)?void 0:g.fields[f])?void 0:g.name,c],x=__spreadArray(["dataSource"],g,!0),E=_Form.useWatch(x,null==(h=null==(h=null==p?void 0:p.editable)?void 0:h.tableEditable)?void 0:h.form);function C(){var e,l;o&&null!=(l=null==(e=null==(e=null==(l=null==(l=null==(l=null==p?void 0:p.editable)?void 0:l.tableEditable)?void 0:l.form)?void 0:l.validateFields)?void 0:e.call(l))?void 0:e.then)&&l.call(e,function(e){null!=(e=o({value:E,values:e,record:m,dataIndex:c,rowIndex:f}))&&e.then(function(){return null==b?void 0:b()})}),null!=b&&b()}function I(){var e;d?null!=(e=d({value:E,record:m,dataIndex:c,rowIndex:f}))&&e.then(function(){return null==b?void 0:b()}):null!=b&&b()}var _,h=useMemo(function(){return Util.isFunction(v)?v({record:m,value:E,rowIndex:f,dataIndex:c}):v},[v,m,E,f,c]);return useEffect(function(){var e,l;null!=(e=null==(e=null==(e=null==p?void 0:p.editable)?void 0:e.tableEditable)?void 0:e.form)&&e.setFieldValue(x,null==(l=null==(e=null==p?void 0:p.context)?void 0:e.valueToFormItemValue)?void 0:l.call(e,{type:u,record:m,dataIndex:c}))},[null==(l=null==p?void 0:p.context)?void 0:l.getData()]),React.createElement("div",{className:"".concat(selectorPrefix,"-editable-cell-edit")},React.createElement("div",{className:"".concat(selectorPrefix,"-editable-cell-edit-inner")},React.createElement(_Form.Item,__assign({name:g,rules:h},null!=t?t:{}),"custom"!==u?(_=Util.isFunction(e.editableConfig.props)?null!=(_=e.editableConfig.props({record:m,dataIndex:c,rowIndex:f}))?_:{}:null!=(_=e.editableConfig.props)?_:{},FormItemGenerator.render({type:u,props:__assign({autoFocus:!a},_),dictName:e.editableConfig.dictName,form:null==(_=null==(_=null==p?void 0:p.editable)?void 0:_.tableEditable)?void 0:_.form,dataIndex:c,rowIndex:f})):null==s?void 0:s({value:null==m?void 0:m[c],record:m,dataIndex:c,rowIndex:f,form:null==(g=null==(l=null==p?void 0:p.editable)?void 0:l.tableEditable)?void 0:g.form}))),React.createElement(ConditionalRender,{conditional:!!n&&!a},function(){return React.createElement("div",{className:"".concat(selectorPrefix,"-editable-cell-edit-trigger")},React.createElement("div",{className:"".concat(selectorPrefix,"-editable-cell-edit-trigger-inner")},React.createElement("div",{className:"".concat(selectorPrefix,"-editable-cell-edit-trigger-save"),onClick:C},!!r&&(null==r?void 0:r({value:null==m?void 0:m[c],record:m,dataIndex:c,rowIndex:f})),!r&&React.createElement(_CheckOutlined,null)),React.createElement("div",{className:"".concat(selectorPrefix,"-editable-cell-edit-trigger-cancel"),onClick:I},!!i&&(null==i?void 0:i({value:null==m?void 0:m[c],record:m,dataIndex:c,rowIndex:f})),!i&&React.createElement(_CloseOutlined,null))))}))};EditableTableCellEdit.displayName="EditableTableCellEdit";export default EditableTableCellEdit;
//# sourceMappingURL=EditableTableCellEdit.js.map
