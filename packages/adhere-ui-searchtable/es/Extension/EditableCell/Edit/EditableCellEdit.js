import _Form from"antd/es/form";import{__assign}from"tslib";import moment from"moment";import React,{useContext,useEffect}from"react";import{CheckOutlined,CloseOutlined}from"@ant-design/icons";import ConditionalRender from"@baifendian/adhere-ui-conditionalrender";import{SearchTableContext,selectorPrefix}from"../../../SearchTable";import{EditableContext}from"../EditableRow";import FormItemGenerator from"./FormItemGenerator";var EditableCellEdit=function(t){var e=t.editableConfig,n=e.useTrigger,r=e.useKeepEdit,l=e.renderSaveTrigger,o=e.renderCancelTrigger,a=e.onSave,i=e.onBeforeCancel,d=e.dataIndex,c=e.type,u=e.render,m=e.rules,e=e.formItemProps,s=t.record,f=t.rowIndex,x=t.onTriggerChange,v=useContext(EditableContext),C=useContext(SearchTableContext),g=_Form.useWatch(d,v);function p(){null!=v&&v.validateFields().then(function(e){a?null!=(e=a({value:g,values:e,record:s,dataIndex:d,rowIndex:f}))&&e.then(function(){return null==x?void 0:x()}):null!=x&&x()})}function I(){var e;i?null!=(e=i({value:g,record:s,dataIndex:d,rowIndex:f}))&&e.then(function(){return null==x?void 0:x()}):null!=x&&x()}function b(){var e;g instanceof moment?null!=(e=null==C?void 0:C.context)&&e.updateEditorCellDateData({record:s,dataIndex:d,value:g}):null!=(e=null==C?void 0:C.context)&&e.updateEditorCellDate({record:s,dataIndex:d,value:g})}return useEffect(function(){var e;null!=v&&v.setFieldValue(d,null==(e=null==C?void 0:C.context)?void 0:e.valueToFormItemValue({type:c,record:s,dataIndex:d}))},[null==s?void 0:s[d]]),React.createElement("div",{className:"".concat(selectorPrefix,"-editablecell-edit")},React.createElement("div",{className:"".concat(selectorPrefix,"-editablecell-edit-inner")},React.createElement(_Form.Item,__assign({name:d,rules:m},e||{}),"custom"!==c?(m=__assign({autoFocus:!r},t.editableConfig.props),!r&&n||(m=__assign(__assign({},m),{onBlur:function(e){t.editableConfig.props.onBlur&&t.editableConfig.props.onBlur(e,{form:v,dataIndex:d,rowIndex:f}),b()},onChange:function(e){t.editableConfig.props.onChange&&t.editableConfig.props.onChange(e,{form:v,dataIndex:d,rowIndex:f}),b()}})),m=FormItemGenerator.render({type:c,props:m,dictName:t.editableConfig.dictName,renderChildren:t.editableConfig.renderChildren,form:v,dataIndex:d,rowIndex:f}),u?u({value:null==s?void 0:s[d],record:s,dataIndex:d,rowIndex:f,form:v,children:m}):m):null==u?void 0:u({value:null==s?void 0:s[d],record:s,dataIndex:d,rowIndex:f,form:v}))),React.createElement(ConditionalRender,{conditional:!!n&&!r},function(){return React.createElement("div",{className:"".concat(selectorPrefix,"-editablecell-edit-trigger")},React.createElement("div",{className:"".concat(selectorPrefix,"-editablecell-edit-trigger-inner")},React.createElement("div",{className:"".concat(selectorPrefix,"-editablecell-edit-trigger-save"),onClick:p},!!l&&(null==l?void 0:l({value:null==s?void 0:s[d],record:s,dataIndex:d,rowIndex:f})),!l&&React.createElement(CheckOutlined,null)),React.createElement("div",{className:"".concat(selectorPrefix,"-editablecell-edit-trigger-cancel"),onClick:I},!!o&&(null==o?void 0:o({value:null==s?void 0:s[d],record:s,dataIndex:d,rowIndex:f})),!o&&React.createElement(CloseOutlined,null))))}))};export default EditableCellEdit;
//# sourceMappingURL=EditableCellEdit.js.map
