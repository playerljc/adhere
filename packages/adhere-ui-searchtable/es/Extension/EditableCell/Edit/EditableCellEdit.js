import{__assign}from"tslib";import{Form}from"antd";import dayjs from"dayjs";import React,{useContext,useEffect}from"react";import{CheckOutlined,CloseOutlined}from"@ant-design/icons";import ConditionalRender from"@baifendian/adhere-ui-conditionalrender";import{SearchTableContext,selectorPrefix}from"../../../SearchTable";import{EditableContext}from"../EditableRow";import EventTypes from"../EventTypes";import FormItemGenerator from"./FormItemGenerator";var EditableCellEdit=function(r){var e,t=r.editableConfig,n=t.useTrigger,l=t.useKeepEdit,a=t.renderSaveTrigger,o=t.renderCancelTrigger,d=t.onSave,i=t.onBeforeCancel,c=t.dataIndex,u=t.type,s=t.render,m=t.rules,t=t.formItemProps,f=r.record,v=r.rowIndex,x=r.onTriggerChange,C=useContext(EditableContext),p=useContext(SearchTableContext),g=Form.useWatch(c,C);function E(){d?null!=C&&C.validateFields().then(function(e){null!=(e=d({value:g,values:e,record:f,dataIndex:c,rowIndex:v}))&&e.then(function(){return null==x?void 0:x()})}):null!=x&&x()}function I(){var e;i?null!=(e=i({value:g,record:f,dataIndex:c,rowIndex:v}))&&e.then(function(){return null==x?void 0:x()}):null!=x&&x()}function b(){var e;return g instanceof dayjs?null==(e=null==p?void 0:p.context)?void 0:e.updateEditorCellDateData({record:f,dataIndex:c,value:g}):null==(e=null==p?void 0:p.context)?void 0:e.updateEditorCellDate({record:f,dataIndex:c,value:g})}return useEffect(function(){var e;null!=C&&C.setFieldValue(c,null==(e=null==p?void 0:p.context)?void 0:e.valueToFormItemValue({type:u,record:f,dataIndex:c}))},[null==(e=null==p?void 0:p.context)?void 0:e.getData()]),React.createElement("div",{className:selectorPrefix+"-editablecell-edit"},React.createElement("div",{className:selectorPrefix+"-editablecell-edit-inner"},React.createElement(Form.Item,__assign({name:c,rules:m},t||{}),"custom"!==u?(e=__assign(__assign({autoFocus:!l},r.editableConfig.props),EventTypes.reduce(function(e,t){return e[t]=function(e){r.editableConfig.props[t]&&r.editableConfig.props[t](e,{form:C,dataIndex:c,rowIndex:v,updateEditorCellData:b})},e},{})),e=FormItemGenerator.render({type:u,props:e,dictName:r.editableConfig.dictName,renderChildren:r.editableConfig.renderChildren,form:C,dataIndex:c,rowIndex:v}),s?s({value:null==f?void 0:f[c],record:f,dataIndex:c,rowIndex:v,form:C,updateEditorCellData:b,children:e}):e):null==s?void 0:s({value:null==f?void 0:f[c],record:f,dataIndex:c,rowIndex:v,form:C,updateEditorCellData:b}))),React.createElement(ConditionalRender,{conditional:!!n&&!l},function(){return React.createElement("div",{className:selectorPrefix+"-editablecell-edit-trigger"},React.createElement("div",{className:selectorPrefix+"-editablecell-edit-trigger-inner"},React.createElement("div",{className:selectorPrefix+"-editablecell-edit-trigger-save",onClick:E},!!a&&(null==a?void 0:a({value:null==f?void 0:f[c],record:f,dataIndex:c,rowIndex:v})),!a&&React.createElement(CheckOutlined,null)),React.createElement("div",{className:selectorPrefix+"-editablecell-edit-trigger-cancel",onClick:I},!!o&&(null==o?void 0:o({value:null==f?void 0:f[c],record:f,dataIndex:c,rowIndex:v})),!o&&React.createElement(CloseOutlined,null))))}))};export default EditableCellEdit;
//# sourceMappingURL=EditableCellEdit.js.map
