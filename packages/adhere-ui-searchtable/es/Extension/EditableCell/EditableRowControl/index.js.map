{"version":3,"file":"index.js","sources":["Extension/EditableCell/EditableRowControl/index.js"],"sourcesContent":["import classNames from 'classnames';\nimport React, { useCallback, useContext } from 'react';\nimport ConditionalRender from '@baifendian/adhere-ui-conditionalrender';\nimport Intl from '@baifendian/adhere-util-intl';\nimport { SearchTableContext, selectorPrefix } from '../../../SearchTable';\nimport { EditableContext } from '../EditableRow';\n/**\n * EditableRowControl\n * @description 编辑行的控制器\n * @param record\n * @param renderCancel\n * @param onEditor\n * @param onSave\n * @param editorRowId\n * @param rowKey\n * @param className\n * @param styles\n * @param renderEditableRow\n * @param renderSave\n * @returns {JSX.Element}\n * @constructor\n */\n\nvar EditableRowControl = function EditableRowControl(_a) {\n  var className = _a.className,\n      styles = _a.styles,\n      renderEditorRow = _a.renderEditorRow,\n      renderSave = _a.renderSave,\n      renderCancel = _a.renderCancel,\n      record = _a.record,\n      rowKey = _a.rowKey,\n      editorRowId = _a.editorRowId,\n      onEditor = _a.onEditor,\n      onSave = _a.onSave;\n  var context = useContext(SearchTableContext);\n  var form = useContext(EditableContext);\n  var renderDefaultSave = useCallback(function () {\n    return /*#__PURE__*/React.createElement(\"a\", null, Intl.v('保存'));\n  }, []);\n  var renderDefaultCancel = useCallback(function () {\n    return /*#__PURE__*/React.createElement(\"a\", null, Intl.v('取消'));\n  }, []);\n  var renderDefaultEditorRow = useCallback(function () {\n    return /*#__PURE__*/React.createElement(\"a\", null, Intl.v('编辑行'));\n  }, []);\n  var validateFieldsSuccess = useCallback(function (values) {\n    if (onSave) {\n      onSave(values).then(function () {\n        return updateEditorCellRowData(values);\n      });\n      return;\n    }\n\n    updateEditorCellRowData(values);\n  }, []);\n\n  var _onEditor = useCallback(function () {\n    var _a;\n\n    if (onEditor) {\n      (_a = onEditor === null || onEditor === void 0 ? void 0 : onEditor(record[rowKey])) === null || _a === void 0 ? void 0 : _a.then(function () {\n        return updateRowEdit();\n      });\n      return;\n    }\n\n    updateRowEdit();\n  }, []);\n\n  var updateEditorCellRowData = function updateEditorCellRowData(values) {\n    var _a, _b; // @ts-ignore\n\n\n    return (_b = (_a = context === null || context === void 0 ? void 0 : context.context) === null || _a === void 0 ? void 0 : _a.updateEditorCellRowData({\n      values: values,\n      record: record\n    })) === null || _b === void 0 ? void 0 : _b.then(function () {\n      return reset();\n    });\n  };\n\n  var reset = function reset() {\n    var _a;\n\n    return (_a = context === null || context === void 0 ? void 0 : context.context) === null || _a === void 0 ? void 0 : _a.setState({\n      editorRowId: ''\n    });\n  };\n\n  var updateRowEdit = function updateRowEdit() {\n    var _a;\n\n    return (_a = context === null || context === void 0 ? void 0 : context.context) === null || _a === void 0 ? void 0 : _a.setState({\n      editorRowId: record[rowKey]\n    });\n  };\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: classNames(\"\".concat(selectorPrefix, \"-editor-row-control\"), className),\n    style: styles || {}\n  }, /*#__PURE__*/React.createElement(ConditionalRender, {\n    conditional: editorRowId !== record[rowKey],\n    noMatch: function noMatch() {\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"\".concat(selectorPrefix, \"-editor-row-control-save-cancel\")\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"\".concat(selectorPrefix, \"-editor-row-control-save-cancel-item\"),\n        onClick: function onClick() {\n          return form === null || form === void 0 ? void 0 : form.validateFields().then(function (values) {\n            return validateFieldsSuccess(values);\n          });\n        }\n      }, /*#__PURE__*/React.createElement(ConditionalRender, {\n        conditional: !renderSave,\n        noMatch: function noMatch() {\n          return renderSave === null || renderSave === void 0 ? void 0 : renderSave();\n        }\n      }, function () {\n        return renderDefaultSave();\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"\".concat(selectorPrefix, \"-editor-row-control-save-cancel-item\"),\n        onClick: reset\n      }, /*#__PURE__*/React.createElement(ConditionalRender, {\n        conditional: !renderCancel,\n        noMatch: function noMatch() {\n          return renderCancel === null || renderCancel === void 0 ? void 0 : renderCancel();\n        }\n      }, function () {\n        return renderDefaultCancel();\n      })));\n    }\n  }, function () {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"\".concat(selectorPrefix, \"-editor-row-control-edit\"),\n      onClick: _onEditor\n    }, /*#__PURE__*/React.createElement(ConditionalRender, {\n      conditional: !renderEditorRow,\n      noMatch: function noMatch() {\n        return renderEditorRow === null || renderEditorRow === void 0 ? void 0 : renderEditorRow();\n      }\n    }, function () {\n      return renderDefaultEditorRow();\n    }));\n  }));\n};\n\nexport default EditableRowControl;"],"names":["classNames","React","useCallback","useContext","ConditionalRender","Intl","SearchTableContext","selectorPrefix","EditableContext","EditableRowControl","_a","className","styles","renderEditorRow","renderSave","renderCancel","record","rowKey","editorRowId","onEditor","onSave","context","form","renderDefaultSave","createElement","v","renderDefaultCancel","renderDefaultEditorRow","validateFieldsSuccess","values","then","updateEditorCellRowData","_onEditor","updateRowEdit","_b","reset","setState","concat","style","conditional","noMatch","onClick","validateFields"],"mappings":"OAAOA,eAAgB,oBAChBC,OAASC,YAAaC,UAAyB,KAAP,eACxCC,sBAAuB,iDACvBC,SAAU,sCACRC,mBAAoBC,cAA4C,KAAtB,8BAC1CC,eAAuC,KAAhB,iBAkBhC,IAAIC,mBAAqB,SAA4BC,GACnD,IAAIC,EAAYD,EAAGC,UACfC,EAASF,EAAGE,OACZC,EAAkBH,EAAGG,gBACrBC,EAAaJ,EAAGI,WAChBC,EAAeL,EAAGK,aAClBC,EAASN,EAAGM,OACZC,EAASP,EAAGO,OACZC,EAAcR,EAAGQ,YACjBC,EAAWT,EAAGS,SACdC,EAASV,EAAGU,OACZC,EAAUlB,WAAWG,kBAAkB,EACvCgB,EAAOnB,WAAWK,eAAe,EACjCe,EAAoBrB,YAAY,WAClC,OAAoBD,MAAMuB,cAAc,IAAK,KAAMnB,KAAKoB,EAAE,IAAI,CAAC,CACjE,EAAG,EAAE,EACDC,EAAsBxB,YAAY,WACpC,OAAoBD,MAAMuB,cAAc,IAAK,KAAMnB,KAAKoB,EAAE,IAAI,CAAC,CACjE,EAAG,EAAE,EACDE,EAAyBzB,YAAY,WACvC,OAAoBD,MAAMuB,cAAc,IAAK,KAAMnB,KAAKoB,EAAE,KAAK,CAAC,CAClE,EAAG,EAAE,EACDG,EAAwB1B,YAAY,SAAU2B,GAC5CT,EACFA,EAAOS,CAAM,EAAEC,KAAK,WAClB,OAAOC,EAAwBF,CAAM,CACvC,CAAC,EAIHE,EAAwBF,CAAM,CAChC,EAAG,EAAE,EAEDG,EAAY9B,YAAY,WAC1B,IAAIQ,EAEAS,EACF,OAACT,EAAKS,MAAAA,EAA2C,KAAA,EAASA,EAASH,EAAOC,EAAO,IAAwCP,EAAGoB,KAAK,WAC/H,OAAOG,EAAc,CACvB,CAAC,EAIHA,EAAc,CAChB,EAAG,EAAE,EAEDF,EAA0B,SAAiCF,GAC7D,IAAQK,EAGR,OAAO,OAACA,EAAK,OAACxB,EAAKW,MAAAA,EAAyC,KAAA,EAASA,EAAQA,SAAqC,KAAA,EAASX,EAAGqB,wBAAwB,CACpJF,OAAQA,EACRb,OAAQA,CACV,CAAC,GAA+B,KAAA,EAASkB,EAAGJ,KAAK,WAC/C,OAAOK,EAAM,CACf,CAAC,CACH,EAEIA,EAAQ,WACV,IAAIzB,EAEJ,OAAO,OAACA,EAAKW,MAAAA,EAAyC,KAAA,EAASA,EAAQA,SAAqC,KAAA,EAASX,EAAG0B,SAAS,CAC/HlB,YAAa,EACf,CAAC,CACH,EAEIe,EAAgB,WAClB,IAAIvB,EAEJ,OAAO,OAACA,EAAKW,MAAAA,EAAyC,KAAA,EAASA,EAAQA,SAAqC,KAAA,EAASX,EAAG0B,SAAS,CAC/HlB,YAAaF,EAAOC,EACtB,CAAC,CACH,EAEA,OAAoBhB,MAAMuB,cAAc,MAAO,CAC7Cb,UAAWX,WAAW,GAAGqC,OAAO9B,eAAgB,qBAAqB,EAAGI,CAAS,EACjF2B,MAAO1B,GAAU,EACnB,EAAgBX,MAAMuB,cAAcpB,kBAAmB,CACrDmC,YAAarB,IAAgBF,EAAOC,GACpCuB,QAAS,WACP,OAAoBvC,MAAMuB,cAAc,MAAO,CAC7Cb,UAAW,GAAG0B,OAAO9B,eAAgB,iCAAiC,CACxE,EAAgBN,MAAMuB,cAAc,MAAO,CACzCb,UAAW,GAAG0B,OAAO9B,eAAgB,sCAAsC,EAC3EkC,QAAS,WACP,OAAOnB,MAAAA,EAAmC,KAAA,EAASA,EAAKoB,eAAe,EAAEZ,KAAK,SAAUD,GACtF,OAAOD,EAAsBC,CAAM,CACrC,CAAC,CACH,CACF,EAAgB5B,MAAMuB,cAAcpB,kBAAmB,CACrDmC,YAAa,CAACzB,EACd0B,QAAS,WACP,OAAO1B,MAAAA,EAA+C,KAAA,EAASA,EAAW,CAC5E,CACF,EAAG,WACD,OAAOS,EAAkB,CAC3B,CAAC,CAAC,EAAgBtB,MAAMuB,cAAc,MAAO,CAC3Cb,UAAW,GAAG0B,OAAO9B,eAAgB,sCAAsC,EAC3EkC,QAASN,CACX,EAAgBlC,MAAMuB,cAAcpB,kBAAmB,CACrDmC,YAAa,CAACxB,EACdyB,QAAS,WACP,OAAOzB,MAAAA,EAAmD,KAAA,EAASA,EAAa,CAClF,CACF,EAAG,WACD,OAAOW,EAAoB,CAC7B,CAAC,CAAC,CAAC,CACL,CACF,EAAG,WACD,OAAoBzB,MAAMuB,cAAc,MAAO,CAC7Cb,UAAW,GAAG0B,OAAO9B,eAAgB,0BAA0B,EAC/DkC,QAAST,CACX,EAAgB/B,MAAMuB,cAAcpB,kBAAmB,CACrDmC,YAAa,CAAC1B,EACd2B,QAAS,WACP,OAAO3B,MAAAA,EAAyD,KAAA,EAASA,EAAgB,CAC3F,CACF,EAAG,WACD,OAAOc,EAAuB,CAChC,CAAC,CAAC,CACJ,CAAC,CAAC,CACJ,iBAEelB"}