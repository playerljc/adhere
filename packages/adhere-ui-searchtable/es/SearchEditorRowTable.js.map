{"version":3,"file":"SearchEditorRowTable.js","sources":["SearchEditorRowTable.js"],"sourcesContent":["import \"core-js/modules/es.array.iterator.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\nimport \"core-js/modules/es.promise.js\";\nimport \"core-js/modules/es.object.keys.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport \"core-js/modules/es.array.find.js\";\nimport { __assign, __extends, __spreadArray } from \"tslib\";\nimport cloneDeep from 'lodash.clonedeep';\nimport moment from 'moment';\nimport SearchEditorCellTable from './SearchEditorCellTable';\n/**\n * SearchEditorRowTable\n * @class\n * @classdesc 行可编辑的表格\n */\n\nvar SearchEditorRowTable =\n/** @class */\nfunction (_super) {\n  __extends(SearchEditorRowTable, _super);\n\n  function SearchEditorRowTable(props) {\n    var _this = _super.call(this, props) || this;\n\n    _this.state = __assign(__assign({}, _this.state), {\n      editorRowId: ''\n    });\n    _this.rowConfigReducers = __spreadArray(__spreadArray([], _this.rowConfigReducers, true), [_this.rowEditableReducer], false);\n    return _this;\n  }\n  /**\n   * updateEditorCellRowData\n   * @description 更新可编辑单元格一行的数据\n   * @param values 一行的数据\n   * @param record\n   * @return Promise<void>\n   */\n\n\n  SearchEditorRowTable.prototype.updateEditorCellRowData = function (_a) {\n    var _this = this;\n\n    var values = _a.values,\n        record = _a.record;\n    return new Promise(function (resolve) {\n      var _a;\n\n      var listData = cloneDeep(_this.props[_this.getServiceName()]);\n      var dataSource = listData[_this.getFetchListPropName()][_this.getDataKey()] || [];\n\n      var rowKey = _this.getRowKey();\n\n      var keys = Object.keys(values);\n      keys.forEach(function (dataIndex) {\n        var value = values[dataIndex];\n\n        if (value instanceof moment) {\n          value = value.valueOf();\n        }\n\n        var recordItem = dataSource.find(function (t) {\n          return t[rowKey] === record[rowKey];\n        });\n\n        if (recordItem) {\n          recordItem[dataIndex] = value;\n        }\n      });\n\n      _this.props.dispatch((_a = {\n        type: \"\".concat(_this.getServiceName(), \"/receive\")\n      }, _a[_this.getServiceName()] = listData, _a)).then(function () {\n        return resolve();\n      });\n    });\n  };\n  /**\n   * rowEditableReducer\n   * @description 可编辑row的处理\n   * @param params\n   */\n\n\n  SearchEditorRowTable.prototype.rowEditableReducer = function (params) {\n    var rowConfig = params.rowConfig,\n        rowIndex = params.rowIndex,\n        columns = params.columns,\n        record = params.record;\n\n    if (this.onEditorRow) {\n      rowConfig.$editable = this.onEditorRow({\n        rowIndex: rowIndex,\n        record: record,\n        columns: columns\n      });\n    }\n\n    return rowConfig;\n  };\n  /**\n   * onEditorRow\n   * @param params\n   */\n\n\n  SearchEditorRowTable.prototype.onEditorRow = function (params) {\n    return {\n      editable: true\n    };\n  };\n  /**\n   * onEditorCell\n   * @param record\n   * @param editorConfig\n   */\n\n\n  SearchEditorRowTable.prototype.onEditorCell = function (_a) {\n    var record = _a.record,\n        editorConfig = _a.editorConfig;\n\n    if (editorConfig) {\n      editorConfig.useTrigger = false;\n\n      if (record[this.getRowKey()] === this.state.editorRowId) {\n        editorConfig.defaultStatus = 'edit';\n      }\n    }\n  };\n  /**\n   * fetchData\n   */\n\n\n  SearchEditorRowTable.prototype.fetchData = function () {\n    var _this = this;\n\n    return _super.prototype.fetchData.call(this).then(function (res) {\n      _this.setState({\n        editorRowId: ''\n      });\n\n      return res;\n    });\n  };\n\n  return SearchEditorRowTable;\n}(SearchEditorCellTable);\n\nexport default SearchEditorRowTable;"],"names":["__assign","__extends","__spreadArray","cloneDeep","moment","SearchEditorCellTable","SearchEditorRowTable","_super","props","_this","call","this","state","editorRowId","rowConfigReducers","rowEditableReducer","prototype","updateEditorCellRowData","_a","values","record","Promise","resolve","listData","getServiceName","dataSource","getFetchListPropName","getDataKey","rowKey","getRowKey","Object","keys","forEach","dataIndex","value","recordItem","valueOf","find","t","dispatch","type","concat","then","params","rowConfig","rowIndex","columns","onEditorRow","$editable","editable","onEditorCell","editorConfig","useTrigger","defaultStatus","fetchData","res","setState"],"mappings":"MAAO,6CACA,+CACA,wDACA,sCACA,0CACA,wDACA,0CACEA,SAAUC,UAAWC,aAA4B,KAAP,eAC5CC,cAAe,0BACfC,WAAY,gBACZC,0BAA2B,0BAOlC,IAAIC,qBAEJ,SAAUC,GAGR,SAASD,EAAqBE,GACxBC,EAAQF,EAAOG,KAAKC,KAAMH,CAAK,GAAKG,KAMxC,OAJAF,EAAMG,MAAQZ,SAASA,SAAS,GAAIS,EAAMG,KAAK,EAAG,CAChDC,YAAa,EACf,CAAC,EACDJ,EAAMK,kBAAoBZ,cAAcA,cAAc,GAAIO,EAAMK,kBAAmB,CAAA,CAAI,EAAG,CAACL,EAAMM,oBAAqB,CAAA,CAAK,EACpHN,CACT,CAqHA,OA/HAR,UAAUK,EAAsBC,CAAM,EAoBtCD,EAAqBU,UAAUC,wBAA0B,SAAUC,GACjE,IAAIT,EAAQE,KAERQ,EAASD,EAAGC,OACZC,EAASF,EAAGE,OAChB,OAAO,IAAIC,QAAQ,SAAUC,GAC3B,IAAIJ,EAEAK,EAAWpB,UAAUM,EAAMD,MAAMC,EAAMe,eAAe,EAAE,EACxDC,EAAaF,EAASd,EAAMiB,qBAAqB,GAAGjB,EAAMkB,WAAW,IAAM,GAE3EC,EAASnB,EAAMoB,UAAU,EAElBC,OAAOC,KAAKZ,CAAM,EACxBa,QAAQ,SAAUC,GACrB,IAAIC,EAAQf,EAAOc,GAMfE,GAJAD,aAAiB9B,SACnB8B,EAAQA,EAAME,QAAQ,GAGPX,EAAWY,KAAK,SAAUC,GACzC,OAAOA,EAAEV,KAAYR,EAAOQ,EAC9B,CAAC,GAEGO,IACFA,EAAWF,GAAaC,EAE5B,CAAC,EAEDzB,EAAMD,MAAM+B,WAAUrB,EAAK,CACzBsB,KAAM,GAAGC,OAAOhC,EAAMe,eAAe,EAAG,UAAU,CACpD,GAAMf,EAAMe,eAAe,GAAKD,EAAUL,EAAG,EAAEwB,KAAK,WAClD,OAAOpB,EAAQ,CACjB,CAAC,CACH,CAAC,CACH,EAQAhB,EAAqBU,UAAUD,mBAAqB,SAAU4B,GAC5D,IAAIC,EAAYD,EAAOC,UACnBC,EAAWF,EAAOE,SAClBC,EAAUH,EAAOG,QACjB1B,EAASuB,EAAOvB,OAUpB,OARIT,KAAKoC,cACPH,EAAUI,UAAYrC,KAAKoC,YAAY,CACrCF,SAAUA,EACVzB,OAAQA,EACR0B,QAASA,CACX,CAAC,GAGIF,CACT,EAOAtC,EAAqBU,UAAU+B,YAAc,SAAUJ,GACrD,MAAO,CACLM,SAAU,CAAA,CACZ,CACF,EAQA3C,EAAqBU,UAAUkC,aAAe,SAAUhC,GACtD,IAAIE,EAASF,EAAGE,OACZ+B,EAAejC,EAAGiC,aAElBA,IACFA,EAAaC,WAAa,CAAA,EAEtBhC,EAAOT,KAAKkB,UAAU,KAAOlB,KAAKC,MAAMC,cAC1CsC,EAAaE,cAAgB,QAGnC,EAMA/C,EAAqBU,UAAUsC,UAAY,WACzC,IAAI7C,EAAQE,KAEZ,OAAOJ,EAAOS,UAAUsC,UAAU5C,KAAKC,IAAI,EAAE+B,KAAK,SAAUa,GAK1D,OAJA9C,EAAM+C,SAAS,CACb3C,YAAa,EACf,CAAC,EAEM0C,CACT,CAAC,CACH,EAEOjD,CACT,EAAED,qBAAqB,iBAERC"}