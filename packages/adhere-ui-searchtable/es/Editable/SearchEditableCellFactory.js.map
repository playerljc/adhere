{"version":3,"file":"SearchEditableCellFactory.js","sources":["Editable/SearchEditableCellFactory.js"],"sourcesContent":["import { __assign, __extends, __spreadArrays } from \"tslib\";\r\nimport dayjs from 'dayjs';\r\nexport default function (SuperClass) {\r\n    return /** @class */ (function (_super) {\r\n        __extends(class_1, _super);\r\n        function class_1(props) {\r\n            var _this = _super.call(this, props) || this;\r\n            /**\r\n             * valueToFormItemValueMap\r\n             * @description 值和表单控件值之间的转换，现在只涉及到时间控件\r\n             */\r\n            _this.valueToFormItemValueMap = new Map([\r\n                [\r\n                    'rangePicker',\r\n                    function (_a) {\r\n                        var record = _a.record, dataIndex = _a.dataIndex;\r\n                        var value = record === null || record === void 0 ? void 0 : record[dataIndex];\r\n                        return Array.isArray(value) && value.length === 2\r\n                            ? [dayjs(value[0]), dayjs(value[1])]\r\n                            : [dayjs(), dayjs()];\r\n                    },\r\n                ],\r\n                [\r\n                    'datePicker',\r\n                    function (_a) {\r\n                        var record = _a.record, dataIndex = _a.dataIndex;\r\n                        var value = record === null || record === void 0 ? void 0 : record[dataIndex];\r\n                        return dayjs(value);\r\n                    },\r\n                ],\r\n                [\r\n                    'timePicker',\r\n                    function (_a) {\r\n                        var record = _a.record, dataIndex = _a.dataIndex;\r\n                        var value = record === null || record === void 0 ? void 0 : record[dataIndex];\r\n                        return dayjs(value);\r\n                    },\r\n                ],\r\n            ]);\r\n            _this.state = __assign(__assign({}, _this.state), { activeValue: '' });\r\n            _this.cellConfigReducers = __spreadArrays(_this.cellConfigReducers, [_this.cellEditableReducer]);\r\n            return _this;\r\n        }\r\n        /**\r\n         * onTableRowComponentReducers\r\n         * @param columns\r\n         */\r\n        class_1.prototype.onTableRowComponentReducers = function (columns) {\r\n            var existsEditable = columns.some(function (column) { var _a; return '$editable' in column && ((_a = column.$editable) === null || _a === void 0 ? void 0 : _a.editable); });\r\n            if (existsEditable) {\r\n                return __spreadArrays(this.tableRowComponentReducers, ['useEditableRow']);\r\n            }\r\n            return this.tableRowComponentReducers;\r\n        };\r\n        /**\r\n         * onTableCellComponentReducers\r\n         * @param columns\r\n         */\r\n        class_1.prototype.onTableCellComponentReducers = function (columns) {\r\n            var existsEditor = columns.some(function (column) { var _a; return '$editable' in column && ((_a = column.$editable) === null || _a === void 0 ? void 0 : _a.editable); });\r\n            if (existsEditor) {\r\n                return __spreadArrays(this.tableCellComponentReducers, ['useEditableCell']);\r\n            }\r\n            return this.tableCellComponentReducers;\r\n        };\r\n        class_1.prototype.onEditorRow = function (params) {\r\n            return {\r\n                editable: false,\r\n            };\r\n        };\r\n        class_1.prototype.onEditorCell = function (params) { };\r\n        /**\r\n         * cellEditableReducer\r\n         * @description 可编辑单元格的onCell处理\r\n         * @param params\r\n         */\r\n        class_1.prototype.cellEditableReducer = function (params) {\r\n            var _a;\r\n            var rowIndex = params.rowIndex, column = params.column, record = params.record;\r\n            // 如果设置了$editable则调用onEditorCell方法对每个cell进行props注入\r\n            if ('$editable' in column && ((_a = column.$editable) === null || _a === void 0 ? void 0 : _a.editable) && this.onEditorCell) {\r\n                this.onEditorCell({\r\n                    rowIndex: rowIndex,\r\n                    editorConfig: column.$editable,\r\n                    record: __assign({}, record),\r\n                });\r\n                return column;\r\n            }\r\n            return column;\r\n        };\r\n        /**\r\n         * valueToFormItemValue\r\n         * @description 值和表单值的转换\r\n         */\r\n        class_1.prototype.valueToFormItemValue = function (_a) {\r\n            var type = _a.type, record = _a.record, dataIndex = _a.dataIndex;\r\n            var item = this.valueToFormItemValueMap.get(type);\r\n            return item ? item === null || item === void 0 ? void 0 : item({ record: record, dataIndex: dataIndex }) : record === null || record === void 0 ? void 0 : record[dataIndex];\r\n        };\r\n        /**\r\n         * setActiveValue\r\n         * @param activeValue\r\n         */\r\n        class_1.prototype.setActiveValue = function (activeValue) {\r\n            var _this = this;\r\n            return new Promise(function (resolve) {\r\n                _this.setState({\r\n                    activeValue: activeValue,\r\n                }, function () { return resolve(); });\r\n            });\r\n        };\r\n        /**\r\n         * getActiveValue\r\n         */\r\n        class_1.prototype.getActiveValue = function () {\r\n            return this.state.activeValue;\r\n        };\r\n        return class_1;\r\n    }(SuperClass));\r\n}\r\n//# sourceMappingURL=SearchEditableCellFactory.js.map"],"names":["__assign","__extends","__spreadArrays","dayjs","SuperClass","class_1","_super","prototype","onTableRowComponentReducers","columns","some","column","_a","$editable","editable","this","tableRowComponentReducers","onTableCellComponentReducers","tableCellComponentReducers","onEditorRow","params","onEditorCell","cellEditableReducer","rowIndex","record","editorConfig","valueToFormItemValue","type","dataIndex","item","valueToFormItemValueMap","get","setActiveValue","activeValue","_this","Promise","resolve","setState","getActiveValue","state","props","call","Map","value","Array","isArray","length","cellConfigReducers"],"mappings":"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"}