{"version":3,"file":"SearchEditableFactory.js","sources":["Editable/SearchEditableFactory.js"],"sourcesContent":["import _Form from \"antd/es/form\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.array.map.js\";\nimport \"core-js/modules/es.array.reduce.js\";\nimport { __assign, __extends, __spreadArray } from \"tslib\";\nimport React, { createRef } from 'react';\nimport { SearchTableContext, selectorPrefix } from '../SearchTable';\nexport default function (SuperClass) {\n  return (\n    /** @class */\n    function (_super) {\n      __extends(class_1, _super);\n\n      function class_1(props) {\n        var _this = _super.call(this, props) || this;\n\n        _this.formRef = /*#__PURE__*/createRef();\n        _this.state = __assign(__assign({}, _this.state), {\n          isTableEditor: false\n        });\n        _this.rowConfigReducers = __spreadArray(__spreadArray([], _this.rowConfigReducers, true), [_this.rowEditableReducer], false);\n        return _this;\n      }\n\n      class_1.prototype.onTableRowComponentReducers = function (columns) {\n        var existsEditor = columns.some(function (column) {\n          var _a;\n\n          return '$editable' in column && ((_a = column.$editable) === null || _a === void 0 ? void 0 : _a.editable);\n        });\n\n        if (existsEditor) {\n          return __spreadArray(__spreadArray([], this.tableRowComponentReducers, true), ['useEditableTableRow'], false);\n        }\n\n        return this.tableRowComponentReducers;\n      };\n\n      class_1.prototype.onTableCellComponentReducers = function (columns) {\n        var existsEditor = columns.some(function (column) {\n          var _a;\n\n          return '$editable' in column && ((_a = column.$editable) === null || _a === void 0 ? void 0 : _a.editable);\n        });\n\n        if (existsEditor) {\n          return __spreadArray(__spreadArray([], this.tableCellComponentReducers, true), ['useEditableTableCell'], false);\n        }\n\n        return this.tableCellComponentReducers;\n      };\n      /**\n       * rowEditableReducer\n       * @description 可编辑row的处理\n       * @param params\n       */\n\n\n      class_1.prototype.rowEditableReducer = function (params) {\n        var rowConfig = params.rowConfig,\n            rowIndex = params.rowIndex,\n            columns = params.columns,\n            record = params.record;\n\n        if (this.onEditorRow) {\n          rowConfig.$editable = this.onEditorRow({\n            rowIndex: rowIndex,\n            record: record,\n            columns: columns\n          });\n        }\n\n        return rowConfig;\n      };\n      /**\n       * onEditorRow\n       * @param params\n       */\n\n\n      class_1.prototype.onEditorRow = function (params) {\n        return {\n          editable: true\n        };\n      };\n      /**\n       * onEditorCell\n       * @param record\n       * @param editorConfig\n       */\n\n\n      class_1.prototype.onEditorCell = function (_a) {\n        var record = _a.record,\n            editorConfig = _a.editorConfig;\n\n        if (editorConfig) {\n          editorConfig.useTrigger = false;\n\n          if (this.state.isTableEditor) {\n            editorConfig.defaultStatus = 'edit';\n          }\n        }\n      };\n      /**\n       * fetchData\n       */\n\n\n      class_1.prototype.fetchData = function () {\n        var _this = this;\n\n        return _super.prototype.fetchData.call(this).then(function (res) {\n          var _a, _b, _c;\n\n          var dataSource = _this.getData();\n\n          var columns = _this.getTableColumns();\n\n          (_c = (_b = (_a = _this.formRef) === null || _a === void 0 ? void 0 : _a.current) === null || _b === void 0 ? void 0 : _b.setFieldValue) === null || _c === void 0 ? void 0 : _c.call(_b, 'dataSource', (dataSource || []).map(function (_record) {\n            var _a;\n\n            return (columns || []).reduce(function (_r, _a) {\n              var dataIndex = _a.dataIndex,\n                  $editable = _a.$editable;\n\n              if (dataIndex in _record && $editable && 'type' in $editable) {\n                _r[dataIndex] = _this.valueToFormItemValue({\n                  type: $editable.type,\n                  record: _record,\n                  dataIndex: dataIndex\n                });\n              }\n\n              return _r;\n            }, (_a = {}, _a[_this.getRowKey()] = _record[_this.getRowKey()], _a));\n          }));\n\n          _this.setState({\n            isTableEditor: false\n          });\n\n          return res;\n        });\n      };\n      /**\n       * render\n       * @protected\n       */\n\n\n      class_1.prototype.render = function () {\n        var _this = this;\n\n        return /*#__PURE__*/React.createElement(\"div\", {\n          className: \"\".concat(selectorPrefix, \"-wrap\")\n        }, /*#__PURE__*/React.createElement(_Form, {\n          // @ts-ignore\n          ref: this.formRef,\n          className: \"\".concat(selectorPrefix, \"-form\"),\n          component: false\n        }, /*#__PURE__*/React.createElement(_Form.List, {\n          name: \"dataSource\"\n        }, function (fields, operation, meta) {\n          var _a;\n\n          return /*#__PURE__*/React.createElement(SearchTableContext.Provider, {\n            value: {\n              // @ts-ignore\n              context: _this,\n              // @ts-ignore\n              form: (_a = _this.formRef) === null || _a === void 0 ? void 0 : _a.current,\n              formList: {\n                fields: fields,\n                operation: operation,\n                meta: meta\n              }\n            }\n          }, _this.renderChildren());\n        })));\n      };\n\n      return class_1;\n    }(SuperClass)\n  );\n}"],"names":["_Form","__assign","__extends","__spreadArray","React","createRef","SearchTableContext","selectorPrefix","SuperClass","class_1","_super","prototype","onTableRowComponentReducers","columns","some","column","_a","$editable","editable","this","tableRowComponentReducers","onTableCellComponentReducers","tableCellComponentReducers","rowEditableReducer","params","rowConfig","rowIndex","record","onEditorRow","onEditorCell","editorConfig","useTrigger","state","isTableEditor","defaultStatus","fetchData","_this","call","then","res","_b","_c","dataSource","getData","getTableColumns","formRef","current","setFieldValue","map","_record","reduce","_r","dataIndex","valueToFormItemValue","type","getRowKey","setState","render","createElement","className","concat","ref","component","List","name","fields","operation","meta","Provider","value","context","form","formList","renderChildren","props","rowConfigReducers"],"mappings":"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"}