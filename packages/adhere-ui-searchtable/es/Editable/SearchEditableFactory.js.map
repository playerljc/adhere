{"version":3,"file":"SearchEditableFactory.js","sources":["Editable/SearchEditableFactory.js"],"sourcesContent":["import _Form from \"antd/es/form\";\nvar __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n    return _extendStatics(d, b);\n  };\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    _extendStatics(d, b);\n    function __() {\n      this.constructor = d;\n    }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n    return t;\n  };\n  return __assign.apply(this, arguments);\n};\nvar __spreadArray = this && this.__spreadArray || function (to, from, pack) {\n  if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n    if (ar || !(i in from)) {\n      if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n      ar[i] = from[i];\n    }\n  }\n  return to.concat(ar || Array.prototype.slice.call(from));\n};\nimport React, { createRef } from 'react';\nimport { SearchTableContext, selectorPrefix } from '../SearchTable';\nexport default function (SuperClass) {\n  return (/** @class */function (_super) {\n      __extends(class_1, _super);\n      function class_1(props) {\n        var _this = _super.call(this, props) || this;\n        _this.formRef = /*#__PURE__*/createRef();\n        _this.state = __assign(__assign({}, _this.state), {\n          isTableEditor: false\n        });\n        _this.rowConfigReducers = __spreadArray(__spreadArray([], _this.rowConfigReducers, true), [_this.rowEditableReducer], false);\n        return _this;\n      }\n      class_1.prototype.onTableRowComponentReducers = function (columns) {\n        var existsEditor = columns.some(function (column) {\n          var _a;\n          return '$editable' in column && ((_a = column.$editable) === null || _a === void 0 ? void 0 : _a.editable);\n        });\n        if (existsEditor) {\n          return __spreadArray(__spreadArray([], this.tableRowComponentReducers, true), ['useEditableTableRow'], false);\n        }\n        return this.tableRowComponentReducers;\n      };\n      class_1.prototype.onTableCellComponentReducers = function (columns) {\n        var existsEditor = columns.some(function (column) {\n          var _a;\n          return '$editable' in column && ((_a = column.$editable) === null || _a === void 0 ? void 0 : _a.editable);\n        });\n        if (existsEditor) {\n          return __spreadArray(__spreadArray([], this.tableCellComponentReducers, true), ['useEditableTableCell'], false);\n        }\n        return this.tableCellComponentReducers;\n      };\n      /**\n       * rowEditableReducer\n       * @description 可编辑row的处理\n       * @param params\n       */\n      class_1.prototype.rowEditableReducer = function (params) {\n        var rowConfig = params.rowConfig,\n          rowIndex = params.rowIndex,\n          columns = params.columns,\n          record = params.record;\n        if (this.onEditorRow) {\n          rowConfig.$editable = this.onEditorRow({\n            rowIndex: rowIndex,\n            record: record,\n            columns: columns\n          });\n        }\n        return rowConfig;\n      };\n      /**\n       * onEditorRow\n       * @param params\n       */\n      class_1.prototype.onEditorRow = function (params) {\n        return {\n          editable: true\n        };\n      };\n      /**\n       * onEditorCell\n       * @param record\n       * @param editorConfig\n       */\n      class_1.prototype.onEditorCell = function (_a) {\n        var record = _a.record,\n          editorConfig = _a.editorConfig;\n        if (editorConfig) {\n          editorConfig.useTrigger = false;\n          if (this.state.isTableEditor) {\n            editorConfig.defaultStatus = 'edit';\n          }\n        }\n      };\n      /**\n       * setFieldValues\n       */\n      class_1.prototype.setFieldValues = function (dataSource) {\n        var _this = this;\n        var _a, _b, _c;\n        // const dataSource = this.getData();\n        var columns = this.getTableColumns();\n        (_c = (_b = (_a = this.formRef) === null || _a === void 0 ? void 0 : _a.current) === null || _b === void 0 ? void 0 : _b.setFieldValue) === null || _c === void 0 ? void 0 : _c.call(_b, 'dataSource', (dataSource || []).map(function (_record) {\n          var _a;\n          return (columns || []).reduce(function (_r, _a) {\n            var dataIndex = _a.dataIndex,\n              $editable = _a.$editable;\n            if (dataIndex in _record && $editable && 'type' in $editable) {\n              _r[dataIndex] = _this.valueToFormItemValue({\n                type: $editable.type,\n                record: _record,\n                dataIndex: dataIndex\n              });\n            }\n            return _r;\n          }, (_a = {}, _a[_this.getRowKey()] = _record[_this.getRowKey()], _a));\n        }));\n      };\n      /**\n       * fetchData\n       */\n      class_1.prototype.fetchData = function () {\n        var _this = this;\n        return _super.prototype.fetchData.call(this).then(function (res) {\n          _this.setFieldValues(res.data[_this.getDataKey()]);\n          _this.setState({\n            isTableEditor: false\n          });\n          return res;\n        });\n      };\n      /**\n       * render\n       * @protected\n       */\n      class_1.prototype.render = function () {\n        var _this = this;\n        return /*#__PURE__*/React.createElement(\"div\", {\n          className: \"\".concat(selectorPrefix, \"-wrap\")\n        }, /*#__PURE__*/React.createElement(_Form, {\n          // @ts-ignore\n          ref: this.formRef,\n          className: \"\".concat(selectorPrefix, \"-form\"),\n          component: false\n        }, /*#__PURE__*/React.createElement(_Form.List, {\n          name: \"dataSource\"\n        }, function (fields, operation, meta) {\n          var _a;\n          return /*#__PURE__*/React.createElement(SearchTableContext.Provider, {\n            value: {\n              // @ts-ignore\n              context: _this,\n              editable: {\n                tableEditable: {\n                  // @ts-ignore\n                  form: (_a = _this.formRef) === null || _a === void 0 ? void 0 : _a.current,\n                  formList: {\n                    fields: fields,\n                    operation: operation,\n                    meta: meta\n                  }\n                }\n              }\n            }\n          }, _this.renderChildren());\n        })));\n      };\n      return class_1;\n    }(SuperClass)\n  );\n}"],"names":["_Form","__extends","this","_extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","TypeError","String","__","constructor","create","__assign","assign","t","s","i","n","arguments","length","apply","__spreadArray","to","from","pack","ar","l","slice","concat","React","createRef","SearchTableContext","selectorPrefix","SuperClass","class_1","_super","onTableRowComponentReducers","columns","some","column","_a","$editable","editable","tableRowComponentReducers","onTableCellComponentReducers","tableCellComponentReducers","rowEditableReducer","params","rowConfig","rowIndex","record","onEditorRow","onEditorCell","editorConfig","useTrigger","state","isTableEditor","defaultStatus","setFieldValues","dataSource","_b","_c","_this","getTableColumns","formRef","current","setFieldValue","map","_record","reduce","_r","dataIndex","valueToFormItemValue","type","getRowKey","fetchData","then","res","data","getDataKey","setState","render","createElement","className","ref","component","List","name","fields","operation","meta","Provider","value","context","tableEditable","form","formList","renderChildren","props","rowConfigReducers"],"mappings":"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"}