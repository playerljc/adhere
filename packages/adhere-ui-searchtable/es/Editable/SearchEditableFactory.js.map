{"version":3,"file":"SearchEditableFactory.js","sources":["Editable/SearchEditableFactory.js"],"sourcesContent":["import { __assign, __extends, __spreadArrays } from \"tslib\";\r\nimport { Form } from 'antd';\r\nimport React, { createRef } from 'react';\r\nimport { SearchTableContext, selectorPrefix } from '../SearchTable';\r\nexport default function (SuperClass) {\r\n    return /** @class */ (function (_super) {\r\n        __extends(class_1, _super);\r\n        function class_1(props) {\r\n            var _this = _super.call(this, props) || this;\r\n            _this.formRef = createRef();\r\n            _this.state = __assign(__assign({}, _this.state), { isTableEditor: false });\r\n            _this.rowConfigReducers = __spreadArrays(_this.rowConfigReducers, [_this.rowEditableReducer]);\r\n            return _this;\r\n        }\r\n        class_1.prototype.onTableRowComponentReducers = function (columns) {\r\n            var existsEditor = columns.some(function (column) { var _a; return '$editable' in column && ((_a = column.$editable) === null || _a === void 0 ? void 0 : _a.editable); });\r\n            if (existsEditor) {\r\n                return __spreadArrays(this.tableRowComponentReducers, ['useEditableTableRow']);\r\n            }\r\n            return this.tableRowComponentReducers;\r\n        };\r\n        class_1.prototype.onTableCellComponentReducers = function (columns) {\r\n            var existsEditor = columns.some(function (column) { var _a; return '$editable' in column && ((_a = column.$editable) === null || _a === void 0 ? void 0 : _a.editable); });\r\n            if (existsEditor) {\r\n                return __spreadArrays(this.tableCellComponentReducers, ['useEditableTableCell']);\r\n            }\r\n            return this.tableCellComponentReducers;\r\n        };\r\n        /**\r\n         * rowEditableReducer\r\n         * @description 可编辑row的处理\r\n         * @param params\r\n         */\r\n        class_1.prototype.rowEditableReducer = function (params) {\r\n            var rowConfig = params.rowConfig, rowIndex = params.rowIndex, columns = params.columns, record = params.record;\r\n            if (this.onEditorRow) {\r\n                rowConfig.$editable = this.onEditorRow({\r\n                    rowIndex: rowIndex,\r\n                    record: record,\r\n                    columns: columns,\r\n                });\r\n            }\r\n            return rowConfig;\r\n        };\r\n        /**\r\n         * onEditorRow\r\n         * @param params\r\n         */\r\n        class_1.prototype.onEditorRow = function (params) {\r\n            return {\r\n                editable: true,\r\n            };\r\n        };\r\n        /**\r\n         * onEditorCell\r\n         * @param record\r\n         * @param editorConfig\r\n         */\r\n        class_1.prototype.onEditorCell = function (_a) {\r\n            var record = _a.record, editorConfig = _a.editorConfig;\r\n            if (editorConfig) {\r\n                editorConfig.useTrigger = false;\r\n                if (this.state.isTableEditor) {\r\n                    editorConfig.defaultStatus = 'edit';\r\n                }\r\n            }\r\n        };\r\n        /**\r\n         * setFieldValues\r\n         */\r\n        class_1.prototype.setFieldValues = function (dataSource) {\r\n            var _this = this;\r\n            var _a, _b, _c;\r\n            // const dataSource = this.getData();\r\n            var columns = this.getTableColumns();\r\n            (_c = (_b = (_a = this.formRef) === null || _a === void 0 ? void 0 : _a.current) === null || _b === void 0 ? void 0 : _b.setFieldValue) === null || _c === void 0 ? void 0 : _c.call(_b, 'dataSource', (dataSource || []).map(function (_record) {\r\n                var _a;\r\n                return (columns || []).reduce(function (_r, _a) {\r\n                    var dataIndex = _a.dataIndex, $editable = _a.$editable;\r\n                    if (dataIndex in _record && $editable && 'type' in $editable) {\r\n                        _r[dataIndex] = _this.valueToFormItemValue({\r\n                            type: $editable.type,\r\n                            record: _record,\r\n                            dataIndex: dataIndex,\r\n                        });\r\n                    }\r\n                    return _r;\r\n                }, (_a = {}, _a[_this.getRowKey()] = _record[_this.getRowKey()], _a));\r\n            }));\r\n        };\r\n        /**\r\n         * fetchData\r\n         */\r\n        class_1.prototype.fetchData = function () {\r\n            var _this = this;\r\n            return _super.prototype.fetchData.call(this).then(function (res) {\r\n                _this.setFieldValues(res.data[_this.getDataKey()]);\r\n                _this.setState({\r\n                    isTableEditor: false,\r\n                });\r\n                return res;\r\n            });\r\n        };\r\n        /**\r\n         * render\r\n         * @protected\r\n         */\r\n        class_1.prototype.render = function () {\r\n            var _this = this;\r\n            return (React.createElement(\"div\", { className: selectorPrefix + \"-wrap\" },\r\n                React.createElement(Form\r\n                // @ts-ignore\r\n                , { \r\n                    // @ts-ignore\r\n                    ref: this.formRef, className: selectorPrefix + \"-form\", component: false },\r\n                    React.createElement(Form.List, { name: \"dataSource\" }, function (fields, operation, meta) {\r\n                        var _a;\r\n                        return (React.createElement(SearchTableContext.Provider, { value: {\r\n                                // @ts-ignore\r\n                                context: _this,\r\n                                editable: {\r\n                                    tableEditable: {\r\n                                        // @ts-ignore\r\n                                        form: (_a = _this.formRef) === null || _a === void 0 ? void 0 : _a.current,\r\n                                        formList: {\r\n                                            fields: fields,\r\n                                            operation: operation,\r\n                                            meta: meta,\r\n                                        },\r\n                                    },\r\n                                },\r\n                            } }, _this.renderChildren()));\r\n                    }))));\r\n        };\r\n        return class_1;\r\n    }(SuperClass));\r\n}\r\n//# sourceMappingURL=SearchEditableFactory.js.map"],"names":["__assign","__extends","__spreadArrays","Form","React","createRef","SearchTableContext","selectorPrefix","SuperClass","class_1","_super","prototype","onTableRowComponentReducers","columns","some","column","_a","$editable","editable","this","tableRowComponentReducers","onTableCellComponentReducers","tableCellComponentReducers","rowEditableReducer","params","rowConfig","rowIndex","record","onEditorRow","onEditorCell","editorConfig","useTrigger","state","isTableEditor","defaultStatus","setFieldValues","dataSource","_b","_c","_this","getTableColumns","formRef","current","setFieldValue","call","map","_record","reduce","_r","dataIndex","valueToFormItemValue","type","getRowKey","fetchData","then","res","data","getDataKey","setState","render","createElement","className","ref","component","List","name","fields","operation","meta","Provider","value","context","tableEditable","form","formList","renderChildren","props","rowConfigReducers"],"mappings":"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"}