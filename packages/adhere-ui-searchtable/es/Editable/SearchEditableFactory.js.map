{"version":3,"file":"SearchEditableFactory.js","sources":["Editable/SearchEditableFactory.js"],"sourcesContent":["var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        if (typeof b !== \"function\" && b !== null)\r\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __assign = (this && this.__assign) || function () {\r\n    __assign = Object.assign || function(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n                t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\r\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\r\n        if (ar || !(i in from)) {\r\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\r\n            ar[i] = from[i];\r\n        }\r\n    }\r\n    return to.concat(ar || Array.prototype.slice.call(from));\r\n};\r\nimport { Form } from 'antd';\r\nimport React, { createRef } from 'react';\r\nimport { SearchTableContext, selectorPrefix } from '../SearchTable';\r\nexport default function (SuperClass) {\r\n    return /** @class */ (function (_super) {\r\n        __extends(class_1, _super);\r\n        function class_1(props) {\r\n            var _this = _super.call(this, props) || this;\r\n            _this.formRef = createRef();\r\n            _this.state = __assign(__assign({}, _this.state), { isTableEditor: false });\r\n            _this.rowConfigReducers = __spreadArray(__spreadArray([], _this.rowConfigReducers, true), [_this.rowEditableReducer], false);\r\n            return _this;\r\n        }\r\n        class_1.prototype.onTableRowComponentReducers = function (columns) {\r\n            var existsEditor = columns.some(function (column) { var _a; return '$editable' in column && ((_a = column.$editable) === null || _a === void 0 ? void 0 : _a.editable); });\r\n            if (existsEditor) {\r\n                return __spreadArray(__spreadArray([], this.tableRowComponentReducers, true), ['useEditableTableRow'], false);\r\n            }\r\n            return this.tableRowComponentReducers;\r\n        };\r\n        class_1.prototype.onTableCellComponentReducers = function (columns) {\r\n            var existsEditor = columns.some(function (column) { var _a; return '$editable' in column && ((_a = column.$editable) === null || _a === void 0 ? void 0 : _a.editable); });\r\n            if (existsEditor) {\r\n                return __spreadArray(__spreadArray([], this.tableCellComponentReducers, true), ['useEditableTableCell'], false);\r\n            }\r\n            return this.tableCellComponentReducers;\r\n        };\r\n        /**\r\n         * rowEditableReducer\r\n         * @description 可编辑row的处理\r\n         * @param params\r\n         */\r\n        class_1.prototype.rowEditableReducer = function (params) {\r\n            var rowConfig = params.rowConfig, rowIndex = params.rowIndex, columns = params.columns, record = params.record;\r\n            if (this.onEditorRow) {\r\n                rowConfig.$editable = this.onEditorRow({\r\n                    rowIndex: rowIndex,\r\n                    record: record,\r\n                    columns: columns,\r\n                });\r\n            }\r\n            return rowConfig;\r\n        };\r\n        /**\r\n         * onEditorRow\r\n         * @param params\r\n         */\r\n        class_1.prototype.onEditorRow = function (params) {\r\n            return {\r\n                editable: true,\r\n            };\r\n        };\r\n        /**\r\n         * onEditorCell\r\n         * @param record\r\n         * @param editorConfig\r\n         */\r\n        class_1.prototype.onEditorCell = function (_a) {\r\n            var record = _a.record, editorConfig = _a.editorConfig;\r\n            if (editorConfig) {\r\n                editorConfig.useTrigger = false;\r\n                if (this.state.isTableEditor) {\r\n                    editorConfig.defaultStatus = 'edit';\r\n                }\r\n            }\r\n        };\r\n        /**\r\n         * setFieldValues\r\n         */\r\n        class_1.prototype.setFieldValues = function (dataSource) {\r\n            var _this = this;\r\n            var _a, _b, _c;\r\n            // const dataSource = this.getData();\r\n            var columns = this.getTableColumns();\r\n            (_c = (_b = (_a = this.formRef) === null || _a === void 0 ? void 0 : _a.current) === null || _b === void 0 ? void 0 : _b.setFieldValue) === null || _c === void 0 ? void 0 : _c.call(_b, 'dataSource', (dataSource || []).map(function (_record) {\r\n                var _a;\r\n                return (columns || []).reduce(function (_r, _a) {\r\n                    var dataIndex = _a.dataIndex, $editable = _a.$editable;\r\n                    if (dataIndex in _record && $editable && 'type' in $editable) {\r\n                        _r[dataIndex] = _this.valueToFormItemValue({\r\n                            type: $editable.type,\r\n                            record: _record,\r\n                            dataIndex: dataIndex,\r\n                        });\r\n                    }\r\n                    return _r;\r\n                }, (_a = {}, _a[_this.getRowKey()] = _record[_this.getRowKey()], _a));\r\n            }));\r\n        };\r\n        /**\r\n         * fetchData\r\n         */\r\n        class_1.prototype.fetchData = function () {\r\n            var _this = this;\r\n            return _super.prototype.fetchData.call(this).then(function (res) {\r\n                _this.setFieldValues(res.data[_this.getDataKey()]);\r\n                _this.setState({\r\n                    isTableEditor: false,\r\n                });\r\n                return res;\r\n            });\r\n        };\r\n        /**\r\n         * render\r\n         * @protected\r\n         */\r\n        class_1.prototype.render = function () {\r\n            var _this = this;\r\n            return (React.createElement(\"div\", { className: \"\".concat(selectorPrefix, \"-wrap\") },\r\n                React.createElement(Form\r\n                // @ts-ignore\r\n                , { \r\n                    // @ts-ignore\r\n                    ref: this.formRef, className: \"\".concat(selectorPrefix, \"-form\"), component: false },\r\n                    React.createElement(Form.List, { name: \"dataSource\" }, function (fields, operation, meta) {\r\n                        var _a;\r\n                        return (React.createElement(SearchTableContext.Provider, { value: {\r\n                                // @ts-ignore\r\n                                context: _this,\r\n                                editable: {\r\n                                    tableEditable: {\r\n                                        // @ts-ignore\r\n                                        form: (_a = _this.formRef) === null || _a === void 0 ? void 0 : _a.current,\r\n                                        formList: {\r\n                                            fields: fields,\r\n                                            operation: operation,\r\n                                            meta: meta,\r\n                                        },\r\n                                    },\r\n                                },\r\n                            } }, _this.renderChildren()));\r\n                    }))));\r\n        };\r\n        return class_1;\r\n    }(SuperClass));\r\n}\r\n"],"names":["__extends","this","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","TypeError","String","__","constructor","create","__assign","assign","t","s","i","n","arguments","length","apply","__spreadArray","to","from","pack","ar","l","slice","concat","Form","React","createRef","SearchTableContext","selectorPrefix","SuperClass","class_1","_super","onTableRowComponentReducers","columns","some","column","_a","$editable","editable","tableRowComponentReducers","onTableCellComponentReducers","tableCellComponentReducers","rowEditableReducer","params","rowConfig","rowIndex","record","onEditorRow","onEditorCell","editorConfig","useTrigger","state","isTableEditor","defaultStatus","setFieldValues","dataSource","_b","_c","_this","getTableColumns","formRef","current","setFieldValue","map","_record","reduce","_r","dataIndex","valueToFormItemValue","type","getRowKey","fetchData","then","res","data","getDataKey","setState","render","createElement","className","ref","component","List","name","fields","operation","meta","Provider","value","context","tableEditable","form","formList","renderChildren","props","rowConfigReducers"],"mappings":"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"}