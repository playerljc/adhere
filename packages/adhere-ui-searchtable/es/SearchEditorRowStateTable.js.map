{"version":3,"file":"SearchEditorRowStateTable.js","sources":["SearchEditorRowStateTable.js"],"sourcesContent":["import \"core-js/modules/es.array.iterator.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\nimport \"core-js/modules/es.promise.js\";\nimport \"core-js/modules/es.object.keys.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport \"core-js/modules/es.array.find.js\";\nimport { __assign, __extends, __spreadArray } from \"tslib\";\nimport cloneDeep from 'lodash.clonedeep';\nimport moment from 'moment';\nimport SearchEditorCellStateTable from './SearchEditorCellStateTable';\n/**\n * SearchEditorRowTable\n * @class\n * @classdesc 行可编辑的表格\n */\n\nvar SearchEditorRowStateTable =\n/** @class */\nfunction (_super) {\n  __extends(SearchEditorRowStateTable, _super);\n\n  function SearchEditorRowStateTable(props) {\n    var _this = _super.call(this, props) || this;\n\n    _this.state = __assign(__assign({}, _this.state), {\n      editorRowId: ''\n    });\n    _this.rowConfigReducers = __spreadArray(__spreadArray([], _this.rowConfigReducers, true), [_this.rowEditableReducer], false);\n    return _this;\n  }\n  /**\n   * updateEditorCellRowData\n   * @description 更新可编辑单元格一行的数据\n   * @param values 一行的数据\n   * @param record\n   * @return Promise<void>\n   */\n\n\n  SearchEditorRowStateTable.prototype.updateEditorCellRowData = function (_a) {\n    var _this = this;\n\n    var values = _a.values,\n        record = _a.record;\n    return new Promise(function (resolve) {\n      var _a;\n\n      var listData = cloneDeep(_this.state[_this.getServiceName()]);\n      var dataSource = listData[_this.getFetchListPropName()][_this.getDataKey()] || [];\n\n      var rowKey = _this.getRowKey();\n\n      var keys = Object.keys(values);\n      keys.forEach(function (dataIndex) {\n        var value = values[dataIndex];\n\n        if (value instanceof moment) {\n          value = value.valueOf();\n        }\n\n        var recordItem = dataSource.find(function (t) {\n          return t[rowKey] === record[rowKey];\n        });\n\n        if (recordItem) {\n          recordItem[dataIndex] = value;\n        }\n      });\n\n      _this.setState((_a = {}, _a[_this.getServiceName()] = listData, _a), function () {\n        return resolve();\n      });\n    });\n  };\n  /**\n   * rowEditableReducer\n   * @description 可编辑row的处理\n   * @param params\n   */\n\n\n  SearchEditorRowStateTable.prototype.rowEditableReducer = function (params) {\n    var rowConfig = params.rowConfig,\n        rowIndex = params.rowIndex,\n        columns = params.columns,\n        record = params.record;\n\n    if (this.onEditorRow) {\n      rowConfig.$editable = this.onEditorRow({\n        rowIndex: rowIndex,\n        record: record,\n        columns: columns\n      });\n    }\n\n    return rowConfig;\n  };\n  /**\n   * onEditorRow\n   * @param params\n   */\n\n\n  SearchEditorRowStateTable.prototype.onEditorRow = function (params) {\n    return {\n      editable: true\n    };\n  };\n  /**\n   * onEditorCell\n   * @param record\n   * @param editorConfig\n   */\n\n\n  SearchEditorRowStateTable.prototype.onEditorCell = function (_a) {\n    var record = _a.record,\n        editorConfig = _a.editorConfig;\n\n    if (editorConfig) {\n      editorConfig.useTrigger = false;\n\n      if (record[this.getRowKey()] === this.state.editorRowId) {\n        editorConfig.defaultStatus = 'edit';\n      }\n    }\n  };\n  /**\n   * fetchData\n   */\n\n\n  SearchEditorRowStateTable.prototype.fetchData = function () {\n    var _this = this;\n\n    return _super.prototype.fetchData.call(this).then(function (res) {\n      _this.setState({\n        editorRowId: ''\n      });\n\n      return res;\n    });\n  };\n\n  return SearchEditorRowStateTable;\n}(SearchEditorCellStateTable);\n\nexport default SearchEditorRowStateTable;"],"names":["__assign","__extends","__spreadArray","cloneDeep","moment","SearchEditorCellStateTable","SearchEditorRowStateTable","_super","props","_this","call","this","state","editorRowId","rowConfigReducers","rowEditableReducer","prototype","updateEditorCellRowData","_a","values","record","Promise","resolve","listData","getServiceName","dataSource","getFetchListPropName","getDataKey","rowKey","getRowKey","Object","keys","forEach","dataIndex","value","recordItem","valueOf","find","t","setState","params","rowConfig","rowIndex","columns","onEditorRow","$editable","editable","onEditorCell","editorConfig","useTrigger","defaultStatus","fetchData","then","res"],"mappings":"MAAO,6CACA,+CACA,wDACA,sCACA,0CACA,wDACA,0CACEA,SAAUC,UAAWC,aAA4B,KAAP,eAC5CC,cAAe,0BACfC,WAAY,gBACZC,+BAAgC,+BAOvC,IAAIC,0BAEJ,SAAUC,GAGR,SAASD,EAA0BE,GAC7BC,EAAQF,EAAOG,KAAKC,KAAMH,CAAK,GAAKG,KAMxC,OAJAF,EAAMG,MAAQZ,SAASA,SAAS,GAAIS,EAAMG,KAAK,EAAG,CAChDC,YAAa,EACf,CAAC,EACDJ,EAAMK,kBAAoBZ,cAAcA,cAAc,GAAIO,EAAMK,kBAAmB,CAAA,CAAI,EAAG,CAACL,EAAMM,oBAAqB,CAAA,CAAK,EACpHN,CACT,CAmHA,OA7HAR,UAAUK,EAA2BC,CAAM,EAoB3CD,EAA0BU,UAAUC,wBAA0B,SAAUC,GACtE,IAAIT,EAAQE,KAERQ,EAASD,EAAGC,OACZC,EAASF,EAAGE,OAChB,OAAO,IAAIC,QAAQ,SAAUC,GAC3B,IAAIJ,EAEAK,EAAWpB,UAAUM,EAAMG,MAAMH,EAAMe,eAAe,EAAE,EACxDC,EAAaF,EAASd,EAAMiB,qBAAqB,GAAGjB,EAAMkB,WAAW,IAAM,GAE3EC,EAASnB,EAAMoB,UAAU,EAElBC,OAAOC,KAAKZ,CAAM,EACxBa,QAAQ,SAAUC,GACrB,IAAIC,EAAQf,EAAOc,GAMfE,GAJAD,aAAiB9B,SACnB8B,EAAQA,EAAME,QAAQ,GAGPX,EAAWY,KAAK,SAAUC,GACzC,OAAOA,EAAEV,KAAYR,EAAOQ,EAC9B,CAAC,GAEGO,IACFA,EAAWF,GAAaC,EAE5B,CAAC,EAEDzB,EAAM8B,WAAUrB,EAAK,IAAOT,EAAMe,eAAe,GAAKD,EAAUL,GAAK,WACnE,OAAOI,EAAQ,CACjB,CAAC,CACH,CAAC,CACH,EAQAhB,EAA0BU,UAAUD,mBAAqB,SAAUyB,GACjE,IAAIC,EAAYD,EAAOC,UACnBC,EAAWF,EAAOE,SAClBC,EAAUH,EAAOG,QACjBvB,EAASoB,EAAOpB,OAUpB,OARIT,KAAKiC,cACPH,EAAUI,UAAYlC,KAAKiC,YAAY,CACrCF,SAAUA,EACVtB,OAAQA,EACRuB,QAASA,CACX,CAAC,GAGIF,CACT,EAOAnC,EAA0BU,UAAU4B,YAAc,SAAUJ,GAC1D,MAAO,CACLM,SAAU,CAAA,CACZ,CACF,EAQAxC,EAA0BU,UAAU+B,aAAe,SAAU7B,GAC3D,IAAIE,EAASF,EAAGE,OACZ4B,EAAe9B,EAAG8B,aAElBA,IACFA,EAAaC,WAAa,CAAA,EAEtB7B,EAAOT,KAAKkB,UAAU,KAAOlB,KAAKC,MAAMC,cAC1CmC,EAAaE,cAAgB,QAGnC,EAMA5C,EAA0BU,UAAUmC,UAAY,WAC9C,IAAI1C,EAAQE,KAEZ,OAAOJ,EAAOS,UAAUmC,UAAUzC,KAAKC,IAAI,EAAEyC,KAAK,SAAUC,GAK1D,OAJA5C,EAAM8B,SAAS,CACb1B,YAAa,EACf,CAAC,EAEMwC,CACT,CAAC,CACH,EAEO/C,CACT,EAAED,0BAA0B,iBAEbC"}