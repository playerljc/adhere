{"version":3,"file":"SearchEditorCellStateTable.js","sources":["SearchEditorCellStateTable.js"],"sourcesContent":["import \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.promise.js\";\nimport \"core-js/modules/es.array.find.js\";\nimport { __assign, __extends, __spreadArray } from \"tslib\";\nimport cloneDeep from 'lodash.clonedeep';\nimport EditableCell from './Extension/EditableCell/EditableCell';\nimport EditableRow from './Extension/EditableCell/EditableRow';\nimport { SearchTableStateImplement } from './SearchTableStateImplement';\n/**\n * SearchEditorCellStateTable\n * @class\n * @classdesc 可编辑单元格的表格\n */\n\nvar SearchEditorCellStateTable =\n/** @class */\nfunction (_super) {\n  __extends(SearchEditorCellStateTable, _super);\n\n  function SearchEditorCellStateTable(props) {\n    var _this = _super.call(this, props) || this;\n\n    _this.cellReducers = __spreadArray(__spreadArray([], _this.cellReducers, true), [_this.cellEditableReducer], false);\n    return _this;\n  }\n  /**\n   * onComponents\n   * @param columns\n   * @param components\n   */\n\n\n  SearchEditorCellStateTable.prototype.onComponents = function (columns, components) {\n    var existsEditor = columns.some(function (column) {\n      var _a;\n\n      return '$editable' in column && ((_a = column.$editable) === null || _a === void 0 ? void 0 : _a.editable);\n    });\n\n    if (existsEditor) {\n      components.body = {\n        row: EditableRow,\n        cell: EditableCell\n      };\n    }\n\n    return components;\n  };\n  /**\n   * cellEditableReducer\n   * @description 可编辑单元格的onCell处理\n   * @param params\n   */\n\n\n  SearchEditorCellStateTable.prototype.cellEditableReducer = function (params) {\n    var _a;\n\n    var rowIndex = params.rowIndex,\n        column = params.column,\n        record = params.record; // 如果设置了$editable则调用onEditorCell方法对每个cell进行props注入\n\n    if ('$editable' in column && ((_a = column.$editable) === null || _a === void 0 ? void 0 : _a.editable) && this.onEditorCell) {\n      this.onEditorCell({\n        rowIndex: rowIndex,\n        editorConfig: column.$editable,\n        record: __assign({}, record)\n      });\n      return column;\n    }\n\n    return column;\n  };\n  /**\n   * updateEditorCellDate\n   * @description 更新可编辑单元格的数据\n   * @param record 行数据\n   * @param dataIndex 列索引\n   * @param value 更新的值\n   * @return Promise<void>\n   */\n\n\n  SearchEditorCellStateTable.prototype.updateEditorCellDate = function (_a) {\n    var _this = this;\n\n    var record = _a.record,\n        dataIndex = _a.dataIndex,\n        value = _a.value;\n    return new Promise(function (resolve) {\n      var _a;\n\n      var listData = cloneDeep(_this.state[_this.getServiceName()]);\n      var dataSource = listData[_this.getFetchListPropName()][_this.getDataKey()] || [];\n\n      var rowKey = _this.getRowKey();\n\n      var recordItem = dataSource.find(function (t) {\n        return t[rowKey] === record[rowKey];\n      });\n\n      if (recordItem) {\n        recordItem[dataIndex] = value;\n\n        _this.setState((_a = {}, _a[_this.getServiceName()] = listData, _a), function () {\n          return resolve();\n        });\n      } else resolve();\n    });\n  };\n  /**\n   * updateEditorCellDateData\n   * @description 更新日期类型可编辑单元格的数据\n   * @param record\n   * @param dataIndex\n   * @param value\n   * @return Promise<void>\n   */\n\n\n  SearchEditorCellStateTable.prototype.updateEditorCellDateData = function (_a) {\n    var _this = this;\n\n    var record = _a.record,\n        dataIndex = _a.dataIndex,\n        value = _a.value;\n    return new Promise(function (resolve) {\n      var _a;\n\n      var listData = cloneDeep(_this.state[_this.getServiceName()]);\n      var dataSource = listData[_this.getFetchListPropName()][_this.getDataKey()] || [];\n\n      var rowKey = _this.getRowKey();\n\n      var recordItem = dataSource.find(function (t) {\n        return t[rowKey] === record[rowKey];\n      });\n\n      if (recordItem) {\n        recordItem[dataIndex] = value === null || value === void 0 ? void 0 : value.valueOf();\n\n        _this.setState((_a = {}, _a[_this.getServiceName()] = listData, _a), function () {\n          return resolve();\n        });\n      } else resolve();\n    });\n  };\n\n  return SearchEditorCellStateTable;\n}(SearchTableStateImplement);\n\nexport default SearchEditorCellStateTable;"],"names":["__assign","__extends","__spreadArray","cloneDeep","EditableCell","EditableRow","SearchTableStateImplement","SearchEditorCellStateTable","_super","props","_this","call","this","cellReducers","cellEditableReducer","prototype","onComponents","columns","components","some","column","_a","$editable","editable","body","row","cell","params","rowIndex","record","onEditorCell","editorConfig","updateEditorCellDate","dataIndex","value","Promise","resolve","listData","state","getServiceName","dataSource","getFetchListPropName","getDataKey","rowKey","getRowKey","recordItem","find","t","setState","updateEditorCellDateData","valueOf"],"mappings":"MAAO,+CACA,sCACA,0CACEA,SAAUC,UAAWC,aAA4B,KAAP,eAC5CC,cAAe,0BACfC,iBAAkB,+CAClBC,gBAAiB,8CACfC,yBAA8D,KAA7B,8BAO1C,IAAIC,2BAEJ,SAAUC,GAGR,SAASD,EAA2BE,GAC9BC,EAAQF,EAAOG,KAAKC,KAAMH,CAAK,GAAKG,KAGxC,OADAF,EAAMG,aAAeX,cAAcA,cAAc,GAAIQ,EAAMG,aAAc,CAAA,CAAI,EAAG,CAACH,EAAMI,qBAAsB,CAAA,CAAK,EAC3GJ,CACT,CA4HA,OAnIAT,UAAUM,EAA4BC,CAAM,EAe5CD,EAA2BQ,UAAUC,aAAe,SAAUC,EAASC,GAcrE,OAbmBD,EAAQE,KAAK,SAAUC,GAGxC,MAAO,cAAeA,IAAW,OAACC,EAAKD,EAAOE,WAAuC,KAAA,EAASD,EAAGE,SACnG,CAAC,IAGCL,EAAWM,KAAO,CAChBC,IAAKpB,YACLqB,KAAMtB,YACR,GAGKc,CACT,EAQAX,EAA2BQ,UAAUD,oBAAsB,SAAUa,GACnE,IAAIN,EAEAO,EAAWD,EAAOC,SAClBR,EAASO,EAAOP,OAChBS,EAASF,EAAOE,OAWpB,MATI,cAAeT,GAAW,OAACC,EAAKD,EAAOE,YAAgDD,EAAGE,UAAaX,KAAKkB,cAC9GlB,KAAKkB,aAAa,CAChBF,SAAUA,EACVG,aAAcX,EAAOE,UACrBO,OAAQ7B,SAAS,GAAI6B,CAAM,CAC7B,CAAC,EAIIT,CACT,EAWAb,EAA2BQ,UAAUiB,qBAAuB,SAAUX,GACpE,IAAIX,EAAQE,KAERiB,EAASR,EAAGQ,OACZI,EAAYZ,EAAGY,UACfC,EAAQb,EAAGa,MACf,OAAO,IAAIC,QAAQ,SAAUC,GAC3B,IAEIC,EAAWlC,UAAUO,EAAM4B,MAAM5B,EAAM6B,eAAe,EAAE,EACxDC,EAAaH,EAAS3B,EAAM+B,qBAAqB,GAAG/B,EAAMgC,WAAW,IAAM,GAE3EC,EAASjC,EAAMkC,UAAU,EAEzBC,EAAaL,EAAWM,KAAK,SAAUC,GACzC,OAAOA,EAAEJ,KAAYd,EAAOc,EAC9B,CAAC,EAEGE,GACFA,EAAWZ,GAAaC,EAExBxB,EAAMsC,WAAU3B,EAAK,IAAOX,EAAM6B,eAAe,GAAKF,EAAUhB,GAAK,WACnE,OAAOe,EAAQ,CACjB,CAAC,GACIA,EAAQ,CACjB,CAAC,CACH,EAWA7B,EAA2BQ,UAAUkC,yBAA2B,SAAU5B,GACxE,IAAIX,EAAQE,KAERiB,EAASR,EAAGQ,OACZI,EAAYZ,EAAGY,UACfC,EAAQb,EAAGa,MACf,OAAO,IAAIC,QAAQ,SAAUC,GAC3B,IAEIC,EAAWlC,UAAUO,EAAM4B,MAAM5B,EAAM6B,eAAe,EAAE,EACxDC,EAAaH,EAAS3B,EAAM+B,qBAAqB,GAAG/B,EAAMgC,WAAW,IAAM,GAE3EC,EAASjC,EAAMkC,UAAU,EAEzBC,EAAaL,EAAWM,KAAK,SAAUC,GACzC,OAAOA,EAAEJ,KAAYd,EAAOc,EAC9B,CAAC,EAEGE,GACFA,EAAWZ,GAAaC,MAAAA,EAAqC,KAAA,EAASA,EAAMgB,QAAQ,EAEpFxC,EAAMsC,WAAU3B,EAAK,IAAOX,EAAM6B,eAAe,GAAKF,EAAUhB,GAAK,WACnE,OAAOe,EAAQ,CACjB,CAAC,GACIA,EAAQ,CACjB,CAAC,CACH,EAEO7B,CACT,EAAED,yBAAyB,iBAEZC"}