{"version":3,"file":"SearchEditorCellTable.js","sources":["SearchEditorCellTable.js"],"sourcesContent":["import \"core-js/modules/es.array.iterator.js\";\nimport \"core-js/modules/es.map.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.string.iterator.js\";\nimport \"core-js/modules/esnext.map.delete-all.js\";\nimport \"core-js/modules/esnext.map.every.js\";\nimport \"core-js/modules/esnext.map.filter.js\";\nimport \"core-js/modules/esnext.map.find.js\";\nimport \"core-js/modules/esnext.map.find-key.js\";\nimport \"core-js/modules/esnext.map.includes.js\";\nimport \"core-js/modules/esnext.map.key-of.js\";\nimport \"core-js/modules/esnext.map.map-keys.js\";\nimport \"core-js/modules/esnext.map.map-values.js\";\nimport \"core-js/modules/esnext.map.merge.js\";\nimport \"core-js/modules/esnext.map.reduce.js\";\nimport \"core-js/modules/esnext.map.some.js\";\nimport \"core-js/modules/esnext.map.update.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\nimport \"core-js/modules/es.promise.js\";\nimport \"core-js/modules/es.array.find.js\";\nimport { __assign, __extends, __spreadArray } from \"tslib\";\nimport cloneDeep from 'lodash.clonedeep';\nimport moment from 'moment';\nimport { SearchTableImplement } from './SearchTableImplement';\n/**\n * SearchEditorCellTable\n * @class\n * @classdesc 可编辑单元格的表格\n */\n\nvar SearchEditorCellTable =\n/** @class */\nfunction (_super) {\n  __extends(SearchEditorCellTable, _super);\n\n  function SearchEditorCellTable(props) {\n    var _this = _super.call(this, props) || this;\n    /**\n     * valueToFormItemValueMap\n     * @description 值和表单控件值之间的转换，现在只涉及到时间控件\n     */\n\n\n    _this.valueToFormItemValueMap = new Map([['rangePicker', function (_a) {\n      var record = _a.record,\n          dataIndex = _a.dataIndex;\n      var value = record === null || record === void 0 ? void 0 : record[dataIndex];\n      return Array.isArray(value) && value.length === 2 ? [moment(value[0]), moment(value[1])] : [moment(), moment()];\n    }], ['datePicker', function (_a) {\n      var record = _a.record,\n          dataIndex = _a.dataIndex;\n      var value = record === null || record === void 0 ? void 0 : record[dataIndex];\n      return moment(value);\n    }], ['timePicker', function (_a) {\n      var record = _a.record,\n          dataIndex = _a.dataIndex;\n      var value = record === null || record === void 0 ? void 0 : record[dataIndex];\n      return moment(value);\n    }]]);\n    _this.cellConfigReducers = __spreadArray(__spreadArray([], _this.cellConfigReducers, true), [_this.cellEditableReducer], false);\n    return _this;\n  }\n\n  SearchEditorCellTable.prototype.onTableRowComponentReducers = function (columns) {\n    var existsEditor = columns.some(function (column) {\n      var _a;\n\n      return '$editable' in column && ((_a = column.$editable) === null || _a === void 0 ? void 0 : _a.editable);\n    });\n\n    if (existsEditor) {\n      return __spreadArray(__spreadArray([], this.tableRowComponentReducers, true), ['useEditableRow'], false);\n    }\n\n    return this.tableRowComponentReducers;\n  };\n\n  SearchEditorCellTable.prototype.onTableCellComponentReducers = function (columns) {\n    var existsEditor = columns.some(function (column) {\n      var _a;\n\n      return '$editable' in column && ((_a = column.$editable) === null || _a === void 0 ? void 0 : _a.editable);\n    });\n\n    if (existsEditor) {\n      return __spreadArray(__spreadArray([], this.tableCellComponentReducers, true), ['useEditableCell'], false);\n    }\n\n    return this.tableCellComponentReducers;\n  };\n  /**\n   * valueToFormItemValue\n   * @description 值和表单值的转换\n   */\n\n\n  SearchEditorCellTable.prototype.valueToFormItemValue = function (_a) {\n    var type = _a.type,\n        record = _a.record,\n        dataIndex = _a.dataIndex;\n    var item = this.valueToFormItemValueMap.get(type);\n    return item ? item === null || item === void 0 ? void 0 : item({\n      record: record,\n      dataIndex: dataIndex\n    }) : record === null || record === void 0 ? void 0 : record[dataIndex];\n  };\n\n  SearchEditorCellTable.prototype.onEditorRow = function (params) {\n    return {\n      editable: false\n    };\n  };\n\n  SearchEditorCellTable.prototype.onEditorCell = function (params) {};\n  /**\n   * cellEditableReducer\n   * @description 可编辑单元格的onCell处理\n   * @param params\n   */\n\n\n  SearchEditorCellTable.prototype.cellEditableReducer = function (params) {\n    var _a;\n\n    var rowIndex = params.rowIndex,\n        column = params.column,\n        record = params.record; // 如果设置了$editable则调用onEditorCell方法对每个cell进行props注入\n\n    if ('$editable' in column && ((_a = column.$editable) === null || _a === void 0 ? void 0 : _a.editable) && this.onEditorCell) {\n      this.onEditorCell({\n        rowIndex: rowIndex,\n        editorConfig: column.$editable,\n        record: __assign({}, record)\n      });\n      return column;\n    }\n\n    return column;\n  };\n  /**\n   * updateEditorCellDate\n   * @description 更新可编辑单元格的数据\n   * @param record 行数据\n   * @param dataIndex 列索引\n   * @param value 更新的值\n   * @return Promise<void>\n   */\n\n\n  SearchEditorCellTable.prototype.updateEditorCellDate = function (_a) {\n    var _this = this;\n\n    var record = _a.record,\n        dataIndex = _a.dataIndex,\n        value = _a.value;\n    return new Promise(function (resolve) {\n      var _a;\n\n      if (record[dataIndex] === value) {\n        resolve();\n        return;\n      }\n\n      var listData = cloneDeep(_this.props[_this.getServiceName()]);\n      var dataSource = listData[_this.getFetchListPropName()][_this.getDataKey()] || [];\n\n      var rowKey = _this.getRowKey();\n\n      var recordItem = dataSource.find(function (t) {\n        return t[rowKey] === record[rowKey];\n      });\n\n      if (recordItem) {\n        recordItem[dataIndex] = value;\n\n        _this.props.dispatch((_a = {\n          type: \"\".concat(_this.getServiceName(), \"/receive\")\n        }, _a[_this.getServiceName()] = listData, _a)).then(function () {\n          return resolve();\n        });\n      } else resolve();\n    });\n  };\n  /**\n   * updateEditorCellDateData\n   * @description 更新日期类型可编辑单元格的数据\n   * @param record\n   * @param dataIndex\n   * @param value\n   * @return Promise<void>\n   */\n\n\n  SearchEditorCellTable.prototype.updateEditorCellDateData = function (_a) {\n    var _this = this;\n\n    var record = _a.record,\n        dataIndex = _a.dataIndex,\n        value = _a.value;\n    return new Promise(function (resolve) {\n      var _a;\n\n      if (record[dataIndex] === (value === null || value === void 0 ? void 0 : value.valueOf())) {\n        resolve();\n        return;\n      }\n\n      var listData = cloneDeep(_this.props[_this.getServiceName()]);\n      var dataSource = listData[_this.getFetchListPropName()][_this.getDataKey()] || [];\n\n      var rowKey = _this.getRowKey();\n\n      var recordItem = dataSource.find(function (t) {\n        return t[rowKey] === record[rowKey];\n      });\n\n      if (recordItem) {\n        recordItem[dataIndex] = value === null || value === void 0 ? void 0 : value.valueOf();\n\n        _this.props.dispatch((_a = {\n          type: \"\".concat(_this.getServiceName(), \"/receive\")\n        }, _a[_this.getServiceName()] = listData, _a)).then(function () {\n          return resolve();\n        });\n      } else resolve();\n    });\n  };\n\n  return SearchEditorCellTable;\n}(SearchTableImplement);\n\nexport default SearchEditorCellTable;"],"names":["__assign","__extends","__spreadArray","cloneDeep","moment","SearchTableImplement","SearchEditorCellTable","_super","props","_this","call","this","valueToFormItemValueMap","Map","_a","record","dataIndex","value","Array","isArray","length","cellConfigReducers","cellEditableReducer","prototype","onTableRowComponentReducers","columns","some","column","$editable","editable","tableRowComponentReducers","onTableCellComponentReducers","tableCellComponentReducers","valueToFormItemValue","type","item","get","onEditorRow","params","onEditorCell","rowIndex","editorConfig","updateEditorCellDate","Promise","resolve","listData","rowKey","recordItem","dataSource","getServiceName","getFetchListPropName","getDataKey","getRowKey","find","t","dispatch","concat","then","updateEditorCellDateData","valueOf"],"mappings":"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"}