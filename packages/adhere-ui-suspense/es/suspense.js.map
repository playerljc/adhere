{"version":3,"file":"Suspense.js","sources":["Suspense.js"],"sourcesContent":["import _Skeleton from \"antd/es/skeleton\";\nvar __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n    return _extendStatics(d, b);\n  };\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    _extendStatics(d, b);\n    function __() {\n      this.constructor = d;\n    }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\nimport classNames from 'classnames';\nimport PropTypes from 'prop-types';\nimport React from 'react';\nimport Spin from '@baifendian/adhere-ui-spin';\nimport SuspenseAsync from './Async';\nimport SuspenseSync from './Sync';\nvar selectorPrefix = 'adhere-ui-suspense';\n/**\n * Suspense\n * @class Suspense\n * @classdesc Suspense\n *\n * 需要重写的方法\n * fetchData\n * renderInner\n * showLoading\n */\nvar Suspense = /** @class */function (_super) {\n  __extends(Suspense, _super);\n  function Suspense(props) {\n    var _this = _super.call(this, props) || this;\n    // 第一次\n    _this.isFirst = true;\n    // 第一次加载\n    _this.isFirstLoading = false;\n    return _this;\n  }\n  Suspense.prototype.componentWillReceiveProps = function (nextProps) {\n    if (nextProps.reset) {\n      // console.log('suspense componentWillReceiveProps', nextProps.reset);\n      // 第一次\n      this.isFirst = true;\n      // 第一次加载\n      this.isFirstLoading = false;\n      this.forceUpdate();\n    }\n  };\n  Suspense.prototype.componentDidMount = function () {\n    var _a;\n    // console.log('suspense mount');\n    (_a = this === null || this === void 0 ? void 0 : this.fetchData) === null || _a === void 0 ? void 0 : _a.call(this);\n  };\n  /**\n   * renderNormalFirstLoading\n   * @return React.ReactElement\n   */\n  Suspense.renderNormalFirstLoading = function () {\n    var result = [];\n    for (var i = 0; i < 7; i++) {\n      result.push( /*#__PURE__*/React.createElement(_Skeleton, {\n        key: i + 1,\n        loading: true,\n        active: true,\n        avatar: true\n      }));\n    }\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"\".concat(selectorPrefix, \"-loading\")\n    }, result);\n  };\n  /**\n   * renderFirstLoading - 渲染第一次Loading的UI\n   * @return {React.Element}\n   */\n  Suspense.prototype.renderFirstLoading = function () {\n    var firstLoading = this.props.firstLoading;\n    if (firstLoading !== undefined && firstLoading !== null) {\n      // console.log('renderFirstLoading');\n      return firstLoading;\n    }\n    return Suspense.renderNormalFirstLoading();\n  };\n  /**\n   * renderNormal - 渲染正常的UI\n   * @return {React.Element}\n   */\n  Suspense.prototype.renderNormal = function () {\n    var _a, _b;\n    var children = this.renderInner();\n    // 如果自定义了normalLoading则使用renderNormalLoading\n    if (this.props.renderNormalLoading) {\n      return (_b = (_a = this.props).renderNormalLoading) === null || _b === void 0 ? void 0 : _b.call(_a, {\n        children: children,\n        loading: this.showLoading()\n      });\n    }\n    // 缺省的normalLoading\n    return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Spin, {\n      size: \"large\",\n      spinning: this.showLoading()\n    }), children);\n  };\n  /**\n   * renderDispatch\n   * @return {React.Element|*}\n   */\n  Suspense.prototype.renderDispatch = function () {\n    var loading = this.showLoading();\n    if (this.isFirst && !this.isFirstLoading && loading) {\n      this.isFirstLoading = true;\n    }\n    if (this.isFirst && this.isFirstLoading && !loading) {\n      this.isFirst = false;\n      this.isFirstLoading = false;\n    }\n    // console.log('suspense loading', loading);\n    // console.log('suspense isFirst', this.isFirst);\n    // console.log('suspense isFirstLoading', this.isFirstLoading);\n    if (this.isFirst) {\n      return this.renderFirstLoading();\n    }\n    return this.renderNormal();\n  };\n  Suspense.prototype.render = function () {\n    var _a, _b;\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: classNames(selectorPrefix, (_a = this.props.className) !== null && _a !== void 0 ? _a : ''),\n      style: (_b = this.props.style) !== null && _b !== void 0 ? _b : {}\n    }, this.renderDispatch());\n  };\n  Suspense.Sync = SuspenseSync;\n  Suspense.ASync = SuspenseAsync;\n  return Suspense;\n}(React.PureComponent);\nSuspense.defaultProps = {\n  className: '',\n  style: {},\n  reset: false,\n  firstLoading: null\n};\nSuspense.propTypes = {\n  className: PropTypes.string,\n  style: PropTypes.object,\n  reset: PropTypes.bool,\n  firstLoading: PropTypes.node,\n  renderNormalLoading: PropTypes.func\n};\nexport default Suspense;"],"names":["_Skeleton","__extends","this","_extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","TypeError","String","__","constructor","create","classNames","PropTypes","React","Spin","SuspenseAsync","SuspenseSync","selectorPrefix","Suspense","_super","props","_this","isFirst","isFirstLoading","componentWillReceiveProps","nextProps","reset","forceUpdate","componentDidMount","_a","fetchData","renderNormalFirstLoading","result","i","push","createElement","key","loading","active","avatar","className","concat","renderFirstLoading","firstLoading","renderNormal","_b","children","renderInner","renderNormalLoading","showLoading","Fragment","size","spinning","renderDispatch","render","style","Sync","ASync","PureComponent","defaultProps","propTypes","string","object","bool","node","func"],"mappings":"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"}