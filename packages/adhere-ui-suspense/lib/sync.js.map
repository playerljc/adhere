{"version":3,"file":"sync.js","sources":["sync.js"],"sourcesContent":["\"use strict\";\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        if (typeof b !== \"function\" && b !== null)\r\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar antd_1 = require(\"antd\");\r\nvar prop_types_1 = __importDefault(require(\"prop-types\"));\r\nvar react_1 = __importDefault(require(\"react\"));\r\nvar adhere_ui_conditionalrender_1 = __importDefault(require(\"@baifendian/adhere-ui-conditionalrender\"));\r\nvar adhere_util_1 = __importDefault(require(\"@baifendian/adhere-util\"));\r\nvar suspense_1 = __importDefault(require(\"./suspense\"));\r\n/**\r\n * SuspenseSync\r\n * @class\r\n * @classdesc 传数据\r\n */\r\nvar SuspenseSync = /** @class */ (function (_super) {\r\n    __extends(SuspenseSync, _super);\r\n    function SuspenseSync() {\r\n        var _this = _super !== null && _super.apply(this, arguments) || this;\r\n        _this.state = {\r\n            loading: true,\r\n        };\r\n        _this.isLoading = true;\r\n        return _this;\r\n    }\r\n    SuspenseSync.prototype.componentWillReceiveProps = function (nextProps) {\r\n        var _this = this;\r\n        var data = this.props.data;\r\n        if (this.isLoading && this.isDataDirty(data, nextProps.data)) {\r\n            this.setState({\r\n                loading: false,\r\n            }, function () {\r\n                _this.isLoading = false;\r\n            });\r\n        }\r\n    };\r\n    SuspenseSync.prototype.isDataDirty = function (data, nextData) {\r\n        if (typeof data !== typeof nextData)\r\n            return true;\r\n        if (adhere_util_1.default.isObject(data) && adhere_util_1.default.isObject(nextData)) {\r\n            return !Object.is(data, nextData);\r\n        }\r\n        if (adhere_util_1.default.isArray(data) && adhere_util_1.default.isArray(nextData)) {\r\n            if (data.length !== nextData.length)\r\n                return true;\r\n            return data.some(function (t1, index) { return !Object.is(t1, nextData[index]); });\r\n        }\r\n        return false;\r\n    };\r\n    SuspenseSync.prototype.reset = function () {\r\n        var _this = this;\r\n        return new Promise(function (resolve) {\r\n            // 第一次\r\n            _this.isFirst = true;\r\n            // 第一次加载\r\n            _this.isFirstLoading = false;\r\n            _this.isLoading = true;\r\n            _this.setState({\r\n                loading: true,\r\n            }, function () { return resolve(); });\r\n        });\r\n    };\r\n    SuspenseSync.prototype.showLoading = function () {\r\n        return this.state.loading;\r\n    };\r\n    SuspenseSync.prototype.renderInner = function () {\r\n        var _a = this.props, isEmpty = _a.isEmpty, renderEmpty = _a.renderEmpty, children = _a.children;\r\n        return (react_1.default.createElement(adhere_ui_conditionalrender_1.default, { conditional: !isEmpty(), noMatch: function () { return (renderEmpty ? renderEmpty() : react_1.default.createElement(antd_1.Empty, null)); } }, function () { return children; }));\r\n    };\r\n    SuspenseSync.prototype.fetchData = function () { };\r\n    return SuspenseSync;\r\n}(suspense_1.default));\r\nSuspenseSync.defaultProps = {};\r\nSuspenseSync.propTypes = {\r\n    firstLoading: prop_types_1.default.node,\r\n    isEmpty: prop_types_1.default.func.isRequired,\r\n    renderEmpty: prop_types_1.default.func,\r\n};\r\nexports.default = SuspenseSync;\r\n"],"names":["__extends","this","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","TypeError","String","__","constructor","create","__importDefault","mod","__esModule","default","antd_1","defineProperty","exports","value","require","prop_types_1","react_1","adhere_ui_conditionalrender_1","adhere_util_1","suspense_1","SuspenseSync","_super","_this","apply","arguments","state","loading","isLoading","componentWillReceiveProps","nextProps","data","props","isDataDirty","setState","nextData","isObject","is","isArray","length","some","t1","index","reset","Promise","resolve","isFirst","isFirstLoading","showLoading","renderInner","_a","isEmpty","renderEmpty","children","createElement","conditional","noMatch","Empty","fetchData","defaultProps","propTypes","firstLoading","node","func","isRequired"],"mappings":"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"}