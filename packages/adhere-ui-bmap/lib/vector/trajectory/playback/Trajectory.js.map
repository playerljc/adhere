{"version":3,"file":"Trajectory.js","sources":["vector/trajectory/playback/Trajectory.js"],"sourcesContent":["\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar adhere_util_1 = __importDefault(require(\"@baifendian/adhere-util\"));\nvar turf = __importStar(require(\"@turf/turf\"));\nvar types_1 = require(\"../../types\");\n/**\n * Trajectory\n * @class Trajectory\n * @classdesc 一个轨迹\n */\nvar Trajectory = /** @class */ (function () {\n    function Trajectory(_a) {\n        var context = _a.context, id = _a.id, coordinates = _a.coordinates, renderPosition = _a.renderPosition, renderStep = _a.renderStep, renderCap = _a.renderCap, duration = _a.duration;\n        // 主键\n        this.id = '';\n        // 上下文\n        this.context = null;\n        // 轨迹的数据\n        this.coordinates = [];\n        // 完成轨迹播放的时长(单位秒)\n        this.duration = 0;\n        // 状态\n        this.status = types_1.TrajectoryStatus.UnInit;\n        // 总的回合数\n        this.boutTotal = 0;\n        // 已经进行的回合数\n        this.bout = 1;\n        // loop的句柄\n        this.loopHeader = -1;\n        // loop的数据\n        this.loopPointEntitys = [];\n        // step的数组\n        this.stepEntityIndexes = [];\n        // 之前的loopPixel\n        this.preLoopPixel = null;\n        // 箭头的mark\n        this.arrowMarker = null;\n        this.context = context;\n        this.id = id;\n        this.coordinates = coordinates;\n        this.duration = duration;\n        this.renderPosition = renderPosition;\n        this.renderStep = renderStep;\n        this.renderCap = renderCap;\n    }\n    /**\n     * drawDefaultPosition\n     * @description - 默认的点位绘制\n     * @protected\n     * @param coordinate\n     * @param index\n     */\n    Trajectory.prototype.drawDefaultPosition = function (coordinate, index) {\n        var context = this.context;\n        if (!context)\n            return;\n        var ctx = context.getCtx();\n        if (!ctx)\n            return;\n        // 需要转换\n        var pixel = context.pointToPixel({ x: coordinate.lng, y: coordinate.lat });\n        // 绘制圆圈\n        ctx.beginPath();\n        ctx.strokeStyle = 'red';\n        ctx.fillStyle = '#fff';\n        ctx.lineWidth = 3;\n        ctx.ellipse(pixel.x, pixel.y, 6, 6, (45 * Math.PI) / 180, 0, 2 * Math.PI);\n        ctx.stroke();\n        ctx.fill();\n        // 绘制文字\n        ctx.beginPath();\n        ctx.font = '8px sans-serif';\n        ctx.textAlign = 'center';\n        ctx.textBaseline = 'middle';\n        ctx.fillStyle = '#000';\n        ctx.fillText(\"\".concat(index + 1), pixel.x, pixel.y, 10);\n    };\n    /**\n     * createDefaultCap\n     * @description - 创建缺省的箭头\n     * @protected\n     // * @param toPixel\n     */\n    Trajectory.prototype.createDefaultCap = function ( /*toPixel: IPixel*/) {\n        var context = this.context;\n        if (!context)\n            return;\n        // const map = context.getMap();\n        // const prePoint = context.pixelToPoint(preLoopPixel);\n        // const point = context.pixelToPoint(toPixel);\n        // const angle = MathUtil.radianToAngle(MathUtil.slope(preLoopPixel, toPixel));\n        // const angle1 =\n        //   (Math.atan2(preLoopPixel.y - toPixel.y, preLoopPixel.x - toPixel.x) * 180) / Math.PI;\n        // const a1 = turf.point([prePoint.x, prePoint.y], { 'marker-color': '#F00' });\n        // const a2 = turf.point([point.x, point.y], { 'marker-color': '#F00' });\n        // console.log('angle', angle1, angle);\n        // console.log('rhumbBearing', turf.rhumbBearing(a1, a2));\n        // console.log('bearing', turf.bearing(a1, a2));\n        // @ts-ignore\n        var myIcon = new BMap.Icon('data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjMxNDU2MzQ2NjYxIiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjQxMzYiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+PC9zdHlsZT48L2RlZnM+PHBhdGggZD0iTTc4OC40OCA1MTJMMzEyLjMyIDc4Ni45MjM1MlYyMzcuMDk2OTZ6IiBwLWlkPSI0MTM3IiBmaWxsPSIjRkZBNTAwIj48L3BhdGg+PC9zdmc+', \n        // @ts-ignore\n        new BMap.Size(16, 16));\n        // @ts-ignore\n        // const pt = new BMap.Point(point.x, point.y);\n        // @ts-ignore\n        return new BMap.Marker(new BMap.Point(90, 90), {\n            icon: myIcon,\n            // rotation: angle,\n        });\n    };\n    /**\n     * updateCap\n     * @param toPixel\n     * @protected\n     * @description - 更新arrow的位置和旋转角度\n     */\n    Trajectory.prototype.updateCap = function (toPixel) {\n        var _a = this, preLoopPixel = _a.preLoopPixel, context = _a.context, arrowMarker = _a.arrowMarker;\n        if (!context || !preLoopPixel || !arrowMarker)\n            return;\n        var toPoint = context.pixelToPoint(toPixel);\n        var dx = toPixel.x - preLoopPixel.x;\n        var dy = toPixel.y - preLoopPixel.y;\n        var rotation = Math.atan2(dy, dx);\n        var degrees1 = rotation * (180 / Math.PI);\n        var degrees = adhere_util_1.default.slopToAngle(preLoopPixel, toPixel, 'geographic');\n        // const angle = MathUtil.radianToAngle(MathUtil.slope(preLoopPixel, toPixel));\n        // @ts-ignore\n        arrowMarker.setPosition(new BMap.Point(toPoint.x, toPoint.y));\n        arrowMarker.setRotation(degrees);\n        // const angle1 =\n        //   (Math.atan2(preLoopPixel.y - toPixel.y, preLoopPixel.x - toPixel.x) * 180) / Math.PI;\n        // const a1 = turf.point([prePoint.x, prePoint.y], { 'marker-color': '#F00' });\n        // const a2 = turf.point([point.x, point.y], { 'marker-color': '#F00' });\n        // console.log('angle', angle1, angle);\n        // console.log('rhumbBearing', turf.rhumbBearing(a1, a2));\n        // console.log('bearing', turf.bearing(a1, a2));\n    };\n    /**\n     * drawPosition\n     * @description - 绘制位置节点\n     * @protected\n     */\n    Trajectory.prototype.drawPosition = function () {\n        var _this = this;\n        var _a = this, renderPosition = _a.renderPosition, coordinates = _a.coordinates, context = _a.context;\n        if (!context)\n            return;\n        var ctx = context.getCtx();\n        if (!ctx)\n            return;\n        coordinates.forEach(function (coordinate, index) {\n            // 用户自定义绘制\n            if (renderPosition) {\n                renderPosition({ ctx: ctx, coordinate: coordinate });\n            }\n            // 默认绘制\n            else {\n                _this.drawDefaultPosition(coordinate, index);\n            }\n        });\n    };\n    /**\n     * drawTrajectory\n     * @description - 绘制历史轨迹\n     * @protected\n     */\n    Trajectory.prototype.drawTrajectory = function () {\n        this.drawPosition();\n        this.prepareLoopData();\n        for (var i = 1; i < this.boutTotal; i++) {\n            this.loopBout(i);\n        }\n        this.drawLastFrame();\n        this.finishDeal();\n    };\n    /**\n     * drawLastFrame\n     * @description - 绘制最后一帧\n     * @protected\n     */\n    Trajectory.prototype.drawLastFrame = function () {\n        var _a = this, loopPointEntitys = _a.loopPointEntitys, context = _a.context, renderStep = _a.renderStep, renderCap = _a.renderCap;\n        if (!context)\n            return;\n        var ctx = context.getCtx();\n        if (!ctx)\n            return;\n        var lastPoint = loopPointEntitys[loopPointEntitys.length - 1];\n        var lastPixel = context.pointToPixel({ x: lastPoint.point.lng, y: lastPoint.point.lat });\n        ctx.beginPath();\n        if (renderStep) {\n            renderStep(ctx, lastPixel);\n        }\n        else {\n            this.setDrawLoopStyle();\n            ctx.lineTo(lastPixel.x, lastPixel.y);\n            ctx.stroke();\n            this.preLoopPixel = null;\n        }\n        this.updateCap(lastPixel);\n    };\n    /**\n     * setDrawLoopStyle\n     * @description - 设置loop绘制的上下文样式\n     * @protected\n     */\n    Trajectory.prototype.setDrawLoopStyle = function () {\n        var context = this.context;\n        if (!context)\n            return;\n        var ctx = context.getCtx();\n        if (!ctx)\n            return;\n        ctx.strokeStyle = 'orange';\n        ctx.lineWidth = 3;\n        // ctx.lineCap = 'round';\n    };\n    /**\n     * finishDeal\n     * @protected - End后的清理工作\n     * @protected\n     */\n    Trajectory.prototype.finishDeal = function () {\n        var context = this.context;\n        if (!context)\n            return;\n        var map = context.getMap();\n        if (!map)\n            return;\n        if (this.loopHeader !== -1) {\n            typeof window !== 'undefined' && window.cancelAnimationFrame(this.loopHeader);\n        }\n        this.loopHeader = -1;\n        this.bout = 1;\n        this.boutTotal = 0;\n        this.loopPointEntitys = [];\n        this.stepEntityIndexes = [];\n        this.preLoopPixel = null;\n        if (this.arrowMarker) {\n            map.removeOverlay(this.arrowMarker);\n        }\n        this.arrowMarker = null;\n    };\n    /**\n     * loopBout\n     * @description - 绘制一个回合\n     * @param bout\n     * @protected\n     */\n    Trajectory.prototype.loopBout = function (bout) {\n        var _a = this, context = _a.context, loopPointEntitys = _a.loopPointEntitys, stepEntityIndexes = _a.stepEntityIndexes, renderStep = _a.renderStep, renderCap = _a.renderCap;\n        if (!context)\n            return;\n        var ctx = context.getCtx();\n        if (!ctx)\n            return;\n        var map = context.getMap();\n        // 先执行一次\n        var curStartStepIndex = bout === 1 ? 0 : stepEntityIndexes[bout - 2];\n        var curEndStepIndex = stepEntityIndexes[bout - 1];\n        for (var i = curStartStepIndex; i < curEndStepIndex; i++) {\n            var point = loopPointEntitys[i].point;\n            var pixel = context.pointToPixel({ x: point.lng, y: point.lat });\n            if (this.preLoopPixel) {\n                this.updateCap(pixel);\n            }\n            else {\n                // 创建\n                if (renderCap) {\n                    this.arrowMarker = renderCap();\n                }\n                else {\n                    this.arrowMarker = this.createDefaultCap();\n                }\n                map.addOverlay(this.arrowMarker);\n            }\n            if (renderStep) {\n                renderStep(ctx, pixel);\n            }\n            else {\n                if (!this.preLoopPixel) {\n                    ctx.beginPath();\n                    this.setDrawLoopStyle();\n                    ctx.moveTo(pixel.x, pixel.y);\n                    this.preLoopPixel = pixel;\n                }\n                else {\n                    ctx.lineTo(pixel.x, pixel.y);\n                    ctx.stroke();\n                    ctx.beginPath();\n                    this.setDrawLoopStyle();\n                    ctx.moveTo(pixel.x, pixel.y);\n                    // 0 1 2 3 4 5\n                }\n            }\n        }\n    };\n    /**\n     * loop\n     * @description - loop的迭代\n     * @protected\n     */\n    Trajectory.prototype.loop = function () {\n        // 2 5\n        // 0 1   (2)     3 4    (5)\n        var _this = this;\n        if (typeof window === 'undefined')\n            return;\n        this.loopHeader = window.requestAnimationFrame(function () {\n            // 暂停则不执行其他操作\n            if (_this.status === types_1.TrajectoryStatus.Pause) {\n                _this.loop();\n                return;\n            }\n            var context = _this.context;\n            if (!context)\n                return;\n            var ctx = context.getCtx();\n            if (!ctx)\n                return;\n            _this.loopBout(_this.bout);\n            // 回合++\n            _this.bout++;\n            // 结束了\n            if (_this.bout >= _this.boutTotal) {\n                // 绘制最后一个点\n                _this.drawLastFrame();\n                _this.finishDeal();\n                _this.status = types_1.TrajectoryStatus.End;\n                return;\n            }\n            else {\n                _this.loop();\n            }\n        });\n    };\n    /**\n     * prepareLoopData\n     * @description - 准备loop的数据\n     * @protected\n     */\n    Trajectory.prototype.prepareLoopData = function () {\n        // 计算沿线的点\n        var _this = this;\n        /**\n         * 整体的思路\n         * 1. 将所有原始点生成一个结构 {\n         *   point: {x,y},\n         *   distance: 沿线的距离(第一个点为0)单位为m\n         *   isStep: boolean(是否为步进的点) false\n         * }\n         *\n         * 2.总的距离 / (duration * 60) 获取步进\n         * 计算每一次的步进 生成 {\n         *   point: {x,y},\n         *   distance: 沿线的距离(第一个点为0)单位为m\n         *   isStep: boolean(是否为步进的点) true\n         * }\n         *\n         * 3.将1,2按照distance从小到大整合到一起\n         *\n         * 4.开始播放\n         */\n        var _a = this, duration = _a.duration, coordinates = _a.coordinates;\n        // 1.origin\n        var origin = [];\n        coordinates.reduce(function (total, coordinate, index) {\n            var distance = index === 0\n                ? 0\n                : turf.convertLength(turf.distance(turf.point([coordinates[index - 1].lng, coordinates[index - 1].lat]), turf.point([coordinate.lng, coordinate.lat]), {\n                    units: 'kilometers',\n                }), 'kilometers', 'meters');\n            origin.push({\n                point: coordinate,\n                distance: total + distance,\n                isStep: false,\n            });\n            return total + distance;\n        }, 0);\n        // 2.target\n        var line = turf.lineString(coordinates.map(function (coordinate) { return [coordinate.lng, coordinate.lat]; }));\n        // 总长(m)\n        var length = turf.convertLength(turf.length(line, { units: 'kilometers' }), 'kilometers', 'meters');\n        // 总的回合数\n        this.boutTotal = duration * 60;\n        // 步进(m)\n        var step = length / this.boutTotal;\n        // target\n        var target = [];\n        for (var i = 0; i < this.boutTotal; i++) {\n            // 每一步的距离\n            var stepDistance = (i + 1) * step;\n            var turfPoint = turf.along(line, turf.convertLength(stepDistance, 'meters', 'kilometers'), {\n                units: 'kilometers',\n            });\n            target.push({\n                point: { lng: turfPoint.geometry.coordinates[0], lat: turfPoint.geometry.coordinates[1] },\n                distance: stepDistance,\n                isStep: true,\n            });\n        }\n        // 3.sortMerge(按距离从小到大进行排序)\n        this.loopPointEntitys = __spreadArray(__spreadArray([], origin, true), target, true);\n        this.loopPointEntitys.sort(function (p1, p2) {\n            if (p1.distance > p2.distance)\n                return 1;\n            else if (p1.distance < p2.distance)\n                return -1;\n            else\n                return 0;\n        });\n        this.stepEntityIndexes = [];\n        this.loopPointEntitys.forEach(function (pointEntity, index) {\n            if (pointEntity.isStep) {\n                _this.stepEntityIndexes.push(index);\n            }\n        });\n    };\n    /**\n     * init\n     * @description - 初始化轨迹\n     */\n    Trajectory.prototype.init = function () {\n        if (this.status !== types_1.TrajectoryStatus.UnInit)\n            return;\n        // 初始化就是先把轨迹点绘制上\n        this.drawPosition();\n        // 修改状态为初始化完成\n        this.status = types_1.TrajectoryStatus.Init;\n    };\n    /**\n     * start\n     * @description - 开始\n     */\n    Trajectory.prototype.start = function () {\n        var context = this.context;\n        if (!context)\n            return;\n        var ctx = context.getCtx();\n        if (!ctx)\n            return;\n        if (![types_1.TrajectoryStatus.Init, types_1.TrajectoryStatus.End, types_1.TrajectoryStatus.Pause].includes(this.status)) {\n            return;\n        }\n        if ([types_1.TrajectoryStatus.Pause, types_1.TrajectoryStatus.End].includes(this.status)) {\n            if (types_1.TrajectoryStatus.Pause === this.status) {\n                this.finishDeal();\n            }\n            context.clear();\n            // 画历史\n            context.drawHistory();\n        }\n        // 修改状态为运行状态\n        this.status = types_1.TrajectoryStatus.Running;\n        // 准备loop数据\n        this.prepareLoopData();\n        // execute\n        this.loop();\n    };\n    /**\n     * pause\n     * @description - 暂停\n     */\n    Trajectory.prototype.pause = function () {\n        this.status = types_1.TrajectoryStatus.Pause;\n    };\n    /**\n     * resume\n     * @description -恢复\n     */\n    Trajectory.prototype.resume = function () {\n        this.status = types_1.TrajectoryStatus.Running;\n    };\n    /**\n     * finish\n     * @description - 结束\n     */\n    Trajectory.prototype.finish = function () {\n        var context = this.context;\n        if (!context)\n            return;\n        if ([types_1.TrajectoryStatus.End, types_1.TrajectoryStatus.Destroy].includes(this.status))\n            return;\n        // 如果没画完画完\n        this.finishDeal();\n        this.status = types_1.TrajectoryStatus.End;\n    };\n    /**\n     * description\n     * @description - 销毁\n     */\n    Trajectory.prototype.destroy = function () {\n        if (this.status === types_1.TrajectoryStatus.Destroy)\n            return;\n        var context = this.context;\n        if (!context)\n            return;\n        this.finishDeal();\n        context.clear();\n        // 画历史\n        // context.drawHistory();\n        this.status = types_1.TrajectoryStatus.Destroy;\n        context.removeTrajectoryById(this.id);\n    };\n    Trajectory.prototype.getId = function () {\n        return this.id;\n    };\n    Trajectory.prototype.getStatus = function () {\n        return this.status;\n    };\n    /**\n     * drawHistory\n     * @description - 绘制clear之后的历史轨迹\n     */\n    Trajectory.prototype.drawHistory = function () {\n        var status = this.status;\n        if (types_1.TrajectoryStatus.Init === status) {\n            this.drawPosition();\n        }\n        else if (types_1.TrajectoryStatus.End === status) {\n            this.drawTrajectory();\n        }\n        if ([types_1.TrajectoryStatus.Pause, types_1.TrajectoryStatus.Running].includes(status)) {\n            this.drawPosition();\n            // 绘制历史\n            for (var i = 1; i < this.bout; i++) {\n                this.loopBout(i);\n            }\n        }\n    };\n    return Trajectory;\n}());\nexports.default = Trajectory;\n"],"names":["__createBinding","this","Object","create","o","m","k","k2","undefined","desc","getOwnPropertyDescriptor","__esModule","writable","configurable","enumerable","get","defineProperty","__setModuleDefault","v","value","__importStar","mod","result","prototype","hasOwnProperty","call","__spreadArray","to","from","pack","arguments","length","ar","i","l","Array","slice","concat","__importDefault","default","adhere_util_1","exports","require","turf","types_1","Trajectory","_a","context","id","coordinates","renderPosition","renderStep","renderCap","duration","status","TrajectoryStatus","UnInit","boutTotal","bout","loopHeader","loopPointEntitys","stepEntityIndexes","preLoopPixel","arrowMarker","drawDefaultPosition","coordinate","index","ctx","getCtx","pixel","pointToPixel","x","lng","y","lat","beginPath","strokeStyle","fillStyle","lineWidth","ellipse","Math","PI","stroke","fill","font","textAlign","textBaseline","fillText","createDefaultCap","myIcon","BMap","Icon","Size","Marker","Point","icon","updateCap","toPixel","dx","degrees","toPoint","pixelToPoint","dy","atan2","slopToAngle","setPosition","setRotation","drawPosition","_this","forEach","drawTrajectory","prepareLoopData","loopBout","drawLastFrame","finishDeal","lastPoint","lastPixel","point","setDrawLoopStyle","lineTo","map","getMap","window","cancelAnimationFrame","removeOverlay","curStartStepIndex","curEndStepIndex","addOverlay","moveTo","loop","requestAnimationFrame","Pause","End","origin","line","reduce","total","distance","convertLength","units","push","isStep","lineString","step","target","stepDistance","turfPoint","along","geometry","sort","p1","p2","pointEntity","init","Init","start","includes","clear","drawHistory","Running","pause","resume","finish","Destroy","destroy","removeTrajectoryById","getId","getStatus"],"mappings":"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"}