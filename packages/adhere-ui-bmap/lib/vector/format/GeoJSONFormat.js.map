{"version":3,"file":"GeoJSONFormat.js","sources":["vector/format/GeoJSONFormat.js"],"sourcesContent":["\"use strict\";\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar base_1 = __importDefault(require(\"@baifendian/adhere-util/lib/base\"));\r\nvar types_1 = require(\"../types\");\r\nvar PointGeometry_1 = __importDefault(require(\"../geom/PointGeometry\"));\r\nvar MulitPointGeometry_1 = __importDefault(require(\"../geom/MulitPointGeometry\"));\r\nvar LineStringGeometry_1 = __importDefault(require(\"../geom/LineStringGeometry\"));\r\nvar MulitLineStringGeometry_1 = __importDefault(require(\"../geom/MulitLineStringGeometry\"));\r\nvar PolygonGeometry_1 = __importDefault(require(\"../geom/PolygonGeometry\"));\r\nvar MulitPolygonGeometry_1 = __importDefault(require(\"../geom/MulitPolygonGeometry\"));\r\nexports.default = {\r\n    /**\r\n     * parse - GeoJSON转IFeature[]\r\n     * @param geoJSON\r\n     * @param onForeachGeom\r\n     */\r\n    parse: function (geoJSON, onForeachGeom) {\r\n        /**\r\n         * Recursion\r\n         * @param node\r\n         * @param handler\r\n         * @param features\r\n         * @constructor\r\n         */\r\n        function Recursion(node, handler, features) {\r\n            var feature = null;\r\n            /**\r\n             * Point\r\n             * MultiPoint\r\n             * LineString\r\n             * MultiLineString\r\n             * Polygon\r\n             * MultiPolygon\r\n             * GeometryCollection\r\n             * Feature\r\n             * FeatureCollection\r\n             */\r\n            if (node.type === types_1.GeoJSONType.Point) {\r\n                var geom = new PointGeometry_1.default({\r\n                    lng: node.coordinates[0],\r\n                    lat: node.coordinates[1],\r\n                });\r\n                feature = handler(geom);\r\n                feature.setId(base_1.default.uuid());\r\n                features.push(feature);\r\n            }\r\n            else if (node.type === types_1.GeoJSONType.MultiPoint) {\r\n                var geom = new MulitPointGeometry_1.default(node.coordinates.map(function (coordinate) { return ({\r\n                    lng: coordinate[0],\r\n                    lat: coordinate[1],\r\n                }); }));\r\n                feature = handler(geom);\r\n                feature.setId(base_1.default.uuid());\r\n                features.push(feature);\r\n            }\r\n            else if (node.type === types_1.GeoJSONType.LineString) {\r\n                var geom = new LineStringGeometry_1.default({\r\n                    point1: {\r\n                        lng: node.coordinates[0][0],\r\n                        lat: node.coordinates[0][1],\r\n                    },\r\n                    point2: {\r\n                        lng: node.coordinates[1][0],\r\n                        lat: node.coordinates[1][1],\r\n                    },\r\n                });\r\n                feature = handler(geom);\r\n                feature.setId(base_1.default.uuid());\r\n                features.push(feature);\r\n            }\r\n            else if (node.type === types_1.GeoJSONType.MultiLineString) {\r\n                var geom = new MulitLineStringGeometry_1.default(node.coordinates.map(function (coordinate) { return ({\r\n                    point1: {\r\n                        lng: coordinate[0][0],\r\n                        lat: coordinate[0][1],\r\n                    },\r\n                    point2: {\r\n                        lng: coordinate[1][0],\r\n                        lat: coordinate[1][1],\r\n                    },\r\n                }); }));\r\n                feature = handler(geom);\r\n                feature.setId(base_1.default.uuid());\r\n                features.push(feature);\r\n            }\r\n            else if (node.type === types_1.GeoJSONType.Polygon) {\r\n                var geom = new PolygonGeometry_1.default(node.coordinates.map(function (coordinate) { return ({\r\n                    lng: coordinate[0],\r\n                    lat: coordinate[1],\r\n                }); }));\r\n                feature = handler(geom);\r\n                feature.setId(base_1.default.uuid());\r\n                features.push(feature);\r\n            }\r\n            else if (node.type === types_1.GeoJSONType.MultiPolygon) {\r\n                var geom = new MulitPolygonGeometry_1.default(node.coordinates.map(function (coordinate) {\r\n                    return coordinate.map(function (p) { return ({\r\n                        lng: p[0],\r\n                        lat: p[1],\r\n                    }); });\r\n                }));\r\n                feature = handler(geom);\r\n                feature.setId(base_1.default.uuid());\r\n                features.push(feature);\r\n            }\r\n            else if (node.type === types_1.GeoJSONType.GeometryCollection) {\r\n                node.geometries.forEach(function (geom) {\r\n                    Recursion(geom, onForeachGeom, features);\r\n                });\r\n            }\r\n            else if (node.type === types_1.GeoJSONType.Feature) {\r\n                Recursion(node.geometry, function (g) {\r\n                    var f = onForeachGeom(g);\r\n                    f.setId(node.id);\r\n                    f.setProperties(node.properties);\r\n                    return f;\r\n                }, features);\r\n            }\r\n            else if (node.type === types_1.GeoJSONType.FeatureCollection) {\r\n                node.features.forEach(function (feature) {\r\n                    Recursion(feature, onForeachGeom, features);\r\n                });\r\n            }\r\n        }\r\n        var features = [];\r\n        Recursion(geoJSON, onForeachGeom, features);\r\n        return features;\r\n    },\r\n    /**\r\n     * stringify - features转GeoJSON\r\n     * @param features\r\n     * @return GeoJSONNode\r\n     */\r\n    stringify: function (features) {\r\n        function getCoordinatesByType(geometry) {\r\n            var mapping = new Map([\r\n                [types_1.GeoJSONType.Point, getPointCoordinates],\r\n                [types_1.GeoJSONType.MultiPoint, getMulitPointCoordinates],\r\n                [types_1.GeoJSONType.LineString, getLineStringCoordinates],\r\n                [types_1.GeoJSONType.MultiLineString, getMulitLineStringCoordinates],\r\n                [types_1.GeoJSONType.Polygon, getPolygonCoordinates],\r\n                [types_1.GeoJSONType.MultiPolygon, getMulitPolygonCoordinates],\r\n            ]);\r\n            var type = geometry.getType();\r\n            // @ts-ignore\r\n            return mapping.get(type)(geometry);\r\n        }\r\n        function getPointCoordinates(geometry) {\r\n            var coordinates = geometry.getCoordinates();\r\n            return [coordinates.lng, coordinates.lat];\r\n        }\r\n        function getMulitPointCoordinates(geometry) {\r\n            var coordinates = geometry.getCoordinates();\r\n            return coordinates.map(function (coordinate) { return [coordinate.lng, coordinate.lat]; });\r\n        }\r\n        function getLineStringCoordinates(geometry) {\r\n            var coordinates = geometry.getCoordinates();\r\n            return [\r\n                [coordinates.point1.lng, coordinates.point1.lat],\r\n                [coordinates.point2.lng, coordinates.point2.lat],\r\n            ];\r\n        }\r\n        function getMulitLineStringCoordinates(geometry) {\r\n            var coordinates = geometry.getCoordinates();\r\n            return coordinates.map(function (coordinate) { return [\r\n                [coordinate.point1.lng, coordinate.point1.lat],\r\n                [coordinate.point2.lng, coordinate.point2.lat],\r\n            ]; });\r\n        }\r\n        function getPolygonCoordinates(geometry) {\r\n            var coordinates = geometry.getCoordinates();\r\n            return coordinates.map(function (coordinate) { return [coordinate.lng, coordinate.lat]; });\r\n        }\r\n        function getMulitPolygonCoordinates(geometry) {\r\n            var coordinates = geometry.getCoordinates();\r\n            return coordinates.map(function (coordinate) { return coordinate.map(function (p) { return [p.lng, p.lat]; }); });\r\n        }\r\n        var geoJSON = {\r\n            type: types_1.GeoJSONType.FeatureCollection,\r\n            features: [],\r\n        };\r\n        var filterType = [];\r\n        for (var key in types_1.GeoJSONType) {\r\n            filterType.push(key);\r\n        }\r\n        features.forEach(function (feature) {\r\n            var type = feature.getGeometry().getType();\r\n            if (filterType.includes(type)) {\r\n                geoJSON.features.push({\r\n                    type: types_1.GeoJSONType.Feature,\r\n                    geometry: {\r\n                        //  @ts-ignore\r\n                        type: type,\r\n                        coordinates: getCoordinatesByType(feature.getGeometry()),\r\n                    },\r\n                    id: feature.getId(),\r\n                    properties: feature.getProperties(),\r\n                });\r\n            }\r\n        });\r\n        return geoJSON;\r\n    },\r\n};\r\n"],"names":["__importDefault","this","mod","__esModule","default","Object","defineProperty","exports","value","base_1","require","types_1","PointGeometry_1","MulitPointGeometry_1","LineStringGeometry_1","MulitLineStringGeometry_1","PolygonGeometry_1","MulitPolygonGeometry_1","parse","geoJSON","onForeachGeom","features","Recursion","node","handler","feature","type","GeoJSONType","Point","lng","coordinates","lat","setId","uuid","push","MultiPoint","map","coordinate","LineString","point1","point2","MultiLineString","Polygon","MultiPolygon","p","GeometryCollection","geometries","forEach","geom","Feature","geometry","g","f","id","setProperties","properties","FeatureCollection","stringify","getPointCoordinates","getCoordinates","getMulitPointCoordinates","getLineStringCoordinates","getMulitLineStringCoordinates","getPolygonCoordinates","getMulitPolygonCoordinates","key","filterType","mapping","getGeometry","getType","includes","Map","get","getId","getProperties"],"mappings":"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"}