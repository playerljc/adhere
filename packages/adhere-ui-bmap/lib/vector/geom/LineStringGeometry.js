"use strict";var __extends=this&&this.__extends||function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var o in e=arguments[i])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},__importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0});var adhere_util_1=__importDefault(require("@baifendian/adhere-util")),types_1=require("../types"),Geometry_1=__importDefault(require("./Geometry")),GeometryStyle_1=__importDefault(require("../style/GeometryStyle")),util_1=__importDefault(require("../../util")),TextStyle_1=__importDefault(require("../style/TextStyle")),SIZE=new Map([["small",3],["normal",10],["large",20]]),LineStringGeometry=function(i){function l(t){var e=i.call(this)||this;return e.coordinates=t,e}return __extends(l,i),l.drawStartArrow=function(t){var e=t.ctx,i=t.style,n=t.coordinates,o=t.map;e.save(),e.beginPath(),e.lineWidth=i.lineWidth,e.lineJoin=i.lineJoin,e.lineCap=i.lineCap,e.setLineDash(i.lineDash),e.lineDashOffset=i.lineDashOffset,e.strokeStyle=i.strokeStyle,e.fillStyle=i.fillStyle;t=o.pointToPixel(new BMap.Point(n.point1.lng,n.point1.lat)),n=o.pointToPixel(new BMap.Point(n.point2.lng,n.point2.lat)),n=util_1.default.getArrowPoints({from:n,to:t,scale:1,width:SIZE.get(i.arrow.size)}),t=n.A,i=n.B,n=n.C;e.moveTo(t.x,t.y),e.lineTo(i.x,i.y),e.lineTo(n.x,n.y),e.closePath(),e.stroke(),e.fill(),e.restore()},l.drawEndArrow=function(t){var e=t.ctx,i=t.style,n=t.coordinates,o=t.map;e.save(),e.beginPath(),e.lineWidth=i.lineWidth,e.lineJoin=i.lineJoin,e.lineCap=i.lineCap,e.setLineDash(i.lineDash),e.lineDashOffset=i.lineDashOffset,e.strokeStyle=i.strokeStyle,e.fillStyle=i.fillStyle;t=o.pointToPixel(new BMap.Point(n.point1.lng,n.point1.lat)),n=o.pointToPixel(new BMap.Point(n.point2.lng,n.point2.lat)),t=util_1.default.getArrowPoints({from:t,to:n,scale:1,width:SIZE.get(i.arrow.size)}),n=t.A,i=t.B,t=t.C;e.moveTo(n.x,n.y),e.lineTo(i.x,i.y),e.lineTo(t.x,t.y),e.closePath(),e.stroke(),e.fill(),e.restore()},l.drawLineString=function(t){var e=t.ctx,i=t.style,n=t.coordinates,o=t.map;e.save();var r=__assign(__assign(__assign({},GeometryStyle_1.default),i||{}),{arrow:{draw:!1,direction:"end",type:"normal",size:"normal"}});e.beginPath(),e.lineWidth=r.lineWidth,e.lineJoin=r.lineJoin,e.lineCap=r.lineCap,e.setLineDash(r.lineDash),e.lineDashOffset=r.lineDashOffset,e.strokeStyle=r.strokeStyle;var a=n.point1,t=n.point2,a=o.pointToPixel(new BMap.Point(a.lng,a.lat)),t=o.pointToPixel(new BMap.Point(t.lng,t.lat));e.moveTo(a.x,a.y),e.lineTo(t.x,t.y),e.stroke(),e.restore(),i.arrow.draw&&("start"===i.arrow.direction?l.drawStartArrow({ctx:e,style:r,coordinates:n,map:o}):"end"===i.arrow.direction?l.drawEndArrow({ctx:e,style:r,coordinates:n,map:o}):"bothEnds"===i.arrow.direction&&(l.drawStartArrow({ctx:e,style:r,coordinates:n,map:o}),l.drawEndArrow({ctx:e,style:r,coordinates:n,map:o})))},l.prototype.setCoordinates=function(t){this.coordinates=t,null!==(t=null===(t=null==this?void 0:this.getLayer())||void 0===t?void 0:t.getEmitter())&&void 0!==t&&t.trigger(types_1.VectorActions.UPDATE)},l.prototype.getCoordinates=function(){return __assign({},this.coordinates)},l.prototype.getType=function(){return types_1.GeometryType.LineString},l.getCenterCoordinate=function(t){t.ctx;var e=t.coordinates,i=t.map,t=(t.style,t.isScale,e.point1),e=e.point2,t=i.pointToPixel(new BMap.Point(t.lng,t.lat)),e=i.pointToPixel(new BMap.Point(e.lng,e.lat));return adhere_util_1.default.midpoint(t,e)},l.prototype.getCenterCoordinate=function(t){var e=t.ctx,i=t.style,t=t.isScale;return l.getCenterCoordinate({ctx:e,coordinates:this.coordinates,map:this.getMap(),style:i,isScale:t})},l.prototype.draw=function(t,e){l.drawLineString({ctx:t,style:e,coordinates:this.coordinates,map:this.getMap()})},l.prototype.drawText=function(t){var e=t.ctx,i=t.text,n=t.style,o=t.textStyle;e.save(),e.beginPath();var r=this.getMap(),a=this.getCenterCoordinate({ctx:e,style:n,isScale:!0});e.translate(a.x,a.y);t=this.coordinates,a=t.point1,t=t.point2,a=r.pointToPixel(new BMap.Point(a.lng,a.lat)),t=r.pointToPixel(new BMap.Point(t.lng,t.lat)),t=adhere_util_1.default.slopToRadian(a,t);e.rotate(t);o=__assign(__assign({},TextStyle_1.default),o||{});e.font=o.font,e.textAlign=o.textAlign,e.textBaseline=o.textBaseline,e.direction=o.direction,e.strokeStyle=o.strokeStyle,e.fillStyle=o.fillStyle;n=__assign(__assign({},GeometryStyle_1.default),n||{});e.lineWidth=n.lineWidth,e.lineJoin=n.lineJoin,e.lineCap=n.lineCap,e.setLineDash(n.lineDash),e.lineDashOffset=n.lineDashOffset,e.strokeStyle=n.strokeStyle,e.fillText(i||"",0,0),e.restore()},l.isPixelInGeometry=function(t){var e=t.pixel,i=(t.style,t.coordinates),n=t.map,o=document.createElement("canvas").getContext("2d");if(!o)return!1;o.beginPath();t=i.point1,i=i.point2,t=n.pointToPixel(new BMap.Point(t.lng,t.lat)),i=n.pointToPixel(new BMap.Point(i.lng,i.lat));return o.moveTo(t.x,t.y),o.lineTo(i.x,i.y),o.isPointInPath(e.x,e.y)},l.prototype.isPixelInGeometry=function(t,e){return l.isPixelInGeometry({pixel:t,style:e,coordinates:this.coordinates,map:this.getMap()})},l}(Geometry_1.default);exports.default=LineStringGeometry;
//# sourceMappingURL=LineStringGeometry.js.map
