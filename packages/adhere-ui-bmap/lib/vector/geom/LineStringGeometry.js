"use strict";var __extends=this&&this.__extends||function(){var n=function(t,e){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}))(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var o in e=arguments[i])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},__importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}},adhere_util_1=(Object.defineProperty(exports,"__esModule",{value:!0}),__importDefault(require("@baifendian/adhere-util"))),util_1=__importDefault(require("../../util")),GeometryStyle_1=__importDefault(require("../style/GeometryStyle")),TextStyle_1=__importDefault(require("../style/TextStyle")),types_1=require("../types"),Geometry_1=__importDefault(require("./Geometry")),SIZE=new Map([["small",3],["normal",10],["large",20]]),LineStringGeometry=function(i){function a(t){var e=i.call(this)||this;return e.coordinates=t,e}return __extends(a,i),a.drawStartArrow=function(t){var e=t.ctx,i=t.style,n=t.coordinates,t=t.map,o=(e.save(),e.beginPath(),e.lineWidth=i.lineWidth,e.lineJoin=i.lineJoin,e.lineCap=i.lineCap,e.setLineDash(i.lineDash),e.lineDashOffset=i.lineDashOffset,e.strokeStyle=i.strokeStyle,e.fillStyle=i.fillStyle,t.pointToPixel(new BMap.Point(n.point1.lng,n.point1.lat))),t=t.pointToPixel(new BMap.Point(n.point2.lng,n.point2.lat)),n=util_1.default.getArrowPoints({from:t,to:o,scale:1,width:SIZE.get(i.arrow.size)}),t=n.A,o=n.B,i=n.C;e.moveTo(t.x,t.y),e.lineTo(o.x,o.y),e.lineTo(i.x,i.y),e.closePath(),e.stroke(),e.fill(),e.restore()},a.drawEndArrow=function(t){var e=t.ctx,i=t.style,n=t.coordinates,t=t.map,o=(e.save(),e.beginPath(),e.lineWidth=i.lineWidth,e.lineJoin=i.lineJoin,e.lineCap=i.lineCap,e.setLineDash(i.lineDash),e.lineDashOffset=i.lineDashOffset,e.strokeStyle=i.strokeStyle,e.fillStyle=i.fillStyle,t.pointToPixel(new BMap.Point(n.point1.lng,n.point1.lat))),t=t.pointToPixel(new BMap.Point(n.point2.lng,n.point2.lat)),n=util_1.default.getArrowPoints({from:o,to:t,scale:1,width:SIZE.get(i.arrow.size)}),o=n.A,t=n.B,i=n.C;e.moveTo(o.x,o.y),e.lineTo(t.x,t.y),e.lineTo(i.x,i.y),e.closePath(),e.stroke(),e.fill(),e.restore()},a.drawLineString=function(t){var e=t.ctx,i=t.style,n=t.coordinates,t=t.map,o=(e.save(),__assign(__assign(__assign({},GeometryStyle_1.default),i||{}),{arrow:{draw:!1,direction:"end",type:"normal",size:"normal"}})),r=(e.beginPath(),e.lineWidth=o.lineWidth,e.lineJoin=o.lineJoin,e.lineCap=o.lineCap,e.setLineDash(o.lineDash),e.lineDashOffset=o.lineDashOffset,e.strokeStyle=o.strokeStyle,n.point1),l=n.point2,r=t.pointToPixel(new BMap.Point(r.lng,r.lat)),l=t.pointToPixel(new BMap.Point(l.lng,l.lat));e.moveTo(r.x,r.y),e.lineTo(l.x,l.y),e.stroke(),e.restore(),i.arrow.draw&&("start"===i.arrow.direction?a.drawStartArrow({ctx:e,style:o,coordinates:n,map:t}):"end"===i.arrow.direction?a.drawEndArrow({ctx:e,style:o,coordinates:n,map:t}):"bothEnds"===i.arrow.direction&&(a.drawStartArrow({ctx:e,style:o,coordinates:n,map:t}),a.drawEndArrow({ctx:e,style:o,coordinates:n,map:t})))},a.prototype.setCoordinates=function(t){this.coordinates=t,null!=(t=null==(t=null==this?void 0:this.getLayer())?void 0:t.getEmitter())&&t.trigger(types_1.VectorActions.UPDATE)},a.prototype.getCoordinates=function(){return __assign({},this.coordinates)},a.prototype.getType=function(){return types_1.GeometryType.LineString},a.getCenterCoordinate=function(t){t.ctx;var e=t.coordinates,i=t.map,t=(t.style,t.isScale,e.point1),e=e.point2,t=i.pointToPixel(new BMap.Point(t.lng,t.lat)),i=i.pointToPixel(new BMap.Point(e.lng,e.lat));return adhere_util_1.default.midpoint(t,i)},a.prototype.getCenterCoordinate=function(t){var e=t.ctx,i=t.style,t=t.isScale;return a.getCenterCoordinate({ctx:e,coordinates:this.coordinates,map:this.getMap(),style:i,isScale:t})},a.prototype.draw=function(t,e){a.drawLineString({ctx:t,style:e,coordinates:this.coordinates,map:this.getMap()})},a.prototype.drawText=function(t){var e=t.ctx,i=t.text,n=t.style,t=t.textStyle,o=(e.save(),e.beginPath(),this.getMap()),r=this.getCenterCoordinate({ctx:e,style:n,isScale:!0}),r=(e.translate(r.x,r.y),this.coordinates),l=r.point1,r=r.point2,l=o.pointToPixel(new BMap.Point(l.lng,l.lat)),o=o.pointToPixel(new BMap.Point(r.lng,r.lat)),r=adhere_util_1.default.slopToRadian(l,o),l=(e.rotate(r),__assign(__assign({},TextStyle_1.default),t||{})),o=(e.font=l.font,e.textAlign=l.textAlign,e.textBaseline=l.textBaseline,e.direction=l.direction,e.strokeStyle=l.strokeStyle,e.fillStyle=l.fillStyle,__assign(__assign({},GeometryStyle_1.default),n||{}));e.lineWidth=o.lineWidth,e.lineJoin=o.lineJoin,e.lineCap=o.lineCap,e.setLineDash(o.lineDash),e.lineDashOffset=o.lineDashOffset,e.strokeStyle=o.strokeStyle,e.fillText(i||"",0,0),e.restore()},a.isPixelInGeometry=function(t){var e=t.pixel,i=(t.style,t.coordinates),t=t.map,n=document.createElement("canvas").getContext("2d");if(!n)return!1;n.beginPath();var o=i.point1,i=i.point2,o=t.pointToPixel(new BMap.Point(o.lng,o.lat)),t=t.pointToPixel(new BMap.Point(i.lng,i.lat));return n.moveTo(o.x,o.y),n.lineTo(t.x,t.y),n.isPointInPath(e.x,e.y)},a.prototype.isPixelInGeometry=function(t,e){return a.isPixelInGeometry({pixel:t,style:e,coordinates:this.coordinates,map:this.getMap()})},a}(Geometry_1.default);exports.default=LineStringGeometry;
//# sourceMappingURL=LineStringGeometry.js.map
