{"version":3,"file":"VectorSource.js","sources":["vector/VectorSource.js"],"sourcesContent":["\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar adhere_util_emitter_1 = __importDefault(require(\"@baifendian/adhere-util-emitter\"));\nvar GeoJSONFormat_1 = __importDefault(require(\"./format/GeoJSONFormat\"));\nvar types_1 = require(\"./types\");\n/**\n * VectorSource\n * @class VectorSource\n * @classdesc VectorLayer的数据源\n */\nvar VectorSource = /** @class */ (function (_super) {\n    __extends(VectorSource, _super);\n    function VectorSource(features) {\n        var _this = _super.call(this) || this;\n        _this.context = null;\n        _this.features = [];\n        _this.features = features;\n        _this.setFeaturesContext();\n        return _this;\n    }\n    VectorSource.prototype.setFeaturesContext = function () {\n        var _this = this;\n        this.features.forEach(function (feature) {\n            feature.setContext(_this);\n        });\n    };\n    VectorSource.prototype.addFeature = function (feature) {\n        var _a;\n        if (this.hasFeatureById(feature.getId()))\n            return;\n        this.features.push(feature);\n        this.setFeaturesContext();\n        (_a = this === null || this === void 0 ? void 0 : this.getContext()) === null || _a === void 0 ? void 0 : _a.getEmitter().trigger(types_1.VectorActions.UPDATE);\n    };\n    VectorSource.prototype.addFeatures = function (features) {\n        var _this = this;\n        var _a;\n        var filterFeatures = features.filter(function (f) { return !_this.hasFeatureById(f.getId()); });\n        this.features = __spreadArray(__spreadArray([], this.features, true), filterFeatures, true);\n        this.setFeaturesContext();\n        (_a = this === null || this === void 0 ? void 0 : this.getContext()) === null || _a === void 0 ? void 0 : _a.getEmitter().trigger(types_1.VectorActions.UPDATE);\n    };\n    VectorSource.prototype.addFirstFeature = function (feature) {\n        var _a;\n        if (this.hasFeatureById(feature.getId()))\n            return;\n        this.features.unshift(feature);\n        (_a = this === null || this === void 0 ? void 0 : this.getContext()) === null || _a === void 0 ? void 0 : _a.getEmitter().trigger(types_1.VectorActions.UPDATE);\n    };\n    VectorSource.prototype.insertFeature = function (feature, index) {\n        var _a;\n        if (this.hasFeatureById(feature.getId()))\n            return;\n        this.features.splice(index, 0, feature);\n        this.setFeaturesContext();\n        (_a = this === null || this === void 0 ? void 0 : this.getContext()) === null || _a === void 0 ? void 0 : _a.getEmitter().trigger(types_1.VectorActions.UPDATE);\n    };\n    VectorSource.prototype.removeFeature = function (feature) {\n        this.removeFeatureById(feature.getId());\n    };\n    VectorSource.prototype.removeFeatureById = function (id) {\n        var _a;\n        if (!this.hasFeatureById(id))\n            return;\n        var index = this.features.findIndex(function (f) { return f.getId() === id; });\n        this.features.splice(index, 1);\n        (_a = this === null || this === void 0 ? void 0 : this.getContext()) === null || _a === void 0 ? void 0 : _a.getEmitter().trigger(types_1.VectorActions.UPDATE);\n    };\n    VectorSource.prototype.clear = function () {\n        var _a;\n        this.features = [];\n        (_a = this === null || this === void 0 ? void 0 : this.getContext()) === null || _a === void 0 ? void 0 : _a.getEmitter().trigger(types_1.VectorActions.UPDATE);\n    };\n    VectorSource.prototype.getFeatureById = function (id) {\n        // @ts-ignore\n        return this.features.find(function (f) { return f.getId() === id; });\n    };\n    VectorSource.prototype.getFeatures = function () {\n        return __spreadArray([], this.features, true);\n    };\n    VectorSource.prototype.hasFeature = function (feature) {\n        return this.features.indexOf(feature) !== -1;\n    };\n    VectorSource.prototype.hasFeatureById = function (id) {\n        return !!this.features.find(function (f) { return f.getId() === id; });\n    };\n    /**\n     * readGeoJSON - 读取GeoJSON数据转换成features\n     * @param geoJSON\n     * @param onForeachGeom\n     * @return void\n     */\n    VectorSource.prototype.readGeoJSON = function (geoJSON, onForeachGeom) {\n        var _this = this;\n        var _a;\n        this.features = GeoJSONFormat_1.default.parse(geoJSON, onForeachGeom);\n        this.features.forEach(function (feature) {\n            feature.setContext(_this);\n        });\n        (_a = this === null || this === void 0 ? void 0 : this.getContext()) === null || _a === void 0 ? void 0 : _a.getEmitter().trigger(types_1.VectorActions.UPDATE);\n    };\n    /**\n     * appendGeoJSON - 向画布追加GeoJSON的数据\n     * @param geoJSON\n     * @param onForeachGeom\n     */\n    VectorSource.prototype.appendGeoJSON = function (geoJSON, onForeachGeom) {\n        var _this = this;\n        var _a;\n        var features = GeoJSONFormat_1.default.parse(geoJSON, onForeachGeom);\n        features.forEach(function (feature) {\n            feature.setContext(_this);\n        });\n        this.features = __spreadArray(__spreadArray([], this.features, true), features, true);\n        (_a = this === null || this === void 0 ? void 0 : this.getContext()) === null || _a === void 0 ? void 0 : _a.getEmitter().trigger(types_1.VectorActions.UPDATE);\n    };\n    /**\n     * featuresToGeoJSON - features转换成GeoJSON\n     * @return any\n     */\n    VectorSource.prototype.featuresToGeoJSON = function () {\n        return GeoJSONFormat_1.default.stringify(this.features);\n    };\n    VectorSource.prototype.setContext = function (context) {\n        this.context = context;\n    };\n    VectorSource.prototype.getContext = function () {\n        return this.context;\n    };\n    return VectorSource;\n}(adhere_util_emitter_1.default.Events));\nexports.default = VectorSource;\n"],"names":["__extends","this","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","TypeError","String","__","constructor","create","__spreadArray","to","from","pack","arguments","length","ar","i","l","slice","concat","__importDefault","mod","__esModule","default","adhere_util_emitter_1","defineProperty","exports","value","require","GeoJSONFormat_1","types_1","VectorSource","_super","features","_this","context","setFeaturesContext","forEach","feature","setContext","addFeature","hasFeatureById","getId","push","_a","getContext","getEmitter","trigger","VectorActions","UPDATE","addFeatures","filterFeatures","filter","f","addFirstFeature","unshift","insertFeature","index","splice","removeFeature","removeFeatureById","id","findIndex","clear","getFeatureById","find","getFeatures","hasFeature","indexOf","readGeoJSON","geoJSON","onForeachGeom","parse","appendGeoJSON","featuresToGeoJSON","stringify","Events"],"mappings":"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"}