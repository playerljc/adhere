{"version":3,"file":"VectorSource.js","sources":["vector/VectorSource.js"],"sourcesContent":["var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        if (typeof b !== \"function\" && b !== null)\r\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\r\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\r\n        if (ar || !(i in from)) {\r\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\r\n            ar[i] = from[i];\r\n        }\r\n    }\r\n    return to.concat(ar || Array.prototype.slice.call(from));\r\n};\r\nimport Emitter from '@baifendian/adhere-util-emitter';\r\nimport GeoJSONFormat from './format/GeoJSONFormat';\r\nimport { VectorActions } from './types';\r\n/**\r\n * VectorSource\r\n * @class VectorSource\r\n * @classdesc VectorLayer的数据源\r\n */\r\nvar VectorSource = /** @class */ (function (_super) {\r\n    __extends(VectorSource, _super);\r\n    function VectorSource(features) {\r\n        var _this = _super.call(this) || this;\r\n        _this.context = null;\r\n        _this.features = [];\r\n        _this.features = features;\r\n        _this.setFeaturesContext();\r\n        return _this;\r\n    }\r\n    VectorSource.prototype.setFeaturesContext = function () {\r\n        var _this = this;\r\n        this.features.forEach(function (feature) {\r\n            feature.setContext(_this);\r\n        });\r\n    };\r\n    VectorSource.prototype.addFeature = function (feature) {\r\n        var _a;\r\n        if (this.hasFeatureById(feature.getId()))\r\n            return;\r\n        this.features.push(feature);\r\n        this.setFeaturesContext();\r\n        (_a = this === null || this === void 0 ? void 0 : this.getContext()) === null || _a === void 0 ? void 0 : _a.getEmitter().trigger(VectorActions.UPDATE);\r\n    };\r\n    VectorSource.prototype.addFeatures = function (features) {\r\n        var _this = this;\r\n        var _a;\r\n        var filterFeatures = features.filter(function (f) { return !_this.hasFeatureById(f.getId()); });\r\n        this.features = __spreadArray(__spreadArray([], this.features, true), filterFeatures, true);\r\n        this.setFeaturesContext();\r\n        (_a = this === null || this === void 0 ? void 0 : this.getContext()) === null || _a === void 0 ? void 0 : _a.getEmitter().trigger(VectorActions.UPDATE);\r\n    };\r\n    VectorSource.prototype.addFirstFeature = function (feature) {\r\n        var _a;\r\n        if (this.hasFeatureById(feature.getId()))\r\n            return;\r\n        this.features.unshift(feature);\r\n        (_a = this === null || this === void 0 ? void 0 : this.getContext()) === null || _a === void 0 ? void 0 : _a.getEmitter().trigger(VectorActions.UPDATE);\r\n    };\r\n    VectorSource.prototype.insertFeature = function (feature, index) {\r\n        var _a;\r\n        if (this.hasFeatureById(feature.getId()))\r\n            return;\r\n        this.features.splice(index, 0, feature);\r\n        this.setFeaturesContext();\r\n        (_a = this === null || this === void 0 ? void 0 : this.getContext()) === null || _a === void 0 ? void 0 : _a.getEmitter().trigger(VectorActions.UPDATE);\r\n    };\r\n    VectorSource.prototype.removeFeature = function (feature) {\r\n        this.removeFeatureById(feature.getId());\r\n    };\r\n    VectorSource.prototype.removeFeatureById = function (id) {\r\n        var _a;\r\n        if (!this.hasFeatureById(id))\r\n            return;\r\n        var index = this.features.findIndex(function (f) { return f.getId() === id; });\r\n        this.features.splice(index, 1);\r\n        (_a = this === null || this === void 0 ? void 0 : this.getContext()) === null || _a === void 0 ? void 0 : _a.getEmitter().trigger(VectorActions.UPDATE);\r\n    };\r\n    VectorSource.prototype.clear = function () {\r\n        var _a;\r\n        this.features = [];\r\n        (_a = this === null || this === void 0 ? void 0 : this.getContext()) === null || _a === void 0 ? void 0 : _a.getEmitter().trigger(VectorActions.UPDATE);\r\n    };\r\n    VectorSource.prototype.getFeatureById = function (id) {\r\n        // @ts-ignore\r\n        return this.features.find(function (f) { return f.getId() === id; });\r\n    };\r\n    VectorSource.prototype.getFeatures = function () {\r\n        return __spreadArray([], this.features, true);\r\n    };\r\n    VectorSource.prototype.hasFeature = function (feature) {\r\n        return this.features.indexOf(feature) !== -1;\r\n    };\r\n    VectorSource.prototype.hasFeatureById = function (id) {\r\n        return !!this.features.find(function (f) { return f.getId() === id; });\r\n    };\r\n    /**\r\n     * readGeoJSON - 读取GeoJSON数据转换成features\r\n     * @param geoJSON\r\n     * @param onForeachGeom\r\n     * @return void\r\n     */\r\n    VectorSource.prototype.readGeoJSON = function (geoJSON, onForeachGeom) {\r\n        var _this = this;\r\n        var _a;\r\n        this.features = GeoJSONFormat.parse(geoJSON, onForeachGeom);\r\n        this.features.forEach(function (feature) {\r\n            feature.setContext(_this);\r\n        });\r\n        (_a = this === null || this === void 0 ? void 0 : this.getContext()) === null || _a === void 0 ? void 0 : _a.getEmitter().trigger(VectorActions.UPDATE);\r\n    };\r\n    /**\r\n     * appendGeoJSON - 向画布追加GeoJSON的数据\r\n     * @param geoJSON\r\n     * @param onForeachGeom\r\n     */\r\n    VectorSource.prototype.appendGeoJSON = function (geoJSON, onForeachGeom) {\r\n        var _this = this;\r\n        var _a;\r\n        var features = GeoJSONFormat.parse(geoJSON, onForeachGeom);\r\n        features.forEach(function (feature) {\r\n            feature.setContext(_this);\r\n        });\r\n        this.features = __spreadArray(__spreadArray([], this.features, true), features, true);\r\n        (_a = this === null || this === void 0 ? void 0 : this.getContext()) === null || _a === void 0 ? void 0 : _a.getEmitter().trigger(VectorActions.UPDATE);\r\n    };\r\n    /**\r\n     * featuresToGeoJSON - features转换成GeoJSON\r\n     * @return any\r\n     */\r\n    VectorSource.prototype.featuresToGeoJSON = function () {\r\n        return GeoJSONFormat.stringify(this.features);\r\n    };\r\n    VectorSource.prototype.setContext = function (context) {\r\n        this.context = context;\r\n    };\r\n    VectorSource.prototype.getContext = function () {\r\n        return this.context;\r\n    };\r\n    return VectorSource;\r\n}(Emitter.Events));\r\nexport default VectorSource;\r\n"],"names":["__extends","this","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","TypeError","String","__","constructor","create","__spreadArray","to","from","pack","arguments","length","ar","i","l","slice","concat","Emitter","GeoJSONFormat","VectorActions","VectorSource","_super","features","_this","context","setFeaturesContext","forEach","feature","setContext","addFeature","hasFeatureById","getId","push","_a","getContext","getEmitter","trigger","UPDATE","addFeatures","filterFeatures","filter","f","addFirstFeature","unshift","insertFeature","index","splice","removeFeature","removeFeatureById","id","findIndex","clear","getFeatureById","find","getFeatures","hasFeature","indexOf","readGeoJSON","geoJSON","onForeachGeom","parse","appendGeoJSON","featuresToGeoJSON","stringify","Events"],"mappings":"AAAA,IAAIA,UAAaC,MAAQA,KAAKD,WAAc,WACxC,IAAIE,EAAgB,SAAUC,EAAGC,GAI7B,OAHAF,EAAgBG,OAAOC,gBAClB,CAAEC,UAAW,EAAG,YAAaC,OAAS,SAAUL,EAAGC,GAAKD,EAAEI,UAAYH,CAAG,GAC1E,SAAUD,EAAGC,GAAK,IAAK,IAAIK,KAAKL,EAAOC,OAAOK,UAAUC,eAAeC,KAAKR,EAAGK,CAAC,IAAGN,EAAEM,GAAKL,EAAEK,GAAI,GAC/EN,EAAGC,CAAC,CAC7B,EACA,OAAO,SAAUD,EAAGC,GAChB,GAAiB,YAAb,OAAOA,GAA0B,OAANA,EAC3B,MAAM,IAAIS,UAAU,uBAAyBC,OAAOV,CAAC,EAAI,+BAA+B,EAE5F,SAASW,IAAOd,KAAKe,YAAcb,CAAG,CADtCD,EAAcC,EAAGC,CAAC,EAElBD,EAAEO,UAAkB,OAANN,EAAaC,OAAOY,OAAOb,CAAC,GAAKW,EAAGL,UAAYN,EAAEM,UAAW,IAAIK,EACnF,CACH,EAAE,EACCG,cAAiBjB,MAAQA,KAAKiB,eAAkB,SAAUC,EAAIC,EAAMC,GACpE,GAAIA,GAA6B,IAArBC,UAAUC,OAAc,IAAK,IAA4BC,EAAxBC,EAAI,EAAGC,EAAIN,EAAKG,OAAYE,EAAIC,EAAGD,CAAC,GACzED,CAAAA,GAAQC,KAAKL,KACJI,EAAJA,GAAShB,MAAME,UAAUiB,MAAMf,KAAKQ,EAAM,EAAGK,CAAC,GAChDA,GAAKL,EAAKK,IAGrB,OAAON,EAAGS,OAAOJ,GAAMhB,MAAME,UAAUiB,MAAMf,KAAKQ,CAAI,CAAC,CAC3D,SACOS,YAAa,yCACbC,kBAAmB,gCACjBC,aAA8B,KAAT,UAM9B,IAAIC,aAA8B,SAAUC,GAExC,SAASD,EAAaE,GAClB,IAAIC,EAAQF,EAAOrB,KAAKX,IAAI,GAAKA,KAKjC,OAJAkC,EAAMC,QAAU,KAChBD,EAAMD,SAAW,GACjBC,EAAMD,SAAWA,EACjBC,EAAME,mBAAmB,EAClBF,CACX,CA8GA,OAtHAnC,UAAUgC,EAAcC,CAAM,EAS9BD,EAAatB,UAAU2B,mBAAqB,WACxC,IAAIF,EAAQlC,KACZA,KAAKiC,SAASI,QAAQ,SAAUC,GAC5BA,EAAQC,WAAWL,CAAK,CAC5B,CAAC,CACL,EACAH,EAAatB,UAAU+B,WAAa,SAAUF,GAEtCtC,KAAKyC,eAAeH,EAAQI,MAAM,CAAC,IAEvC1C,KAAKiC,SAASU,KAAKL,CAAO,EAC1BtC,KAAKoC,mBAAmB,EACxB,OAACQ,EAAK5C,MAAAA,KAAmC,KAAA,EAASA,KAAK6C,WAAW,IAAwCD,EAAGE,WAAW,EAAEC,QAAQjB,cAAckB,MAAM,EAC1J,EACAjB,EAAatB,UAAUwC,YAAc,SAAUhB,GAC3C,IAAIC,EAAQlC,KAERkD,EAAiBjB,EAASkB,OAAO,SAAUC,GAAK,MAAO,CAAClB,EAAMO,eAAeW,EAAEV,MAAM,CAAC,CAAG,CAAC,EAC9F1C,KAAKiC,SAAWhB,cAAcA,cAAc,GAAIjB,KAAKiC,SAAU,CAAA,CAAI,EAAGiB,EAAgB,CAAA,CAAI,EAC1FlD,KAAKoC,mBAAmB,EACxB,OAACQ,EAAK5C,MAAAA,KAAmC,KAAA,EAASA,KAAK6C,WAAW,IAAwCD,EAAGE,WAAW,EAAEC,QAAQjB,cAAckB,MAAM,CAC1J,EACAjB,EAAatB,UAAU4C,gBAAkB,SAAUf,GAE3CtC,KAAKyC,eAAeH,EAAQI,MAAM,CAAC,IAEvC1C,KAAKiC,SAASqB,QAAQhB,CAAO,EAC7B,OAACM,EAAK5C,MAAAA,KAAmC,KAAA,EAASA,KAAK6C,WAAW,IAAwCD,EAAGE,WAAW,EAAEC,QAAQjB,cAAckB,MAAM,EAC1J,EACAjB,EAAatB,UAAU8C,cAAgB,SAAUjB,EAASkB,GAElDxD,KAAKyC,eAAeH,EAAQI,MAAM,CAAC,IAEvC1C,KAAKiC,SAASwB,OAAOD,EAAO,EAAGlB,CAAO,EACtCtC,KAAKoC,mBAAmB,EACxB,OAACQ,EAAK5C,MAAAA,KAAmC,KAAA,EAASA,KAAK6C,WAAW,IAAwCD,EAAGE,WAAW,EAAEC,QAAQjB,cAAckB,MAAM,EAC1J,EACAjB,EAAatB,UAAUiD,cAAgB,SAAUpB,GAC7CtC,KAAK2D,kBAAkBrB,EAAQI,MAAM,CAAC,CAC1C,EACAX,EAAatB,UAAUkD,kBAAoB,SAAUC,GACjD,IAGIJ,EAFCxD,KAAKyC,eAAemB,CAAE,IAEvBJ,EAAQxD,KAAKiC,SAAS4B,UAAU,SAAUT,GAAK,OAAOA,EAAEV,MAAM,IAAMkB,CAAI,CAAC,EAC7E5D,KAAKiC,SAASwB,OAAOD,EAAO,CAAC,EAC7B,OAACZ,EAAK5C,MAAAA,KAAmC,KAAA,EAASA,KAAK6C,WAAW,IAAwCD,EAAGE,WAAW,EAAEC,QAAQjB,cAAckB,MAAM,EAC1J,EACAjB,EAAatB,UAAUqD,MAAQ,WAC3B,IAAIlB,EACJ5C,KAAKiC,SAAW,GAChB,OAACW,EAAK5C,MAAAA,KAAmC,KAAA,EAASA,KAAK6C,WAAW,IAAwCD,EAAGE,WAAW,EAAEC,QAAQjB,cAAckB,MAAM,CAC1J,EACAjB,EAAatB,UAAUsD,eAAiB,SAAUH,GAE9C,OAAO5D,KAAKiC,SAAS+B,KAAK,SAAUZ,GAAK,OAAOA,EAAEV,MAAM,IAAMkB,CAAI,CAAC,CACvE,EACA7B,EAAatB,UAAUwD,YAAc,WACjC,OAAOhD,cAAc,GAAIjB,KAAKiC,SAAU,CAAA,CAAI,CAChD,EACAF,EAAatB,UAAUyD,WAAa,SAAU5B,GAC1C,MAA0C,CAAC,IAApCtC,KAAKiC,SAASkC,QAAQ7B,CAAO,CACxC,EACAP,EAAatB,UAAUgC,eAAiB,SAAUmB,GAC9C,MAAO,CAAC,CAAC5D,KAAKiC,SAAS+B,KAAK,SAAUZ,GAAK,OAAOA,EAAEV,MAAM,IAAMkB,CAAI,CAAC,CACzE,EAOA7B,EAAatB,UAAU2D,YAAc,SAAUC,EAASC,GACpD,IAAIpC,EAAQlC,KAEZA,KAAKiC,SAAWJ,cAAc0C,MAAMF,EAASC,CAAa,EAC1DtE,KAAKiC,SAASI,QAAQ,SAAUC,GAC5BA,EAAQC,WAAWL,CAAK,CAC5B,CAAC,EACD,OAACU,EAAK5C,MAAAA,KAAmC,KAAA,EAASA,KAAK6C,WAAW,IAAwCD,EAAGE,WAAW,EAAEC,QAAQjB,cAAckB,MAAM,CAC1J,EAMAjB,EAAatB,UAAU+D,cAAgB,SAAUH,EAASC,GACtD,IAAIpC,EAAQlC,KAERiC,EAAWJ,cAAc0C,MAAMF,EAASC,CAAa,EACzDrC,EAASI,QAAQ,SAAUC,GACvBA,EAAQC,WAAWL,CAAK,CAC5B,CAAC,EACDlC,KAAKiC,SAAWhB,cAAcA,cAAc,GAAIjB,KAAKiC,SAAU,CAAA,CAAI,EAAGA,EAAU,CAAA,CAAI,EACpF,OAACW,EAAK5C,MAAAA,KAAmC,KAAA,EAASA,KAAK6C,WAAW,IAAwCD,EAAGE,WAAW,EAAEC,QAAQjB,cAAckB,MAAM,CAC1J,EAKAjB,EAAatB,UAAUgE,kBAAoB,WACvC,OAAO5C,cAAc6C,UAAU1E,KAAKiC,QAAQ,CAChD,EACAF,EAAatB,UAAU8B,WAAa,SAAUJ,GAC1CnC,KAAKmC,QAAUA,CACnB,EACAJ,EAAatB,UAAUoC,WAAa,WAChC,OAAO7C,KAAKmC,OAChB,EACOJ,CACX,EAAEH,QAAQ+C,MAAO,iBACF5C"}