{"version":3,"file":"InteractionLayer.js","sources":["vector/interaction/InteractionLayer.js"],"sourcesContent":["\"use strict\";\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar adhere_util_emitter_1 = __importDefault(require(\"@baifendian/adhere-util-emitter\"));\r\nvar adhere_util_1 = __importDefault(require(\"@baifendian/adhere-util\"));\r\nvar types_1 = require(\"./types\");\r\nvar PolygonDrawAction_1 = __importDefault(require(\"./draw/PolygonDrawAction\"));\r\nvar CircleDrawAction_1 = __importDefault(require(\"./draw/CircleDrawAction\"));\r\nvar RectangleDrawAction_1 = __importDefault(require(\"./draw/RectangleDrawAction\"));\r\nvar TriangleDrawAction_1 = __importDefault(require(\"./draw/TriangleDrawAction\"));\r\nvar DiamondDrawAction_1 = __importDefault(require(\"./draw/DiamondDrawAction\"));\r\nvar StartDrawAction_1 = __importDefault(require(\"./draw/StartDrawAction\"));\r\nvar FreeDrawAction_1 = __importDefault(require(\"./draw/FreeDrawAction\"));\r\nvar util_1 = __importDefault(require(\"../../util\"));\r\nvar DistanceDrawAction_1 = __importDefault(require(\"./draw/DistanceDrawAction\"));\r\nvar selectorPrefix = 'adhere-ui-interactionlayer';\r\nvar zIndex = 19999;\r\n/**\r\n * InteractionLayer\r\n * @class\r\n * @classdesc - InteractionLayer\r\n */\r\nvar InteractionLayer = /** @class */ (function (_super) {\r\n    __extends(InteractionLayer, _super);\r\n    /**\r\n     * constructor\r\n     * @param map\r\n     * @param defaultData: IActionData[] - 缺省的ActionData数据\r\n     * @param listeners: IListeners - 缺省的事件注册对象\r\n     */\r\n    // @ts-ignore\r\n    function InteractionLayer(map, defaultData, listeners) {\r\n        var _this = this;\r\n        // @ts-ignore\r\n        _this.update = _this.update.bind(_this);\r\n        _this = _super.call(this, {\r\n            // @ts-ignore\r\n            update: _this.update,\r\n            paneName: 'markerPane',\r\n            zIndex: zIndex,\r\n        }) || this;\r\n        // map\r\n        _this.map = null;\r\n        // 父元素\r\n        _this.el = null;\r\n        // 注册的事件对象\r\n        _this.listeners = null;\r\n        // 当前的Action\r\n        _this.curAction = null;\r\n        // 当前的canvas元素\r\n        _this.canvasEl = null;\r\n        // 当前的ctx对象\r\n        _this.ctx = null;\r\n        // 辅助的canvas元素\r\n        _this.assistCanvasEl = null;\r\n        // 辅助的ctx对象\r\n        _this.assistCtx = null;\r\n        // canvas上的所有数据\r\n        _this.canvasData = [];\r\n        _this.emitter = new adhere_util_emitter_1.default.Events();\r\n        _this.isLoad = false;\r\n        // canvas的属性监控\r\n        _this.canvasObserver = null;\r\n        // @ts-ignore\r\n        _this.typeActionMap = new Map([\r\n            [types_1.SelectType.Polygon, PolygonDrawAction_1.default],\r\n            [types_1.SelectType.Distance, DistanceDrawAction_1.default],\r\n            [types_1.SelectType.Circle, CircleDrawAction_1.default],\r\n            [types_1.SelectType.Rectangle, RectangleDrawAction_1.default],\r\n            [types_1.SelectType.Triangle, TriangleDrawAction_1.default],\r\n            [types_1.SelectType.Diamond, DiamondDrawAction_1.default],\r\n            [types_1.SelectType.Start, StartDrawAction_1.default],\r\n            [types_1.SelectType.Free, FreeDrawAction_1.default],\r\n        ]);\r\n        _this.map = map;\r\n        _this.listeners = listeners;\r\n        defaultData && (_this.canvasData = defaultData);\r\n        // 初始化Listeners\r\n        _this.initListeners();\r\n        return _this;\r\n    }\r\n    InteractionLayer.prototype.update = function () {\r\n        if (!this.isLoad) {\r\n            // 初始化Canvas\r\n            this.initCanvas();\r\n            // 初始化Events\r\n            this.initEvents();\r\n            this.clearDraw();\r\n            this.clearAssistDraw();\r\n            this.drawHistoryData();\r\n            this.isLoad = true;\r\n        }\r\n        else {\r\n            if (this.curAction) {\r\n                this.curAction.destroy();\r\n            }\r\n            this.clearDraw();\r\n            this.clearAssistDraw();\r\n            this.drawHistoryData();\r\n        }\r\n    };\r\n    /**\r\n     * initListeners\r\n     * @description 注册用户的listeners\r\n     */\r\n    InteractionLayer.prototype.initListeners = function () {\r\n        var _this = this;\r\n        var listeners = this.listeners;\r\n        if (!listeners)\r\n            return;\r\n        var keys = Object.keys(listeners);\r\n        keys.forEach(function (key) {\r\n            _this.emitter.on(key, listeners[key]);\r\n        });\r\n    };\r\n    /**\r\n     * initEvents\r\n     */\r\n    InteractionLayer.prototype.initEvents = function () {\r\n        var _this = this;\r\n        /**\r\n         * 点击了el元素\r\n         */\r\n        this.el.addEventListener('mouseup', function (e) {\r\n            if (!e)\r\n                return;\r\n            if (e.detail >= 2)\r\n                return;\r\n            // 查看point命中了HistoryData中的哪一项\r\n            var historyData = _this.getHistoryData();\r\n            var pixel = adhere_util_1.default.clientToCtxPoint({\r\n                event: e,\r\n                rect: _this.getCanvasEl().getBoundingClientRect() /*(this.el as HTMLDivElement).getBoundingClientRect()*/,\r\n            });\r\n            var finsEntitys = [];\r\n            for (var i = 0; i < historyData.length; i++) {\r\n                var data = historyData[i];\r\n                var action = _this.typeActionMap.get(data.type);\r\n                var isIn = false;\r\n                if ('booleanPointInData' in action) {\r\n                    isIn = action === null || action === void 0 ? void 0 : action.booleanPointInData(_this, pixel, data);\r\n                    if (isIn) {\r\n                        finsEntitys.push({\r\n                            index: i,\r\n                            data: data,\r\n                        });\r\n                    }\r\n                }\r\n            }\r\n            if (finsEntitys.length) {\r\n                // console.log('点击了节点');\r\n                // 原始数据-需要转换成坐标数据\r\n                _this.emitter.trigger(types_1.InteractionLayerActions.CanvasClickGeometry, JSON.parse(JSON.stringify(finsEntitys[finsEntitys.length - 1].data)));\r\n            }\r\n            else {\r\n                if (historyData.length) {\r\n                    // console.log('点击拉画布');\r\n                    _this.emitter.trigger(types_1.InteractionLayerActions.CanvasClickEmpty);\r\n                }\r\n            }\r\n        });\r\n    };\r\n    /**\r\n     * initCanvas - 初始化Canvas\r\n     */\r\n    InteractionLayer.prototype.initCanvas = function () {\r\n        var _this = this;\r\n        // @ts-ignore\r\n        this.el = this.canvas.parentElement;\r\n        // 创建一个canvas\r\n        // @ts-ignore\r\n        this.canvasEl = this.canvas;\r\n        // @ts-ignore\r\n        this.el.style.width = this.canvasEl.width + \"px\";\r\n        // @ts-ignore\r\n        this.el.style.height = this.canvasEl.height + \"px\";\r\n        // @ts-ignore\r\n        this.canvasEl.className = \"\" + selectorPrefix;\r\n        // @ts-ignore\r\n        this.ctx = this.canvasEl.getContext('2d');\r\n        // 创建一个assistCanvas\r\n        this.assistCanvasEl = document.createElement('canvas');\r\n        this.assistCanvasEl.className = selectorPrefix + \"-assist\";\r\n        // @ts-ignore\r\n        this.assistCanvasEl.style.zIndex = \"\" + (parseInt(this.canvasEl.style.zIndex) - 1);\r\n        // @ts-ignore\r\n        this.assistCanvasEl.width = this.canvasEl.width;\r\n        // @ts-ignore\r\n        this.assistCanvasEl.height = this.canvasEl.height;\r\n        this.assistCtx = this.assistCanvasEl.getContext('2d');\r\n        // 创建一个观察器实例并传入回调函数\r\n        this.canvasObserver = new MutationObserver(function (mutationsList, observer) {\r\n            for (var _i = 0, mutationsList_1 = mutationsList; _i < mutationsList_1.length; _i++) {\r\n                var mutation = mutationsList_1[_i];\r\n                if (mutation.type === 'attributes' && mutation.attributeName === 'style') {\r\n                    _this.assistCanvasEl.style.left = _this.canvasEl.style.left;\r\n                    _this.assistCanvasEl.style.top = _this.canvasEl.style.top;\r\n                }\r\n            }\r\n        });\r\n        // 以上述配置开始观察目标节点\r\n        this.canvasObserver.observe(this.canvasEl, {\r\n            attributes: true,\r\n        });\r\n        // @ts-ignore\r\n        this.el.appendChild(this.assistCanvasEl);\r\n        // 触发canvasMount事件\r\n        this.emitter.trigger(types_1.InteractionLayerActions.CanvasMount);\r\n    };\r\n    InteractionLayer.prototype.enableMap = function () {\r\n        this.map.enableDoubleClickZoom();\r\n        // this.map.enableInertialDragging();\r\n        // this.map.enableDragging();\r\n        // this.map.enableScrollWheelZoom();\r\n        // this.map.enableContinuousZoom();\r\n    };\r\n    InteractionLayer.prototype.disableMap = function () {\r\n        this.map.disableDoubleClickZoom();\r\n        // this.map.disableInertialDragging();\r\n        // this.map.disableDragging();\r\n        // this.map.disableScrollWheelZoom();\r\n        // this.map.disableContinuousZoom();\r\n    };\r\n    /**\r\n     * pixelToPoint\r\n     * @param pixel\r\n     * @return IPoint\r\n     */\r\n    InteractionLayer.prototype.pixelToPoint = function (pixel) {\r\n        var point = this.map.pixelToPoint(pixel);\r\n        return {\r\n            x: point.lng,\r\n            y: point.lat,\r\n        };\r\n    };\r\n    /**\r\n     * pointToPixel\r\n     * @param point\r\n     */\r\n    InteractionLayer.prototype.pointToPixel = function (point) {\r\n        // @ts-ignore\r\n        return this.map.pointToPixel(new BMap.Point(point.x, point.y));\r\n    };\r\n    /**\r\n     * distanceToActual - 图上距离转换成实际距离\r\n     * @param distance 图上距离\r\n     * @return number 实际距离\r\n     */\r\n    InteractionLayer.prototype.distanceToActual = function (distance) {\r\n        var scale = util_1.default.getScale(this.map);\r\n        return distance / scale;\r\n    };\r\n    /**\r\n     * actualToDistance - 实际距离转换成图上距离\r\n     * @param actual\r\n     */\r\n    InteractionLayer.prototype.actualToDistance = function (actual) {\r\n        var scale = util_1.default.getScale(this.map);\r\n        return scale * actual;\r\n    };\r\n    /**\r\n     * getCtx\r\n     * @return CanvasRenderingContext2D | null\r\n     */\r\n    InteractionLayer.prototype.getCtx = function () {\r\n        return this.ctx;\r\n    };\r\n    /**\r\n     * getCanvasEl\r\n     * @return HTMLCanvasElement | null\r\n     */\r\n    InteractionLayer.prototype.getCanvasEl = function () {\r\n        return this.canvasEl;\r\n    };\r\n    /**\r\n     * getAssistCanvasEl\r\n     */\r\n    InteractionLayer.prototype.getAssistCanvasEl = function () {\r\n        return this.assistCanvasEl;\r\n    };\r\n    InteractionLayer.prototype.getAssistCtx = function () {\r\n        return this.assistCtx;\r\n    };\r\n    /**\r\n     * getWidth\r\n     * @return number\r\n     */\r\n    InteractionLayer.prototype.getWidth = function () {\r\n        var _a;\r\n        // @ts-ignore\r\n        return (_a = this === null || this === void 0 ? void 0 : this.getCanvasEl()) === null || _a === void 0 ? void 0 : _a.width;\r\n    };\r\n    /**\r\n     * getHeight\r\n     * @return number\r\n     */\r\n    InteractionLayer.prototype.getHeight = function () {\r\n        var _a;\r\n        // @ts-ignore\r\n        return (_a = this === null || this === void 0 ? void 0 : this.getCanvasEl()) === null || _a === void 0 ? void 0 : _a.height;\r\n    };\r\n    /**\r\n     * addHistoryData\r\n     * @description - 添加一个ActionData到canvasData中\r\n     * @param data\r\n     * @return void\r\n     */\r\n    InteractionLayer.prototype.addHistoryData = function (data) {\r\n        this.canvasData.push(data);\r\n    };\r\n    /**\r\n     * removeHistoryDataById - 删除一个ActionData中的数据\r\n     * @param actionDataId\r\n     * @return IActionData[]\r\n     */\r\n    InteractionLayer.prototype.removeHistoryDataById = function (actionDataId) {\r\n        var index = this.canvasData.findIndex(function (data) { return data.id === actionDataId; });\r\n        if (index === -1)\r\n            return [];\r\n        return this.canvasData.splice(index, 1);\r\n    };\r\n    /**\r\n     * drawHistoryData - 绘制历史数据\r\n     * @return void\r\n     */\r\n    InteractionLayer.prototype.drawHistoryData = function () {\r\n        var _this = this;\r\n        this.canvasData.forEach(function (data) {\r\n            var ctx = _this.ctx;\r\n            if (!ctx || !data)\r\n                return;\r\n            if (data.style) {\r\n                // 设置上下文属性\r\n                ctx.lineWidth = data.style.lineWidth;\r\n                ctx.lineJoin = data.style.lineJoin;\r\n                ctx.lineCap = data.style.lineCap;\r\n                ctx.setLineDash(data.style.lineDash);\r\n                ctx.lineDashOffset = data.style.lineDashOffset;\r\n                ctx.strokeStyle = data.style.strokeStyle;\r\n                ctx.fillStyle = data.style.fillStyle;\r\n            }\r\n            // 绘制指定类型的路径\r\n            // @ts-ignore\r\n            var action = _this.typeActionMap.get(data.type);\r\n            // @ts-ignore\r\n            action === null || action === void 0 ? void 0 : action.drawHistoryPath(_this, ctx, data.data);\r\n            // // 描边\r\n            // ctx.stroke();\r\n            // // 填充\r\n            // ctx.fill();\r\n        });\r\n    };\r\n    /**\r\n     * getHistoryDataById\r\n     * @param id\r\n     * @return IActionData | null | undefined\r\n     */\r\n    InteractionLayer.prototype.getHistoryDataById = function (id) {\r\n        return this.canvasData.find(function (data) { return data.id === id; });\r\n    };\r\n    /**\r\n     * getHistoryData\r\n     * @return IActionData []\r\n     */\r\n    InteractionLayer.prototype.getHistoryData = function () {\r\n        return __spreadArrays(this.canvasData);\r\n    };\r\n    /**\r\n     * setHistoryData\r\n     * @param data\r\n     */\r\n    InteractionLayer.prototype.setHistoryData = function (data) {\r\n        this.canvasData = data;\r\n    };\r\n    /**\r\n     * changeAction - 切换一个Action\r\n     * @param action - action对象\r\n     * @return void\r\n     */\r\n    InteractionLayer.prototype.changeAction = function (action) {\r\n        // 如果当前和传入一致则跳过\r\n        if (action === this.curAction)\r\n            return;\r\n        // 只有是未开始才能切换\r\n        if (action && action.getStatus() !== types_1.ActionStatus.UnStart)\r\n            return;\r\n        this.disableMap();\r\n        if (this.curAction) {\r\n            this.curAction.destroy();\r\n        }\r\n        // @ts-ignore\r\n        action === null || action === void 0 ? void 0 : action.setContext(this);\r\n        this.curAction = action;\r\n    };\r\n    /**\r\n     * getCurAction\r\n     * @return IAction | null\r\n     */\r\n    InteractionLayer.prototype.getCurAction = function () {\r\n        return this.curAction;\r\n    };\r\n    /**\r\n     * start - 开始\r\n     * @param style\r\n     * @return void\r\n     */\r\n    InteractionLayer.prototype.start = function (style) {\r\n        if (!this.curAction)\r\n            return;\r\n        this.curAction.start(style);\r\n    };\r\n    /**\r\n     * end - 结束\r\n     * @return void\r\n     */\r\n    InteractionLayer.prototype.end = function () {\r\n        if (!this.curAction)\r\n            return;\r\n        this.curAction.end();\r\n    };\r\n    /**\r\n     * clear\r\n     */\r\n    InteractionLayer.prototype.clearDraw = function () {\r\n        var ctx = this.ctx;\r\n        if (!ctx)\r\n            return;\r\n        ctx.clearRect(0, 0, this.getWidth(), this.getHeight());\r\n    };\r\n    /**\r\n     * clearAssistDraw\r\n     * @description 清除assist的canvas\r\n     */\r\n    InteractionLayer.prototype.clearAssistDraw = function () {\r\n        var assistCtx = this.assistCtx;\r\n        if (!assistCtx)\r\n            return;\r\n        assistCtx.clearRect(0, 0, this.getWidth(), this.getHeight());\r\n    };\r\n    /**\r\n     * setFrontCanvas\r\n     * @description 置顶\r\n     * @param canvasEl\r\n     */\r\n    InteractionLayer.prototype.setFrontCanvas = function (canvasEl) {\r\n        canvasEl.style.zIndex = \"\" + (zIndex + 1);\r\n    };\r\n    /**\r\n     * setBackCanvas\r\n     * @description 置底\r\n     * @param canvasEl\r\n     */\r\n    InteractionLayer.prototype.setBackCanvas = function (canvasEl) {\r\n        canvasEl.style.zIndex = \"\" + (zIndex - 1);\r\n    };\r\n    /**\r\n     * destroy - 销毁\r\n     * @return void\r\n     */\r\n    InteractionLayer.prototype.destroy = function () {\r\n        if (this.curAction) {\r\n            this.curAction.destroy();\r\n        }\r\n        // 之后，可停止观察\r\n        if (this.canvasObserver) {\r\n            this.canvasObserver.disconnect();\r\n        }\r\n    };\r\n    /**\r\n     * getMap\r\n     * @return any\r\n     */\r\n    InteractionLayer.prototype.getMap = function () {\r\n        return this.map;\r\n    };\r\n    return InteractionLayer;\r\n}(BMap.CanvasLayer));\r\nexports.default = InteractionLayer;\r\n"],"names":["__extends","this","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","__spreadArrays","s","i","il","arguments","length","r","k","a","j","jl","__importDefault","mod","__esModule","default","defineProperty","exports","value","adhere_util_emitter_1","require","adhere_util_1","types_1","PolygonDrawAction_1","CircleDrawAction_1","RectangleDrawAction_1","TriangleDrawAction_1","DiamondDrawAction_1","StartDrawAction_1","FreeDrawAction_1","util_1","DistanceDrawAction_1","selectorPrefix","zIndex","InteractionLayer","_super","map","defaultData","listeners","_this","update","bind","call","paneName","el","curAction","canvasEl","ctx","assistCanvasEl","assistCtx","canvasData","emitter","Events","isLoad","canvasObserver","typeActionMap","Map","SelectType","Polygon","Distance","Circle","Rectangle","Triangle","Diamond","Start","Free","initListeners","destroy","clearDraw","clearAssistDraw","drawHistoryData","initCanvas","initEvents","keys","forEach","key","on","addEventListener","e","detail","historyData","getHistoryData","pixel","clientToCtxPoint","event","rect","getCanvasEl","getBoundingClientRect","finsEntitys","data","action","get","type","booleanPointInData","push","index","trigger","InteractionLayerActions","CanvasClickGeometry","JSON","parse","stringify","CanvasClickEmpty","canvas","parentElement","style","width","height","className","getContext","document","createElement","parseInt","MutationObserver","mutationsList","observer","_i","mutationsList_1","mutation","attributeName","left","top","observe","attributes","appendChild","CanvasMount","enableMap","enableDoubleClickZoom","disableMap","disableDoubleClickZoom","pixelToPoint","point","x","lng","y","lat","pointToPixel","BMap","Point","distanceToActual","distance","getScale","actualToDistance","actual","getCtx","getAssistCanvasEl","getAssistCtx","getWidth","_a","getHeight","addHistoryData","removeHistoryDataById","actionDataId","findIndex","id","splice","lineWidth","lineJoin","lineCap","setLineDash","lineDash","lineDashOffset","strokeStyle","fillStyle","drawHistoryPath","getHistoryDataById","find","setHistoryData","changeAction","getStatus","ActionStatus","UnStart","setContext","getCurAction","start","end","clearRect","setFrontCanvas","setBackCanvas","disconnect","getMap","CanvasLayer"],"mappings":"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"}