{"version":3,"file":"InteractionLayer.js","sources":["vector/interaction/InteractionLayer.js"],"sourcesContent":["\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar adhere_util_1 = __importDefault(require(\"@baifendian/adhere-util\"));\nvar adhere_util_emitter_1 = __importDefault(require(\"@baifendian/adhere-util-emitter\"));\nvar util_1 = __importDefault(require(\"../../util\"));\nvar CircleDrawAction_1 = __importDefault(require(\"./draw/CircleDrawAction\"));\nvar DiamondDrawAction_1 = __importDefault(require(\"./draw/DiamondDrawAction\"));\nvar DistanceDrawAction_1 = __importDefault(require(\"./draw/DistanceDrawAction\"));\nvar FreeDrawAction_1 = __importDefault(require(\"./draw/FreeDrawAction\"));\nvar PolygonDrawAction_1 = __importDefault(require(\"./draw/PolygonDrawAction\"));\nvar RectangleDrawAction_1 = __importDefault(require(\"./draw/RectangleDrawAction\"));\nvar StartDrawAction_1 = __importDefault(require(\"./draw/StartDrawAction\"));\nvar TriangleDrawAction_1 = __importDefault(require(\"./draw/TriangleDrawAction\"));\nvar types_1 = require(\"./types\");\nvar selectorPrefix = 'adhere-ui-interactionlayer';\nvar zIndex = 19999;\n/**\n * InteractionLayer\n * @class\n * @classdesc - InteractionLayer\n */\nvar InteractionLayer = /** @class */ (function (_super) {\n    __extends(InteractionLayer, _super);\n    /**\n     * constructor\n     * @param map\n     * @param defaultData: IActionData[] - 缺省的ActionData数据\n     * @param listeners: IListeners - 缺省的事件注册对象\n     */\n    // @ts-ignore\n    function InteractionLayer(map, defaultData, listeners) {\n        var _this = this;\n        // @ts-ignore\n        _this.update = _this.update.bind(_this);\n        _this = _super.call(this, {\n            // @ts-ignore\n            update: _this.update,\n            paneName: 'markerPane',\n            zIndex: zIndex,\n        }) || this;\n        // map\n        _this.map = null;\n        // 父元素\n        _this.el = null;\n        // 注册的事件对象\n        _this.listeners = null;\n        // 当前的Action\n        _this.curAction = null;\n        // 当前的canvas元素\n        _this.canvasEl = null;\n        // 当前的ctx对象\n        _this.ctx = null;\n        // 辅助的canvas元素\n        _this.assistCanvasEl = null;\n        // 辅助的ctx对象\n        _this.assistCtx = null;\n        // canvas上的所有数据\n        _this.canvasData = [];\n        _this.emitter = new adhere_util_emitter_1.default.Events();\n        _this.isLoad = false;\n        // canvas的属性监控\n        _this.canvasObserver = null;\n        // @ts-ignore\n        _this.typeActionMap = new Map([\n            [types_1.SelectType.Polygon, PolygonDrawAction_1.default],\n            [types_1.SelectType.Distance, DistanceDrawAction_1.default],\n            [types_1.SelectType.Circle, CircleDrawAction_1.default],\n            [types_1.SelectType.Rectangle, RectangleDrawAction_1.default],\n            [types_1.SelectType.Triangle, TriangleDrawAction_1.default],\n            [types_1.SelectType.Diamond, DiamondDrawAction_1.default],\n            [types_1.SelectType.Start, StartDrawAction_1.default],\n            [types_1.SelectType.Free, FreeDrawAction_1.default],\n        ]);\n        _this.map = map;\n        _this.listeners = listeners;\n        defaultData && (_this.canvasData = defaultData);\n        // 初始化Listeners\n        _this.initListeners();\n        return _this;\n    }\n    InteractionLayer.prototype.update = function () {\n        if (!this.isLoad) {\n            // 初始化Canvas\n            this.initCanvas();\n            // 初始化Events\n            this.initEvents();\n            this.clearDraw();\n            this.clearAssistDraw();\n            this.drawHistoryData();\n            this.isLoad = true;\n        }\n        else {\n            if (this.curAction) {\n                this.curAction.destroy();\n            }\n            this.clearDraw();\n            this.clearAssistDraw();\n            this.drawHistoryData();\n        }\n    };\n    /**\n     * initListeners\n     * @description 注册用户的listeners\n     */\n    InteractionLayer.prototype.initListeners = function () {\n        var _this = this;\n        var listeners = this.listeners;\n        if (!listeners)\n            return;\n        var keys = Object.keys(listeners);\n        keys.forEach(function (key) {\n            _this.emitter.on(key, listeners[key]);\n        });\n    };\n    /**\n     * initEvents\n     */\n    InteractionLayer.prototype.initEvents = function () {\n        var _this = this;\n        /**\n         * 点击了el元素\n         */\n        this.el.addEventListener('mouseup', function (e) {\n            if (!e)\n                return;\n            if (e.detail >= 2)\n                return;\n            // 查看point命中了HistoryData中的哪一项\n            var historyData = _this.getHistoryData();\n            var pixel = adhere_util_1.default.clientToCtxPoint({\n                event: e,\n                rect: _this.getCanvasEl().getBoundingClientRect() /*(this.el as HTMLDivElement).getBoundingClientRect()*/,\n            });\n            var finsEntitys = [];\n            for (var i = 0; i < historyData.length; i++) {\n                var data = historyData[i];\n                var action = _this.typeActionMap.get(data.type);\n                var isIn = false;\n                if ('booleanPointInData' in action) {\n                    isIn = action === null || action === void 0 ? void 0 : action.booleanPointInData(_this, pixel, data);\n                    if (isIn) {\n                        finsEntitys.push({\n                            index: i,\n                            data: data,\n                        });\n                    }\n                }\n            }\n            if (finsEntitys.length) {\n                // console.log('点击了节点');\n                // 原始数据-需要转换成坐标数据\n                _this.emitter.trigger(types_1.InteractionLayerActions.CanvasClickGeometry, JSON.parse(JSON.stringify(finsEntitys[finsEntitys.length - 1].data)));\n            }\n            else {\n                if (historyData.length) {\n                    // console.log('点击拉画布');\n                    _this.emitter.trigger(types_1.InteractionLayerActions.CanvasClickEmpty);\n                }\n            }\n        });\n    };\n    /**\n     * initCanvas - 初始化Canvas\n     */\n    InteractionLayer.prototype.initCanvas = function () {\n        var _this = this;\n        // @ts-ignore\n        this.el = this.canvas.parentElement;\n        // 创建一个canvas\n        // @ts-ignore\n        this.canvasEl = this.canvas;\n        // @ts-ignore\n        this.el.style.width = \"\".concat(this.canvasEl.width, \"px\");\n        // @ts-ignore\n        this.el.style.height = \"\".concat(this.canvasEl.height, \"px\");\n        // @ts-ignore\n        this.canvasEl.className = \"\".concat(selectorPrefix);\n        // @ts-ignore\n        this.ctx = this.canvasEl.getContext('2d');\n        // 创建一个assistCanvas\n        this.assistCanvasEl = document.createElement('canvas');\n        this.assistCanvasEl.className = \"\".concat(selectorPrefix, \"-assist\");\n        // @ts-ignore\n        this.assistCanvasEl.style.zIndex = \"\".concat(parseInt(this.canvasEl.style.zIndex) - 1);\n        // @ts-ignore\n        this.assistCanvasEl.width = this.canvasEl.width;\n        // @ts-ignore\n        this.assistCanvasEl.height = this.canvasEl.height;\n        this.assistCtx = this.assistCanvasEl.getContext('2d');\n        // 创建一个观察器实例并传入回调函数\n        this.canvasObserver = new MutationObserver(function (mutationsList, observer) {\n            for (var _i = 0, mutationsList_1 = mutationsList; _i < mutationsList_1.length; _i++) {\n                var mutation = mutationsList_1[_i];\n                if (mutation.type === 'attributes' && mutation.attributeName === 'style') {\n                    _this.assistCanvasEl.style.left = _this.canvasEl.style.left;\n                    _this.assistCanvasEl.style.top = _this.canvasEl.style.top;\n                }\n            }\n        });\n        // 以上述配置开始观察目标节点\n        this.canvasObserver.observe(this.canvasEl, {\n            attributes: true,\n        });\n        // @ts-ignore\n        this.el.appendChild(this.assistCanvasEl);\n        // 触发canvasMount事件\n        this.emitter.trigger(types_1.InteractionLayerActions.CanvasMount);\n    };\n    InteractionLayer.prototype.enableMap = function () {\n        this.map.enableDoubleClickZoom();\n        // this.map.enableInertialDragging();\n        // this.map.enableDragging();\n        // this.map.enableScrollWheelZoom();\n        // this.map.enableContinuousZoom();\n    };\n    InteractionLayer.prototype.disableMap = function () {\n        this.map.disableDoubleClickZoom();\n        // this.map.disableInertialDragging();\n        // this.map.disableDragging();\n        // this.map.disableScrollWheelZoom();\n        // this.map.disableContinuousZoom();\n    };\n    /**\n     * pixelToPoint\n     * @param pixel\n     * @return IPoint\n     */\n    InteractionLayer.prototype.pixelToPoint = function (pixel) {\n        var point = this.map.pixelToPoint(pixel);\n        return {\n            x: point.lng,\n            y: point.lat,\n        };\n    };\n    /**\n     * pointToPixel\n     * @param point\n     */\n    InteractionLayer.prototype.pointToPixel = function (point) {\n        // @ts-ignore\n        return this.map.pointToPixel(new BMap.Point(point.x, point.y));\n    };\n    /**\n     * distanceToActual - 图上距离转换成实际距离\n     * @param distance 图上距离\n     * @return number 实际距离\n     */\n    InteractionLayer.prototype.distanceToActual = function (distance) {\n        var scale = util_1.default.getScale(this.map);\n        return distance / scale;\n    };\n    /**\n     * actualToDistance - 实际距离转换成图上距离\n     * @param actual\n     */\n    InteractionLayer.prototype.actualToDistance = function (actual) {\n        var scale = util_1.default.getScale(this.map);\n        return scale * actual;\n    };\n    /**\n     * getCtx\n     * @return CanvasRenderingContext2D | null\n     */\n    InteractionLayer.prototype.getCtx = function () {\n        return this.ctx;\n    };\n    /**\n     * getCanvasEl\n     * @return HTMLCanvasElement | null\n     */\n    InteractionLayer.prototype.getCanvasEl = function () {\n        return this.canvasEl;\n    };\n    /**\n     * getAssistCanvasEl\n     */\n    InteractionLayer.prototype.getAssistCanvasEl = function () {\n        return this.assistCanvasEl;\n    };\n    InteractionLayer.prototype.getAssistCtx = function () {\n        return this.assistCtx;\n    };\n    /**\n     * getWidth\n     * @return number\n     */\n    InteractionLayer.prototype.getWidth = function () {\n        var _a;\n        // @ts-ignore\n        return (_a = this === null || this === void 0 ? void 0 : this.getCanvasEl()) === null || _a === void 0 ? void 0 : _a.width;\n    };\n    /**\n     * getHeight\n     * @return number\n     */\n    InteractionLayer.prototype.getHeight = function () {\n        var _a;\n        // @ts-ignore\n        return (_a = this === null || this === void 0 ? void 0 : this.getCanvasEl()) === null || _a === void 0 ? void 0 : _a.height;\n    };\n    /**\n     * addHistoryData\n     * @description - 添加一个ActionData到canvasData中\n     * @param data\n     * @return void\n     */\n    InteractionLayer.prototype.addHistoryData = function (data) {\n        this.canvasData.push(data);\n    };\n    /**\n     * removeHistoryDataById - 删除一个ActionData中的数据\n     * @param actionDataId\n     * @return IActionData[]\n     */\n    InteractionLayer.prototype.removeHistoryDataById = function (actionDataId) {\n        var index = this.canvasData.findIndex(function (data) { return data.id === actionDataId; });\n        if (index === -1)\n            return [];\n        return this.canvasData.splice(index, 1);\n    };\n    /**\n     * drawHistoryData - 绘制历史数据\n     * @return void\n     */\n    InteractionLayer.prototype.drawHistoryData = function () {\n        var _this = this;\n        this.canvasData.forEach(function (data) {\n            var ctx = _this.ctx;\n            if (!ctx || !data)\n                return;\n            if (data.style) {\n                // 设置上下文属性\n                ctx.lineWidth = data.style.lineWidth;\n                ctx.lineJoin = data.style.lineJoin;\n                ctx.lineCap = data.style.lineCap;\n                ctx.setLineDash(data.style.lineDash);\n                ctx.lineDashOffset = data.style.lineDashOffset;\n                ctx.strokeStyle = data.style.strokeStyle;\n                ctx.fillStyle = data.style.fillStyle;\n            }\n            // 绘制指定类型的路径\n            // @ts-ignore\n            var action = _this.typeActionMap.get(data.type);\n            // @ts-ignore\n            action === null || action === void 0 ? void 0 : action.drawHistoryPath(_this, ctx, data.data);\n            // // 描边\n            // ctx.stroke();\n            // // 填充\n            // ctx.fill();\n        });\n    };\n    /**\n     * getHistoryDataById\n     * @param id\n     * @return IActionData | null | undefined\n     */\n    InteractionLayer.prototype.getHistoryDataById = function (id) {\n        return this.canvasData.find(function (data) { return data.id === id; });\n    };\n    /**\n     * getHistoryData\n     * @return IActionData []\n     */\n    InteractionLayer.prototype.getHistoryData = function () {\n        return __spreadArray([], this.canvasData, true);\n    };\n    /**\n     * setHistoryData\n     * @param data\n     */\n    InteractionLayer.prototype.setHistoryData = function (data) {\n        this.canvasData = data;\n    };\n    /**\n     * changeAction - 切换一个Action\n     * @param action - action对象\n     * @return void\n     */\n    InteractionLayer.prototype.changeAction = function (action) {\n        // 如果当前和传入一致则跳过\n        if (action === this.curAction)\n            return;\n        // 只有是未开始才能切换\n        if (action && action.getStatus() !== types_1.ActionStatus.UnStart)\n            return;\n        this.disableMap();\n        if (this.curAction) {\n            this.curAction.destroy();\n        }\n        // @ts-ignore\n        action === null || action === void 0 ? void 0 : action.setContext(this);\n        this.curAction = action;\n    };\n    /**\n     * getCurAction\n     * @return IAction | null\n     */\n    InteractionLayer.prototype.getCurAction = function () {\n        return this.curAction;\n    };\n    /**\n     * start - 开始\n     * @param style\n     * @return void\n     */\n    InteractionLayer.prototype.start = function (style) {\n        if (!this.curAction)\n            return;\n        this.curAction.start(style);\n    };\n    /**\n     * end - 结束\n     * @return void\n     */\n    InteractionLayer.prototype.end = function () {\n        if (!this.curAction)\n            return;\n        this.curAction.end();\n    };\n    /**\n     * clear\n     */\n    InteractionLayer.prototype.clearDraw = function () {\n        var ctx = this.ctx;\n        if (!ctx)\n            return;\n        ctx.clearRect(0, 0, this.getWidth(), this.getHeight());\n    };\n    /**\n     * clearAssistDraw\n     * @description 清除assist的canvas\n     */\n    InteractionLayer.prototype.clearAssistDraw = function () {\n        var assistCtx = this.assistCtx;\n        if (!assistCtx)\n            return;\n        assistCtx.clearRect(0, 0, this.getWidth(), this.getHeight());\n    };\n    /**\n     * setFrontCanvas\n     * @description 置顶\n     * @param canvasEl\n     */\n    InteractionLayer.prototype.setFrontCanvas = function (canvasEl) {\n        canvasEl.style.zIndex = \"\".concat(zIndex + 1);\n    };\n    /**\n     * setBackCanvas\n     * @description 置底\n     * @param canvasEl\n     */\n    InteractionLayer.prototype.setBackCanvas = function (canvasEl) {\n        canvasEl.style.zIndex = \"\".concat(zIndex - 1);\n    };\n    /**\n     * destroy - 销毁\n     * @return void\n     */\n    InteractionLayer.prototype.destroy = function () {\n        if (this.curAction) {\n            this.curAction.destroy();\n        }\n        // 之后，可停止观察\n        if (this.canvasObserver) {\n            this.canvasObserver.disconnect();\n        }\n    };\n    /**\n     * getMap\n     * @return any\n     */\n    InteractionLayer.prototype.getMap = function () {\n        return this.map;\n    };\n    return InteractionLayer;\n}(BMap.CanvasLayer));\nexports.default = InteractionLayer;\n"],"names":["__extends","this","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","TypeError","String","__","constructor","create","__spreadArray","to","from","pack","arguments","length","ar","i","l","slice","concat","__importDefault","mod","__esModule","default","adhere_util_1","defineProperty","exports","value","require","adhere_util_emitter_1","util_1","CircleDrawAction_1","DiamondDrawAction_1","DistanceDrawAction_1","FreeDrawAction_1","PolygonDrawAction_1","RectangleDrawAction_1","StartDrawAction_1","TriangleDrawAction_1","types_1","selectorPrefix","zIndex","InteractionLayer","_super","map","defaultData","listeners","_this","update","bind","paneName","el","curAction","canvasEl","ctx","assistCanvasEl","assistCtx","canvasData","emitter","Events","isLoad","canvasObserver","typeActionMap","Map","SelectType","Polygon","Distance","Circle","Rectangle","Triangle","Diamond","Start","Free","initListeners","destroy","clearDraw","clearAssistDraw","drawHistoryData","initCanvas","initEvents","keys","forEach","key","on","addEventListener","e","detail","historyData","getHistoryData","pixel","clientToCtxPoint","event","rect","getCanvasEl","getBoundingClientRect","finsEntitys","data","action","get","type","booleanPointInData","push","index","trigger","InteractionLayerActions","CanvasClickGeometry","JSON","parse","stringify","CanvasClickEmpty","canvas","parentElement","style","width","height","className","getContext","document","createElement","parseInt","MutationObserver","mutationsList","observer","_i","mutationsList_1","mutation","attributeName","left","top","observe","attributes","appendChild","CanvasMount","enableMap","enableDoubleClickZoom","disableMap","disableDoubleClickZoom","pixelToPoint","point","x","lng","y","lat","pointToPixel","BMap","Point","distanceToActual","distance","getScale","actualToDistance","actual","getCtx","getAssistCanvasEl","getAssistCtx","getWidth","_a","getHeight","addHistoryData","removeHistoryDataById","actionDataId","findIndex","id","splice","lineWidth","lineJoin","lineCap","setLineDash","lineDash","lineDashOffset","strokeStyle","fillStyle","drawHistoryPath","getHistoryDataById","find","setHistoryData","changeAction","getStatus","ActionStatus","UnStart","setContext","getCurAction","start","end","clearRect","setFrontCanvas","setBackCanvas","disconnect","getMap","CanvasLayer"],"mappings":"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"}