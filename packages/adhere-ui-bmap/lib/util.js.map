{"version":3,"file":"util.js","sources":["util.js"],"sourcesContent":["\"use strict\";\r\nvar __assign = (this && this.__assign) || function () {\r\n    __assign = Object.assign || function(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n                t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar adhere_util_1 = __importDefault(require(\"@baifendian/adhere-util\"));\r\nexports.default = {\r\n    /**\r\n     * flyToChina - 设置地图的zoom为全中国\r\n     * @param map\r\n     */\r\n    flyToChina: function (map) {\r\n        // @ts-ignore\r\n        map.centerAndZoom(new BMap.Point(106.638754, 34.842904), 2);\r\n    },\r\n    /**\r\n     * fillCityBoundary - 根据city名字填充城市轮廓\r\n     * @param cityName\r\n     * @param style\r\n     * @param map\r\n     * @return\r\n     */\r\n    fillCityBoundary: function (cityName, style, map) {\r\n        var cityOverlays = [];\r\n        var cityPoints = [];\r\n        return new Promise(function (resolve) {\r\n            // 勾勒的轮廓\r\n            // @ts-ignore\r\n            var bd = new BMap.Boundary();\r\n            bd.get(cityName, function (rs) {\r\n                for (var i = 0; i < rs.boundaries.length; i++) {\r\n                    var boundarieStr = rs.boundaries[i];\r\n                    var boundarie = boundarieStr.split(';');\r\n                    boundarie.forEach(function (pointStr) {\r\n                        var point = pointStr.trim().split(',');\r\n                        cityPoints.push(\r\n                        // @ts-ignore\r\n                        new BMap.Point(parseFloat(point[0].trim()), parseFloat(point[1].trim())));\r\n                    });\r\n                    // @ts-ignore\r\n                    var hole = new BMap.Polygon(boundarieStr, __assign({}, style));\r\n                    // @ts-ignore\r\n                    cityOverlays.push(hole);\r\n                    map.addOverlay(hole);\r\n                }\r\n                resolve({\r\n                    cityOverlays: cityOverlays,\r\n                    cityPoints: cityPoints,\r\n                });\r\n            });\r\n        });\r\n    },\r\n    /**\r\n     * fit - 根据数据fit适应的zoom上\r\n     * @param map\r\n     * @param points\r\n     * @param config\r\n     */\r\n    // @ts-ignore\r\n    fit: function (map, points, config) {\r\n        return new Promise(function (resolve) {\r\n            var viewport = map.getViewport(points, config || {});\r\n            map.centerAndZoom(viewport.center, viewport.zoom);\r\n            setTimeout(function () {\r\n                resolve();\r\n            }, 200);\r\n        });\r\n    },\r\n    /**\r\n     * pixelToPoint - 像素坐标转换为经纬度坐标\r\n     * @param map\r\n     * @param pixel\r\n     */\r\n    pixelToPoint: function (map, pixel) {\r\n        return map.pixelToPoint(pixel);\r\n    },\r\n    /**\r\n     * pointToPixel - 经纬度坐标转换为像素坐标\r\n     * @param map\r\n     * @param point\r\n     */\r\n    pointToPixel: function (map, point) {\r\n        return map.pointToPixel(point);\r\n    },\r\n    /**\r\n     * getViewBound 获取当前视图的矩形范围坐标(坐上 | 右下)\r\n     * @param map\r\n     * @return {\r\n     *   leftTopLon\r\n     *   leftTopLat\r\n     *   rightBottomLon\r\n     *   rightBottomLat\r\n     * }\r\n     */\r\n    getBound: function (map) {\r\n        var bounds = map.getBounds();\r\n        //获取西南角的经纬度(左下端点)\r\n        var sw = bounds.getSouthWest();\r\n        //获取东北角的经纬度(右上端点)\r\n        var ne = bounds.getNorthEast();\r\n        return {\r\n            leftTopLon: sw.lng,\r\n            leftTopLat: ne.lat,\r\n            rightBottomLon: ne.lng,\r\n            rightBottomLat: sw.lat,\r\n        };\r\n    },\r\n    /**\r\n     * getScale - 根据zoom获取比例尺\r\n     * @param map\r\n     * @return number\r\n     */\r\n    getScale: function (map) {\r\n        // const zoom = map.getZoom();\r\n        //\r\n        // /**\r\n        //  * 比例尺的单位是(m)\r\n        //  */\r\n        // const zoomScaleMap = new Map([\r\n        //   [19, 20],\r\n        //   [18, 50],\r\n        //   [17, 10],\r\n        //   [16, 200],\r\n        //   [15, 500],\r\n        //   [14, 1000],\r\n        //   [13, 2000],\r\n        //   [12, 5000],\r\n        //   [11, 10000],\r\n        //   [10, 20000],\r\n        //   [9, 25000],\r\n        //   [8, 50000],\r\n        //   [7, 100000],\r\n        //   [6, 200000],\r\n        //   [5, 500000],\r\n        //   [4, 1000000],\r\n        //   [3, 2000000],\r\n        //   [2, 5000000],\r\n        //   [1, 10000000],\r\n        // ]);\r\n        //\r\n        // // @ts-ignore\r\n        // return 1 / zoomScaleMap.get(zoom);\r\n        // 根据输入范围值(单位：米) 计算出需要画的区域像素：px\r\n        var pointA = map.getCenter();\r\n        // const pointAPixel = map.pointToOverlayPixel(pointA);\r\n        var pointAPixel = map.pointToPixel(pointA);\r\n        // @ts-ignore\r\n        var pointB = new BMap.Point(pointA.lng, pointA.lat + 0.001);\r\n        // const pointBPixel = map.pointToOverlayPixel(pointB);\r\n        var pointBPixel = map.pointToPixel(pointB);\r\n        // 像素距离\r\n        var pixelDistanceBetween2Points = Math.abs(pointBPixel.y - pointAPixel.y);\r\n        var realDistanceBetween2Points = map.getDistance(pointA, pointB);\r\n        // console.log('pointAPixel', pointAPixel);\r\n        // console.log('pointBPixel', pointBPixel);\r\n        // console.log('realDistanceBetween2Points', realDistanceBetween2Points);\r\n        // 比例尺\r\n        return ((pixelDistanceBetween2Points <= 0 ? 1 : pixelDistanceBetween2Points) /\r\n            realDistanceBetween2Points);\r\n        // return this.getUnitPixelToM(map.getZoom());\r\n    },\r\n    /**\r\n     * getUnitPixelToM - 1px等于多少米(m)\r\n     * @param zoom\r\n     * @return number\r\n     */\r\n    getUnitPixelToM: function (zoom) {\r\n        return Math.pow(2, 18 - zoom);\r\n    },\r\n    /**\r\n     * getArrowPoints - 获取三角形三个顶点值\r\n     * @param from\r\n     * @param to\r\n     * @param scale\r\n     * @param width\r\n     * @param theta\r\n     * @return {{A: {x: number, y: number}, B: {x: number, y: number}, C: {x: number, y: number}}}\r\n     */\r\n    getArrowPoints: function (_a) {\r\n        var from = _a.from, to = _a.to, _b = _a.scale, scale = _b === void 0 ? 1 : _b, _c = _a.width, width = _c === void 0 ? 5 : _c, _d = _a.theta, theta = _d === void 0 ? 35 : _d;\r\n        var fromX = from.x, fromY = from.y;\r\n        var toX = to.x, toY = to.y;\r\n        var arrowX, arrowY; // 箭头线终点坐标\r\n        // 计算各角度和对应的箭头终点坐标\r\n        var angle = (Math.atan2(fromY - toY, fromX - toX) * 180) / Math.PI;\r\n        var angle1 = ((angle + theta) * Math.PI) / 180;\r\n        var angle2 = ((angle - theta) * Math.PI) / 180;\r\n        var topX = width * Math.cos(angle1);\r\n        var topY = width * Math.sin(angle1);\r\n        var botX = width * Math.cos(angle2);\r\n        var botY = width * Math.sin(angle2);\r\n        arrowX = toX + topX;\r\n        arrowY = toY + topY;\r\n        var A = {\r\n            x: arrowX * scale,\r\n            y: arrowY * scale,\r\n        };\r\n        var B = {\r\n            x: toX * scale,\r\n            y: toY * scale,\r\n        };\r\n        arrowX = toX + botX;\r\n        arrowY = toY + botY;\r\n        var C = {\r\n            x: arrowX * scale,\r\n            y: arrowY * scale,\r\n        };\r\n        return {\r\n            A: A,\r\n            B: B,\r\n            C: C,\r\n        };\r\n    },\r\n    clientToCtxPointToEl: function (_a) {\r\n        var event = _a.event, rect = _a.rect, offsetEl = _a.offsetEl;\r\n        var _b = typeof window !== 'undefined'\r\n            ? window.getComputedStyle(offsetEl, null)\r\n            : {\r\n                left: '0',\r\n                top: '0',\r\n            }, left = _b.left, top = _b.top;\r\n        var offsetLeft = parseInt(left.replace('px', ''));\r\n        var offsetTop = parseInt(top.replace('px', ''));\r\n        return this.clientToCtxPoint({\r\n            event: event,\r\n            rect: rect,\r\n            offsetLeft: offsetLeft,\r\n            offsetTop: offsetTop,\r\n        });\r\n    },\r\n    clientToCtxPoint: function (_a) {\r\n        var event = _a.event, rect = _a.rect, offsetLeft = _a.offsetLeft, offsetTop = _a.offsetTop;\r\n        var pixel = adhere_util_1.default.clientToCtxPoint({\r\n            event: event,\r\n            rect: rect,\r\n        });\r\n        pixel.x -= offsetLeft;\r\n        pixel.y -= offsetTop;\r\n        return pixel;\r\n    },\r\n};\r\n"],"names":["__assign","this","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","__importDefault","mod","__esModule","default","adhere_util_1","defineProperty","exports","value","require","flyToChina","map","centerAndZoom","BMap","Point","fillCityBoundary","cityName","style","cityOverlays","cityPoints","Promise","resolve","Boundary","get","rs","boundaries","boundarieStr","hole","split","forEach","pointStr","point","trim","push","parseFloat","Polygon","addOverlay","fit","points","config","viewport","getViewport","center","zoom","setTimeout","pixelToPoint","pixel","pointToPixel","getBound","bounds","getBounds","sw","getSouthWest","ne","getNorthEast","leftTopLon","lng","leftTopLat","lat","rightBottomLon","rightBottomLat","getScale","pointA","getCenter","pointAPixel","pointB","pointBPixel","pixelDistanceBetween2Points","Math","abs","y","getDistance","getUnitPixelToM","pow","getArrowPoints","_a","from","to","_b","scale","_c","width","_d","theta","fromX","x","fromY","toX","toY","angle","atan2","PI","angle1","angle2","arrowX","cos","arrowY","sin","A","B","C","clientToCtxPointToEl","event","rect","offsetEl","window","getComputedStyle","left","top","offsetLeft","parseInt","replace","offsetTop","clientToCtxPoint"],"mappings":"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"}