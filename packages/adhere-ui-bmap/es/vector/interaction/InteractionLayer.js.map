{"version":3,"file":"InteractionLayer.js","sources":["vector/interaction/InteractionLayer.js"],"sourcesContent":["var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        if (typeof b !== \"function\" && b !== null)\r\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\r\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\r\n        if (ar || !(i in from)) {\r\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\r\n            ar[i] = from[i];\r\n        }\r\n    }\r\n    return to.concat(ar || Array.prototype.slice.call(from));\r\n};\r\nimport MathUtil from '@baifendian/adhere-util';\r\nimport Emitter from '@baifendian/adhere-util-emitter';\r\nimport Util from '../../util';\r\nimport CircleDrawAction from './draw/CircleDrawAction';\r\nimport DiamondDrawAction from './draw/DiamondDrawAction';\r\nimport DistanceDrawAction from './draw/DistanceDrawAction';\r\nimport FreeDrawAction from './draw/FreeDrawAction';\r\nimport PolygonDrawAction from './draw/PolygonDrawAction';\r\nimport RectangleDrawAction from './draw/RectangleDrawAction';\r\nimport StartDrawAction from './draw/StartDrawAction';\r\nimport TriangleDrawAction from './draw/TriangleDrawAction';\r\nimport { ActionStatus, InteractionLayerActions, SelectType, } from './types';\r\nvar selectorPrefix = 'adhere-ui-interactionlayer';\r\nvar zIndex = 19999;\r\n/**\r\n * InteractionLayer\r\n * @class\r\n * @classdesc - InteractionLayer\r\n */\r\nvar InteractionLayer = /** @class */ (function (_super) {\r\n    __extends(InteractionLayer, _super);\r\n    /**\r\n     * constructor\r\n     * @param map\r\n     * @param defaultData: IActionData[] - 缺省的ActionData数据\r\n     * @param listeners: IListeners - 缺省的事件注册对象\r\n     */\r\n    // @ts-ignore\r\n    function InteractionLayer(map, defaultData, listeners) {\r\n        var _this = this;\r\n        // @ts-ignore\r\n        _this.update = _this.update.bind(_this);\r\n        _this = _super.call(this, {\r\n            // @ts-ignore\r\n            update: _this.update,\r\n            paneName: 'markerPane',\r\n            zIndex: zIndex,\r\n        }) || this;\r\n        // map\r\n        _this.map = null;\r\n        // 父元素\r\n        _this.el = null;\r\n        // 注册的事件对象\r\n        _this.listeners = null;\r\n        // 当前的Action\r\n        _this.curAction = null;\r\n        // 当前的canvas元素\r\n        _this.canvasEl = null;\r\n        // 当前的ctx对象\r\n        _this.ctx = null;\r\n        // 辅助的canvas元素\r\n        _this.assistCanvasEl = null;\r\n        // 辅助的ctx对象\r\n        _this.assistCtx = null;\r\n        // canvas上的所有数据\r\n        _this.canvasData = [];\r\n        _this.emitter = new Emitter.Events();\r\n        _this.isLoad = false;\r\n        // canvas的属性监控\r\n        _this.canvasObserver = null;\r\n        // @ts-ignore\r\n        _this.typeActionMap = new Map([\r\n            [SelectType.Polygon, PolygonDrawAction],\r\n            [SelectType.Distance, DistanceDrawAction],\r\n            [SelectType.Circle, CircleDrawAction],\r\n            [SelectType.Rectangle, RectangleDrawAction],\r\n            [SelectType.Triangle, TriangleDrawAction],\r\n            [SelectType.Diamond, DiamondDrawAction],\r\n            [SelectType.Start, StartDrawAction],\r\n            [SelectType.Free, FreeDrawAction],\r\n        ]);\r\n        _this.map = map;\r\n        _this.listeners = listeners;\r\n        defaultData && (_this.canvasData = defaultData);\r\n        // 初始化Listeners\r\n        _this.initListeners();\r\n        return _this;\r\n    }\r\n    InteractionLayer.prototype.update = function () {\r\n        if (!this.isLoad) {\r\n            // 初始化Canvas\r\n            this.initCanvas();\r\n            // 初始化Events\r\n            this.initEvents();\r\n            this.clearDraw();\r\n            this.clearAssistDraw();\r\n            this.drawHistoryData();\r\n            this.isLoad = true;\r\n        }\r\n        else {\r\n            if (this.curAction) {\r\n                this.curAction.destroy();\r\n            }\r\n            this.clearDraw();\r\n            this.clearAssistDraw();\r\n            this.drawHistoryData();\r\n        }\r\n    };\r\n    /**\r\n     * initListeners\r\n     * @description 注册用户的listeners\r\n     */\r\n    InteractionLayer.prototype.initListeners = function () {\r\n        var _this = this;\r\n        var listeners = this.listeners;\r\n        if (!listeners)\r\n            return;\r\n        var keys = Object.keys(listeners);\r\n        keys.forEach(function (key) {\r\n            _this.emitter.on(key, listeners[key]);\r\n        });\r\n    };\r\n    /**\r\n     * initEvents\r\n     */\r\n    InteractionLayer.prototype.initEvents = function () {\r\n        var _this = this;\r\n        /**\r\n         * 点击了el元素\r\n         */\r\n        this.el.addEventListener('mouseup', function (e) {\r\n            if (!e)\r\n                return;\r\n            if (e.detail >= 2)\r\n                return;\r\n            // 查看point命中了HistoryData中的哪一项\r\n            var historyData = _this.getHistoryData();\r\n            var pixel = MathUtil.clientToCtxPoint({\r\n                event: e,\r\n                rect: _this.getCanvasEl().getBoundingClientRect() /*(this.el as HTMLDivElement).getBoundingClientRect()*/,\r\n            });\r\n            var finsEntitys = [];\r\n            for (var i = 0; i < historyData.length; i++) {\r\n                var data = historyData[i];\r\n                var action = _this.typeActionMap.get(data.type);\r\n                var isIn = false;\r\n                if ('booleanPointInData' in action) {\r\n                    isIn = action === null || action === void 0 ? void 0 : action.booleanPointInData(_this, pixel, data);\r\n                    if (isIn) {\r\n                        finsEntitys.push({\r\n                            index: i,\r\n                            data: data,\r\n                        });\r\n                    }\r\n                }\r\n            }\r\n            if (finsEntitys.length) {\r\n                // console.log('点击了节点');\r\n                // 原始数据-需要转换成坐标数据\r\n                _this.emitter.trigger(InteractionLayerActions.CanvasClickGeometry, JSON.parse(JSON.stringify(finsEntitys[finsEntitys.length - 1].data)));\r\n            }\r\n            else {\r\n                if (historyData.length) {\r\n                    // console.log('点击拉画布');\r\n                    _this.emitter.trigger(InteractionLayerActions.CanvasClickEmpty);\r\n                }\r\n            }\r\n        });\r\n    };\r\n    /**\r\n     * initCanvas - 初始化Canvas\r\n     */\r\n    InteractionLayer.prototype.initCanvas = function () {\r\n        var _this = this;\r\n        // @ts-ignore\r\n        this.el = this.canvas.parentElement;\r\n        // 创建一个canvas\r\n        // @ts-ignore\r\n        this.canvasEl = this.canvas;\r\n        // @ts-ignore\r\n        this.el.style.width = \"\".concat(this.canvasEl.width, \"px\");\r\n        // @ts-ignore\r\n        this.el.style.height = \"\".concat(this.canvasEl.height, \"px\");\r\n        // @ts-ignore\r\n        this.canvasEl.className = \"\".concat(selectorPrefix);\r\n        // @ts-ignore\r\n        this.ctx = this.canvasEl.getContext('2d');\r\n        // 创建一个assistCanvas\r\n        this.assistCanvasEl = document.createElement('canvas');\r\n        this.assistCanvasEl.className = \"\".concat(selectorPrefix, \"-assist\");\r\n        // @ts-ignore\r\n        this.assistCanvasEl.style.zIndex = \"\".concat(parseInt(this.canvasEl.style.zIndex) - 1);\r\n        // @ts-ignore\r\n        this.assistCanvasEl.width = this.canvasEl.width;\r\n        // @ts-ignore\r\n        this.assistCanvasEl.height = this.canvasEl.height;\r\n        this.assistCtx = this.assistCanvasEl.getContext('2d');\r\n        // 创建一个观察器实例并传入回调函数\r\n        this.canvasObserver = new MutationObserver(function (mutationsList, observer) {\r\n            for (var _i = 0, mutationsList_1 = mutationsList; _i < mutationsList_1.length; _i++) {\r\n                var mutation = mutationsList_1[_i];\r\n                if (mutation.type === 'attributes' && mutation.attributeName === 'style') {\r\n                    _this.assistCanvasEl.style.left = _this.canvasEl.style.left;\r\n                    _this.assistCanvasEl.style.top = _this.canvasEl.style.top;\r\n                }\r\n            }\r\n        });\r\n        // 以上述配置开始观察目标节点\r\n        this.canvasObserver.observe(this.canvasEl, {\r\n            attributes: true,\r\n        });\r\n        // @ts-ignore\r\n        this.el.appendChild(this.assistCanvasEl);\r\n        // 触发canvasMount事件\r\n        this.emitter.trigger(InteractionLayerActions.CanvasMount);\r\n    };\r\n    InteractionLayer.prototype.enableMap = function () {\r\n        this.map.enableDoubleClickZoom();\r\n        // this.map.enableInertialDragging();\r\n        // this.map.enableDragging();\r\n        // this.map.enableScrollWheelZoom();\r\n        // this.map.enableContinuousZoom();\r\n    };\r\n    InteractionLayer.prototype.disableMap = function () {\r\n        this.map.disableDoubleClickZoom();\r\n        // this.map.disableInertialDragging();\r\n        // this.map.disableDragging();\r\n        // this.map.disableScrollWheelZoom();\r\n        // this.map.disableContinuousZoom();\r\n    };\r\n    /**\r\n     * pixelToPoint\r\n     * @param pixel\r\n     * @return IPoint\r\n     */\r\n    InteractionLayer.prototype.pixelToPoint = function (pixel) {\r\n        var point = this.map.pixelToPoint(pixel);\r\n        return {\r\n            x: point.lng,\r\n            y: point.lat,\r\n        };\r\n    };\r\n    /**\r\n     * pointToPixel\r\n     * @param point\r\n     */\r\n    InteractionLayer.prototype.pointToPixel = function (point) {\r\n        // @ts-ignore\r\n        return this.map.pointToPixel(new BMap.Point(point.x, point.y));\r\n    };\r\n    /**\r\n     * distanceToActual - 图上距离转换成实际距离\r\n     * @param distance 图上距离\r\n     * @return number 实际距离\r\n     */\r\n    InteractionLayer.prototype.distanceToActual = function (distance) {\r\n        var scale = Util.getScale(this.map);\r\n        return distance / scale;\r\n    };\r\n    /**\r\n     * actualToDistance - 实际距离转换成图上距离\r\n     * @param actual\r\n     */\r\n    InteractionLayer.prototype.actualToDistance = function (actual) {\r\n        var scale = Util.getScale(this.map);\r\n        return scale * actual;\r\n    };\r\n    /**\r\n     * getCtx\r\n     * @return CanvasRenderingContext2D | null\r\n     */\r\n    InteractionLayer.prototype.getCtx = function () {\r\n        return this.ctx;\r\n    };\r\n    /**\r\n     * getCanvasEl\r\n     * @return HTMLCanvasElement | null\r\n     */\r\n    InteractionLayer.prototype.getCanvasEl = function () {\r\n        return this.canvasEl;\r\n    };\r\n    /**\r\n     * getAssistCanvasEl\r\n     */\r\n    InteractionLayer.prototype.getAssistCanvasEl = function () {\r\n        return this.assistCanvasEl;\r\n    };\r\n    InteractionLayer.prototype.getAssistCtx = function () {\r\n        return this.assistCtx;\r\n    };\r\n    /**\r\n     * getWidth\r\n     * @return number\r\n     */\r\n    InteractionLayer.prototype.getWidth = function () {\r\n        var _a;\r\n        // @ts-ignore\r\n        return (_a = this === null || this === void 0 ? void 0 : this.getCanvasEl()) === null || _a === void 0 ? void 0 : _a.width;\r\n    };\r\n    /**\r\n     * getHeight\r\n     * @return number\r\n     */\r\n    InteractionLayer.prototype.getHeight = function () {\r\n        var _a;\r\n        // @ts-ignore\r\n        return (_a = this === null || this === void 0 ? void 0 : this.getCanvasEl()) === null || _a === void 0 ? void 0 : _a.height;\r\n    };\r\n    /**\r\n     * addHistoryData\r\n     * @description - 添加一个ActionData到canvasData中\r\n     * @param data\r\n     * @return void\r\n     */\r\n    InteractionLayer.prototype.addHistoryData = function (data) {\r\n        this.canvasData.push(data);\r\n    };\r\n    /**\r\n     * removeHistoryDataById - 删除一个ActionData中的数据\r\n     * @param actionDataId\r\n     * @return IActionData[]\r\n     */\r\n    InteractionLayer.prototype.removeHistoryDataById = function (actionDataId) {\r\n        var index = this.canvasData.findIndex(function (data) { return data.id === actionDataId; });\r\n        if (index === -1)\r\n            return [];\r\n        return this.canvasData.splice(index, 1);\r\n    };\r\n    /**\r\n     * drawHistoryData - 绘制历史数据\r\n     * @return void\r\n     */\r\n    InteractionLayer.prototype.drawHistoryData = function () {\r\n        var _this = this;\r\n        this.canvasData.forEach(function (data) {\r\n            var ctx = _this.ctx;\r\n            if (!ctx || !data)\r\n                return;\r\n            if (data.style) {\r\n                // 设置上下文属性\r\n                ctx.lineWidth = data.style.lineWidth;\r\n                ctx.lineJoin = data.style.lineJoin;\r\n                ctx.lineCap = data.style.lineCap;\r\n                ctx.setLineDash(data.style.lineDash);\r\n                ctx.lineDashOffset = data.style.lineDashOffset;\r\n                ctx.strokeStyle = data.style.strokeStyle;\r\n                ctx.fillStyle = data.style.fillStyle;\r\n            }\r\n            // 绘制指定类型的路径\r\n            // @ts-ignore\r\n            var action = _this.typeActionMap.get(data.type);\r\n            // @ts-ignore\r\n            action === null || action === void 0 ? void 0 : action.drawHistoryPath(_this, ctx, data.data);\r\n            // // 描边\r\n            // ctx.stroke();\r\n            // // 填充\r\n            // ctx.fill();\r\n        });\r\n    };\r\n    /**\r\n     * getHistoryDataById\r\n     * @param id\r\n     * @return IActionData | null | undefined\r\n     */\r\n    InteractionLayer.prototype.getHistoryDataById = function (id) {\r\n        return this.canvasData.find(function (data) { return data.id === id; });\r\n    };\r\n    /**\r\n     * getHistoryData\r\n     * @return IActionData []\r\n     */\r\n    InteractionLayer.prototype.getHistoryData = function () {\r\n        return __spreadArray([], this.canvasData, true);\r\n    };\r\n    /**\r\n     * setHistoryData\r\n     * @param data\r\n     */\r\n    InteractionLayer.prototype.setHistoryData = function (data) {\r\n        this.canvasData = data;\r\n    };\r\n    /**\r\n     * changeAction - 切换一个Action\r\n     * @param action - action对象\r\n     * @return void\r\n     */\r\n    InteractionLayer.prototype.changeAction = function (action) {\r\n        // 如果当前和传入一致则跳过\r\n        if (action === this.curAction)\r\n            return;\r\n        // 只有是未开始才能切换\r\n        if (action && action.getStatus() !== ActionStatus.UnStart)\r\n            return;\r\n        this.disableMap();\r\n        if (this.curAction) {\r\n            this.curAction.destroy();\r\n        }\r\n        // @ts-ignore\r\n        action === null || action === void 0 ? void 0 : action.setContext(this);\r\n        this.curAction = action;\r\n    };\r\n    /**\r\n     * getCurAction\r\n     * @return IAction | null\r\n     */\r\n    InteractionLayer.prototype.getCurAction = function () {\r\n        return this.curAction;\r\n    };\r\n    /**\r\n     * start - 开始\r\n     * @param style\r\n     * @return void\r\n     */\r\n    InteractionLayer.prototype.start = function (style) {\r\n        if (!this.curAction)\r\n            return;\r\n        this.curAction.start(style);\r\n    };\r\n    /**\r\n     * end - 结束\r\n     * @return void\r\n     */\r\n    InteractionLayer.prototype.end = function () {\r\n        if (!this.curAction)\r\n            return;\r\n        this.curAction.end();\r\n    };\r\n    /**\r\n     * clear\r\n     */\r\n    InteractionLayer.prototype.clearDraw = function () {\r\n        var ctx = this.ctx;\r\n        if (!ctx)\r\n            return;\r\n        ctx.clearRect(0, 0, this.getWidth(), this.getHeight());\r\n    };\r\n    /**\r\n     * clearAssistDraw\r\n     * @description 清除assist的canvas\r\n     */\r\n    InteractionLayer.prototype.clearAssistDraw = function () {\r\n        var assistCtx = this.assistCtx;\r\n        if (!assistCtx)\r\n            return;\r\n        assistCtx.clearRect(0, 0, this.getWidth(), this.getHeight());\r\n    };\r\n    /**\r\n     * setFrontCanvas\r\n     * @description 置顶\r\n     * @param canvasEl\r\n     */\r\n    InteractionLayer.prototype.setFrontCanvas = function (canvasEl) {\r\n        canvasEl.style.zIndex = \"\".concat(zIndex + 1);\r\n    };\r\n    /**\r\n     * setBackCanvas\r\n     * @description 置底\r\n     * @param canvasEl\r\n     */\r\n    InteractionLayer.prototype.setBackCanvas = function (canvasEl) {\r\n        canvasEl.style.zIndex = \"\".concat(zIndex - 1);\r\n    };\r\n    /**\r\n     * destroy - 销毁\r\n     * @return void\r\n     */\r\n    InteractionLayer.prototype.destroy = function () {\r\n        if (this.curAction) {\r\n            this.curAction.destroy();\r\n        }\r\n        // 之后，可停止观察\r\n        if (this.canvasObserver) {\r\n            this.canvasObserver.disconnect();\r\n        }\r\n    };\r\n    /**\r\n     * getMap\r\n     * @return any\r\n     */\r\n    InteractionLayer.prototype.getMap = function () {\r\n        return this.map;\r\n    };\r\n    return InteractionLayer;\r\n}(BMap.CanvasLayer));\r\nexport default InteractionLayer;\r\n"],"names":["__extends","this","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","TypeError","String","__","constructor","create","__spreadArray","to","from","pack","arguments","length","ar","i","l","slice","concat","MathUtil","Emitter","Util","CircleDrawAction","DiamondDrawAction","DistanceDrawAction","FreeDrawAction","PolygonDrawAction","RectangleDrawAction","StartDrawAction","TriangleDrawAction","ActionStatus","InteractionLayerActions","SelectType","selectorPrefix","zIndex","InteractionLayer","_super","map","defaultData","listeners","_this","update","bind","paneName","el","curAction","canvasEl","ctx","assistCanvasEl","assistCtx","canvasData","emitter","Events","isLoad","canvasObserver","typeActionMap","Map","Polygon","Distance","Circle","Rectangle","Triangle","Diamond","Start","Free","initListeners","destroy","clearDraw","clearAssistDraw","drawHistoryData","initCanvas","initEvents","keys","forEach","key","on","addEventListener","e","detail","historyData","getHistoryData","pixel","clientToCtxPoint","event","rect","getCanvasEl","getBoundingClientRect","finsEntitys","data","action","get","type","booleanPointInData","push","index","trigger","CanvasClickGeometry","JSON","parse","stringify","CanvasClickEmpty","canvas","parentElement","style","width","height","className","getContext","document","createElement","parseInt","MutationObserver","mutationsList","observer","_i","mutationsList_1","mutation","attributeName","left","top","observe","attributes","appendChild","CanvasMount","enableMap","enableDoubleClickZoom","disableMap","disableDoubleClickZoom","pixelToPoint","point","x","lng","y","lat","pointToPixel","BMap","Point","distanceToActual","distance","getScale","actualToDistance","actual","getCtx","getAssistCanvasEl","getAssistCtx","getWidth","_a","getHeight","addHistoryData","removeHistoryDataById","actionDataId","findIndex","id","splice","lineWidth","lineJoin","lineCap","setLineDash","lineDash","lineDashOffset","strokeStyle","fillStyle","drawHistoryPath","getHistoryDataById","find","setHistoryData","changeAction","getStatus","UnStart","setContext","getCurAction","start","end","clearRect","setFrontCanvas","setBackCanvas","disconnect","getMap","CanvasLayer"],"mappings":"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"}