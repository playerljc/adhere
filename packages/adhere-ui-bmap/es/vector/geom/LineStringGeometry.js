var __extends=this&&this.__extends||function(){var i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};return function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};import MathUtil from"@baifendian/adhere-util";import{GeometryType,VectorActions}from"../types";import Geometry from"./Geometry";import GeometryStyle from"../style/GeometryStyle";import Util from"../../util";import TextStyle from"../style/TextStyle";var SIZE=new Map([["small",3],["normal",10],["large",20]]),LineStringGeometry=function(n){function l(t){var e=n.call(this)||this;return e.coordinates=t,e}return __extends(l,n),l.drawStartArrow=function(t){var e=t.ctx,n=t.style,i=t.coordinates,o=t.map;e.save(),e.beginPath(),e.lineWidth=n.lineWidth,e.lineJoin=n.lineJoin,e.lineCap=n.lineCap,e.setLineDash(n.lineDash),e.lineDashOffset=n.lineDashOffset,e.strokeStyle=n.strokeStyle,e.fillStyle=n.fillStyle;t=o.pointToPixel(new BMap.Point(i.point1.lng,i.point1.lat)),i=o.pointToPixel(new BMap.Point(i.point2.lng,i.point2.lat)),i=Util.getArrowPoints({from:i,to:t,scale:1,width:SIZE.get(n.arrow.size)}),t=i.A,n=i.B,i=i.C;e.moveTo(t.x,t.y),e.lineTo(n.x,n.y),e.lineTo(i.x,i.y),e.closePath(),e.stroke(),e.fill(),e.restore()},l.drawEndArrow=function(t){var e=t.ctx,n=t.style,i=t.coordinates,o=t.map;e.save(),e.beginPath(),e.lineWidth=n.lineWidth,e.lineJoin=n.lineJoin,e.lineCap=n.lineCap,e.setLineDash(n.lineDash),e.lineDashOffset=n.lineDashOffset,e.strokeStyle=n.strokeStyle,e.fillStyle=n.fillStyle;t=o.pointToPixel(new BMap.Point(i.point1.lng,i.point1.lat)),i=o.pointToPixel(new BMap.Point(i.point2.lng,i.point2.lat)),t=Util.getArrowPoints({from:t,to:i,scale:1,width:SIZE.get(n.arrow.size)}),i=t.A,n=t.B,t=t.C;e.moveTo(i.x,i.y),e.lineTo(n.x,n.y),e.lineTo(t.x,t.y),e.closePath(),e.stroke(),e.fill(),e.restore()},l.drawLineString=function(t){var e=t.ctx,n=t.style,i=t.coordinates,o=t.map;e.save();var r=__assign(__assign(__assign({},GeometryStyle),n||{}),{arrow:{draw:!1,direction:"end",type:"normal",size:"normal"}});e.beginPath(),e.lineWidth=r.lineWidth,e.lineJoin=r.lineJoin,e.lineCap=r.lineCap,e.setLineDash(r.lineDash),e.lineDashOffset=r.lineDashOffset,e.strokeStyle=r.strokeStyle;var a=i.point1,t=i.point2,a=o.pointToPixel(new BMap.Point(a.lng,a.lat)),t=o.pointToPixel(new BMap.Point(t.lng,t.lat));e.moveTo(a.x,a.y),e.lineTo(t.x,t.y),e.stroke(),e.restore(),n.arrow.draw&&("start"===n.arrow.direction?l.drawStartArrow({ctx:e,style:r,coordinates:i,map:o}):"end"===n.arrow.direction?l.drawEndArrow({ctx:e,style:r,coordinates:i,map:o}):"bothEnds"===n.arrow.direction&&(l.drawStartArrow({ctx:e,style:r,coordinates:i,map:o}),l.drawEndArrow({ctx:e,style:r,coordinates:i,map:o})))},l.prototype.setCoordinates=function(t){this.coordinates=t,null!==(t=null===(t=null==this?void 0:this.getLayer())||void 0===t?void 0:t.getEmitter())&&void 0!==t&&t.trigger(VectorActions.UPDATE)},l.prototype.getCoordinates=function(){return __assign({},this.coordinates)},l.prototype.getType=function(){return GeometryType.LineString},l.getCenterCoordinate=function(t){t.ctx;var e=t.coordinates,n=t.map,t=(t.style,t.isScale,e.point1),e=e.point2,t=n.pointToPixel(new BMap.Point(t.lng,t.lat)),e=n.pointToPixel(new BMap.Point(e.lng,e.lat));return MathUtil.midpoint(t,e)},l.prototype.getCenterCoordinate=function(t){var e=t.ctx,n=t.style,t=t.isScale;return l.getCenterCoordinate({ctx:e,coordinates:this.coordinates,map:this.getMap(),style:n,isScale:t})},l.prototype.draw=function(t,e){l.drawLineString({ctx:t,style:e,coordinates:this.coordinates,map:this.getMap()})},l.prototype.drawText=function(t){var e=t.ctx,n=t.text,i=t.style,o=t.textStyle;e.save(),e.beginPath();var r=this.getMap(),a=this.getCenterCoordinate({ctx:e,style:i,isScale:!0});e.translate(a.x,a.y);t=this.coordinates,a=t.point1,t=t.point2,a=r.pointToPixel(new BMap.Point(a.lng,a.lat)),t=r.pointToPixel(new BMap.Point(t.lng,t.lat)),t=MathUtil.slopToRadian(a,t);e.rotate(t);o=__assign(__assign({},TextStyle),o||{});e.font=o.font,e.textAlign=o.textAlign,e.textBaseline=o.textBaseline,e.direction=o.direction,e.strokeStyle=o.strokeStyle,e.fillStyle=o.fillStyle;i=__assign(__assign({},GeometryStyle),i||{});e.lineWidth=i.lineWidth,e.lineJoin=i.lineJoin,e.lineCap=i.lineCap,e.setLineDash(i.lineDash),e.lineDashOffset=i.lineDashOffset,e.strokeStyle=i.strokeStyle,e.fillText(n||"",0,0),e.restore()},l.isPixelInGeometry=function(t){var e=t.pixel,n=(t.style,t.coordinates),i=t.map,o=document.createElement("canvas").getContext("2d");if(!o)return!1;o.beginPath();t=n.point1,n=n.point2,t=i.pointToPixel(new BMap.Point(t.lng,t.lat)),n=i.pointToPixel(new BMap.Point(n.lng,n.lat));return o.moveTo(t.x,t.y),o.lineTo(n.x,n.y),o.isPointInPath(e.x,e.y)},l.prototype.isPixelInGeometry=function(t,e){return l.isPixelInGeometry({pixel:t,style:e,coordinates:this.coordinates,map:this.getMap()})},l}(Geometry);export default LineStringGeometry;
//# sourceMappingURL=LineStringGeometry.js.map
