"use strict";require("core-js/modules/es.object.define-property.js"),require("core-js/modules/es.array.map.js"),Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),react_1=tslib_1.__importStar(require("react")),prop_types_1=tslib_1.__importDefault(require("prop-types")),classnames_1=tslib_1.__importDefault(require("classnames")),icons_1=require("@ant-design/icons"),adhere_ui_conditionalrender_1=tslib_1.__importDefault(require("@baifendian/adhere-ui-conditionalrender")),adhere_ui_flexlayout_1=tslib_1.__importDefault(require("@baifendian/adhere-ui-flexlayout")),adhere_util_intl_1=tslib_1.__importDefault(require("@baifendian/adhere-util-intl")),Reply_1=tslib_1.__importDefault(require("../Reply")),selectorPrefix="adhere-ui-comment-commit";function Commit(r){var e=(0,react_1.useState)(((t={})[r.dataKeys.current]=1,t[r.dataKeys.list]=[],t[r.dataKeys.totalCount]=0,t[r.dataKeys.totalPage]=0,t)),l=e[0],n=e[1],t=(0,react_1.useState)(!1),a=t[0],i=t[1],e=(0,react_1.useState)(!1),c=e[0],o=e[1],t=(0,react_1.useState)(!1),e=t[0],u=t[1],d=(0,react_1.useRef)({page:1,limit:r.limit});function _(){return react_1.default.createElement("ul",{className:"".concat(selectorPrefix,"-children")},(l[r.dataKeys.list]||[]).map(function(e){return react_1.default.createElement("li",{className:"".concat(selectorPrefix,"-children-item"),key:e[r.keyProp]},react_1.default.createElement(Commit,{isReply:!0,data:e,keyProp:r.keyProp,isMoreProp:r.isMoreProp,renderLoading:r.renderLoading,fetchData:r.fetchData,renderActions:r.renderActions,renderAuthor:r.renderAuthor,renderAvatar:r.renderAvatar,renderContent:r.renderContent,renderDateTime:r.renderDateTime}))}),react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:!c&&l[r.dataKeys.list].length<=l[r.dataKeys.totalCount]},function(){return react_1.default.createElement("li",{className:(0,classnames_1.default)("".concat(selectorPrefix,"-children-item"),"more")},react_1.default.createElement("a",{onClick:function(){d.current.page=d.current.page+1,function(){o(!0),d.current.page=d.current.page+1;var a=r.dataKeys.list;f(function(e){var t;n(tslib_1.__assign(tslib_1.__assign({},e),((t={})[r.dataKeys.list]=tslib_1.__spreadArray(tslib_1.__spreadArray([],l[a],!0),e[a],!0),t)))})}()}},react_1.default.createElement("span",null,react_1.default.createElement(icons_1.EnterOutlined,{className:"reply-icon"})),react_1.default.createElement("span",null,adhere_util_intl_1.default.v("加载更多回复"))))}))}function s(){return o(!0),d.current={page:1,limit:r.limit},f(function(e){n(e)})}function f(t){var e;return null===(e=null==r?void 0:r.fetchData)||void 0===e?void 0:e.call(r,tslib_1.__assign(tslib_1.__assign({},d.current),{id:null===(e=null==r?void 0:r.data)||void 0===e?void 0:e[r.keyProp]})).then(function(e){return t(e),o(!1),e}).catch(function(e){return o(!1),e})}return react_1.default.createElement(adhere_ui_flexlayout_1.default,{direction:"horizontal",className:(0,classnames_1.default)(selectorPrefix,r.isReply?"".concat(selectorPrefix,"-reply"):null)},react_1.default.createElement(adhere_ui_flexlayout_1.default.Fixed,{className:"".concat(selectorPrefix,"-reply-avatar-wrap")},null===(t=null==r?void 0:r.renderAvatar)||void 0===t?void 0:t.call(r,r.data)),react_1.default.createElement(adhere_ui_flexlayout_1.default.Auto,{autoFixed:!0,fit:!0},react_1.default.createElement(adhere_ui_flexlayout_1.default,{direction:"vertical"},react_1.default.createElement(adhere_ui_flexlayout_1.default.Fixed,{className:"".concat(selectorPrefix,"-title-row"),fit:!1},react_1.default.createElement("div",{className:"".concat(selectorPrefix,"-title-row-author")},null===(t=null==r?void 0:r.renderAuthor)||void 0===t?void 0:t.call(r,r.data)),react_1.default.createElement("div",{className:"".concat(selectorPrefix,"-title-row-date-time")},null===(t=null==r?void 0:r.renderDateTime)||void 0===t?void 0:t.call(r,r.data))),react_1.default.createElement(adhere_ui_flexlayout_1.default.Auto,{className:"".concat(selectorPrefix,"-content-wrap")},null===(t=null==r?void 0:r.renderContent)||void 0===t?void 0:t.call(r,r.data)),react_1.default.createElement(adhere_ui_flexlayout_1.default.Fixed,null,react_1.default.createElement("ul",{className:"".concat(selectorPrefix,"-actions")},tslib_1.__spreadArray(tslib_1.__spreadArray([],((null===(t=null==r?void 0:r.renderActions)||void 0===t?void 0:t.call(r,null==r?void 0:r.data))||[]).map(function(e,t){return react_1.default.createElement("li",{key:t,className:"".concat(selectorPrefix,"-actions-action")},e)}),!0),[react_1.default.createElement("li",{className:(0,classnames_1.default)("".concat(selectorPrefix,"-actions-action"),"".concat(selectorPrefix,"-actions-action-reply-btn")),onClick:function(){return u(!0)}},adhere_util_intl_1.default.v("回复"))],!1))),react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:e},function(){return react_1.default.createElement(adhere_ui_flexlayout_1.default.Fixed,{style:{marginTop:15}},react_1.default.createElement(Reply_1.default,{onCancel:function(){return u(!1)},onResult:function(e){var t;null!==(e=null===(t=null==r?void 0:r.fetchReply)||void 0===t?void 0:t.call(r,{id:null===(t=null==r?void 0:r.data)||void 0===t?void 0:t[r.keyProp],reply:e}))&&void 0!==e&&e.then(function(){u(!1),s()})}}))}),react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:null===(e=null==r?void 0:r.data)||void 0===e?void 0:e[r.isMoreProp]},function(){return react_1.default.createElement(react_1.default.Fragment,null,react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:!c},function(){return react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:!a,noMatch:function(){return react_1.default.createElement("a",{className:"".concat(selectorPrefix,"-collapse"),onClick:function(){i(!1)}},react_1.default.createElement("span",null,react_1.default.createElement(icons_1.CaretUpOutlined,null)),react_1.default.createElement("span",null,adhere_util_intl_1.default.v("收起回复")))}},function(){return react_1.default.createElement("a",{className:"".concat(selectorPrefix,"-collapse"),onClick:function(){var e;l[r.dataKeys.list].length?i(!0):null!==(e=s())&&void 0!==e&&e.then(function(){i(!0)})}},react_1.default.createElement("span",null,react_1.default.createElement(icons_1.CaretDownOutlined,null)),react_1.default.createElement("span",null,adhere_util_intl_1.default.v("显示回复内容")))})}),react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:a},_),react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:c},function(){var e;return null===(e=null==r?void 0:r.renderLoading)||void 0===e?void 0:e.call(r)}))}))))}Commit.defaultProps={isReply:!1,limit:10,dataKeys:{current:"current",totalPage:"totalPage",list:"list",totalCount:"totalCount"}},Commit.propTypes={isReply:prop_types_1.default.bool,data:prop_types_1.default.shape({key:prop_types_1.default.string}),dataKeys:prop_types_1.default.shape({current:prop_types_1.default.string,totalPage:prop_types_1.default.string,list:prop_types_1.default.string,totalCount:prop_types_1.default.string}),renderLoading:prop_types_1.default.func,limit:prop_types_1.default.number,fetchData:prop_types_1.default.func,fetchReply:prop_types_1.default.func,keyProp:prop_types_1.default.string,isMoreProp:prop_types_1.default.string,renderActions:prop_types_1.default.func,renderAuthor:prop_types_1.default.func,renderAvatar:prop_types_1.default.func,renderContent:prop_types_1.default.func,renderDateTime:prop_types_1.default.func},exports.default=Commit;
//# sourceMappingURL=index.js.map
