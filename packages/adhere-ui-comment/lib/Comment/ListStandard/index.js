"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_empty=(Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0,_interopRequireDefault(require("antd/lib/empty"))),_react=_interopRequireWildcard(require("react")),_adhereUiConditionalrender=_interopRequireDefault(require("@baifendian/adhere-ui-conditionalrender")),_adhereUiFlexlayout=_interopRequireDefault(require("@baifendian/adhere-ui-flexlayout")),_adhereUiScrollload=_interopRequireDefault(require("@baifendian/adhere-ui-scrollload")),_List=_interopRequireDefault(require("../List"));function _getRequireWildcardCache(e){var t,r;return"function"!=typeof WeakMap?null:(t=new WeakMap,r=new WeakMap,(_getRequireWildcardCache=function(e){return e?r:t})(e))}function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};t=_getRequireWildcardCache(t);if(t&&t.has(e))return t.get(e);var r,a,n={__proto__:null},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(r in e)"default"!==r&&{}.hasOwnProperty.call(e,r)&&((a=i?Object.getOwnPropertyDescriptor(e,r):null)&&(a.get||a.set)?Object.defineProperty(n,r,a):n[r]=e[r]);return n.default=e,t&&t.set(e,n),n}var __assign=function(){return(__assign=Object.assign||function(e){for(var t,r=1,a=arguments.length;r<a;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},__spreadArray=function(e,t,r){if(r||2===arguments.length)for(var a,n=0,i=t.length;n<i;n++)!a&&n in t||((a=a||Array.prototype.slice.call(t,0,n))[n]=t[n]);return e.concat(a||Array.prototype.slice.call(t))},VerticalFlexLayout=_adhereUiFlexlayout.default.VerticalFlexLayout,selectorPrefix="adhere-ui-comment-list-standard",DEFAULT_KEYS={current:"current",totalPage:"totalPage",list:"list",totalCount:"totalCount"},DEFAULT_RENDER_EMPTY=function(){return _react.default.createElement(_empty.default,null)},ListStandard=(0,_react.memo)(function(r){var e=r.limit,t=void 0===e?10:e,e=r.dataKeys,n=void 0===e?DEFAULT_KEYS:e,e=r.listProps,a=void 0===e?{}:e,e=r.flexLayoutProps,e=void 0===e?{}:e,i=r.renderFirstLoading,l=r.renderEmpty,u=void 0===l?DEFAULT_RENDER_EMPTY:l,o=r.renderList,c=(0,_react.useRef)({page:1,limit:t}),d=(0,_react.useRef)(),s=(0,_react.useRef)(_adhereUiScrollload.default.NORMAL),l=(0,_react.useRef)(null),f=(0,_react.useState)(((f={})[n.current]=1,f[n.totalPage]=0,f[n.list]=[],f[n.totalCount]=0,f)),_=f[0],p=f[1],f=(0,_react.useState)(!0),g=f[0],y=f[1];function h(t){var e;return null==(e=null==r?void 0:r.fetchData)?void 0:e.call(r,null==c?void 0:c.current).then(function(e){return t(e),y(!1),e}).catch(function(e){var t;return y(!1),d.current&&(s.current=_adhereUiScrollload.default.ERROR,null!=(t=null==d?void 0:d.current))&&t.call(d,s.current),e})}var v=(0,_react.useCallback)(function(e){d.current=e,setTimeout(function(){return y(!0),c.current.page=c.current.page+1,a=n.list,h(function(r){p(function(e){var t;return __assign(__assign({},r),((t={})[n.list]=__spreadArray(__spreadArray([],e[a],!0),r[a],!0),t))})});var a},100)},[]),R=(0,_react.useCallback)(function(){return 1===c.current.page&&0===_[n.list].length},[_,n,c.current.page]),f=(0,_react.useMemo)(function(){return _react.default.createElement(_List.default,__assign({isLoading:g,hasMore:_[n.list].length<=_[n.totalCount],onLoadMore:v,renderFirstLoading:i},null!=a?a:{},{pages:_[n.totalPage]}),_react.default.createElement(_adhereUiConditionalrender.default,{conditional:!R(),noMatch:function(){return u()}},function(){return null==o?void 0:o(_)}))},[g,_,n.totalCount,n.list,i,a,u]);return(0,_react.useEffect)(function(){y(!0),c.current={page:1,limit:t},h(function(e){p(e)})},[]),(0,_react.useLayoutEffect)(function(){var e;d.current&&(e=_[n.totalPage],s.current=c.current.page<e?_adhereUiScrollload.default.NORMAL:_adhereUiScrollload.default.EMPTY,null!=d)&&d.current(s.current)},[_]),_react.default.createElement(VerticalFlexLayout,__assign({},null!=e?e:{},{className:"".concat(selectorPrefix),renderMain:_react.default.createElement("div",{className:"".concat(selectorPrefix,"-auto"),ref:l},f)}))}),_default=(ListStandard.displayName="ListStandard",exports.default=ListStandard);
//# sourceMappingURL=index.js.map
