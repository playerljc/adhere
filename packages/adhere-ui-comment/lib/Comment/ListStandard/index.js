"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),antd_1=require("antd"),react_1=tslib_1.__importStar(require("react")),adhere_ui_conditionalrender_1=tslib_1.__importDefault(require("@baifendian/adhere-ui-conditionalrender")),adhere_ui_flexlayout_1=tslib_1.__importDefault(require("@baifendian/adhere-ui-flexlayout")),adhere_ui_scrollload_1=tslib_1.__importDefault(require("@baifendian/adhere-ui-scrollload")),List_1=tslib_1.__importDefault(require("../List")),VerticalFlexLayout=adhere_ui_flexlayout_1.default.VerticalFlexLayout,selectorPrefix="adhere-ui-comment-list-standard",ListStandard=function(r){var e=r.limit,t=void 0===e?10:e,e=r.dataKeys,l=void 0===e?{current:"current",totalPage:"totalPage",list:"list",totalCount:"totalCount"}:e,e=r.listProps,a=void 0===e?{}:e,e=r.flexLayoutProps,e=void 0===e?{}:e,n=r.renderFirstLoading,i=r.renderEmpty,u=void 0===i?function(){return react_1.default.createElement(antd_1.Empty,null)}:i,o=r.renderList,_=r.getScrollWrapContainer,c=(0,react_1.useRef)({page:1,limit:t}),d=(0,react_1.useRef)(),s=(0,react_1.useRef)(adhere_ui_scrollload_1.default.NORMAL),i=(0,react_1.useRef)(null),f=tslib_1.__read((0,react_1.useState)(((f={})[l.current]=1,f[l.totalPage]=0,f[l.list]=[],f[l.totalCount]=0,f)),2),b=f[0],h=f[1],f=tslib_1.__read((0,react_1.useState)(!0),2),m=f[0],p=f[1];function g(t){var e;return null==(e=null==r?void 0:r.fetchData)?void 0:e.call(r,null==c?void 0:c.current).then(function(e){return t(e),p(!1),e}).catch(function(e){var t;return p(!1),d.current&&(s.current=adhere_ui_scrollload_1.default.ERROR,null!=(t=null==d?void 0:d.current)&&t.call(d,s.current)),e})}var v=(0,react_1.useCallback)(function(e){s.current===adhere_ui_scrollload_1.default.EMPTY?(s.current=adhere_ui_scrollload_1.default.EMPTY,e(adhere_ui_scrollload_1.default.EMPTY)):(d.current=e,setTimeout(function(){return p(!0),c.current.page=c.current.page+1,a=l.list,g(function(r){h(function(e){var t;return tslib_1.__assign(tslib_1.__assign({},r),((t={})[l.list]=tslib_1.__spreadArray(tslib_1.__spreadArray([],tslib_1.__read(e[a]),!1),tslib_1.__read(r[a]),!1),t))})});var a},100))},[]),L=(0,react_1.useCallback)(function(){return 1===c.current.page&&0===b[l.list].length},[b,l,c.current.page]),f=(0,react_1.useMemo)(function(){return react_1.default.createElement(List_1.default,tslib_1.__assign({getScrollWrapContainer:_,isLoading:m,hasMore:b[l.list].length<=b[l.totalCount],onLoadMore:v,renderFirstLoading:n},a||{}),react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:!L(),noMatch:function(){return u()}},function(){return null==o?void 0:o(b)}))},[_,m,b,l.totalCount,l.list,n,a,u]);return(0,react_1.useEffect)(function(){p(!0),c.current={page:1,limit:t},g(function(e){h(e)})},[]),(0,react_1.useLayoutEffect)(function(){d.current&&(s.current=c.current.page<b[l.totalPage]?adhere_ui_scrollload_1.default.NORMAL:adhere_ui_scrollload_1.default.EMPTY,null!=d&&d.current(s.current))},[b]),react_1.default.createElement(VerticalFlexLayout,tslib_1.__assign({},e||{},{className:"".concat(selectorPrefix),renderMain:react_1.default.createElement("div",{className:"".concat(selectorPrefix,"-auto"),ref:i},f)}))};exports.default=(0,react_1.memo)(ListStandard);
//# sourceMappingURL=index.js.map
