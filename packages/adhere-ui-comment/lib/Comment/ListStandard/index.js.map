{"version":3,"file":"index.js","sources":["Comment/ListStandard/index.js"],"sourcesContent":["\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar tslib_1 = require(\"tslib\");\r\nvar antd_1 = require(\"antd\");\r\nvar react_1 = tslib_1.__importStar(require(\"react\"));\r\nvar adhere_ui_conditionalrender_1 = tslib_1.__importDefault(require(\"@baifendian/adhere-ui-conditionalrender\"));\r\nvar adhere_ui_flexlayout_1 = tslib_1.__importDefault(require(\"@baifendian/adhere-ui-flexlayout\"));\r\nvar adhere_ui_scrollload_1 = tslib_1.__importDefault(require(\"@baifendian/adhere-ui-scrollload\"));\r\nvar List_1 = tslib_1.__importDefault(require(\"../List\"));\r\nvar VerticalFlexLayout = adhere_ui_flexlayout_1.default.VerticalFlexLayout;\r\nvar selectorPrefix = 'adhere-ui-comment-list-standard';\r\n/**\r\n * ListStandard\r\n * @param props\r\n * @return {JSX.Element}\r\n * @constructor\r\n * @classdesc 上拉下拽\r\n */\r\nvar ListStandard = function (props) {\r\n    var _a;\r\n    var _b = props.limit, limit = _b === void 0 ? 10 : _b, _c = props.dataKeys, dataKeys = _c === void 0 ? {\r\n        current: 'current',\r\n        totalPage: 'totalPage',\r\n        list: 'list',\r\n        totalCount: 'totalCount',\r\n    } : _c, _d = props.listProps, listProps = _d === void 0 ? {} : _d, _e = props.flexLayoutProps, flexLayoutProps = _e === void 0 ? {} : _e, renderFirstLoading = props.renderFirstLoading, _f = props.renderEmpty, renderEmpty = _f === void 0 ? function () { return react_1.default.createElement(antd_1.Empty, null); } : _f, renderList = props.renderList, getScrollWrapContainer = props.getScrollWrapContainer;\r\n    var paging = (0, react_1.useRef)({\r\n        page: 1,\r\n        limit: limit,\r\n    });\r\n    var callbackHandler = (0, react_1.useRef)();\r\n    var status = (0, react_1.useRef)(adhere_ui_scrollload_1.default.NORMAL);\r\n    var mainRef = (0, react_1.useRef)(null);\r\n    var _g = tslib_1.__read((0, react_1.useState)((_a = {},\r\n        _a[dataKeys.current] = 1,\r\n        _a[dataKeys.totalPage] = 0,\r\n        _a[dataKeys.list] = [],\r\n        _a[dataKeys.totalCount] = 0,\r\n        _a)), 2), data = _g[0], setData = _g[1];\r\n    var _h = tslib_1.__read((0, react_1.useState)(true), 2), loading = _h[0], setLoading = _h[1];\r\n    /**\r\n     * loadData\r\n     * @description 重新加载数据\r\n     * @return {*}\r\n     */\r\n    function loadData() {\r\n        setLoading(true);\r\n        paging.current = {\r\n            page: 1,\r\n            limit: limit,\r\n        };\r\n        return fetchData(function (res) { return setData(res); });\r\n    }\r\n    /**\r\n     * appendData\r\n     * @description 加载更多\r\n     * @return {*}\r\n     */\r\n    function appendData() {\r\n        setLoading(true);\r\n        paging.current.page = paging.current.page + 1;\r\n        var list = dataKeys.list;\r\n        return fetchData(function (res) {\r\n            setData(function (_data) {\r\n                var _a;\r\n                return tslib_1.__assign(tslib_1.__assign({}, res), (_a = {}, _a[dataKeys.list] = tslib_1.__spreadArray(tslib_1.__spreadArray([], tslib_1.__read(_data[list]), false), tslib_1.__read(res[list]), false), _a));\r\n            });\r\n        });\r\n    }\r\n    /**\r\n     * fetchData\r\n     * @description 调用接口\r\n     */\r\n    function fetchData(callback) {\r\n        var _a;\r\n        return (_a = props === null || props === void 0 ? void 0 : props.fetchData) === null || _a === void 0 ? void 0 : _a.call(props, paging === null || paging === void 0 ? void 0 : paging.current).then(function (data) {\r\n            callback(data);\r\n            setLoading(false);\r\n            return data;\r\n        }).catch(function (error) {\r\n            var _a;\r\n            setLoading(false);\r\n            if (callbackHandler.current) {\r\n                status.current = adhere_ui_scrollload_1.default.ERROR;\r\n                (_a = callbackHandler === null || callbackHandler === void 0 ? void 0 : callbackHandler.current) === null || _a === void 0 ? void 0 : _a.call(callbackHandler, status.current);\r\n            }\r\n            return error;\r\n        });\r\n    }\r\n    /**\r\n     * onLoadMore\r\n     * @param callback\r\n     */\r\n    var onLoadMore = (0, react_1.useCallback)(function (callback) {\r\n        if (status.current === adhere_ui_scrollload_1.default.EMPTY) {\r\n            status.current = adhere_ui_scrollload_1.default.EMPTY;\r\n            callback(adhere_ui_scrollload_1.default.EMPTY);\r\n            return;\r\n        }\r\n        callbackHandler.current = callback;\r\n        setTimeout(function () { return appendData(); }, 100);\r\n    }, []);\r\n    /**\r\n     * isEmpty\r\n     * @return {boolean}\r\n     */\r\n    var isEmpty = (0, react_1.useCallback)(function () { return paging.current.page === 1 && data[dataKeys.list].length === 0; }, [data, dataKeys, paging.current.page]);\r\n    var _CommentList = (0, react_1.useMemo)(function () { return (react_1.default.createElement(List_1.default, tslib_1.__assign({ getScrollWrapContainer: getScrollWrapContainer, isLoading: loading, hasMore: data[dataKeys.list].length <= data[dataKeys.totalCount], onLoadMore: onLoadMore, renderFirstLoading: renderFirstLoading }, (listProps || {})),\r\n        react_1.default.createElement(adhere_ui_conditionalrender_1.default, { conditional: !isEmpty(), noMatch: function () { return renderEmpty(); } }, function () { return renderList === null || renderList === void 0 ? void 0 : renderList(data); }))); }, [\r\n        getScrollWrapContainer,\r\n        loading,\r\n        data,\r\n        dataKeys.totalCount,\r\n        dataKeys.list,\r\n        renderFirstLoading,\r\n        listProps,\r\n        renderEmpty,\r\n    ]);\r\n    (0, react_1.useEffect)(function () {\r\n        loadData();\r\n    }, []);\r\n    (0, react_1.useLayoutEffect)(function () {\r\n        if (callbackHandler.current) {\r\n            status.current =\r\n                paging.current.page < data[dataKeys.totalPage] ? adhere_ui_scrollload_1.default.NORMAL : adhere_ui_scrollload_1.default.EMPTY;\r\n            callbackHandler === null || callbackHandler === void 0 ? void 0 : callbackHandler.current(status.current);\r\n        }\r\n    }, [data]);\r\n    return (react_1.default.createElement(VerticalFlexLayout, tslib_1.__assign({}, (flexLayoutProps || {}), { className: \"\".concat(selectorPrefix), renderMain: react_1.default.createElement(\"div\", { className: \"\".concat(selectorPrefix, \"-auto\"), ref: mainRef }, _CommentList) })));\r\n};\r\nexports.default = (0, react_1.memo)(ListStandard);\r\n//# sourceMappingURL=index.js.map"],"names":["Object","defineProperty","exports","value","tslib_1","require","antd_1","react_1","__importStar","adhere_ui_conditionalrender_1","__importDefault","adhere_ui_flexlayout_1","adhere_ui_scrollload_1","List_1","VerticalFlexLayout","default","selectorPrefix","ListStandard","props","_b","limit","_c","dataKeys","current","totalPage","list","totalCount","_d","listProps","_e","flexLayoutProps","renderFirstLoading","_f","renderEmpty","createElement","Empty","renderList","getScrollWrapContainer","paging","useRef","page","callbackHandler","status","NORMAL","mainRef","_g","__read","useState","_a","data","setData","_h","loading","setLoading","fetchData","callback","call","then","catch","error","ERROR","onLoadMore","useCallback","EMPTY","setTimeout","res","_data","__assign","__spreadArray","isEmpty","length","_CommentList","useMemo","isLoading","hasMore","conditional","noMatch","useEffect","useLayoutEffect","className","concat","renderMain","ref","memo"],"mappings":"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"}