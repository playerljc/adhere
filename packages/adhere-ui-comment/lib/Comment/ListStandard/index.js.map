{"version":3,"file":"index.js","sources":["Comment/ListStandard/index.js"],"sourcesContent":["\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\nvar _empty = _interopRequireDefault(require(\"antd/lib/empty\"));\nvar _react = _interopRequireWildcard(require(\"react\"));\nvar _adhereUiConditionalrender = _interopRequireDefault(require(\"@baifendian/adhere-ui-conditionalrender\"));\nvar _adhereUiFlexlayout = _interopRequireDefault(require(\"@baifendian/adhere-ui-flexlayout\"));\nvar _adhereUiScrollload = _interopRequireDefault(require(\"@baifendian/adhere-ui-scrollload\"));\nvar _List = _interopRequireDefault(require(\"../List\"));\nfunction _getRequireWildcardCache(e) { if (\"function\" != typeof WeakMap) return null; var r = new WeakMap(), t = new WeakMap(); return (_getRequireWildcardCache = function (e) { return e ? t : r; })(e); }\nfunction _interopRequireWildcard(e, r) { if (!r && e && e.__esModule) return e; if (null === e || \"object\" != typeof e && \"function\" != typeof e) return { default: e }; var t = _getRequireWildcardCache(r); if (t && t.has(e)) return t.get(e); var n = { __proto__: null }, a = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var u in e) if (\"default\" !== u && {}.hasOwnProperty.call(e, u)) { var i = a ? Object.getOwnPropertyDescriptor(e, u) : null; i && (i.get || i.set) ? Object.defineProperty(n, u, i) : n[u] = e[u]; } return n.default = e, t && t.set(e, n), n; }\nvar __assign = void 0 && (void 0).__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n    return t;\n  };\n  return __assign.apply(this, arguments);\n};\nvar __spreadArray = void 0 && (void 0).__spreadArray || function (to, from, pack) {\n  if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n    if (ar || !(i in from)) {\n      if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n      ar[i] = from[i];\n    }\n  }\n  return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar VerticalFlexLayout = _adhereUiFlexlayout.default.VerticalFlexLayout;\nvar selectorPrefix = 'adhere-ui-comment-list-standard';\nvar DEFAULT_KEYS = {\n  current: 'current',\n  totalPage: 'totalPage',\n  list: 'list',\n  totalCount: 'totalCount'\n};\nvar DEFAULT_RENDER_EMPTY = function () {\n  return /*#__PURE__*/_react.default.createElement(_empty.default, null);\n};\n/**\n * ListStandard\n * @param props\n * @return {JSX.Element}\n * @constructor\n * @classdesc 上拉下拽\n */\nvar ListStandard = /*#__PURE__*/(0, _react.memo)(function (props) {\n  var _a;\n  var _b = props.limit,\n    limit = _b === void 0 ? 10 : _b,\n    _c = props.dataKeys,\n    dataKeys = _c === void 0 ? DEFAULT_KEYS : _c,\n    _d = props.listProps,\n    listProps = _d === void 0 ? {} : _d,\n    _e = props.flexLayoutProps,\n    flexLayoutProps = _e === void 0 ? {} : _e,\n    renderFirstLoading = props.renderFirstLoading,\n    _f = props.renderEmpty,\n    renderEmpty = _f === void 0 ? DEFAULT_RENDER_EMPTY : _f,\n    renderList = props.renderList;\n  var paging = (0, _react.useRef)({\n    page: 1,\n    limit: limit\n  });\n  var callbackHandler = (0, _react.useRef)();\n  var status = (0, _react.useRef)(_adhereUiScrollload.default.NORMAL);\n  var mainRef = (0, _react.useRef)(null);\n  var _g = (0, _react.useState)((_a = {}, _a[dataKeys.current] = 1, _a[dataKeys.totalPage] = 0, _a[dataKeys.list] = [], _a[dataKeys.totalCount] = 0, _a)),\n    data = _g[0],\n    setData = _g[1];\n  var _h = (0, _react.useState)(true),\n    loading = _h[0],\n    setLoading = _h[1];\n  /**\n   * loadData\n   * @description 重新加载数据\n   * @return {*}\n   */\n  function loadData() {\n    setLoading(true);\n    paging.current = {\n      page: 1,\n      limit: limit\n    };\n    return fetchData(function (res) {\n      return setData(res);\n    });\n  }\n  /**\n   * appendData\n   * @description 加载更多\n   * @return {*}\n   */\n  function appendData() {\n    setLoading(true);\n    paging.current.page = paging.current.page + 1;\n    var list = dataKeys.list;\n    return fetchData(function (res) {\n      setData(function (_data) {\n        var _a;\n        return __assign(__assign({}, res), (_a = {}, _a[dataKeys.list] = __spreadArray(__spreadArray([], _data[list], true), res[list], true), _a));\n      });\n    });\n  }\n  /**\n   * fetchData\n   * @description 调用接口\n   */\n  function fetchData(callback) {\n    var _a;\n    return (_a = props === null || props === void 0 ? void 0 : props.fetchData) === null || _a === void 0 ? void 0 : _a.call(props, paging === null || paging === void 0 ? void 0 : paging.current).then(function (data) {\n      callback(data);\n      setLoading(false);\n      return data;\n    }).catch(function (error) {\n      var _a;\n      setLoading(false);\n      if (callbackHandler.current) {\n        status.current = _adhereUiScrollload.default.ERROR;\n        (_a = callbackHandler === null || callbackHandler === void 0 ? void 0 : callbackHandler.current) === null || _a === void 0 ? void 0 : _a.call(callbackHandler, status.current);\n      }\n      return error;\n    });\n  }\n  /**\n   * onLoadMore\n   * @param callback\n   */\n  var onLoadMore = (0, _react.useCallback)(function (callback) {\n    // if (status.current === ScrollLoad.EMPTY) {\n    //   status.current = ScrollLoad.EMPTY;\n    //   callback(ScrollLoad.EMPTY);\n    //   return;\n    // }\n    callbackHandler.current = callback;\n    setTimeout(function () {\n      return appendData();\n    }, 100);\n  }, []);\n  /**\n   * isEmpty\n   * @return {boolean}\n   */\n  var isEmpty = (0, _react.useCallback)(function () {\n    return paging.current.page === 1 && data[dataKeys.list].length === 0;\n  }, [data, dataKeys, paging.current.page]);\n  var _CommentList = (0, _react.useMemo)(function () {\n    return /*#__PURE__*/_react.default.createElement(_List.default, __assign({\n      isLoading: loading,\n      // @ts-ignore\n      hasMore: data[dataKeys.list].length <= data[dataKeys.totalCount],\n      onLoadMore: onLoadMore,\n      renderFirstLoading: renderFirstLoading\n    }, listProps !== null && listProps !== void 0 ? listProps : {}, {\n      pages: data[dataKeys.totalPage]\n    }), /*#__PURE__*/_react.default.createElement(_adhereUiConditionalrender.default, {\n      conditional: !isEmpty(),\n      noMatch: function () {\n        return renderEmpty();\n      }\n    }, function () {\n      return renderList === null || renderList === void 0 ? void 0 : renderList(data);\n    }));\n  }, [loading, data, dataKeys.totalCount, dataKeys.list, renderFirstLoading, listProps, renderEmpty]);\n  (0, _react.useEffect)(function () {\n    loadData();\n  }, []);\n  (0, _react.useLayoutEffect)(function () {\n    if (callbackHandler.current) {\n      var totalPage = data[dataKeys.totalPage];\n      status.current =\n      // @ts-ignore\n      paging.current.page < totalPage ? _adhereUiScrollload.default.NORMAL : _adhereUiScrollload.default.EMPTY;\n      callbackHandler === null || callbackHandler === void 0 ? void 0 : callbackHandler.current(status.current);\n    }\n  }, [data]);\n  return /*#__PURE__*/_react.default.createElement(VerticalFlexLayout, __assign({}, flexLayoutProps !== null && flexLayoutProps !== void 0 ? flexLayoutProps : {}, {\n    className: \"\".concat(selectorPrefix),\n    renderMain: /*#__PURE__*/_react.default.createElement(\"div\", {\n      className: \"\".concat(selectorPrefix, \"-auto\"),\n      ref: mainRef\n    }, _CommentList)\n  }));\n});\nListStandard.displayName = 'ListStandard';\nvar _default = exports.default = ListStandard;"],"names":["_interopRequireDefault","require","_empty","Object","defineProperty","exports","value","default","_react","_interopRequireWildcard","_adhereUiConditionalrender","_adhereUiFlexlayout","_adhereUiScrollload","_List","_getRequireWildcardCache","e","r","t","WeakMap","__esModule","has","get","u","i","n","__proto__","a","getOwnPropertyDescriptor","hasOwnProperty","call","set","__assign","assign","s","arguments","length","p","prototype","apply","this","__spreadArray","to","from","pack","ar","l","Array","slice","concat","VerticalFlexLayout","selectorPrefix","DEFAULT_KEYS","current","totalPage","list","totalCount","DEFAULT_RENDER_EMPTY","createElement","ListStandard","memo","props","_b","limit","_c","dataKeys","_d","listProps","_e","flexLayoutProps","renderFirstLoading","_f","renderEmpty","renderList","paging","useRef","page","callbackHandler","status","NORMAL","mainRef","_g","useState","_a","data","setData","_h","loading","setLoading","fetchData","callback","then","catch","error","ERROR","onLoadMore","useCallback","setTimeout","res","_data","isEmpty","_CommentList","useMemo","isLoading","hasMore","pages","conditional","noMatch","useEffect","useLayoutEffect","EMPTY","className","renderMain","ref","_default","displayName"],"mappings":"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"}