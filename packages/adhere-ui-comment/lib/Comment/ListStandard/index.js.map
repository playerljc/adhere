{"version":3,"file":"index.js","sources":["Comment/ListStandard/index.js"],"sourcesContent":["\"use strict\";\n\nrequire(\"core-js/modules/es.object.define-property.js\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar tslib_1 = require(\"tslib\");\n\nvar antd_1 = require(\"antd\");\n\nvar react_1 = tslib_1.__importStar(require(\"react\"));\n\nvar adhere_ui_conditionalrender_1 = tslib_1.__importDefault(require(\"@baifendian/adhere-ui-conditionalrender\"));\n\nvar adhere_ui_flexlayout_1 = tslib_1.__importDefault(require(\"@baifendian/adhere-ui-flexlayout\"));\n\nvar adhere_ui_scrollload_1 = tslib_1.__importDefault(require(\"@baifendian/adhere-ui-scrollload\"));\n\nvar List_1 = tslib_1.__importDefault(require(\"../List\"));\n\nvar VerticalFlexLayout = adhere_ui_flexlayout_1.default.VerticalFlexLayout;\nvar selectorPrefix = 'adhere-ui-comment-list-standard';\n/**\n * ListStandard\n * @param props\n * @return {JSX.Element}\n * @constructor\n * @classdesc 上拉下拽\n */\n\nvar ListStandard = function ListStandard(props) {\n  var _a;\n\n  var _b = props.limit,\n      limit = _b === void 0 ? 10 : _b,\n      _c = props.dataKeys,\n      dataKeys = _c === void 0 ? {\n    current: 'current',\n    totalPage: 'totalPage',\n    list: 'list',\n    totalCount: 'totalCount'\n  } : _c,\n      _d = props.listProps,\n      listProps = _d === void 0 ? {} : _d,\n      _e = props.flexLayoutProps,\n      flexLayoutProps = _e === void 0 ? {} : _e,\n      renderFirstLoading = props.renderFirstLoading,\n      _f = props.renderEmpty,\n      renderEmpty = _f === void 0 ? function () {\n    return react_1.default.createElement(antd_1.Empty, null);\n  } : _f,\n      renderList = props.renderList,\n      getScrollWrapContainer = props.getScrollWrapContainer;\n  var paging = (0, react_1.useRef)({\n    page: 1,\n    limit: limit\n  });\n  var callbackHandler = (0, react_1.useRef)();\n  var status = (0, react_1.useRef)(adhere_ui_scrollload_1.default.NORMAL);\n  var mainRef = (0, react_1.useRef)(null);\n\n  var _g = tslib_1.__read((0, react_1.useState)((_a = {}, _a[dataKeys.current] = 1, _a[dataKeys.totalPage] = 0, _a[dataKeys.list] = [], _a[dataKeys.totalCount] = 0, _a)), 2),\n      data = _g[0],\n      setData = _g[1];\n\n  var _h = tslib_1.__read((0, react_1.useState)(true), 2),\n      loading = _h[0],\n      setLoading = _h[1];\n  /**\n   * loadData\n   * @description 重新加载数据\n   * @return {*}\n   */\n\n\n  function loadData() {\n    setLoading(true);\n    paging.current = {\n      page: 1,\n      limit: limit\n    };\n    return fetchData(function (res) {\n      return setData(res);\n    });\n  }\n  /**\n   * appendData\n   * @description 加载更多\n   * @return {*}\n   */\n\n\n  function appendData() {\n    setLoading(true);\n    paging.current.page = paging.current.page + 1;\n    var list = dataKeys.list;\n    return fetchData(function (res) {\n      setData(function (_data) {\n        var _a;\n\n        return tslib_1.__assign(tslib_1.__assign({}, res), (_a = {}, _a[dataKeys.list] = tslib_1.__spreadArray(tslib_1.__spreadArray([], tslib_1.__read(_data[list]), false), tslib_1.__read(res[list]), false), _a));\n      });\n    });\n  }\n  /**\n   * fetchData\n   * @description 调用接口\n   */\n\n\n  function fetchData(callback) {\n    var _a;\n\n    return (_a = props === null || props === void 0 ? void 0 : props.fetchData) === null || _a === void 0 ? void 0 : _a.call(props, paging === null || paging === void 0 ? void 0 : paging.current).then(function (data) {\n      callback(data);\n      setLoading(false);\n      return data;\n    }).catch(function (error) {\n      var _a;\n\n      setLoading(false);\n\n      if (callbackHandler.current) {\n        status.current = adhere_ui_scrollload_1.default.ERROR;\n        (_a = callbackHandler === null || callbackHandler === void 0 ? void 0 : callbackHandler.current) === null || _a === void 0 ? void 0 : _a.call(callbackHandler, status.current);\n      }\n\n      return error;\n    });\n  }\n  /**\n   * onLoadMore\n   * @param callback\n   */\n\n\n  var onLoadMore = (0, react_1.useCallback)(function (callback) {\n    if (status.current === adhere_ui_scrollload_1.default.EMPTY) {\n      status.current = adhere_ui_scrollload_1.default.EMPTY;\n      callback(adhere_ui_scrollload_1.default.EMPTY);\n      return;\n    }\n\n    callbackHandler.current = callback;\n    setTimeout(function () {\n      return appendData();\n    }, 100);\n  }, []);\n  /**\n   * isEmpty\n   * @return {boolean}\n   */\n\n  var isEmpty = (0, react_1.useCallback)(function () {\n    return paging.current.page === 1 && data[dataKeys.list].length === 0;\n  }, [data, dataKeys, paging.current.page]);\n\n  var _CommentList = (0, react_1.useMemo)(function () {\n    return react_1.default.createElement(List_1.default, tslib_1.__assign({\n      getScrollWrapContainer: getScrollWrapContainer,\n      isLoading: loading,\n      hasMore: data[dataKeys.list].length <= data[dataKeys.totalCount],\n      onLoadMore: onLoadMore,\n      renderFirstLoading: renderFirstLoading\n    }, listProps || {}), react_1.default.createElement(adhere_ui_conditionalrender_1.default, {\n      conditional: !isEmpty(),\n      noMatch: function noMatch() {\n        return renderEmpty();\n      }\n    }, function () {\n      return renderList === null || renderList === void 0 ? void 0 : renderList(data);\n    }));\n  }, [getScrollWrapContainer, loading, data, dataKeys.totalCount, dataKeys.list, renderFirstLoading, listProps, renderEmpty]);\n\n  (0, react_1.useEffect)(function () {\n    loadData();\n  }, []);\n  (0, react_1.useLayoutEffect)(function () {\n    if (callbackHandler.current) {\n      status.current = paging.current.page < data[dataKeys.totalPage] ? adhere_ui_scrollload_1.default.NORMAL : adhere_ui_scrollload_1.default.EMPTY;\n      callbackHandler === null || callbackHandler === void 0 ? void 0 : callbackHandler.current(status.current);\n    }\n  }, [data]);\n  return react_1.default.createElement(VerticalFlexLayout, tslib_1.__assign({}, flexLayoutProps || {}, {\n    className: \"\".concat(selectorPrefix),\n    renderMain: react_1.default.createElement(\"div\", {\n      className: \"\".concat(selectorPrefix, \"-auto\"),\n      ref: mainRef\n    }, _CommentList)\n  }));\n};\n\nexports.default = (0, react_1.memo)(ListStandard);"],"names":["require","Object","defineProperty","exports","value","tslib_1","antd_1","react_1","__importStar","adhere_ui_conditionalrender_1","__importDefault","adhere_ui_flexlayout_1","adhere_ui_scrollload_1","List_1","VerticalFlexLayout","default","selectorPrefix","ListStandard","props","_b","limit","_c","dataKeys","current","totalPage","list","totalCount","_d","listProps","_e","flexLayoutProps","renderFirstLoading","_f","renderEmpty","createElement","Empty","renderList","getScrollWrapContainer","paging","useRef","page","callbackHandler","status","NORMAL","mainRef","_g","__read","useState","_a","data","setData","_h","loading","setLoading","fetchData","callback","call","then","catch","error","ERROR","onLoadMore","useCallback","EMPTY","setTimeout","res","_data","__assign","__spreadArray","isEmpty","length","_CommentList","useMemo","isLoading","hasMore","conditional","noMatch","useEffect","useLayoutEffect","className","concat","renderMain","ref","memo"],"mappings":"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"}