"use strict";require("core-js/modules/es.object.define-property.js"),require("core-js/modules/es.array.map.js"),Object.defineProperty(exports,"__esModule",{value:!0}),exports.propTypes=exports.defaultProps=void 0;var tslib_1=require("tslib"),react_1=tslib_1.__importStar(require("react")),prop_types_1=tslib_1.__importDefault(require("prop-types")),classnames_1=tslib_1.__importDefault(require("classnames")),adhere_ui_conditionalrender_1=tslib_1.__importDefault(require("@baifendian/adhere-ui-conditionalrender")),adhere_ui_flexlayout_1=tslib_1.__importDefault(require("@baifendian/adhere-ui-flexlayout")),adhere_util_intl_1=tslib_1.__importDefault(require("@baifendian/adhere-util-intl")),adhere_util_1=tslib_1.__importDefault(require("@baifendian/adhere-util")),Submit_1=tslib_1.__importDefault(require("../../Reply/Submit")),Info_1=tslib_1.__importDefault(require("../../Reply/Info")),selectorPrefix="adhere-ui-comment-node";function Node(l){var e=tslib_1.__read((0,react_1.useState)(((t={})[l.dataKeys.current]=1,t[l.dataKeys.list]=[],t[l.dataKeys.totalCount]=0,t[l.dataKeys.totalPage]=0,t)),2),r=e[0],n=e[1],t=tslib_1.__read((0,react_1.useState)(null==l?void 0:l.data),2),a=t[0],o=t[1],e=tslib_1.__read((0,react_1.useState)(!1),2),i=e[0],d=e[1],t=tslib_1.__read((0,react_1.useState)(!1),2),u=t[0],c=t[1],e=tslib_1.__read((0,react_1.useState)(!1),2),t=e[0],_=e[1],s=(0,react_1.useRef)({page:1,limit:l.limit});function p(){var e,t;return react_1.default.createElement("ul",{className:"".concat(selectorPrefix,"-children")},null===(t=null===(e=r[l.dataKeys.list]||[])?void 0:e.map)||void 0===t?void 0:t.call(e,function(t){return react_1.default.createElement("li",{className:"".concat(selectorPrefix,"-children-item"),key:t[l.keyProp]},react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:!(null!=l&&l.children),noMatch:function(){var e;return null===(e=null==l?void 0:l.children)||void 0===e?void 0:e.call(l,t)}},function(){return react_1.default.createElement(Info_1.default,{isReply:!0,data:t,keyProp:l.keyProp,isMoreProp:l.isMoreProp,fetchData:l.fetchData,renderActions:l.renderActions,renderAuthor:l.renderAuthor,renderAvatar:l.renderAvatar,renderContent:l.renderContent,renderDateTime:l.renderDateTime,renderLoading:l.renderLoading,showReplyText:l.showReplyText,hideReplyText:l.hideReplyText,loadMoreReplyText:l.loadMoreReplyText,showReplyTextIcon:l.showReplyTextIcon,hideReplyTextIcon:l.hideReplyTextIcon,loadMoreCollapseTextIcon:l.loadMoreCollapseTextIcon})}))}),react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:!u&&r[l.dataKeys.list].length<=r[l.dataKeys.totalCount]},function(){return react_1.default.createElement("li",{className:(0,classnames_1.default)("".concat(selectorPrefix,"-children-item"),"more")},react_1.default.createElement("a",{onClick:y},react_1.default.createElement("span",null,react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:adhere_util_1.default.isFunction(null==l?void 0:l.loadMoreCollapseTextIcon),noMatch:function(){return null==l?void 0:l.loadMoreCollapseTextIcon}},function(){return(null==l?void 0:l.loadMoreCollapseTextIcon)()})),react_1.default.createElement("span",null,react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:adhere_util_1.default.isFunction(l.loadMoreReplyText),noMatch:function(){return l.loadMoreReplyText}},function(){return(null==l?void 0:l.loadMoreReplyText)()}))))}))}function f(){return c(!0),s.current={page:1,limit:l.limit},m(function(e){n(e)})}function y(){c(!0),s.current.page=s.current.page+1;var a=l.dataKeys.list;return m(function(e){var t;n(tslib_1.__assign(tslib_1.__assign({},e),((t={})[l.dataKeys.list]=tslib_1.__spreadArray(tslib_1.__spreadArray([],tslib_1.__read(r[a]),!1),tslib_1.__read(e[a]),!1),t)))})}function m(t){var e;return null===(e=null==l?void 0:l.fetchData)||void 0===e?void 0:e.call(l,tslib_1.__assign(tslib_1.__assign({},s.current),{record:tslib_1.__assign({},a)})).then(function(e){return t(e),c(!1),e}).catch(function(e){return c(!1),e})}return(0,react_1.useEffect)(function(){o(l.data)},[null==l?void 0:l.data]),react_1.default.createElement(adhere_ui_flexlayout_1.default,{direction:"horizontal",className:(0,classnames_1.default)(selectorPrefix,l.isReply?"".concat(selectorPrefix,"-reply"):null)},react_1.default.createElement(adhere_ui_flexlayout_1.default.Fixed,{className:"".concat(selectorPrefix,"-avatar-wrap")},null===(e=null==l?void 0:l.renderAvatar)||void 0===e?void 0:e.call(l,tslib_1.__assign({},a))),react_1.default.createElement(adhere_ui_flexlayout_1.default.Auto,{autoFixed:!0,fit:!0},react_1.default.createElement(adhere_ui_flexlayout_1.default,{direction:"vertical"},react_1.default.createElement(adhere_ui_flexlayout_1.default.Fixed,{className:"".concat(selectorPrefix,"-title-row"),fit:!1},react_1.default.createElement("div",{className:"".concat(selectorPrefix,"-title-row-author")},null===(e=null==l?void 0:l.renderAuthor)||void 0===e?void 0:e.call(l,tslib_1.__assign({},a))),react_1.default.createElement("div",{className:"".concat(selectorPrefix,"-title-row-date-time")},null===(e=null==l?void 0:l.renderDateTime)||void 0===e?void 0:e.call(l,tslib_1.__assign({},a)))),react_1.default.createElement(adhere_ui_flexlayout_1.default.Auto,{className:"".concat(selectorPrefix,"-content-wrap")},null===(e=null==l?void 0:l.renderContent)||void 0===e?void 0:e.call(l,tslib_1.__assign({},a))),react_1.default.createElement(adhere_ui_flexlayout_1.default.Fixed,null,react_1.default.createElement("ul",{className:"".concat(selectorPrefix,"-actions")},tslib_1.__spreadArray(tslib_1.__spreadArray([],tslib_1.__read(((null===(e=null==l?void 0:l.renderActions)||void 0===e?void 0:e.call(l,tslib_1.__assign({},a),function(e){o(e)}))||[]).map(function(e,t){return react_1.default.createElement("li",{key:t,className:"".concat(selectorPrefix,"-actions-action")},e)})),!1),[react_1.default.createElement("li",{className:(0,classnames_1.default)("".concat(selectorPrefix,"-actions-action"),"".concat(selectorPrefix,"-actions-action-reply-btn")),onClick:function(){return _(!0)}},adhere_util_intl_1.default.v("回复"))],!1))),react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:t},function(){return react_1.default.createElement(adhere_ui_flexlayout_1.default.Fixed,{style:{marginTop:15}},react_1.default.createElement(Submit_1.default,{onCancel:function(){return _(!1)},onResult:function(e){var t;null!==(e=null===(t=null==l?void 0:l.fetchReply)||void 0===t?void 0:t.call(l,{id:null==a?void 0:a[l.keyProp],record:tslib_1.__assign({},a),reply:e}))&&void 0!==e&&e.then(function(){_(!1),f()})},local:l.local}))}),react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:null==a?void 0:a[l.isMoreProp]},function(){return react_1.default.createElement(react_1.default.Fragment,null,react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:!u},function(){return react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:!i,noMatch:function(){return react_1.default.createElement("a",{className:"".concat(selectorPrefix,"-collapse"),onClick:function(){d(!1)}},react_1.default.createElement("span",null,react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:adhere_util_1.default.isFunction(l.hideReplyTextIcon),noMatch:function(){return l.hideReplyTextIcon}},function(){return(null==l?void 0:l.hideReplyTextIcon)()})),react_1.default.createElement("span",null,react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:adhere_util_1.default.isFunction(l.hideReplyText),noMatch:function(){return l.hideReplyText}},function(){return(null==l?void 0:l.hideReplyText)()})))}},function(){return react_1.default.createElement("a",{className:"".concat(selectorPrefix,"-collapse"),onClick:function(){var e;r[l.dataKeys.list].length?d(!0):null!==(e=f())&&void 0!==e&&e.then(function(){d(!0)})}},react_1.default.createElement("span",null,react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:adhere_util_1.default.isFunction(l.showReplyTextIcon),noMatch:function(){return l.showReplyTextIcon}},function(){return(null==l?void 0:l.showReplyTextIcon)()})),react_1.default.createElement("span",null,react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:adhere_util_1.default.isFunction(l.showReplyText),noMatch:function(){return l.showReplyText}},function(){return(null==l?void 0:l.showReplyText)()})))})}),react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:i},p),react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:u},function(){var e;return null===(e=null==l?void 0:l.renderLoading)||void 0===e?void 0:e.call(l)}))}))))}exports.defaultProps={isReply:!1,limit:10,dataKeys:{current:"current",totalPage:"totalPage",list:"list",totalCount:"totalCount"},local:"zh"},exports.propTypes={isReply:prop_types_1.default.bool,data:prop_types_1.default.shape({key:prop_types_1.default.string}),dataKeys:prop_types_1.default.shape({current:prop_types_1.default.string,totalPage:prop_types_1.default.string,list:prop_types_1.default.string,totalCount:prop_types_1.default.string}),renderLoading:prop_types_1.default.func,limit:prop_types_1.default.number,fetchData:prop_types_1.default.func,fetchReply:prop_types_1.default.func,keyProp:prop_types_1.default.string,isMoreProp:prop_types_1.default.string,renderActions:prop_types_1.default.func,renderAuthor:prop_types_1.default.func,renderAvatar:prop_types_1.default.func,renderContent:prop_types_1.default.func,renderDateTime:prop_types_1.default.func,showReplyText:prop_types_1.default.oneOfType([prop_types_1.default.string,prop_types_1.default.func]),hideReplyText:prop_types_1.default.oneOfType([prop_types_1.default.string,prop_types_1.default.func]),loadMoreReplyText:prop_types_1.default.oneOfType([prop_types_1.default.string,prop_types_1.default.func]),showReplyTextIcon:prop_types_1.default.oneOfType([prop_types_1.default.node,prop_types_1.default.func]),hideReplyTextIcon:prop_types_1.default.oneOfType([prop_types_1.default.node,prop_types_1.default.func]),loadMoreCollapseTextIcon:prop_types_1.default.oneOfType([prop_types_1.default.node,prop_types_1.default.func]),local:prop_types_1.default.string},Node.defaultProps=exports.defaultProps,Node.propTypes=exports.propTypes,exports.default=Node;
//# sourceMappingURL=index.js.map
