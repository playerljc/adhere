"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_typeof=require("@babel/runtime/helpers/typeof"),_classnames=(Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0,_interopRequireDefault(require("classnames"))),_react=_interopRequireWildcard(require("react")),_adhereUiConditionalrender=_interopRequireDefault(require("@baifendian/adhere-ui-conditionalrender")),_adhereUiFlexlayout=_interopRequireDefault(require("@baifendian/adhere-ui-flexlayout")),_adhereUtil=_interopRequireDefault(require("@baifendian/adhere-util")),_adhereUtilIntl=_interopRequireDefault(require("@baifendian/adhere-util-intl")),_Info=_interopRequireDefault(require("../../Reply/Info")),_Submit=_interopRequireDefault(require("../../Reply/Submit"));function _getRequireWildcardCache(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(_getRequireWildcardCache=function(e){return e?n:t})(e))}function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=_typeof(e)&&"function"!=typeof e)return{default:e};t=_getRequireWildcardCache(t);if(t&&t.has(e))return t.get(e);var n,a,r={__proto__:null},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((a=l?Object.getOwnPropertyDescriptor(e,n):null)&&(a.get||a.set)?Object.defineProperty(r,n,a):r[n]=e[n]);return r.default=e,t&&t.set(e,r),r}var __assign=function(){return(__assign=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},__spreadArray=function(e,t,n){if(n||2===arguments.length)for(var a,r=0,l=t.length;r<l;r++)!a&&r in t||((a=a||Array.prototype.slice.call(t,0,r))[r]=t[r]);return e.concat(a||Array.prototype.slice.call(t))},selectorPrefix="adhere-ui-comment-node",Node=(0,_react.memo)(function(n){var e,t=n.isReply,t=void 0!==t&&t,a=n.dataKeys,r=void 0===a?{current:"current",totalPage:"totalPage",list:"list",totalCount:"totalCount"}:a,a=n.limit,l=void 0===a?10:a,i=n.keyProp,o=n.children,c=n.isMoreProp,u=n.renderAuthor,d=n.renderAvatar,f=n.renderContent,s=n.renderDateTime,_=n.renderLoading,p=n.showReplyText,h=n.hideReplyText,m=n.loadMoreReplyText,y=n.showReplyTextIcon,v=n.loadMoreCollapseTextIcon,x=n.hideReplyTextIcon,E=n.fetchReply,g=n.emojiPickerProps,a=n.local,C=void 0===a?"zh":a,a=(0,_react.useState)(((a={})[r.current]=1,a[r.list]=[],a[r.totalCount]=0,a[r.totalPage]=0,a)),P=a[0],R=a[1],a=(0,_react.useState)(null==n?void 0:n.data),U=a[0],F=a[1],a=(0,_react.useState)(!1),b=a[0],q=a[1],a=(0,_react.useState)(!1),k=a[0],M=a[1],a=(0,_react.useState)(!1),N=a[0],D=a[1],w=(0,_react.useRef)({page:1,limit:l}),a=(0,_react.useCallback)(function(){var e=__spreadArray([],((null==(e=null==n?void 0:n.renderActions)?void 0:e.call(n,__assign({},U),function(e){return F(e)}))||[]).map(function(e,t){var n;return _adhereUiConditionalrender.default.conditionalRender({conditional:!(null!=(n=null==(n=null==e?void 0:e.props)?void 0:n.className)&&n.endsWith("-actions-action")),noMatch:e,match:_react.default.createElement("li",{key:t,className:"".concat(selectorPrefix,"-actions-action")},e)})}),!0);return e.find(function(e){return"reply"===(null==(e=null==(e=null==e?void 0:e.props)?void 0:e.children)?void 0:e.key)})||e.push(_react.default.createElement("li",{key:"reply",className:(0,_classnames.default)("".concat(selectorPrefix,"-actions-action"),"".concat(selectorPrefix,"-actions-action-reply-btn")),onClick:function(){return D(!0)}},_adhereUtilIntl.default.v("回复"))),e},[null==n?void 0:n.renderActions,U,N]),j=(0,_react.useCallback)(function(){var e,t;return _react.default.createElement("ul",{className:"".concat(selectorPrefix,"-children")},null==(t=null===(e=P[r.list]||[])?void 0:e.map)?void 0:t.call(e,function(e){return _react.default.createElement("li",{className:"".concat(selectorPrefix,"-children-item"),key:e[i]},_react.default.createElement(_adhereUiConditionalrender.default,{conditional:!o,noMatch:function(){return null==o?void 0:o(e)}},function(){return _react.default.createElement(_Info.default,{isReply:!0,data:e,dataKeys:r,limit:l,keyProp:i,isMoreProp:c,fetchData:null==n?void 0:n.fetchData,fetchReply:null==n?void 0:n.fetchReply,renderActions:null==n?void 0:n.renderActions,renderAuthor:u,renderAvatar:d,renderContent:f,renderDateTime:s,renderLoading:_,showReplyText:p,hideReplyText:h,loadMoreReplyText:m,showReplyTextIcon:y,hideReplyTextIcon:x,loadMoreCollapseTextIcon:v,local:C,emojiPickerProps:g})}))}),_react.default.createElement(_adhereUiConditionalrender.default,{conditional:!k&&I()},function(){return _react.default.createElement("li",{className:(0,_classnames.default)("".concat(selectorPrefix,"-children-item"),"more")},_react.default.createElement("a",{onClick:S},_react.default.createElement("span",null,_react.default.createElement(_adhereUiConditionalrender.default,{conditional:_adhereUtil.default.isFunction(v),noMatch:function(){return v}},function(){return v instanceof Function?v():v})),_react.default.createElement("span",null,_react.default.createElement(_adhereUiConditionalrender.default,{conditional:_adhereUtil.default.isFunction(m),noMatch:function(){return m}},function(){return m instanceof Function?m():m}))))}))},[P,r.list,i,c,a,u,d,f,s,_,p,h,m,y,x,v,k]),O=(0,_react.useCallback)(function(){return _react.default.createElement(_adhereUiConditionalrender.default,{conditional:!b,noMatch:function(){return _react.default.createElement("a",{className:"".concat(selectorPrefix,"-collapse"),onClick:function(){return q(!1)}},_react.default.createElement("span",null,_react.default.createElement(_adhereUiConditionalrender.default,{conditional:_adhereUtil.default.isFunction(x),noMatch:function(){return x}},function(){return x instanceof Function?x():x})),_react.default.createElement("span",null,_react.default.createElement(_adhereUiConditionalrender.default,{conditional:_adhereUtil.default.isFunction(h),noMatch:function(){return h}},function(){return h instanceof Function?h():h})))}},function(){return _react.default.createElement("a",{className:"".concat(selectorPrefix,"-collapse"),onClick:function(){var e;P[r.list].length?q(!0):null!=(e=T())&&e.then(function(){return q(!0)})}},_react.default.createElement("span",null,_react.default.createElement(_adhereUiConditionalrender.default,{conditional:_adhereUtil.default.isFunction(y),noMatch:function(){return y}},function(){return y instanceof Function?y():y})),_react.default.createElement("span",null,_react.default.createElement(_adhereUiConditionalrender.default,{conditional:_adhereUtil.default.isFunction(p),noMatch:function(){return p}},function(){return p instanceof Function?p():p})))})},[b,P,r.list,h,x,p,y]),I=(0,_react.useCallback)(function(){return P[r.list].length<=P[r.totalCount]},[P,r.list,r.totalCount]),A=(0,_react.useCallback)(function(){var e;return null==(e=null==(e=null==(e=null==n?void 0:n.fetchData)?void 0:e.call(n,__assign(__assign({},w.current),{record:__assign({},U)})))?void 0:e.then(function(e){return M(!1),e}))?void 0:e.catch(function(e){return M(!1),e})},[null==n?void 0:n.fetchData,w.current.page,w.current.limit,U]);function T(){var e;return M(!0),w.current={page:1,limit:l},null==(e=A())?void 0:e.then(function(e){R(e)})}function S(){M(!0),w.current.page=w.current.page+1;var e,a=r.list;return null==(e=A())?void 0:e.then(function(n){R(function(e){var t;return __assign(__assign({},n),((t={})[r.list]=__spreadArray(__spreadArray([],e[a],!0),n[a],!0),t))})})}return(0,_react.useEffect)(function(){F(n.data)},[null==n?void 0:n.data]),_react.default.createElement(_adhereUiFlexlayout.default,{direction:"horizontal",className:(0,_classnames.default)(selectorPrefix,((e={})["".concat(selectorPrefix,"-reply")]=t,e))},_react.default.createElement(_adhereUiFlexlayout.default.Fixed,{className:"".concat(selectorPrefix,"-avatar-wrap")},null==d?void 0:d(__assign({},U))),_react.default.createElement(_adhereUiFlexlayout.default.Auto,{autoFixed:!0,fit:!0},_react.default.createElement(_adhereUiFlexlayout.default,{direction:"vertical"},_react.default.createElement(_adhereUiFlexlayout.default.Fixed,{className:"".concat(selectorPrefix,"-title-row"),fit:!1},_react.default.createElement("div",{className:"".concat(selectorPrefix,"-title-row-author")},null==u?void 0:u(__assign({},U))),_react.default.createElement("div",{className:"".concat(selectorPrefix,"-title-row-date-time")},null==s?void 0:s(__assign({},U)))),_react.default.createElement(_adhereUiFlexlayout.default.Auto,{className:"".concat(selectorPrefix,"-content-wrap")},null==f?void 0:f(__assign({},U))),_react.default.createElement(_adhereUiFlexlayout.default.Fixed,null,_react.default.createElement("ul",{className:"".concat(selectorPrefix,"-actions")},a())),_react.default.createElement(_adhereUiConditionalrender.default,{conditional:N},function(){return _react.default.createElement(_adhereUiFlexlayout.default.Fixed,{style:{marginTop:15}},_react.default.createElement(_Submit.default,{onCancel:function(){return D(!1)},onResult:function(e){null!=(e=null==E?void 0:E({id:null==U?void 0:U[i],record:__assign({},U),reply:e}))&&e.then(function(){D(!1),T()})},local:C,emojiPickerProps:g}))}),_react.default.createElement(_adhereUiConditionalrender.default,{conditional:null==U?void 0:U[c]},function(){return _react.default.createElement(_react.default.Fragment,null,_react.default.createElement(_adhereUiConditionalrender.default,{conditional:!k},function(){return O()}),_react.default.createElement(_adhereUiConditionalrender.default.Show,{conditional:b},j()),_react.default.createElement(_adhereUiConditionalrender.default,{conditional:k},function(){return null==_?void 0:_()}))}))))}),_default=(Node.displayName="Node",exports.default=Node);
//# sourceMappingURL=index.js.map
