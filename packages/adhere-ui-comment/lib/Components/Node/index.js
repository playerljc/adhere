"use strict";require("core-js/modules/es.object.define-property.js"),require("core-js/modules/es.array.map.js"),Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),react_1=tslib_1.__importStar(require("react")),classnames_1=tslib_1.__importDefault(require("classnames")),adhere_ui_conditionalrender_1=tslib_1.__importDefault(require("@baifendian/adhere-ui-conditionalrender")),adhere_ui_flexlayout_1=tslib_1.__importDefault(require("@baifendian/adhere-ui-flexlayout")),adhere_util_intl_1=tslib_1.__importDefault(require("@baifendian/adhere-util-intl")),adhere_util_1=tslib_1.__importDefault(require("@baifendian/adhere-util")),Submit_1=tslib_1.__importDefault(require("../../Reply/Submit")),Info_1=tslib_1.__importDefault(require("../../Reply/Info")),selectorPrefix="adhere-ui-comment-node",Node=function(t){var e=t.isReply,a=void 0!==e&&e,n=t.dataKeys,r=void 0===n?{current:"current",totalPage:"totalPage",list:"list",totalCount:"totalCount"}:n,e=t.limit,l=void 0===e?10:e,i=t.keyProp,c=t.children,o=t.isMoreProp,u=t.renderAuthor,d=t.renderAvatar,_=t.renderContent,s=t.renderDateTime,f=t.renderLoading,m=t.showReplyText,h=t.hideReplyText,p=t.loadMoreReplyText,v=t.showReplyTextIcon,x=t.loadMoreCollapseTextIcon,b=t.hideReplyTextIcon,E=t.fetchReply,y=t.emojiPickerProps,n=t.local,P=void 0===n?"zh":n,n=tslib_1.__read((0,react_1.useState)(((e={})[r.current]=1,e[r.list]=[],e[r.totalCount]=0,e[r.totalPage]=0,e)),2),g=n[0],F=n[1],e=tslib_1.__read((0,react_1.useState)(null==t?void 0:t.data),2),R=e[0],N=e[1],n=tslib_1.__read((0,react_1.useState)(!1),2),M=n[0],T=n[1],e=tslib_1.__read((0,react_1.useState)(!1),2),C=e[0],A=e[1],n=tslib_1.__read((0,react_1.useState)(!1),2),e=n[0],q=n[1],D=(0,react_1.useRef)({page:1,limit:l});function k(){var e;return tslib_1.__spreadArray(tslib_1.__spreadArray([],tslib_1.__read(((null===(e=null==t?void 0:t.renderActions)||void 0===e?void 0:e.call(t,tslib_1.__assign({},R),function(e){N(e)}))||[]).map(function(e,t){return react_1.default.createElement("li",{key:t,className:"".concat(selectorPrefix,"-actions-action")},e)})),!1),[react_1.default.createElement("li",{className:(0,classnames_1.default)("".concat(selectorPrefix,"-actions-action"),"".concat(selectorPrefix,"-actions-action-reply-btn")),onClick:function(){return q(!0)}},adhere_util_intl_1.default.v("回复"))],!1)}function w(){var e,t;return react_1.default.createElement("ul",{className:"".concat(selectorPrefix,"-children")},null===(t=null===(e=g[r.list]||[])?void 0:e.map)||void 0===t?void 0:t.call(e,function(e){return react_1.default.createElement("li",{className:"".concat(selectorPrefix,"-children-item"),key:e[i]},react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:!c,noMatch:function(){return null==c?void 0:c(e)}},function(){return react_1.default.createElement(Info_1.default,{isReply:!0,data:e,keyProp:i,isMoreProp:o,fetchData:j,renderActions:k,renderAuthor:u,renderAvatar:d,renderContent:_,renderDateTime:s,renderLoading:f,showReplyText:m,hideReplyText:h,loadMoreReplyText:p,showReplyTextIcon:v,hideReplyTextIcon:b,loadMoreCollapseTextIcon:x})}))}),react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:!C&&g[r.list].length<=g[r.totalCount]},function(){return react_1.default.createElement("li",{className:(0,classnames_1.default)("".concat(selectorPrefix,"-children-item"),"more")},react_1.default.createElement("a",{onClick:S},react_1.default.createElement("span",null,react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:adhere_util_1.default.isFunction(x),noMatch:function(){return x}},function(){return x instanceof Function?x():x})),react_1.default.createElement("span",null,react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:adhere_util_1.default.isFunction(p),noMatch:function(){return p}},function(){return p instanceof Function?p():p}))))}))}function I(){var e;return A(!0),D.current={page:1,limit:l},null===(e=j())||void 0===e?void 0:e.then(function(e){F(e)})}function S(){var e;A(!0),D.current.page=D.current.page+1;var n=r.list;return null===(e=j())||void 0===e?void 0:e.then(function(a){F(function(e){var t;return tslib_1.__assign(tslib_1.__assign({},a),((t={})[r.list]=tslib_1.__spreadArray(tslib_1.__spreadArray([],tslib_1.__read(e[n]),!1),tslib_1.__read(a[n]),!1),t))})})}function j(){var e;return null===(e=null===(e=null===(e=null==t?void 0:t.fetchData)||void 0===e?void 0:e.call(t,tslib_1.__assign(tslib_1.__assign({},D.current),{record:tslib_1.__assign({},R)})))||void 0===e?void 0:e.then(function(e){return A(!1),e}))||void 0===e?void 0:e.catch(function(e){return A(!1),e})}return(0,react_1.useEffect)(function(){return N(t.data)},[null==t?void 0:t.data]),react_1.default.createElement(adhere_ui_flexlayout_1.default,{direction:"horizontal",className:(0,classnames_1.default)(selectorPrefix,a?"".concat(selectorPrefix,"-reply"):null)},react_1.default.createElement(adhere_ui_flexlayout_1.default.Fixed,{className:"".concat(selectorPrefix,"-avatar-wrap")},null==d?void 0:d(tslib_1.__assign({},R))),react_1.default.createElement(adhere_ui_flexlayout_1.default.Auto,{autoFixed:!0,fit:!0},react_1.default.createElement(adhere_ui_flexlayout_1.default,{direction:"vertical"},react_1.default.createElement(adhere_ui_flexlayout_1.default.Fixed,{className:"".concat(selectorPrefix,"-title-row"),fit:!1},react_1.default.createElement("div",{className:"".concat(selectorPrefix,"-title-row-author")},null==u?void 0:u(tslib_1.__assign({},R))),react_1.default.createElement("div",{className:"".concat(selectorPrefix,"-title-row-date-time")},null==s?void 0:s(tslib_1.__assign({},R)))),react_1.default.createElement(adhere_ui_flexlayout_1.default.Auto,{className:"".concat(selectorPrefix,"-content-wrap")},null==_?void 0:_(tslib_1.__assign({},R))),react_1.default.createElement(adhere_ui_flexlayout_1.default.Fixed,null,react_1.default.createElement("ul",{className:"".concat(selectorPrefix,"-actions")},k())),react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:e},function(){return react_1.default.createElement(adhere_ui_flexlayout_1.default.Fixed,{style:{marginTop:15}},react_1.default.createElement(Submit_1.default,{onCancel:function(){return q(!1)},onResult:function(e){null!==(e=null==E?void 0:E({id:null==R?void 0:R[i],record:tslib_1.__assign({},R),reply:e}))&&void 0!==e&&e.then(function(){q(!1),I()})},local:P,emojiPickerProps:y}))}),react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:null==R?void 0:R[o]},function(){return react_1.default.createElement(react_1.default.Fragment,null,react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:!C},function(){return react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:!M,noMatch:function(){return react_1.default.createElement("a",{className:"".concat(selectorPrefix,"-collapse"),onClick:function(){return T(!1)}},react_1.default.createElement("span",null,react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:adhere_util_1.default.isFunction(b),noMatch:function(){return b}},function(){return b instanceof Function?b():b})),react_1.default.createElement("span",null,react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:adhere_util_1.default.isFunction(h),noMatch:function(){return h}},function(){return h instanceof Function?h():h})))}},function(){return react_1.default.createElement("a",{className:"".concat(selectorPrefix,"-collapse"),onClick:function(){var e;g[r.list].length?T(!0):null!==(e=I())&&void 0!==e&&e.then(function(){return T(!0)})}},react_1.default.createElement("span",null,react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:adhere_util_1.default.isFunction(v),noMatch:function(){return v}},function(){return v instanceof Function?v():v})),react_1.default.createElement("span",null,react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:adhere_util_1.default.isFunction(m),noMatch:function(){return m}},function(){return m instanceof Function?m():m})))})}),react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:M},w),react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:C},function(){return null==f?void 0:f()}))}))))};exports.default=Node;
//# sourceMappingURL=index.js.map
