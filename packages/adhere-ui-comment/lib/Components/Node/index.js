"use strict";require("core-js/modules/es.object.define-property.js"),require("core-js/modules/es.array.map.js"),require("core-js/modules/es.string.ends-with.js"),require("core-js/modules/es.array.find.js"),require("core-js/modules/es.object.to-string.js"),Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),classnames_1=tslib_1.__importDefault(require("classnames")),react_1=tslib_1.__importStar(require("react")),adhere_ui_conditionalrender_1=tslib_1.__importDefault(require("@baifendian/adhere-ui-conditionalrender")),adhere_ui_flexlayout_1=tslib_1.__importDefault(require("@baifendian/adhere-ui-flexlayout")),adhere_util_1=tslib_1.__importDefault(require("@baifendian/adhere-util")),adhere_util_intl_1=tslib_1.__importDefault(require("@baifendian/adhere-util-intl")),Info_1=tslib_1.__importDefault(require("../../Reply/Info")),Submit_1=tslib_1.__importDefault(require("../../Reply/Submit")),selectorPrefix="adhere-ui-comment-node",Node=function(a){var e=a.isReply,e=void 0!==e&&e,t=a.dataKeys,r=void 0===t?{current:"current",totalPage:"totalPage",list:"list",totalCount:"totalCount"}:t,t=a.limit,n=void 0===t?10:t,l=a.keyProp,i=a.children,c=a.isMoreProp,o=a.renderAuthor,u=a.renderAvatar,d=a.renderContent,_=a.renderDateTime,s=a.renderLoading,f=a.showReplyText,m=a.hideReplyText,h=a.loadMoreReplyText,p=a.showReplyTextIcon,v=a.loadMoreCollapseTextIcon,b=a.hideReplyTextIcon,x=a.fetchReply,y=a.emojiPickerProps,t=a.local,E=void 0===t?"zh":t,t=tslib_1.__read((0,react_1.useState)(((t={})[r.current]=1,t[r.list]=[],t[r.totalCount]=0,t[r.totalPage]=0,t)),2),P=t[0],g=t[1],t=tslib_1.__read((0,react_1.useState)(null==a?void 0:a.data),2),C=t[0],F=t[1],t=tslib_1.__read((0,react_1.useState)(!1),2),R=t[0],k=t[1],t=tslib_1.__read((0,react_1.useState)(!1),2),N=t[0],M=t[1],t=tslib_1.__read((0,react_1.useState)(!1),2),j=t[0],T=t[1],q=(0,react_1.useRef)({page:1,limit:n}),t=(0,react_1.useCallback)(function(){var e=tslib_1.__spreadArray([],tslib_1.__read(((null==(e=null==a?void 0:a.renderActions)?void 0:e.call(a,tslib_1.__assign({},C),function(e){return F(e)}))||[]).map(function(e,t){var a;return adhere_ui_conditionalrender_1.default.conditionalRender({conditional:!(null!=(a=null==(a=null==e?void 0:e.props)?void 0:a.className)&&a.endsWith("-actions-action")),noMatch:e,match:react_1.default.createElement("li",{key:t,className:"".concat(selectorPrefix,"-actions-action")},e)})})),!1);return e.find(function(e){return"reply"===(null==(e=null==(e=null==e?void 0:e.props)?void 0:e.children)?void 0:e.key)})||e.push(react_1.default.createElement("li",{key:"reply",className:(0,classnames_1.default)("".concat(selectorPrefix,"-actions-action"),"".concat(selectorPrefix,"-actions-action-reply-btn")),onClick:function(){return T(!0)}},adhere_util_intl_1.default.v("回复"))),e},[null==a?void 0:a.renderActions,C,j]),A=(0,react_1.useCallback)(function(){var e,t;return react_1.default.createElement("ul",{className:"".concat(selectorPrefix,"-children")},null==(t=null===(e=P[r.list]||[])?void 0:e.map)?void 0:t.call(e,function(e){return react_1.default.createElement("li",{className:"".concat(selectorPrefix,"-children-item"),key:e[l]},react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:!i,noMatch:function(){return null==i?void 0:i(e)}},function(){return react_1.default.createElement(Info_1.default,{isReply:!0,data:e,keyProp:l,isMoreProp:c,fetchData:null==a?void 0:a.fetchData,renderActions:null==a?void 0:a.renderActions,renderAuthor:o,renderAvatar:u,renderContent:d,renderDateTime:_,renderLoading:s,showReplyText:f,hideReplyText:m,loadMoreReplyText:h,showReplyTextIcon:p,hideReplyTextIcon:b,loadMoreCollapseTextIcon:v})}))}),react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:!N&&I()},function(){return react_1.default.createElement("li",{className:(0,classnames_1.default)("".concat(selectorPrefix,"-children-item"),"more")},react_1.default.createElement("a",{onClick:z},react_1.default.createElement("span",null,react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:adhere_util_1.default.isFunction(v),noMatch:function(){return v}},function(){return v instanceof Function?v():v})),react_1.default.createElement("span",null,react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:adhere_util_1.default.isFunction(h),noMatch:function(){return h}},function(){return h instanceof Function?h():h}))))}))},[P,r.list,l,c,t,o,u,d,_,s,f,m,h,p,b,v,N]),S=(0,react_1.useCallback)(function(){return react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:!R,noMatch:function(){return react_1.default.createElement("a",{className:"".concat(selectorPrefix,"-collapse"),onClick:function(){return k(!1)}},react_1.default.createElement("span",null,react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:adhere_util_1.default.isFunction(b),noMatch:function(){return b}},function(){return b instanceof Function?b():b})),react_1.default.createElement("span",null,react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:adhere_util_1.default.isFunction(m),noMatch:function(){return m}},function(){return m instanceof Function?m():m})))}},function(){return react_1.default.createElement("a",{className:"".concat(selectorPrefix,"-collapse"),onClick:function(){var e;P[r.list].length?k(!0):null!=(e=w())&&e.then(function(){return k(!0)})}},react_1.default.createElement("span",null,react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:adhere_util_1.default.isFunction(p),noMatch:function(){return p}},function(){return p instanceof Function?p():p})),react_1.default.createElement("span",null,react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:adhere_util_1.default.isFunction(f),noMatch:function(){return f}},function(){return f instanceof Function?f():f})))})},[R,P,r.list,m,b,f,p]),I=(0,react_1.useCallback)(function(){return P[r.list].length<=P[r.totalCount]},[P,r.list,r.totalCount]),D=(0,react_1.useCallback)(function(){var e;return null==(e=null==(e=null==(e=null==a?void 0:a.fetchData)?void 0:e.call(a,tslib_1.__assign(tslib_1.__assign({},q.current),{record:tslib_1.__assign({},C)})))?void 0:e.then(function(e){return M(!1),e}))?void 0:e.catch(function(e){return M(!1),e})},[null==a?void 0:a.fetchData,q.current.page,q.current.limit,C]);function w(){var e;return M(!0),q.current={page:1,limit:n},null==(e=D())?void 0:e.then(function(e){g(e)})}function z(){M(!0),q.current.page=q.current.page+1;var e,n=r.list;return null==(e=D())?void 0:e.then(function(a){g(function(e){var t;return tslib_1.__assign(tslib_1.__assign({},a),((t={})[r.list]=tslib_1.__spreadArray(tslib_1.__spreadArray([],tslib_1.__read(e[n]),!1),tslib_1.__read(a[n]),!1),t))})})}return(0,react_1.useEffect)(function(){return F(a.data)},[null==a?void 0:a.data]),react_1.default.createElement(adhere_ui_flexlayout_1.default,{direction:"horizontal",className:(0,classnames_1.default)(selectorPrefix,e?"".concat(selectorPrefix,"-reply"):null)},react_1.default.createElement(adhere_ui_flexlayout_1.default.Fixed,{className:"".concat(selectorPrefix,"-avatar-wrap")},null==u?void 0:u(tslib_1.__assign({},C))),react_1.default.createElement(adhere_ui_flexlayout_1.default.Auto,{autoFixed:!0,fit:!0},react_1.default.createElement(adhere_ui_flexlayout_1.default,{direction:"vertical"},react_1.default.createElement(adhere_ui_flexlayout_1.default.Fixed,{className:"".concat(selectorPrefix,"-title-row"),fit:!1},react_1.default.createElement("div",{className:"".concat(selectorPrefix,"-title-row-author")},null==o?void 0:o(tslib_1.__assign({},C))),react_1.default.createElement("div",{className:"".concat(selectorPrefix,"-title-row-date-time")},null==_?void 0:_(tslib_1.__assign({},C)))),react_1.default.createElement(adhere_ui_flexlayout_1.default.Auto,{className:"".concat(selectorPrefix,"-content-wrap")},null==d?void 0:d(tslib_1.__assign({},C))),react_1.default.createElement(adhere_ui_flexlayout_1.default.Fixed,null,react_1.default.createElement("ul",{className:"".concat(selectorPrefix,"-actions")},t())),react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:j},function(){return react_1.default.createElement(adhere_ui_flexlayout_1.default.Fixed,{style:{marginTop:15}},react_1.default.createElement(Submit_1.default,{onCancel:function(){return T(!1)},onResult:function(e){null!=(e=null==x?void 0:x({id:null==C?void 0:C[l],record:tslib_1.__assign({},C),reply:e}))&&e.then(function(){T(!1),w()})},local:E,emojiPickerProps:y}))}),react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:null==C?void 0:C[c]},function(){return react_1.default.createElement(react_1.default.Fragment,null,react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:!N},function(){return S()}),react_1.default.createElement(adhere_ui_conditionalrender_1.default.Show,{conditional:R},A()),react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:N},function(){return null==s?void 0:s()}))}))))};exports.default=(0,react_1.memo)(Node);
//# sourceMappingURL=index.js.map
