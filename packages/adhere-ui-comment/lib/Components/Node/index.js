"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_typeof=require("@babel/runtime/helpers/typeof"),_classnames=(Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0,_interopRequireDefault(require("classnames"))),_react=_interopRequireWildcard(require("react")),_adhereUiConditionalrender=_interopRequireDefault(require("@baifendian/adhere-ui-conditionalrender")),_adhereUiFlexlayout=_interopRequireDefault(require("@baifendian/adhere-ui-flexlayout")),_adhereUtil=_interopRequireDefault(require("@baifendian/adhere-util")),_adhereUtilIntl=_interopRequireDefault(require("@baifendian/adhere-util-intl")),_Info=_interopRequireDefault(require("../../Reply/Info")),_Submit=_interopRequireDefault(require("../../Reply/Submit"));function _getRequireWildcardCache(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(_getRequireWildcardCache=function(e){return e?n:t})(e))}function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==_typeof(e)&&"function"!=typeof e)return{default:e};t=_getRequireWildcardCache(t);if(t&&t.has(e))return t.get(e);var n,a,r={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((a=l?Object.getOwnPropertyDescriptor(e,n):null)&&(a.get||a.set)?Object.defineProperty(r,n,a):r[n]=e[n]);return r.default=e,t&&t.set(e,r),r}var __assign=function(){return(__assign=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},__spreadArray=function(e,t,n){if(n||2===arguments.length)for(var a,r=0,l=t.length;r<l;r++)!a&&r in t||((a=a||Array.prototype.slice.call(t,0,r))[r]=t[r]);return e.concat(a||Array.prototype.slice.call(t))},selectorPrefix="adhere-ui-comment-node",Node=function(n){var e=n.isReply,e=void 0!==e&&e,t=n.dataKeys,r=void 0===t?{current:"current",totalPage:"totalPage",list:"list",totalCount:"totalCount"}:t,t=n.limit,a=void 0===t?10:t,l=n.keyProp,i=n.children,o=n.isMoreProp,c=n.renderAuthor,u=n.renderAvatar,d=n.renderContent,f=n.renderDateTime,s=n.renderLoading,_=n.showReplyText,p=n.hideReplyText,h=n.loadMoreReplyText,m=n.showReplyTextIcon,y=n.loadMoreCollapseTextIcon,v=n.hideReplyTextIcon,x=n.fetchReply,E=n.emojiPickerProps,t=n.local,g=void 0===t?"zh":t,t=(0,_react.useState)(((t={})[r.current]=1,t[r.list]=[],t[r.totalCount]=0,t[r.totalPage]=0,t)),C=t[0],P=t[1],t=(0,_react.useState)(null==n?void 0:n.data),R=t[0],U=t[1],t=(0,_react.useState)(!1),F=t[0],b=t[1],t=(0,_react.useState)(!1),q=t[0],k=t[1],t=(0,_react.useState)(!1),M=t[0],D=t[1],N=(0,_react.useRef)({page:1,limit:a}),t=(0,_react.useCallback)(function(){var e=__spreadArray([],((null==(e=null==n?void 0:n.renderActions)?void 0:e.call(n,__assign({},R),function(e){return U(e)}))||[]).map(function(e,t){var n;return _adhereUiConditionalrender.default.conditionalRender({conditional:!(null!=(n=null==(n=null==e?void 0:e.props)?void 0:n.className)&&n.endsWith("-actions-action")),noMatch:e,match:_react.default.createElement("li",{key:t,className:"".concat(selectorPrefix,"-actions-action")},e)})}),!0);return e.find(function(e){return"reply"===(null==(e=null==(e=null==e?void 0:e.props)?void 0:e.children)?void 0:e.key)})||e.push(_react.default.createElement("li",{key:"reply",className:(0,_classnames.default)("".concat(selectorPrefix,"-actions-action"),"".concat(selectorPrefix,"-actions-action-reply-btn")),onClick:function(){return D(!0)}},_adhereUtilIntl.default.v("回复"))),e},[null==n?void 0:n.renderActions,R,M]),w=(0,_react.useCallback)(function(){var e,t;return _react.default.createElement("ul",{className:"".concat(selectorPrefix,"-children")},null==(t=null===(e=C[r.list]||[])?void 0:e.map)?void 0:t.call(e,function(e){return _react.default.createElement("li",{className:"".concat(selectorPrefix,"-children-item"),key:e[l]},_react.default.createElement(_adhereUiConditionalrender.default,{conditional:!i,noMatch:function(){return null==i?void 0:i(e)}},function(){return _react.default.createElement(_Info.default,{isReply:!0,data:e,dataKeys:r,limit:a,keyProp:l,isMoreProp:o,fetchData:null==n?void 0:n.fetchData,fetchReply:null==n?void 0:n.fetchReply,renderActions:null==n?void 0:n.renderActions,renderAuthor:c,renderAvatar:u,renderContent:d,renderDateTime:f,renderLoading:s,showReplyText:_,hideReplyText:p,loadMoreReplyText:h,showReplyTextIcon:m,hideReplyTextIcon:v,loadMoreCollapseTextIcon:y,local:g,emojiPickerProps:E})}))}),_react.default.createElement(_adhereUiConditionalrender.default,{conditional:!q&&O()},function(){return _react.default.createElement("li",{className:(0,_classnames.default)("".concat(selectorPrefix,"-children-item"),"more")},_react.default.createElement("a",{onClick:I},_react.default.createElement("span",null,_react.default.createElement(_adhereUiConditionalrender.default,{conditional:_adhereUtil.default.isFunction(y),noMatch:function(){return y}},function(){return y instanceof Function?y():y})),_react.default.createElement("span",null,_react.default.createElement(_adhereUiConditionalrender.default,{conditional:_adhereUtil.default.isFunction(h),noMatch:function(){return h}},function(){return h instanceof Function?h():h}))))}))},[C,r.list,l,o,t,c,u,d,f,s,_,p,h,m,v,y,q]),j=(0,_react.useCallback)(function(){return _react.default.createElement(_adhereUiConditionalrender.default,{conditional:!F,noMatch:function(){return _react.default.createElement("a",{className:"".concat(selectorPrefix,"-collapse"),onClick:function(){return b(!1)}},_react.default.createElement("span",null,_react.default.createElement(_adhereUiConditionalrender.default,{conditional:_adhereUtil.default.isFunction(v),noMatch:function(){return v}},function(){return v instanceof Function?v():v})),_react.default.createElement("span",null,_react.default.createElement(_adhereUiConditionalrender.default,{conditional:_adhereUtil.default.isFunction(p),noMatch:function(){return p}},function(){return p instanceof Function?p():p})))}},function(){return _react.default.createElement("a",{className:"".concat(selectorPrefix,"-collapse"),onClick:function(){var e;C[r.list].length?b(!0):null!=(e=T())&&e.then(function(){return b(!0)})}},_react.default.createElement("span",null,_react.default.createElement(_adhereUiConditionalrender.default,{conditional:_adhereUtil.default.isFunction(m),noMatch:function(){return m}},function(){return m instanceof Function?m():m})),_react.default.createElement("span",null,_react.default.createElement(_adhereUiConditionalrender.default,{conditional:_adhereUtil.default.isFunction(_),noMatch:function(){return _}},function(){return _ instanceof Function?_():_})))})},[F,C,r.list,p,v,_,m]),O=(0,_react.useCallback)(function(){return C[r.list].length<=C[r.totalCount]},[C,r.list,r.totalCount]),A=(0,_react.useCallback)(function(){var e;return null==(e=null==(e=null==(e=null==n?void 0:n.fetchData)?void 0:e.call(n,__assign(__assign({},N.current),{record:__assign({},R)})))?void 0:e.then(function(e){return k(!1),e}))?void 0:e.catch(function(e){return k(!1),e})},[null==n?void 0:n.fetchData,N.current.page,N.current.limit,R]);function T(){var e;return k(!0),N.current={page:1,limit:a},null==(e=A())?void 0:e.then(function(e){P(e)})}function I(){k(!0),N.current.page=N.current.page+1;var e,a=r.list;return null==(e=A())?void 0:e.then(function(n){P(function(e){var t;return __assign(__assign({},n),((t={})[r.list]=__spreadArray(__spreadArray([],e[a],!0),n[a],!0),t))})})}return(0,_react.useEffect)(function(){U(n.data)},[null==n?void 0:n.data]),_react.default.createElement(_adhereUiFlexlayout.default,{direction:"horizontal",className:(0,_classnames.default)(selectorPrefix,e?"".concat(selectorPrefix,"-reply"):null)},_react.default.createElement(_adhereUiFlexlayout.default.Fixed,{className:"".concat(selectorPrefix,"-avatar-wrap")},null==u?void 0:u(__assign({},R))),_react.default.createElement(_adhereUiFlexlayout.default.Auto,{autoFixed:!0,fit:!0},_react.default.createElement(_adhereUiFlexlayout.default,{direction:"vertical"},_react.default.createElement(_adhereUiFlexlayout.default.Fixed,{className:"".concat(selectorPrefix,"-title-row"),fit:!1},_react.default.createElement("div",{className:"".concat(selectorPrefix,"-title-row-author")},null==c?void 0:c(__assign({},R))),_react.default.createElement("div",{className:"".concat(selectorPrefix,"-title-row-date-time")},null==f?void 0:f(__assign({},R)))),_react.default.createElement(_adhereUiFlexlayout.default.Auto,{className:"".concat(selectorPrefix,"-content-wrap")},null==d?void 0:d(__assign({},R))),_react.default.createElement(_adhereUiFlexlayout.default.Fixed,null,_react.default.createElement("ul",{className:"".concat(selectorPrefix,"-actions")},t())),_react.default.createElement(_adhereUiConditionalrender.default,{conditional:M},function(){return _react.default.createElement(_adhereUiFlexlayout.default.Fixed,{style:{marginTop:15}},_react.default.createElement(_Submit.default,{onCancel:function(){return D(!1)},onResult:function(e){null!=(e=null==x?void 0:x({id:null==R?void 0:R[l],record:__assign({},R),reply:e}))&&e.then(function(){D(!1),T()})},local:g,emojiPickerProps:E}))}),_react.default.createElement(_adhereUiConditionalrender.default,{conditional:null==R?void 0:R[o]},function(){return _react.default.createElement(_react.default.Fragment,null,_react.default.createElement(_adhereUiConditionalrender.default,{conditional:!q},function(){return j()}),_react.default.createElement(_adhereUiConditionalrender.default.Show,{conditional:F},w()),_react.default.createElement(_adhereUiConditionalrender.default,{conditional:q},function(){return null==s?void 0:s()}))}))))},_default=(0,_react.memo)(Node);exports.default=_default;
//# sourceMappingURL=index.js.map
