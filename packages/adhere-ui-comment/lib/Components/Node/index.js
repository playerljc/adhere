"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),classnames_1=tslib_1.__importDefault(require("classnames")),react_1=tslib_1.__importStar(require("react")),adhere_ui_conditionalrender_1=tslib_1.__importDefault(require("@baifendian/adhere-ui-conditionalrender")),adhere_ui_flexlayout_1=tslib_1.__importDefault(require("@baifendian/adhere-ui-flexlayout")),adhere_util_1=tslib_1.__importDefault(require("@baifendian/adhere-util")),adhere_util_intl_1=tslib_1.__importDefault(require("@baifendian/adhere-util-intl")),Info_1=tslib_1.__importDefault(require("../../Reply/Info")),Submit_1=tslib_1.__importDefault(require("../../Reply/Submit")),selectorPrefix="adhere-ui-comment-node",Node=function(a){var e=a.isReply,e=void 0!==e&&e,t=a.dataKeys,l=void 0===t?{current:"current",totalPage:"totalPage",list:"list",totalCount:"totalCount"}:t,t=a.limit,n=void 0===t?10:t,r=a.keyProp,i=a.children,c=a.isMoreProp,o=a.renderAuthor,u=a.renderAvatar,d=a.renderContent,_=a.renderDateTime,s=a.renderLoading,f=a.showReplyText,m=a.hideReplyText,h=a.loadMoreReplyText,p=a.showReplyTextIcon,v=a.loadMoreCollapseTextIcon,b=a.hideReplyTextIcon,x=a.fetchReply,y=a.emojiPickerProps,t=a.local,E=void 0===t?"zh":t,t=tslib_1.__read((0,react_1.useState)(((t={})[l.current]=1,t[l.list]=[],t[l.totalCount]=0,t[l.totalPage]=0,t)),2),P=t[0],g=t[1],t=tslib_1.__read((0,react_1.useState)(null==a?void 0:a.data),2),R=t[0],C=t[1],t=tslib_1.__read((0,react_1.useState)(!1),2),k=t[0],F=t[1],t=tslib_1.__read((0,react_1.useState)(!1),2),N=t[0],M=t[1],t=tslib_1.__read((0,react_1.useState)(!1),2),T=t[0],A=t[1],D=(0,react_1.useRef)({page:1,limit:n}),t=(0,react_1.useCallback)(function(){var e=tslib_1.__spreadArray([],tslib_1.__read(((null==(e=null==a?void 0:a.renderActions)?void 0:e.call(a,tslib_1.__assign({},R),function(e){return C(e)}))||[]).map(function(e,t){var a;return adhere_ui_conditionalrender_1.default.conditionalRender({conditional:!(null!=(a=null==(a=null==e?void 0:e.props)?void 0:a.className)&&a.endsWith("-actions-action")),noMatch:e,match:react_1.default.createElement("li",{key:t,className:"".concat(selectorPrefix,"-actions-action")},e)})})),!1);return e.find(function(e){return"reply"===(null==(e=null==(e=null==e?void 0:e.props)?void 0:e.children)?void 0:e.key)})||e.push(react_1.default.createElement("li",{key:"reply",className:(0,classnames_1.default)("".concat(selectorPrefix,"-actions-action"),"".concat(selectorPrefix,"-actions-action-reply-btn")),onClick:function(){return A(!0)}},adhere_util_intl_1.default.v("回复"))),e},[null==a?void 0:a.renderActions,R,T]),w=(0,react_1.useCallback)(function(){var e,t;return react_1.default.createElement("ul",{className:"".concat(selectorPrefix,"-children")},null==(t=null===(e=P[l.list]||[])?void 0:e.map)?void 0:t.call(e,function(e){return react_1.default.createElement("li",{className:"".concat(selectorPrefix,"-children-item"),key:e[r]},react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:!i,noMatch:function(){return null==i?void 0:i(e)}},function(){return react_1.default.createElement(Info_1.default,{isReply:!0,data:e,dataKeys:l,limit:n,keyProp:r,isMoreProp:c,fetchData:null==a?void 0:a.fetchData,fetchReply:null==a?void 0:a.fetchReply,renderActions:null==a?void 0:a.renderActions,renderAuthor:o,renderAvatar:u,renderContent:d,renderDateTime:_,renderLoading:s,showReplyText:f,hideReplyText:m,loadMoreReplyText:h,showReplyTextIcon:p,hideReplyTextIcon:b,loadMoreCollapseTextIcon:v,local:E,emojiPickerProps:y})}))}),react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:!N&&j()},function(){return react_1.default.createElement("li",{className:(0,classnames_1.default)("".concat(selectorPrefix,"-children-item"),"more")},react_1.default.createElement("a",{onClick:z},react_1.default.createElement("span",null,react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:adhere_util_1.default.isFunction(v),noMatch:function(){return v}},function(){return v instanceof Function?v():v})),react_1.default.createElement("span",null,react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:adhere_util_1.default.isFunction(h),noMatch:function(){return h}},function(){return h instanceof Function?h():h}))))}))},[P,l.list,r,c,t,o,u,d,_,s,f,m,h,p,b,v,N]),I=(0,react_1.useCallback)(function(){return react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:!k,noMatch:function(){return react_1.default.createElement("a",{className:"".concat(selectorPrefix,"-collapse"),onClick:function(){return F(!1)}},react_1.default.createElement("span",null,react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:adhere_util_1.default.isFunction(b),noMatch:function(){return b}},function(){return b instanceof Function?b():b})),react_1.default.createElement("span",null,react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:adhere_util_1.default.isFunction(m),noMatch:function(){return m}},function(){return m instanceof Function?m():m})))}},function(){return react_1.default.createElement("a",{className:"".concat(selectorPrefix,"-collapse"),onClick:function(){var e;P[l.list].length?F(!0):null!=(e=q())&&e.then(function(){return F(!0)})}},react_1.default.createElement("span",null,react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:adhere_util_1.default.isFunction(p),noMatch:function(){return p}},function(){return p instanceof Function?p():p})),react_1.default.createElement("span",null,react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:adhere_util_1.default.isFunction(f),noMatch:function(){return f}},function(){return f instanceof Function?f():f})))})},[k,P,l.list,m,b,f,p]),j=(0,react_1.useCallback)(function(){return P[l.list].length<=P[l.totalCount]},[P,l.list,l.totalCount]),S=(0,react_1.useCallback)(function(){var e;return null==(e=null==(e=null==(e=null==a?void 0:a.fetchData)?void 0:e.call(a,tslib_1.__assign(tslib_1.__assign({},D.current),{record:tslib_1.__assign({},R)})))?void 0:e.then(function(e){return M(!1),e}))?void 0:e.catch(function(e){return M(!1),e})},[null==a?void 0:a.fetchData,D.current.page,D.current.limit,R]);function q(){var e;return M(!0),D.current={page:1,limit:n},null==(e=S())?void 0:e.then(function(e){g(e)})}function z(){M(!0),D.current.page=D.current.page+1;var e,n=l.list;return null==(e=S())?void 0:e.then(function(a){g(function(e){var t;return tslib_1.__assign(tslib_1.__assign({},a),((t={})[l.list]=tslib_1.__spreadArray(tslib_1.__spreadArray([],tslib_1.__read(e[n]),!1),tslib_1.__read(a[n]),!1),t))})})}return(0,react_1.useEffect)(function(){return C(a.data)},[null==a?void 0:a.data]),react_1.default.createElement(adhere_ui_flexlayout_1.default,{direction:"horizontal",className:(0,classnames_1.default)(selectorPrefix,e?"".concat(selectorPrefix,"-reply"):null)},react_1.default.createElement(adhere_ui_flexlayout_1.default.Fixed,{className:"".concat(selectorPrefix,"-avatar-wrap")},null==u?void 0:u(tslib_1.__assign({},R))),react_1.default.createElement(adhere_ui_flexlayout_1.default.Auto,{autoFixed:!0,fit:!0},react_1.default.createElement(adhere_ui_flexlayout_1.default,{direction:"vertical"},react_1.default.createElement(adhere_ui_flexlayout_1.default.Fixed,{className:"".concat(selectorPrefix,"-title-row"),fit:!1},react_1.default.createElement("div",{className:"".concat(selectorPrefix,"-title-row-author")},null==o?void 0:o(tslib_1.__assign({},R))),react_1.default.createElement("div",{className:"".concat(selectorPrefix,"-title-row-date-time")},null==_?void 0:_(tslib_1.__assign({},R)))),react_1.default.createElement(adhere_ui_flexlayout_1.default.Auto,{className:"".concat(selectorPrefix,"-content-wrap")},null==d?void 0:d(tslib_1.__assign({},R))),react_1.default.createElement(adhere_ui_flexlayout_1.default.Fixed,null,react_1.default.createElement("ul",{className:"".concat(selectorPrefix,"-actions")},t())),react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:T},function(){return react_1.default.createElement(adhere_ui_flexlayout_1.default.Fixed,{style:{marginTop:15}},react_1.default.createElement(Submit_1.default,{onCancel:function(){return A(!1)},onResult:function(e){null!=(e=null==x?void 0:x({id:null==R?void 0:R[r],record:tslib_1.__assign({},R),reply:e}))&&e.then(function(){A(!1),q()})},local:E,emojiPickerProps:y}))}),react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:null==R?void 0:R[c]},function(){return react_1.default.createElement(react_1.default.Fragment,null,react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:!N},function(){return I()}),react_1.default.createElement(adhere_ui_conditionalrender_1.default.Show,{conditional:k},w()),react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:N},function(){return null==s?void 0:s()}))}))))};exports.default=(0,react_1.memo)(Node);
//# sourceMappingURL=index.js.map
