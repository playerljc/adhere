var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},__read=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var a,r,o=n.call(e),l=[];try{for(;(void 0===t||0<t--)&&!(a=o.next()).done;)l.push(a.value)}catch(e){r={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return l},__spreadArray=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var a,r=0,o=t.length;r<o;r++)!a&&r in t||((a=a||Array.prototype.slice.call(t,0,r))[r]=t[r]);return e.concat(a||Array.prototype.slice.call(t))};import classNames from"classnames";import React,{memo,useCallback,useEffect,useRef,useState}from"react";import ConditionalRender from"@baifendian/adhere-ui-conditionalrender";import FlexLayout from"@baifendian/adhere-ui-flexlayout";import Util from"@baifendian/adhere-util";import Intl from"@baifendian/adhere-util-intl";import ReplyInfo from"../../Reply/Info";import ReplySubmit from"../../Reply/Submit";var selectorPrefix="adhere-ui-comment-node",Node=function(n){var e=n.isReply,e=void 0!==e&&e,t=n.dataKeys,r=void 0===t?{current:"current",totalPage:"totalPage",list:"list",totalCount:"totalCount"}:t,t=n.limit,a=void 0===t?10:t,o=n.keyProp,l=n.children,i=n.isMoreProp,c=n.renderAuthor,u=n.renderAvatar,s=n.renderContent,d=n.renderDateTime,f=n.renderLoading,m=n.showReplyText,R=n.hideReplyText,p=n.loadMoreReplyText,h=n.showReplyTextIcon,y=n.loadMoreCollapseTextIcon,v=n.hideReplyTextIcon,_=n.fetchReply,x=n.emojiPickerProps,t=n.local,E=void 0===t?"zh":t,t=__read(useState(((t={})[r.current]=1,t[r.list]=[],t[r.totalCount]=0,t[r.totalPage]=0,t)),2),C=t[0],g=t[1],t=__read(useState(null==n?void 0:n.data),2),P=t[0],F=t[1],t=__read(useState(!1),2),N=t[0],k=t[1],t=__read(useState(!1),2),b=t[0],A=t[1],t=__read(useState(!1),2),M=t[0],T=t[1],w=useRef({page:1,limit:a}),t=useCallback(function(){var e=__spreadArray([],__read(((null==(e=null==n?void 0:n.renderActions)?void 0:e.call(n,__assign({},P),function(e){return F(e)}))||[]).map(function(e,t){var n;return ConditionalRender.conditionalRender({conditional:!(null!=(n=null==(n=null==e?void 0:e.props)?void 0:n.className)&&n.endsWith("-actions-action")),noMatch:e,match:React.createElement("li",{key:t,className:"".concat(selectorPrefix,"-actions-action")},e)})})),!1);return e.find(function(e){return"reply"===(null==(e=null==(e=null==e?void 0:e.props)?void 0:e.children)?void 0:e.key)})||e.push(React.createElement("li",{key:"reply",className:classNames("".concat(selectorPrefix,"-actions-action"),"".concat(selectorPrefix,"-actions-action-reply-btn")),onClick:function(){return T(!0)}},Intl.v("回复"))),e},[null==n?void 0:n.renderActions,P,M]),S=useCallback(function(){var e,t;return React.createElement("ul",{className:"".concat(selectorPrefix,"-children")},null==(t=null===(e=C[r.list]||[])?void 0:e.map)?void 0:t.call(e,function(e){return React.createElement("li",{className:"".concat(selectorPrefix,"-children-item"),key:e[o]},React.createElement(ConditionalRender,{conditional:!l,noMatch:function(){return null==l?void 0:l(e)}},function(){return React.createElement(ReplyInfo,{isReply:!0,data:e,dataKeys:r,limit:a,keyProp:o,isMoreProp:i,fetchData:null==n?void 0:n.fetchData,fetchReply:null==n?void 0:n.fetchReply,renderActions:null==n?void 0:n.renderActions,renderAuthor:c,renderAvatar:u,renderContent:s,renderDateTime:d,renderLoading:f,showReplyText:m,hideReplyText:R,loadMoreReplyText:p,showReplyTextIcon:h,hideReplyTextIcon:v,loadMoreCollapseTextIcon:y,local:E,emojiPickerProps:x})}))}),React.createElement(ConditionalRender,{conditional:!b&&D()},function(){return React.createElement("li",{className:classNames("".concat(selectorPrefix,"-children-item"),"more")},React.createElement("a",{onClick:j},React.createElement("span",null,React.createElement(ConditionalRender,{conditional:Util.isFunction(y),noMatch:function(){return y}},function(){return y instanceof Function?y():y})),React.createElement("span",null,React.createElement(ConditionalRender,{conditional:Util.isFunction(p),noMatch:function(){return p}},function(){return p instanceof Function?p():p}))))}))},[C,r.list,o,i,t,c,u,s,d,f,m,R,p,h,v,y,b]),U=useCallback(function(){return React.createElement(ConditionalRender,{conditional:!N,noMatch:function(){return React.createElement("a",{className:"".concat(selectorPrefix,"-collapse"),onClick:function(){return k(!1)}},React.createElement("span",null,React.createElement(ConditionalRender,{conditional:Util.isFunction(v),noMatch:function(){return v}},function(){return v instanceof Function?v():v})),React.createElement("span",null,React.createElement(ConditionalRender,{conditional:Util.isFunction(R),noMatch:function(){return R}},function(){return R instanceof Function?R():R})))}},function(){return React.createElement("a",{className:"".concat(selectorPrefix,"-collapse"),onClick:function(){var e;C[r.list].length?k(!0):null!=(e=L())&&e.then(function(){return k(!0)})}},React.createElement("span",null,React.createElement(ConditionalRender,{conditional:Util.isFunction(h),noMatch:function(){return h}},function(){return h instanceof Function?h():h})),React.createElement("span",null,React.createElement(ConditionalRender,{conditional:Util.isFunction(m),noMatch:function(){return m}},function(){return m instanceof Function?m():m})))})},[N,C,r.list,R,v,m,h]),D=useCallback(function(){return C[r.list].length<=C[r.totalCount]},[C,r.list,r.totalCount]),I=useCallback(function(){var e;return null==(e=null==(e=null==(e=null==n?void 0:n.fetchData)?void 0:e.call(n,__assign(__assign({},w.current),{record:__assign({},P)})))?void 0:e.then(function(e){return A(!1),e}))?void 0:e.catch(function(e){return A(!1),e})},[null==n?void 0:n.fetchData,w.current.page,w.current.limit,P]);function L(){var e;return A(!0),w.current={page:1,limit:a},null==(e=I())?void 0:e.then(function(e){g(e)})}function j(){A(!0),w.current.page=w.current.page+1;var e,a=r.list;return null==(e=I())?void 0:e.then(function(n){g(function(e){var t;return __assign(__assign({},n),((t={})[r.list]=__spreadArray(__spreadArray([],__read(e[a]),!1),__read(n[a]),!1),t))})})}return useEffect(function(){return F(n.data)},[null==n?void 0:n.data]),React.createElement(FlexLayout,{direction:"horizontal",className:classNames(selectorPrefix,e?"".concat(selectorPrefix,"-reply"):null)},React.createElement(FlexLayout.Fixed,{className:"".concat(selectorPrefix,"-avatar-wrap")},null==u?void 0:u(__assign({},P))),React.createElement(FlexLayout.Auto,{autoFixed:!0,fit:!0},React.createElement(FlexLayout,{direction:"vertical"},React.createElement(FlexLayout.Fixed,{className:"".concat(selectorPrefix,"-title-row"),fit:!1},React.createElement("div",{className:"".concat(selectorPrefix,"-title-row-author")},null==c?void 0:c(__assign({},P))),React.createElement("div",{className:"".concat(selectorPrefix,"-title-row-date-time")},null==d?void 0:d(__assign({},P)))),React.createElement(FlexLayout.Auto,{className:"".concat(selectorPrefix,"-content-wrap")},null==s?void 0:s(__assign({},P))),React.createElement(FlexLayout.Fixed,null,React.createElement("ul",{className:"".concat(selectorPrefix,"-actions")},t())),React.createElement(ConditionalRender,{conditional:M},function(){return React.createElement(FlexLayout.Fixed,{style:{marginTop:15}},React.createElement(ReplySubmit,{onCancel:function(){return T(!1)},onResult:function(e){null!=(e=null==_?void 0:_({id:null==P?void 0:P[o],record:__assign({},P),reply:e}))&&e.then(function(){T(!1),L()})},local:E,emojiPickerProps:x}))}),React.createElement(ConditionalRender,{conditional:null==P?void 0:P[i]},function(){return React.createElement(React.Fragment,null,React.createElement(ConditionalRender,{conditional:!b},function(){return U()}),React.createElement(ConditionalRender.Show,{conditional:N},S()),React.createElement(ConditionalRender,{conditional:b},function(){return null==f?void 0:f()}))}))))};export default memo(Node);
//# sourceMappingURL=index.js.map
