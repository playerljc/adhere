{"version":3,"file":"index.js","sources":["Reply/Submit/index.js"],"sourcesContent":["var __assign = (this && this.__assign) || function () {\r\n    __assign = Object.assign || function(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n                t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\nvar __read = (this && this.__read) || function (o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n};\r\nimport { Button, Input, Popover } from 'antd';\r\nimport React, { memo, useCallback, useLayoutEffect, useMemo, useRef, useState } from 'react';\r\nimport Hooks from '@baifendian/adhere-ui-hooks';\r\nimport Intl from '@baifendian/adhere-util-intl';\r\nimport data from '@emoji-mart/data';\r\nimport ar from '@emoji-mart/data/i18n/ar.json';\r\nimport de from '@emoji-mart/data/i18n/de.json';\r\nimport en from '@emoji-mart/data/i18n/en.json';\r\nimport es from '@emoji-mart/data/i18n/es.json';\r\nimport fa from '@emoji-mart/data/i18n/fa.json';\r\nimport fr from '@emoji-mart/data/i18n/fr.json';\r\nimport it from '@emoji-mart/data/i18n/it.json';\r\nimport ja from '@emoji-mart/data/i18n/ja.json';\r\nimport nl from '@emoji-mart/data/i18n/nl.json';\r\nimport pl from '@emoji-mart/data/i18n/pl.json';\r\nimport pt from '@emoji-mart/data/i18n/pt.json';\r\nimport ru from '@emoji-mart/data/i18n/ru.json';\r\nimport uk from '@emoji-mart/data/i18n/uk.json';\r\nimport zh from '@emoji-mart/data/i18n/zh.json';\r\nimport Picker from '@emoji-mart/react';\r\nimport EmojiIcon from './emoji';\r\nvar TextArea = Input.TextArea;\r\nvar useSetState = Hooks.useSetState;\r\nvar selectorPrefix = 'adhere-ui-comment-reply';\r\nvar LOCAL_MAP = new Map([\r\n    ['ar', ar],\r\n    ['de', de],\r\n    ['en', en],\r\n    ['es', es],\r\n    ['fa', fa],\r\n    ['fr', fr],\r\n    ['it', it],\r\n    ['ja', ja],\r\n    ['nl', nl],\r\n    ['pl', pl],\r\n    ['pt', pt],\r\n    ['ru', ru],\r\n    ['uk', uk],\r\n    ['zh', zh],\r\n]);\r\n/**\r\n * Reply\r\n * @param props\r\n * @constructor\r\n * @classdesc 回复\r\n */\r\nvar Reply = function (props) {\r\n    var _a = props.local, local = _a === void 0 ? 'zh' : _a, _b = props.emojiPickerProps, emojiPickerProps = _b === void 0 ? {} : _b, onResult = props.onResult, onCancel = props.onCancel;\r\n    var _c = __read(useSetState(''), 2), value = _c[0], setValue = _c[1];\r\n    // 回复内容的textarea\r\n    var textAreaRef = useRef(null);\r\n    var emojiWrapRef = useRef(null);\r\n    var _d = __read(useState(false), 2), emojiIconWrapVisible = _d[0], setEmojiIconWrapVisible = _d[1];\r\n    /**\r\n     * onEmojiSelect\r\n     * @param native\r\n     */\r\n    var onEmojiSelect = useCallback(function (_a) {\r\n        var _b;\r\n        var native = _a.native;\r\n        // 获取textarea的dom\r\n        var textareaEl = (_b = textAreaRef === null || textAreaRef === void 0 ? void 0 : textAreaRef.current) === null || _b === void 0 ? void 0 : _b.querySelector('textarea');\r\n        // 光标开始索引\r\n        var selectionStart = textareaEl.selectionStart;\r\n        // (0) 1 (1) 2 (2) 3 (3)\r\n        setValue(\"\".concat(value.substring(0, selectionStart)).concat(native).concat(value.substring(selectionStart)), function () {\r\n            textareaEl.focus();\r\n            textareaEl.setSelectionRange(selectionStart + native.length, selectionStart + native.length);\r\n        });\r\n    }, [value]);\r\n    var PopoverContent = useMemo(function () { return (React.createElement(Picker, __assign({ data: data, i18n: LOCAL_MAP.get(local || 'zh'), onEmojiSelect: onEmojiSelect }, (emojiPickerProps || {})))); }, [data, local, emojiPickerProps]);\r\n    useLayoutEffect(function () {\r\n        var _a, _b;\r\n        function onDocBodyClick(e) {\r\n            var target = e.target;\r\n            var textareaEl = textAreaRef === null || textAreaRef === void 0 ? void 0 : textAreaRef.current;\r\n            if (![textareaEl.querySelector('textarea')].includes(target)) {\r\n                setEmojiIconWrapVisible(false);\r\n            }\r\n        }\r\n        function onEmojiWrapClick(e) {\r\n            e.stopPropagation();\r\n        }\r\n        document.body.addEventListener('click', onDocBodyClick);\r\n        (_b = (_a = emojiWrapRef === null || emojiWrapRef === void 0 ? void 0 : emojiWrapRef.current) === null || _a === void 0 ? void 0 : _a.addEventListener) === null || _b === void 0 ? void 0 : _b.call(_a, 'click', onEmojiWrapClick);\r\n        return function () {\r\n            var _a, _b;\r\n            document.body.removeEventListener('click', onDocBodyClick);\r\n            (_b = (_a = emojiWrapRef === null || emojiWrapRef === void 0 ? void 0 : emojiWrapRef.current) === null || _a === void 0 ? void 0 : _a.removeEventListener) === null || _b === void 0 ? void 0 : _b.call(_a, 'click', onEmojiWrapClick);\r\n        };\r\n    });\r\n    return (React.createElement(\"div\", { className: \"\".concat(selectorPrefix) },\r\n        React.createElement(\"div\", { className: \"\".concat(selectorPrefix, \"-textarea-wrap\"), ref: textAreaRef },\r\n            React.createElement(TextArea, { className: \"\".concat(selectorPrefix, \"-textarea\"), placeholder: Intl.v('请输入回复内容'), autoFocus: true, value: value, onChange: function (e) { return setValue(e.target.value); }, showCount: true, maxLength: 100 })),\r\n        React.createElement(\"div\", { ref: emojiWrapRef, className: \"\".concat(selectorPrefix, \"-toolbar-emoji-wrap\") }),\r\n        React.createElement(\"div\", { className: \"\".concat(selectorPrefix, \"-toolbar\") },\r\n            React.createElement(Popover, { placement: \"bottomLeft\", getPopupContainer: function () { return emojiWrapRef.current; }, content: PopoverContent, open: emojiIconWrapVisible },\r\n                React.createElement(\"div\", { onClick: function (e) {\r\n                        e.stopPropagation();\r\n                        setEmojiIconWrapVisible(function (v) { return !v; });\r\n                    } },\r\n                    React.createElement(EmojiIcon, { className: \"\".concat(selectorPrefix, \"-toolbar-item-emoji\") }))),\r\n            React.createElement(\"div\", { className: \"\".concat(selectorPrefix, \"-toolbar-inner\") },\r\n                React.createElement(Button, { type: \"primary\", className: \"\".concat(selectorPrefix, \"-toolbar-item\"), disabled: !value, onClick: function () { return onResult === null || onResult === void 0 ? void 0 : onResult(value.trim()); } }, Intl.v('添加')),\r\n                React.createElement(Button, { className: \"\".concat(selectorPrefix, \"-toolbar-item\"), onClick: function () { return onCancel === null || onCancel === void 0 ? void 0 : onCancel(); } }, Intl.v('取消'))))));\r\n};\r\nexport default memo(Reply);\r\n"],"names":["__assign","this","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","__read","o","m","Symbol","iterator","r","e","ar","next","done","push","value","error","Button","Input","Popover","React","memo","useCallback","useLayoutEffect","useMemo","useRef","useState","Hooks","Intl","data","de","en","es","fa","fr","it","ja","nl","pl","pt","ru","uk","zh","Picker","EmojiIcon","TextArea","useSetState","selectorPrefix","LOCAL_MAP","Map","Reply","props","_a","local","_b","emojiPickerProps","onResult","onCancel","_c","setValue","textAreaRef","emojiWrapRef","_d","emojiIconWrapVisible","setEmojiIconWrapVisible","onEmojiSelect","native","textareaEl","current","querySelector","selectionStart","concat","substring","focus","setSelectionRange","PopoverContent","createElement","i18n","get","onDocBodyClick","target","includes","onEmojiWrapClick","stopPropagation","document","body","addEventListener","removeEventListener","className","ref","placeholder","v","autoFocus","onChange","showCount","maxLength","placement","getPopupContainer","content","open","onClick","type","disabled","trim"],"mappings":"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"}