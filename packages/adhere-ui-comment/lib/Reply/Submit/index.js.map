{"version":3,"file":"index.js","sources":["Reply/Submit/index.js"],"sourcesContent":["\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar tslib_1 = require(\"tslib\");\r\nvar antd_1 = require(\"antd\");\r\nvar react_1 = tslib_1.__importStar(require(\"react\"));\r\nvar adhere_ui_hooks_1 = tslib_1.__importDefault(require(\"@baifendian/adhere-ui-hooks\"));\r\nvar adhere_util_intl_1 = tslib_1.__importDefault(require(\"@baifendian/adhere-util-intl\"));\r\nvar data_1 = tslib_1.__importDefault(require(\"@emoji-mart/data\"));\r\nvar ar_json_1 = tslib_1.__importDefault(require(\"@emoji-mart/data/i18n/ar.json\"));\r\nvar de_json_1 = tslib_1.__importDefault(require(\"@emoji-mart/data/i18n/de.json\"));\r\nvar en_json_1 = tslib_1.__importDefault(require(\"@emoji-mart/data/i18n/en.json\"));\r\nvar es_json_1 = tslib_1.__importDefault(require(\"@emoji-mart/data/i18n/es.json\"));\r\nvar fa_json_1 = tslib_1.__importDefault(require(\"@emoji-mart/data/i18n/fa.json\"));\r\nvar fr_json_1 = tslib_1.__importDefault(require(\"@emoji-mart/data/i18n/fr.json\"));\r\nvar it_json_1 = tslib_1.__importDefault(require(\"@emoji-mart/data/i18n/it.json\"));\r\nvar ja_json_1 = tslib_1.__importDefault(require(\"@emoji-mart/data/i18n/ja.json\"));\r\nvar nl_json_1 = tslib_1.__importDefault(require(\"@emoji-mart/data/i18n/nl.json\"));\r\nvar pl_json_1 = tslib_1.__importDefault(require(\"@emoji-mart/data/i18n/pl.json\"));\r\nvar pt_json_1 = tslib_1.__importDefault(require(\"@emoji-mart/data/i18n/pt.json\"));\r\nvar ru_json_1 = tslib_1.__importDefault(require(\"@emoji-mart/data/i18n/ru.json\"));\r\nvar uk_json_1 = tslib_1.__importDefault(require(\"@emoji-mart/data/i18n/uk.json\"));\r\nvar zh_json_1 = tslib_1.__importDefault(require(\"@emoji-mart/data/i18n/zh.json\"));\r\nvar react_2 = tslib_1.__importDefault(require(\"@emoji-mart/react\"));\r\nvar emoji_1 = tslib_1.__importDefault(require(\"./emoji\"));\r\nvar TextArea = antd_1.Input.TextArea;\r\nvar useSetState = adhere_ui_hooks_1.default.useSetState;\r\nvar selectorPrefix = 'adhere-ui-comment-reply';\r\nvar LOCAL_MAP = new Map([\r\n    ['ar', ar_json_1.default],\r\n    ['de', de_json_1.default],\r\n    ['en', en_json_1.default],\r\n    ['es', es_json_1.default],\r\n    ['fa', fa_json_1.default],\r\n    ['fr', fr_json_1.default],\r\n    ['it', it_json_1.default],\r\n    ['ja', ja_json_1.default],\r\n    ['nl', nl_json_1.default],\r\n    ['pl', pl_json_1.default],\r\n    ['pt', pt_json_1.default],\r\n    ['ru', ru_json_1.default],\r\n    ['uk', uk_json_1.default],\r\n    ['zh', zh_json_1.default],\r\n]);\r\n/**\r\n * Reply\r\n * @param props\r\n * @constructor\r\n * @classdesc 回复\r\n */\r\nvar Reply = function (props) {\r\n    var _a = props.local, local = _a === void 0 ? 'zh' : _a, _b = props.emojiPickerProps, emojiPickerProps = _b === void 0 ? {} : _b, onResult = props.onResult, onCancel = props.onCancel;\r\n    var _c = tslib_1.__read(useSetState(''), 2), value = _c[0], setValue = _c[1];\r\n    // 回复内容的textarea\r\n    var textAreaRef = (0, react_1.useRef)(null);\r\n    var emojiWrapRef = (0, react_1.useRef)(null);\r\n    var _d = tslib_1.__read((0, react_1.useState)(false), 2), emojiIconWrapVisible = _d[0], setEmojiIconWrapVisible = _d[1];\r\n    /**\r\n     * onEmojiSelect\r\n     * @param native\r\n     */\r\n    var onEmojiSelect = (0, react_1.useCallback)(function (_a) {\r\n        var _b;\r\n        var native = _a.native;\r\n        // 获取textarea的dom\r\n        var textareaEl = (_b = textAreaRef === null || textAreaRef === void 0 ? void 0 : textAreaRef.current) === null || _b === void 0 ? void 0 : _b.querySelector('textarea');\r\n        // 光标开始索引\r\n        var selectionStart = textareaEl.selectionStart;\r\n        // (0) 1 (1) 2 (2) 3 (3)\r\n        setValue(\"\".concat(value.substring(0, selectionStart)).concat(native).concat(value.substring(selectionStart)), function () {\r\n            textareaEl.focus();\r\n            textareaEl.setSelectionRange(selectionStart + native.length, selectionStart + native.length);\r\n        });\r\n    }, [value]);\r\n    var PopoverContent = (0, react_1.useMemo)(function () { return (react_1.default.createElement(react_2.default, tslib_1.__assign({ data: data_1.default, i18n: LOCAL_MAP.get(local || 'zh'), onEmojiSelect: onEmojiSelect }, (emojiPickerProps || {})))); }, [data_1.default, local, emojiPickerProps]);\r\n    (0, react_1.useLayoutEffect)(function () {\r\n        var _a, _b;\r\n        function onDocBodyClick(e) {\r\n            var target = e.target;\r\n            var textareaEl = textAreaRef === null || textAreaRef === void 0 ? void 0 : textAreaRef.current;\r\n            if (![textareaEl.querySelector('textarea')].includes(target)) {\r\n                setEmojiIconWrapVisible(false);\r\n            }\r\n        }\r\n        function onEmojiWrapClick(e) {\r\n            e.stopPropagation();\r\n        }\r\n        document.body.addEventListener('click', onDocBodyClick);\r\n        (_b = (_a = emojiWrapRef === null || emojiWrapRef === void 0 ? void 0 : emojiWrapRef.current) === null || _a === void 0 ? void 0 : _a.addEventListener) === null || _b === void 0 ? void 0 : _b.call(_a, 'click', onEmojiWrapClick);\r\n        return function () {\r\n            var _a, _b;\r\n            document.body.removeEventListener('click', onDocBodyClick);\r\n            (_b = (_a = emojiWrapRef === null || emojiWrapRef === void 0 ? void 0 : emojiWrapRef.current) === null || _a === void 0 ? void 0 : _a.removeEventListener) === null || _b === void 0 ? void 0 : _b.call(_a, 'click', onEmojiWrapClick);\r\n        };\r\n    });\r\n    return (react_1.default.createElement(\"div\", { className: \"\".concat(selectorPrefix) },\r\n        react_1.default.createElement(\"div\", { className: \"\".concat(selectorPrefix, \"-textarea-wrap\"), ref: textAreaRef },\r\n            react_1.default.createElement(TextArea, { className: \"\".concat(selectorPrefix, \"-textarea\"), placeholder: adhere_util_intl_1.default.v('请输入回复内容'), autoFocus: true, value: value, onChange: function (e) { return setValue(e.target.value); }, showCount: true, maxLength: 100 })),\r\n        react_1.default.createElement(\"div\", { ref: emojiWrapRef, className: \"\".concat(selectorPrefix, \"-toolbar-emoji-wrap\") }),\r\n        react_1.default.createElement(\"div\", { className: \"\".concat(selectorPrefix, \"-toolbar\") },\r\n            react_1.default.createElement(antd_1.Popover, { placement: \"bottomLeft\", getPopupContainer: function () { return emojiWrapRef.current; }, content: PopoverContent, open: emojiIconWrapVisible },\r\n                react_1.default.createElement(\"div\", { onClick: function (e) {\r\n                        e.stopPropagation();\r\n                        setEmojiIconWrapVisible(function (v) { return !v; });\r\n                    } },\r\n                    react_1.default.createElement(emoji_1.default, { className: \"\".concat(selectorPrefix, \"-toolbar-item-emoji\") }))),\r\n            react_1.default.createElement(\"div\", { className: \"\".concat(selectorPrefix, \"-toolbar-inner\") },\r\n                react_1.default.createElement(antd_1.Button, { type: \"primary\", className: \"\".concat(selectorPrefix, \"-toolbar-item\"), disabled: !value, onClick: function () { return onResult === null || onResult === void 0 ? void 0 : onResult(value.trim()); } }, adhere_util_intl_1.default.v('添加')),\r\n                react_1.default.createElement(antd_1.Button, { className: \"\".concat(selectorPrefix, \"-toolbar-item\"), onClick: function () { return onCancel === null || onCancel === void 0 ? void 0 : onCancel(); } }, adhere_util_intl_1.default.v('取消'))))));\r\n};\r\nexports.default = (0, react_1.memo)(Reply);\r\n//# sourceMappingURL=index.js.map"],"names":["Object","defineProperty","exports","value","tslib_1","require","antd_1","react_1","__importStar","adhere_ui_hooks_1","__importDefault","adhere_util_intl_1","data_1","ar_json_1","de_json_1","en_json_1","es_json_1","fa_json_1","fr_json_1","it_json_1","ja_json_1","nl_json_1","pl_json_1","pt_json_1","ru_json_1","uk_json_1","zh_json_1","react_2","emoji_1","TextArea","Input","useSetState","default","selectorPrefix","LOCAL_MAP","Map","Reply","props","_a","local","_b","emojiPickerProps","onResult","onCancel","_c","__read","setValue","textAreaRef","useRef","emojiWrapRef","_d","useState","emojiIconWrapVisible","setEmojiIconWrapVisible","onEmojiSelect","useCallback","native","textareaEl","current","querySelector","selectionStart","concat","substring","focus","setSelectionRange","length","PopoverContent","useMemo","createElement","__assign","data","i18n","get","useLayoutEffect","onDocBodyClick","e","target","includes","onEmojiWrapClick","stopPropagation","document","body","addEventListener","call","removeEventListener","className","ref","placeholder","v","autoFocus","onChange","showCount","maxLength","Popover","placement","getPopupContainer","content","open","onClick","Button","type","disabled","trim","memo"],"mappings":"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"}