import"core-js/modules/es.array.map.js";import{__assign,__read,__spreadArray}from"tslib";import React,{useEffect,useRef,useState}from"react";import classNames from"classnames";import ConditionalRender from"@baifendian/adhere-ui-conditionalrender";import FlexLayout from"@baifendian/adhere-ui-flexlayout";import Intl from"@baifendian/adhere-util-intl";import Util from"@baifendian/adhere-util";import ReplySubmit from"../../Reply/Submit";import ReplyInfo from"../../Reply/Info";var selectorPrefix="adhere-ui-comment-node",Node=function(n){var e=n.isReply,t=void 0!==e&&e,a=n.dataKeys,o=void 0===a?{current:"current",totalPage:"totalPage",list:"list",totalCount:"totalCount"}:a,e=n.limit,r=void 0===e?10:e,i=n.keyProp,c=n.children,l=n.isMoreProp,u=n.renderAuthor,s=n.renderAvatar,d=n.renderContent,m=n.renderDateTime,f=n.renderLoading,R=n.showReplyText,p=n.hideReplyText,_=n.loadMoreReplyText,v=n.showReplyTextIcon,x=n.loadMoreCollapseTextIcon,y=n.hideReplyTextIcon,E=n.fetchReply,h=n.emojiPickerProps,a=n.local,C=void 0===a?"zh":a,a=__read(useState(((e={})[o.current]=1,e[o.list]=[],e[o.totalCount]=0,e[o.totalPage]=0,e)),2),P=a[0],F=a[1],e=__read(useState(null==n?void 0:n.data),2),g=e[0],N=e[1],a=__read(useState(!1),2),T=a[0],M=a[1],e=__read(useState(!1),2),A=e[0],I=e[1],a=__read(useState(!1),2),e=a[0],L=a[1],k=useRef({page:1,limit:r});function b(){var e;return __spreadArray(__spreadArray([],__read(((null===(e=null==n?void 0:n.renderActions)||void 0===e?void 0:e.call(n,__assign({},g),function(e){N(e)}))||[]).map(function(e,t){return React.createElement("li",{key:t,className:"".concat(selectorPrefix,"-actions-action")},e)})),!1),[React.createElement("li",{className:classNames("".concat(selectorPrefix,"-actions-action"),"".concat(selectorPrefix,"-actions-action-reply-btn")),onClick:function(){return L(!0)}},Intl.v("回复"))],!1)}function w(){var e,t;return React.createElement("ul",{className:"".concat(selectorPrefix,"-children")},null===(t=null===(e=P[o.list]||[])?void 0:e.map)||void 0===t?void 0:t.call(e,function(e){return React.createElement("li",{className:"".concat(selectorPrefix,"-children-item"),key:e[i]},React.createElement(ConditionalRender,{conditional:!c,noMatch:function(){return null==c?void 0:c(e)}},function(){return React.createElement(ReplyInfo,{isReply:!0,data:e,keyProp:i,isMoreProp:l,fetchData:j,renderActions:b,renderAuthor:u,renderAvatar:s,renderContent:d,renderDateTime:m,renderLoading:f,showReplyText:R,hideReplyText:p,loadMoreReplyText:_,showReplyTextIcon:v,hideReplyTextIcon:y,loadMoreCollapseTextIcon:x})}))}),React.createElement(ConditionalRender,{conditional:!A&&P[o.list].length<=P[o.totalCount]},function(){return React.createElement("li",{className:classNames("".concat(selectorPrefix,"-children-item"),"more")},React.createElement("a",{onClick:U},React.createElement("span",null,React.createElement(ConditionalRender,{conditional:Util.isFunction(x),noMatch:function(){return x}},function(){return x instanceof Function?x():x})),React.createElement("span",null,React.createElement(ConditionalRender,{conditional:Util.isFunction(_),noMatch:function(){return _}},function(){return _ instanceof Function?_():_}))))}))}function S(){return I(!0),k.current={page:1,limit:r},j(function(e){return F(e)})}function U(){I(!0),k.current.page=k.current.page+1;var n=o.list;return j(function(e){var t;F(__assign(__assign({},e),((t={})[o.list]=__spreadArray(__spreadArray([],__read(P[n]),!1),__read(e[n]),!1),t)))})}function j(t){var e;return null===(e=null===(e=null===(e=null==n?void 0:n.fetchData)||void 0===e?void 0:e.call(n,__assign(__assign({},k.current),{record:__assign({},g)})))||void 0===e?void 0:e.then(function(e){return t(e),I(!1),e}))||void 0===e?void 0:e.catch(function(e){return I(!1),e})}return useEffect(function(){N(g)},[null==n?void 0:n.data]),React.createElement(FlexLayout,{direction:"horizontal",className:classNames(selectorPrefix,t?"".concat(selectorPrefix,"-reply"):null)},React.createElement(FlexLayout.Fixed,{className:"".concat(selectorPrefix,"-avatar-wrap")},null==s?void 0:s(__assign({},g))),React.createElement(FlexLayout.Auto,{autoFixed:!0,fit:!0},React.createElement(FlexLayout,{direction:"vertical"},React.createElement(FlexLayout.Fixed,{className:"".concat(selectorPrefix,"-title-row"),fit:!1},React.createElement("div",{className:"".concat(selectorPrefix,"-title-row-author")},null==u?void 0:u(__assign({},g))),React.createElement("div",{className:"".concat(selectorPrefix,"-title-row-date-time")},null==m?void 0:m(__assign({},g)))),React.createElement(FlexLayout.Auto,{className:"".concat(selectorPrefix,"-content-wrap")},null==d?void 0:d(__assign({},g))),React.createElement(FlexLayout.Fixed,null,React.createElement("ul",{className:"".concat(selectorPrefix,"-actions")},b())),React.createElement(ConditionalRender,{conditional:e},function(){return React.createElement(FlexLayout.Fixed,{style:{marginTop:15}},React.createElement(ReplySubmit,{onCancel:function(){return L(!1)},onResult:function(e){null!==(e=null==E?void 0:E({id:null==g?void 0:g[i],record:__assign({},g),reply:e}))&&void 0!==e&&e.then(function(){L(!1),S()})},local:C,emojiPickerProps:h}))}),React.createElement(ConditionalRender,{conditional:null==g?void 0:g[l]},function(){return React.createElement(React.Fragment,null,React.createElement(ConditionalRender,{conditional:!A},function(){return React.createElement(ConditionalRender,{conditional:!T,noMatch:function(){return React.createElement("a",{className:"".concat(selectorPrefix,"-collapse"),onClick:function(){return M(!1)}},React.createElement("span",null,React.createElement(ConditionalRender,{conditional:Util.isFunction(y),noMatch:function(){return y}},function(){return y instanceof Function?y():y})),React.createElement("span",null,React.createElement(ConditionalRender,{conditional:Util.isFunction(p),noMatch:function(){return p}},function(){return p instanceof Function?p():p})))}},function(){return React.createElement("a",{className:"".concat(selectorPrefix,"-collapse"),onClick:function(){var e;P[o.list].length?M(!0):null!==(e=S())&&void 0!==e&&e.then(function(){return M(!0)})}},React.createElement("span",null,React.createElement(ConditionalRender,{conditional:Util.isFunction(v),noMatch:function(){return v}},function(){return v instanceof Function?v():v})),React.createElement("span",null,React.createElement(ConditionalRender,{conditional:Util.isFunction(R),noMatch:function(){return R}},function(){return R instanceof Function?R():R})))})}),React.createElement(ConditionalRender,{conditional:T},w),React.createElement(ConditionalRender,{conditional:A},function(){return null==f?void 0:f()}))}))))};export default Node;
//# sourceMappingURL=index.js.map
