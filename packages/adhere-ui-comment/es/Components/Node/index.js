var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},__spreadArray=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var a,o=0,l=t.length;o<l;o++)!a&&o in t||((a=a||Array.prototype.slice.call(t,0,o))[o]=t[o]);return e.concat(a||Array.prototype.slice.call(t))};import classNames from"classnames";import React,{memo,useCallback,useEffect,useRef,useState}from"react";import ConditionalRender from"@baifendian/adhere-ui-conditionalrender";import FlexLayout from"@baifendian/adhere-ui-flexlayout";import Util from"@baifendian/adhere-util";import Intl from"@baifendian/adhere-util-intl";import ReplyInfo from"../../Reply/Info";import ReplySubmit from"../../Reply/Submit";var selectorPrefix="adhere-ui-comment-node",Node=function(n){var e=n.isReply,e=void 0!==e&&e,t=n.dataKeys,o=void 0===t?{current:"current",totalPage:"totalPage",list:"list",totalCount:"totalCount"}:t,t=n.limit,a=void 0===t?10:t,l=n.keyProp,r=n.children,i=n.isMoreProp,c=n.renderAuthor,u=n.renderAvatar,s=n.renderContent,d=n.renderDateTime,f=n.renderLoading,m=n.showReplyText,R=n.hideReplyText,p=n.loadMoreReplyText,h=n.showReplyTextIcon,y=n.loadMoreCollapseTextIcon,v=n.hideReplyTextIcon,x=n.fetchReply,E=n.emojiPickerProps,t=n.local,_=void 0===t?"zh":t,t=useState(((t={})[o.current]=1,t[o.list]=[],t[o.totalCount]=0,t[o.totalPage]=0,t)),C=t[0],g=t[1],t=useState(null==n?void 0:n.data),P=t[0],F=t[1],t=useState(!1),N=t[0],k=t[1],t=useState(!1),A=t[0],b=t[1],t=useState(!1),M=t[0],T=t[1],w=useRef({page:1,limit:a}),t=useCallback(function(){var e=__spreadArray([],((null==(e=null==n?void 0:n.renderActions)?void 0:e.call(n,__assign({},P),function(e){return F(e)}))||[]).map(function(e,t){var n;return ConditionalRender.conditionalRender({conditional:!(null!=(n=null==(n=null==e?void 0:e.props)?void 0:n.className)&&n.endsWith("-actions-action")),noMatch:e,match:React.createElement("li",{key:t,className:"".concat(selectorPrefix,"-actions-action")},e)})}),!0);return e.find(function(e){return"reply"===(null==(e=null==(e=null==e?void 0:e.props)?void 0:e.children)?void 0:e.key)})||e.push(React.createElement("li",{key:"reply",className:classNames("".concat(selectorPrefix,"-actions-action"),"".concat(selectorPrefix,"-actions-action-reply-btn")),onClick:function(){return T(!0)}},Intl.v("回复"))),e},[null==n?void 0:n.renderActions,P,M]),I=useCallback(function(){var e,t;return React.createElement("ul",{className:"".concat(selectorPrefix,"-children")},null==(t=null===(e=C[o.list]||[])?void 0:e.map)?void 0:t.call(e,function(e){return React.createElement("li",{className:"".concat(selectorPrefix,"-children-item"),key:e[l]},React.createElement(ConditionalRender,{conditional:!r,noMatch:function(){return null==r?void 0:r(e)}},function(){return React.createElement(ReplyInfo,{isReply:!0,data:e,dataKeys:o,limit:a,keyProp:l,isMoreProp:i,fetchData:null==n?void 0:n.fetchData,fetchReply:null==n?void 0:n.fetchReply,renderActions:null==n?void 0:n.renderActions,renderAuthor:c,renderAvatar:u,renderContent:s,renderDateTime:d,renderLoading:f,showReplyText:m,hideReplyText:R,loadMoreReplyText:p,showReplyTextIcon:h,hideReplyTextIcon:v,loadMoreCollapseTextIcon:y,local:_,emojiPickerProps:E})}))}),React.createElement(ConditionalRender,{conditional:!A&&D()},function(){return React.createElement("li",{className:classNames("".concat(selectorPrefix,"-children-item"),"more")},React.createElement("a",{onClick:j},React.createElement("span",null,React.createElement(ConditionalRender,{conditional:Util.isFunction(y),noMatch:function(){return y}},function(){return y instanceof Function?y():y})),React.createElement("span",null,React.createElement(ConditionalRender,{conditional:Util.isFunction(p),noMatch:function(){return p}},function(){return p instanceof Function?p():p}))))}))},[C,o.list,l,i,t,c,u,s,d,f,m,R,p,h,v,y,A]),U=useCallback(function(){return React.createElement(ConditionalRender,{conditional:!N,noMatch:function(){return React.createElement("a",{className:"".concat(selectorPrefix,"-collapse"),onClick:function(){return k(!1)}},React.createElement("span",null,React.createElement(ConditionalRender,{conditional:Util.isFunction(v),noMatch:function(){return v}},function(){return v instanceof Function?v():v})),React.createElement("span",null,React.createElement(ConditionalRender,{conditional:Util.isFunction(R),noMatch:function(){return R}},function(){return R instanceof Function?R():R})))}},function(){return React.createElement("a",{className:"".concat(selectorPrefix,"-collapse"),onClick:function(){var e;C[o.list].length?k(!0):null!=(e=S())&&e.then(function(){return k(!0)})}},React.createElement("span",null,React.createElement(ConditionalRender,{conditional:Util.isFunction(h),noMatch:function(){return h}},function(){return h instanceof Function?h():h})),React.createElement("span",null,React.createElement(ConditionalRender,{conditional:Util.isFunction(m),noMatch:function(){return m}},function(){return m instanceof Function?m():m})))})},[N,C,o.list,R,v,m,h]),D=useCallback(function(){return C[o.list].length<=C[o.totalCount]},[C,o.list,o.totalCount]),L=useCallback(function(){var e;return null==(e=null==(e=null==(e=null==n?void 0:n.fetchData)?void 0:e.call(n,__assign(__assign({},w.current),{record:__assign({},P)})))?void 0:e.then(function(e){return b(!1),e}))?void 0:e.catch(function(e){return b(!1),e})},[null==n?void 0:n.fetchData,w.current.page,w.current.limit,P]);function S(){var e;return b(!0),w.current={page:1,limit:a},null==(e=L())?void 0:e.then(function(e){g(e)})}function j(){b(!0),w.current.page=w.current.page+1;var e,a=o.list;return null==(e=L())?void 0:e.then(function(n){g(function(e){var t;return __assign(__assign({},n),((t={})[o.list]=__spreadArray(__spreadArray([],e[a],!0),n[a],!0),t))})})}return useEffect(function(){F(n.data)},[null==n?void 0:n.data]),React.createElement(FlexLayout,{direction:"horizontal",className:classNames(selectorPrefix,e?"".concat(selectorPrefix,"-reply"):null)},React.createElement(FlexLayout.Fixed,{className:"".concat(selectorPrefix,"-avatar-wrap")},null==u?void 0:u(__assign({},P))),React.createElement(FlexLayout.Auto,{autoFixed:!0,fit:!0},React.createElement(FlexLayout,{direction:"vertical"},React.createElement(FlexLayout.Fixed,{className:"".concat(selectorPrefix,"-title-row"),fit:!1},React.createElement("div",{className:"".concat(selectorPrefix,"-title-row-author")},null==c?void 0:c(__assign({},P))),React.createElement("div",{className:"".concat(selectorPrefix,"-title-row-date-time")},null==d?void 0:d(__assign({},P)))),React.createElement(FlexLayout.Auto,{className:"".concat(selectorPrefix,"-content-wrap")},null==s?void 0:s(__assign({},P))),React.createElement(FlexLayout.Fixed,null,React.createElement("ul",{className:"".concat(selectorPrefix,"-actions")},t())),React.createElement(ConditionalRender,{conditional:M},function(){return React.createElement(FlexLayout.Fixed,{style:{marginTop:15}},React.createElement(ReplySubmit,{onCancel:function(){return T(!1)},onResult:function(e){null!=(e=null==x?void 0:x({id:null==P?void 0:P[l],record:__assign({},P),reply:e}))&&e.then(function(){T(!1),S()})},local:_,emojiPickerProps:E}))}),React.createElement(ConditionalRender,{conditional:null==P?void 0:P[i]},function(){return React.createElement(React.Fragment,null,React.createElement(ConditionalRender,{conditional:!A},function(){return U()}),React.createElement(ConditionalRender.Show,{conditional:N},I()),React.createElement(ConditionalRender,{conditional:A},function(){return null==f?void 0:f()}))}))))};export default memo(Node);
//# sourceMappingURL=index.js.map
