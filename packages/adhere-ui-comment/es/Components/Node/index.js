import"core-js/modules/es.array.map.js";import{__assign,__spreadArray}from"tslib";import React,{useRef,useState}from"react";import PropTypes from"prop-types";import classNames from"classnames";import ConditionalRender from"@baifendian/adhere-ui-conditionalrender";import FlexLayout from"@baifendian/adhere-ui-flexlayout";import Intl from"@baifendian/adhere-util-intl";import Util from"@baifendian/adhere-util";import ReplySubmit from"../../Reply/Submit";import ReplyInfo from"../../Reply/Info";var selectorPrefix="adhere-ui-comment-node";function Node(o){var e=useState(((t={})[o.dataKeys.current]=1,t[o.dataKeys.list]=[],t[o.dataKeys.totalCount]=0,t[o.dataKeys.totalPage]=0,t)),r=e[0],a=e[1],t=useState(!1),n=t[0],l=t[1],e=useState(!1),i=e[0],c=e[1],t=useState(!1),e=t[0],s=t[1],d=useRef({page:1,limit:o.limit});function p(){var e,t;return React.createElement("ul",{className:"".concat(selectorPrefix,"-children")},null===(t=null===(e=r[o.dataKeys.list]||[])?void 0:e.map)||void 0===t?void 0:t.call(e,function(t){return React.createElement("li",{className:"".concat(selectorPrefix,"-children-item"),key:t[o.keyProp]},React.createElement(ConditionalRender,{conditional:!(null!=o&&o.children),noMatch:function(){var e;return null===(e=null==o?void 0:o.children)||void 0===e?void 0:e.call(o,t)}},function(){return React.createElement(ReplyInfo,{isReply:!0,data:t,keyProp:o.keyProp,isMoreProp:o.isMoreProp,fetchData:o.fetchData,renderActions:o.renderActions,renderAuthor:o.renderAuthor,renderAvatar:o.renderAvatar,renderContent:o.renderContent,renderDateTime:o.renderDateTime,renderLoading:o.renderLoading,showReplyText:o.showReplyText,hideReplyText:o.hideReplyText,loadMoreReplyText:o.loadMoreReplyText,showReplyTextIcon:o.showReplyTextIcon,hideReplyTextIcon:o.hideReplyTextIcon,loadMoreCollapseTextIcon:o.loadMoreCollapseTextIcon})}))}),React.createElement(ConditionalRender,{conditional:!i&&r[o.dataKeys.list].length<=r[o.dataKeys.totalCount]},function(){return React.createElement("li",{className:classNames("".concat(selectorPrefix,"-children-item"),"more")},React.createElement("a",{onClick:y},React.createElement("span",null,React.createElement(ConditionalRender,{conditional:Util.isFunction(null==o?void 0:o.loadMoreCollapseTextIcon),noMatch:function(){return null==o?void 0:o.loadMoreCollapseTextIcon}},function(){return(null==o?void 0:o.loadMoreCollapseTextIcon)()})),React.createElement("span",null,React.createElement(ConditionalRender,{conditional:Util.isFunction(o.loadMoreReplyText),noMatch:function(){return o.loadMoreReplyText}},function(){return(null==o?void 0:o.loadMoreReplyText)()}))))}))}function u(){return c(!0),d.current={page:1,limit:o.limit},f(function(e){a(e)})}function y(){c(!0),d.current.page=d.current.page+1;var n=o.dataKeys.list;return f(function(e){var t;a(__assign(__assign({},e),((t={})[o.dataKeys.list]=__spreadArray(__spreadArray([],r[n],!0),e[n],!0),t)))})}function f(t){var e;return null===(e=null==o?void 0:o.fetchData)||void 0===e?void 0:e.call(o,__assign(__assign({},d.current),{record:null==o?void 0:o.data})).then(function(e){return t(e),c(!1),e}).catch(function(e){return c(!1),e})}return React.createElement(FlexLayout,{direction:"horizontal",className:classNames(selectorPrefix,o.isReply?"".concat(selectorPrefix,"-reply"):null)},React.createElement(FlexLayout.Fixed,{className:"".concat(selectorPrefix,"-avatar-wrap")},null===(t=null==o?void 0:o.renderAvatar)||void 0===t?void 0:t.call(o,o.data)),React.createElement(FlexLayout.Auto,{autoFixed:!0,fit:!0},React.createElement(FlexLayout,{direction:"vertical"},React.createElement(FlexLayout.Fixed,{className:"".concat(selectorPrefix,"-title-row"),fit:!1},React.createElement("div",{className:"".concat(selectorPrefix,"-title-row-author")},null===(t=null==o?void 0:o.renderAuthor)||void 0===t?void 0:t.call(o,o.data)),React.createElement("div",{className:"".concat(selectorPrefix,"-title-row-date-time")},null===(t=null==o?void 0:o.renderDateTime)||void 0===t?void 0:t.call(o,o.data))),React.createElement(FlexLayout.Auto,{className:"".concat(selectorPrefix,"-content-wrap")},null===(t=null==o?void 0:o.renderContent)||void 0===t?void 0:t.call(o,o.data)),React.createElement(FlexLayout.Fixed,null,React.createElement("ul",{className:"".concat(selectorPrefix,"-actions")},__spreadArray(__spreadArray([],((null===(t=null==o?void 0:o.renderActions)||void 0===t?void 0:t.call(o,null==o?void 0:o.data))||[]).map(function(e,t){return React.createElement("li",{key:t,className:"".concat(selectorPrefix,"-actions-action")},e)}),!0),[React.createElement("li",{className:classNames("".concat(selectorPrefix,"-actions-action"),"".concat(selectorPrefix,"-actions-action-reply-btn")),onClick:function(){return s(!0)}},Intl.v("回复"))],!1))),React.createElement(ConditionalRender,{conditional:e},function(){return React.createElement(FlexLayout.Fixed,{style:{marginTop:15}},React.createElement(ReplySubmit,{onCancel:function(){return s(!1)},onResult:function(e){var t;null!==(e=null===(t=null==o?void 0:o.fetchReply)||void 0===t?void 0:t.call(o,{id:null===(t=null==o?void 0:o.data)||void 0===t?void 0:t[o.keyProp],record:null==o?void 0:o.data,reply:e}))&&void 0!==e&&e.then(function(){s(!1),u()})}}))}),React.createElement(ConditionalRender,{conditional:null===(e=null==o?void 0:o.data)||void 0===e?void 0:e[o.isMoreProp]},function(){return React.createElement(React.Fragment,null,React.createElement(ConditionalRender,{conditional:!i},function(){return React.createElement(ConditionalRender,{conditional:!n,noMatch:function(){return React.createElement("a",{className:"".concat(selectorPrefix,"-collapse"),onClick:function(){l(!1)}},React.createElement("span",null,React.createElement(ConditionalRender,{conditional:Util.isFunction(o.hideReplyTextIcon),noMatch:function(){return o.hideReplyTextIcon}},function(){return(null==o?void 0:o.hideReplyTextIcon)()})),React.createElement("span",null,React.createElement(ConditionalRender,{conditional:Util.isFunction(o.hideReplyText),noMatch:function(){return o.hideReplyText}},function(){return(null==o?void 0:o.hideReplyText)()})))}},function(){return React.createElement("a",{className:"".concat(selectorPrefix,"-collapse"),onClick:function(){var e;r[o.dataKeys.list].length?l(!0):null!==(e=u())&&void 0!==e&&e.then(function(){l(!0)})}},React.createElement("span",null,React.createElement(ConditionalRender,{conditional:Util.isFunction(o.showReplyTextIcon),noMatch:function(){return o.showReplyTextIcon}},function(){return(null==o?void 0:o.showReplyTextIcon)()})),React.createElement("span",null,React.createElement(ConditionalRender,{conditional:Util.isFunction(o.showReplyText),noMatch:function(){return o.showReplyText}},function(){return(null==o?void 0:o.showReplyText)()})))})}),React.createElement(ConditionalRender,{conditional:n},p),React.createElement(ConditionalRender,{conditional:i},function(){var e;return null===(e=null==o?void 0:o.renderLoading)||void 0===e?void 0:e.call(o)}))}))))}var defaultProps={isReply:!1,limit:10,dataKeys:{current:"current",totalPage:"totalPage",list:"list",totalCount:"totalCount"}},propTypes={isReply:PropTypes.bool,data:PropTypes.shape({key:PropTypes.string}),dataKeys:PropTypes.shape({current:PropTypes.string,totalPage:PropTypes.string,list:PropTypes.string,totalCount:PropTypes.string}),renderLoading:PropTypes.func,limit:PropTypes.number,fetchData:PropTypes.func,fetchReply:PropTypes.func,keyProp:PropTypes.string,isMoreProp:PropTypes.string,renderActions:PropTypes.func,renderAuthor:PropTypes.func,renderAvatar:PropTypes.func,renderContent:PropTypes.func,renderDateTime:PropTypes.func,showReplyText:PropTypes.oneOfType([PropTypes.string,PropTypes.func]),hideReplyText:PropTypes.oneOfType([PropTypes.string,PropTypes.func]),loadMoreReplyText:PropTypes.oneOfType([PropTypes.string,PropTypes.func]),showReplyTextIcon:PropTypes.oneOfType([PropTypes.node,PropTypes.func]),hideReplyTextIcon:PropTypes.oneOfType([PropTypes.node,PropTypes.func]),loadMoreCollapseTextIcon:PropTypes.oneOfType([PropTypes.node,PropTypes.func])};Node.defaultProps=defaultProps,Node.propTypes=propTypes;export default Node;export{defaultProps,propTypes};
//# sourceMappingURL=index.js.map
