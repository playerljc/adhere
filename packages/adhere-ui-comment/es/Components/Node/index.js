import"core-js/modules/es.array.map.js";import"core-js/modules/es.string.ends-with.js";import"core-js/modules/es.array.find.js";import"core-js/modules/es.object.to-string.js";import{__assign,__read,__spreadArray}from"tslib";import classNames from"classnames";import React,{memo,useCallback,useEffect,useRef,useState}from"react";import ConditionalRender from"@baifendian/adhere-ui-conditionalrender";import FlexLayout from"@baifendian/adhere-ui-flexlayout";import Util from"@baifendian/adhere-util";import Intl from"@baifendian/adhere-util-intl";import ReplyInfo from"../../Reply/Info";import ReplySubmit from"../../Reply/Submit";var selectorPrefix="adhere-ui-comment-node",Node=function(t){var e=t.isReply,e=void 0!==e&&e,n=t.dataKeys,o=void 0===n?{current:"current",totalPage:"totalPage",list:"list",totalCount:"totalCount"}:n,n=t.limit,a=void 0===n?10:n,r=t.keyProp,l=t.children,i=t.isMoreProp,c=t.renderAuthor,u=t.renderAvatar,s=t.renderContent,d=t.renderDateTime,m=t.renderLoading,f=t.showReplyText,R=t.hideReplyText,p=t.loadMoreReplyText,v=t.showReplyTextIcon,_=t.loadMoreCollapseTextIcon,h=t.hideReplyTextIcon,y=t.fetchReply,x=t.emojiPickerProps,n=t.local,E=void 0===n?"zh":n,n=__read(useState(((n={})[o.current]=1,n[o.list]=[],n[o.totalCount]=0,n[o.totalPage]=0,n)),2),C=n[0],g=n[1],n=__read(useState(null==t?void 0:t.data),2),P=n[0],F=n[1],n=__read(useState(!1),2),N=n[0],k=n[1],n=__read(useState(!1),2),b=n[0],M=n[1],n=__read(useState(!1),2),T=n[0],A=n[1],j=useRef({page:1,limit:a}),I=useCallback(function(){var e=__spreadArray([],__read(((null==(e=null==t?void 0:t.renderActions)?void 0:e.call(t,__assign({},P),function(e){return F(e)}))||[]).map(function(e,t){var n;return ConditionalRender.conditionalRender({conditional:!(null!=(n=null==(n=null==e?void 0:e.props)?void 0:n.className)&&n.endsWith("-actions-action")),noMatch:e,match:React.createElement("li",{key:t,className:"".concat(selectorPrefix,"-actions-action")},e)})})),!1);return e.find(function(e){return"reply"===(null==(e=null==(e=null==e?void 0:e.props)?void 0:e.children)?void 0:e.key)})||e.push(React.createElement("li",{key:"reply",className:classNames("".concat(selectorPrefix,"-actions-action"),"".concat(selectorPrefix,"-actions-action-reply-btn")),onClick:function(){return A(!0)}},Intl.v("回复"))),e},[null==t?void 0:t.renderActions,P,T]),S=useCallback(function(){var e,t;return React.createElement("ul",{className:"".concat(selectorPrefix,"-children")},null==(t=null===(e=C[o.list]||[])?void 0:e.map)?void 0:t.call(e,function(e){return React.createElement("li",{className:"".concat(selectorPrefix,"-children-item"),key:e[r]},React.createElement(ConditionalRender,{conditional:!l,noMatch:function(){return null==l?void 0:l(e)}},function(){return React.createElement(ReplyInfo,{isReply:!0,data:e,keyProp:r,isMoreProp:i,fetchData:w,renderActions:I,renderAuthor:c,renderAvatar:u,renderContent:s,renderDateTime:d,renderLoading:m,showReplyText:f,hideReplyText:R,loadMoreReplyText:p,showReplyTextIcon:v,hideReplyTextIcon:h,loadMoreCollapseTextIcon:_})}))}),React.createElement(ConditionalRender,{conditional:!b&&D()},function(){return React.createElement("li",{className:classNames("".concat(selectorPrefix,"-children-item"),"more")},React.createElement("a",{onClick:z},React.createElement("span",null,React.createElement(ConditionalRender,{conditional:Util.isFunction(_),noMatch:function(){return _}},function(){return _ instanceof Function?_():_})),React.createElement("span",null,React.createElement(ConditionalRender,{conditional:Util.isFunction(p),noMatch:function(){return p}},function(){return p instanceof Function?p():p}))))}))},[C,o.list,r,i,I,c,u,s,d,m,f,R,p,v,h,_,b]),U=useCallback(function(){return React.createElement(ConditionalRender,{conditional:!N,noMatch:function(){return React.createElement("a",{className:"".concat(selectorPrefix,"-collapse"),onClick:function(){return k(!1)}},React.createElement("span",null,React.createElement(ConditionalRender,{conditional:Util.isFunction(h),noMatch:function(){return h}},function(){return h instanceof Function?h():h})),React.createElement("span",null,React.createElement(ConditionalRender,{conditional:Util.isFunction(R),noMatch:function(){return R}},function(){return R instanceof Function?R():R})))}},function(){return React.createElement("a",{className:"".concat(selectorPrefix,"-collapse"),onClick:function(){var e;C[o.list].length?k(!0):null!=(e=L())&&e.then(function(){return k(!0)})}},React.createElement("span",null,React.createElement(ConditionalRender,{conditional:Util.isFunction(v),noMatch:function(){return v}},function(){return v instanceof Function?v():v})),React.createElement("span",null,React.createElement(ConditionalRender,{conditional:Util.isFunction(f),noMatch:function(){return f}},function(){return f instanceof Function?f():f})))})},[N,C,o.list,R,h,f,v]),D=useCallback(function(){return C[o.list].length<=C[o.totalCount]},[C,o.list,o.totalCount]);function L(){var e;return M(!0),j.current={page:1,limit:a},null==(e=w())?void 0:e.then(function(e){g(e)})}function z(){M(!0),j.current.page=j.current.page+1;var e,a=o.list;return null==(e=w())?void 0:e.then(function(n){g(function(e){var t;return __assign(__assign({},n),((t={})[o.list]=__spreadArray(__spreadArray([],__read(e[a]),!1),__read(n[a]),!1),t))})})}var w=useCallback(function(){var e;return null==(e=null==(e=null==(e=null==t?void 0:t.fetchData)?void 0:e.call(t,__assign(__assign({},j.current),{record:__assign({},P)})))?void 0:e.then(function(e){return M(!1),e}))?void 0:e.catch(function(e){return M(!1),e})},[null==t?void 0:t.fetchData,j.current.page,j.current.limit,P]);return useEffect(function(){return F(t.data)},[null==t?void 0:t.data]),React.createElement(FlexLayout,{direction:"horizontal",className:classNames(selectorPrefix,e?"".concat(selectorPrefix,"-reply"):null)},React.createElement(FlexLayout.Fixed,{className:"".concat(selectorPrefix,"-avatar-wrap")},null==u?void 0:u(__assign({},P))),React.createElement(FlexLayout.Auto,{autoFixed:!0,fit:!0},React.createElement(FlexLayout,{direction:"vertical"},React.createElement(FlexLayout.Fixed,{className:"".concat(selectorPrefix,"-title-row"),fit:!1},React.createElement("div",{className:"".concat(selectorPrefix,"-title-row-author")},null==c?void 0:c(__assign({},P))),React.createElement("div",{className:"".concat(selectorPrefix,"-title-row-date-time")},null==d?void 0:d(__assign({},P)))),React.createElement(FlexLayout.Auto,{className:"".concat(selectorPrefix,"-content-wrap")},null==s?void 0:s(__assign({},P))),React.createElement(FlexLayout.Fixed,null,React.createElement("ul",{className:"".concat(selectorPrefix,"-actions")},I())),React.createElement(ConditionalRender,{conditional:T},function(){return React.createElement(FlexLayout.Fixed,{style:{marginTop:15}},React.createElement(ReplySubmit,{onCancel:function(){return A(!1)},onResult:function(e){null!=(e=null==y?void 0:y({id:null==P?void 0:P[r],record:__assign({},P),reply:e}))&&e.then(function(){A(!1),L()})},local:E,emojiPickerProps:x}))}),React.createElement(ConditionalRender,{conditional:null==P?void 0:P[i]},function(){return React.createElement(React.Fragment,null,React.createElement(ConditionalRender,{conditional:!b},function(){return U()}),React.createElement(ConditionalRender,{conditional:N},function(){return S()}),React.createElement(ConditionalRender,{conditional:b},function(){return null==m?void 0:m()}))}))))};export default memo(Node);
//# sourceMappingURL=index.js.map
