{"version":3,"file":"index.js","sources":["Reply/Submit/index.js"],"sourcesContent":["import _Button from \"antd/es/button\";\nimport _Popover from \"antd/es/popover\";\nimport _Input from \"antd/es/input\";\nimport \"core-js/modules/es.array.iterator.js\";\nimport \"core-js/modules/es.map.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.string.iterator.js\";\nimport \"core-js/modules/esnext.map.delete-all.js\";\nimport \"core-js/modules/esnext.map.every.js\";\nimport \"core-js/modules/esnext.map.filter.js\";\nimport \"core-js/modules/esnext.map.find.js\";\nimport \"core-js/modules/esnext.map.find-key.js\";\nimport \"core-js/modules/esnext.map.includes.js\";\nimport \"core-js/modules/esnext.map.key-of.js\";\nimport \"core-js/modules/esnext.map.map-keys.js\";\nimport \"core-js/modules/esnext.map.map-values.js\";\nimport \"core-js/modules/esnext.map.merge.js\";\nimport \"core-js/modules/esnext.map.reduce.js\";\nimport \"core-js/modules/esnext.map.some.js\";\nimport \"core-js/modules/esnext.map.update.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\nimport \"core-js/modules/es.array.splice.js\";\nimport \"core-js/modules/es.array.includes.js\";\nimport \"core-js/modules/es.string.includes.js\";\nimport \"core-js/modules/es.string.trim.js\";\nimport { __read, __spreadArray } from \"tslib\";\nimport React, { useLayoutEffect, useRef, useState } from 'react';\nimport PropTypes from 'prop-types'; // @ts-ignore\n\nimport data from '@emoji-mart/data';\nimport Picker from '@emoji-mart/react';\nimport Intl from '@baifendian/adhere-util-intl';\nimport Hooks from '@baifendian/adhere-ui-hooks';\nimport ar from '@emoji-mart/data/i18n/ar.json';\nimport de from '@emoji-mart/data/i18n/de.json';\nimport en from '@emoji-mart/data/i18n/en.json';\nimport es from '@emoji-mart/data/i18n/es.json';\nimport fa from '@emoji-mart/data/i18n/fa.json';\nimport fr from '@emoji-mart/data/i18n/fr.json';\nimport it from '@emoji-mart/data/i18n/it.json';\nimport ja from '@emoji-mart/data/i18n/ja.json';\nimport nl from '@emoji-mart/data/i18n/nl.json';\nimport pl from '@emoji-mart/data/i18n/pl.json';\nimport pt from '@emoji-mart/data/i18n/pt.json';\nimport ru from '@emoji-mart/data/i18n/ru.json';\nimport uk from '@emoji-mart/data/i18n/uk.json';\nimport zh from '@emoji-mart/data/i18n/zh.json';\nimport EmojiIcon from './emoji';\nvar TextArea = _Input.TextArea;\nvar useSetState = Hooks.useSetState;\nvar selectorPrefix = 'adhere-ui-comment-reply';\nvar LOCAL_MAP = new Map([['ar', ar], ['de', de], ['en', en], ['es', es], ['fa', fa], ['fr', fr], ['it', it], ['ja', ja], ['nl', nl], ['pl', pl], ['pt', pt], ['ru', ru], ['uk', uk], ['zh', zh]]);\n/**\n * Reply\n * @param props\n * @constructor\n * @classdesc 回复\n */\n\nfunction Reply(props) {\n  var _a = __read(useSetState(''), 2),\n      value = _a[0],\n      setValue = _a[1]; // 回复内容的textarea\n\n\n  var textAreaRef = useRef();\n  var emojiWrapRef = useRef();\n\n  var _b = __read(useState(false), 2),\n      emojiIconWrapVisible = _b[0],\n      setEmojiIconWrapVisible = _b[1];\n  /**\n   * onEmojiSelect\n   * @param native\n   */\n\n\n  function onEmojiSelect(_a) {\n    var _b;\n\n    var native = _a.native; // 获取textarea的dom\n\n    var textareaEl = (_b = textAreaRef === null || textAreaRef === void 0 ? void 0 : textAreaRef.current) === null || _b === void 0 ? void 0 : _b.querySelector('textarea'); // 光标开始索引\n\n    var selectionStart = textareaEl.selectionStart;\n\n    var str = __spreadArray([], __read(value), false);\n\n    str.splice(selectionStart, 0, native);\n    setValue(str.join(''), function () {\n      textareaEl.focus();\n      textareaEl.setSelectionRange(selectionStart + 1, selectionStart + 1);\n    });\n  }\n\n  useLayoutEffect(function () {\n    var _a, _b;\n\n    function onDocBodyClick(e) {\n      console.log('onDocBodyClick');\n      var target = e.target;\n      var textareaEl = textAreaRef === null || textAreaRef === void 0 ? void 0 : textAreaRef.current;\n      console.log('target', target);\n      console.log('textAreaRef.current', textareaEl);\n\n      if (![textareaEl.querySelector('textarea')].includes(target)) {\n        setEmojiIconWrapVisible(false);\n      }\n    }\n\n    function onEmojiWrapClick(e) {\n      console.log('onEmojiIconWrapClick');\n      e.stopPropagation();\n    }\n\n    document.body.addEventListener('click', onDocBodyClick);\n    (_b = (_a = emojiWrapRef === null || emojiWrapRef === void 0 ? void 0 : emojiWrapRef.current) === null || _a === void 0 ? void 0 : _a.addEventListener) === null || _b === void 0 ? void 0 : _b.call(_a, 'click', onEmojiWrapClick);\n    return function () {\n      var _a, _b;\n\n      document.body.removeEventListener('click', onDocBodyClick);\n      (_b = (_a = emojiWrapRef === null || emojiWrapRef === void 0 ? void 0 : emojiWrapRef.current) === null || _a === void 0 ? void 0 : _a.removeEventListener) === null || _b === void 0 ? void 0 : _b.call(_a, 'click', onEmojiWrapClick);\n    };\n  }, []);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"\".concat(selectorPrefix)\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"\".concat(selectorPrefix, \"-textarea-wrap\"),\n    ref: textAreaRef\n  }, /*#__PURE__*/React.createElement(TextArea, {\n    className: \"\".concat(selectorPrefix, \"-textarea\"),\n    placeholder: Intl.v('请输入回复内容'),\n    autoFocus: true,\n    value: value,\n    onChange: function onChange(e) {\n      return setValue(e.target.value);\n    },\n    showCount: true,\n    maxLength: 100\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    ref: emojiWrapRef,\n    className: \"\".concat(selectorPrefix, \"-emoji-wrap\")\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"\".concat(selectorPrefix, \"-toolbar\")\n  }, /*#__PURE__*/React.createElement(_Popover, {\n    placement: \"bottomLeft\",\n    // trigger=\"click\"\n    // @ts-ignore\n    getPopupContainer: function getPopupContainer() {\n      return emojiWrapRef.current;\n    },\n    content: /*#__PURE__*/React.createElement(Picker, {\n      data: data,\n      i18n: LOCAL_MAP.get(props.local || 'zh'),\n      onEmojiSelect: onEmojiSelect\n    }),\n    visible: emojiIconWrapVisible\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    onClick: function onClick(e) {\n      e.stopPropagation();\n      setEmojiIconWrapVisible(!emojiIconWrapVisible);\n    }\n  }, /*#__PURE__*/React.createElement(EmojiIcon, {\n    className: \"\".concat(selectorPrefix, \"-toolbar-item-emoji\")\n  }))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"\".concat(selectorPrefix, \"-toolbar-inner\")\n  }, /*#__PURE__*/React.createElement(_Button, {\n    type: \"primary\",\n    className: \"\".concat(selectorPrefix, \"-toolbar-item\"),\n    disabled: !value,\n    onClick: function onClick() {\n      var _a;\n\n      (_a = props === null || props === void 0 ? void 0 : props.onResult) === null || _a === void 0 ? void 0 : _a.call(props, value.trim());\n    }\n  }, Intl.v('添加')), /*#__PURE__*/React.createElement(_Button, {\n    className: \"\".concat(selectorPrefix, \"-toolbar-item\"),\n    onClick: function onClick() {\n      var _a;\n\n      return (_a = props === null || props === void 0 ? void 0 : props.onCancel) === null || _a === void 0 ? void 0 : _a.call(props);\n    }\n  }, Intl.v('取消')))));\n}\n\nReply.defaultProps = {};\nReply.propTypes = {\n  onCancel: PropTypes.func,\n  onResult: PropTypes.func,\n  local: PropTypes.string\n};\nexport default Reply;"],"names":["_Button","_Popover","_Input","__read","__spreadArray","React","useLayoutEffect","useRef","useState","PropTypes","data","Picker","Intl","Hooks","ar","de","en","es","fa","fr","it","ja","nl","pl","pt","ru","uk","zh","EmojiIcon","TextArea","useSetState","selectorPrefix","LOCAL_MAP","Map","Reply","props","_a","value","setValue","textAreaRef","emojiWrapRef","_b","emojiIconWrapVisible","setEmojiIconWrapVisible","onDocBodyClick","e","console","log","target","textareaEl","current","querySelector","includes","onEmojiWrapClick","stopPropagation","document","body","addEventListener","call","removeEventListener","createElement","className","concat","ref","placeholder","v","autoFocus","onChange","showCount","maxLength","placement","getPopupContainer","content","i18n","get","local","onEmojiSelect","native","selectionStart","str","splice","join","focus","setSelectionRange","visible","onClick","type","disabled","onResult","trim","onCancel","defaultProps","propTypes","func","string"],"mappings":"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"}