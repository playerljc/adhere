{"version":3,"file":"index.js","sources":["Reply/Submit/index.js"],"sourcesContent":["import _Button from \"antd/es/button\";\nimport _Popover from \"antd/es/popover\";\nimport _Input from \"antd/es/input\";\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n    return t;\n  };\n  return __assign.apply(this, arguments);\n};\nimport React, { memo, useCallback, useLayoutEffect, useMemo, useRef, useState } from 'react';\nimport Hooks from '@baifendian/adhere-ui-hooks';\nimport Intl from '@baifendian/adhere-util-intl';\nimport data from '@emoji-mart/data';\nimport ar from '@emoji-mart/data/i18n/ar.json';\nimport de from '@emoji-mart/data/i18n/de.json';\nimport en from '@emoji-mart/data/i18n/en.json';\nimport es from '@emoji-mart/data/i18n/es.json';\nimport fa from '@emoji-mart/data/i18n/fa.json';\nimport fr from '@emoji-mart/data/i18n/fr.json';\nimport it from '@emoji-mart/data/i18n/it.json';\nimport ja from '@emoji-mart/data/i18n/ja.json';\nimport nl from '@emoji-mart/data/i18n/nl.json';\nimport pl from '@emoji-mart/data/i18n/pl.json';\nimport pt from '@emoji-mart/data/i18n/pt.json';\nimport ru from '@emoji-mart/data/i18n/ru.json';\nimport uk from '@emoji-mart/data/i18n/uk.json';\nimport zh from '@emoji-mart/data/i18n/zh.json';\nimport Picker from '@emoji-mart/react';\nimport EmojiIcon from './emoji';\nvar TextArea = _Input.TextArea;\nvar useSetState = Hooks.useSetState;\nvar selectorPrefix = 'adhere-ui-comment-reply';\nvar LOCAL_MAP = new Map([['ar', ar], ['de', de], ['en', en], ['es', es], ['fa', fa], ['fr', fr], ['it', it], ['ja', ja], ['nl', nl], ['pl', pl], ['pt', pt], ['ru', ru], ['uk', uk], ['zh', zh]]);\n/**\n * Reply\n * @param props\n * @constructor\n * @classdesc 回复\n */\nvar Reply = /*#__PURE__*/memo(function (props) {\n  var _a = props.local,\n    local = _a === void 0 ? 'zh' : _a,\n    _b = props.emojiPickerProps,\n    emojiPickerProps = _b === void 0 ? {} : _b,\n    onResult = props.onResult,\n    onCancel = props.onCancel;\n  var _c = useSetState(''),\n    value = _c[0],\n    setValue = _c[1];\n  // 回复内容的textarea\n  var textAreaRef = useRef(null);\n  var emojiWrapRef = useRef(null);\n  var _d = useState(false),\n    emojiIconWrapVisible = _d[0],\n    setEmojiIconWrapVisible = _d[1];\n  /**\n   * onEmojiSelect\n   * @param native\n   */\n  var onEmojiSelect = useCallback(function (_a) {\n    var _b;\n    var native = _a.native;\n    // 获取textarea的dom\n    var textareaEl = (_b = textAreaRef === null || textAreaRef === void 0 ? void 0 : textAreaRef.current) === null || _b === void 0 ? void 0 : _b.querySelector('textarea');\n    // 光标开始索引\n    var selectionStart = textareaEl.selectionStart;\n    // (0) 1 (1) 2 (2) 3 (3)\n    setValue(\"\".concat(value.substring(0, selectionStart)).concat(native).concat(value.substring(selectionStart)), function () {\n      textareaEl.focus();\n      textareaEl.setSelectionRange(selectionStart + native.length, selectionStart + native.length);\n    });\n  }, [value]);\n  var PopoverContent = useMemo(function () {\n    return /*#__PURE__*/React.createElement(Picker, __assign({\n      data: data,\n      i18n: LOCAL_MAP.get(local || 'zh'),\n      onEmojiSelect: onEmojiSelect\n    }, emojiPickerProps !== null && emojiPickerProps !== void 0 ? emojiPickerProps : {}));\n  }, [data, local, onEmojiSelect, emojiPickerProps]);\n  useLayoutEffect(function () {\n    var _a, _b;\n    function onDocBodyClick(e) {\n      var target = e.target;\n      var textareaEl = textAreaRef === null || textAreaRef === void 0 ? void 0 : textAreaRef.current;\n      if (![textareaEl.querySelector('textarea')].includes(target)) {\n        setEmojiIconWrapVisible(false);\n      }\n    }\n    function onEmojiWrapClick(e) {\n      e.stopPropagation();\n    }\n    document.body.addEventListener('click', onDocBodyClick);\n    (_b = (_a = emojiWrapRef === null || emojiWrapRef === void 0 ? void 0 : emojiWrapRef.current) === null || _a === void 0 ? void 0 : _a.addEventListener) === null || _b === void 0 ? void 0 : _b.call(_a, 'click', onEmojiWrapClick);\n    return function () {\n      var _a, _b;\n      document.body.removeEventListener('click', onDocBodyClick);\n      (_b = (_a = emojiWrapRef === null || emojiWrapRef === void 0 ? void 0 : emojiWrapRef.current) === null || _a === void 0 ? void 0 : _a.removeEventListener) === null || _b === void 0 ? void 0 : _b.call(_a, 'click', onEmojiWrapClick);\n    };\n  });\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"\".concat(selectorPrefix)\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"\".concat(selectorPrefix, \"-textarea-wrap\"),\n    ref: textAreaRef\n  }, /*#__PURE__*/React.createElement(TextArea, {\n    className: \"\".concat(selectorPrefix, \"-textarea\"),\n    placeholder: Intl.v('请输入回复内容'),\n    autoFocus: true,\n    value: value,\n    onChange: function onChange(e) {\n      return setValue(e.target.value);\n    },\n    showCount: true,\n    maxLength: 100\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    ref: emojiWrapRef,\n    className: \"\".concat(selectorPrefix, \"-toolbar-emoji-wrap\")\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"\".concat(selectorPrefix, \"-toolbar\")\n  }, /*#__PURE__*/React.createElement(_Popover, {\n    placement: \"bottomLeft\",\n    getPopupContainer: function getPopupContainer() {\n      return emojiWrapRef.current;\n    },\n    content: PopoverContent,\n    open: emojiIconWrapVisible\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    onClick: function onClick(e) {\n      e.stopPropagation();\n      setEmojiIconWrapVisible(function (v) {\n        return !v;\n      });\n    }\n  }, /*#__PURE__*/React.createElement(EmojiIcon, {\n    className: \"\".concat(selectorPrefix, \"-toolbar-item-emoji\")\n  }))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"\".concat(selectorPrefix, \"-toolbar-inner\")\n  }, /*#__PURE__*/React.createElement(_Button, {\n    type: \"primary\",\n    className: \"\".concat(selectorPrefix, \"-toolbar-item\"),\n    disabled: !value,\n    onClick: function onClick() {\n      return onResult === null || onResult === void 0 ? void 0 : onResult(value.trim());\n    }\n  }, Intl.v('添加')), /*#__PURE__*/React.createElement(_Button, {\n    className: \"\".concat(selectorPrefix, \"-toolbar-item\"),\n    onClick: function onClick() {\n      return onCancel === null || onCancel === void 0 ? void 0 : onCancel();\n    }\n  }, Intl.v('取消')))));\n});\nReply.displayName = 'Reply';\nexport default Reply;"],"names":["_Button","_Popover","_Input","__assign","this","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","React","memo","useCallback","useLayoutEffect","useMemo","useRef","useState","Hooks","Intl","data","ar","de","en","es","fa","fr","it","ja","nl","pl","pt","ru","uk","zh","Picker","EmojiIcon","TextArea","useSetState","selectorPrefix","LOCAL_MAP","Map","Reply","props","_a","local","_b","emojiPickerProps","onResult","onCancel","_c","value","setValue","textAreaRef","emojiWrapRef","_d","emojiIconWrapVisible","setEmojiIconWrapVisible","onEmojiSelect","native","textareaEl","current","querySelector","selectionStart","concat","substring","focus","setSelectionRange","PopoverContent","createElement","i18n","get","onDocBodyClick","e","target","includes","onEmojiWrapClick","stopPropagation","document","body","addEventListener","removeEventListener","className","ref","placeholder","v","autoFocus","onChange","showCount","maxLength","placement","getPopupContainer","content","open","onClick","type","disabled","trim","displayName"],"mappings":"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"}