{"version":3,"file":"index.js","sources":["Reply/Submit/index.js"],"sourcesContent":["import { __assign, __read } from \"tslib\";\r\nimport { Button, Input, Popover } from 'antd';\r\nimport React, { memo, useCallback, useLayoutEffect, useMemo, useRef, useState } from 'react';\r\nimport Hooks from '@baifendian/adhere-ui-hooks';\r\nimport Intl from '@baifendian/adhere-util-intl';\r\nimport data from '@emoji-mart/data';\r\nimport ar from '@emoji-mart/data/i18n/ar.json';\r\nimport de from '@emoji-mart/data/i18n/de.json';\r\nimport en from '@emoji-mart/data/i18n/en.json';\r\nimport es from '@emoji-mart/data/i18n/es.json';\r\nimport fa from '@emoji-mart/data/i18n/fa.json';\r\nimport fr from '@emoji-mart/data/i18n/fr.json';\r\nimport it from '@emoji-mart/data/i18n/it.json';\r\nimport ja from '@emoji-mart/data/i18n/ja.json';\r\nimport nl from '@emoji-mart/data/i18n/nl.json';\r\nimport pl from '@emoji-mart/data/i18n/pl.json';\r\nimport pt from '@emoji-mart/data/i18n/pt.json';\r\nimport ru from '@emoji-mart/data/i18n/ru.json';\r\nimport uk from '@emoji-mart/data/i18n/uk.json';\r\nimport zh from '@emoji-mart/data/i18n/zh.json';\r\nimport Picker from '@emoji-mart/react';\r\nimport EmojiIcon from './emoji';\r\nvar TextArea = Input.TextArea;\r\nvar useSetState = Hooks.useSetState;\r\nvar selectorPrefix = 'adhere-ui-comment-reply';\r\nvar LOCAL_MAP = new Map([\r\n    ['ar', ar],\r\n    ['de', de],\r\n    ['en', en],\r\n    ['es', es],\r\n    ['fa', fa],\r\n    ['fr', fr],\r\n    ['it', it],\r\n    ['ja', ja],\r\n    ['nl', nl],\r\n    ['pl', pl],\r\n    ['pt', pt],\r\n    ['ru', ru],\r\n    ['uk', uk],\r\n    ['zh', zh],\r\n]);\r\n/**\r\n * Reply\r\n * @param props\r\n * @constructor\r\n * @classdesc 回复\r\n */\r\nvar Reply = function (props) {\r\n    var _a = props.local, local = _a === void 0 ? 'zh' : _a, _b = props.emojiPickerProps, emojiPickerProps = _b === void 0 ? {} : _b, onResult = props.onResult, onCancel = props.onCancel;\r\n    var _c = __read(useSetState(''), 2), value = _c[0], setValue = _c[1];\r\n    // 回复内容的textarea\r\n    var textAreaRef = useRef(null);\r\n    var emojiWrapRef = useRef(null);\r\n    var _d = __read(useState(false), 2), emojiIconWrapVisible = _d[0], setEmojiIconWrapVisible = _d[1];\r\n    /**\r\n     * onEmojiSelect\r\n     * @param native\r\n     */\r\n    var onEmojiSelect = useCallback(function (_a) {\r\n        var _b;\r\n        var native = _a.native;\r\n        // 获取textarea的dom\r\n        var textareaEl = (_b = textAreaRef === null || textAreaRef === void 0 ? void 0 : textAreaRef.current) === null || _b === void 0 ? void 0 : _b.querySelector('textarea');\r\n        // 光标开始索引\r\n        var selectionStart = textareaEl.selectionStart;\r\n        // (0) 1 (1) 2 (2) 3 (3)\r\n        setValue(\"\".concat(value.substring(0, selectionStart)).concat(native).concat(value.substring(selectionStart)), function () {\r\n            textareaEl.focus();\r\n            textareaEl.setSelectionRange(selectionStart + native.length, selectionStart + native.length);\r\n        });\r\n    }, [value]);\r\n    var PopoverContent = useMemo(function () { return (React.createElement(Picker, __assign({ data: data, i18n: LOCAL_MAP.get(local || 'zh'), onEmojiSelect: onEmojiSelect }, (emojiPickerProps || {})))); }, [data, local, emojiPickerProps]);\r\n    useLayoutEffect(function () {\r\n        var _a, _b;\r\n        function onDocBodyClick(e) {\r\n            var target = e.target;\r\n            var textareaEl = textAreaRef === null || textAreaRef === void 0 ? void 0 : textAreaRef.current;\r\n            if (![textareaEl.querySelector('textarea')].includes(target)) {\r\n                setEmojiIconWrapVisible(false);\r\n            }\r\n        }\r\n        function onEmojiWrapClick(e) {\r\n            e.stopPropagation();\r\n        }\r\n        document.body.addEventListener('click', onDocBodyClick);\r\n        (_b = (_a = emojiWrapRef === null || emojiWrapRef === void 0 ? void 0 : emojiWrapRef.current) === null || _a === void 0 ? void 0 : _a.addEventListener) === null || _b === void 0 ? void 0 : _b.call(_a, 'click', onEmojiWrapClick);\r\n        return function () {\r\n            var _a, _b;\r\n            document.body.removeEventListener('click', onDocBodyClick);\r\n            (_b = (_a = emojiWrapRef === null || emojiWrapRef === void 0 ? void 0 : emojiWrapRef.current) === null || _a === void 0 ? void 0 : _a.removeEventListener) === null || _b === void 0 ? void 0 : _b.call(_a, 'click', onEmojiWrapClick);\r\n        };\r\n    });\r\n    return (React.createElement(\"div\", { className: \"\".concat(selectorPrefix) },\r\n        React.createElement(\"div\", { className: \"\".concat(selectorPrefix, \"-textarea-wrap\"), ref: textAreaRef },\r\n            React.createElement(TextArea, { className: \"\".concat(selectorPrefix, \"-textarea\"), placeholder: Intl.v('请输入回复内容'), autoFocus: true, value: value, onChange: function (e) { return setValue(e.target.value); }, showCount: true, maxLength: 100 })),\r\n        React.createElement(\"div\", { ref: emojiWrapRef, className: \"\".concat(selectorPrefix, \"-toolbar-emoji-wrap\") }),\r\n        React.createElement(\"div\", { className: \"\".concat(selectorPrefix, \"-toolbar\") },\r\n            React.createElement(Popover, { placement: \"bottomLeft\", getPopupContainer: function () { return emojiWrapRef.current; }, content: PopoverContent, open: emojiIconWrapVisible },\r\n                React.createElement(\"div\", { onClick: function (e) {\r\n                        e.stopPropagation();\r\n                        setEmojiIconWrapVisible(function (v) { return !v; });\r\n                    } },\r\n                    React.createElement(EmojiIcon, { className: \"\".concat(selectorPrefix, \"-toolbar-item-emoji\") }))),\r\n            React.createElement(\"div\", { className: \"\".concat(selectorPrefix, \"-toolbar-inner\") },\r\n                React.createElement(Button, { type: \"primary\", className: \"\".concat(selectorPrefix, \"-toolbar-item\"), disabled: !value, onClick: function () { return onResult === null || onResult === void 0 ? void 0 : onResult(value.trim()); } }, Intl.v('添加')),\r\n                React.createElement(Button, { className: \"\".concat(selectorPrefix, \"-toolbar-item\"), onClick: function () { return onCancel === null || onCancel === void 0 ? void 0 : onCancel(); } }, Intl.v('取消'))))));\r\n};\r\nexport default memo(Reply);\r\n//# sourceMappingURL=index.js.map"],"names":["__assign","__read","Button","Input","Popover","React","memo","useCallback","useLayoutEffect","useMemo","useRef","useState","Hooks","Intl","data","ar","de","en","es","fa","fr","it","ja","nl","pl","pt","ru","uk","zh","Picker","EmojiIcon","TextArea","useSetState","selectorPrefix","LOCAL_MAP","Map","Reply","props","_a","local","_b","emojiPickerProps","onResult","onCancel","_c","value","setValue","textAreaRef","emojiWrapRef","_d","emojiIconWrapVisible","setEmojiIconWrapVisible","onEmojiSelect","native","textareaEl","current","querySelector","selectionStart","concat","substring","focus","setSelectionRange","length","PopoverContent","createElement","i18n","get","onDocBodyClick","e","target","includes","onEmojiWrapClick","stopPropagation","document","body","addEventListener","call","removeEventListener","className","ref","placeholder","v","autoFocus","onChange","showCount","maxLength","placement","getPopupContainer","content","open","onClick","type","disabled","trim"],"mappings":"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"}