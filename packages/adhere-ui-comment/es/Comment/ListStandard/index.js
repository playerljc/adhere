var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var a in e=arguments[r])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)},__read=this&&this.__read||function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,a,o=r.call(t),l=[];try{for(;(void 0===e||0<e--)&&!(n=o.next()).done;)l.push(n.value)}catch(t){a={error:t}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(a)throw a.error}}return l},__spreadArray=this&&this.__spreadArray||function(t,e,r){if(r||2===arguments.length)for(var n,a=0,o=e.length;a<o;a++)!n&&a in e||((n=n||Array.prototype.slice.call(e,0,a))[a]=e[a]);return t.concat(n||Array.prototype.slice.call(e))};import{Empty}from"antd";import React,{memo,useCallback,useEffect,useLayoutEffect,useMemo,useRef,useState}from"react";import ConditionalRender from"@baifendian/adhere-ui-conditionalrender";import FlexLayout from"@baifendian/adhere-ui-flexlayout";import ScrollLoad from"@baifendian/adhere-ui-scrollload";import CommentList from"../List";var VerticalFlexLayout=FlexLayout.VerticalFlexLayout,selectorPrefix="adhere-ui-comment-list-standard",ListStandard=function(r){var t=r.limit,e=void 0===t?10:t,t=r.dataKeys,a=void 0===t?{current:"current",totalPage:"totalPage",list:"list",totalCount:"totalCount"}:t,t=r.listProps,n=void 0===t?{}:t,t=r.flexLayoutProps,t=void 0===t?{}:t,o=r.renderFirstLoading,l=r.renderEmpty,i=void 0===l?function(){return React.createElement(Empty,null)}:l,u=r.renderList,c=r.getScrollWrapContainer,s=useRef({page:1,limit:e}),d=useRef(),f=useRef(ScrollLoad.NORMAL),l=useRef(null),m=__read(useState(((m={})[a.current]=1,m[a.totalPage]=0,m[a.list]=[],m[a.totalCount]=0,m)),2),p=m[0],_=m[1],m=__read(useState(!0),2),y=m[0],g=m[1];function L(e){var t;return null==(t=null==r?void 0:r.fetchData)?void 0:t.call(r,null==s?void 0:s.current).then(function(t){return e(t),g(!1),t}).catch(function(t){var e;return g(!1),d.current&&(f.current=ScrollLoad.ERROR,null!=(e=null==d?void 0:d.current)&&e.call(d,f.current)),t})}var v=useCallback(function(t){f.current===ScrollLoad.EMPTY?(f.current=ScrollLoad.EMPTY,t(ScrollLoad.EMPTY)):(d.current=t,setTimeout(function(){return g(!0),s.current.page=s.current.page+1,n=a.list,L(function(r){_(function(t){var e;return __assign(__assign({},r),((e={})[a.list]=__spreadArray(__spreadArray([],__read(t[n]),!1),__read(r[n]),!1),e))})});var n},100))},[]),h=useCallback(function(){return 1===s.current.page&&0===p[a.list].length},[p,a,s.current.page]),m=useMemo(function(){return React.createElement(CommentList,__assign({getScrollWrapContainer:c,isLoading:y,hasMore:p[a.list].length<=p[a.totalCount],onLoadMore:v,renderFirstLoading:o},n||{}),React.createElement(ConditionalRender,{conditional:!h(),noMatch:function(){return i()}},function(){return null==u?void 0:u(p)}))},[c,y,p,a.totalCount,a.list,o,n,i]);return useEffect(function(){g(!0),s.current={page:1,limit:e},L(function(t){_(t)})},[]),useLayoutEffect(function(){d.current&&(f.current=s.current.page<p[a.totalPage]?ScrollLoad.NORMAL:ScrollLoad.EMPTY,null!=d&&d.current(f.current))},[p]),React.createElement(VerticalFlexLayout,__assign({},t||{},{className:"".concat(selectorPrefix),renderMain:React.createElement("div",{className:"".concat(selectorPrefix,"-auto"),ref:l},m)}))};export default memo(ListStandard);
//# sourceMappingURL=index.js.map
