import{__assign,__read,__spreadArray}from"tslib";import{Empty}from"antd";import React,{memo,useCallback,useEffect,useLayoutEffect,useMemo,useRef,useState}from"react";import ConditionalRender from"@baifendian/adhere-ui-conditionalrender";import FlexLayout from"@baifendian/adhere-ui-flexlayout";import ScrollLoad from"@baifendian/adhere-ui-scrollload";import CommentList from"../List";var VerticalFlexLayout=FlexLayout.VerticalFlexLayout,selectorPrefix="adhere-ui-comment-list-standard",ListStandard=function(r){var e=r.limit,t=void 0===e?10:e,e=r.dataKeys,n=void 0===e?{current:"current",totalPage:"totalPage",list:"list",totalCount:"totalCount"}:e,e=r.listProps,a=void 0===e?{}:e,e=r.flexLayoutProps,e=void 0===e?{}:e,o=r.renderFirstLoading,l=r.renderEmpty,i=void 0===l?function(){return React.createElement(Empty,null)}:l,u=r.renderList,c=r.getScrollWrapContainer,s=useRef({page:1,limit:t}),d=useRef(),f=useRef(ScrollLoad.NORMAL),l=useRef(null),m=__read(useState(((m={})[n.current]=1,m[n.totalPage]=0,m[n.list]=[],m[n.totalCount]=0,m)),2),L=m[0],_=m[1],m=__read(useState(!0),2),p=m[0],g=m[1];function v(t){var e;return null==(e=null==r?void 0:r.fetchData)?void 0:e.call(r,null==s?void 0:s.current).then(function(e){return t(e),g(!1),e}).catch(function(e){var t;return g(!1),d.current&&(f.current=ScrollLoad.ERROR,null!=(t=null==d?void 0:d.current)&&t.call(d,f.current)),e})}var R=useCallback(function(e){f.current===ScrollLoad.EMPTY?(f.current=ScrollLoad.EMPTY,e(ScrollLoad.EMPTY)):(d.current=e,setTimeout(function(){return g(!0),s.current.page=s.current.page+1,a=n.list,v(function(r){_(function(e){var t;return __assign(__assign({},r),((t={})[n.list]=__spreadArray(__spreadArray([],__read(e[a]),!1),__read(r[a]),!1),t))})});var a},100))},[]),E=useCallback(function(){return 1===s.current.page&&0===L[n.list].length},[L,n,s.current.page]),m=useMemo(function(){return React.createElement(CommentList,__assign({getScrollWrapContainer:c,isLoading:p,hasMore:L[n.list].length<=L[n.totalCount],onLoadMore:R,renderFirstLoading:o},a||{}),React.createElement(ConditionalRender,{conditional:!E(),noMatch:function(){return i()}},function(){return null==u?void 0:u(L)}))},[c,p,L,n.totalCount,n.list,o,a,i]);return useEffect(function(){g(!0),s.current={page:1,limit:t},v(function(e){_(e)})},[]),useLayoutEffect(function(){d.current&&(f.current=s.current.page<L[n.totalPage]?ScrollLoad.NORMAL:ScrollLoad.EMPTY,null!=d&&d.current(f.current))},[L]),React.createElement(VerticalFlexLayout,__assign({},e||{},{className:"".concat(selectorPrefix),renderMain:React.createElement("div",{className:"".concat(selectorPrefix,"-auto"),ref:l},m)}))};export default memo(ListStandard);
//# sourceMappingURL=index.js.map
