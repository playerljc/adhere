import _Empty from"antd/es/empty";var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var a in e=arguments[r])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)},__spreadArray=this&&this.__spreadArray||function(t,e,r){if(r||2===arguments.length)for(var n,a=0,o=e.length;a<o;a++)!n&&a in e||((n=n||Array.prototype.slice.call(e,0,a))[a]=e[a]);return t.concat(n||Array.prototype.slice.call(e))};import React,{memo,useCallback,useEffect,useLayoutEffect,useMemo,useRef,useState}from"react";import ConditionalRender from"@baifendian/adhere-ui-conditionalrender";import FlexLayout from"@baifendian/adhere-ui-flexlayout";import ScrollLoad from"@baifendian/adhere-ui-scrollload";import CommentList from"../List";var VerticalFlexLayout=FlexLayout.VerticalFlexLayout,selectorPrefix="adhere-ui-comment-list-standard",DEFAULT_KEYS={current:"current",totalPage:"totalPage",list:"list",totalCount:"totalCount"},DEFAULT_RENDER_EMPTY=function(){return React.createElement(_Empty,null)},ListStandard=memo(function(r){var t=r.limit,e=void 0===t?10:t,t=r.dataKeys,a=void 0===t?DEFAULT_KEYS:t,t=r.listProps,n=void 0===t?{}:t,t=r.flexLayoutProps,t=void 0===t?{}:t,o=r.renderFirstLoading,i=r.renderEmpty,l=void 0===i?DEFAULT_RENDER_EMPTY:i,u=r.renderList,c=useRef({page:1,limit:e}),s=useRef(),d=useRef(ScrollLoad.NORMAL),i=useRef(null),f=useState(((f={})[a.current]=1,f[a.totalPage]=0,f[a.list]=[],f[a.totalCount]=0,f)),m=f[0],p=f[1],f=useState(!0),L=f[0],_=f[1];function g(e){var t;return null==(t=null==r?void 0:r.fetchData)?void 0:t.call(r,null==c?void 0:c.current).then(function(t){return e(t),_(!1),t}).catch(function(t){var e;return _(!1),s.current&&(d.current=ScrollLoad.ERROR,null!=(e=null==s?void 0:s.current))&&e.call(s,d.current),t})}var y=useCallback(function(t){s.current=t,setTimeout(function(){return _(!0),c.current.page=c.current.page+1,n=a.list,g(function(r){p(function(t){var e;return __assign(__assign({},r),((e={})[a.list]=__spreadArray(__spreadArray([],t[n],!0),r[n],!0),e))})});var n},100)},[]),E=useCallback(function(){return 1===c.current.page&&0===m[a.list].length},[m,a,c.current.page]),f=useMemo(function(){return React.createElement(CommentList,__assign({isLoading:L,hasMore:m[a.list].length<=m[a.totalCount],onLoadMore:y,renderFirstLoading:o},null!=n?n:{},{pages:m[a.totalPage]}),React.createElement(ConditionalRender,{conditional:!E(),noMatch:function(){return l()}},function(){return null==u?void 0:u(m)}))},[L,m,a.totalCount,a.list,o,n,l]);return useEffect(function(){_(!0),c.current={page:1,limit:e},g(function(t){p(t)})},[]),useLayoutEffect(function(){var t;s.current&&(t=m[a.totalPage],d.current=c.current.page<t?ScrollLoad.NORMAL:ScrollLoad.EMPTY,null!=s)&&s.current(d.current)},[m]),React.createElement(VerticalFlexLayout,__assign({},null!=t?t:{},{className:"".concat(selectorPrefix),renderMain:React.createElement("div",{className:"".concat(selectorPrefix,"-auto"),ref:i},f)}))});ListStandard.displayName="ListStandard";export default ListStandard;
//# sourceMappingURL=index.js.map
