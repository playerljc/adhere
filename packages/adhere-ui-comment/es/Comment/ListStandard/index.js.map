{"version":3,"file":"index.js","sources":["Comment/ListStandard/index.js"],"sourcesContent":["var __assign = (this && this.__assign) || function () {\r\n    __assign = Object.assign || function(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n                t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\nvar __read = (this && this.__read) || function (o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n};\r\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\r\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\r\n        if (ar || !(i in from)) {\r\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\r\n            ar[i] = from[i];\r\n        }\r\n    }\r\n    return to.concat(ar || Array.prototype.slice.call(from));\r\n};\r\nimport { Empty } from 'antd';\r\nimport React, { memo, useCallback, useEffect, useLayoutEffect, useMemo, useRef, useState, } from 'react';\r\nimport ConditionalRender from '@baifendian/adhere-ui-conditionalrender';\r\nimport FlexLayout from '@baifendian/adhere-ui-flexlayout';\r\nimport ScrollLoad from '@baifendian/adhere-ui-scrollload';\r\nimport CommentList from '../List';\r\nvar VerticalFlexLayout = FlexLayout.VerticalFlexLayout;\r\nvar selectorPrefix = 'adhere-ui-comment-list-standard';\r\n/**\r\n * ListStandard\r\n * @param props\r\n * @return {JSX.Element}\r\n * @constructor\r\n * @classdesc 上拉下拽\r\n */\r\nvar ListStandard = function (props) {\r\n    var _a;\r\n    var _b = props.limit, limit = _b === void 0 ? 10 : _b, _c = props.dataKeys, dataKeys = _c === void 0 ? {\r\n        current: 'current',\r\n        totalPage: 'totalPage',\r\n        list: 'list',\r\n        totalCount: 'totalCount',\r\n    } : _c, _d = props.listProps, listProps = _d === void 0 ? {} : _d, _e = props.flexLayoutProps, flexLayoutProps = _e === void 0 ? {} : _e, renderFirstLoading = props.renderFirstLoading, _f = props.renderEmpty, renderEmpty = _f === void 0 ? function () { return React.createElement(Empty, null); } : _f, renderList = props.renderList, getScrollWrapContainer = props.getScrollWrapContainer;\r\n    var paging = useRef({\r\n        page: 1,\r\n        limit: limit,\r\n    });\r\n    var callbackHandler = useRef();\r\n    var status = useRef(ScrollLoad.NORMAL);\r\n    var mainRef = useRef(null);\r\n    var _g = __read(useState((_a = {},\r\n        _a[dataKeys.current] = 1,\r\n        _a[dataKeys.totalPage] = 0,\r\n        _a[dataKeys.list] = [],\r\n        _a[dataKeys.totalCount] = 0,\r\n        _a)), 2), data = _g[0], setData = _g[1];\r\n    var _h = __read(useState(true), 2), loading = _h[0], setLoading = _h[1];\r\n    /**\r\n     * loadData\r\n     * @description 重新加载数据\r\n     * @return {*}\r\n     */\r\n    function loadData() {\r\n        setLoading(true);\r\n        paging.current = {\r\n            page: 1,\r\n            limit: limit,\r\n        };\r\n        return fetchData(function (res) { return setData(res); });\r\n    }\r\n    /**\r\n     * appendData\r\n     * @description 加载更多\r\n     * @return {*}\r\n     */\r\n    function appendData() {\r\n        setLoading(true);\r\n        paging.current.page = paging.current.page + 1;\r\n        var list = dataKeys.list;\r\n        return fetchData(function (res) {\r\n            setData(function (_data) {\r\n                var _a;\r\n                return __assign(__assign({}, res), (_a = {}, _a[dataKeys.list] = __spreadArray(__spreadArray([], __read(_data[list]), false), __read(res[list]), false), _a));\r\n            });\r\n        });\r\n    }\r\n    /**\r\n     * fetchData\r\n     * @description 调用接口\r\n     */\r\n    function fetchData(callback) {\r\n        var _a;\r\n        return (_a = props === null || props === void 0 ? void 0 : props.fetchData) === null || _a === void 0 ? void 0 : _a.call(props, paging === null || paging === void 0 ? void 0 : paging.current).then(function (data) {\r\n            callback(data);\r\n            setLoading(false);\r\n            return data;\r\n        }).catch(function (error) {\r\n            var _a;\r\n            setLoading(false);\r\n            if (callbackHandler.current) {\r\n                status.current = ScrollLoad.ERROR;\r\n                (_a = callbackHandler === null || callbackHandler === void 0 ? void 0 : callbackHandler.current) === null || _a === void 0 ? void 0 : _a.call(callbackHandler, status.current);\r\n            }\r\n            return error;\r\n        });\r\n    }\r\n    /**\r\n     * onLoadMore\r\n     * @param callback\r\n     */\r\n    var onLoadMore = useCallback(function (callback) {\r\n        if (status.current === ScrollLoad.EMPTY) {\r\n            status.current = ScrollLoad.EMPTY;\r\n            callback(ScrollLoad.EMPTY);\r\n            return;\r\n        }\r\n        callbackHandler.current = callback;\r\n        setTimeout(function () { return appendData(); }, 100);\r\n    }, []);\r\n    /**\r\n     * isEmpty\r\n     * @return {boolean}\r\n     */\r\n    var isEmpty = useCallback(function () { return paging.current.page === 1 && data[dataKeys.list].length === 0; }, [data, dataKeys, paging.current.page]);\r\n    var _CommentList = useMemo(function () { return (React.createElement(CommentList, __assign({ getScrollWrapContainer: getScrollWrapContainer, isLoading: loading, hasMore: data[dataKeys.list].length <= data[dataKeys.totalCount], onLoadMore: onLoadMore, renderFirstLoading: renderFirstLoading }, (listProps || {})),\r\n        React.createElement(ConditionalRender, { conditional: !isEmpty(), noMatch: function () { return renderEmpty(); } }, function () { return renderList === null || renderList === void 0 ? void 0 : renderList(data); }))); }, [\r\n        getScrollWrapContainer,\r\n        loading,\r\n        data,\r\n        dataKeys.totalCount,\r\n        dataKeys.list,\r\n        renderFirstLoading,\r\n        listProps,\r\n        renderEmpty,\r\n    ]);\r\n    useEffect(function () {\r\n        loadData();\r\n    }, []);\r\n    useLayoutEffect(function () {\r\n        if (callbackHandler.current) {\r\n            status.current =\r\n                paging.current.page < data[dataKeys.totalPage] ? ScrollLoad.NORMAL : ScrollLoad.EMPTY;\r\n            callbackHandler === null || callbackHandler === void 0 ? void 0 : callbackHandler.current(status.current);\r\n        }\r\n    }, [data]);\r\n    return (React.createElement(VerticalFlexLayout, __assign({}, (flexLayoutProps || {}), { className: \"\".concat(selectorPrefix), renderMain: React.createElement(\"div\", { className: \"\".concat(selectorPrefix, \"-auto\"), ref: mainRef }, _CommentList) })));\r\n};\r\nexport default memo(ListStandard);\r\n"],"names":["__assign","this","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","__read","o","m","Symbol","iterator","r","e","ar","next","done","push","value","error","__spreadArray","to","from","pack","l","Array","slice","concat","Empty","React","memo","useCallback","useEffect","useLayoutEffect","useMemo","useRef","useState","ConditionalRender","FlexLayout","ScrollLoad","CommentList","VerticalFlexLayout","selectorPrefix","ListStandard","props","_b","limit","_c","dataKeys","current","totalPage","list","totalCount","_d","listProps","_e","flexLayoutProps","renderFirstLoading","_f","renderEmpty","createElement","renderList","getScrollWrapContainer","paging","page","callbackHandler","status","NORMAL","mainRef","_g","_a","data","setData","_h","loading","setLoading","fetchData","callback","then","catch","ERROR","onLoadMore","EMPTY","setTimeout","res","_data","isEmpty","_CommentList","isLoading","hasMore","conditional","noMatch","className","renderMain","ref"],"mappings":"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"}