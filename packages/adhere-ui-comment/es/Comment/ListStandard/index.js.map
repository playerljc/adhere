{"version":3,"file":"index.js","sources":["Comment/ListStandard/index.js"],"sourcesContent":["import { __assign, __read, __spreadArray } from \"tslib\";\r\nimport { Empty } from 'antd';\r\nimport React, { memo, useCallback, useEffect, useLayoutEffect, useMemo, useRef, useState, } from 'react';\r\nimport ConditionalRender from '@baifendian/adhere-ui-conditionalrender';\r\nimport FlexLayout from '@baifendian/adhere-ui-flexlayout';\r\nimport ScrollLoad from '@baifendian/adhere-ui-scrollload';\r\nimport CommentList from '../List';\r\nvar VerticalFlexLayout = FlexLayout.VerticalFlexLayout;\r\nvar selectorPrefix = 'adhere-ui-comment-list-standard';\r\n/**\r\n * ListStandard\r\n * @param props\r\n * @return {JSX.Element}\r\n * @constructor\r\n * @classdesc 上拉下拽\r\n */\r\nvar ListStandard = function (props) {\r\n    var _a;\r\n    var _b = props.limit, limit = _b === void 0 ? 10 : _b, _c = props.dataKeys, dataKeys = _c === void 0 ? {\r\n        current: 'current',\r\n        totalPage: 'totalPage',\r\n        list: 'list',\r\n        totalCount: 'totalCount',\r\n    } : _c, _d = props.listProps, listProps = _d === void 0 ? {} : _d, _e = props.flexLayoutProps, flexLayoutProps = _e === void 0 ? {} : _e, renderFirstLoading = props.renderFirstLoading, _f = props.renderEmpty, renderEmpty = _f === void 0 ? function () { return React.createElement(Empty, null); } : _f, renderList = props.renderList, getScrollWrapContainer = props.getScrollWrapContainer;\r\n    var paging = useRef({\r\n        page: 1,\r\n        limit: limit,\r\n    });\r\n    var callbackHandler = useRef();\r\n    var status = useRef(ScrollLoad.NORMAL);\r\n    var mainRef = useRef(null);\r\n    var _g = __read(useState((_a = {},\r\n        _a[dataKeys.current] = 1,\r\n        _a[dataKeys.totalPage] = 0,\r\n        _a[dataKeys.list] = [],\r\n        _a[dataKeys.totalCount] = 0,\r\n        _a)), 2), data = _g[0], setData = _g[1];\r\n    var _h = __read(useState(true), 2), loading = _h[0], setLoading = _h[1];\r\n    /**\r\n     * loadData\r\n     * @description 重新加载数据\r\n     * @return {*}\r\n     */\r\n    function loadData() {\r\n        setLoading(true);\r\n        paging.current = {\r\n            page: 1,\r\n            limit: limit,\r\n        };\r\n        return fetchData(function (res) { return setData(res); });\r\n    }\r\n    /**\r\n     * appendData\r\n     * @description 加载更多\r\n     * @return {*}\r\n     */\r\n    function appendData() {\r\n        setLoading(true);\r\n        paging.current.page = paging.current.page + 1;\r\n        var list = dataKeys.list;\r\n        return fetchData(function (res) {\r\n            setData(function (_data) {\r\n                var _a;\r\n                return __assign(__assign({}, res), (_a = {}, _a[dataKeys.list] = __spreadArray(__spreadArray([], __read(_data[list]), false), __read(res[list]), false), _a));\r\n            });\r\n        });\r\n    }\r\n    /**\r\n     * fetchData\r\n     * @description 调用接口\r\n     */\r\n    function fetchData(callback) {\r\n        var _a;\r\n        return (_a = props === null || props === void 0 ? void 0 : props.fetchData) === null || _a === void 0 ? void 0 : _a.call(props, paging === null || paging === void 0 ? void 0 : paging.current).then(function (data) {\r\n            callback(data);\r\n            setLoading(false);\r\n            return data;\r\n        }).catch(function (error) {\r\n            var _a;\r\n            setLoading(false);\r\n            if (callbackHandler.current) {\r\n                status.current = ScrollLoad.ERROR;\r\n                (_a = callbackHandler === null || callbackHandler === void 0 ? void 0 : callbackHandler.current) === null || _a === void 0 ? void 0 : _a.call(callbackHandler, status.current);\r\n            }\r\n            return error;\r\n        });\r\n    }\r\n    /**\r\n     * onLoadMore\r\n     * @param callback\r\n     */\r\n    var onLoadMore = useCallback(function (callback) {\r\n        if (status.current === ScrollLoad.EMPTY) {\r\n            status.current = ScrollLoad.EMPTY;\r\n            callback(ScrollLoad.EMPTY);\r\n            return;\r\n        }\r\n        callbackHandler.current = callback;\r\n        setTimeout(function () { return appendData(); }, 100);\r\n    }, []);\r\n    /**\r\n     * isEmpty\r\n     * @return {boolean}\r\n     */\r\n    var isEmpty = useCallback(function () { return paging.current.page === 1 && data[dataKeys.list].length === 0; }, [data, dataKeys, paging.current.page]);\r\n    var _CommentList = useMemo(function () { return (React.createElement(CommentList, __assign({ getScrollWrapContainer: getScrollWrapContainer, isLoading: loading, hasMore: data[dataKeys.list].length <= data[dataKeys.totalCount], onLoadMore: onLoadMore, renderFirstLoading: renderFirstLoading }, (listProps || {})),\r\n        React.createElement(ConditionalRender, { conditional: !isEmpty(), noMatch: function () { return renderEmpty(); } }, function () { return renderList === null || renderList === void 0 ? void 0 : renderList(data); }))); }, [\r\n        getScrollWrapContainer,\r\n        loading,\r\n        data,\r\n        dataKeys.totalCount,\r\n        dataKeys.list,\r\n        renderFirstLoading,\r\n        listProps,\r\n        renderEmpty,\r\n    ]);\r\n    useEffect(function () {\r\n        loadData();\r\n    }, []);\r\n    useLayoutEffect(function () {\r\n        if (callbackHandler.current) {\r\n            status.current =\r\n                paging.current.page < data[dataKeys.totalPage] ? ScrollLoad.NORMAL : ScrollLoad.EMPTY;\r\n            callbackHandler === null || callbackHandler === void 0 ? void 0 : callbackHandler.current(status.current);\r\n        }\r\n    }, [data]);\r\n    return (React.createElement(VerticalFlexLayout, __assign({}, (flexLayoutProps || {}), { className: \"\".concat(selectorPrefix), renderMain: React.createElement(\"div\", { className: \"\".concat(selectorPrefix, \"-auto\"), ref: mainRef }, _CommentList) })));\r\n};\r\nexport default memo(ListStandard);\r\n//# sourceMappingURL=index.js.map"],"names":["__assign","__read","__spreadArray","Empty","React","memo","useCallback","useEffect","useLayoutEffect","useMemo","useRef","useState","ConditionalRender","FlexLayout","ScrollLoad","CommentList","VerticalFlexLayout","selectorPrefix","ListStandard","props","_b","limit","_c","dataKeys","current","totalPage","list","totalCount","_d","listProps","_e","flexLayoutProps","renderFirstLoading","_f","renderEmpty","createElement","renderList","getScrollWrapContainer","paging","page","callbackHandler","status","NORMAL","mainRef","_g","_a","data","setData","_h","loading","setLoading","fetchData","callback","call","then","catch","error","ERROR","onLoadMore","EMPTY","setTimeout","res","_data","isEmpty","length","_CommentList","isLoading","hasMore","conditional","noMatch","className","concat","renderMain","ref"],"mappings":"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"}