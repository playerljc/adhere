{"version":3,"file":"index.js","sources":["Comment/ListStandard/index.js"],"sourcesContent":["import _Empty from \"antd/es/empty\";\nimport { __assign, __spreadArray } from \"tslib\";\nimport React, { useEffect, useLayoutEffect, useRef, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport ConditionalRender from '@baifendian/adhere-ui-conditionalrender';\nimport ScrollLoad from '@baifendian/adhere-ui-scrollload';\nimport FlexLayout from '@baifendian/adhere-ui-flexlayout';\nimport CommentList, { propTypes as SystemListPropTypes, defaultProps as SystemListDefaultProps } from '../List';\nvar VerticalFlexLayout = FlexLayout.VerticalFlexLayout,\n    VerticalFlexLayoutDefaultProps = FlexLayout.VerticalFlexLayoutDefaultProps,\n    VerticalFlexLayoutPropTypes = FlexLayout.VerticalFlexLayoutPropTypes;\nvar selectorPrefix = 'adhere-ui-comment-list-standard';\n/**\n * ListStandard\n * @param props\n * @return {JSX.Element}\n * @constructor\n */\n\nfunction ListStandard(props) {\n  var _a;\n\n  var paging = useRef({\n    page: 1,\n    limit: props.limit\n  });\n  var callbackHandler = useRef();\n  var status = useRef(ScrollLoad.NORMAL);\n  var mainRef = useRef();\n\n  var _b = useState((_a = {}, _a[props.dataKeys.current] = 1, _a[props.dataKeys.totalPage] = 0, _a[props.dataKeys.list] = [], _a[props.dataKeys.totalCount] = 0, _a)),\n      data = _b[0],\n      setData = _b[1];\n\n  var _c = useState(true),\n      loading = _c[0],\n      setLoading = _c[1];\n  /**\n   * loadData\n   * @description 重新加载数据\n   * @return {*}\n   */\n\n\n  function loadData() {\n    setLoading(true);\n    paging.current = {\n      page: 1,\n      limit: props.limit\n    };\n    return fetchData(function (res) {\n      setData(res);\n    });\n  }\n  /**\n   * appendData\n   * @description 加载更多\n   * @return {*}\n   */\n\n\n  function appendData() {\n    setLoading(true);\n    paging.current.page = paging.current.page + 1;\n    var list = props.dataKeys.list;\n    return fetchData(function (res) {\n      var _a;\n\n      setData(__assign(__assign({}, res), (_a = {}, _a[props.dataKeys.list] = __spreadArray(__spreadArray([], data[list], true), res[list], true), _a)));\n    });\n  }\n  /**\n   * fetchData\n   * @description 调用接口\n   */\n\n\n  function fetchData(callback) {\n    var _a;\n\n    return (_a = props === null || props === void 0 ? void 0 : props.fetchData) === null || _a === void 0 ? void 0 : _a.call(props, paging === null || paging === void 0 ? void 0 : paging.current).then(function (data) {\n      callback(data);\n      setLoading(false);\n      return data;\n    }).catch(function (error) {\n      var _a;\n\n      setLoading(false);\n\n      if (callbackHandler.current) {\n        status.current = ScrollLoad.ERROR; // @ts-ignore\n\n        (_a = callbackHandler === null || callbackHandler === void 0 ? void 0 : callbackHandler.current) === null || _a === void 0 ? void 0 : _a.call(callbackHandler, status.current);\n      }\n\n      return error;\n    });\n  }\n  /**\n   * onLoadMore\n   * @param callback\n   */\n\n\n  function onLoadMore(callback) {\n    if (status.current === ScrollLoad.EMPTY) {\n      status.current = ScrollLoad.EMPTY;\n      callback(ScrollLoad.EMPTY);\n      return;\n    }\n\n    callbackHandler.current = callback;\n    setTimeout(function () {\n      return appendData();\n    }, 100);\n  }\n  /**\n   * isEmpty\n   * @return {boolean}\n   */\n\n\n  function isEmpty() {\n    return paging.current.page === 1 && data[props.dataKeys.list].length === 0;\n  }\n\n  useEffect(function () {\n    loadData();\n  }, []);\n  useLayoutEffect(function () {\n    if (callbackHandler.current) {\n      status.current = paging.current.page < data[props.dataKeys.totalPage] ? ScrollLoad.NORMAL : ScrollLoad.EMPTY; // @ts-ignore\n\n      callbackHandler === null || callbackHandler === void 0 ? void 0 : callbackHandler.current(status.current);\n    }\n  }, [data]);\n  return /*#__PURE__*/React.createElement(VerticalFlexLayout, __assign({}, props.flexLayoutProps, {\n    className: \"\".concat(selectorPrefix),\n    renderMain:\n    /*#__PURE__*/\n    // @ts-ignore\n    React.createElement(\"div\", {\n      className: \"\".concat(selectorPrefix, \"-auto\"),\n      ref: mainRef\n    }, /*#__PURE__*/React.createElement(CommentList, __assign({\n      getScrollWrapContainer: props.getScrollWrapContainer,\n      isLoading: loading,\n      hasMore: data[props.dataKeys.list].length <= data[props.dataKeys.totalCount],\n      onLoadMore: onLoadMore,\n      renderFirstLoading: props.renderFirstLoading\n    }, props.listProps), /*#__PURE__*/React.createElement(ConditionalRender, {\n      conditional: !isEmpty(),\n      noMatch: function noMatch() {\n        var _a;\n\n        return (_a = props === null || props === void 0 ? void 0 : props.renderEmpty) === null || _a === void 0 ? void 0 : _a.call(props);\n      }\n    }, function () {\n      var _a;\n\n      return (_a = props === null || props === void 0 ? void 0 : props.renderList) === null || _a === void 0 ? void 0 : _a.call(props, data);\n    })))\n  }));\n}\n\nListStandard.defaultProps = {\n  flexLayoutProps: __assign({}, VerticalFlexLayoutDefaultProps),\n  listProps: __assign({}, SystemListDefaultProps),\n  limit: 10,\n  renderEmpty: function renderEmpty() {\n    return /*#__PURE__*/React.createElement(_Empty, null);\n  },\n  dataKeys: {\n    current: 'current',\n    totalPage: 'totalPage',\n    list: 'list',\n    totalCount: 'totalCount'\n  }\n};\nListStandard.propTypes = {\n  getScrollWrapContainer: PropTypes.func,\n  flexLayoutProps: PropTypes.shape(__assign({}, VerticalFlexLayoutPropTypes)),\n  listProps: PropTypes.shape(__assign({}, SystemListPropTypes)),\n  limit: PropTypes.number,\n  renderList: PropTypes.func,\n  renderEmpty: PropTypes.func,\n  renderFirstLoading: PropTypes.func,\n  fetchData: PropTypes.func,\n  dataKeys: PropTypes.shape({\n    current: PropTypes.string,\n    totalPage: PropTypes.string,\n    list: PropTypes.string,\n    totalCount: PropTypes.string\n  }),\n  scrollLoadProps: PropTypes.shape({\n    className: PropTypes.string,\n    style: PropTypes.object,\n    loadClassName: PropTypes.string,\n    loadStyle: PropTypes.object,\n    emptyClassName: PropTypes.string,\n    emptyStyle: PropTypes.object,\n    errorClassName: PropTypes.string,\n    errorStyle: PropTypes.object,\n    distance: PropTypes.number,\n    onScrollBottom: PropTypes.func,\n    onEmptyClick: PropTypes.func,\n    onErrorClick: PropTypes.func,\n    renderLoading: PropTypes.func,\n    renderEmpty: PropTypes.func,\n    renderError: PropTypes.func\n  })\n};\nexport default ListStandard;"],"names":["_Empty","__assign","__spreadArray","React","useEffect","useLayoutEffect","useRef","useState","PropTypes","ConditionalRender","ScrollLoad","FlexLayout","CommentList","SystemListPropTypes","SystemListDefaultProps","VerticalFlexLayout","VerticalFlexLayoutDefaultProps","VerticalFlexLayoutPropTypes","selectorPrefix","ListStandard","props","paging","page","limit","callbackHandler","status","NORMAL","mainRef","_b","_a","dataKeys","current","totalPage","list","totalCount","data","setData","_c","loading","setLoading","fetchData","callback","call","then","catch","error","ERROR","res","EMPTY","createElement","flexLayoutProps","className","concat","renderMain","ref","getScrollWrapContainer","isLoading","hasMore","length","onLoadMore","setTimeout","renderFirstLoading","listProps","conditional","noMatch","renderEmpty","renderList","defaultProps","propTypes","func","shape","number","string","scrollLoadProps","style","object","loadClassName","loadStyle","emptyClassName","emptyStyle","errorClassName","errorStyle","distance","onScrollBottom","onEmptyClick","onErrorClick","renderLoading","renderError"],"mappings":"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"}