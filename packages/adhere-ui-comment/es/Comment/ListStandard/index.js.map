{"version":3,"file":"index.js","sources":["Comment/ListStandard/index.js"],"sourcesContent":["import _Empty from \"antd/es/empty\";\nimport { __assign, __read, __spreadArray } from \"tslib\";\nimport React, { useEffect, useLayoutEffect, useRef, useState } from 'react';\nimport ConditionalRender from '@baifendian/adhere-ui-conditionalrender';\nimport ScrollLoad from '@baifendian/adhere-ui-scrollload';\nimport FlexLayout from '@baifendian/adhere-ui-flexlayout';\nimport CommentList from '../List';\nvar VerticalFlexLayout = FlexLayout.VerticalFlexLayout;\nvar selectorPrefix = 'adhere-ui-comment-list-standard';\n/**\n * ListStandard\n * @param props\n * @return {JSX.Element}\n * @constructor\n * @classdesc 上拉下拽\n */\n\nvar ListStandard = function ListStandard(props) {\n  var _a;\n\n  var _b = props.limit,\n      limit = _b === void 0 ? 10 : _b,\n      _c = props.dataKeys,\n      dataKeys = _c === void 0 ? {\n    current: 'current',\n    totalPage: 'totalPage',\n    list: 'list',\n    totalCount: 'totalCount'\n  } : _c,\n      _d = props.listProps,\n      listProps = _d === void 0 ? {} : _d,\n      _e = props.flexLayoutProps,\n      flexLayoutProps = _e === void 0 ? {} : _e,\n      renderFirstLoading = props.renderFirstLoading,\n      _f = props.renderEmpty,\n      renderEmpty = _f === void 0 ? function () {\n    return /*#__PURE__*/React.createElement(_Empty, null);\n  } : _f,\n      renderList = props.renderList,\n      getScrollWrapContainer = props.getScrollWrapContainer;\n  var paging = useRef({\n    page: 1,\n    limit: limit\n  });\n  var callbackHandler = useRef();\n  var status = useRef(ScrollLoad.NORMAL);\n  var mainRef = useRef(null);\n\n  var _g = __read(useState((_a = {}, _a[dataKeys.current] = 1, _a[dataKeys.totalPage] = 0, _a[dataKeys.list] = [], _a[dataKeys.totalCount] = 0, _a)), 2),\n      data = _g[0],\n      setData = _g[1];\n\n  var _h = __read(useState(true), 2),\n      loading = _h[0],\n      setLoading = _h[1];\n  /**\n   * loadData\n   * @description 重新加载数据\n   * @return {*}\n   */\n\n\n  function loadData() {\n    setLoading(true);\n    paging.current = {\n      page: 1,\n      limit: limit\n    };\n    return fetchData(function (res) {\n      return setData(res);\n    });\n  }\n  /**\n   * appendData\n   * @description 加载更多\n   * @return {*}\n   */\n\n\n  function appendData() {\n    setLoading(true);\n    paging.current.page = paging.current.page + 1;\n    var list = dataKeys.list;\n    return fetchData(function (res) {\n      var _a;\n\n      setData(__assign(__assign({}, res), (_a = {}, _a[dataKeys.list] = __spreadArray(__spreadArray([], __read(data[list]), false), __read(res[list]), false), _a)));\n    });\n  }\n  /**\n   * fetchData\n   * @description 调用接口\n   */\n\n\n  function fetchData(callback) {\n    var _a;\n\n    return (_a = props === null || props === void 0 ? void 0 : props.fetchData) === null || _a === void 0 ? void 0 : _a.call(props, paging === null || paging === void 0 ? void 0 : paging.current).then(function (data) {\n      callback(data);\n      setLoading(false);\n      return data;\n    }).catch(function (error) {\n      var _a;\n\n      setLoading(false);\n\n      if (callbackHandler.current) {\n        status.current = ScrollLoad.ERROR;\n        (_a = callbackHandler === null || callbackHandler === void 0 ? void 0 : callbackHandler.current) === null || _a === void 0 ? void 0 : _a.call(callbackHandler, status.current);\n      }\n\n      return error;\n    });\n  }\n  /**\n   * onLoadMore\n   * @param callback\n   */\n\n\n  function onLoadMore(callback) {\n    if (status.current === ScrollLoad.EMPTY) {\n      status.current = ScrollLoad.EMPTY;\n      callback(ScrollLoad.EMPTY);\n      return;\n    }\n\n    callbackHandler.current = callback;\n    setTimeout(function () {\n      return appendData();\n    }, 100);\n  }\n  /**\n   * isEmpty\n   * @return {boolean}\n   */\n\n\n  function isEmpty() {\n    return paging.current.page === 1 && data[dataKeys.list].length === 0;\n  }\n\n  useEffect(function () {\n    loadData();\n  }, []);\n  useLayoutEffect(function () {\n    if (callbackHandler.current) {\n      status.current = paging.current.page < data[dataKeys.totalPage] ? ScrollLoad.NORMAL : ScrollLoad.EMPTY;\n      callbackHandler === null || callbackHandler === void 0 ? void 0 : callbackHandler.current(status.current);\n    }\n  }, [data]);\n  return /*#__PURE__*/React.createElement(VerticalFlexLayout, __assign({}, flexLayoutProps || {}, {\n    className: \"\".concat(selectorPrefix),\n    renderMain: /*#__PURE__*/React.createElement(\"div\", {\n      className: \"\".concat(selectorPrefix, \"-auto\"),\n      ref: mainRef\n    }, /*#__PURE__*/React.createElement(CommentList, __assign({\n      getScrollWrapContainer: getScrollWrapContainer,\n      isLoading: loading,\n      hasMore: data[dataKeys.list].length <= data[dataKeys.totalCount],\n      onLoadMore: onLoadMore,\n      renderFirstLoading: renderFirstLoading\n    }, listProps || {}), /*#__PURE__*/React.createElement(ConditionalRender, {\n      conditional: !isEmpty(),\n      noMatch: function noMatch() {\n        return renderEmpty();\n      }\n    }, function () {\n      return renderList === null || renderList === void 0 ? void 0 : renderList(data);\n    })))\n  }));\n};\n\nexport default ListStandard;"],"names":["_Empty","__assign","__read","__spreadArray","React","useEffect","useLayoutEffect","useRef","useState","ConditionalRender","ScrollLoad","FlexLayout","CommentList","VerticalFlexLayout","selectorPrefix","ListStandard","props","_b","limit","_c","dataKeys","current","totalPage","list","totalCount","_d","listProps","_e","flexLayoutProps","renderFirstLoading","_f","renderEmpty","createElement","renderList","getScrollWrapContainer","paging","page","callbackHandler","status","NORMAL","mainRef","_g","_a","data","setData","_h","loading","setLoading","fetchData","callback","call","then","catch","error","ERROR","res","EMPTY","className","concat","renderMain","ref","isLoading","hasMore","length","onLoadMore","setTimeout","conditional","noMatch"],"mappings":"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"}