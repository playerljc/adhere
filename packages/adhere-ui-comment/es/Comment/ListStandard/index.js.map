{"version":3,"file":"index.js","sources":["Comment/ListStandard/index.js"],"sourcesContent":["import _Empty from \"antd/es/empty\";\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n    return t;\n  };\n  return __assign.apply(this, arguments);\n};\nvar __spreadArray = this && this.__spreadArray || function (to, from, pack) {\n  if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n    if (ar || !(i in from)) {\n      if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n      ar[i] = from[i];\n    }\n  }\n  return to.concat(ar || Array.prototype.slice.call(from));\n};\nimport React, { memo, useCallback, useEffect, useLayoutEffect, useMemo, useRef, useState } from 'react';\nimport ConditionalRender from '@baifendian/adhere-ui-conditionalrender';\nimport FlexLayout from '@baifendian/adhere-ui-flexlayout';\nimport ScrollLoad from '@baifendian/adhere-ui-scrollload';\nimport CommentList from '../List';\nvar VerticalFlexLayout = FlexLayout.VerticalFlexLayout;\nvar selectorPrefix = 'adhere-ui-comment-list-standard';\nvar DEFAULT_KEYS = {\n  current: 'current',\n  totalPage: 'totalPage',\n  list: 'list',\n  totalCount: 'totalCount'\n};\nvar DEFAULT_RENDER_EMPTY = function () {\n  return /*#__PURE__*/React.createElement(_Empty, null);\n};\n/**\n * ListStandard\n * @param props\n * @return {JSX.Element}\n * @constructor\n * @classdesc 上拉下拽\n */\nvar ListStandard = /*#__PURE__*/memo(function (props) {\n  var _a;\n  var _b = props.limit,\n    limit = _b === void 0 ? 10 : _b,\n    _c = props.dataKeys,\n    dataKeys = _c === void 0 ? DEFAULT_KEYS : _c,\n    _d = props.listProps,\n    listProps = _d === void 0 ? {} : _d,\n    _e = props.flexLayoutProps,\n    flexLayoutProps = _e === void 0 ? {} : _e,\n    renderFirstLoading = props.renderFirstLoading,\n    _f = props.renderEmpty,\n    renderEmpty = _f === void 0 ? DEFAULT_RENDER_EMPTY : _f,\n    renderList = props.renderList;\n  var paging = useRef({\n    page: 1,\n    limit: limit\n  });\n  var callbackHandler = useRef();\n  var status = useRef(ScrollLoad.NORMAL);\n  var mainRef = useRef(null);\n  var _g = useState((_a = {}, _a[dataKeys.current] = 1, _a[dataKeys.totalPage] = 0, _a[dataKeys.list] = [], _a[dataKeys.totalCount] = 0, _a)),\n    data = _g[0],\n    setData = _g[1];\n  var _h = useState(true),\n    loading = _h[0],\n    setLoading = _h[1];\n  /**\n   * loadData\n   * @description 重新加载数据\n   * @return {*}\n   */\n  function loadData() {\n    setLoading(true);\n    paging.current = {\n      page: 1,\n      limit: limit\n    };\n    return fetchData(function (res) {\n      return setData(res);\n    });\n  }\n  /**\n   * appendData\n   * @description 加载更多\n   * @return {*}\n   */\n  function appendData() {\n    setLoading(true);\n    paging.current.page = paging.current.page + 1;\n    var list = dataKeys.list;\n    return fetchData(function (res) {\n      setData(function (_data) {\n        var _a;\n        return __assign(__assign({}, res), (_a = {}, _a[dataKeys.list] = __spreadArray(__spreadArray([], _data[list], true), res[list], true), _a));\n      });\n    });\n  }\n  /**\n   * fetchData\n   * @description 调用接口\n   */\n  function fetchData(callback) {\n    var _a;\n    return (_a = props === null || props === void 0 ? void 0 : props.fetchData) === null || _a === void 0 ? void 0 : _a.call(props, paging === null || paging === void 0 ? void 0 : paging.current).then(function (data) {\n      callback(data);\n      setLoading(false);\n      return data;\n    }).catch(function (error) {\n      var _a;\n      setLoading(false);\n      if (callbackHandler.current) {\n        status.current = ScrollLoad.ERROR;\n        (_a = callbackHandler === null || callbackHandler === void 0 ? void 0 : callbackHandler.current) === null || _a === void 0 ? void 0 : _a.call(callbackHandler, status.current);\n      }\n      return error;\n    });\n  }\n  /**\n   * onLoadMore\n   * @param callback\n   */\n  var onLoadMore = useCallback(function (callback) {\n    // if (status.current === ScrollLoad.EMPTY) {\n    //   status.current = ScrollLoad.EMPTY;\n    //   callback(ScrollLoad.EMPTY);\n    //   return;\n    // }\n    callbackHandler.current = callback;\n    setTimeout(function () {\n      return appendData();\n    }, 100);\n  }, []);\n  /**\n   * isEmpty\n   * @return {boolean}\n   */\n  var isEmpty = useCallback(function () {\n    return paging.current.page === 1 && data[dataKeys.list].length === 0;\n  }, [data, dataKeys, paging.current.page]);\n  var _CommentList = useMemo(function () {\n    return /*#__PURE__*/React.createElement(CommentList, __assign({\n      isLoading: loading,\n      // @ts-ignore\n      hasMore: data[dataKeys.list].length <= data[dataKeys.totalCount],\n      onLoadMore: onLoadMore,\n      renderFirstLoading: renderFirstLoading\n    }, listProps !== null && listProps !== void 0 ? listProps : {}, {\n      pages: data[dataKeys.totalPage]\n    }), /*#__PURE__*/React.createElement(ConditionalRender, {\n      conditional: !isEmpty(),\n      noMatch: function () {\n        return renderEmpty();\n      }\n    }, function () {\n      return renderList === null || renderList === void 0 ? void 0 : renderList(data);\n    }));\n  }, [loading, data, dataKeys.totalCount, dataKeys.list, renderFirstLoading, listProps, renderEmpty]);\n  useEffect(function () {\n    loadData();\n  }, []);\n  useLayoutEffect(function () {\n    if (callbackHandler.current) {\n      var totalPage = data[dataKeys.totalPage];\n      status.current =\n      // @ts-ignore\n      paging.current.page < totalPage ? ScrollLoad.NORMAL : ScrollLoad.EMPTY;\n      callbackHandler === null || callbackHandler === void 0 ? void 0 : callbackHandler.current(status.current);\n    }\n  }, [data]);\n  return /*#__PURE__*/React.createElement(VerticalFlexLayout, __assign({}, flexLayoutProps !== null && flexLayoutProps !== void 0 ? flexLayoutProps : {}, {\n    className: \"\".concat(selectorPrefix),\n    renderMain: /*#__PURE__*/React.createElement(\"div\", {\n      className: \"\".concat(selectorPrefix, \"-auto\"),\n      ref: mainRef\n    }, _CommentList)\n  }));\n});\nListStandard.displayName = 'ListStandard';\nexport default ListStandard;"],"names":["_Empty","__assign","this","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","__spreadArray","to","from","pack","ar","l","Array","slice","concat","React","memo","useCallback","useEffect","useLayoutEffect","useMemo","useRef","useState","ConditionalRender","FlexLayout","ScrollLoad","CommentList","VerticalFlexLayout","selectorPrefix","DEFAULT_KEYS","current","totalPage","list","totalCount","DEFAULT_RENDER_EMPTY","createElement","ListStandard","props","_b","limit","_c","dataKeys","_d","listProps","_e","flexLayoutProps","renderFirstLoading","_f","renderEmpty","renderList","paging","page","callbackHandler","status","NORMAL","mainRef","_g","_a","data","setData","_h","loading","setLoading","fetchData","callback","then","catch","error","ERROR","onLoadMore","setTimeout","res","_data","isEmpty","_CommentList","isLoading","hasMore","pages","conditional","noMatch","EMPTY","className","renderMain","ref","displayName"],"mappings":"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"}