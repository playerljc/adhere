import _CaretDownOutlined from"@ant-design/icons/es/icons/CaretDownOutlined";import _CaretUpOutlined from"@ant-design/icons/es/icons/CaretUpOutlined";import _EnterOutlined from"@ant-design/icons/es/icons/EnterOutlined";import"core-js/modules/es.array.map.js";import{__assign,__spreadArray}from"tslib";import React,{useRef,useState}from"react";import PropTypes from"prop-types";import classNames from"classnames";import ConditionalRender from"@baifendian/adhere-ui-conditionalrender";import FlexLayout from"@baifendian/adhere-ui-flexlayout";import Intl from"@baifendian/adhere-util-intl";import Reply from"../Reply";var selectorPrefix="adhere-ui-comment-commit";function Commit(a){var e=useState(((t={})[a.dataKeys.current]=1,t[a.dataKeys.list]=[],t[a.dataKeys.totalCount]=0,t[a.dataKeys.totalPage]=0,t)),r=e[0],o=e[1],t=useState(!1),n=t[0],l=t[1],e=useState(!1),i=e[0],c=e[1],t=useState(!1),e=t[0],s=t[1],d=useRef({page:1,limit:a.limit});function u(){return React.createElement("ul",{className:"".concat(selectorPrefix,"-children")},(r[a.dataKeys.list]||[]).map(function(e){return React.createElement("li",{className:"".concat(selectorPrefix,"-children-item"),key:e[a.keyProp]},React.createElement(Commit,{isReply:!0,data:e,keyProp:a.keyProp,isMoreProp:a.isMoreProp,renderLoading:a.renderLoading,fetchData:a.fetchData,renderActions:a.renderActions,renderAuthor:a.renderAuthor,renderAvatar:a.renderAvatar,renderContent:a.renderContent,renderDateTime:a.renderDateTime}))}),React.createElement(ConditionalRender,{conditional:!i&&r[a.dataKeys.list].length<=r[a.dataKeys.totalCount]},function(){return React.createElement("li",{className:classNames("".concat(selectorPrefix,"-children-item"),"more")},React.createElement("a",{onClick:function(){d.current.page=d.current.page+1,function(){c(!0),d.current.page=d.current.page+1;var n=a.dataKeys.list;p(function(e){var t;o(__assign(__assign({},e),((t={})[a.dataKeys.list]=__spreadArray(__spreadArray([],r[n],!0),e[n],!0),t)))})}()}},React.createElement("span",null,React.createElement(_EnterOutlined,{className:"reply-icon"})),React.createElement("span",null,Intl.v("加载更多回复"))))}))}function m(){return c(!0),d.current={page:1,limit:a.limit},p(function(e){o(e)})}function p(t){var e;return null===(e=null==a?void 0:a.fetchData)||void 0===e?void 0:e.call(a,__assign(__assign({},d.current),{id:null===(e=null==a?void 0:a.data)||void 0===e?void 0:e[a.keyProp]})).then(function(e){return t(e),c(!1),e}).catch(function(e){return c(!1),e})}return React.createElement(FlexLayout,{direction:"horizontal",className:classNames(selectorPrefix,a.isReply?"".concat(selectorPrefix,"-reply"):null)},React.createElement(FlexLayout.Fixed,{className:"".concat(selectorPrefix,"-reply-avatar-wrap")},null===(t=null==a?void 0:a.renderAvatar)||void 0===t?void 0:t.call(a,a.data)),React.createElement(FlexLayout.Auto,{autoFixed:!0,fit:!0},React.createElement(FlexLayout,{direction:"vertical"},React.createElement(FlexLayout.Fixed,{className:"".concat(selectorPrefix,"-title-row"),fit:!1},React.createElement("div",{className:"".concat(selectorPrefix,"-title-row-author")},null===(t=null==a?void 0:a.renderAuthor)||void 0===t?void 0:t.call(a,a.data)),React.createElement("div",{className:"".concat(selectorPrefix,"-title-row-date-time")},null===(t=null==a?void 0:a.renderDateTime)||void 0===t?void 0:t.call(a,a.data))),React.createElement(FlexLayout.Auto,{className:"".concat(selectorPrefix,"-content-wrap")},null===(t=null==a?void 0:a.renderContent)||void 0===t?void 0:t.call(a,a.data)),React.createElement(FlexLayout.Fixed,null,React.createElement("ul",{className:"".concat(selectorPrefix,"-actions")},__spreadArray(__spreadArray([],((null===(t=null==a?void 0:a.renderActions)||void 0===t?void 0:t.call(a,null==a?void 0:a.data))||[]).map(function(e,t){return React.createElement("li",{key:t,className:"".concat(selectorPrefix,"-actions-action")},e)}),!0),[React.createElement("li",{className:classNames("".concat(selectorPrefix,"-actions-action"),"".concat(selectorPrefix,"-actions-action-reply-btn")),onClick:function(){return s(!0)}},Intl.v("回复"))],!1))),React.createElement(ConditionalRender,{conditional:e},function(){return React.createElement(FlexLayout.Fixed,{style:{marginTop:15}},React.createElement(Reply,{onCancel:function(){return s(!1)},onResult:function(e){var t;null!==(e=null===(t=null==a?void 0:a.fetchReply)||void 0===t?void 0:t.call(a,{id:null===(t=null==a?void 0:a.data)||void 0===t?void 0:t[a.keyProp],reply:e}))&&void 0!==e&&e.then(function(){s(!1),m()})}}))}),React.createElement(ConditionalRender,{conditional:null===(e=null==a?void 0:a.data)||void 0===e?void 0:e[a.isMoreProp]},function(){return React.createElement(React.Fragment,null,React.createElement(ConditionalRender,{conditional:!i},function(){return React.createElement(ConditionalRender,{conditional:!n,noMatch:function(){return React.createElement("a",{className:"".concat(selectorPrefix,"-collapse"),onClick:function(){l(!1)}},React.createElement("span",null,React.createElement(_CaretUpOutlined,null)),React.createElement("span",null,Intl.v("收起回复")))}},function(){return React.createElement("a",{className:"".concat(selectorPrefix,"-collapse"),onClick:function(){var e;r[a.dataKeys.list].length?l(!0):null!==(e=m())&&void 0!==e&&e.then(function(){l(!0)})}},React.createElement("span",null,React.createElement(_CaretDownOutlined,null)),React.createElement("span",null,Intl.v("显示回复内容")))})}),React.createElement(ConditionalRender,{conditional:n},u),React.createElement(ConditionalRender,{conditional:i},function(){var e;return null===(e=null==a?void 0:a.renderLoading)||void 0===e?void 0:e.call(a)}))}))))}Commit.defaultProps={isReply:!1,limit:10,dataKeys:{current:"current",totalPage:"totalPage",list:"list",totalCount:"totalCount"}},Commit.propTypes={isReply:PropTypes.bool,data:PropTypes.shape({key:PropTypes.string}),dataKeys:PropTypes.shape({current:PropTypes.string,totalPage:PropTypes.string,list:PropTypes.string,totalCount:PropTypes.string}),renderLoading:PropTypes.func,limit:PropTypes.number,fetchData:PropTypes.func,fetchReply:PropTypes.func,keyProp:PropTypes.string,isMoreProp:PropTypes.string,renderActions:PropTypes.func,renderAuthor:PropTypes.func,renderAvatar:PropTypes.func,renderContent:PropTypes.func,renderDateTime:PropTypes.func};export default Commit;
//# sourceMappingURL=index.js.map
