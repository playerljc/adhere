{"version":3,"file":"index.js","sources":["server/compose/index.js"],"sourcesContent":["\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n/**\r\n * Compose\r\n * @description 组合中间件\r\n * @param middleWares\r\n * @constructor\r\n */\r\nfunction Compose(middleWares) {\r\n    return function (ctx, next) {\r\n        return new Promise(function (resolve) {\r\n            var index = -1;\r\n            // 中间件的返回值\r\n            var middleWareQueueResults = Array.from({\r\n                length: middleWares.length,\r\n            }).fill(undefined);\r\n            /**\r\n             * loop\r\n             * @description 迭代方法\r\n             */\r\n            var loop = function () {\r\n                // 迭代完成了\r\n                if (index + 1 >= middleWares.length) {\r\n                    Promise.all(middleWareQueueResults.filter(function (t) { return t instanceof Promise; })).then(function () {\r\n                        // 真正的迭代完成\r\n                        if (next) {\r\n                            var p = next();\r\n                            if (p && p.then) {\r\n                                p.then(function () {\r\n                                    resolve();\r\n                                });\r\n                                return;\r\n                            }\r\n                        }\r\n                        resolve();\r\n                    });\r\n                    return;\r\n                }\r\n                index++;\r\n                // 调用中间件方法\r\n                middleWareQueueResults[index] = middleWares[index](ctx, \r\n                // @ts-ignore\r\n                function () { return loop(); });\r\n                return middleWareQueueResults[index];\r\n            };\r\n            loop();\r\n        });\r\n    };\r\n}\r\nexports.default = Compose;\r\n"],"names":["Compose","middleWares","ctx","next","Promise","resolve","index","middleWareQueueResults","Array","from","length","fill","undefined","loop","all","filter","t","then","p","Object","defineProperty","exports","value","default"],"mappings":"aAQA,SAASA,QAAQC,GACb,OAAO,SAAUC,EAAKC,GAClB,OAAO,IAAIC,QAAQ,SAAUC,GACzB,IAAIC,GAAS,EAETC,EAAyBC,MAAMC,KAAK,CACpCC,OAAQT,EAAYS,SACrBC,UAAKC,GAKJC,EAAO,WAEP,KAAIP,EAAQ,GAAKL,EAAYS,QAqB7B,OAHAH,IAFAD,GAEgCL,EAAYK,GAAOJ,EAEnD,WAAc,OAAOW,MACdN,EAAuBD,GApB1BF,QAAQU,IAAIP,EAAuBQ,OAAO,SAAUC,GAAK,OAAOA,aAAaZ,WAAaa,KAAK,WAE3F,GAAId,EAAM,CACN,IAAIe,EAAIf,IACR,GAAIe,GAAKA,EAAED,KAIP,YAHAC,EAAED,KAAK,WACHZ,MAKZA,OAWZQ,OA5CZM,OAAOC,eAAeC,QAAS,aAAc,CAAEC,OAAO,IAgDtDD,QAAQE,QAAUvB"}