{"version":3,"file":"index.js","sources":["server/compose/index.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * Compose\n * @description 组合中间件\n * @param middleWares\n * @constructor\n */\nfunction Compose(middleWares) {\n    return function (ctx, next) {\n        return new Promise(function (resolve) {\n            var index = -1;\n            // 中间件的返回值\n            var middleWareQueueResults = Array.from({\n                length: middleWares.length,\n            }).fill(undefined);\n            /**\n             * loop\n             * @description 迭代方法\n             */\n            var loop = function () {\n                // 迭代完成了\n                if (index + 1 >= middleWares.length) {\n                    Promise.all(middleWareQueueResults.filter(function (t) { return t instanceof Promise; })).then(function () {\n                        // 真正的迭代完成\n                        if (next) {\n                            var p = next();\n                            if (p && p.then) {\n                                p.then(function () {\n                                    resolve();\n                                });\n                                return;\n                            }\n                        }\n                        resolve();\n                    });\n                    return;\n                }\n                index++;\n                // 调用中间件方法\n                // @ts-ignore\n                middleWareQueueResults[index] = middleWares[index](ctx, function () { return loop(); });\n                return middleWareQueueResults[index];\n            };\n            loop();\n        });\n    };\n}\nexports.default = Compose;\n"],"names":["Compose","middleWares","ctx","next","Promise","resolve","index","middleWareQueueResults","Array","from","length","fill","undefined","loop","all","filter","t","then","p","Object","defineProperty","exports","value","default"],"mappings":"AAAA,aAQA,SAASA,QAAQC,GACb,OAAO,SAAUC,EAAKC,GAClB,OAAO,IAAIC,QAAQ,SAAUC,GACzB,IAAIC,EAAQ,CAAC,EAETC,EAAyBC,MAAMC,KAAK,CACpCC,OAAQT,EAAYS,MACxB,CAAC,EAAEC,KAAKC,KAAAA,CAAS,EAKbC,EAAO,WAEP,GAAIP,EAAAA,EAAQ,GAAKL,EAAYS,QAoB7B,OADAH,EAHAD,EAAAA,GAGgCL,EAAYK,GAAOJ,EAAK,WAAc,OAAOW,EAAK,CAAG,CAAC,EAC/EN,EAAuBD,GAnB1BF,QAAQU,IAAIP,EAAuBQ,OAAO,SAAUC,GAAK,OAAOA,aAAaZ,OAAS,CAAC,CAAC,EAAEa,KAAK,WAE3F,GAAId,EAAM,CACN,IAAIe,EAAIf,EAAK,EACb,GAAIe,GAAKA,EAAED,KAIP,OAHAC,KAAAA,EAAED,KAAK,WACHZ,EAAQ,CACZ,CAAC,CAGT,CACAA,EAAQ,CACZ,CAAC,CAQT,EACAQ,EAAK,CACT,CAAC,CACL,CACJ,CA9CAM,OAAOC,eAAeC,QAAS,aAAc,CAAEC,MAAO,CAAA,CAAK,CAAC,EA+C5DD,QAAQE,QAAUvB"}