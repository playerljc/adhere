var __extends=this&&this.__extends||function(){var r=function(e,t){return(r=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}))(e,t)};return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}(),__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},__spreadArray=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,a=0,o=t.length;a<o;a++)!r&&a in t||((r=r||Array.prototype.slice.call(t,0,a))[a]=t[a]);return e.concat(r||Array.prototype.slice.call(t))};import{Avatar,Checkbox,Collapse,List}from"antd";import classNames from"classnames";import PropTypes from"prop-types";import React,{createRef,forwardRef}from"react";import ConditionalRender from"@baifendian/adhere-ui-conditionalrender";import Intl from"@baifendian/adhere-util-intl";import ServiceRegister from"@ctsj/state/lib/middleware/saga/serviceregister";import SearchList,{defaultProps,propTypes}from"./SearchList";var selectorPrefix="adhere-ui-searchtableimplement",defaultMetas=__assign({title:{dataIndex:"title"},subTitle:{dataIndex:"subTitle"},description:{dataIndex:"description"},avatar:{dataIndex:"avatar"},actions:{dataIndex:"actions",cardActionProps:"actions"},content:{dataIndex:"content"},extra:{dataIndex:"extra"}}),Panel=Collapse.Panel,SearchListImplement=function(t){function e(e){var r=t.call(this,e)||this;return r.innerWrapRef=createRef(),r.onSelectChange=function(e,t){var n;r.setState(((n={})[e]=t,n))},r.onInputChange=function(e,t){var n;r.setState(((n={})[e]=t.target.value.trim(),n))},r.onDateTimeRangeChange=function(e,t){var n;r.setState(((n={})[e[0]]=t&&t.length?t[0]:null,n[e[1]]=t&&t.length?t[1]:null,n))},Object.assign(r.state,__assign(__assign({},r.getParams()),{searchParams:__assign({},r.getParams()),selectedRowKeys:[],selectedRows:[]})),r.renderItem=r.renderItem.bind(r),r}return __extends(e,t),e.prototype.componentDidMount=function(){t.prototype.componentDidMount.call(this);var e=this.props.getListWrapperInstance;e&&e(this.innerWrapRef)},e.prototype.getFetchListPropName=function(){return""},e.prototype.getFetchListPropNameToFirstUpper=function(){var e=this.getFetchListPropName();return 1<e.length?"".concat(e.charAt(0).toUpperCase()).concat(e.substring(1)):e},e.prototype.getParams=function(){return{}},e.prototype.getServiceName=function(){return""},e.prototype.getFetchDataParams=function(){return{}},e.prototype.isShowNumber=function(){return!0},e.prototype.getNumberGeneratorRule=function(){return SearchList.NUMBER_GENERATOR_RULE_CONTINUITY},e.prototype.getRowKey=function(){return"id"},e.prototype.getDataKey=function(){return"list"},e.prototype.getTotalKey=function(){return"totalCount"},e.prototype.getData=function(){return this.props[this.getServiceName()][this.getFetchListPropName()][this.getDataKey()]},e.prototype.getTotal=function(){return this.props[this.getServiceName()][this.getFetchListPropName()][this.getTotalKey()]},e.prototype.getRowSelection=function(){var n=this;return{selectedRowKeys:this.state.selectedRowKeys,onChange:function(e,t){n.setState({selectedRowKeys:e,selectedRows:t})}}},e.prototype.renderSearchForm=function(){return null},e.prototype.renderInner=function(){var e=t.prototype.renderInner.call(this);return React.createElement("div",{ref:this.innerWrapRef,className:"".concat(selectorPrefix,"-tablewrapper")},e)},e.prototype.renderSearchFooterItems=function(){return[]},e.prototype.clear=function(){var t=this;return new Promise(function(e){t.setState(__assign(__assign({},t.getParams()),{searchParams:__assign({},t.getParams()),selectedRowKeys:[],selectedRows:[]}),function(){e()})})},e.prototype.showLoading=function(){return this.props.loading["".concat(this.getServiceName(),"/").concat(this.getFetchListPropName())]},e.prototype.getSearchParams=function(){var e=this.state,t=e.page,n=e.limit,e=e.searchParams;return __assign({},__assign(__assign({page:t,limit:n},e),this.getFetchDataParams()))},e.prototype.getMetas=function(){return{}},e.prototype.fetchData=function(){return this.fetchDataExecute(this.getSearchParams())},e.prototype.sync=function(){var r=this;return new Promise(function(e){var t,n=r.state.page;1===n?e(r.fetchData()):t=r.fetchData().then(function(){r.getData().length?e(t):r.setState({page:n-1},function(){return e(r.fetchData())})})})},e.prototype.fetchDataExecute=function(e){return this.props["".concat(this.getServiceName()).concat(this.getFetchListPropNameToFirstUpper())](e)},e.prototype.onSearch=function(){var t=this,e=Object.keys(this.getParams()),n={};return e.forEach(function(e){n[e]=t.state[e]}),new Promise(function(e){t.setState({searchParams:__assign({},n)},function(){t.fetchData().then(function(){e()})})})},e.prototype.selectCheckBoxChange=function(e,t){var n,r=this.getRowSelection(),a=this.getRowKey(),e=e.target.checked,o=__spreadArray([],this.state.selectedRowKeys||[],!0),i=this.getData(),s=t[a],t=e?__spreadArray([s],o,!0):o.filter(function(e){return e!==s}),o=t.map(function(t){return i.find(function(e){return e[a]===t})});null!=(n=null==r?void 0:r.onChange)&&n.call(r,t,o,{type:e?"single":"invert"})},e.prototype.unSelectedAll=function(){var r=this;return new Promise(function(e){var t,n=r.getRowSelection();null!=(t=null==n?void 0:n.onChange)&&t.call(n,[],[],{type:"multiple"}),e()})},e.prototype.renderSearchFormAfter=function(){return null},e.prototype.renderSearchFormBefore=function(){return null},e.prototype.renderSearchFooter=function(){return null},e.prototype.renderSearchHeader=function(){return null},e.prototype.renderItemSelection=function(e,t){var n=this,r=null==(r=this.state.selectedRowKeys)?void 0:r.includes(t[this.getRowKey()]);return React.createElement("div",{className:"".concat(selectorPrefix,"-list-rowSelection-checkbox-wrap")},React.createElement(Checkbox,{checked:r,onChange:function(e){n.selectCheckBoxChange(e,t)}}))},e.prototype.renderNormalItem=function(e,t){var n=__assign(__assign({},defaultMetas),this.getMetas()||{}),r=(null==(r=null==(c=null==n?void 0:n.avatar)?void 0:c.render)?void 0:r.call(c,null==e?void 0:e[n.avatar.dataIndex],e,t))||n.avatar&&(null==e?void 0:e[n.avatar.dataIndex])&&React.createElement(Avatar,{src:null==e?void 0:e[n.avatar.dataIndex]}),a=(null==(a=null==(c=null==n?void 0:n.subTitle)?void 0:c.render)?void 0:a.call(c,null==e?void 0:e[n.subTitle.dataIndex],e,t))||n.subTitle&&(null==e?void 0:e[n.subTitle.dataIndex]),o=(null==(o=null==(c=null==n?void 0:n.title)?void 0:c.render)?void 0:o.call(c,null==e?void 0:e[n.title.dataIndex],e,t))||n.title&&(null==e?void 0:e[n.title.dataIndex]),i=(null==(i=null==(c=null==n?void 0:n.description)?void 0:c.render)?void 0:i.call(c,null==e?void 0:e[n.description.dataIndex],e,t))||n.description&&(null==e?void 0:e[n.description.dataIndex]),s=(null==(s=null==(c=null==n?void 0:n.content)?void 0:c.render)?void 0:s.call(c,null==e?void 0:e[n.content.dataIndex],e,t))||n.content&&(null==e?void 0:e[n.content.dataIndex]),c={};return r&&(c.avatar=r),o&&(c.title=o,a)&&(c.title=React.createElement("div",{className:"".concat(selectorPrefix,"-list-meta-title-wrap")},React.createElement("div",{className:"".concat(selectorPrefix,"-list-meta-title")},o),React.createElement("div",{className:"".concat(selectorPrefix,"-list-meta-subTitle")},a))),i&&(c.description=i),React.createElement(React.Fragment,null,React.createElement(List.Item.Meta,__assign({},c)),s||null)},e.prototype.renderNumberColumn=function(e,t){return React.createElement("span",{className:"".concat(selectorPrefix,"-list-number")},e)},e.prototype.renderItem=function(e,t){var n=this,r=this.getRowSelection(),a=e[this.getRowKey()],o={},i=__assign(__assign({},defaultMetas),this.getMetas()||{}),s=(null==(s=null==(c=null==i?void 0:i.extra)?void 0:c.render)?void 0:s.call(c,null==e?void 0:e[i.extra.dataIndex],e,t))||i.extra&&(null==e?void 0:e[i.extra.dataIndex]),c=(null==(l=null==(c=null==i?void 0:i.actions)?void 0:c.render)?void 0:l.call(c,null==e?void 0:e[i.actions.dataIndex],e,t))||(null==(l=i.actions&&(null==e?void 0:e[i.actions.dataIndex])&&(null==e?void 0:e[i.actions.dataIndex]))?void 0:l.map(function(e){return React.createElement("span",null,e)})),s=(s&&(o.extra=s),c&&(o[(null==(l=i.actions)?void 0:l.cardActionProps)||"actions"]=c),this.renderNormalItem(e,t)),l=(r&&(s=React.createElement(React.Fragment,null,this.renderItemSelection(s,e),s)),null!=(i=this.getNumberGeneratorRule())?i:SearchList.NUMBER_GENERATOR_RULE_ALONE),c=this.state,i=c.page,u=void 0===i?0:i,i=c.limit,p=void 0===i?10:i,s=this.isShowNumber()?React.createElement(React.Fragment,null,React.createElement(ConditionalRender,{conditional:l===SearchList.NUMBER_GENERATOR_RULE_ALONE,noMatch:function(){return n.renderNumberColumn((u-1)*p+(t+1),{record:e,index:t})}},function(){return n.renderNumberColumn(t+1,{record:e,index:t})}),s):s,i=!!r&&(null==(c=this.state.selectedRowKeys)?void 0:c.includes(a))?"".concat(selectorPrefix,"-list-item-active"):null;return React.createElement(List.Item,__assign({className:classNames("".concat(selectorPrefix,"-list-item"),i),key:this.getRowKey()},o),s)},e.prototype.renderListHeader=function(){var e,t=this;return React.createElement("div",{className:"".concat(selectorPrefix,"-list-rowSelection-header")},React.createElement("div",{className:"".concat(selectorPrefix,"-list-rowSelection-header-info")},Intl.v("已选择{count}项",{count:null==(e=this.state.selectedRowKeys)?void 0:e.length})),React.createElement("div",{className:"".concat(selectorPrefix,"-list-rowSelection-header-cancel")},React.createElement("a",{onClick:function(){t.unSelectedAll()}},Intl.v("取消选择"))))},e}(SearchList),SearchListImplementFactory=(SearchListImplement.defaultProps=__assign({},defaultProps),SearchListImplement.propTypes=__assign(__assign({},propTypes),{getListWrapperInstance:PropTypes.func}),function(e){function t(e){return __assign(__assign(__assign({},ServiceRegister.mapStateToProps({namespaces:a||[],state:e})),{loading:e.loading}),o?o(e):{})}function r(e){return __assign(__assign({},ServiceRegister.mapDispatchToProps({namespaces:a||[],dispatch:e})),i?i(e):{})}var n=e.serviceNames,a=void 0===n?[]:n,o=e.mapStateToProps,i=e.mapDispatchToProps;return function(n){return ServiceRegister.connect(a||[])(t,r)(forwardRef(function(e,t){return React.createElement(n,__assign({ref:t,className:"".concat(selectorPrefix,"-wrap"),isShowExpandSearch:!0,defaultExpandSearchCollapse:!1},e))}))}});export default SearchListImplementFactory;export{selectorPrefix,SearchListImplement};
//# sourceMappingURL=SearchListImplement.js.map
