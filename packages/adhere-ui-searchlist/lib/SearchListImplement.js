"use strict";var __extends=this&&this.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)};return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},__createBinding=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&("get"in a?t.__esModule:!a.writable&&!a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,a)}:function(e,t,r,n){e[n=void 0===n?r:n]=t[r]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding(t,e,r);return __setModuleDefault(t,e),t},__spreadArray=this&&this.__spreadArray||function(e,t,r){if(r||2===arguments.length)for(var n,a=0,o=t.length;a<o;a++)!n&&a in t||((n=n||Array.prototype.slice.call(t,0,a))[a]=t[a]);return e.concat(n||Array.prototype.slice.call(t))},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},antd_1=(Object.defineProperty(exports,"__esModule",{value:!0}),exports.SearchListImplement=exports.selectorPrefix=void 0,require("antd")),classnames_1=__importDefault(require("classnames")),prop_types_1=__importDefault(require("prop-types")),react_1=__importStar(require("react")),adhere_ui_conditionalrender_1=__importDefault(require("@baifendian/adhere-ui-conditionalrender")),adhere_util_intl_1=__importDefault(require("@baifendian/adhere-util-intl")),serviceregister_1=__importDefault(require("@ctsj/state/lib/middleware/saga/serviceregister")),SearchList_1=__importStar(require("./SearchList")),defaultMetas=(exports.selectorPrefix="adhere-ui-searchtableimplement",__assign({title:{dataIndex:"title"},subTitle:{dataIndex:"subTitle"},description:{dataIndex:"description"},avatar:{dataIndex:"avatar"},actions:{dataIndex:"actions",cardActionProps:"actions"},content:{dataIndex:"content"},extra:{dataIndex:"extra"}})),Panel=antd_1.Collapse.Panel,SearchListImplement=function(t){function e(e){var n=t.call(this,e)||this;return n.innerWrapRef=(0,react_1.createRef)(),n.onSelectChange=function(e,t){var r;n.setState(((r={})[e]=t,r))},n.onInputChange=function(e,t){var r;n.setState(((r={})[e]=t.target.value.trim(),r))},n.onDateTimeRangeChange=function(e,t){var r;n.setState(((r={})[e[0]]=t&&t.length?t[0]:null,r[e[1]]=t&&t.length?t[1]:null,r))},Object.assign(n.state,__assign(__assign({},n.getParams()),{searchParams:__assign({},n.getParams()),selectedRowKeys:[],selectedRows:[]})),n.renderItem=n.renderItem.bind(n),n}return __extends(e,t),e.prototype.componentDidMount=function(){t.prototype.componentDidMount.call(this);var e=this.props.getListWrapperInstance;e&&e(this.innerWrapRef)},e.prototype.getFetchListPropName=function(){return""},e.prototype.getFetchListPropNameToFirstUpper=function(){var e=this.getFetchListPropName();return 1<e.length?"".concat(e.charAt(0).toUpperCase()).concat(e.substring(1)):e},e.prototype.getParams=function(){return{}},e.prototype.getServiceName=function(){return""},e.prototype.getFetchDataParams=function(){return{}},e.prototype.isShowNumber=function(){return!0},e.prototype.getNumberGeneratorRule=function(){return SearchList_1.default.NUMBER_GENERATOR_RULE_CONTINUITY},e.prototype.getRowKey=function(){return"id"},e.prototype.getDataKey=function(){return"list"},e.prototype.getTotalKey=function(){return"totalCount"},e.prototype.getData=function(){return this.props[this.getServiceName()][this.getFetchListPropName()][this.getDataKey()]},e.prototype.getTotal=function(){return this.props[this.getServiceName()][this.getFetchListPropName()][this.getTotalKey()]},e.prototype.getRowSelection=function(){var r=this;return{selectedRowKeys:this.state.selectedRowKeys,onChange:function(e,t){r.setState({selectedRowKeys:e,selectedRows:t})}}},e.prototype.renderSearchForm=function(){return null},e.prototype.renderInner=function(){var e=t.prototype.renderInner.call(this);return react_1.default.createElement("div",{ref:this.innerWrapRef,className:"".concat(exports.selectorPrefix,"-tablewrapper")},e)},e.prototype.renderSearchFooterItems=function(){return[]},e.prototype.clear=function(){var t=this;return new Promise(function(e){t.setState(__assign(__assign({},t.getParams()),{searchParams:__assign({},t.getParams()),selectedRowKeys:[],selectedRows:[]}),function(){e()})})},e.prototype.showLoading=function(){return this.props.loading["".concat(this.getServiceName(),"/").concat(this.getFetchListPropName())]},e.prototype.getSearchParams=function(){var e=this.state,t=e.page,r=e.limit,e=e.searchParams;return __assign({},__assign(__assign({page:t,limit:r},e),this.getFetchDataParams()))},e.prototype.getMetas=function(){return{}},e.prototype.fetchData=function(){return this.fetchDataExecute(this.getSearchParams())},e.prototype.sync=function(){var n=this;return new Promise(function(e){var t,r=n.state.page;1===r?e(n.fetchData()):t=n.fetchData().then(function(){n.getData().length?e(t):n.setState({page:r-1},function(){return e(n.fetchData())})})})},e.prototype.fetchDataExecute=function(e){return this.props["".concat(this.getServiceName()).concat(this.getFetchListPropNameToFirstUpper())](e)},e.prototype.onSearch=function(){var t=this,e=Object.keys(this.getParams()),r={};return e.forEach(function(e){r[e]=t.state[e]}),new Promise(function(e){t.setState({searchParams:__assign({},r)},function(){t.fetchData().then(function(){e()})})})},e.prototype.selectCheckBoxChange=function(e,t){var r,n=this.getRowSelection(),a=this.getRowKey(),e=e.target.checked,o=__spreadArray([],this.state.selectedRowKeys||[],!0),i=this.getData(),s=t[a],t=e?__spreadArray([s],o,!0):o.filter(function(e){return e!==s}),o=t.map(function(t){return i.find(function(e){return e[a]===t})});null!=(r=null==n?void 0:n.onChange)&&r.call(n,t,o,{type:e?"single":"invert"})},e.prototype.unSelectedAll=function(){var n=this;return new Promise(function(e){var t,r=n.getRowSelection();null!=(t=null==r?void 0:r.onChange)&&t.call(r,[],[],{type:"multiple"}),e()})},e.prototype.renderSearchFormAfter=function(){return null},e.prototype.renderSearchFormBefore=function(){return null},e.prototype.renderSearchFooter=function(){return null},e.prototype.renderSearchHeader=function(){return null},e.prototype.renderItemSelection=function(e,t){var r=this,n=null==(n=this.state.selectedRowKeys)?void 0:n.includes(t[this.getRowKey()]);return react_1.default.createElement("div",{className:"".concat(exports.selectorPrefix,"-list-rowSelection-checkbox-wrap")},react_1.default.createElement(antd_1.Checkbox,{checked:n,onChange:function(e){r.selectCheckBoxChange(e,t)}}))},e.prototype.renderNormalItem=function(e,t){var r=__assign(__assign({},defaultMetas),this.getMetas()||{}),n=(null==(n=null==(l=null==r?void 0:r.avatar)?void 0:l.render)?void 0:n.call(l,null==e?void 0:e[r.avatar.dataIndex],e,t))||r.avatar&&(null==e?void 0:e[r.avatar.dataIndex])&&react_1.default.createElement(antd_1.Avatar,{src:null==e?void 0:e[r.avatar.dataIndex]}),a=(null==(a=null==(l=null==r?void 0:r.subTitle)?void 0:l.render)?void 0:a.call(l,null==e?void 0:e[r.subTitle.dataIndex],e,t))||r.subTitle&&(null==e?void 0:e[r.subTitle.dataIndex]),o=(null==(o=null==(l=null==r?void 0:r.title)?void 0:l.render)?void 0:o.call(l,null==e?void 0:e[r.title.dataIndex],e,t))||r.title&&(null==e?void 0:e[r.title.dataIndex]),i=(null==(i=null==(l=null==r?void 0:r.description)?void 0:l.render)?void 0:i.call(l,null==e?void 0:e[r.description.dataIndex],e,t))||r.description&&(null==e?void 0:e[r.description.dataIndex]),s=(null==(s=null==(l=null==r?void 0:r.content)?void 0:l.render)?void 0:s.call(l,null==e?void 0:e[r.content.dataIndex],e,t))||r.content&&(null==e?void 0:e[r.content.dataIndex]),l={};return n&&(l.avatar=n),o&&(l.title=o,a)&&(l.title=react_1.default.createElement("div",{className:"".concat(exports.selectorPrefix,"-list-meta-title-wrap")},react_1.default.createElement("div",{className:"".concat(exports.selectorPrefix,"-list-meta-title")},o),react_1.default.createElement("div",{className:"".concat(exports.selectorPrefix,"-list-meta-subTitle")},a))),i&&(l.description=i),react_1.default.createElement(react_1.default.Fragment,null,react_1.default.createElement(antd_1.List.Item.Meta,__assign({},l)),s||null)},e.prototype.renderNumberColumn=function(e,t){return react_1.default.createElement("span",{className:"".concat(exports.selectorPrefix,"-list-number")},e)},e.prototype.renderItem=function(e,t){var r=this,n=this.getRowSelection(),a=e[this.getRowKey()],o={},i=__assign(__assign({},defaultMetas),this.getMetas()||{}),s=(null==(s=null==(l=null==i?void 0:i.extra)?void 0:l.render)?void 0:s.call(l,null==e?void 0:e[i.extra.dataIndex],e,t))||i.extra&&(null==e?void 0:e[i.extra.dataIndex]),l=(null==(c=null==(l=null==i?void 0:i.actions)?void 0:l.render)?void 0:c.call(l,null==e?void 0:e[i.actions.dataIndex],e,t))||(null==(c=i.actions&&(null==e?void 0:e[i.actions.dataIndex])&&(null==e?void 0:e[i.actions.dataIndex]))?void 0:c.map(function(e){return react_1.default.createElement("span",null,e)})),s=(s&&(o.extra=s),l&&(o[(null==(c=i.actions)?void 0:c.cardActionProps)||"actions"]=l),this.renderNormalItem(e,t)),c=(n&&(s=react_1.default.createElement(react_1.default.Fragment,null,this.renderItemSelection(s,e),s)),null!=(i=this.getNumberGeneratorRule())?i:SearchList_1.default.NUMBER_GENERATOR_RULE_ALONE),l=this.state,i=l.page,u=void 0===i?0:i,i=l.limit,d=void 0===i?10:i,s=this.isShowNumber()?react_1.default.createElement(react_1.default.Fragment,null,react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:c===SearchList_1.default.NUMBER_GENERATOR_RULE_ALONE,noMatch:function(){return r.renderNumberColumn((u-1)*d+(t+1),{record:e,index:t})}},function(){return r.renderNumberColumn(t+1,{record:e,index:t})}),s):s,i=!!n&&(null==(l=this.state.selectedRowKeys)?void 0:l.includes(a))?"".concat(exports.selectorPrefix,"-list-item-active"):null;return react_1.default.createElement(antd_1.List.Item,__assign({className:(0,classnames_1.default)("".concat(exports.selectorPrefix,"-list-item"),i),key:this.getRowKey()},o),s)},e.prototype.renderListHeader=function(){var e,t=this;return react_1.default.createElement("div",{className:"".concat(exports.selectorPrefix,"-list-rowSelection-header")},react_1.default.createElement("div",{className:"".concat(exports.selectorPrefix,"-list-rowSelection-header-info")},adhere_util_intl_1.default.v("已选择{count}项",{count:null==(e=this.state.selectedRowKeys)?void 0:e.length})),react_1.default.createElement("div",{className:"".concat(exports.selectorPrefix,"-list-rowSelection-header-cancel")},react_1.default.createElement("a",{onClick:function(){t.unSelectedAll()}},adhere_util_intl_1.default.v("取消选择"))))},e}(SearchList_1.default),SearchListImplementFactory=((exports.SearchListImplement=SearchListImplement).defaultProps=__assign({},SearchList_1.defaultProps),SearchListImplement.propTypes=__assign(__assign({},SearchList_1.propTypes),{getListWrapperInstance:prop_types_1.default.func}),function(e){function t(e){return __assign(__assign(__assign({},serviceregister_1.default.mapStateToProps({namespaces:a||[],state:e})),{loading:e.loading}),o?o(e):{})}function n(e){return __assign(__assign({},serviceregister_1.default.mapDispatchToProps({namespaces:a||[],dispatch:e})),i?i(e):{})}var r=e.serviceNames,a=void 0===r?[]:r,o=e.mapStateToProps,i=e.mapDispatchToProps;return function(r){return serviceregister_1.default.connect(a||[])(t,n)((0,react_1.forwardRef)(function(e,t){return react_1.default.createElement(r,__assign({ref:t,className:"".concat(exports.selectorPrefix,"-wrap"),isShowExpandSearch:!0,defaultExpandSearchCollapse:!1},e))}))}});exports.default=SearchListImplementFactory;
//# sourceMappingURL=SearchListImplement.js.map
