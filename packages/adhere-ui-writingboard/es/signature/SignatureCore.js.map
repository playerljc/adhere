{"version":3,"file":"SignatureCore.js","sources":["signature/SignatureCore.js"],"sourcesContent":["import _Button from \"antd/es/button\";\nimport _InputNumber from \"antd/es/input-number\";\nimport _Space from \"antd/es/space\";\nimport _Card from \"antd/es/card\";\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n    return t;\n  };\n  return __assign.apply(this, arguments);\n};\nimport { useUpdateEffect } from 'ahooks';\nimport React, { forwardRef, memo, useImperativeHandle, useMemo, useRef, useState } from 'react';\nimport { CompactPicker } from 'react-color';\nimport FlexLayout from '@baifendian/adhere-ui-flexlayout';\nimport Intl from '@baifendian/adhere-util-intl';\nimport WritingBoard from '../WritingBoard';\nimport { Mode } from '../types';\nvar selectorPrefix = 'adhere-ui-signature-core';\n/**\n * Signature\n * @description 签名\n * @param {SignatureProps} props\n * @param ref\n * @constructor\n */\nvar Signature = /*#__PURE__*/memo( /*#__PURE__*/forwardRef(function (_a, ref) {\n  var wrapProps = _a.wrapProps,\n    toolProps = _a.toolProps,\n    areaProps = _a.areaProps,\n    defaultWidth = _a.defaultWidth,\n    defaultColor = _a.defaultColor;\n  var _b = useState(Mode.FREE),\n    mode = _b[0],\n    setMode = _b[1];\n  var _c = useState(defaultColor !== null && defaultColor !== void 0 ? defaultColor : '#000'),\n    color = _c[0],\n    setColor = _c[1];\n  var _d = useState(defaultWidth !== null && defaultWidth !== void 0 ? defaultWidth : 2),\n    width = _d[0],\n    setWidth = _d[1];\n  var writingBoardRef = useRef();\n  var defaultProps = useMemo(function () {\n    return {\n      gutter: 20,\n      wrapClassName: \"\".concat(selectorPrefix, \"-wrap\")\n    };\n  }, []);\n  var defaultLProps = useMemo(function () {\n    return {\n      fit: true\n    };\n  }, []);\n  var defaultCProps = useMemo(function () {\n    return {\n      autoFixed: true\n    };\n  }, []);\n  var renderTool = useMemo(function () {\n    return /*#__PURE__*/React.createElement(_Card, null, /*#__PURE__*/React.createElement(_Space, {\n      direction: \"vertical\",\n      size: 20\n    }, /*#__PURE__*/React.createElement(_InputNumber, {\n      style: {\n        width: '100%'\n      },\n      value: width,\n      precision: 0,\n      max: 10,\n      min: 1,\n      onChange: function (v) {\n        setWidth(v);\n        if (writingBoardRef.current) {\n          writingBoardRef.current.setLineWidth(v);\n        }\n      }\n    }), /*#__PURE__*/React.createElement(CompactPicker, {\n      color: color,\n      onChangeComplete: function (c) {\n        setColor(c.hex);\n        if (writingBoardRef.current) {\n          writingBoardRef.current.setStrokeStyle(c.hex);\n        }\n      }\n    }), /*#__PURE__*/React.createElement(_Button, {\n      size: \"large\",\n      block: true,\n      type: \"primary\",\n      onClick: function () {\n        if (writingBoardRef.current) {\n          var v = mode === Mode.FREE ? Mode.RUBBER : Mode.FREE;\n          setMode(v);\n          writingBoardRef.current.setMode(v);\n        }\n      }\n    }, mode === Mode.FREE ? Intl.v('橡皮') : Intl.v('绘制')), /*#__PURE__*/React.createElement(_Button, {\n      size: \"large\",\n      block: true,\n      type: \"primary\",\n      onClick: function () {\n        if (writingBoardRef.current) {\n          writingBoardRef.current.clear();\n        }\n      }\n    }, Intl.v('清除'))));\n  }, [mode, width, color, toolProps]);\n  var renderArea = useMemo(function () {\n    return /*#__PURE__*/React.createElement(_Card, null, /*#__PURE__*/React.createElement(WritingBoard\n    // @ts-ignore\n    , {\n      // @ts-ignore\n      ref: writingBoardRef,\n      defaultMode: mode,\n      defaultLineWidth: width,\n      defaultStrokeStyle: color\n    }));\n  }, [areaProps]);\n  useImperativeHandle(ref, function () {\n    return {\n      /**\n       * Save\n       */\n      save: function (backgroundColor, type, quality) {\n        if (!writingBoardRef.current) return;\n        return writingBoardRef.current.toDataURL(backgroundColor !== null && backgroundColor !== void 0 ? backgroundColor : '#fff', type !== null && type !== void 0 ? type : 'image/png', quality !== null && quality !== void 0 ? quality : 1.0);\n      },\n      isEmpty: function () {\n        var _a, _b;\n        if (writingBoardRef === null || writingBoardRef === void 0 ? void 0 : writingBoardRef.current) {\n          return (_b = (_a = writingBoardRef === null || writingBoardRef === void 0 ? void 0 : writingBoardRef.current) === null || _a === void 0 ? void 0 : _a.isEmpty) === null || _b === void 0 ? void 0 : _b.call(_a);\n        }\n        return true;\n      }\n    };\n  });\n  useUpdateEffect(function () {\n    setWidth(defaultWidth);\n  }, [defaultWidth]);\n  useUpdateEffect(function () {\n    setColor(defaultColor);\n  }, [defaultColor]);\n  return /*#__PURE__*/React.createElement(FlexLayout.TRBLC.LCLayout, __assign({}, defaultProps, wrapProps, {\n    lProps: __assign(__assign(__assign({}, defaultLProps), toolProps), {\n      children: renderTool\n    }),\n    cProps: __assign(__assign(__assign({}, defaultCProps), areaProps), {\n      children: renderArea\n    })\n  }));\n}));\nSignature.displayName = 'Signature';\nexport default Signature;"],"names":["_Button","_InputNumber","_Space","_Card","__assign","this","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","useUpdateEffect","React","forwardRef","memo","useImperativeHandle","useMemo","useRef","useState","CompactPicker","FlexLayout","Intl","WritingBoard","Mode","selectorPrefix","Signature","_a","ref","wrapProps","toolProps","areaProps","defaultWidth","defaultColor","_b","FREE","mode","setMode","_c","color","setColor","_d","width","setWidth","writingBoardRef","defaultProps","gutter","wrapClassName","concat","defaultLProps","fit","defaultCProps","autoFixed","renderTool","createElement","direction","size","style","value","precision","max","min","onChange","v","current","setLineWidth","onChangeComplete","c","hex","setStrokeStyle","block","type","onClick","RUBBER","clear","renderArea","defaultMode","defaultLineWidth","defaultStrokeStyle","save","backgroundColor","quality","toDataURL","isEmpty","TRBLC","LCLayout","lProps","children","cProps","displayName"],"mappings":"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"}