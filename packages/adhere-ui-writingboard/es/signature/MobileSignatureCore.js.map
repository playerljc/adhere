{"version":3,"file":"MobileSignatureCore.js","sources":["signature/MobileSignatureCore.js"],"sourcesContent":["import _Button from \"antd-mobile/es/components/button\";\nimport _Grid from \"antd-mobile/es/components/grid\";\nimport _Stepper from \"antd-mobile/es/components/stepper\";\nimport _Space from \"antd/es/space\";\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n    return t;\n  };\n  return __assign.apply(this, arguments);\n};\nimport { useUpdateEffect } from 'ahooks';\nimport React, { forwardRef, memo, useImperativeHandle, useMemo, useRef, useState } from 'react';\nimport { CompactPicker } from 'react-color';\nimport FlexLayout from '@baifendian/adhere-ui-flexlayout';\nimport Intl from '@baifendian/adhere-util-intl';\nimport WritingBoard from '../WritingBoard';\nimport { Mode } from '../types';\nvar selectorPrefix = 'adhere-ui-signature-core';\n/**\n * Signature\n * @description 签名\n * @param {SignatureProps} props\n * @param ref\n * @constructor\n */\nvar Signature = /*#__PURE__*/memo( /*#__PURE__*/forwardRef(function (_a, ref) {\n  var wrapProps = _a.wrapProps,\n    toolProps = _a.toolProps,\n    areaProps = _a.areaProps,\n    defaultWidth = _a.defaultWidth,\n    defaultColor = _a.defaultColor;\n  var _b = useState(Mode.FREE),\n    mode = _b[0],\n    setMode = _b[1];\n  var _c = useState(defaultColor !== null && defaultColor !== void 0 ? defaultColor : '#000'),\n    color = _c[0],\n    setColor = _c[1];\n  var _d = useState(defaultWidth !== null && defaultWidth !== void 0 ? defaultWidth : 2),\n    width = _d[0],\n    setWidth = _d[1];\n  var writingBoardRef = useRef({});\n  var defaultProps = useMemo(function () {\n    return {\n      gutter: 20,\n      wrapClassName: \"\".concat(selectorPrefix, \"-wrap\")\n    };\n  }, []);\n  var defaultBProps = useMemo(function () {\n    return {\n      fit: true\n    };\n  }, []);\n  var defaultCProps = useMemo(function () {\n    return {\n      autoFixed: true\n    };\n  }, []);\n  var renderTool = useMemo(function () {\n    return /*#__PURE__*/React.createElement(\"div\", null, /*#__PURE__*/React.createElement(_Space, {\n      direction: \"vertical\",\n      size: 20\n    }, /*#__PURE__*/React.createElement(_Stepper, {\n      style: {\n        width: '100%'\n      },\n      value: width,\n      max: 10,\n      min: 1,\n      onChange: function (v) {\n        setWidth(v);\n        if (writingBoardRef.current) {\n          writingBoardRef.current.setLineWidth(v);\n        }\n      }\n    }), /*#__PURE__*/React.createElement(CompactPicker, {\n      color: color,\n      onChangeComplete: function (c) {\n        setColor(c.hex);\n        if (writingBoardRef.current) {\n          writingBoardRef.current.setStrokeStyle(c.hex);\n        }\n      }\n    })), /*#__PURE__*/React.createElement(_Grid, {\n      columns: 2,\n      gap: 8\n    }, /*#__PURE__*/React.createElement(_Grid.Item, null, /*#__PURE__*/React.createElement(_Button, {\n      size: \"middle\",\n      block: true,\n      color: \"primary\",\n      onClick: function () {\n        if (writingBoardRef.current) {\n          var v = mode === Mode.FREE ? Mode.RUBBER : Mode.FREE;\n          setMode(v);\n          writingBoardRef.current.setMode(v);\n        }\n      }\n    }, mode === Mode.FREE ? Intl.v('橡皮') : Intl.v('绘制'))), /*#__PURE__*/React.createElement(_Grid.Item, null, /*#__PURE__*/React.createElement(_Button, {\n      size: \"middle\",\n      block: true,\n      color: \"primary\",\n      onClick: function () {\n        if (writingBoardRef.current) {\n          writingBoardRef.current.clear();\n        }\n      }\n    }, Intl.v('清除')))));\n  }, [mode, width, color, toolProps]);\n  var renderArea = useMemo(function () {\n    return /*#__PURE__*/React.createElement(WritingBoard, {\n      ref: writingBoardRef,\n      defaultMode: mode,\n      defaultLineWidth: width,\n      defaultStrokeStyle: color\n    });\n  }, [areaProps]);\n  useImperativeHandle(ref, function () {\n    return {\n      /**\n       * Save\n       */\n      save: function (backgroundColor, type, quality) {\n        if (!writingBoardRef.current) return;\n        return writingBoardRef.current.toDataURL(backgroundColor !== null && backgroundColor !== void 0 ? backgroundColor : '#fff', type !== null && type !== void 0 ? type : 'image/png', quality !== null && quality !== void 0 ? quality : 1.0);\n      },\n      isEmpty: function () {\n        var _a, _b;\n        if (writingBoardRef === null || writingBoardRef === void 0 ? void 0 : writingBoardRef.current) {\n          return (_b = (_a = writingBoardRef === null || writingBoardRef === void 0 ? void 0 : writingBoardRef.current) === null || _a === void 0 ? void 0 : _a.isEmpty) === null || _b === void 0 ? void 0 : _b.call(_a);\n        }\n        return true;\n      }\n    };\n  });\n  useUpdateEffect(function () {\n    setWidth(defaultWidth);\n  }, [defaultWidth]);\n  useUpdateEffect(function () {\n    setColor(defaultColor);\n  }, [defaultColor]);\n  return /*#__PURE__*/React.createElement(FlexLayout.TRBLC.CBLayout, __assign({}, defaultProps, wrapProps, {\n    bProps: __assign(__assign(__assign({}, defaultBProps), toolProps), {\n      children: renderTool\n    }),\n    cProps: __assign(__assign(__assign({}, defaultCProps), areaProps), {\n      children: renderArea\n    })\n  }));\n}));\nSignature.displayName = 'Signature';\nexport default Signature;"],"names":["_Button","_Grid","_Stepper","_Space","__assign","this","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","useUpdateEffect","React","forwardRef","memo","useImperativeHandle","useMemo","useRef","useState","CompactPicker","FlexLayout","Intl","WritingBoard","Mode","selectorPrefix","Signature","_a","ref","wrapProps","toolProps","areaProps","defaultWidth","defaultColor","_b","FREE","mode","setMode","_c","color","setColor","_d","width","setWidth","writingBoardRef","defaultProps","gutter","wrapClassName","concat","defaultBProps","fit","defaultCProps","autoFixed","renderTool","createElement","direction","size","style","value","max","min","onChange","v","current","setLineWidth","onChangeComplete","c","hex","setStrokeStyle","columns","gap","Item","block","onClick","RUBBER","clear","renderArea","defaultMode","defaultLineWidth","defaultStrokeStyle","save","backgroundColor","type","quality","toDataURL","isEmpty","TRBLC","CBLayout","bProps","children","cProps","displayName"],"mappings":"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"}