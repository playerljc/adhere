"use strict";var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var l in n=arguments[e])Object.prototype.hasOwnProperty.call(n,l)&&(t[l]=n[l]);return t}).apply(this,arguments)},__createBinding=this&&this.__createBinding||(Object.create?function(t,n,e,r){void 0===r&&(r=e),Object.defineProperty(t,r,{enumerable:!0,get:function(){return n[e]}})}:function(t,n,e,r){t[r=void 0===r?e:r]=n[e]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(t,n){Object.defineProperty(t,"default",{enumerable:!0,value:n})}:function(t,n){t.default=n}),__importStar=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var n={};if(null!=t)for(var e in t)"default"!==e&&Object.hasOwnProperty.call(t,e)&&__createBinding(n,t,e);return __setModuleDefault(n,t),n},__importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0});var react_1=__importStar(require("react")),prop_types_1=__importDefault(require("prop-types")),classnames_1=__importDefault(require("classnames")),types_1=require("./types"),selectorPrefix="adhere-ui-writingboard";function WritingBoard(t,n){var r=react_1.useRef(null),u=react_1.useRef(null),i=react_1.useRef(null),o=react_1.useRef(null),e=react_1.useRef(null),l=react_1.useRef(t.defaultMode),d=react_1.useRef(t.defaultLineWidth),c=react_1.useRef(t.defaultStrokeStyle),v=react_1.useRef([]),a=react_1.useRef(0),s=react_1.useRef(new Map([[types_1.Mode.FREE,{draw:function(t){var n=t.sourcePoint,e=t.targetPoint;null!==(t=null==i?void 0:i.current)&&void 0!==t&&t.beginPath(),null!==(t=null==i?void 0:i.current)&&void 0!==t&&t.moveTo(n.x,n.y),null!==(t=null==i?void 0:i.current)&&void 0!==t&&t.lineTo(e.x,e.y),v.current.push({shape:l.current,sourcePoint:n,targetPoint:e}),f({lineWidth:null==d?void 0:d.current,strokeStyle:null==c?void 0:c.current}),null!==(e=null==i?void 0:i.current)&&void 0!==e&&e.stroke()},drawStack:function(t){var n;null!==(n=null==i?void 0:i.current)&&void 0!==n&&n.beginPath(),null!==(n=null==i?void 0:i.current)&&void 0!==n&&n.moveTo(t.sourcePoint.x,t.sourcePoint.y),null!==(n=null==i?void 0:i.current)&&void 0!==n&&n.lineTo(t.targetPoint.x,t.targetPoint.y),f({lineWidth:t.lineWidth,strokeStyle:t.strokeStyle}),null!==(t=null==i?void 0:i.current)&&void 0!==t&&t.stroke()},mouseup:function(t){P({sourcePoint:e.current,targetPoint:t})}}],[types_1.Mode.LINE,{draw:function(t){var n,e,r=t.targetPoint;null!==(t=null==i?void 0:i.current)&&void 0!==t&&t.clearRect(0,0,null===(n=null==u?void 0:u.current)||void 0===n?void 0:n.width,null===(n=null==u?void 0:u.current)||void 0===n?void 0:n.height),g(),null!==(n=null==i?void 0:i.current)&&void 0!==n&&n.beginPath(),null!==(n=null==i?void 0:i.current)&&void 0!==n&&n.moveTo(null===(e=null==o?void 0:o.current)||void 0===e?void 0:e.x,null===(e=null==o?void 0:o.current)||void 0===e?void 0:e.y),null!==(e=null==i?void 0:i.current)&&void 0!==e&&e.lineTo(r.x,r.y),f({lineWidth:null==d?void 0:d.current,strokeStyle:null==c?void 0:c.current}),null!==(r=null==i?void 0:i.current)&&void 0!==r&&r.stroke()},drawStack:function(t){var n;null!==(n=null==i?void 0:i.current)&&void 0!==n&&n.beginPath(),null!==(n=null==i?void 0:i.current)&&void 0!==n&&n.moveTo(t.sourcePoint.x,t.sourcePoint.y),null!==(n=null==i?void 0:i.current)&&void 0!==n&&n.lineTo(t.targetPoint.x,t.targetPoint.y),f({lineWidth:t.lineWidth,strokeStyle:t.strokeStyle}),null!==(t=null==i?void 0:i.current)&&void 0!==t&&t.stroke()},mouseup:function(t){var n;v.current.push({shape:l.current,lineWidth:null===(n=null==i?void 0:i.current)||void 0===n?void 0:n.lineWidth,strokeStyle:null===(n=null==i?void 0:i.current)||void 0===n?void 0:n.strokeStyle,sourcePoint:o.current,targetPoint:t})}}],[types_1.Mode.RECTANGLE,{draw:function(t){var n,e,r=t.targetPoint;null!==(t=null==i?void 0:i.current)&&void 0!==t&&t.clearRect(0,0,null===(n=null==u?void 0:u.current)||void 0===n?void 0:n.width,null===(l=null==u?void 0:u.current)||void 0===l?void 0:l.height),g(),null!==(n=null==i?void 0:i.current)&&void 0!==n&&n.beginPath();var l=_({startPoint:o.current,targetPoint:r});null!==(n=null==i?void 0:i.current)&&void 0!==n&&n.rect(l.x,l.y,Math.abs(r.x-(null===(e=null==o?void 0:o.current)||void 0===e?void 0:e.x)),Math.abs(r.y-(null===(e=null==o?void 0:o.current)||void 0===e?void 0:e.y))),f({lineWidth:null==d?void 0:d.current,strokeStyle:null==c?void 0:c.current}),null!==(e=null==i?void 0:i.current)&&void 0!==e&&e.stroke()},drawStack:function(t){var n;null!==(n=null==i?void 0:i.current)&&void 0!==n&&n.beginPath(),null!==(n=null==i?void 0:i.current)&&void 0!==n&&n.rect(t.x,t.y,t.width,t.height),f({lineWidth:t.lineWidth,strokeStyle:t.strokeStyle}),null!==(t=null==i?void 0:i.current)&&void 0!==t&&t.stroke()},mouseup:function(t){var n,e=_({startPoint:o.current,targetPoint:t});v.current.push({shape:l.current,lineWidth:null===(n=null==i?void 0:i.current)||void 0===n?void 0:n.lineWidth,strokeStyle:null===(n=null==i?void 0:i.current)||void 0===n?void 0:n.strokeStyle,x:e.x,y:e.y,width:Math.abs(t.x-(null===(e=null==o?void 0:o.current)||void 0===e?void 0:e.x)),height:Math.abs(t.y-(null===(t=null==o?void 0:o.current)||void 0===t?void 0:t.y))})}}],[types_1.Mode.CIRCLE,{draw:function(t){var n=t.targetPoint;null!==(t=null==i?void 0:i.current)&&void 0!==t&&t.clearRect(0,0,null===(r=null==u?void 0:u.current)||void 0===r?void 0:r.width,null===(e=null==u?void 0:u.current)||void 0===e?void 0:e.height),g(),null!==(r=null==i?void 0:i.current)&&void 0!==r&&r.beginPath();var e=_({startPoint:o.current,targetPoint:n}),r=p({p2:n,p1:o.current});null!==(n=null==i?void 0:i.current)&&void 0!==n&&n.ellipse(e.x,e.y,r,r,45*Math.PI/180,0,2*Math.PI),f({lineWidth:null==d?void 0:d.current,strokeStyle:null==c?void 0:c.current}),null!==(r=null==i?void 0:i.current)&&void 0!==r&&r.stroke()},drawStack:function(t){var n;null!==(n=null==i?void 0:i.current)&&void 0!==n&&n.beginPath(),null!==(n=null==i?void 0:i.current)&&void 0!==n&&n.ellipse(t.x,t.y,t.radiusX,t.radiusY,t.rotation,t.startAngle,t.endAngle),f({lineWidth:t.lineWidth,strokeStyle:t.strokeStyle}),null!==(t=null==i?void 0:i.current)&&void 0!==t&&t.stroke()},mouseup:function(t){var n=_({startPoint:o.current,targetPoint:t}),e=p({p2:t,p1:null==o?void 0:o.current});v.current.push({shape:l.current,lineWidth:null===(t=null==i?void 0:i.current)||void 0===t?void 0:t.lineWidth,strokeStyle:null===(t=null==i?void 0:i.current)||void 0===t?void 0:t.strokeStyle,x:n.x,y:n.y,radiusX:e,radiusY:e,rotation:45*Math.PI/180,startAngle:0,endAngle:2*Math.PI})}}],[types_1.Mode.TRIANGLE,{draw:function(t){var n=t.targetPoint;null!==(t=null==i?void 0:i.current)&&void 0!==t&&t.clearRect(0,0,null===(e=null==u?void 0:u.current)||void 0===e?void 0:e.width,null===(e=null==u?void 0:u.current)||void 0===e?void 0:e.height),g(),null!==(e=null==i?void 0:i.current)&&void 0!==e&&e.beginPath();var e=h({startPoint:o.current,targetPoint:n});null!==(n=null==i?void 0:i.current)&&void 0!==n&&n.moveTo(e[0].x,e[0].y),null!==(n=null==i?void 0:i.current)&&void 0!==n&&n.lineTo(e[1].x,e[1].y),null!==(n=null==i?void 0:i.current)&&void 0!==n&&n.lineTo(e[2].x,e[2].y),null!==(e=null==i?void 0:i.current)&&void 0!==e&&e.closePath(),f({lineWidth:null==d?void 0:d.current,strokeStyle:null==c?void 0:c.current}),null!==(e=null==i?void 0:i.current)&&void 0!==e&&e.stroke()},drawStack:function(t){var n;null!==(n=null==i?void 0:i.current)&&void 0!==n&&n.beginPath(),null!==(n=null==i?void 0:i.current)&&void 0!==n&&n.moveTo(t.points[0].x,t.points[0].y),null!==(n=null==i?void 0:i.current)&&void 0!==n&&n.lineTo(t.points[1].x,t.points[1].y),null!==(n=null==i?void 0:i.current)&&void 0!==n&&n.lineTo(t.points[2].x,t.points[2].y),null!==(n=null==i?void 0:i.current)&&void 0!==n&&n.closePath(),f({lineWidth:t.lineWidth,strokeStyle:t.strokeStyle}),null!==(t=null==i?void 0:i.current)&&void 0!==t&&t.stroke()},mouseup:function(t){var n=h({startPoint:o.current,targetPoint:t});v.current.push({shape:l.current,lineWidth:null===(t=null==i?void 0:i.current)||void 0===t?void 0:t.lineWidth,strokeStyle:null===(t=null==i?void 0:i.current)||void 0===t?void 0:t.strokeStyle,points:n})}}],[types_1.Mode.RUBBER,{draw:function(t){var n=t.sourcePoint,e=t.targetPoint;null!==(t=null==i?void 0:i.current)&&void 0!==t&&t.beginPath(),null!==(t=null==i?void 0:i.current)&&void 0!==t&&t.moveTo(n.x,n.y),null!==(t=null==i?void 0:i.current)&&void 0!==t&&t.lineTo(e.x,e.y),v.current.push({shape:l.current,sourcePoint:n,targetPoint:e}),i.current.lineWidth=15,i.current.strokeStyle="#fff",i.current.lineCap="round",i.current.lineJoin="round",null!==(e=null==i?void 0:i.current)&&void 0!==e&&e.stroke()},drawStack:function(t){var n;null!==(n=null==i?void 0:i.current)&&void 0!==n&&n.beginPath(),null!==(n=null==i?void 0:i.current)&&void 0!==n&&n.moveTo(t.sourcePoint.x,t.sourcePoint.y),null!==(n=null==i?void 0:i.current)&&void 0!==n&&n.lineTo(t.targetPoint.x,t.targetPoint.y),i.current.lineWidth=15,i.current.strokeStyle="#fff",i.current.lineCap="round",i.current.lineJoin="round",null!==(t=null==i?void 0:i.current)&&void 0!==t&&t.stroke()},mouseup:function(t){P({sourcePoint:e.current,targetPoint:t})}}]]));function f(t){var n=t.lineWidth,t=t.strokeStyle;i.current.lineWidth=n,i.current.strokeStyle=t,i.current.lineCap="round",i.current.lineJoin="round"}function h(t){var n=t.startPoint,e=t.targetPoint,r=_({startPoint:n,targetPoint:e}),t=Math.abs(e.x-n.x),n=Math.abs(e.y-n.y);return[{x:r.x,y:r.y+n},{x:r.x+t/2,y:r.y},{x:r.x+t,y:r.y+n}]}function y(t){var n=t.clientX,e=t.clientY,t=null===(t=null==u?void 0:u.current)||void 0===t?void 0:t.getBoundingClientRect();return{x:n-t.x,y:e-t.y}}function p(t){var n=t.p1,e=t.p2,r=n.x,t=n.y,n=e.x,e=e.y;return Math.sqrt(Math.pow(n-r,2)+Math.pow(e-t,2))}function g(){for(var t=0;t<v.current.length;t++){var n=v.current[t];s.current.get(n.shape).drawStack(n)}}function _(t){var n=t.startPoint,t=t.targetPoint;return t.x<=n.x&&t.y<=n.y?t:t.x<=n.x&&t.y>=n.y?{x:t.x,y:n.y}:t.x>=n.x&&t.y<=n.y?{x:n.x,y:t.y}:t.x>=n.x&&t.y>=n.y?n:void 0}function P(t){var n=t.sourcePoint,e=t.targetPoint;(null===(t=null==s?void 0:s.current)||void 0===t?void 0:t.get(l.current)).draw({sourcePoint:n,targetPoint:e})}function x(t){w(t)}function m(t){w(__assign(__assign({},t),{clientX:t.targetTouches[0].clientX,clientY:t.targetTouches[0].clientY}))}function k(t){b(t)}function S(t){b(__assign(__assign({},t),{clientX:t.changedTouches[0].clientX,clientY:t.changedTouches[0].clientY}))}function W(t){var n=t.clientX,t=t.clientY;o.current=e.current=y({clientX:n,clientY:t}),null!==(t=null==r?void 0:r.current)&&void 0!==t&&t.addEventListener("mousemove",x),null!==(t=null==r?void 0:r.current)&&void 0!==t&&t.addEventListener("mouseup",k),null!==(t=null==r?void 0:r.current)&&void 0!==t&&t.addEventListener("touchmove",m),null!==(t=null==r?void 0:r.current)&&void 0!==t&&t.addEventListener("touchend",S)}function w(t){t=y({clientX:t.clientX,clientY:t.clientY});P({sourcePoint:e.current,targetPoint:t}),e.current=t}function b(t){var n=y({clientX:t.clientX,clientY:t.clientY});null!==(t=null==s?void 0:s.current.get(l.current))&&void 0!==t&&t.mouseup(n),o.current=null,(e.current=null)!==(n=null==r?void 0:r.current)&&void 0!==n&&n.removeEventListener("mousemove",x),null!==(n=null==r?void 0:r.current)&&void 0!==n&&n.removeEventListener("mouseup",k),null!==(n=null==r?void 0:r.current)&&void 0!==n&&n.removeEventListener("touchmove",m),null!==(n=null==r?void 0:r.current)&&void 0!==n&&n.removeEventListener("touchend",S)}return react_1.useImperativeHandle(n,function(){return{setMode:function(t){l.current=t},setStrokeStyle:function(t){c.current=t},setLineWidth:function(t){d.current=t},clear:function(){var t;null!==(t=null==i?void 0:i.current)&&void 0!==t&&t.clearRect(0,0,null===(t=null==u?void 0:u.current)||void 0===t?void 0:t.width,null===(t=null==u?void 0:u.current)||void 0===t?void 0:t.height),e.current=o.current=null,v.current=[],a.current=0},toDataURL:function(){var t;return null===(t=null==u?void 0:u.current)||void 0===t?void 0:t.toDataURL("image/png",1)}}}),react_1.useEffect(function(){},[null==d?void 0:d.current,null==c?void 0:c.current]),react_1.useLayoutEffect(function(){var t;i.current=null===(t=null==u?void 0:u.current)||void 0===t?void 0:t.getContext("2d"),u.current.width=null===(t=null==r?void 0:r.current)||void 0===t?void 0:t.offsetWidth,u.current.height=null===(t=null==r?void 0:r.current)||void 0===t?void 0:t.offsetHeight,i.current.fillStyle="#fff",i.current.fillRect(0,0,null===(t=null==u?void 0:u.current)||void 0===t?void 0:t.width,null===(t=null==u?void 0:u.current)||void 0===t?void 0:t.height)},[]),react_1.useLayoutEffect(function(){var t;function n(t){W(t)}function e(t){W(__assign(__assign({},t),{clientX:t.targetTouches[0].clientX,clientY:t.targetTouches[0].clientY}))}return null!==(t=null==r?void 0:r.current)&&void 0!==t&&t.addEventListener("mousedown",n),null!==(t=null==r?void 0:r.current)&&void 0!==t&&t.addEventListener("touchstart",e),function(){var t;null!==(t=null==r?void 0:r.current)&&void 0!==t&&t.removeEventListener("mousedown",n),null!==(t=null==r?void 0:r.current)&&void 0!==t&&t.removeEventListener("touchstart",e)}},[]),react_1.default.createElement("div",{ref:r,className:classnames_1.default(selectorPrefix,t.className||""),style:t.style||{}},react_1.default.createElement("canvas",{ref:u}))}var Wrap=react_1.forwardRef(WritingBoard);Wrap.defaultProps={className:"",style:{},defaultMode:types_1.Mode.FREE,defaultStrokeStyle:"#000",defaultLineWidth:2},Wrap.propTypes={className:prop_types_1.default.string,style:prop_types_1.default.object,defaultMode:prop_types_1.default.string,defaultStrokeStyle:prop_types_1.default.string,defaultLineWidth:prop_types_1.default.number},exports.default=Wrap;
//# sourceMappingURL=writingboard.js.map
