"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){e[n=void 0===n?r:n]=t[r]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.hasOwnProperty.call(e,r)&&__createBinding(t,e,r);return __setModuleDefault(t,e),t},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var react_1=__importStar(require("react")),classnames_1=__importDefault(require("classnames")),moment_1=__importDefault(require("moment")),adhere_util_intl_1=__importDefault(require("@baifendian/adhere-util-intl")),adhere_ui_conditionalrender_1=__importDefault(require("@baifendian/adhere-ui-conditionalrender")),adhere_util_1=__importDefault(require("@baifendian/adhere-util")),adhere_util_resource_1=__importDefault(require("@baifendian/adhere-util-resource")),adhere_ui_hooks_1=__importDefault(require("@baifendian/adhere-ui-hooks")),selectorPrefix="adhere-ui-pullrefresh",defaultImg="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+DQo8c3ZnIHN0eWxlPSJ3aWR0aDozMDhweDtoZWlnaHQ6MzA4cHg7IiB2ZXJzaW9uPSIxLjEiIGlkPSLlm77lvaIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IiB3aWR0aD0iMTAyNHB4IiBoZWlnaHQ9IjEwMjRweCIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMTAyNCAxMDI0IiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCiAgPHBhdGggY2xhc3M9InN2Z3BhdGgiIGRhdGEtaW5kZXg9InBhdGhfMCIgZmlsbD0iI2VjZjBmMSIgZD0iTTc5Ny43NjQ0MiAzMjYuNTU4NDFjLTguODg0MTk5LTE1LjU2MzMyNy0yNTIuODgwMS0yODYuODE5MDE5LTI2OC4zNzk1MTItMzEzLjU2NzQ4OS0xMC4xMzA1NDQtMTcuNDQ4ODIzLTM0LjI1ODQ5NS0xNy4xOTMxNjItNDQuMzg5MDM4IDBDNDczLjY1MDkzOSAzMi4yNjEzMjQgMjMwLjk5NzI1NSAzMDQuNjM1NTMgMjE4LjM3NDAyMyAzMjcuNDIxMjY0Yy05LjIzNTczMiAxNi41NTQwMTEgMC45NTg3MjcgMzguMzgxMDE5IDIxLjk1NDgzNyAzOC4zODEwMTlsMTE5LjkwNDczMSAwIDAgMjU2LjQ5MTMwMyAwIDM2Ljc4MzE0MSAyOTEuODM2MzU0IDAgMC0yOTMuMzA2NDAyIDEyMy41Nzk4NDkgMEM3OTQuNjk2NDk1IDM2NS43NzAzMjUgODA4Ljk0OTU2MiAzNDYuMTE2NDMxIDc5Ny43NjQ0MiAzMjYuNTU4NDF6IiAvPg0KPHBhdGggY2xhc3M9InN2Z3BhdGgiIGRhdGEtaW5kZXg9InBhdGhfMSIgZmlsbD0iI2VjZjBmMSIgZD0iTTM2MC4yMDE2MzMgNjg5LjY5MjA2MWwyOTIuMzE1NzE4IDAgMCA5MC45MTkyMzItMjkyLjMxNTcxOCAwIDAtOTAuOTE5MjMyWiIgLz4NCjxwYXRoIGNsYXNzPSJzdmdwYXRoIiBkYXRhLWluZGV4PSJwYXRoXzIiIGZpbGw9IiNlY2YwZjEiIGQ9Ik0zNjAuMjAxNjMzIDg0MC45MTUxOTFsMjkyLjMxNTcxOCAwIDAgNjAuNTkxNTE2LTI5Mi4zMTU3MTggMCAwLTYwLjU5MTUxNloiIC8+DQo8cGF0aCBjbGFzcz0ic3ZncGF0aCIgZGF0YS1pbmRleD0icGF0aF8zIiBmaWxsPSIjZWNmMGYxIiBkPSJNMzYwLjIwMTYzMyA5OTIuMzkzOTgybDI5MC40MzAyMjIgMCAwIDMwLjI5NTc1OC0yOTAuNDMwMjIyIDAgMC0zMC4yOTU3NThaIiAvPg0KDQo8L3N2Zz4NCg==",useSetState=adhere_ui_hooks_1.default.useSetState,PullRefresh=function(r,e){var t=r.className,n=void 0===t?"":t,u=r.style,a=void 0===u?{}:u,l=r.scrollClassName,c=void 0===l?"":l,i=r.scrollStyle,o=void 0===i?{}:i,d=r.renderIcon,t=r.renderLabel,s=void 0===t?function(){return adhere_util_intl_1.default.v("下拉刷新")}:t,u=r.renderCanLabel,f=void 0===u?function(){return adhere_util_intl_1.default.v("松开刷新")}:u,l=r.renderLoadingAnimation,m=void 0===l?"la-ball-circus la-dark":l,i=r.isShowUpdateTime,t=void 0===i||i,u=r.updateTimeFormat,_=void 0===u?adhere_util_resource_1.default.Dict.value.ResourceMomentFormat18.value():u,l=r.children,i=useSetState(!1),u=i[0],M=i[1],i=useSetState(moment_1.default().valueOf()),v=i[0],g=i[1],h=react_1.useRef(null),I=react_1.useRef(null),N=react_1.useRef(null),y=react_1.useRef(null),D=react_1.useRef(null),E=react_1.useRef(null),T=react_1.useRef(null),j=react_1.useRef(null),L=react_1.useRef(null),z=react_1.useRef(null),p=react_1.useRef(!0),x=react_1.useRef(200),A=react_1.useRef(-1),w=react_1.useRef(!1),b=react_1.useRef(0);function O(e,t){r[e]&&r[e](t)}function P(e,t,r){e.style.transition=e.style.webkitTransition="transform "+(r=void 0===r?0:r)+"ms ease",e.style.transform=e.style.webkitTransform="translate3d(0,"+t+",0)"}function R(){S(),w.current=!1,p.current=!0,E.current.style.display="flex",y.current.style.display="none",L.current.style.display="flex",Z(j.current,180,0),T.current.style.overflowY="auto",z.current.style.display="none"}function S(){var e;null!==(e=T.current)&&void 0!==e&&e.removeEventListener("mousemove",Q),null!==(e=T.current)&&void 0!==e&&e.removeEventListener("mouseup",U),null!==(e=T.current)&&void 0!==e&&e.removeEventListener("touchmove",Q),null!==(e=T.current)&&void 0!==e&&e.removeEventListener("touchend",U)}function C(){var e;z.current.style.display="block",S(),null!==(e=T.current)&&void 0!==e&&e.addEventListener("transitionend",function e(){var t;L.current.style.display="none",y.current.style.display="block",O("onPullRefresh"),null!==(t=T.current)&&void 0!==t&&t.removeEventListener("transitionend",e),g(moment_1.default().valueOf())}),P(T.current,b.current+"px",500),P(E.current,"calc(-100% + "+b.current+"px)",500),Z(j.current,180,300)}function k(){var e;R(),null!==(e=T.current)&&void 0!==e&&e.addEventListener("transitionend",function e(){var t;null!==(t=T.current)&&void 0!==t&&t.removeEventListener("transitionend",e),L.current.style.display="flex"}),P(T.current,"0px",200),P(E.current,"calc(-100% + 0px)",200)}function B(t){return new Promise(function(e){return g(t||moment_1.default().valueOf(),function(){return e()})})}function Y(){return v}function Z(e,t,r){e.style.transition=e.style.webkitTransition="transform "+(r=void 0===r?0:r)+"ms linear",e.style.transform=e.style.webkitTransform="rotate("+t+"deg)"}function G(e){O("onPullStart"),A.current=(e.changedTouches?e.changedTouches[0]:e).pageY,null!==(e=T.current)&&void 0!==e&&e.addEventListener("touchmove",Q),null!==(e=T.current)&&void 0!==e&&e.addEventListener("mousemove",Q),null!==(e=T.current)&&void 0!==e&&e.addEventListener("touchend",U),null!==(e=T.current)&&void 0!==e&&e.addEventListener("mouseup",U)}function Q(e){T.current.style.overflow="hidden";var t=(e.changedTouches?e.changedTouches[0]:e).pageY-A.current,r=Math.abs(t);0<t?(e.preventDefault(),w.current=!0,r<x.current?(P(T.current,r+"px",0),P(E.current,"calc(-100% + "+r+"px)",0),r>=b.current+80?(Z(j.current,0,150),M(!0,function(){return O("onPullCanRefresh")})):(Z(j.current,180,150),M(!1)),E.current.style.display="flex"):(P(T.current,x.current+"px",0),P(E.current,"calc(-100% + "+x.current+"px)",0),Z(j.current,0,150),M(!0,function(){return O("onPullBottom")}))):w.current?(e.preventDefault(),P(T.current,"0px",0),P(E.current,"calc(-100% + 0px)",0),Z(j.current,180,0)):R()}function U(e){var t=(e.changedTouches?e.changedTouches[0]:e).pageY-A.current,e=Math.abs(t);0<t?!(e<x.current)||e>=b.current+80?C():(O("onPullRebound"),k()):R()}function W(e){var t;0===e.target.scrollTop?(p.current=!0,null!==(t=T.current)&&void 0!==t&&t.addEventListener("touchstart",G),null!==(t=T.current)&&void 0!==t&&t.addEventListener("mousedown",G)):p.current&&(p.current=!1,null!==(t=T.current)&&void 0!==t&&t.removeEventListener("touchstart",G),null!==(t=T.current)&&void 0!==t&&t.removeEventListener("mousedown",G))}return react_1.useImperativeHandle(e,function(){return{refresh:C,reset:k,resetUpdateTime:B,getUpdateTime:Y}}),react_1.useEffect(function(){g(r.updateTime||moment_1.default().valueOf())},[r.updateTime]),react_1.useEffect(function(){z.current=document.querySelector("."+selectorPrefix+"-mask"),z.current||(z.current=document.createElement("div"),z.current.className=selectorPrefix+"-mask",document.body.appendChild(z.current))},[]),react_1.useLayoutEffect(function(){var e;E.current=h.current,j.current=N.current,T.current=I.current,L.current=D.current,x.current=((e=void 0===(e=r.pullHeight)?200:e)||200)<=0?200:(e||200)>T.current.clientHeight?T.current.clientHeight:e||200,b.current=E.current.clientHeight},[]),react_1.useLayoutEffect(function(){var e;return null!==(e=T.current)&&void 0!==e&&e.addEventListener("touchstart",G),null!==(e=T.current)&&void 0!==e&&e.addEventListener("mousedown",G),null!==(e=T.current)&&void 0!==e&&e.addEventListener("scroll",W),S}),react_1.default.createElement("div",{className:classnames_1.default(selectorPrefix,n||""),style:a||{}},react_1.default.createElement("div",{className:classnames_1.default(selectorPrefix+"-scroll",c||""),style:o||{},ref:I},l),react_1.default.createElement("div",{className:selectorPrefix+"-trigger",ref:h},react_1.default.createElement("div",{className:selectorPrefix+"-trigger-inner",ref:D},react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:!!d,noMatch:function(){return react_1.default.createElement("div",{className:selectorPrefix+"-trigger-icon"},react_1.default.createElement("img",{className:selectorPrefix+"-trigger-icon-inner",src:defaultImg,alt:"",ref:N}))}},function(){return react_1.default.createElement("div",{className:selectorPrefix+"-trigger-icon"},react_1.default.createElement("div",{className:selectorPrefix+"-trigger-icon-inner",ref:N},null==d?void 0:d()))}),react_1.default.createElement("p",{className:selectorPrefix+"-trigger-label"},react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:u,noMatch:function(){return null==s?void 0:s()}},function(){return null==f?void 0:f()})),react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:t},function(){return react_1.default.createElement("p",{className:selectorPrefix+"-trigger-update"},adhere_util_intl_1.default.v("更新时间"),"：",react_1.default.createElement("span",{className:selectorPrefix+"-trigger-update-label"},moment_1.default(v).format(_)))})),react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:!!m},function(){return react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:adhere_util_1.default.isString(m),noMatch:function(){return react_1.default.createElement("div",{className:selectorPrefix+"-trigger-refresh",ref:y},m())}},function(){return react_1.default.createElement("div",{className:classnames_1.default(selectorPrefix+"-trigger-refresh",m),ref:y},react_1.default.createElement("div",null),react_1.default.createElement("div",null),react_1.default.createElement("div",null),react_1.default.createElement("div",null),react_1.default.createElement("div",null))})})))};exports.default=react_1.forwardRef(PullRefresh);
//# sourceMappingURL=pullrefresh.js.map
