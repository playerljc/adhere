"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var u=Object.getOwnPropertyDescriptor(t,r);u&&("get"in u?t.__esModule:!u.writable&&!u.configurable)||(u={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,u)}:function(e,t,r,n){e[n=void 0===n?r:n]=t[r]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding(t,e,r);return __setModuleDefault(t,e),t},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},ahooks_1=(Object.defineProperty(exports,"__esModule",{value:!0}),require("ahooks")),classnames_1=__importDefault(require("classnames")),dayjs_1=__importDefault(require("dayjs")),lodash_debounce_1=__importDefault(require("lodash.debounce")),react_1=__importStar(require("react")),adhere_ui_conditionalrender_1=__importDefault(require("@baifendian/adhere-ui-conditionalrender")),adhere_ui_hooks_1=__importDefault(require("@baifendian/adhere-ui-hooks")),adhere_util_1=__importDefault(require("@baifendian/adhere-util")),adhere_util_intl_1=__importDefault(require("@baifendian/adhere-util-intl")),adhere_util_resource_1=__importDefault(require("@baifendian/adhere-util-resource")),resize_observer_1=require("@juggle/resize-observer"),selectorPrefix="adhere-ui-pull-refresh",defaultImg="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+DQo8c3ZnIHN0eWxlPSJ3aWR0aDozMDhweDtoZWlnaHQ6MzA4cHg7IiB2ZXJzaW9uPSIxLjEiIGlkPSLlm77lvaIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IiB3aWR0aD0iMTAyNHB4IiBoZWlnaHQ9IjEwMjRweCIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMTAyNCAxMDI0IiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCiAgPHBhdGggY2xhc3M9InN2Z3BhdGgiIGRhdGEtaW5kZXg9InBhdGhfMCIgZmlsbD0iI2VjZjBmMSIgZD0iTTc5Ny43NjQ0MiAzMjYuNTU4NDFjLTguODg0MTk5LTE1LjU2MzMyNy0yNTIuODgwMS0yODYuODE5MDE5LTI2OC4zNzk1MTItMzEzLjU2NzQ4OS0xMC4xMzA1NDQtMTcuNDQ4ODIzLTM0LjI1ODQ5NS0xNy4xOTMxNjItNDQuMzg5MDM4IDBDNDczLjY1MDkzOSAzMi4yNjEzMjQgMjMwLjk5NzI1NSAzMDQuNjM1NTMgMjE4LjM3NDAyMyAzMjcuNDIxMjY0Yy05LjIzNTczMiAxNi41NTQwMTEgMC45NTg3MjcgMzguMzgxMDE5IDIxLjk1NDgzNyAzOC4zODEwMTlsMTE5LjkwNDczMSAwIDAgMjU2LjQ5MTMwMyAwIDM2Ljc4MzE0MSAyOTEuODM2MzU0IDAgMC0yOTMuMzA2NDAyIDEyMy41Nzk4NDkgMEM3OTQuNjk2NDk1IDM2NS43NzAzMjUgODA4Ljk0OTU2MiAzNDYuMTE2NDMxIDc5Ny43NjQ0MiAzMjYuNTU4NDF6IiAvPg0KPHBhdGggY2xhc3M9InN2Z3BhdGgiIGRhdGEtaW5kZXg9InBhdGhfMSIgZmlsbD0iI2VjZjBmMSIgZD0iTTM2MC4yMDE2MzMgNjg5LjY5MjA2MWwyOTIuMzE1NzE4IDAgMCA5MC45MTkyMzItMjkyLjMxNTcxOCAwIDAtOTAuOTE5MjMyWiIgLz4NCjxwYXRoIGNsYXNzPSJzdmdwYXRoIiBkYXRhLWluZGV4PSJwYXRoXzIiIGZpbGw9IiNlY2YwZjEiIGQ9Ik0zNjAuMjAxNjMzIDg0MC45MTUxOTFsMjkyLjMxNTcxOCAwIDAgNjAuNTkxNTE2LTI5Mi4zMTU3MTggMCAwLTYwLjU5MTUxNloiIC8+DQo8cGF0aCBjbGFzcz0ic3ZncGF0aCIgZGF0YS1pbmRleD0icGF0aF8zIiBmaWxsPSIjZWNmMGYxIiBkPSJNMzYwLjIwMTYzMyA5OTIuMzkzOTgybDI5MC40MzAyMjIgMCAwIDMwLjI5NTc1OC0yOTAuNDMwMjIyIDAgMC0zMC4yOTU3NThaIiAvPg0KDQo8L3N2Zz4NCg==",useSetState=adhere_ui_hooks_1.default.useSetState,PullRefresh=(0,react_1.memo)((0,react_1.forwardRef)(function(r,C){var e=r.className,e=void 0===e?"":e,t=r.style,t=void 0===t?{}:t,n=r.scrollClassName,n=void 0===n?"":n,u=r.scrollStyle,u=void 0===u?{}:u,a=r.renderIcon,c=r.renderLabel,l=void 0===c?function(){return adhere_util_intl_1.default.v("下拉刷新")}:c,c=r.renderCanLabel,i=void 0===c?function(){return adhere_util_intl_1.default.v("松开刷新")}:c,c=r.renderLoadingAnimation,o=void 0===c?"la-ball-circus la-dark":c,c=r.isShowUpdateTime,d=void 0===c||c,c=r.updateTimeFormat,k=void 0===c?adhere_util_resource_1.default.Dict.value.ResourceMomentFormat18.value():c,c=r.children,S=(0,ahooks_1.useUpdate)(),s=(0,react_1.useRef)({}),f=useSetState(!1),B=f[0],_=f[1],f=useSetState((0,dayjs_1.default)().valueOf()),M=f[0],m=f[1],Y=(0,react_1.useRef)(null),Z=(0,react_1.useRef)(null),G=(0,react_1.useRef)(null),v=(0,react_1.useRef)(null),g=(0,react_1.useRef)(null),Q=(0,react_1.useRef)(null),h=(0,react_1.useRef)(null),y=(0,react_1.useRef)(null),N=(0,react_1.useRef)(null),I=(0,react_1.useRef)(null),D=(0,react_1.useRef)(null),E=(0,react_1.useRef)(!0),j=(0,react_1.useRef)(200),p=(0,react_1.useRef)(-1),T=(0,react_1.useRef)(!1),z=(0,react_1.useRef)(0),f=(0,react_1.useCallback)(function(){return react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:!!a,noMatch:function(){return react_1.default.createElement("div",{className:"".concat(selectorPrefix,"-trigger-icon")},react_1.default.createElement("img",{className:"".concat(selectorPrefix,"-trigger-icon-inner"),src:defaultImg,alt:"",ref:v}))}},function(){return react_1.default.createElement("div",{className:"".concat(selectorPrefix,"-trigger-icon")},react_1.default.createElement("div",{className:"".concat(selectorPrefix,"-trigger-icon-inner"),ref:v},null==a?void 0:a()))})},[a]),U=(0,react_1.useCallback)(function(){return react_1.default.createElement("p",{className:"".concat(selectorPrefix,"-trigger-label")},react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:B.current,noMatch:function(){return null==l?void 0:l()}},function(){return null==i?void 0:i()}))},[B.current,l,i]),W=(0,react_1.useCallback)(function(){return react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:d},function(){return react_1.default.createElement("p",{className:"".concat(selectorPrefix,"-trigger-update")},adhere_util_intl_1.default.v("更新时间"),"：",react_1.default.createElement("span",{className:"".concat(selectorPrefix,"-trigger-update-label")},(0,dayjs_1.default)(M.current).format(k)))})},[d,M.current,k]),H=(0,react_1.useCallback)(function(){return react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:!!o},function(){return react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:adhere_util_1.default.isString(o),noMatch:function(){return react_1.default.createElement("div",{className:"".concat(selectorPrefix,"-trigger-refresh"),ref:g},o())}},function(){return react_1.default.createElement("div",{className:(0,classnames_1.default)("".concat(selectorPrefix,"-trigger-refresh"),o),ref:g},react_1.default.createElement("div",null),react_1.default.createElement("div",null),react_1.default.createElement("div",null),react_1.default.createElement("div",null),react_1.default.createElement("div",null))})})},[o]);function L(e,t){r[e]&&r[e](t)}function x(e,t,r){e.style.transition=e.style.transition="transform ".concat(r=void 0===r?0:r,"ms ease"),e.style.transform=e.style.transform="translate3d(0,".concat(t,",0)")}function b(){A(),T.current=!1,E.current=!0,h.current.style.display="flex",g.current.style.display="none",I.current.style.display="flex",w(N.current,180,0),y.current.style.overflowY="auto",D.current.style.display="none"}function A(){var e;null!=(e=y.current)&&e.removeEventListener("mousemove",O),null!=(e=y.current)&&e.removeEventListener("mouseup",P),null!=(e=y.current)&&e.removeEventListener("touchmove",O),null!=(e=y.current)&&e.removeEventListener("touchend",P)}function F(){var e,t;D.current.style.display="block",A(),null!=(t=null==(e=y.current)?void 0:e.addEventListener)&&t.call(e,"transitionend",function e(){var t;I.current.style.display="none",g.current.style.display="block",L("onPullRefresh"),null!=(t=y.current)&&t.removeEventListener("transitionend",e),m((0,dayjs_1.default)().valueOf())}),x(y.current,"".concat(z.current,"px"),500),x(h.current,"calc(-100% + ".concat(z.current,"px)"),500),w(N.current,180,300)}function X(){var e,t;b(),null!=(t=null==(e=y.current)?void 0:e.addEventListener)&&t.call(e,"transitionend",function e(){var t,r;null!=(r=null==(t=y.current)?void 0:t.removeEventListener)&&r.call(t,"transitionend",e),I.current.style.display="flex"}),x(y.current,"0px",200),x(h.current,"calc(-100% + 0px)",200)}function q(t){return new Promise(function(e){return m(t||(0,dayjs_1.default)().valueOf(),function(){return e()})})}function J(){return M.current}function w(e,t,r){e.style.transition=e.style.transition="transform ".concat(r=void 0===r?0:r,"ms linear"),e.style.transform=e.style.transform="rotate(".concat(t,"deg)")}function R(e){L("onPullStart"),p.current=(e.changedTouches?e.changedTouches[0]:e).pageY,null!=(e=y.current)&&e.addEventListener("touchmove",O),null!=(e=y.current)&&e.addEventListener("mousemove",O),null!=(e=y.current)&&e.addEventListener("touchend",P),null!=(e=y.current)&&e.addEventListener("mouseup",P)}function O(e){y.current.style.overflow="hidden";var t=(e.changedTouches?e.changedTouches[0]:e).pageY-p.current,r=Math.abs(t);0<t?(e.preventDefault(),T.current=!0,r<j.current?(x(y.current,"".concat(r,"px"),0),x(h.current,"calc(-100% + ".concat(r,"px)"),0),r>=z.current+80?(w(N.current,0,150),_(!0,function(){return L("onPullCanRefresh")})):(w(N.current,180,150),_(!1)),h.current.style.display="flex"):(x(y.current,"".concat(j.current,"px"),0),x(h.current,"calc(-100% + ".concat(j.current,"px)"),0),w(N.current,0,150),_(!0,function(){return L("onPullBottom")}))):T.current?(e.preventDefault(),x(y.current,"0px",0),x(h.current,"calc(-100% + 0px)",0),w(N.current,180,0)):b()}function P(e){var e=(e.changedTouches?e.changedTouches[0]:e).pageY-p.current,t=Math.abs(e);(0<e?!(t<j.current)||t>=z.current+80?F:(L("onPullRebound"),X):b)()}function V(e){var t;0===e.target.scrollTop?(E.current=!0,null!=(t=null==(e=y.current)?void 0:e.addEventListener)&&t.call(e,"touchstart",R),null!=(e=null==(t=y.current)?void 0:t.addEventListener)&&e.call(t,"mousedown",R)):E.current&&(E.current=!1,null!=(t=null==(e=y.current)?void 0:e.removeEventListener)&&t.call(e,"touchstart",R),null!=(e=null==(t=y.current)?void 0:t.removeEventListener))&&e.call(t,"mousedown",R)}function K(){var e;j.current=((e=void 0===(e=r.pullHeight)?200:e)||200)<=0?200:(e||200)>y.current.clientHeight?y.current.clientHeight:e||200,z.current=h.current.clientHeight}return(0,react_1.useImperativeHandle)(C,function(){return{refresh:F,reset:X,resetUpdateTime:q,getUpdateTime:J}}),(0,react_1.useEffect)(function(){m(r.updateTime||(0,dayjs_1.default)().valueOf())},[r.updateTime]),(0,react_1.useEffect)(function(){D.current=document.querySelector(".".concat(selectorPrefix,"-mask")),D.current||(D.current=document.createElement("div"),D.current.className="".concat(selectorPrefix,"-mask"),document.body.appendChild(D.current))},[]),(0,react_1.useLayoutEffect)(function(){h.current=Z.current,N.current=v.current,y.current=G.current,I.current=Q.current,K()},[]),(0,react_1.useLayoutEffect)(function(){var e,t;return null!=(t=null==(e=y.current)?void 0:e.addEventListener)&&t.call(e,"touchstart",R),null!=(e=null==(t=y.current)?void 0:t.addEventListener)&&e.call(t,"mousedown",R),null!=(t=null==(e=y.current)?void 0:e.addEventListener)&&t.call(e,"scroll",V),A}),(0,react_1.useLayoutEffect)(function(){var e=(0,lodash_debounce_1.default)(function(){K(),S()},300);return s.current=new resize_observer_1.ResizeObserver(e),s.current.observe(Y.current),function(){var e;null!=(e=null==s?void 0:s.current)&&e.disconnect()}},[]),react_1.default.createElement("div",{className:(0,classnames_1.default)(selectorPrefix,null!=e?e:""),style:null!=t?t:{},ref:Y},react_1.default.createElement("div",{className:(0,classnames_1.default)("".concat(selectorPrefix,"-scroll"),null!=n?n:""),style:null!=u?u:{},ref:G},c),react_1.default.createElement("div",{className:"".concat(selectorPrefix,"-trigger"),ref:Z},react_1.default.createElement("div",{className:"".concat(selectorPrefix,"-trigger-inner"),ref:Q},f(),U(),W()),H()))}));PullRefresh.displayName="PullRefresh",exports.default=PullRefresh;
//# sourceMappingURL=PullRefresh.js.map
