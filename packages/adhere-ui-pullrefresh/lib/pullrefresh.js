"use strict";var __extends=this&&this.__extends||function(){var l=function(e,t){return(l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};return function(e,t){function r(){this.constructor=e}l(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,r=1,l=arguments.length;r<l;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},__spreadArrays=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;for(var l=Array(e),n=0,t=0;t<r;t++)for(var s=arguments[t],o=0,i=s.length;o<i;o++,n++)l[n]=s[o];return l},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var react_1=__importDefault(require("react")),prop_types_1=__importDefault(require("prop-types")),classnames_1=__importDefault(require("classnames")),moment_1=__importDefault(require("moment")),adhere_util_intl_1=__importDefault(require("@baifendian/adhere-util-intl")),adhere_ui_conditionalrender_1=__importDefault(require("@baifendian/adhere-ui-conditionalrender")),adhere_util_resource_1=__importDefault(require("@baifendian/adhere-util-resource")),adhere_util_1=__importDefault(require("@baifendian/adhere-util")),selectorPrefix="adhere-ui-pullrefresh",PullRefresh=function(t){function e(e){e=t.call(this,e)||this;return e.state={isCan:!1},e.isTop=!0,e.el=null,e.scrollEl=null,e.iconEl=null,e.triggerInnerEl=null,e.maskEl=null,e.pullHeight=200,e.isDownPull=!1,e.refreshHeight=0,e.elRef=react_1.default.createRef(),e.iconElRef=react_1.default.createRef(),e.refreshElRef=react_1.default.createRef(),e.scrollElRef=react_1.default.createRef(),e.triggerInnerElRef=react_1.default.createRef(),e.onTouchStart=e.onTouchStart.bind(e),e.onTouchMove=e.onTouchMove.bind(e),e.onTouchEnd=e.onTouchEnd.bind(e),e.onScroll=e.onScroll.bind(e),e.renderMask(),e}return __extends(e,t),e.prototype.componentDidMount=function(){this.el=this.elRef.current,this.iconEl=this.iconElRef.current,this.scrollEl=this.scrollElRef.current,this.triggerInnerEl=this.triggerInnerElRef.current,this.pullHeight=this.getPullHeight(),this.refreshHeight=this.el.clientHeight,this.addEvents()},e.prototype.getPullHeight=function(){var e=this.props.pullHeight;return e<=0?200:e>this.scrollEl.clientHeight?this.scrollEl.clientHeight:e},e.prototype.renderMask=function(){this.maskEl=document.createElement("div"),this.maskEl.className=selectorPrefix+"-mask",document.body.appendChild(this.maskEl)},e.prototype.addEvents=function(){this.scrollEl.addEventListener("touchstart",this.onTouchStart),this.scrollEl.addEventListener("mousedown",this.onTouchStart),this.scrollEl.addEventListener("scroll",this.onScroll)},e.prototype.removeEvents=function(){this.scrollEl.removeEventListener("mousemove",this.onTouchMove),this.scrollEl.removeEventListener("mouseup",this.onTouchEnd),this.scrollEl.removeEventListener("touchmove",this.onTouchMove),this.scrollEl.removeEventListener("touchend",this.onTouchEnd)},e.prototype.onTouchStart=function(e){this.trigger("onPullStart"),this.startPageY=(e.changedTouches?e.changedTouches[0]:e).pageY;e=this.scrollEl;e.addEventListener("touchmove",this.onTouchMove),e.addEventListener("mousemove",this.onTouchMove),e.addEventListener("touchend",this.onTouchEnd),e.addEventListener("mouseup",this.onTouchEnd)},e.prototype.onTouchMove=function(e){var t=this;this.scrollEl.style.overflow="hidden";var r=(e.changedTouches?e.changedTouches[0]:e).pageY-this.startPageY,l=Math.abs(r);0<r?(e.preventDefault(),this.isDownPull=!0,l<this.pullHeight?(this.translateY(this.scrollEl,l+"px",0),this.translateY(this.el,"calc(-100% + "+l+"px)",0),l>=this.refreshHeight+80?(console.log("3.具备刷新条件"),this.rotateIcon(this.iconEl,0,150),this.setState({isCan:!0},function(){t.trigger("onPullCanRefresh")})):(this.rotateIcon(this.iconEl,180,150),this.setState({isCan:!1})),this.el.style.display="flex"):(this.translateY(this.scrollEl,this.pullHeight+"px",0),this.translateY(this.el,"calc(-100% + "+this.pullHeight+"px)",0),this.rotateIcon(this.iconEl,0,150),console.log("4.拉动到了底部"),this.setState({isCan:!0},function(){t.trigger("onPullBottom")}))):this.isDownPull?(e.preventDefault(),this.translateY(this.scrollEl,"0px",0),this.translateY(this.el,"calc(-100% + 0px)",0),this.rotateIcon(this.iconEl,180,0)):this.clear.call(this)},e.prototype.onTouchEnd=function(e){var t=this,r=(e.changedTouches?e.changedTouches[0]:e).pageY-this.startPageY,e=Math.abs(r);0<r?!(e<this.pullHeight)||e>=this.refreshHeight+80?t.refresh():(console.log("2.没有具备刷新条件弹回"),t.trigger("onPullRebound"),t.reset()):t.clear()},e.prototype.onScroll=function(e){var t=this;0===e.target.scrollTop?(t.isTop=!0,t.scrollEl.addEventListener("touchstart",this.onTouchStart),t.scrollEl.addEventListener("mousedown",this.onTouchStart)):t.isTop&&(t.isTop=!1,t.scrollEl.removeEventListener("touchstart",this.onTouchStart),t.scrollEl.removeEventListener("mousedown",this.onTouchStart))},e.prototype.translateY=function(e,t,r){e.style.transition=e.style.webkitTransition="transform "+(r=void 0===r?0:r)+"ms ease",e.style.transform=e.style.webkitTransform="translate3d(0,"+t+",0)"},e.prototype.rotateIcon=function(e,t,r){e.style.transition=e.style.webkitTransition="transform "+(r=void 0===r?0:r)+"ms linear",e.style.transform=e.style.webkitTransform="rotate("+t+"deg)"},e.prototype.clear=function(){var e;this.removeEvents(),this.isDownPull=!1,this.isTop=!0,this.el.style.display="flex",this.refreshElRef.current.style.display="none",null!==(e=this.triggerInnerEl)&&void 0!==e&&(e.style.display="flex"),this.rotateIcon(this.iconEl,180,0),this.scrollEl.style.overflowY="auto",this.maskEl.style.display="none"},e.prototype.trigger=function(e,t){this.props[e]&&this.props[e](t)},e.prototype.refresh=function(){var t=this;this.maskEl.style.display="block",this.removeEvents(),t.scrollEl.addEventListener("transitionend",function e(){t.triggerInnerEl.style.display="none",t.refreshElRef.current.style.display="block",t.trigger("onPullRefresh",t),t.scrollEl.removeEventListener("transitionend",e)}),t.translateY(t.scrollEl,t.refreshHeight+"px",500),t.translateY(t.el,"calc(-100% + "+t.refreshHeight+"px)",500),t.rotateIcon(t.iconEl,180,300)},e.prototype.reset=function(){var r=this;r.clear(),r.scrollEl.addEventListener("transitionend",function e(){var t;r.scrollEl.removeEventListener("transitionend",e),null!==(t=r.triggerInnerEl)&&void 0!==t&&(t.style.display="flex")}),r.translateY(r.scrollEl,"0px",200),r.translateY(r.el,"calc(-100% + 0px)",200)},e.prototype.renderLoadingAnimation=function(){var e=this,t=this.props.renderLoadingAnimation;return react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:!!t},function(){return react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:adhere_util_1.default.isString(t),noMatch:function(){return react_1.default.createElement("div",{className:selectorPrefix+"-trigger-refresh",ref:e.refreshElRef},t())}},function(){return react_1.default.createElement("div",{className:classnames_1.default.apply(void 0,__spreadArrays([selectorPrefix+"-trigger-refresh"],t.split(" "))),ref:e.refreshElRef},react_1.default.createElement("div",null),react_1.default.createElement("div",null),react_1.default.createElement("div",null),react_1.default.createElement("div",null),react_1.default.createElement("div",null))})})},e.prototype.renderIcon=function(){var e=this,t=this.props.renderIcon;return react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:!!t,noMatch:function(){return react_1.default.createElement("div",{className:selectorPrefix+"-trigger-icon",ref:e.iconElRef})}},function(){return react_1.default.createElement("div",{className:selectorPrefix+"-trigger-icon",ref:e.iconElRef},t())})},e.prototype.renderLabel=function(){var e=this.props,t=e.renderLabel,r=e.renderCanLabel,e=this.state.isCan;return react_1.default.createElement("p",{className:selectorPrefix+"-trigger-label"},react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:e,noMatch:function(){return t()}},function(){return r()}))},e.prototype.renderUpdateTime=function(){var e=this.props.isShowUpdateTime;return react_1.default.createElement(adhere_ui_conditionalrender_1.default,{conditional:e},function(){return react_1.default.createElement("p",{className:selectorPrefix+"-trigger-update"},adhere_util_intl_1.default.v("更新时间"),"：",react_1.default.createElement("span",{className:selectorPrefix+"-trigger-update-label"},moment_1.default().format(adhere_util_resource_1.default.Dict.value.ResourceMomentFormatFull.value)))})},e.prototype.render=function(){var e=this.props,t=e.className,r=e.style,l=e.scrollClassName,n=e.scrollStyle,e=e.children;return react_1.default.createElement("div",{className:classnames_1.default.apply(void 0,__spreadArrays([selectorPrefix],t.split(" "))),style:__assign({},r)},react_1.default.createElement("div",{className:classnames_1.default.apply(void 0,__spreadArrays([selectorPrefix+"-scroll"],l.split(" "))),style:__assign({},n),ref:this.scrollElRef},e),react_1.default.createElement("div",{className:selectorPrefix+"-trigger",ref:this.elRef},react_1.default.createElement("div",{className:selectorPrefix+"-trigger-inner",ref:this.triggerInnerElRef},this.renderIcon(),this.renderLabel(),this.renderUpdateTime()),this.renderLoadingAnimation()))},e}(react_1.default.Component);PullRefresh.defaultProps={className:"",style:{},scrollClassName:"",scrollStyle:{},pullHeight:200,renderIcon:function(){return null},renderLabel:function(){return adhere_util_intl_1.default.v("下拉刷新")},renderCanLabel:function(){return adhere_util_intl_1.default.v("松开刷新")},isShowUpdateTime:!0,renderLoadingAnimation:"la-ball-circus la-dark"},PullRefresh.propTypes={className:prop_types_1.default.string,style:prop_types_1.default.object,scrollClassName:prop_types_1.default.string,scrollStyle:prop_types_1.default.object,pullHeight:prop_types_1.default.number,renderIcon:prop_types_1.default.func,renderLabel:prop_types_1.default.func,renderCanLabel:prop_types_1.default.func,isShowUpdateTime:prop_types_1.default.bool,renderLoadingAnimation:prop_types_1.default.oneOfType([prop_types_1.default.string,prop_types_1.default.func]),onPullStart:prop_types_1.default.func,onPullCanRefresh:prop_types_1.default.func,onPullRefresh:prop_types_1.default.func,onPullBottom:prop_types_1.default.func,onPullRebound:prop_types_1.default.func},exports.default=PullRefresh;
//# sourceMappingURL=pullrefresh.js.map
