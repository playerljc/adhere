{"version":3,"file":"ContextMenu.js","sources":["ContextMenu.js"],"sourcesContent":["import classNames from 'classnames';\r\nimport React, { forwardRef, useImperativeHandle, useRef } from 'react';\r\nimport ReactDOM from 'react-dom/client';\r\nimport { ProviderContext } from './ContextMenuContext';\r\nimport Menu from './Menu';\r\nvar selectorPrefix = 'adhere-ui-contextmenu';\r\nvar ContextMenuComponent = function (props, ref) {\r\n    var _a = props.data, data = _a === void 0 ? [] : _a, config = props.config, el = props.el;\r\n    var menuIns = useRef(null);\r\n    function onClick(e) {\r\n        e.stopPropagation();\r\n        var root = openHandlers.get(el);\r\n        if (root) {\r\n            root.unmount();\r\n        }\r\n        // const flag = ReactDOM.unmountComponentAtNode(el);\r\n        // if (flag) {\r\n        //   el?.parentElement?.removeChild(el);\r\n        // }\r\n    }\r\n    function onContextMenu(e) {\r\n        e.preventDefault();\r\n        var root = openHandlers.get(el);\r\n        if (root) {\r\n            root.unmount();\r\n        }\r\n        // const flag = ReactDOM.unmountComponentAtNode(el);\r\n        // if (flag) {\r\n        //   el?.parentElement?.removeChild(el);\r\n        // }\r\n    }\r\n    useImperativeHandle(ref, function () { return ({\r\n        mount: function () { var _a; return (_a = menuIns.current) === null || _a === void 0 ? void 0 : _a.mount(); },\r\n    }); });\r\n    return (React.createElement(ProviderContext.Provider, { value: {\r\n            config: config,\r\n            el: el,\r\n        } },\r\n        React.createElement(\"div\", { className: classNames(selectorPrefix), style: { zIndex: 9999 * 2 }, onClick: onClick, onContextMenu: onContextMenu },\r\n            React.createElement(Menu, { data: data, className: config.className, style: config.style, ref: menuIns }))));\r\n};\r\nvar ContextMenuComponentHOC = forwardRef(ContextMenuComponent);\r\nvar openHandlers = new WeakMap();\r\nvar ContextMenu = {\r\n    /**\r\n     * config\r\n     * {\r\n     *   name - {String} 名字\r\n     *   icon - {String} 图标\r\n     *   id - {String} 唯一的id\r\n     *   disabled - {Boolean} 不可用\r\n     *   separation - {Bolean} 分割线\r\n     *   attribute - {Object} 自定义属性\r\n     *   children - {Array<Object> 孩子\r\n     * }\r\n     *{\r\n     *   width - {Number} 宽度\r\n     *   x - {Number} 显示的x坐标 相对于body\r\n     *   y - {Number} 现实的y坐标 相对于body\r\n     *   maskClosable - {Boolean} 点击其他位置是否关闭菜单\r\n     *   handler - {Function} 点击的事件句柄\r\n     * }\r\n     * @return {HTMLDivElement}\r\n     * @param data\r\n     * @param config\r\n     */\r\n    open: function (data, config) {\r\n        var contextMenuIns = React.createRef();\r\n        config = Object.assign({ width: 200, maskClosable: true }, config);\r\n        var parentEl = document.createElement('div');\r\n        document.body.appendChild(parentEl);\r\n        var root = ReactDOM.createRoot(parentEl);\r\n        root.render(React.createElement(ContextMenuComponentHOC, { data: data, config: config, el: parentEl, ref: function (ins) {\r\n                var _a;\r\n                // @ts-ignore\r\n                contextMenuIns.current = ins;\r\n                (_a = contextMenuIns.current) === null || _a === void 0 ? void 0 : _a.mount();\r\n            } }));\r\n        openHandlers.set(parentEl, root);\r\n        return parentEl;\r\n    },\r\n    close: function (el) {\r\n        var root = openHandlers.get(el);\r\n        if (root) {\r\n            root.unmount();\r\n        }\r\n        // const flag = ReactDOM.unmountComponentAtNode(el);\r\n        //\r\n        // if (flag) {\r\n        //   el.parentElement.removeChild(el);\r\n        // }\r\n    },\r\n};\r\nexport default ContextMenu;\r\n"],"names":["classNames","React","forwardRef","useImperativeHandle","useRef","ReactDOM","ProviderContext","Menu","selectorPrefix","ContextMenuComponent","props","ref","_a","data","config","el","menuIns","mount","current","createElement","Provider","value","className","style","zIndex","onClick","e","stopPropagation","root","openHandlers","get","unmount","onContextMenu","preventDefault","ContextMenuComponentHOC","WeakMap","ContextMenu","open","contextMenuIns","createRef","parentEl","Object","assign","width","maskClosable","document","body","appendChild","createRoot","render","ins","set","close"],"mappings":"OAAOA,eAAgB,oBAChBC,OAASC,WAAYC,oBAAqBC,MAAqB,KAAP,eACxDC,aAAc,0BACZC,eAA6C,KAAtB,8BACzBC,SAAU,SACjB,IAAIC,eAAiB,wBACjBC,qBAAuB,SAAUC,EAAOC,GACxC,IAAIC,EAAKF,EAAMG,KAAMA,EAAc,KAAA,IAAPD,EAAgB,GAAKA,EAAIE,EAASJ,EAAMI,OAAQC,EAAKL,EAAMK,GACnFC,EAAUZ,OAAO,IAAI,EA0BzB,OAHAD,oBAAoBQ,EAAK,WAAc,MAAO,CAC1CM,MAAO,WAAc,IAAIL,EAAI,OAAO,OAACA,EAAKI,EAAQE,SAAqC,KAAA,EAASN,EAAGK,MAAM,CAAG,CAC/G,CAAG,CAAC,EACGhB,MAAMkB,cAAcb,gBAAgBc,SAAU,CAAEC,MAAO,CACvDP,OAAQA,EACRC,GAAIA,CACR,CAAE,EACFd,MAAMkB,cAAc,MAAO,CAAEG,UAAWtB,WAAWQ,cAAc,EAAGe,MAAO,CAAEC,OAAQ,KAAS,EAAGC,QA7BrG,SAAiBC,GACbA,EAAEC,gBAAgB,GACdC,EAAOC,aAAaC,IAAIf,CAAE,IAE1Ba,EAAKG,QAAQ,CAMrB,EAmBuHC,cAlBvH,SAAuBN,GACnBA,EAAEO,eAAe,GACbL,EAAOC,aAAaC,IAAIf,CAAE,IAE1Ba,EAAKG,QAAQ,CAMrB,CAQoJ,EAC5I9B,MAAMkB,cAAcZ,KAAM,CAAEM,KAAMA,EAAMS,UAAWR,EAAOQ,UAAWC,MAAOT,EAAOS,MAAOZ,IAAKK,CAAQ,CAAC,CAAC,CAAE,CACvH,EACIkB,wBAA0BhC,WAAWO,oBAAoB,EACzDoB,aAAe,IAAIM,QACnBC,YAAc,CAuBdC,KAAM,SAAUxB,EAAMC,GAClB,IAAIwB,EAAiBrC,MAAMsC,UAAU,EAEjCC,GADJ1B,EAAS2B,OAAOC,OAAO,CAAEC,MAAO,IAAKC,aAAc,CAAA,CAAK,EAAG9B,CAAM,EAClD+B,SAAS1B,cAAc,KAAK,GAEvCS,GADJiB,SAASC,KAAKC,YAAYP,CAAQ,EACvBnC,SAAS2C,WAAWR,CAAQ,GAQvC,OAPAZ,EAAKqB,OAAOhD,MAAMkB,cAAce,wBAAyB,CAAErB,KAAMA,EAAMC,OAAQA,EAAQC,GAAIyB,EAAU7B,IAAK,SAAUuC,GAG5GZ,EAAepB,QAAUgC,EACzB,OAACtC,EAAK0B,EAAepB,UAA8CN,EAAGK,MAAM,CAChF,CAAE,CAAC,CAAC,EACRY,aAAasB,IAAIX,EAAUZ,CAAI,EACxBY,CACX,EACAY,MAAO,SAAUrC,GACTa,EAAOC,aAAaC,IAAIf,CAAE,EAC1Ba,GACAA,EAAKG,QAAQ,CAOrB,CACJ,iBACeK"}