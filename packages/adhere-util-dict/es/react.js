var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(n){for(var e,t=1,i=arguments.length;t<i;t++)for(var a in e=arguments[t])Object.prototype.hasOwnProperty.call(e,a)&&(n[a]=e[a]);return n}).apply(this,arguments)},__rest=this&&this.__rest||function(n,e){var t={};for(a in n)Object.prototype.hasOwnProperty.call(n,a)&&e.indexOf(a)<0&&(t[a]=n[a]);if(null!=n&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,a=Object.getOwnPropertySymbols(n);i<a.length;i++)e.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(n,a[i])&&(t[a[i]]=n[a[i]]);return t};import{useMount,useUpdateEffect,useUpdateLayoutEffect}from"ahooks";import React,{forwardRef,memo,useCallback,useImperativeHandle,useMemo,useRef,useState}from"react";import Suspense from"@baifendian/adhere-ui-suspense";import Util from"@baifendian/adhere-util";import Dict from"./dict";var ComponentCache=new Map,FunctionComponent=function(m){return function(n,e){var t=n.children,i=n.firstLoading,a=n.renderNormalLoading,r=n.isEmpty,o=n.renderEmpty,s=n.args,u=n.isUseMemo,c=__rest(n,["children","firstLoading","renderNormalLoading","isEmpty","renderEmpty","args","isUseMemo"]),n=useState({data:null,isValidate:!0,isPending:!0}),l=n[0],d=n[1],f=useRef(),n=useMemo(function(){var n=__assign({},c);return i&&(n.firstLoading=i),a&&(n.renderNormalLoading=a),o&&(n.renderEmpty=o),r&&(n.isEmpty=r),n},[i,a,o,r]);useUpdateLayoutEffect(function(){var n,e;d(function(n){return{data:n.data,isValidate:!0,isPending:!0}}),null!=(e=null==(n=null==f?void 0:f.current)?void 0:n.fetchData)&&e.call(n)},s||[]),useImperativeHandle(e,function(){return{reload:function(){var n,e;return d(function(n){return{data:n.data,isValidate:!0,isPending:!0}}),null==(e=null==(n=null==f?void 0:f.current)?void 0:n.fetchData)?void 0:e.call(n)},reset:function(){var n,e;return d(function(n){return{data:null,isValidate:!0,isPending:!0}}),null==(e=null==(n=null==f?void 0:f.current)?void 0:n.reset)?void 0:e.call(n)}}});return React.createElement(Suspense.ASync,__assign({ref:f,fetchData:function(){Dict.handlers[m].isUseMemo=u||!1;var n=(n=Dict.value[m]).value.apply(n,s||[]);return n.then?n.then(function(n){return d({data:n,isValidate:!0,isPending:!1}),n}).catch(function(n){return d({data:n,isValidate:!1,isPending:!1}),n}):(d({data:n,isValidate:!0,isPending:!1}),Promise.resolve(n))}},n,{isEmpty:function(){return null==l||(null==r?void 0:r(l))}}),null==t?void 0:t(l))}},PromiseComponent=function(l){return function(n,e){var t=n.children,i=n.firstLoading,a=n.renderNormalLoading,r=n.isEmpty,o=n.renderEmpty,s=__rest(n,["children","firstLoading","renderNormalLoading","isEmpty","renderEmpty"]),n=useState({data:null,isPending:!0,isValidate:!0}),u=n[0],c=n[1],n=useMemo(function(){var n=__assign({},s);return i&&(n.firstLoading=i),a&&(n.renderNormalLoading=a),o&&(n.renderEmpty=o),r&&(n.isEmpty=r),n},[i,a,o,r]);return React.createElement(Suspense.ASync,__assign({ref:e,fetchData:function(){return Dict.value[l].value.then(function(n){return c({data:n,isValidate:!0,isPending:!1}),n}).catch(function(n){return c({data:n,isValidate:!1,isPending:!1}),n})}},n,{isEmpty:function(){return null==u||(null==r?void 0:r(u))}}),null==t?void 0:t(u))}},NoPromiseComponent=function(a){return function(n){var e=n.children,t=n.isEmpty,n=n.renderEmpty,i=Dict.value[a].value;return null==i||null!=t&&t(i)?n?null==n?void 0:n():null:null==e?void 0:e({data:i,isValidate:!0,isPending:!1})}},ComponentMap=new Map([["Function",function(n){return ComponentCache.has("Function_".concat(n))||ComponentCache.set("Function_".concat(n),memo(forwardRef(FunctionComponent(n)))),ComponentCache.get("Function_".concat(n))}],["Promise",function(n){return ComponentCache.has("Promise_".concat(n))||ComponentCache.set("Promise_".concat(n),memo(forwardRef(PromiseComponent(n)))),ComponentCache.get("Promise_".concat(n))}],["NotPromise",function(n){return ComponentCache.has("NotPromise_".concat(n))||ComponentCache.set("NotPromise_".concat(n),memo(NoPromiseComponent(n))),ComponentCache.get("NotPromise_".concat(n))}]]),Component=function(a){return function(n,e){var t=Dict.value[a].value,i=Util.isFunction(t)?null==(i=ComponentMap.get("Function"))?void 0:i(a):t.then?null==(i=ComponentMap.get("Promise"))?void 0:i(a):null==(t=ComponentMap.get("NotPromise"))?void 0:t(a);return i&&React.createElement(i,__assign({ref:e},n))}};function set(n){DictReactComponents[n]||(DictReactComponents[n]=memo(forwardRef(Component(n))))}var useDict=function(e,n){var t=Dict.value[e].value,i=Dict.value[e].refresh,a=null!=n?n:{},n=useState({data:null,isPending:!0,isValidate:!0,refresh:i}),r=n[0],o=n[1],s=useCallback(function(){var n;Util.isFunction(t)?(Dict.handlers[e].isUseMemo=!(null==a||!a.isUseMemo),(n=t(null!=(n=null==a?void 0:a.functionArgs)?n:[])).then?n.then(function(n){o({data:n,isValidate:!0,isPending:!1,refresh:i})}).catch(function(n){o({data:n,isValidate:!1,isPending:!1,refresh:i})}):o({data:n,isValidate:!0,isPending:!1,refresh:i})):t.then?t.then(function(n){o({data:n,isValidate:!0,isPending:!1,refresh:i})}).catch(function(n){o({data:n,isValidate:!1,isPending:!1,refresh:i})}):o({data:t,isValidate:!0,isPending:!1,refresh:i})},[e,t,i,JSON.stringify(a)]);return useMount(function(){s()}),useUpdateEffect(function(){o(function(n){return{data:n.data,isValidate:!0,isPending:!0,refresh:i}}),s()},[e,t,i,JSON.stringify(a)]),r},DictReactComponents={};export default DictReactComponents;export{set,useDict};
//# sourceMappingURL=react.js.map
