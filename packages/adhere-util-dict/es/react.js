var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++)for(var r in e=arguments[t])Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}).apply(this,arguments)},__rest=this&&this.__rest||function(n,e){var t={};for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(null!=n&&"function"==typeof Object.getOwnPropertySymbols)for(var o=0,r=Object.getOwnPropertySymbols(n);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(n,r[o])&&(t[r[o]]=n[r[o]]);return t};import{useUpdateLayoutEffect}from"ahooks";import React,{forwardRef,memo,useImperativeHandle,useMemo,useRef,useState}from"react";import Suspense from"@baifendian/adhere-ui-suspense";import Util from"@baifendian/adhere-util";import Dict from"./dict";var ComponentCache=new Map,FunctionComponent=function(p){return function(n,e){var t=n.children,o=n.firstLoading,r=n.renderNormalLoading,i=n.isEmpty,a=n.renderEmpty,u=n.args,s=n.isUseMemo,c=__rest(n,["children","firstLoading","renderNormalLoading","isEmpty","renderEmpty","args","isUseMemo"]),n=useState({data:null,isValidate:!0,isPending:!0}),l=n[0],d=n[1],m=useRef(),n=useMemo(function(){var n=__assign({},c);return o&&(n.firstLoading=o),r&&(n.renderNormalLoading=r),a&&(n.renderEmpty=a),i&&(n.isEmpty=i),n},[o,r,a,i]);useUpdateLayoutEffect(function(){var n,e;d(function(n){return{data:n.data,isValidate:!0,isPending:!0}}),null!=(e=null==(n=null==m?void 0:m.current)?void 0:n.fetchData)&&e.call(n)},u||[]),useImperativeHandle(e,function(){return{reload:function(){var n,e;return d(function(n){return{data:n.data,isValidate:!0,isPending:!0}}),null==(e=null==(n=null==m?void 0:m.current)?void 0:n.fetchData)?void 0:e.call(n)},reset:function(){var n,e;return d(function(n){return{data:null,isValidate:!0,isPending:!0}}),null==(e=null==(n=null==m?void 0:m.current)?void 0:n.reset)?void 0:e.call(n)}}});return React.createElement(Suspense.ASync,__assign({ref:m,fetchData:function(){Dict.handlers[p].isUseMemo=s||!1;var n=(n=Dict.value[p]).value.apply(n,u||[]);return n.then?n.then(function(n){return d({data:n,isValidate:!0,isPending:!1}),n}).catch(function(n){return d({data:n,isValidate:!1,isPending:!1}),n}):(d({data:n,isValidate:!0,isPending:!1}),Promise.resolve(n))}},n,{isEmpty:function(){return null==l||(null==i?void 0:i(l))}}),null==t?void 0:t(l))}},PromiseComponent=function(l){return function(n,e){var t=n.children,o=n.firstLoading,r=n.renderNormalLoading,i=n.isEmpty,a=n.renderEmpty,u=__rest(n,["children","firstLoading","renderNormalLoading","isEmpty","renderEmpty"]),n=useState({data:null,isPending:!0,isValidate:!0}),s=n[0],c=n[1],n=useMemo(function(){var n=__assign({},u);return o&&(n.firstLoading=o),r&&(n.renderNormalLoading=r),a&&(n.renderEmpty=a),i&&(n.isEmpty=i),n},[o,r,a,i]);return React.createElement(Suspense.ASync,__assign({ref:e,fetchData:function(){return Dict.value[l].value.then(function(n){return c({data:n,isValidate:!0,isPending:!1}),n}).catch(function(n){return c({data:n,isValidate:!1,isPending:!1}),n})}},n,{isEmpty:function(){return null==s||(null==i?void 0:i(s))}}),null==t?void 0:t(s))}},NoPromiseComponent=function(r){return function(n){var e=n.children,t=n.isEmpty,n=n.renderEmpty,o=Dict.value[r].value;return null==o||null!=t&&t(o)?n?null==n?void 0:n():null:null==e?void 0:e({data:o,isValidate:!0,isPending:!1})}},ComponentMap=new Map([["Function",function(n){return ComponentCache.has("Function_".concat(n))||ComponentCache.set("Function_".concat(n),memo(forwardRef(FunctionComponent(n)))),ComponentCache.get("Function_".concat(n))}],["Promise",function(n){return ComponentCache.has("Promise_".concat(n))||ComponentCache.set("Promise_".concat(n),memo(forwardRef(PromiseComponent(n)))),ComponentCache.get("Promise_".concat(n))}],["NotPromise",function(n){return ComponentCache.has("NotPromise_".concat(n))||ComponentCache.set("NotPromise_".concat(n),memo(NoPromiseComponent(n))),ComponentCache.get("NotPromise_".concat(n))}]]),Component=function(r){return function(n,e){var t=Dict.value[r].value,o=Util.isFunction(t)?null==(o=ComponentMap.get("Function"))?void 0:o(r):t.then?null==(o=ComponentMap.get("Promise"))?void 0:o(r):null==(t=ComponentMap.get("NotPromise"))?void 0:t(r);return o?React.createElement(o,__assign({ref:e},n)):null}};function set(n){DictReactComponents[n]||(DictReactComponents[n]=memo(forwardRef(Component(n))))}var DictReactComponents={};export default DictReactComponents;export{set};
//# sourceMappingURL=react.js.map
