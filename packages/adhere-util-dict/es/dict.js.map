{"version":3,"file":"dict.js","sources":["dict.js"],"sourcesContent":["import DictReactComponent, { init as initReact } from './react';\r\nvar target = {};\r\nvar funParams = new Map();\r\nvar defaultConfig = {\r\n    isUseMemo: true,\r\n};\r\nvar config = defaultConfig;\r\n/**\r\n * diffParams\r\n * @param preArgArray - {Array}\r\n * @param curArgArray - {Array}\r\n * @return {boolean}\r\n */\r\nfunction diffParams(preArgArray, curArgArray) {\r\n    if (preArgArray.length !== curArgArray.length)\r\n        return false;\r\n    var flag = false;\r\n    for (var i = 0; i < preArgArray.length; i++) {\r\n        if (preArgArray[i] !== curArgArray[i]) {\r\n            flag = true;\r\n            break;\r\n        }\r\n    }\r\n    return !flag;\r\n}\r\n/**\r\n * CreateFunProxy\r\n * @param fun - {Function}\r\n * @param property - {String}\r\n * @return {Proxy}\r\n */\r\nfunction CreateFunProxy(fun, property) {\r\n    return new Proxy(fun, {\r\n        apply: function (funTarget, thisArg, argArray) {\r\n            var context = thisArg || window;\r\n            var result = null;\r\n            var entry = funParams.get(property);\r\n            if (!entry) {\r\n                result = funTarget.apply(context, argArray);\r\n                funParams.set(property, {\r\n                    argArray: argArray,\r\n                    result: result,\r\n                });\r\n            }\r\n            else if (!diffParams(entry.argArray, argArray)) {\r\n                result = funTarget.apply(context, argArray);\r\n                funParams.set(property, {\r\n                    argArray: argArray,\r\n                    result: result,\r\n                });\r\n            }\r\n            else {\r\n                result = entry.result;\r\n            }\r\n            return result;\r\n        },\r\n    });\r\n}\r\n/**\r\n * initValue\r\n * @param p\r\n * @param params\r\n */\r\nfunction initValue(p, params) {\r\n    var handler = Dict.handlers[p];\r\n    // 返回值 - 一般都不是函数\r\n    var value = handler(params);\r\n    // 如果value是函数则默认是缓存的\r\n    if (value instanceof Function) {\r\n        // 函数单独的缓存开关\r\n        if (!!handler.isUseMemo) {\r\n            value = CreateFunProxy(value, p);\r\n        }\r\n        else {\r\n            // 总体的缓存开关\r\n            if (config.isUseMemo) {\r\n                value = CreateFunProxy(value, p);\r\n            }\r\n        }\r\n    }\r\n    return value;\r\n}\r\nvar Dict = {\r\n    handlers: {},\r\n    value: new Proxy(target, {\r\n        get: function (target, property, receiver) {\r\n            // 如果p属性没在t中\r\n            if (!(property in target)) {\r\n                receiver[property] = {\r\n                    value: initValue(property, null),\r\n                    refresh: function (params) {\r\n                        receiver[property].value = initValue(property, params);\r\n                        return this;\r\n                    },\r\n                };\r\n            }\r\n            return Reflect.get(target, property, receiver);\r\n        },\r\n    }),\r\n    init: function (dictArray, _config) {\r\n        if (dictArray === void 0) { dictArray = []; }\r\n        if (_config === void 0) { _config = defaultConfig; }\r\n        config = _config;\r\n        (dictArray || []).forEach(function (dict) {\r\n            var _a, _b;\r\n            if (dict) {\r\n                (_a = dict === null || dict === void 0 ? void 0 : dict.initStatic) === null || _a === void 0 ? void 0 : _a.call(dict);\r\n                (_b = dict === null || dict === void 0 ? void 0 : dict.initRemote) === null || _b === void 0 ? void 0 : _b.call(dict);\r\n            }\r\n        });\r\n        initReact();\r\n    },\r\n    React: DictReactComponent,\r\n};\r\nexport default Dict;\r\n"],"names":["DictReactComponent","initReact","target","funParams","Map","defaultConfig","isUseMemo","config","diffParams","preArgArray","curArgArray","length","flag","i","CreateFunProxy","fun","property","Proxy","apply","funTarget","thisArg","argArray","context","window","result","entry","get","set","initValue","p","params","handler","Dict","handlers","value","Function","receiver","refresh","this","Reflect","init","dictArray","_config","forEach","dict","_b","_a","initStatic","call","initRemote","React"],"mappings":"OAAOA,oBAA8BC,iBAA0B,KAAT,UACtD,IAAIC,OAAS,GACTC,UAAY,IAAIC,IAChBC,cAAgB,CAChBC,UAAW,CAAA,CACf,EACIC,OAASF,cAOb,SAASG,WAAWC,EAAaC,GAC7B,GAAID,EAAYE,SAAWD,EAAYC,OACnC,MAAO,CAAA,EAEX,IADA,IAAIC,EAAO,CAAA,EACFC,EAAI,EAAGA,EAAIJ,EAAYE,OAAQE,CAAC,GACrC,GAAIJ,EAAYI,KAAOH,EAAYG,GAAI,CACnCD,EAAO,CAAA,EACP,KACJ,CAEJ,MAAO,CAACA,CACZ,CAOA,SAASE,eAAeC,EAAKC,GACzB,OAAO,IAAIC,MAAMF,EAAK,CAClBG,MAAO,SAAUC,EAAWC,EAASC,GACjC,IAAIC,EAAUF,GAAWG,OACrBC,EAAS,KACTC,EAAQtB,UAAUuB,IAAIV,CAAQ,EAkBlC,OAjBKS,GAOKjB,WAAWiB,EAAMJ,SAAUA,CAAQ,EAQzCG,EAASC,EAAMD,QAdfA,EAASL,EAAUD,MAAMI,EAASD,CAAQ,EAC1ClB,UAAUwB,IAAIX,EAAU,CACpBK,SAAUA,EACVG,OAAQA,CACZ,CAAC,GAYEA,CACX,CACJ,CAAC,CACL,CAMA,SAASI,UAAUC,EAAGC,GAClB,IAAIC,EAAUC,KAAKC,SAASJ,GAExBK,EAAQH,EAAQD,CAAM,EAc1B,OATQI,EAHJA,aAAiBC,WAEXJ,EAAQzB,WAKNC,OAAOD,WAJHQ,eAAeoB,EAAOL,CAAC,EAShCK,CACX,CACA,IAAIF,KAAO,CACPC,SAAU,GACVC,MAAO,IAAIjB,MAAMf,OAAQ,CACrBwB,IAAK,SAAUxB,EAAQc,EAAUoB,GAW7B,OATMpB,KAAYd,IACdkC,EAASpB,GAAY,CACjBkB,MAAON,UAAUZ,EAAU,IAAI,EAC/BqB,QAAS,SAAUP,GAEf,OADAM,EAASpB,GAAUkB,MAAQN,UAAUZ,EAAUc,CAAM,EAC9CQ,IACX,CACJ,GAEGC,QAAQb,IAAIxB,EAAQc,EAAUoB,CAAQ,CACjD,CACJ,CAAC,EACDI,KAAM,SAAUC,EAAWC,GAGvBnC,OAD0BmC,EAAV,KAAA,IAAZA,EAAgCrC,cAC3BqC,IAFmBD,EAAV,KAAA,IAAdA,EAAoC,GAGvCA,IAAa,IAAIE,QAAQ,SAAUC,GAChC,IAAQC,EACJD,IACA,OAACE,EAAKF,MAAAA,EAAmC,KAAA,EAASA,EAAKG,aAAiDD,EAAGE,KAAKJ,CAAI,EACpH,OAACC,EAAKD,MAAAA,EAAmC,KAAA,EAASA,EAAKK,aAAiDJ,EAAGG,KAAKJ,CAAI,EAE5H,CAAC,EACD3C,UAAU,CACd,EACAiD,MAAOlD,kBACX,iBACegC"}