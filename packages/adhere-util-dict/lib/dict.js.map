{"version":3,"file":"dict.js","sources":["dict.js"],"sourcesContent":["\"use strict\";\r\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    var desc = Object.getOwnPropertyDescriptor(m, k);\r\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\r\n      desc = { enumerable: true, get: function() { return m[k]; } };\r\n    }\r\n    Object.defineProperty(o, k2, desc);\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}));\r\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n});\r\nvar __importStar = (this && this.__importStar) || function (mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar react_1 = __importStar(require(\"./react\"));\r\nvar target = {};\r\nvar handlerTarget = {};\r\nvar funParams = new Map();\r\nvar defaultConfig = {\r\n    isUseMemo: true,\r\n};\r\nvar config = defaultConfig;\r\n/**\r\n * diffParams\r\n * @param {Array} preArgArray\r\n * @param {Array} curArgArray\r\n * @return {boolean}\r\n */\r\nfunction diffParams(preArgArray, curArgArray) {\r\n    if (preArgArray.length !== curArgArray.length)\r\n        return false;\r\n    var flag = false;\r\n    for (var i = 0; i < preArgArray.length; i++) {\r\n        if (preArgArray[i] !== curArgArray[i]) {\r\n            flag = true;\r\n            break;\r\n        }\r\n    }\r\n    return !flag;\r\n}\r\n/**\r\n * CreateFunProxy\r\n * @param {Function} fun\r\n * @param {String} property\r\n * @return {Proxy}\r\n */\r\nfunction CreateFunProxy(fun, property) {\r\n    return new Proxy(fun, {\r\n        apply: function (funTarget, thisArg, argArray) {\r\n            var context = thisArg || window;\r\n            var result = null;\r\n            var entry = funParams.get(property);\r\n            if (!entry) {\r\n                result = funTarget.apply(context, argArray);\r\n                funParams.set(property, {\r\n                    argArray: argArray,\r\n                    result: result,\r\n                });\r\n            }\r\n            else if (!diffParams(entry.argArray, argArray)) {\r\n                result = funTarget.apply(context, argArray);\r\n                funParams.set(property, {\r\n                    argArray: argArray,\r\n                    result: result,\r\n                });\r\n            }\r\n            else {\r\n                result = entry.result;\r\n            }\r\n            return result;\r\n        },\r\n    });\r\n}\r\n/**\r\n * initValue\r\n * @param p\r\n * @param params\r\n */\r\nfunction initValue(p, params) {\r\n    var handler = Dict.handlers[p];\r\n    // 返回值 - 一般都不是函数\r\n    var value = handler(params);\r\n    // 如果value是函数则默认是缓存的\r\n    if (value instanceof Function) {\r\n        // 函数单独的缓存开关\r\n        if ('isUseMemo' in handler) {\r\n            if (handler.isUseMemo) {\r\n                value = CreateFunProxy(value, p);\r\n            }\r\n        }\r\n        else {\r\n            // 总体的缓存开关\r\n            if ('isUseMemo' in config) {\r\n                if (config.isUseMemo) {\r\n                    value = CreateFunProxy(value, p);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    return value;\r\n}\r\nvar Dict = {\r\n    /**\r\n     * handler - 字典的定义对象\r\n     */\r\n    handlers: new Proxy(handlerTarget, {\r\n        set: function (target, property, value, receiver) {\r\n            var result = Reflect.set(target, property, value, receiver);\r\n            (0, react_1.set)(property);\r\n            return result;\r\n        },\r\n    }),\r\n    /**\r\n     * value - 字典的使用对象\r\n     */\r\n    value: new Proxy(target, {\r\n        get: function (target, property, receiver) {\r\n            // 如果p属性没在t中\r\n            if (!(property in target)) {\r\n                receiver[property] = {\r\n                    value: initValue(property, null),\r\n                    refresh: function (params) {\r\n                        receiver[property].value = initValue(property, params);\r\n                        return this;\r\n                    },\r\n                };\r\n            }\r\n            return Reflect.get(target, property, receiver);\r\n        },\r\n    }),\r\n    /**\r\n     * init - 字典的初始化\r\n     * @param {\r\n     *   {\r\n     *    initStatic: () => void;\r\n     *    initRemote: () => void;\r\n     *   }[]\r\n     * } dictArray 字典定义的集合\r\n     * @param {IConfig} _config 字典的配置\r\n     * @return {void}\r\n     */\r\n    init: function (dictArray, _config) {\r\n        if (dictArray === void 0) { dictArray = []; }\r\n        if (_config === void 0) { _config = defaultConfig; }\r\n        config = _config;\r\n        (dictArray || []).forEach(function (dict) {\r\n            var _a, _b;\r\n            if (dict) {\r\n                (_a = dict === null || dict === void 0 ? void 0 : dict.initStatic) === null || _a === void 0 ? void 0 : _a.call(dict);\r\n                (_b = dict === null || dict === void 0 ? void 0 : dict.initRemote) === null || _b === void 0 ? void 0 : _b.call(dict);\r\n            }\r\n        });\r\n    },\r\n    /**\r\n     * React - 字典对应的React组件\r\n     */\r\n    React: react_1.default,\r\n};\r\nexports.default = Dict;\r\n"],"names":["__createBinding","this","Object","create","o","m","k","k2","undefined","desc","getOwnPropertyDescriptor","__esModule","writable","configurable","enumerable","get","defineProperty","__setModuleDefault","v","value","__importStar","mod","result","prototype","hasOwnProperty","call","react_1","exports","require","target","handlerTarget","funParams","Map","defaultConfig","isUseMemo","config","diffParams","preArgArray","curArgArray","length","flag","i","CreateFunProxy","fun","property","Proxy","apply","funTarget","thisArg","argArray","context","window","entry","set","initValue","p","params","handler","Dict","handlers","Function","receiver","Reflect","refresh","init","dictArray","_config","forEach","dict","_b","_a","initStatic","initRemote","React","default"],"mappings":"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"}