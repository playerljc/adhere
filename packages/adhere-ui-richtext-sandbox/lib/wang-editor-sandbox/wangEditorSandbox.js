"use strict";var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},__createBinding=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&("get"in o?t.__esModule:!o.writable&&!o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){e[r=void 0===r?n:r]=t[n]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&__createBinding(t,e,n);return __setModuleDefault(t,e),t},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},wang_editor_css_1=(Object.defineProperty(exports,"__esModule",{value:!0}),__importDefault(require("./lib/wang-editor-css"))),ahooks_1=require("ahooks"),classnames_1=__importDefault(require("classnames")),react_1=__importStar(require("react")),react_dom_production_min_1=__importDefault(require("../common-lib/react-dom.production.min")),react_production_min_1=__importDefault(require("../common-lib/react.production.min")),wang_editor_5_1_23_1=__importDefault(require("./lib/wang-editor-5.1.23")),wang_editor_react_1_0_6_1=__importDefault(require("./lib/wang-editor-react-1.0.6")),selectorPrefix="adhere-ui-richtext-wangeditor-sandbox",editorId="wangEditorWrap",WangEditorSandbox=function(c,i){var e=c.wrapStyle,t=c.wrapClassName,u=c.wangEditorStyle,n=c.toolBarProps,l=c.editorProps,r=(0,react_1.useRef)(null),d=(0,react_1.useRef)(null),s=(0,react_1.useRef)(!1),_=(0,react_1.useRef)(c.value),f=(0,react_1.useRef)(null),m=(0,react_1.useMemo)(function(){return{defaultConfig:{},mode:"default"}},[]),p=(0,react_1.useMemo)(function(){return{defaultConfig:{},mode:"default"}},[]);function b(){return new Promise(function(e){var t;if(!("readOnly"in c&&c.readOnly))return new Promise(function(e){var t=null==(o=null==d?void 0:d.current)?void 0:o.contentDocument,n=null==(o=null==d?void 0:d.current)?void 0:o.contentWindow,r=t.getElementById(editorId),o=n.WangEditorForReact,a=o.Editor,o=o.Toolbar;n.ReactDOM.render(react_1.default.createElement(react_1.default.Fragment,null,react_1.default.createElement(o,__assign({editor:f.current},m,c.toolBarProps||{})),react_1.default.createElement(a,__assign({ref:i},p,c.editorProps||{},{onCreated:function(e){f.current=e,b().then(function(){null!=l&&l.onCreated&&l.onCreated(e)})},value:_.current,onChange:function(e){c.onChange&&c.onChange(e.getHtml())}}))),r,function(){s.current=!0,e({document:t,window:n,wrap:r})})});(t=null==(t=null==d?void 0:d.current)?void 0:t.contentDocument).getElementById(editorId).innerHTML=c.value,r.current&&(r.current.style.height="".concat(t.documentElement.offsetHeight,"px")),e()})}return(0,react_1.useImperativeHandle)(i,function(){return{getEditor:function(){return f.current},getWangEditor:function(){var e;return null==(e=null==(e=null==d?void 0:d.current)?void 0:e.contentWindow)?void 0:e.wangEditor}}}),(0,react_1.useLayoutEffect)(function(){var e;function t(){return b()}null!=(e=null==d?void 0:d.current)&&e.addEventListener("load",t);var n=URL.createObjectURL(new Blob([react_production_min_1.default],{type:"text/javascript"})),r=URL.createObjectURL(new Blob([react_dom_production_min_1.default],{type:"text/javascript"})),o=URL.createObjectURL(new Blob([wang_editor_5_1_23_1.default],{type:"text/javascript"})),a=URL.createObjectURL(new Blob([wang_editor_react_1_0_6_1.default],{type:"text/javascript"})),i=URL.createObjectURL(new Blob(['\n        <!DOCTYPE html>\n        <head>\n          <meta charset="UTF-8" />\n          <title></title>\n          <style>\n            html, body {\n              margin: 0;\n              padding: 0;\n            }\n\n            html.editor {\n              width: 100%;\n              height: 100%;\n            }\n\n            html.editor > body {\n              width: 100%;\n              height: 100%;\n            }\n\n            html.editor > body > #'.concat(editorId," {\n              display: flex;\n              flex-direction: column;\n              width: 100%;\n              height: 100%;\n            }\n            \n            html > body > #").concat(editorId," > [data-w-e-toolbar=true] {\n              flex-shrink: 0;\n            }\n            \n            html > body > #").concat(editorId," > [data-w-e-textarea=true] {\n              flex-grow: 1;\n              min-height: 0;\n            }\n\n            ::-webkit-scrollbar-thumb {\n              background-color: rgba(0, 0, 0, 0.1);\n              border-radius: 4px;\n            }\n            *::-webkit-scrollbar-track {\n              background-color: rgba(0, 0, 0, 0.1);\n            }\n            ::-webkit-scrollbar {\n              width: 10px;\n              height: 10px;\n            }\n\n            ").concat(wang_editor_css_1.default,'\n          </style>\n          <script src="').concat(n,'"><\/script>\n          <script src="').concat(r,'"><\/script>\n          <script src="').concat(o,'"><\/script>\n          <script src="').concat(a,'"><\/script>\n        </head>\n        <html lang="en" class="').concat((0,classnames_1.default)({editor:!("readOnly"in c&&c.readOnly)}),'">\n        <body>\n          <div id="').concat(editorId,'" style="').concat(u||"",'"></div>\n        </body>\n        </html>\n        ')],{type:"text/html"}));return d.current.src=i,function(){var e;null!=(e=null==d?void 0:d.current)&&e.removeEventListener("load",t),URL.revokeObjectURL(i),URL.revokeObjectURL(n),URL.revokeObjectURL(r),URL.revokeObjectURL(o),URL.revokeObjectURL(a)}},[]),(0,react_1.useEffect)(function(){return function(){null!==f.current&&(f.current.destroy(),f.current=null,b())}},[f]),(0,ahooks_1.useUpdateEffect)(function(){_.current=c.value,s.current&&b().then(function(){})},[c.value]),(0,ahooks_1.useUpdateEffect)(function(){s.current&&b().then(function(){})},[n,l]),react_1.default.createElement("div",{ref:r,className:(0,classnames_1.default)("".concat(selectorPrefix),t||""),style:e||{}},react_1.default.createElement("iframe",{ref:d,className:"".concat(selectorPrefix,"-frame")}))},WangEditorSandboxHOC=(0,react_1.memo)((0,react_1.forwardRef)(WangEditorSandbox));WangEditorSandboxHOC.AntdFormRequireValidator=function(a,i){return{validator:function(e,t,n){var r,o;null!=(o=null==(r=null==a?void 0:a())?void 0:r.isEmpty)&&o.call(r)?n(i):n()}}},exports.default=WangEditorSandboxHOC;
//# sourceMappingURL=wangEditorSandbox.js.map
