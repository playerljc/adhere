var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};import WangEditorCssStr from"./lib/wang-editor-css";import{useUpdateEffect}from"ahooks";import classNames from"classnames";import React,{forwardRef,memo,useEffect,useImperativeHandle,useLayoutEffect,useMemo,useRef}from"react";import ReactDOMStr from"../common-lib/react-dom.production.min";import ReactStr from"../common-lib/react.production.min";import WangEditorStr from"./lib/wang-editor-5.1.23";import WangEditorReactStr from"./lib/wang-editor-react-1.0.6";var selectorPrefix="adhere-ui-richtext-wangeditor-sandbox",editorId="wangEditorWrap",WangEditorSandbox=function(i,c){var t=i.wrapStyle,e=i.wrapClassName,l=i.wangEditorStyle,n=i.toolBarProps,d=i.editorProps,r=useRef(null),u=useRef(null),s=useRef(!1),f=useRef(i.value),m=useRef(null),g=useMemo(function(){return{defaultConfig:{},mode:"default"}},[]),p=useMemo(function(){return{defaultConfig:{},mode:"default"}},[]);function b(){return new Promise(function(t){var e;if(!("readOnly"in i&&i.readOnly))return new Promise(function(t){var e=null==(o=null==u?void 0:u.current)?void 0:o.contentDocument,n=null==(o=null==u?void 0:u.current)?void 0:o.contentWindow,r=e.getElementById(editorId),o=n.WangEditorForReact,a=o.Editor,o=o.Toolbar;n.ReactDOM.render(React.createElement(React.Fragment,null,React.createElement(o,__assign({editor:m.current},g,i.toolBarProps||{})),React.createElement(a,__assign({ref:c},p,i.editorProps||{},{onCreated:function(t){m.current=t,b().then(function(){null!=d&&d.onCreated&&d.onCreated(t)})},value:f.current,onChange:function(t){i.onChange&&i.onChange(t.getHtml())}}))),r,function(){s.current=!0,t({document:e,window:n,wrap:r})})});(e=null==(e=null==u?void 0:u.current)?void 0:e.contentDocument).getElementById(editorId).innerHTML=i.value,r.current&&(r.current.style.height="".concat(e.documentElement.offsetHeight,"px")),t()})}return useImperativeHandle(c,function(){return{getEditor:function(){return m.current},getWangEditor:function(){var t;return null==(t=null==(t=null==u?void 0:u.current)?void 0:t.contentWindow)?void 0:t.wangEditor}}}),useLayoutEffect(function(){var t;function e(){return b()}null!=(t=null==u?void 0:u.current)&&t.addEventListener("load",e);var n=URL.createObjectURL(new Blob([ReactStr],{type:"text/javascript"})),r=URL.createObjectURL(new Blob([ReactDOMStr],{type:"text/javascript"})),o=URL.createObjectURL(new Blob([WangEditorStr],{type:"text/javascript"})),a=URL.createObjectURL(new Blob([WangEditorReactStr],{type:"text/javascript"})),c=URL.createObjectURL(new Blob(['\n        <!DOCTYPE html>\n        <head>\n          <meta charset="UTF-8" />\n          <title></title>\n          <style>\n            html, body {\n              margin: 0;\n              padding: 0;\n            }\n\n            html.editor {\n              width: 100%;\n              height: 100%;\n            }\n\n            html.editor > body {\n              width: 100%;\n              height: 100%;\n            }\n\n            html.editor > body > #'.concat(editorId," {\n              display: flex;\n              flex-direction: column;\n              width: 100%;\n              height: 100%;\n            }\n            \n            html > body > #").concat(editorId," > [data-w-e-toolbar=true] {\n              flex-shrink: 0;\n            }\n            \n            html > body > #").concat(editorId," > [data-w-e-textarea=true] {\n              flex-grow: 1;\n              min-height: 0;\n            }\n\n            ::-webkit-scrollbar-thumb {\n              background-color: rgba(0, 0, 0, 0.1);\n              border-radius: 4px;\n            }\n            *::-webkit-scrollbar-track {\n              background-color: rgba(0, 0, 0, 0.1);\n            }\n            ::-webkit-scrollbar {\n              width: 10px;\n              height: 10px;\n            }\n\n            ").concat(WangEditorCssStr,'\n          </style>\n          <script src="').concat(n,'"><\/script>\n          <script src="').concat(r,'"><\/script>\n          <script src="').concat(o,'"><\/script>\n          <script src="').concat(a,'"><\/script>\n        </head>\n        <html lang="en" class="').concat(classNames({editor:!("readOnly"in i&&i.readOnly)}),'">\n        <body>\n          <div id="').concat(editorId,'" style="').concat(l||"",'"></div>\n        </body>\n        </html>\n        ')],{type:"text/html"}));return u.current.src=c,function(){var t;null!=(t=null==u?void 0:u.current)&&t.removeEventListener("load",e),URL.revokeObjectURL(c),URL.revokeObjectURL(n),URL.revokeObjectURL(r),URL.revokeObjectURL(o),URL.revokeObjectURL(a)}},[]),useEffect(function(){return function(){null!==m.current&&(m.current.destroy(),m.current=null,b())}},[m]),useUpdateEffect(function(){f.current=i.value,s.current&&b().then(function(){})},[i.value]),useUpdateEffect(function(){s.current&&b().then(function(){})},[n,d]),React.createElement("div",{ref:r,className:classNames("".concat(selectorPrefix),e||""),style:t||{}},React.createElement("iframe",{ref:u,className:"".concat(selectorPrefix,"-frame")}))},WangEditorSandboxHOC=memo(forwardRef(WangEditorSandbox));WangEditorSandboxHOC.AntdFormRequireValidator=function(a,c){return{validator:function(t,e,n){var r,o;null!=(o=null==(r=null==a?void 0:a())?void 0:r.isEmpty)&&o.call(r)?n(c):n()}}};export default WangEditorSandboxHOC;
//# sourceMappingURL=wangEditorSandbox.js.map
