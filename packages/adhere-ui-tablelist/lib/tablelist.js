"use strict";require("core-js/modules/es.object.define-property.js"),require("core-js/modules/es.regexp.exec.js"),require("core-js/modules/es.string.search.js"),require("core-js/modules/es.array.includes.js"),require("core-js/modules/es.string.includes.js"),require("core-js/modules/es.array.filter.js"),require("core-js/modules/es.object.to-string.js"),require("core-js/modules/es.array.map.js"),Object.defineProperty(exports,"__esModule",{value:!0}),exports.selectorPrefix=void 0;var tslib_1=require("tslib"),antd_1=require("antd"),classnames_1=tslib_1.__importDefault(require("classnames")),lodash_1=require("lodash"),react_1=tslib_1.__importDefault(require("react")),adhere_ui_formitemcreator_1=tslib_1.__importDefault(require("@baifendian/adhere-ui-formitemcreator")),adhere_util_intl_1=tslib_1.__importDefault(require("@baifendian/adhere-util-intl")),sortabletable_1=tslib_1.__importDefault(require("./sortabletable")),tablelisttoolbar_1=require("./tablelisttoolbar"),util_1=tslib_1.__importDefault(require("./util")),defaultRowKey=(exports.selectorPrefix="adhere-ui-tablelist","id"),TableList=function(t){function e(e){var _=t.call(this,e)||this,e=(_.renderToolbar=function(){var e,t,r,a,o,l,n,s,i,c,u,d,f,m;if(_.props.toolbar)return e=(r=_.getModeProps()).dataSource,t=r.rowKey,r=r.pagination,a=(u=_.props.toolbar).className,o=u.title,l=u.total,n=u.selectAll,s=u.search,i=u.reload,c=u.setting,u=u.toolbarOptionRender,d=(f=_.state).selectedColumnKeys,f=f.tableColumns,m=_.getRowSelection(),react_1.default.createElement("div",{className:(0,classnames_1.default)(a,"".concat(exports.selectorPrefix,"-toolbar"))},react_1.default.createElement("div",{className:"".concat(exports.selectorPrefix,"-toolbar-left")},o?react_1.default.createElement("span",{className:"".concat(exports.selectorPrefix,"-toolbar-left-title")},o):null,l?react_1.default.createElement("span",{className:"".concat(exports.selectorPrefix,"-toolbar-left-total")},!0===l?adhere_util_intl_1.default.vHtml("共 <em>{n}</em> 条",{n:r&&r.total}):l):null,n?react_1.default.createElement(tablelisttoolbar_1.ToolbarSelectAll,{selectAll:n,dataSource:e,rowSelection:m,rowKey:t,setSelectAll:function(e){return _.setState({selectAll:e})}}):null),react_1.default.createElement("div",{className:"".concat(exports.selectorPrefix,"-toolbar-right")},u,s?react_1.default.createElement(adhere_ui_formitemcreator_1.default,{columns:_.getFormColumns(s||[],"default",!0)}):null,i?react_1.default.createElement(tablelisttoolbar_1.ToolbarReload,{reload:i,onSearch:_.onSearch}):null,c?react_1.default.createElement(tablelisttoolbar_1.ToolbarSetting,{setting:c,tableColumns:f,onSettingChange:_.onSettingChange,onSettingSortEnd:_.onSettingSortEnd,selectedColumnKeys:d}):null))},_.renderList=function(){var a,e,t,o,r,l;if(_.props.list)return r=_.getModeProps(),a=r.rowKey,e=r.pagination,t=r.loading,o=r.renderItem,r=tslib_1.__rest(r,["rowKey","pagination","loading","renderItem"]),l=_.getRowSelection(),react_1.default.createElement(antd_1.List,tslib_1.__assign({rowKey:a,pagination:_.getPagination(e),loading:_.getLoading(t),renderItem:function(t,e){var r="function"==typeof a?a(t):a;return react_1.default.createElement(antd_1.List.Item,null,react_1.default.createElement(react_1.default.Fragment,null,l?react_1.default.createElement(antd_1.Checkbox,{checked:l.selectedRowKeys.includes(t[r]),onChange:function(e){e.target.checked?(l.selectedRowKeys.push(t[r]),l.selectedRows.push(t),l.onChange(l.selectedRowKeys,l.selectedRows)):l.onChange(l.selectedRowKeys.filter(function(e){return e!==t[r]}),l.selectedRows.filter(function(e){return e[r]!==t[r]}))}}):null,o&&o(t,e)))}},r))},_.renderTable=function(){var t,e,r,a,o,l,n,s;if(_.props.table)return e=_.state,t=e.selectedColumnKeys,e=e.tableColumns,r=(n=_.getModeProps()).sortable,s=n.pagination,a=n.loading,o=n.dataSource,n.columns,l=n.rowKey,n.rowSelection,n=tslib_1.__rest(n,["sortable","pagination","loading","dataSource","columns","rowKey","rowSelection"]),s=tslib_1.__assign({pagination:_.getPagination(s),loading:_.getLoading(a),rowSelection:_.getRowSelection(),columns:e.filter(function(e){return t.includes(e.key)}),dataSource:o,onChange:_.onTableChange},n),r?react_1.default.createElement(sortabletable_1.default,tslib_1.__assign({ref:function(e){_.SortableTableRef=e},rowKey:l},s,{sortable:r})):react_1.default.createElement(antd_1.Table,tslib_1.__assign({rowKey:l},s))},new util_1.default(_)),e=(_.getModeProps=e.getModeProps,_.getDefaultSelectedColumnKeys=e.getDefaultSelectedColumnKeys,_.getFormColumns=e.getFormColumns,_.getSortDataSource=e.getSortDataSource,_.getParams=e.getParams,_.getRowSelection=e.getRowSelection,_.getPagination=e.getPagination,_.getLoading=e.getLoading,_.getTableColumns=e.getTableColumns,_.fetchList=e.fetchList,_.onSearch=e.onSearch,_.onResetSearch=e.onResetSearch,_.onSettingChange=e.onSettingChange,_.onSettingSortEnd=e.onSettingSortEnd,_.onTableChange=e.onTableChange,_.searchFormRef=react_1.default.createRef(),_.getModeProps());return _.state={firstLoading:!0,loading:!1,selectedColumnKeys:_.props.table?_.getDefaultSelectedColumnKeys(_.props.table.columns):[],tableColumns:[],params:{page:1,limit:e&&e.pagination&&e.pagination.defaultPageSize||10}},_}return tslib_1.__extends(e,t),e.getDerivedStateFromProps=function(e,t){var r=(e[e.mode||"table"]||{}).dataSource;return!e.request&&null!=t&&t.firstLoading&&r||e.request&&null!=t&&t.firstLoading&&null!=t&&t.firstRequest&&r?{firstLoading:!1}:null},e.prototype.componentDidMount=function(){var e=this,t=this.getModeProps();this.props.request?this.setState({firstRequest:!0},function(){return e.fetchList()}):t.dataSource&&this.setState({firstLoading:!1}),this.setState({tableColumns:this.getTableColumns()})},e.prototype.shouldComponentUpdate=function(e,r){var t,a=e[e.mode||"table"]||{},o=this.getModeProps();return!r.selectAll||JSON.stringify(a.dataSource)===JSON.stringify(o.dataSource)||(o=a.dataSource,a=a.rowKey,t=void 0===a?defaultRowKey:a,a=(o||[]).map(function(e){return e["function"==typeof t?t(e):t]}).filter(function(e){var t;return!(null!=(t=null==(t=r.selectAll)?void 0:t.exceptKeys)&&t.includes(e))}),"table"===e.mode&&e.table&&e.table.rowSelection&&e.table.rowSelection.onChange?e.table.rowSelection.onChange(a,(0,lodash_1.cloneDeep)(o)):this.setState({selectedRowKeys:a,selectedRows:o}),!1)},e.prototype.renderSearch=function(){var e,t,r,a,o,l,n,s,i=this,c=this.props.search;if(c)return e=c.className,t=c.beforeContent,r=c.afterContent,a=c.optionRender,o=c.columns,l=c.searchText,n=c.resetText,s=void 0===(s=c.size)?"middle":s,c?react_1.default.createElement("div",{className:(0,classnames_1.default)(e,"".concat(exports.selectorPrefix,"-search"))},t,react_1.default.createElement(antd_1.Form,{layout:"inline",ref:this.searchFormRef,className:(0,classnames_1.default)("".concat(exports.selectorPrefix,"-search-form"),((e={})["".concat(exports.selectorPrefix,"-search-form-havebefore")]=t,e["".concat(exports.selectorPrefix,"-search-form-haveafter")]=r,e))},react_1.default.createElement("div",{className:"ant-form-search"},react_1.default.createElement(adhere_ui_formitemcreator_1.default,{columns:this.getFormColumns(o||[],s,c.hasOwnProperty("optionRender")&&!a)})),c.hasOwnProperty("optionRender")?a:react_1.default.createElement("div",{className:"ant-form-btngroup"},react_1.default.createElement(antd_1.Button,{onClick:function(){return i.onResetSearch()},size:s},n||adhere_util_intl_1.default.v("重置")),react_1.default.createElement(antd_1.Button,{type:"primary",onClick:function(){return i.onSearch()},size:s},l||adhere_util_intl_1.default.v("搜索")))),r):null},e.prototype.renderContent=function(){var e=this.props.mode;return react_1.default.createElement("div",{className:"".concat(exports.selectorPrefix,"-content")},this.renderToolbar(),this.state.firstLoading?this.renderLoading():"list"===e?this.renderList():this.renderTable())},e.prototype.renderLoading=function(){return react_1.default.createElement(antd_1.Skeleton,{paragraph:{rows:10},title:!1})},e.prototype.render=function(){var t=this,e=this.props.className;return react_1.default.createElement("div",{className:(0,classnames_1.default)(exports.selectorPrefix,e),ref:function(e){t.TableListRef=e}},this.renderSearch(),this.renderContent())},e}(react_1.default.PureComponent);TableList.defaultProps={mode:"table"},exports.default=TableList;
//# sourceMappingURL=tablelist.js.map
