"use strict";var __extends=function(){var a=function(e,t){return(a=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)};return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),__assign=function(){return(__assign=Object.assign||function(e){for(var t,r=1,a=arguments.length;r<a;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},__rest=function(e,t){var r={};for(o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(r[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var a=0,o=Object.getOwnPropertySymbols(e);a<o.length;a++)t.indexOf(o[a])<0&&Object.prototype.propertyIsEnumerable.call(e,o[a])&&(r[o[a]]=e[o[a]]);return r},__importDefault=function(e){return e&&e.__esModule?e:{default:e}},antd_1=(Object.defineProperty(exports,"__esModule",{value:!0}),exports.selectorPrefix=void 0,require("antd")),classnames_1=__importDefault(require("classnames")),lodash_1=require("lodash"),react_1=__importDefault(require("react")),adhere_ui_formitemcreator_1=__importDefault(require("@baifendian/adhere-ui-formitemcreator")),adhere_util_intl_1=__importDefault(require("@baifendian/adhere-util-intl")),sortabletable_1=__importDefault(require("./sortabletable")),tablelisttoolbar_1=require("./tablelisttoolbar"),util_1=__importDefault(require("./util")),defaultRowKey=(exports.selectorPrefix="adhere-ui-tablelist","id"),TableList=function(t){function e(e){var m=t.call(this,e)||this,e=(m.renderToolbar=function(){var e,t,r,a,o,n,l,s,i,c,u,d,f,p;if(m.props.toolbar)return e=(r=m.getModeProps()).dataSource,t=r.rowKey,r=r.pagination,a=(u=m.props.toolbar).className,o=u.title,n=u.total,l=u.selectAll,s=u.search,i=u.reload,c=u.setting,u=u.toolbarOptionRender,d=(f=m.state).selectedColumnKeys,f=f.tableColumns,p=m.getRowSelection(),react_1.default.createElement("div",{className:(0,classnames_1.default)(a,"".concat(exports.selectorPrefix,"-toolbar"))},react_1.default.createElement("div",{className:"".concat(exports.selectorPrefix,"-toolbar-left")},o?react_1.default.createElement("span",{className:"".concat(exports.selectorPrefix,"-toolbar-left-title")},o):null,n?react_1.default.createElement("span",{className:"".concat(exports.selectorPrefix,"-toolbar-left-total")},!0===n?adhere_util_intl_1.default.vHtml("共 <em>{n}</em> 条",{n:r&&r.total}):n):null,l?react_1.default.createElement(tablelisttoolbar_1.ToolbarSelectAll,{selectAll:l,dataSource:e,rowSelection:p,rowKey:t,setSelectAll:function(e){return m.setState({selectAll:e})}}):null),react_1.default.createElement("div",{className:"".concat(exports.selectorPrefix,"-toolbar-right")},u,s?react_1.default.createElement(adhere_ui_formitemcreator_1.default,{columns:m.getFormColumns(s||[],"default",!0)}):null,i?react_1.default.createElement(tablelisttoolbar_1.ToolbarReload,{reload:i,onSearch:m.onSearch}):null,c?react_1.default.createElement(tablelisttoolbar_1.ToolbarSetting,{setting:c,tableColumns:f,onSettingChange:m.onSettingChange,onSettingSortEnd:m.onSettingSortEnd,selectedColumnKeys:d}):null))},m.renderList=function(){var a,e,t,o,r,n;if(m.props.list)return r=m.getModeProps(),a=r.rowKey,e=r.pagination,t=r.loading,o=r.renderItem,r=__rest(r,["rowKey","pagination","loading","renderItem"]),n=m.getRowSelection(),react_1.default.createElement(antd_1.List,__assign({rowKey:a,pagination:m.getPagination(e),loading:m.getLoading(t),renderItem:function(t,e){var r="function"==typeof a?a(t):a;return react_1.default.createElement(antd_1.List.Item,null,react_1.default.createElement(react_1.default.Fragment,null,n?react_1.default.createElement(antd_1.Checkbox,{checked:n.selectedRowKeys.includes(t[r]),onChange:function(e){e.target.checked?(n.selectedRowKeys.push(t[r]),n.selectedRows.push(t),n.onChange(n.selectedRowKeys,n.selectedRows)):n.onChange(n.selectedRowKeys.filter(function(e){return e!==t[r]}),n.selectedRows.filter(function(e){return e[r]!==t[r]}))}}):null,o&&o(t,e)))}},r))},m.renderTable=function(){var t,e,r,a,o,n,l,s;if(m.props.table)return e=m.state,t=e.selectedColumnKeys,e=e.tableColumns,r=(l=m.getModeProps()).sortable,s=l.pagination,a=l.loading,o=l.dataSource,l.columns,n=l.rowKey,l.rowSelection,l=__rest(l,["sortable","pagination","loading","dataSource","columns","rowKey","rowSelection"]),s=__assign({pagination:m.getPagination(s),loading:m.getLoading(a),rowSelection:m.getRowSelection(),columns:e.filter(function(e){return t.includes(e.key)}),dataSource:o,onChange:m.onTableChange},l),r?react_1.default.createElement(sortabletable_1.default,__assign({ref:function(e){m.SortableTableRef=e},rowKey:n},s,{sortable:r})):react_1.default.createElement(antd_1.Table,__assign({rowKey:n},s))},new util_1.default(m)),e=(m.getModeProps=e.getModeProps,m.getDefaultSelectedColumnKeys=e.getDefaultSelectedColumnKeys,m.getFormColumns=e.getFormColumns,m.getSortDataSource=e.getSortDataSource,m.getParams=e.getParams,m.getRowSelection=e.getRowSelection,m.getPagination=e.getPagination,m.getLoading=e.getLoading,m.getTableColumns=e.getTableColumns,m.fetchList=e.fetchList,m.onSearch=e.onSearch,m.onResetSearch=e.onResetSearch,m.onSettingChange=e.onSettingChange,m.onSettingSortEnd=e.onSettingSortEnd,m.onTableChange=e.onTableChange,m.searchFormRef=react_1.default.createRef(),m.getModeProps());return m.state={firstLoading:!0,loading:!1,selectedColumnKeys:m.props.table?m.getDefaultSelectedColumnKeys(m.props.table.columns):[],tableColumns:[],params:{page:1,limit:e&&e.pagination&&e.pagination.defaultPageSize||10}},m}return __extends(e,t),e.getDerivedStateFromProps=function(e,t){var r=(e[e.mode||"table"]||{}).dataSource;return!e.request&&null!=t&&t.firstLoading&&r||e.request&&null!=t&&t.firstLoading&&null!=t&&t.firstRequest&&r?{firstLoading:!1}:null},e.prototype.componentDidMount=function(){var e=this,t=this.getModeProps();this.props.request?this.setState({firstRequest:!0},function(){return e.fetchList()}):t.dataSource&&this.setState({firstLoading:!1}),this.setState({tableColumns:this.getTableColumns()})},e.prototype.shouldComponentUpdate=function(e,r){var t,a=e[e.mode||"table"]||{},o=this.getModeProps();return!r.selectAll||JSON.stringify(a.dataSource)===JSON.stringify(o.dataSource)||(o=a.dataSource,a=a.rowKey,t=void 0===a?defaultRowKey:a,a=(o||[]).map(function(e){return e["function"==typeof t?t(e):t]}).filter(function(e){var t;return!(null!=(t=null==(t=r.selectAll)?void 0:t.exceptKeys)&&t.includes(e))}),"table"===e.mode&&e.table&&e.table.rowSelection&&e.table.rowSelection.onChange?e.table.rowSelection.onChange(a,(0,lodash_1.cloneDeep)(o)):this.setState({selectedRowKeys:a,selectedRows:o}),!1)},e.prototype.renderSearch=function(){var e,t,r,a,o,n,l,s,i=this,c=this.props.search;if(c)return e=c.className,t=c.beforeContent,r=c.afterContent,a=c.optionRender,o=c.columns,n=c.searchText,l=c.resetText,s=void 0===(s=c.size)?"middle":s,c?react_1.default.createElement("div",{className:(0,classnames_1.default)(e,"".concat(exports.selectorPrefix,"-search"))},t,react_1.default.createElement(antd_1.Form,{layout:"inline",ref:this.searchFormRef,className:(0,classnames_1.default)("".concat(exports.selectorPrefix,"-search-form"),((e={})["".concat(exports.selectorPrefix,"-search-form-havebefore")]=t,e["".concat(exports.selectorPrefix,"-search-form-haveafter")]=r,e))},react_1.default.createElement("div",{className:"ant-form-search"},react_1.default.createElement(adhere_ui_formitemcreator_1.default,{columns:this.getFormColumns(o||[],s,c.hasOwnProperty("optionRender")&&!a)})),c.hasOwnProperty("optionRender")?a:react_1.default.createElement("div",{className:"ant-form-btngroup"},react_1.default.createElement(antd_1.Button,{onClick:function(){return i.onResetSearch()},size:s},l||adhere_util_intl_1.default.v("重置")),react_1.default.createElement(antd_1.Button,{type:"primary",onClick:function(){return i.onSearch()},size:s},n||adhere_util_intl_1.default.v("搜索")))),r):null},e.prototype.renderContent=function(){var e=this.props.mode;return react_1.default.createElement("div",{className:"".concat(exports.selectorPrefix,"-content")},this.renderToolbar(),this.state.firstLoading?this.renderLoading():"list"===e?this.renderList():this.renderTable())},e.prototype.renderLoading=function(){return react_1.default.createElement(antd_1.Skeleton,{paragraph:{rows:10},title:!1})},e.prototype.render=function(){var t=this,e=this.props.className;return react_1.default.createElement("div",{className:(0,classnames_1.default)(exports.selectorPrefix,e),ref:function(e){t.TableListRef=e}},this.renderSearch(),this.renderContent())},e}(react_1.default.PureComponent);TableList.defaultProps={mode:"table"},exports.default=TableList;
//# sourceMappingURL=tablelist.js.map
