"use strict";var __extends=this&&this.__extends||function(){var a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};return function(e,t){function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,r=1,a=arguments.length;r<a;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},__rest=this&&this.__rest||function(e,t){var r={};for(o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(r[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var a=0,o=Object.getOwnPropertySymbols(e);a<o.length;a++)t.indexOf(o[a])<0&&Object.prototype.propertyIsEnumerable.call(e,o[a])&&(r[o[a]]=e[o[a]]);return r},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var react_1=__importDefault(require("react")),classnames_1=__importDefault(require("classnames")),antd_1=require("antd"),adhere_ui_formitemcreator_1=__importDefault(require("@baifendian/adhere-ui-formitemcreator")),adhere_util_intl_1=__importDefault(require("@baifendian/adhere-util-intl")),lodash_1=require("lodash"),sortabletable_1=__importDefault(require("./sortabletable")),tablelisttoolbar_1=require("./tablelisttoolbar"),util_1=__importDefault(require("./util")),selectorPrefix="adhere-ui-tablelist",defaultRowKey="id",TableList=function(t){function e(e){var m=t.call(this,e)||this;m.renderToolbar=function(){if(m.props.toolbar){var e=m.getModeProps(),t=e.dataSource,r=e.rowKey,a=e.pagination,o=m.props.toolbar,n=o.className,l=o.title,i=o.total,s=o.selectAll,c=o.search,u=o.reload,d=o.setting,f=o.toolbarOptionRender,_=m.state,e=_.selectedColumnKeys,o=_.tableColumns,_=m.getRowSelection();return react_1.default.createElement("div",{className:classnames_1.default(n,selectorPrefix+"-toolbar")},react_1.default.createElement("div",{className:selectorPrefix+"-toolbar-left"},l?react_1.default.createElement("span",{className:selectorPrefix+"-toolbar-left-title"},l):null,i?react_1.default.createElement("span",{className:selectorPrefix+"-toolbar-left-total"},!0===i?adhere_util_intl_1.default.vHtml("共 <em>{n}</em> 条",{n:a&&a.total}):i):null,s?react_1.default.createElement(tablelisttoolbar_1.ToolbarSelectAll,{selectAll:s,dataSource:t,rowSelection:_,rowKey:r,setSelectAll:function(e){return m.setState({selectAll:e})}}):null),react_1.default.createElement("div",{className:selectorPrefix+"-toolbar-right"},f,c?react_1.default.createElement(adhere_ui_formitemcreator_1.default,{columns:m.getFormColumns(c||[],"default",!0)}):null,u?react_1.default.createElement(tablelisttoolbar_1.ToolbarReload,{reload:u,onSearch:m.onSearch}):null,d?react_1.default.createElement(tablelisttoolbar_1.ToolbarSetting,{setting:d,tableColumns:o,onSettingChange:m.onSettingChange,onSettingSortEnd:m.onSettingSortEnd,selectedColumnKeys:e}):null))}},m.renderList=function(){if(m.props.list){var e=m.getModeProps(),a=e.rowKey,t=e.pagination,r=e.loading,o=e.renderItem,e=__rest(e,["rowKey","pagination","loading","renderItem"]),n=m.getRowSelection();return react_1.default.createElement(antd_1.List,__assign({rowKey:a,pagination:m.getPagination(t),loading:m.getLoading(r),renderItem:function(t,e){var r="function"==typeof a?a(t):a;return react_1.default.createElement(antd_1.List.Item,null,react_1.default.createElement(react_1.default.Fragment,null,n?react_1.default.createElement(antd_1.Checkbox,{checked:n.selectedRowKeys.includes(t[r]),onChange:function(e){e.target.checked?(n.selectedRowKeys.push(t[r]),n.selectedRows.push(t),n.onChange(n.selectedRowKeys,n.selectedRows)):n.onChange(n.selectedRowKeys.filter(function(e){return e!==t[r]}),n.selectedRows.filter(function(e){return e[r]!==t[r]}))}}):null,o&&o(t,e)))}},e))}},m.renderTable=function(){if(m.props.table){var e=m.state,t=e.selectedColumnKeys,r=e.tableColumns,a=m.getModeProps(),o=a.sortable,n=a.pagination,l=a.loading,i=a.dataSource,e=(a.columns,a.rowKey),a=(a.rowSelection,__rest(a,["sortable","pagination","loading","dataSource","columns","rowKey","rowSelection"])),a=__assign({pagination:m.getPagination(n),loading:m.getLoading(l),rowSelection:m.getRowSelection(),columns:r.filter(function(e){return t.includes(e.key)}),dataSource:i,onChange:m.onTableChange},a);return o?react_1.default.createElement(sortabletable_1.default,__assign({ref:function(e){m.SortableTableRef=e},rowKey:e},a,{sortable:o})):react_1.default.createElement(antd_1.Table,__assign({rowKey:e},a))}};e=new util_1.default(m);m.getModeProps=e.getModeProps,m.getDefaultSelectedColumnKeys=e.getDefaultSelectedColumnKeys,m.getFormColumns=e.getFormColumns,m.getSortDataSource=e.getSortDataSource,m.getParams=e.getParams,m.getRowSelection=e.getRowSelection,m.getPagination=e.getPagination,m.getLoading=e.getLoading,m.getTableColumns=e.getTableColumns,m.fetchList=e.fetchList,m.onSearch=e.onSearch,m.onResetSearch=e.onResetSearch,m.onSettingChange=e.onSettingChange,m.onSettingSortEnd=e.onSettingSortEnd,m.onTableChange=e.onTableChange,m.searchFormRef=react_1.default.createRef();e=m.getModeProps();return m.state={firstLoading:!0,loading:!1,selectedColumnKeys:m.props.table?m.getDefaultSelectedColumnKeys(m.props.table.columns):[],tableColumns:[],params:{page:1,limit:e&&e.pagination&&e.pagination.defaultPageSize||10}},m}return __extends(e,t),e.getDerivedStateFromProps=function(e,t){var r=(e[e.mode||"table"]||{}).dataSource;return!e.request&&null!=t&&t.firstLoading&&r||e.request&&null!=t&&t.firstLoading&&null!=t&&t.firstRequest&&r?{firstLoading:!1}:null},e.prototype.componentDidMount=function(){var e=this,t=this.getModeProps();this.props.request?this.setState({firstRequest:!0},function(){return e.fetchList()}):t.dataSource&&this.setState({firstLoading:!1}),this.setState({tableColumns:this.getTableColumns()})},e.prototype.shouldComponentUpdate=function(e,r){var t=e[e.mode||"table"]||{},a=this.getModeProps();if(r.selectAll&&JSON.stringify(t.dataSource)!==JSON.stringify(a.dataSource)){var a=t.dataSource,t=t.rowKey,o=void 0===t?defaultRowKey:t,t=(a||[]).map(function(e){return e["function"==typeof o?o(e):o]}).filter(function(e){var t;return!(null!==(t=null===(t=r.selectAll)||void 0===t?void 0:t.exceptKeys)&&void 0!==t&&t.includes(e))});return"table"===e.mode&&e.table&&e.table.rowSelection&&e.table.rowSelection.onChange?(e.table.rowSelection.onChange(t,lodash_1.cloneDeep(a)),!1):(this.setState({selectedRowKeys:t,selectedRows:a}),!1)}return!0},e.prototype.renderSearch=function(){var e=this,t=this.props.search;if(t){var r=t.className,a=t.beforeContent,o=t.afterContent,n=t.optionRender,l=t.columns,i=t.searchText,s=t.resetText,c=t.size,c=void 0===c?"middle":c;return t?react_1.default.createElement("div",{className:classnames_1.default(r,selectorPrefix+"-search")},a,react_1.default.createElement(antd_1.Form,{layout:"inline",ref:this.searchFormRef,className:classnames_1.default(selectorPrefix+"-search-form",((r={})[selectorPrefix+"-search-form-havebefore"]=a,r[selectorPrefix+"-search-form-haveafter"]=o,r))},react_1.default.createElement("div",{className:"ant-form-search"},react_1.default.createElement(adhere_ui_formitemcreator_1.default,{columns:this.getFormColumns(l||[],c,t.hasOwnProperty("optionRender")&&!n)})),t.hasOwnProperty("optionRender")?n:react_1.default.createElement("div",{className:"ant-form-btngroup"},react_1.default.createElement(antd_1.Button,{onClick:function(){return e.onResetSearch()},size:c},s||adhere_util_intl_1.default.v("重置")),react_1.default.createElement(antd_1.Button,{type:"primary",onClick:function(){return e.onSearch()},size:c},i||adhere_util_intl_1.default.v("搜索")))),o):null}},e.prototype.renderContent=function(){var e=this.props.mode;return react_1.default.createElement("div",{className:selectorPrefix+"-content"},this.renderToolbar(),this.state.firstLoading?this.renderLoading():"list"===e?this.renderList():this.renderTable())},e.prototype.renderLoading=function(){return react_1.default.createElement(antd_1.Skeleton,{paragraph:{rows:10},title:!1})},e.prototype.render=function(){var t=this,e=this.props.className;return react_1.default.createElement("div",{className:classnames_1.default(selectorPrefix,e),ref:function(e){t.TableListRef=e}},this.renderSearch(),this.renderContent())},e}(react_1.default.Component);TableList.defaultProps={mode:"table"},exports.default=TableList;
//# sourceMappingURL=tablelist.js.map
