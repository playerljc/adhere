"use strict";require("core-js/modules/es.object.define-property.js");var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _skeleton=_interopRequireDefault(require("antd/lib/skeleton")),_button=_interopRequireDefault(require("antd/lib/button")),_form=_interopRequireDefault(require("antd/lib/form")),_table=_interopRequireDefault(require("antd/lib/table")),_checkbox=_interopRequireDefault(require("antd/lib/checkbox")),_list=_interopRequireDefault(require("antd/lib/list"));require("core-js/modules/es.regexp.exec.js"),require("core-js/modules/es.string.search.js"),require("core-js/modules/es.array.includes.js"),require("core-js/modules/es.string.includes.js"),require("core-js/modules/es.array.filter.js"),require("core-js/modules/es.object.to-string.js"),require("core-js/modules/es.array.map.js");var _tslib=require("tslib"),_react=_interopRequireDefault(require("react")),_classnames=_interopRequireDefault(require("classnames")),_adhereUiFormitemcreator=_interopRequireDefault(require("@baifendian/adhere-ui-formitemcreator")),_adhereUtilIntl=_interopRequireDefault(require("@baifendian/adhere-util-intl")),_lodash=require("lodash"),_sortabletable=_interopRequireDefault(require("./sortabletable")),_tablelisttoolbar=require("./tablelisttoolbar"),_util=_interopRequireDefault(require("./util")),selectorPrefix="adhere-ui-tablelist",defaultRowKey="id",TableList=function(t){function e(e){var g=t.call(this,e)||this;g.renderToolbar=function(){if(g.props.toolbar){var e=g.getModeProps(),t=e.dataSource,r=e.rowKey,a=e.pagination,o=g.props.toolbar,l=o.className,n=o.title,i=o.total,s=o.selectAll,c=o.search,u=o.reload,d=o.setting,f=o.toolbarOptionRender,m=g.state,e=m.selectedColumnKeys,o=m.tableColumns,m=g.getRowSelection();return _react.default.createElement("div",{className:(0,_classnames.default)(l,"".concat(selectorPrefix,"-toolbar"))},_react.default.createElement("div",{className:"".concat(selectorPrefix,"-toolbar-left")},n?_react.default.createElement("span",{className:"".concat(selectorPrefix,"-toolbar-left-title")},n):null,i?_react.default.createElement("span",{className:"".concat(selectorPrefix,"-toolbar-left-total")},!0===i?_adhereUtilIntl.default.vHtml("共 <em>{n}</em> 条",{n:a&&a.total}):i):null,s?_react.default.createElement(_tablelisttoolbar.ToolbarSelectAll,{selectAll:s,dataSource:t,rowSelection:m,rowKey:r,setSelectAll:function(e){return g.setState({selectAll:e})}}):null),_react.default.createElement("div",{className:"".concat(selectorPrefix,"-toolbar-right")},f,c?_react.default.createElement(_adhereUiFormitemcreator.default,{columns:g.getFormColumns(c||[],"default",!0)}):null,u?_react.default.createElement(_tablelisttoolbar.ToolbarReload,{reload:u,onSearch:g.onSearch}):null,d?_react.default.createElement(_tablelisttoolbar.ToolbarSetting,{setting:d,tableColumns:o,onSettingChange:g.onSettingChange,onSettingSortEnd:g.onSettingSortEnd,selectedColumnKeys:e}):null))}},g.renderList=function(){if(g.props.list){var e=g.getModeProps(),a=e.rowKey,t=e.pagination,r=e.loading,o=e.renderItem,e=(0,_tslib.__rest)(e,["rowKey","pagination","loading","renderItem"]),l=g.getRowSelection();return _react.default.createElement(_list.default,(0,_tslib.__assign)({rowKey:a,pagination:g.getPagination(t),loading:g.getLoading(r),renderItem:function(t,e){var r="function"==typeof a?a(t):a;return _react.default.createElement(_list.default.Item,null,_react.default.createElement(_react.default.Fragment,null,l?_react.default.createElement(_checkbox.default,{checked:l.selectedRowKeys.includes(t[r]),onChange:function(e){e.target.checked?(l.selectedRowKeys.push(t[r]),l.selectedRows.push(t),l.onChange(l.selectedRowKeys,l.selectedRows)):l.onChange(l.selectedRowKeys.filter(function(e){return e!==t[r]}),l.selectedRows.filter(function(e){return e[r]!==t[r]}))}}):null,o&&o(t,e)))}},e))}},g.renderTable=function(){if(g.props.table){var e=g.state,t=e.selectedColumnKeys,r=e.tableColumns,a=g.getModeProps(),o=a.sortable,l=a.pagination,n=a.loading,i=a.dataSource,e=(a.columns,a.rowKey),a=(a.rowSelection,(0,_tslib.__rest)(a,["sortable","pagination","loading","dataSource","columns","rowKey","rowSelection"])),a=(0,_tslib.__assign)({pagination:g.getPagination(l),loading:g.getLoading(n),rowSelection:g.getRowSelection(),columns:r.filter(function(e){return t.includes(e.key)}),dataSource:i,onChange:g.onTableChange},a);return o?_react.default.createElement(_sortabletable.default,(0,_tslib.__assign)({ref:function(e){g.SortableTableRef=e},rowKey:e},a,{sortable:o})):_react.default.createElement(_table.default,(0,_tslib.__assign)({rowKey:e},a))}};e=new _util.default(g);g.getModeProps=e.getModeProps,g.getDefaultSelectedColumnKeys=e.getDefaultSelectedColumnKeys,g.getFormColumns=e.getFormColumns,g.getSortDataSource=e.getSortDataSource,g.getParams=e.getParams,g.getRowSelection=e.getRowSelection,g.getPagination=e.getPagination,g.getLoading=e.getLoading,g.getTableColumns=e.getTableColumns,g.fetchList=e.fetchList,g.onSearch=e.onSearch,g.onResetSearch=e.onResetSearch,g.onSettingChange=e.onSettingChange,g.onSettingSortEnd=e.onSettingSortEnd,g.onTableChange=e.onTableChange,g.searchFormRef=_react.default.createRef();e=g.getModeProps();return g.state={firstLoading:!0,loading:!1,selectedColumnKeys:g.props.table?g.getDefaultSelectedColumnKeys(g.props.table.columns):[],tableColumns:[],params:{page:1,limit:e&&e.pagination&&e.pagination.defaultPageSize||10}},g}return(0,_tslib.__extends)(e,t),e.getDerivedStateFromProps=function(e,t){var r=(e[e.mode||"table"]||{}).dataSource;return!e.request&&null!=t&&t.firstLoading&&r||e.request&&null!=t&&t.firstLoading&&null!=t&&t.firstRequest&&r?{firstLoading:!1}:null},e.prototype.componentDidMount=function(){var e=this,t=this.getModeProps();this.props.request?this.setState({firstRequest:!0},function(){return e.fetchList()}):t.dataSource&&this.setState({firstLoading:!1}),this.setState({tableColumns:this.getTableColumns()})},e.prototype.shouldComponentUpdate=function(e,r){var t=e[e.mode||"table"]||{},a=this.getModeProps();if(r.selectAll&&JSON.stringify(t.dataSource)!==JSON.stringify(a.dataSource)){var a=t.dataSource,t=t.rowKey,o=void 0===t?defaultRowKey:t,t=(a||[]).map(function(e){return e["function"==typeof o?o(e):o]}).filter(function(e){var t;return!(null!==(t=null===(t=r.selectAll)||void 0===t?void 0:t.exceptKeys)&&void 0!==t&&t.includes(e))});return"table"===e.mode&&e.table&&e.table.rowSelection&&e.table.rowSelection.onChange?(e.table.rowSelection.onChange(t,(0,_lodash.cloneDeep)(a)),!1):(this.setState({selectedRowKeys:t,selectedRows:a}),!1)}return!0},e.prototype.renderSearch=function(){var e=this,t=this.props.search;if(t){var r=t.className,a=t.beforeContent,o=t.afterContent,l=t.optionRender,n=t.columns,i=t.searchText,s=t.resetText,c=t.size,c=void 0===c?"middle":c;return t?_react.default.createElement("div",{className:(0,_classnames.default)(r,"".concat(selectorPrefix,"-search"))},a,_react.default.createElement(_form.default,{layout:"inline",ref:this.searchFormRef,className:(0,_classnames.default)("".concat(selectorPrefix,"-search-form"),((r={})["".concat(selectorPrefix,"-search-form-havebefore")]=a,r["".concat(selectorPrefix,"-search-form-haveafter")]=o,r))},_react.default.createElement("div",{className:"ant-form-search"},_react.default.createElement(_adhereUiFormitemcreator.default,{columns:this.getFormColumns(n||[],c,t.hasOwnProperty("optionRender")&&!l)})),t.hasOwnProperty("optionRender")?l:_react.default.createElement("div",{className:"ant-form-btngroup"},_react.default.createElement(_button.default,{onClick:function(){return e.onResetSearch()},size:c},s||_adhereUtilIntl.default.v("重置")),_react.default.createElement(_button.default,{type:"primary",onClick:function(){return e.onSearch()},size:c},i||_adhereUtilIntl.default.v("搜索")))),o):null}},e.prototype.renderContent=function(){var e=this.props.mode;return _react.default.createElement("div",{className:"".concat(selectorPrefix,"-content")},this.renderToolbar(),this.state.firstLoading?this.renderLoading():"list"===e?this.renderList():this.renderTable())},e.prototype.renderLoading=function(){return _react.default.createElement(_skeleton.default,{paragraph:{rows:10},title:!1})},e.prototype.render=function(){var t=this,e=this.props.className;return _react.default.createElement("div",{className:(0,_classnames.default)(selectorPrefix,e),ref:function(e){t.TableListRef=e}},this.renderSearch(),this.renderContent())},e}(_react.default.Component);TableList.defaultProps={mode:"table"};var _default=TableList;exports.default=_default;
//# sourceMappingURL=tablelist.js.map
