"use strict";require("core-js/modules/es.object.define-property.js"),require("core-js/modules/es.array.map.js"),require("core-js/modules/es.array.filter.js"),require("core-js/modules/es.object.to-string.js"),require("core-js/modules/es.array.includes.js"),require("core-js/modules/es.string.includes.js"),require("core-js/modules/es.array.concat.js"),require("core-js/modules/es.array.find.js"),require("core-js/modules/es.regexp.to-string.js"),require("core-js/modules/es.array.splice.js"),require("core-js/modules/es.regexp.exec.js"),require("core-js/modules/es.string.replace.js"),Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),react_1=tslib_1.__importDefault(require("react")),antd_1=require("antd"),lodash_1=require("lodash"),moment_1=tslib_1.__importDefault(require("moment")),adhere_ui_formitemcreator_1=tslib_1.__importDefault(require("@baifendian/adhere-ui-formitemcreator")),adhere_util_intl_1=tslib_1.__importDefault(require("@baifendian/adhere-util-intl")),Util=function(e){var a=this;this.getModeProps=function(){return tslib_1.__assign({rowKey:"id"},a.ins.props[a.ins.props.mode||"table"])},this.getDefaultSelectedColumnKeys=function(e){var t=a.getModeProps().showNumber,e=(e||[]).filter(function(e){return e.show||!e.hasOwnProperty("show")}).map(function(e){return e.key});return t&&!e.includes("xuhao")&&e.unshift((null==t?void 0:t.key)||"xuhao"),e},this.getRowSelection=function(){var e=a.ins.state,t=e.selectedRowKeys,s=void 0===t?[]:t,n=e.selectedRows,t=void 0===n?[]:n,n=e.selectAll,e=a.getModeProps().rowSelection;return e?tslib_1.__assign(tslib_1.__assign({clearOnChange:!1},e),{onChange:a.onSelectChange,selectedRowKeys:e.selectedRowKeys||s,selectedRows:t,selectAll:n}):null},this.getSortDataSource=function(){return a.ins.SortableTableRef.state.dataSource},this.getParams=function(){var e=a.ins.props.params,t={};return a.ins.searchFormRef&&a.ins.searchFormRef.current&&(t=a.ins.searchFormRef.current.getFieldsValue()),tslib_1.__assign(tslib_1.__assign(tslib_1.__assign({},t),a.ins.state.params),e)},this.getFormColumns=function(e,t,n){return e.map(function(e){var s=e;return s.contentProps=s.contentProps||{},s.contentProps.size=t,s.type!==adhere_ui_formitemcreator_1.default.RANGEPICKER&&s.type!==adhere_ui_formitemcreator_1.default.SELECT||(s.contentProps=tslib_1.__assign({getPopupContainer:function(){return a.ins.TableListRef}},s.contentProps)),s.type===adhere_ui_formitemcreator_1.default.SELECT&&(s.contentProps=tslib_1.__assign({style:{width:"150px"},allowClear:!0},s.contentProps)),n&&(s.contentProps=tslib_1.__assign({onSearch:s.type===adhere_ui_formitemcreator_1.default.SEARCH?function(e){var t;return a.onSearch(((t={})[s.name]=e,t))}:null,onPressEnter:s.type!==adhere_ui_formitemcreator_1.default.SEARCH?function(e){var t;return a.onSearch(((t={})[s.name]=[adhere_ui_formitemcreator_1.default.INPUT,adhere_ui_formitemcreator_1.default.TEXTAREA,adhere_ui_formitemcreator_1.default.NUMBER].includes(s.type)?e.target.value:e,t))}:null},s.contentProps)),s})},this.getPagination=function(e){var t=a.ins.state.params;return tslib_1.__assign({size:"default",defaultPageSize:10,current:t.page,pageSize:t.limit,showSizeChanger:!0,pageSizeOptions:["10","20","50"],showQuickJumper:!0,showTotal:function(e,t){var s=t[0],t=t[1];return"当前 ".concat(s,"-").concat(t,"/共 ").concat(e," 条")},onChange:a.onPageChange,onShowSizeChange:a.onPageChange},e)},this.getTableColumns=function(){var n=a.ins.state.params,e=a.getModeProps(),t=e.columns,e=e.showNumber,t=(t||[]).map(function(r){var e;return tslib_1.__assign(tslib_1.__assign({},r),{render:function(t,e,s){var n="";return n=r.render?r.render(t,e,s):"date"===r.valueType?t?(0,moment_1.default)(t).format("L"):"-":"datetime"===r.valueType?t?(0,moment_1.default)(t).format("LLL"):"-":"map"===r.valueType&&r.map?(s=t&&(r.map||[]).find(function(e){return e.value.toString()===t.toString()}),t&&s?s.label:"-"):t,null!=r&&r.ellipsis?react_1.default.createElement(antd_1.Tooltip,{title:n,placement:"topLeft"},n):n},filtered:(null===(e=r.filters)||void 0===e?void 0:e.length)&&n[r.key]})});return e&&!t.find(function(e){return"xuhao"===e.key})&&t.unshift(tslib_1.__assign({title:adhere_util_intl_1.default.v("序号"),dataIndex:"xuhao",key:"xuhao",width:80,render:function(e,t,s){return(n.page-1)*n.limit+s+1}},e)),t},this.getLoading=function(e){return!(!e&&!a.ins.state.loading)&&(e&&e.hasOwnProperty("size")?e:{size:"large"})},this.fetchList=function(e){e=tslib_1.__assign(tslib_1.__assign({},a.getParams()),e);a.ins.props.request&&(a.ins.setState({loading:!0}),a.ins.props.request(e).then(function(){a.ins.setState({loading:!1})}))},this.onSearch=function(e){var t=a.ins.state.params,s=a.getRowSelection();s&&!s.selectAll&&s.clearOnChange&&s.onChange([],[]),a.ins.setState({params:tslib_1.__assign(tslib_1.__assign(tslib_1.__assign({},t),e),{page:1})},function(){a.fetchList()})},this.onResetSearch=function(){var e=a.ins.state.params,t=a.getRowSelection();a.ins.searchFormRef&&a.ins.searchFormRef.current&&a.ins.searchFormRef.current.resetFields(),e.page=1,t&&t.onChange([],[]),a.ins.setState({params:e},function(){a.fetchList()})},this.onSettingChange=function(e){a.ins.setState({selectedColumnKeys:e})},this.onSettingSortEnd=function(e){var s=e.oldIndex,t=e.newIndex,n=a.ins.state.tableColumns;s!==t&&(e=n[s],(n=n.filter(function(e,t){return t!==s})).splice(t,0,e),a.ins.setState({tableColumns:n}))},this.onTableChange=function(e,t,s){var n;if(!(0,lodash_1.isEmpty)(s)||!(0,lodash_1.isEmpty)(t)){var r,i=tslib_1.__assign(tslib_1.__assign({},a.ins.state.params),{order:null===(n=null==s?void 0:s.order)||void 0===n?void 0:n.replace("end",""),sidx:null==s?void 0:s.field});for(r in t)i[r]=t[r].join(","),i.page=1;s=a.getRowSelection();s&&!s.selectAll&&s.clearOnChange&&s.onChange([],[]),a.ins.setState({params:i},function(){return a.fetchList()})}},this.onSelectChange=function(e,t){var s=a.getModeProps(),n=s.dataSource,r=s.rowKey,i=s.rowSelection,s=a.ins.state.selectAll;a.ins.state.selectAll&&(n=n.map(function(e){return e[r]}),n=(0,lodash_1.union)(s.exceptKeys||[],(0,lodash_1.difference)(n,e)),a.ins.setState({selectAll:!n.length||{exceptKeys:n}})),null!=i&&i.onChange?i.onChange(e,t):a.ins.setState({selectedRowKeys:e,selectedRows:t})},this.onPageChange=function(e,t){var s=a.ins.state.params,n=a.getRowSelection();n&&!n.selectAll&&n.clearOnChange&&n.onChange([],[]),a.ins.setState({params:tslib_1.__assign(tslib_1.__assign({},s),{page:e,limit:t})},function(){return a.fetchList()})},this.onDelete=function(t){void 0===t&&(t=[]);var e=a.getModeProps(),s=e.pagination,n=e.rowKey,r=s.total,i=a.ins.state.params,e=i.page,s=i.limit;r%s!=1||e!==Math.ceil(r/s)?((i=a.getRowSelection())&&(r=i.selectedRowKeys.filter(function(e){return!t.includes(e)}),s=i.selectedRows.filter(function(e){return!t.includes(e[n])}),i.onChange(r,s)),a.fetchList()):a.ins.setState({params:tslib_1.__assign(tslib_1.__assign({},a.ins.state.params),{page:e-t.length||1})},function(){return a.fetchList()})},this.ins=e};exports.default=Util;
//# sourceMappingURL=util.js.map
