"use strict";var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var react_1=__importDefault(require("react")),antd_1=require("antd"),lodash_1=require("lodash"),moment_1=__importDefault(require("moment")),adhere_ui_formitemcreator_1=__importDefault(require("@baifendian/adhere-ui-formitemcreator")),adhere_util_intl_1=__importDefault(require("@baifendian/adhere-util-intl")),Util=function(e){var i=this;this.getModeProps=function(){return __assign({rowKey:"id"},i.ins.props[i.ins.props.mode||"table"])},this.getDefaultSelectedColumnKeys=function(e){var t=i.getModeProps().showNumber,e=(e||[]).filter(function(e){return e.show||!e.hasOwnProperty("show")}).map(function(e){return e.key});return t&&!e.includes("xuhao")&&e.unshift((null==t?void 0:t.key)||"xuhao"),e},this.getRowSelection=function(){var e=i.ins.state,t=e.selectedRowKeys,n=void 0===t?[]:t,a=e.selectedRows,t=void 0===a?[]:a,a=e.selectAll,e=i.getModeProps().rowSelection;return e?__assign(__assign({clearOnChange:!1},e),{onChange:i.onSelectChange,selectedRowKeys:e.selectedRowKeys||n,selectedRows:t,selectAll:a}):null},this.getSortDataSource=function(){return i.ins.SortableTableRef.state.dataSource},this.getParams=function(){var e=i.ins.props.params,t={};return i.ins.searchFormRef&&i.ins.searchFormRef.current&&(t=i.ins.searchFormRef.current.getFieldsValue()),__assign(__assign(__assign({},t),i.ins.state.params),e)},this.getFormColumns=function(e,t,a){return e.map(function(e){var n=e;return n.contentProps=n.contentProps||{},n.contentProps.size=t,n.type!==adhere_ui_formitemcreator_1.default.RANGEPICKER&&n.type!==adhere_ui_formitemcreator_1.default.SELECT||(n.contentProps=__assign({getPopupContainer:function(){return i.ins.TableListRef}},n.contentProps)),n.type===adhere_ui_formitemcreator_1.default.SELECT&&(n.contentProps=__assign({style:{width:"150px"},allowClear:!0},n.contentProps)),a&&(n.contentProps=__assign({onSearch:n.type===adhere_ui_formitemcreator_1.default.SEARCH?function(e){var t;return i.onSearch(((t={})[n.name]=e,t))}:null,onPressEnter:n.type!==adhere_ui_formitemcreator_1.default.SEARCH?function(e){var t;return i.onSearch(((t={})[n.name]=[adhere_ui_formitemcreator_1.default.INPUT,adhere_ui_formitemcreator_1.default.TEXTAREA,adhere_ui_formitemcreator_1.default.NUMBER].includes(n.type)?e.target.value:e,t))}:null},n.contentProps)),n})},this.getPagination=function(e){var t=i.ins.state.params;return __assign({size:"default",defaultPageSize:10,current:t.page,pageSize:t.limit,showSizeChanger:!0,pageSizeOptions:["10","20","50"],showQuickJumper:!0,showTotal:function(e,t){return"当前 "+t[0]+"-"+t[1]+"/共 "+e+" 条"},onChange:i.onPageChange,onShowSizeChange:i.onPageChange},e)},this.getTableColumns=function(){var a=i.ins.state.params,e=i.getModeProps(),t=e.columns,e=e.showNumber,t=(t||[]).map(function(r){var e;return __assign(__assign({},r),{render:function(t,e,n){var a="";return a=r.render?r.render(t,e,n):"date"===r.valueType?t?moment_1.default(t).format("L"):"-":"datetime"===r.valueType?t?moment_1.default(t).format("LLL"):"-":"map"===r.valueType&&r.map?(n=t&&(r.map||[]).find(function(e){return e.value.toString()===t.toString()}),t&&n?n.label:"-"):t,null!=r&&r.ellipsis?react_1.default.createElement(antd_1.Tooltip,{title:a,placement:"topLeft"},a):a},filtered:(null===(e=r.filters)||void 0===e?void 0:e.length)&&a[r.key]})});return e&&!t.find(function(e){return"xuhao"===e.key})&&t.unshift(__assign({title:adhere_util_intl_1.default.v("序号"),dataIndex:"xuhao",key:"xuhao",width:80,render:function(e,t,n){return(a.page-1)*a.limit+n+1}},e)),t},this.getLoading=function(e){return!(!e&&!i.ins.state.loading)&&(e&&e.hasOwnProperty("size")?e:{size:"large"})},this.fetchList=function(e){e=__assign(__assign({},i.getParams()),e);i.ins.props.request&&(i.ins.setState({loading:!0}),i.ins.props.request(e).then(function(){i.ins.setState({loading:!1})}))},this.onSearch=function(e){var t=i.ins.state.params,n=i.getRowSelection();n&&!n.selectAll&&n.clearOnChange&&n.onChange([],[]),i.ins.setState({params:__assign(__assign(__assign({},t),e),{page:1})},function(){i.fetchList()})},this.onResetSearch=function(){var e=i.ins.state.params,t=i.getRowSelection();i.ins.searchFormRef&&i.ins.searchFormRef.current&&i.ins.searchFormRef.current.resetFields(),e.page=1,t&&t.onChange([],[]),i.ins.setState({params:e},function(){i.fetchList()})},this.onSettingChange=function(e){i.ins.setState({selectedColumnKeys:e})},this.onSettingSortEnd=function(e){var n=e.oldIndex,t=e.newIndex,a=i.ins.state.tableColumns;n!==t&&(e=a[n],(a=a.filter(function(e,t){return t!==n})).splice(t,0,e),i.ins.setState({tableColumns:a}))},this.onTableChange=function(e,t,n){var a;if(!lodash_1.isEmpty(n)||!lodash_1.isEmpty(t)){var r,s=__assign(__assign({},i.ins.state.params),{order:null===(a=null==n?void 0:n.order)||void 0===a?void 0:a.replace("end",""),sidx:null==n?void 0:n.field});for(r in t)s[r]=t[r].join(","),s.page=1;n=i.getRowSelection();n&&!n.selectAll&&n.clearOnChange&&n.onChange([],[]),i.ins.setState({params:s},function(){return i.fetchList()})}},this.onSelectChange=function(e,t){var n=i.getModeProps(),a=n.dataSource,r=n.rowKey,s=n.rowSelection,n=i.ins.state.selectAll;i.ins.state.selectAll&&(a=a.map(function(e){return e[r]}),a=lodash_1.union(n.exceptKeys||[],lodash_1.difference(a,e)),i.ins.setState({selectAll:!a.length||{exceptKeys:a}})),null!=s&&s.onChange?s.onChange(e,t):i.ins.setState({selectedRowKeys:e,selectedRows:t})},this.onPageChange=function(e,t){var n=i.ins.state.params,a=i.getRowSelection();a&&!a.selectAll&&a.clearOnChange&&a.onChange([],[]),i.ins.setState({params:__assign(__assign({},n),{page:e,limit:t})},function(){return i.fetchList()})},this.onDelete=function(t){void 0===t&&(t=[]);var e=i.getModeProps(),n=e.pagination,a=e.rowKey,r=n.total,s=i.ins.state.params,e=s.page,n=s.limit;r%n!=1||e!==Math.ceil(r/n)?((s=i.getRowSelection())&&(r=s.selectedRowKeys.filter(function(e){return!t.includes(e)}),n=s.selectedRows.filter(function(e){return!t.includes(e[a])}),s.onChange(r,n)),i.fetchList()):i.ins.setState({params:__assign(__assign({},i.ins.state.params),{page:e-t.length||1})},function(){return i.fetchList()})},this.ins=e};exports.default=Util;
//# sourceMappingURL=util.js.map
