var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,n=1,s=arguments.length;n<s;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};import React from"react";import{Tooltip}from"antd";import{isEmpty,difference,union}from"lodash";import moment from"moment";import intl from"@baifendian/adhere-util-intl";var Util=function(e){var r=this;this.getModeProps=function(){return __assign({rowKey:"id"},r.ins.props[r.ins.props.mode||"table"])},this.getDefaultSelectedColumnKeys=function(e){var t=r.ins.props.showNumber,e=(e||[]).filter(function(e){return e.show||!e.hasOwnProperty("show")}).map(function(e){return e.key});return t&&!e.includes("xuhao")&&e.unshift((null==t?void 0:t.key)||"xuhao"),e},this.getRowSelection=function(){var e=r.ins.state,t=e.selectedRowKeys,n=void 0===t?[]:t,s=e.selectedRows,t=void 0===s?[]:s,s=e.selectAll,e=r.getModeProps().rowSelection;return e?__assign(__assign({clearOnChange:!1},e),{onChange:r.onSelectChange,selectedRowKeys:e.selectedRowKeys||n,selectedRows:t,selectAll:s}):null},this.getSortDatasource=function(){return r.ins.SortableTableRef.state.dataSource},this.getParams=function(){var e=r.ins.props.params,t={};return r.ins.searchFormRef&&r.ins.searchFormRef.current&&(t=r.ins.searchFormRef.current.getFieldsValue()),__assign(__assign(__assign({},t),r.ins.state.params),e)},this.getFormColumns=function(e,t,s){return e.map(function(e){var n=e;return n.contentProps=n.contentProps||{},n.contentProps.size=t,"rangepicker"!==n.type&&"select"!==n.type||(n.contentProps=__assign({getPopupContainer:function(){return r.ins.TableListRef}},n.contentProps)),"select"===n.type&&(n.contentProps=__assign({style:{width:"150px"},allowClear:!0},n.contentProps)),s&&(n.contentProps=__assign({onSearch:"search"===n.type?function(e){var t;return r.onSearch(((t={})[n.name]=e,t))}:null,onChange:"search"!==n.type?function(e){var t;return r.onSearch(((t={})[n.name]=["input","textarea","number"].includes(n.type)?e.target.value:e,t))}:null},n.contentProps)),n})},this.getPagination=function(e){var t=r.ins.state.params;return __assign({size:"default",defaultPageSize:10,current:t.page,pageSize:t.limit,showSizeChanger:!0,pageSizeOptions:["10","20","50"],showQuickJumper:!0,showTotal:function(e,t){return"当前 "+t[0]+"-"+t[1]+"/共 "+e+" 条"},onChange:r.onPageChange,onShowSizeChange:r.onPageChange},e)},this.getTableColumns=function(){var s=r.ins.state.params,e=r.ins.props.showNumber,t=(r.getModeProps().columns||[]).map(function(i){var e;return __assign(__assign({},i),{render:function(t,e,n){var s="";return s=i.render?i.render(t,e,n):"date"===i.valueType?t?moment(t).format("L"):"-":"datetime"===i.valueType?t?moment(t).format("LLL"):"-":"map"===i.valueType&&i.map?(n=t&&(i.map||[]).find(function(e){return e.value.toString()===t.toString()}),t&&n?n.label:"-"):t,null!=i&&i.ellipsis?React.createElement(Tooltip,{title:s,placement:"topLeft"},s):s},filtered:(null===(e=i.filters)||void 0===e?void 0:e.length)&&s[i.key]})});return e&&!t.find(function(e){return"xuhao"===e.key})&&t.unshift(__assign({title:intl.v("序号"),dataIndex:"xuhao",key:"xuhao",width:80,render:function(e,t,n){return(s.page-1)*s.limit+n+1}},e)),t},this.getLoading=function(e){return!(!e&&!r.ins.state.loading)&&(e&&e.hasOwnProperty("size")?e:{size:"large"})},this.fetchList=function(e){e=__assign(__assign({},r.getParams()),e);r.ins.props.request&&(r.ins.setState({loading:!0}),r.ins.props.request(e).then(function(){r.ins.setState({loading:!1})}))},this.onSearch=function(e){var t=r.ins.state.params,n=r.getRowSelection();n&&!n.selectAll&&n.clearOnChange&&n.onChange([],[]),r.ins.setState({params:__assign(__assign(__assign({},t),e),{page:1})},function(){r.fetchList()})},this.onResetSearch=function(){var e=r.ins.state.params,t=r.getRowSelection();r.ins.searchFormRef&&r.ins.searchFormRef.current&&r.ins.searchFormRef.current.resetFields(),e.page=1,t&&t.onChange([],[]),r.ins.setState({params:e},function(){r.fetchList()})},this.onSettingChange=function(e){r.ins.setState({selectedColumnKeys:e})},this.onSettingSortEnd=function(e){var n=e.oldIndex,t=e.newIndex,s=r.ins.state.tableColumns;n!==t&&(e=s[n],(s=s.filter(function(e,t){return t!==n})).splice(t,0,e),r.ins.setState({tableColumns:s}))},this.onTableChange=function(e,t,n){var s;if(!isEmpty(n)||!isEmpty(t)){var i,a=__assign(__assign({},r.ins.state.params),{order:null===(s=null==n?void 0:n.order)||void 0===s?void 0:s.replace("end",""),sidx:null==n?void 0:n.field});for(i in t)a[i]=t[i].join(","),a.page=1;n=r.getRowSelection();n&&!n.selectAll&&n.clearOnChange&&n.onChange([],[]),r.ins.setState({params:a},function(){return r.fetchList()})}},this.onSelectChange=function(e,t){var n=r.getModeProps(),s=n.dataSource,i=n.rowKey,a=n.rowSelection,n=r.ins.state.selectAll;r.ins.state.selectAll&&(s=s.map(function(e){return e[i]}),s=union(n.exceptKeys||[],difference(s,e)),r.ins.setState({selectAll:!s.length||{exceptKeys:s}})),null!=a&&a.onChange?a.onChange(e,t):r.ins.setState({selectedRowKeys:e,selectedRows:t})},this.onPageChange=function(e,t){var n=r.ins.state.params,s=r.getRowSelection();s&&!s.selectAll&&s.clearOnChange&&s.onChange([],[]),r.ins.setState({params:__assign(__assign({},n),{page:e,limit:t})},function(){return r.fetchList()})},this.onDelete=function(t){void 0===t&&(t=[]);var e=r.getModeProps(),n=e.pagination,s=e.rowKey,i=n.total,a=r.ins.state.params,e=a.page,n=a.limit;i%n!=1||e!==Math.ceil(i/n)?((a=r.getRowSelection())&&(i=a.selectedRowKeys.filter(function(e){return!t.includes(e)}),n=a.selectedRows.filter(function(e){return!t.includes(e[s])}),a.onChange(i,n)),r.fetchList()):r.ins.setState({params:__assign(__assign({},r.ins.state.params),{page:e-t.length||1})},function(){return r.fetchList()})},this.ins=e};export default Util;
//# sourceMappingURL=util.js.map
