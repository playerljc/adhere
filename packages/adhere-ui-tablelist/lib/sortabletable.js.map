{"version":3,"file":"sortabletable.js","sources":["sortabletable.js"],"sourcesContent":["\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar tslib_1 = require(\"tslib\");\r\n/*\r\n * @Description: 可拖拽排序的表格\r\n * @Author: yumeng.qin\r\n * @Date: 2021-04-28 14:58:37\r\n * @LastEditor: yumeng.qin\r\n * @LastEditTime: 2021-04-28 17:10:18\r\n */\r\nvar antd_1 = require(\"antd\");\r\nvar react_1 = tslib_1.__importDefault(require(\"react\"));\r\nvar react_sortable_hoc_1 = require(\"react-sortable-hoc\");\r\nvar tablelist_1 = require(\"./tablelist\");\r\nvar SortableItem = (0, react_sortable_hoc_1.SortableElement)(function (props) { return react_1.default.createElement(\"tr\", tslib_1.__assign({}, props)); });\r\nvar SortableWrapper = (0, react_sortable_hoc_1.SortableContainer)(function (props) { return react_1.default.createElement(\"tbody\", tslib_1.__assign({}, props)); });\r\nvar SortableTable = /** @class */ (function (_super) {\r\n    tslib_1.__extends(SortableTable, _super);\r\n    function SortableTable() {\r\n        var _this = _super !== null && _super.apply(this, arguments) || this;\r\n        _this.state = {\r\n            dataSource: _this.props.dataSource || [],\r\n            isSort: false,\r\n        };\r\n        /**\r\n         * 覆盖antdTable的tr\r\n         */\r\n        _this.DraggableBodyRow = function (_a) {\r\n            var className = _a.className, style = _a.style, restProps = tslib_1.__rest(_a, [\"className\", \"style\"]);\r\n            var dataSource = _this.state.dataSource;\r\n            var _b = _this.props.rowKey, rowKey = _b === void 0 ? 'id' : _b;\r\n            var index = dataSource.findIndex(function (x) {\r\n                var key = rowKey && typeof rowKey === 'function' ? rowKey(x) : rowKey;\r\n                return x[key] === restProps['data-row-key'];\r\n            });\r\n            return (\r\n            // @ts-ignore\r\n            react_1.default.createElement(SortableItem, tslib_1.__assign({ index: index }, (_this.props.sortable &&\r\n                typeof _this.props.sortable !== 'boolean' &&\r\n                _this.props.sortable.itemProps), restProps)));\r\n        };\r\n        /*\r\n         * 覆盖antdTable的tbody helperClass为拖拽项的类名\r\n         */\r\n        _this.DraggableContainer = function (containerProps) { return (\r\n        // @ts-ignore\r\n        react_1.default.createElement(SortableWrapper, tslib_1.__assign({ helperClass: \"\".concat(tablelist_1.selectorPrefix, \"-row-dragging\"), onSortEnd: _this.onSortEnd, distance: 2 }, (_this.props.sortable &&\r\n            typeof _this.props.sortable !== 'boolean' &&\r\n            _this.props.sortable.containerProps), containerProps))); };\r\n        /**\r\n         * 拖拽完成时更改dataSource\r\n         */\r\n        _this.onSortEnd = function (_a) {\r\n            var oldIndex = _a.oldIndex, newIndex = _a.newIndex;\r\n            var dataSource = _this.state.dataSource;\r\n            if (oldIndex !== newIndex) {\r\n                var oldItem = dataSource[oldIndex];\r\n                var newData = dataSource.filter(function (_, i) { return i !== oldIndex; });\r\n                newData.splice(newIndex, 0, oldItem);\r\n                _this.setState({ isSort: true, dataSource: newData });\r\n            }\r\n        };\r\n        return _this;\r\n    }\r\n    SortableTable.getDerivedStateFromProps = function (nextProps, prevState) {\r\n        if (!prevState.isSort &&\r\n            JSON.stringify(nextProps.dataSource) !== JSON.stringify(prevState.dataSource)) {\r\n            return {\r\n                dataSource: nextProps.dataSource,\r\n            };\r\n        }\r\n        if (prevState.isSort) {\r\n            return {\r\n                isSort: false,\r\n            };\r\n        }\r\n        return null;\r\n    };\r\n    SortableTable.prototype.render = function () {\r\n        var _a = this.props, sortable = _a.sortable, others = tslib_1.__rest(_a, [\"sortable\"]);\r\n        return (react_1.default.createElement(antd_1.Table, tslib_1.__assign({}, others, { dataSource: this.state.dataSource, components: {\r\n                body: {\r\n                    wrapper: this.DraggableContainer,\r\n                    row: this.DraggableBodyRow,\r\n                },\r\n            } })));\r\n    };\r\n    return SortableTable;\r\n}(react_1.default.Component));\r\nexports.default = SortableTable;\r\n//# sourceMappingURL=sortabletable.js.map"],"names":["Object","defineProperty","exports","value","tslib_1","require","antd_1","react_1","__importDefault","react_sortable_hoc_1","tablelist_1","SortableItem","SortableElement","props","default","createElement","__assign","SortableWrapper","SortableContainer","SortableTable","_super","_this","apply","this","arguments","state","dataSource","isSort","DraggableBodyRow","_a","className","style","restProps","__rest","_b","rowKey","index","findIndex","x","sortable","itemProps","DraggableContainer","containerProps","helperClass","concat","selectorPrefix","onSortEnd","distance","oldItem","oldIndex","newIndex","newData","filter","_","i","splice","setState","__extends","getDerivedStateFromProps","nextProps","prevState","JSON","stringify","prototype","render","others","Table","components","body","wrapper","row","Component"],"mappings":"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"}