{"version":3,"file":"SortableTable.js","sources":["SortableTable.js"],"sourcesContent":["\"use strict\";\n\nvar __extends = void 0 && (void 0).__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n    return _extendStatics(d, b);\n  };\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    _extendStatics(d, b);\n    function __() {\n      this.constructor = d;\n    }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\nvar __assign = void 0 && (void 0).__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n    return t;\n  };\n  return __assign.apply(this, arguments);\n};\nvar __rest = void 0 && (void 0).__rest || function (s, e) {\n  var t = {};\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\nvar __importDefault = void 0 && (void 0).__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n/*\n * @Description: 可拖拽排序的表格\n * @Author: yumeng.qin\n * @Date: 2021-04-28 14:58:37\n * @LastEditor: yumeng.qin\n * @LastEditTime: 2021-04-28 17:10:18\n */\nvar antd_1 = require(\"antd\");\nvar react_1 = __importDefault(require(\"react\"));\nvar react_sortable_hoc_1 = require(\"react-sortable-hoc\");\nvar TableList_1 = require(\"./TableList\");\nvar SortableItem = (0, react_sortable_hoc_1.SortableElement)(function (props) {\n  return react_1.default.createElement(\"tr\", __assign({}, props));\n});\nvar SortableWrapper = (0, react_sortable_hoc_1.SortableContainer)(function (props) {\n  return react_1.default.createElement(\"tbody\", __assign({}, props));\n});\nvar SortableTable = /** @class */function (_super) {\n  __extends(SortableTable, _super);\n  function SortableTable() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n    _this.state = {\n      dataSource: _this.props.dataSource || [],\n      isSort: false\n    };\n    /**\n     * 覆盖antdTable的tr\n     */\n    _this.DraggableBodyRow = function (_a) {\n      var className = _a.className,\n        style = _a.style,\n        restProps = __rest(_a, [\"className\", \"style\"]);\n      var dataSource = _this.state.dataSource;\n      var _b = _this.props.rowKey,\n        rowKey = _b === void 0 ? 'id' : _b;\n      var index = dataSource.findIndex(function (x) {\n        // @ts-ignore\n        var key = rowKey && typeof rowKey === 'function' ? rowKey(x) : rowKey;\n        // @ts-ignore\n        return x[key] === restProps['data-row-key'];\n      });\n      return (\n        // @ts-ignore\n        react_1.default.createElement(SortableItem, __assign({\n          index: index\n        }, _this.props.sortable && typeof _this.props.sortable !== 'boolean' && _this.props.sortable.itemProps, restProps))\n      );\n    };\n    /*\n     * 覆盖antdTable的tbody helperClass为拖拽项的类名\n     */\n    _this.DraggableContainer = function (containerProps) {\n      return (\n        // @ts-ignore\n        react_1.default.createElement(SortableWrapper, __assign({\n          helperClass: \"\".concat(TableList_1.selectorPrefix, \"-row-dragging\"),\n          onSortEnd: _this.onSortEnd,\n          distance: 2\n        }, _this.props.sortable && typeof _this.props.sortable !== 'boolean' && _this.props.sortable.containerProps, containerProps))\n      );\n    };\n    /**\n     * 拖拽完成时更改dataSource\n     */\n    _this.onSortEnd = function (_a) {\n      var oldIndex = _a.oldIndex,\n        newIndex = _a.newIndex;\n      var dataSource = _this.state.dataSource;\n      if (oldIndex !== newIndex) {\n        var oldItem = dataSource[oldIndex];\n        var newData = dataSource.filter(function (_, i) {\n          return i !== oldIndex;\n        });\n        newData.splice(newIndex, 0, oldItem);\n        _this.setState({\n          isSort: true,\n          dataSource: newData\n        });\n      }\n    };\n    return _this;\n  }\n  SortableTable.getDerivedStateFromProps = function (nextProps, prevState) {\n    if (!prevState.isSort && JSON.stringify(nextProps.dataSource) !== JSON.stringify(prevState.dataSource)) {\n      return {\n        dataSource: nextProps.dataSource\n      };\n    }\n    if (prevState.isSort) {\n      return {\n        isSort: false\n      };\n    }\n    return null;\n  };\n  SortableTable.prototype.render = function () {\n    var _a = this.props,\n      sortable = _a.sortable,\n      others = __rest(_a, [\"sortable\"]);\n    return react_1.default.createElement(antd_1.Table, __assign({}, others, {\n      dataSource: this.state.dataSource,\n      components: {\n        body: {\n          wrapper: this.DraggableContainer,\n          row: this.DraggableBodyRow\n        }\n      }\n    }));\n  };\n  return SortableTable;\n}(react_1.default.Component);\nexports.default = SortableTable;"],"names":["__extends","_extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","TypeError","String","__","this","constructor","create","__assign","assign","t","s","i","n","arguments","length","apply","__rest","e","indexOf","getOwnPropertySymbols","propertyIsEnumerable","__importDefault","mod","__esModule","default","antd_1","defineProperty","exports","value","require","react_1","react_sortable_hoc_1","TableList_1","SortableItem","SortableElement","props","createElement","SortableWrapper","SortableContainer","SortableTable","_super","_this","state","dataSource","isSort","DraggableBodyRow","_a","className","style","restProps","_b","rowKey","index","findIndex","x","sortable","itemProps","DraggableContainer","containerProps","helperClass","concat","selectorPrefix","onSortEnd","distance","oldItem","oldIndex","newIndex","newData","filter","_","splice","setState","getDerivedStateFromProps","nextProps","prevState","JSON","stringify","render","others","Table","components","body","wrapper","row","Component"],"mappings":"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"}