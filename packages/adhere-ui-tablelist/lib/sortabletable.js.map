{"version":3,"file":"sortabletable.js","sources":["sortabletable.js"],"sourcesContent":["\"use strict\";\n\nrequire(\"core-js/modules/es.object.define-property.js\");\n\nrequire(\"core-js/modules/es.array.find-index.js\");\n\nrequire(\"core-js/modules/es.array.filter.js\");\n\nrequire(\"core-js/modules/es.object.to-string.js\");\n\nrequire(\"core-js/modules/es.array.splice.js\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar tslib_1 = require(\"tslib\");\n/*\n * @Description: 可拖拽排序的表格\n * @Author: yumeng.qin\n * @Date: 2021-04-28 14:58:37\n * @LastEditor: yumeng.qin\n * @LastEditTime: 2021-04-28 17:10:18\n */\n\n\nvar antd_1 = require(\"antd\");\n\nvar react_1 = tslib_1.__importDefault(require(\"react\"));\n\nvar react_sortable_hoc_1 = require(\"react-sortable-hoc\");\n\nvar tablelist_1 = require(\"./tablelist\");\n\nvar SortableItem = (0, react_sortable_hoc_1.SortableElement)(function (props) {\n  return react_1.default.createElement(\"tr\", tslib_1.__assign({}, props));\n});\nvar SortableWrapper = (0, react_sortable_hoc_1.SortableContainer)(function (props) {\n  return react_1.default.createElement(\"tbody\", tslib_1.__assign({}, props));\n});\n\nvar SortableTable =\n/** @class */\nfunction (_super) {\n  tslib_1.__extends(SortableTable, _super);\n\n  function SortableTable() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.state = {\n      dataSource: _this.props.dataSource || [],\n      isSort: false\n    };\n    /**\n     * 覆盖antdTable的tr\n     */\n\n    _this.DraggableBodyRow = function (_a) {\n      var className = _a.className,\n          style = _a.style,\n          restProps = tslib_1.__rest(_a, [\"className\", \"style\"]);\n\n      var dataSource = _this.state.dataSource;\n      var _b = _this.props.rowKey,\n          rowKey = _b === void 0 ? 'id' : _b;\n      var index = dataSource.findIndex(function (x) {\n        var key = rowKey && typeof rowKey === 'function' ? rowKey(x) : rowKey;\n        return x[key] === restProps['data-row-key'];\n      });\n      return (// @ts-ignore\n        react_1.default.createElement(SortableItem, tslib_1.__assign({\n          index: index\n        }, _this.props.sortable && typeof _this.props.sortable !== 'boolean' && _this.props.sortable.itemProps, restProps))\n      );\n    };\n    /*\n     * 覆盖antdTable的tbody helperClass为拖拽项的类名\n     */\n\n\n    _this.DraggableContainer = function (containerProps) {\n      return (// @ts-ignore\n        react_1.default.createElement(SortableWrapper, tslib_1.__assign({\n          helperClass: \"\".concat(tablelist_1.selectorPrefix, \"-row-dragging\"),\n          onSortEnd: _this.onSortEnd,\n          distance: 2\n        }, _this.props.sortable && typeof _this.props.sortable !== 'boolean' && _this.props.sortable.containerProps, containerProps))\n      );\n    };\n    /**\n     * 拖拽完成时更改dataSource\n     */\n\n\n    _this.onSortEnd = function (_a) {\n      var oldIndex = _a.oldIndex,\n          newIndex = _a.newIndex;\n      var dataSource = _this.state.dataSource;\n\n      if (oldIndex !== newIndex) {\n        var oldItem = dataSource[oldIndex];\n        var newData = dataSource.filter(function (_, i) {\n          return i !== oldIndex;\n        });\n        newData.splice(newIndex, 0, oldItem);\n\n        _this.setState({\n          isSort: true,\n          dataSource: newData\n        });\n      }\n    };\n\n    return _this;\n  }\n\n  SortableTable.getDerivedStateFromProps = function (nextProps, prevState) {\n    if (!prevState.isSort && JSON.stringify(nextProps.dataSource) !== JSON.stringify(prevState.dataSource)) {\n      return {\n        dataSource: nextProps.dataSource\n      };\n    }\n\n    if (prevState.isSort) {\n      return {\n        isSort: false\n      };\n    }\n\n    return null;\n  };\n\n  SortableTable.prototype.render = function () {\n    var _a = this.props,\n        sortable = _a.sortable,\n        others = tslib_1.__rest(_a, [\"sortable\"]);\n\n    return react_1.default.createElement(antd_1.Table, tslib_1.__assign({}, others, {\n      dataSource: this.state.dataSource,\n      components: {\n        body: {\n          wrapper: this.DraggableContainer,\n          row: this.DraggableBodyRow\n        }\n      }\n    }));\n  };\n\n  return SortableTable;\n}(react_1.default.Component);\n\nexports.default = SortableTable;"],"names":["require","Object","defineProperty","exports","value","tslib_1","antd_1","react_1","__importDefault","react_sortable_hoc_1","tablelist_1","SortableItem","SortableElement","props","default","createElement","__assign","SortableWrapper","SortableContainer","SortableTable","_super","_this","apply","this","arguments","state","dataSource","isSort","DraggableBodyRow","_a","className","style","restProps","__rest","_b","rowKey","index","findIndex","x","sortable","itemProps","DraggableContainer","containerProps","helperClass","concat","selectorPrefix","onSortEnd","distance","oldItem","oldIndex","newIndex","newData","filter","_","i","splice","setState","__extends","getDerivedStateFromProps","nextProps","prevState","JSON","stringify","prototype","render","others","Table","components","body","wrapper","row","Component"],"mappings":"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"}