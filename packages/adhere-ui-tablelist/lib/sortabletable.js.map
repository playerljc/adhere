{"version":3,"file":"sortabletable.js","sources":["sortabletable.js"],"sourcesContent":["\"use strict\";\n\nrequire(\"core-js/modules/es.object.define-property.js\");\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _table = _interopRequireDefault(require(\"antd/lib/table\"));\n\nrequire(\"core-js/modules/es.array.find-index.js\");\n\nrequire(\"core-js/modules/es.array.filter.js\");\n\nrequire(\"core-js/modules/es.object.to-string.js\");\n\nrequire(\"core-js/modules/es.array.splice.js\");\n\nvar _tslib = require(\"tslib\");\n\nvar _react = _interopRequireDefault(require(\"react\"));\n\nvar _reactSortableHoc = require(\"react-sortable-hoc\");\n\n/*\n * @Description: 可拖拽排序的表格\n * @Author: yumeng.qin\n * @Date: 2021-04-28 14:58:37\n * @LastEditor: yumeng.qin\n * @LastEditTime: 2021-04-28 17:10:18\n */\n// import Table from 'antd/lib/table';\nvar SortableItem = (0, _reactSortableHoc.SortableElement)(function (props) {\n  return /*#__PURE__*/_react.default.createElement(\"tr\", (0, _tslib.__assign)({}, props));\n});\nvar SortableWrapper = (0, _reactSortableHoc.SortableContainer)(function (props) {\n  return /*#__PURE__*/_react.default.createElement(\"tbody\", (0, _tslib.__assign)({}, props));\n});\n\nvar SortableTable =\n/** @class */\nfunction (_super) {\n  (0, _tslib.__extends)(SortableTable, _super);\n\n  function SortableTable() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.state = {\n      dataSource: _this.props.dataSource || [],\n      isSort: false\n    };\n    /**\n     * 覆盖antdTable的tr\n     */\n\n    _this.DraggableBodyRow = function (_a) {\n      var className = _a.className,\n          style = _a.style,\n          restProps = (0, _tslib.__rest)(_a, [\"className\", \"style\"]);\n      var dataSource = _this.state.dataSource;\n      var _b = _this.props.rowKey,\n          rowKey = _b === void 0 ? 'id' : _b;\n      var index = dataSource.findIndex(function (x) {\n        var key = rowKey && typeof rowKey === 'function' ? rowKey(x) : rowKey;\n        return x[key] === restProps['data-row-key'];\n      });\n      return /*#__PURE__*/_react.default.createElement(SortableItem, (0, _tslib.__assign)({\n        index: index\n      }, _this.props.sortable && typeof _this.props.sortable !== 'boolean' && _this.props.sortable.itemProps, restProps));\n    };\n    /*\n     * 覆盖antdTable的tbody helperClass为拖拽项的类名\n     */\n\n\n    _this.DraggableContainer = function (containerProps) {\n      return /*#__PURE__*/_react.default.createElement(SortableWrapper, (0, _tslib.__assign)({\n        helperClass: \"row-dragging\",\n        onSortEnd: _this.onSortEnd,\n        distance: 2\n      }, _this.props.sortable && typeof _this.props.sortable !== 'boolean' && _this.props.sortable.containerProps, containerProps));\n    };\n    /**\n     * 拖拽完成时更改dataSource\n     */\n\n\n    _this.onSortEnd = function (_a) {\n      var oldIndex = _a.oldIndex,\n          newIndex = _a.newIndex;\n      var dataSource = _this.state.dataSource;\n\n      if (oldIndex !== newIndex) {\n        var oldItem = dataSource[oldIndex];\n        var newData = dataSource.filter(function (_, i) {\n          return i !== oldIndex;\n        });\n        newData.splice(newIndex, 0, oldItem);\n\n        _this.setState({\n          isSort: true,\n          dataSource: newData\n        });\n      }\n    };\n\n    return _this;\n  }\n\n  SortableTable.getDerivedStateFromProps = function (nextProps, prevState) {\n    if (!prevState.isSort && JSON.stringify(nextProps.dataSource) !== JSON.stringify(prevState.dataSource)) {\n      return {\n        dataSource: nextProps.dataSource\n      };\n    }\n\n    if (prevState.isSort) {\n      return {\n        isSort: false\n      };\n    }\n\n    return null;\n  };\n\n  SortableTable.prototype.render = function () {\n    var _a = this.props,\n        sortable = _a.sortable,\n        others = (0, _tslib.__rest)(_a, [\"sortable\"]);\n    return /*#__PURE__*/_react.default.createElement(_table.default, (0, _tslib.__assign)({}, others, {\n      dataSource: this.state.dataSource,\n      components: {\n        body: {\n          wrapper: this.DraggableContainer,\n          row: this.DraggableBodyRow\n        }\n      }\n    }));\n  };\n\n  return SortableTable;\n}(_react.default.Component);\n\nvar _default = SortableTable;\nexports.default = _default;"],"names":["require","_interopRequireDefault","Object","defineProperty","exports","value","default","_table","_tslib","_react","_reactSortableHoc","SortableItem","SortableElement","props","createElement","__assign","SortableWrapper","SortableContainer","SortableTable","_super","_this","apply","this","arguments","state","dataSource","isSort","DraggableBodyRow","_a","className","style","restProps","__rest","_b","rowKey","index","findIndex","x","sortable","itemProps","DraggableContainer","containerProps","helperClass","onSortEnd","distance","oldIndex","newIndex","oldItem","newData","filter","_","i","splice","setState","__extends","getDerivedStateFromProps","nextProps","prevState","JSON","stringify","prototype","render","others","components","body","wrapper","row","Component","_default"],"mappings":"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"}