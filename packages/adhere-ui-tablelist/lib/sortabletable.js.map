{"version":3,"file":"sortabletable.js","sources":["sortabletable.js"],"sourcesContent":["\"use strict\";\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        if (typeof b !== \"function\" && b !== null)\r\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __assign = (this && this.__assign) || function () {\r\n    __assign = Object.assign || function(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n                t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\nvar __rest = (this && this.__rest) || function (s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n};\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n/*\r\n * @Description: 可拖拽排序的表格\r\n * @Author: yumeng.qin\r\n * @Date: 2021-04-28 14:58:37\r\n * @LastEditor: yumeng.qin\r\n * @LastEditTime: 2021-04-28 17:10:18\r\n */\r\nvar antd_1 = require(\"antd\");\r\nvar react_1 = __importDefault(require(\"react\"));\r\nvar react_sortable_hoc_1 = require(\"react-sortable-hoc\");\r\nvar tablelist_1 = require(\"./tablelist\");\r\nvar SortableItem = (0, react_sortable_hoc_1.SortableElement)(function (props) { return react_1.default.createElement(\"tr\", __assign({}, props)); });\r\nvar SortableWrapper = (0, react_sortable_hoc_1.SortableContainer)(function (props) { return react_1.default.createElement(\"tbody\", __assign({}, props)); });\r\nvar SortableTable = /** @class */ (function (_super) {\r\n    __extends(SortableTable, _super);\r\n    function SortableTable() {\r\n        var _this = _super !== null && _super.apply(this, arguments) || this;\r\n        _this.state = {\r\n            dataSource: _this.props.dataSource || [],\r\n            isSort: false,\r\n        };\r\n        /**\r\n         * 覆盖antdTable的tr\r\n         */\r\n        _this.DraggableBodyRow = function (_a) {\r\n            var className = _a.className, style = _a.style, restProps = __rest(_a, [\"className\", \"style\"]);\r\n            var dataSource = _this.state.dataSource;\r\n            var _b = _this.props.rowKey, rowKey = _b === void 0 ? 'id' : _b;\r\n            var index = dataSource.findIndex(function (x) {\r\n                var key = rowKey && typeof rowKey === 'function' ? rowKey(x) : rowKey;\r\n                return x[key] === restProps['data-row-key'];\r\n            });\r\n            return (\r\n            // @ts-ignore\r\n            react_1.default.createElement(SortableItem, __assign({ index: index }, (_this.props.sortable &&\r\n                typeof _this.props.sortable !== 'boolean' &&\r\n                _this.props.sortable.itemProps), restProps)));\r\n        };\r\n        /*\r\n         * 覆盖antdTable的tbody helperClass为拖拽项的类名\r\n         */\r\n        _this.DraggableContainer = function (containerProps) { return (\r\n        // @ts-ignore\r\n        react_1.default.createElement(SortableWrapper, __assign({ helperClass: \"\".concat(tablelist_1.selectorPrefix, \"-row-dragging\"), onSortEnd: _this.onSortEnd, distance: 2 }, (_this.props.sortable &&\r\n            typeof _this.props.sortable !== 'boolean' &&\r\n            _this.props.sortable.containerProps), containerProps))); };\r\n        /**\r\n         * 拖拽完成时更改dataSource\r\n         */\r\n        _this.onSortEnd = function (_a) {\r\n            var oldIndex = _a.oldIndex, newIndex = _a.newIndex;\r\n            var dataSource = _this.state.dataSource;\r\n            if (oldIndex !== newIndex) {\r\n                var oldItem = dataSource[oldIndex];\r\n                var newData = dataSource.filter(function (_, i) { return i !== oldIndex; });\r\n                newData.splice(newIndex, 0, oldItem);\r\n                _this.setState({ isSort: true, dataSource: newData });\r\n            }\r\n        };\r\n        return _this;\r\n    }\r\n    SortableTable.getDerivedStateFromProps = function (nextProps, prevState) {\r\n        if (!prevState.isSort &&\r\n            JSON.stringify(nextProps.dataSource) !== JSON.stringify(prevState.dataSource)) {\r\n            return {\r\n                dataSource: nextProps.dataSource,\r\n            };\r\n        }\r\n        if (prevState.isSort) {\r\n            return {\r\n                isSort: false,\r\n            };\r\n        }\r\n        return null;\r\n    };\r\n    SortableTable.prototype.render = function () {\r\n        var _a = this.props, sortable = _a.sortable, others = __rest(_a, [\"sortable\"]);\r\n        return (react_1.default.createElement(antd_1.Table, __assign({}, others, { dataSource: this.state.dataSource, components: {\r\n                body: {\r\n                    wrapper: this.DraggableContainer,\r\n                    row: this.DraggableBodyRow,\r\n                },\r\n            } })));\r\n    };\r\n    return SortableTable;\r\n}(react_1.default.Component));\r\nexports.default = SortableTable;\r\n"],"names":["__extends","this","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","TypeError","String","__","constructor","create","__assign","assign","t","s","i","n","arguments","length","apply","__rest","e","indexOf","getOwnPropertySymbols","propertyIsEnumerable","__importDefault","mod","__esModule","default","antd_1","defineProperty","exports","value","require","react_1","react_sortable_hoc_1","tablelist_1","SortableItem","SortableElement","props","createElement","SortableWrapper","SortableContainer","SortableTable","_super","_this","state","dataSource","isSort","DraggableBodyRow","_a","className","style","restProps","_b","rowKey","index","findIndex","x","sortable","itemProps","DraggableContainer","containerProps","helperClass","concat","selectorPrefix","onSortEnd","distance","oldItem","oldIndex","newIndex","newData","filter","_","splice","setState","getDerivedStateFromProps","nextProps","prevState","JSON","stringify","render","others","Table","components","body","wrapper","row","Component"],"mappings":"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"}