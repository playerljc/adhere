{"version":3,"file":"SortableTable.js","sources":["SortableTable.js"],"sourcesContent":["import _Table from \"antd/es/table\";\nvar __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n    return _extendStatics(d, b);\n  };\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    _extendStatics(d, b);\n    function __() {\n      this.constructor = d;\n    }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n    return t;\n  };\n  return __assign.apply(this, arguments);\n};\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\n/*\n * @Description: 可拖拽排序的表格\n * @Author: yumeng.qin\n * @Date: 2021-04-28 14:58:37\n * @LastEditor: yumeng.qin\n * @LastEditTime: 2021-04-28 17:10:18\n */\n\nimport React from 'react';\nimport { SortableContainer, SortableElement } from 'react-sortable-hoc';\nimport { selectorPrefix } from './TableList';\nvar SortableItem = SortableElement(function (props) {\n  return /*#__PURE__*/React.createElement(\"tr\", __assign({}, props));\n});\nvar SortableWrapper = SortableContainer(function (props) {\n  return /*#__PURE__*/React.createElement(\"tbody\", __assign({}, props));\n});\nvar SortableTable = /** @class */function (_super) {\n  __extends(SortableTable, _super);\n  function SortableTable() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n    _this.state = {\n      dataSource: _this.props.dataSource || [],\n      isSort: false\n    };\n    /**\n     * 覆盖antdTable的tr\n     */\n    _this.DraggableBodyRow = function (_a) {\n      var className = _a.className,\n        style = _a.style,\n        restProps = __rest(_a, [\"className\", \"style\"]);\n      var dataSource = _this.state.dataSource;\n      var _b = _this.props.rowKey,\n        rowKey = _b === void 0 ? 'id' : _b;\n      var index = dataSource.findIndex(function (x) {\n        // @ts-ignore\n        var key = rowKey && typeof rowKey === 'function' ? rowKey(x) : rowKey;\n        // @ts-ignore\n        return x[key] === restProps['data-row-key'];\n      });\n      return (\n        /*#__PURE__*/\n        // @ts-ignore\n        React.createElement(SortableItem, __assign({\n          index: index\n        }, _this.props.sortable && typeof _this.props.sortable !== 'boolean' && _this.props.sortable.itemProps, restProps))\n      );\n    };\n    /*\n     * 覆盖antdTable的tbody helperClass为拖拽项的类名\n     */\n    _this.DraggableContainer = function (containerProps) {\n      return (\n        /*#__PURE__*/\n        // @ts-ignore\n        React.createElement(SortableWrapper, __assign({\n          helperClass: \"\".concat(selectorPrefix, \"-row-dragging\"),\n          onSortEnd: _this.onSortEnd,\n          distance: 2\n        }, _this.props.sortable && typeof _this.props.sortable !== 'boolean' && _this.props.sortable.containerProps, containerProps))\n      );\n    };\n    /**\n     * 拖拽完成时更改dataSource\n     */\n    _this.onSortEnd = function (_a) {\n      var oldIndex = _a.oldIndex,\n        newIndex = _a.newIndex;\n      var dataSource = _this.state.dataSource;\n      if (oldIndex !== newIndex) {\n        var oldItem = dataSource[oldIndex];\n        var newData = dataSource.filter(function (_, i) {\n          return i !== oldIndex;\n        });\n        newData.splice(newIndex, 0, oldItem);\n        _this.setState({\n          isSort: true,\n          dataSource: newData\n        });\n      }\n    };\n    return _this;\n  }\n  SortableTable.getDerivedStateFromProps = function (nextProps, prevState) {\n    if (!prevState.isSort && JSON.stringify(nextProps.dataSource) !== JSON.stringify(prevState.dataSource)) {\n      return {\n        dataSource: nextProps.dataSource\n      };\n    }\n    if (prevState.isSort) {\n      return {\n        isSort: false\n      };\n    }\n    return null;\n  };\n  SortableTable.prototype.render = function () {\n    var _a = this.props,\n      sortable = _a.sortable,\n      others = __rest(_a, [\"sortable\"]);\n    return /*#__PURE__*/React.createElement(_Table, __assign({}, others, {\n      dataSource: this.state.dataSource,\n      components: {\n        body: {\n          wrapper: this.DraggableContainer,\n          row: this.DraggableBodyRow\n        }\n      }\n    }));\n  };\n  return SortableTable;\n}(React.Component);\nexport default SortableTable;"],"names":["_Table","__extends","this","_extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","TypeError","String","__","constructor","create","__assign","assign","t","s","i","n","arguments","length","apply","__rest","e","indexOf","getOwnPropertySymbols","propertyIsEnumerable","React","SortableContainer","SortableElement","selectorPrefix","SortableItem","props","createElement","SortableWrapper","SortableTable","_super","_this","state","dataSource","isSort","DraggableBodyRow","_a","className","style","restProps","_b","rowKey","index","findIndex","x","sortable","itemProps","DraggableContainer","containerProps","helperClass","concat","onSortEnd","distance","oldItem","oldIndex","newIndex","newData","filter","_","splice","setState","getDerivedStateFromProps","nextProps","prevState","JSON","stringify","render","others","components","body","wrapper","row","Component"],"mappings":"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"}