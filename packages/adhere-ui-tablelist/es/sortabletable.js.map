{"version":3,"file":"sortabletable.js","sources":["sortabletable.js"],"sourcesContent":["var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        if (typeof b !== \"function\" && b !== null)\r\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __assign = (this && this.__assign) || function () {\r\n    __assign = Object.assign || function(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n                t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\nvar __rest = (this && this.__rest) || function (s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n};\r\n/*\r\n * @Description: 可拖拽排序的表格\r\n * @Author: yumeng.qin\r\n * @Date: 2021-04-28 14:58:37\r\n * @LastEditor: yumeng.qin\r\n * @LastEditTime: 2021-04-28 17:10:18\r\n */\r\nimport { Table } from 'antd';\r\nimport React from 'react';\r\nimport { SortableContainer, SortableElement } from 'react-sortable-hoc';\r\nimport { selectorPrefix } from './tablelist';\r\nvar SortableItem = SortableElement(function (props) { return React.createElement(\"tr\", __assign({}, props)); });\r\nvar SortableWrapper = SortableContainer(function (props) { return React.createElement(\"tbody\", __assign({}, props)); });\r\nvar SortableTable = /** @class */ (function (_super) {\r\n    __extends(SortableTable, _super);\r\n    function SortableTable() {\r\n        var _this = _super !== null && _super.apply(this, arguments) || this;\r\n        _this.state = {\r\n            dataSource: _this.props.dataSource || [],\r\n            isSort: false,\r\n        };\r\n        /**\r\n         * 覆盖antdTable的tr\r\n         */\r\n        _this.DraggableBodyRow = function (_a) {\r\n            var className = _a.className, style = _a.style, restProps = __rest(_a, [\"className\", \"style\"]);\r\n            var dataSource = _this.state.dataSource;\r\n            var _b = _this.props.rowKey, rowKey = _b === void 0 ? 'id' : _b;\r\n            var index = dataSource.findIndex(function (x) {\r\n                var key = rowKey && typeof rowKey === 'function' ? rowKey(x) : rowKey;\r\n                return x[key] === restProps['data-row-key'];\r\n            });\r\n            return (\r\n            // @ts-ignore\r\n            React.createElement(SortableItem, __assign({ index: index }, (_this.props.sortable &&\r\n                typeof _this.props.sortable !== 'boolean' &&\r\n                _this.props.sortable.itemProps), restProps)));\r\n        };\r\n        /*\r\n         * 覆盖antdTable的tbody helperClass为拖拽项的类名\r\n         */\r\n        _this.DraggableContainer = function (containerProps) { return (\r\n        // @ts-ignore\r\n        React.createElement(SortableWrapper, __assign({ helperClass: \"\".concat(selectorPrefix, \"-row-dragging\"), onSortEnd: _this.onSortEnd, distance: 2 }, (_this.props.sortable &&\r\n            typeof _this.props.sortable !== 'boolean' &&\r\n            _this.props.sortable.containerProps), containerProps))); };\r\n        /**\r\n         * 拖拽完成时更改dataSource\r\n         */\r\n        _this.onSortEnd = function (_a) {\r\n            var oldIndex = _a.oldIndex, newIndex = _a.newIndex;\r\n            var dataSource = _this.state.dataSource;\r\n            if (oldIndex !== newIndex) {\r\n                var oldItem = dataSource[oldIndex];\r\n                var newData = dataSource.filter(function (_, i) { return i !== oldIndex; });\r\n                newData.splice(newIndex, 0, oldItem);\r\n                _this.setState({ isSort: true, dataSource: newData });\r\n            }\r\n        };\r\n        return _this;\r\n    }\r\n    SortableTable.getDerivedStateFromProps = function (nextProps, prevState) {\r\n        if (!prevState.isSort &&\r\n            JSON.stringify(nextProps.dataSource) !== JSON.stringify(prevState.dataSource)) {\r\n            return {\r\n                dataSource: nextProps.dataSource,\r\n            };\r\n        }\r\n        if (prevState.isSort) {\r\n            return {\r\n                isSort: false,\r\n            };\r\n        }\r\n        return null;\r\n    };\r\n    SortableTable.prototype.render = function () {\r\n        var _a = this.props, sortable = _a.sortable, others = __rest(_a, [\"sortable\"]);\r\n        return (React.createElement(Table, __assign({}, others, { dataSource: this.state.dataSource, components: {\r\n                body: {\r\n                    wrapper: this.DraggableContainer,\r\n                    row: this.DraggableBodyRow,\r\n                },\r\n            } })));\r\n    };\r\n    return SortableTable;\r\n}(React.Component));\r\nexport default SortableTable;\r\n"],"names":["__extends","this","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","TypeError","String","__","constructor","create","__assign","assign","t","s","i","n","arguments","length","apply","__rest","e","indexOf","getOwnPropertySymbols","propertyIsEnumerable","Table","React","SortableContainer","SortableElement","selectorPrefix","SortableItem","props","createElement","SortableWrapper","SortableTable","_super","_this","state","dataSource","isSort","DraggableBodyRow","_a","className","style","restProps","_b","rowKey","index","findIndex","x","sortable","itemProps","DraggableContainer","containerProps","helperClass","concat","onSortEnd","distance","oldItem","oldIndex","newIndex","newData","filter","_","splice","setState","getDerivedStateFromProps","nextProps","prevState","JSON","stringify","render","others","components","body","wrapper","row","Component"],"mappings":"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"}