{"version":3,"file":"sortabletable.js","sources":["sortabletable.js"],"sourcesContent":["import { __assign, __extends, __rest } from \"tslib\";\r\n/*\r\n * @Description: 可拖拽排序的表格\r\n * @Author: yumeng.qin\r\n * @Date: 2021-04-28 14:58:37\r\n * @LastEditor: yumeng.qin\r\n * @LastEditTime: 2021-04-28 17:10:18\r\n */\r\nimport { Table } from 'antd';\r\nimport React from 'react';\r\nimport { SortableContainer, SortableElement } from 'react-sortable-hoc';\r\nimport { selectorPrefix } from './tablelist';\r\nvar SortableItem = SortableElement(function (props) { return React.createElement(\"tr\", __assign({}, props)); });\r\nvar SortableWrapper = SortableContainer(function (props) { return React.createElement(\"tbody\", __assign({}, props)); });\r\nvar SortableTable = /** @class */ (function (_super) {\r\n    __extends(SortableTable, _super);\r\n    function SortableTable() {\r\n        var _this = _super !== null && _super.apply(this, arguments) || this;\r\n        _this.state = {\r\n            dataSource: _this.props.dataSource || [],\r\n            isSort: false,\r\n        };\r\n        /**\r\n         * 覆盖antdTable的tr\r\n         */\r\n        _this.DraggableBodyRow = function (_a) {\r\n            var className = _a.className, style = _a.style, restProps = __rest(_a, [\"className\", \"style\"]);\r\n            var dataSource = _this.state.dataSource;\r\n            var _b = _this.props.rowKey, rowKey = _b === void 0 ? 'id' : _b;\r\n            var index = dataSource.findIndex(function (x) {\r\n                var key = rowKey && typeof rowKey === 'function' ? rowKey(x) : rowKey;\r\n                return x[key] === restProps['data-row-key'];\r\n            });\r\n            return (\r\n            // @ts-ignore\r\n            React.createElement(SortableItem, __assign({ index: index }, (_this.props.sortable &&\r\n                typeof _this.props.sortable !== 'boolean' &&\r\n                _this.props.sortable.itemProps), restProps)));\r\n        };\r\n        /*\r\n         * 覆盖antdTable的tbody helperClass为拖拽项的类名\r\n         */\r\n        _this.DraggableContainer = function (containerProps) { return (\r\n        // @ts-ignore\r\n        React.createElement(SortableWrapper, __assign({ helperClass: \"\".concat(selectorPrefix, \"-row-dragging\"), onSortEnd: _this.onSortEnd, distance: 2 }, (_this.props.sortable &&\r\n            typeof _this.props.sortable !== 'boolean' &&\r\n            _this.props.sortable.containerProps), containerProps))); };\r\n        /**\r\n         * 拖拽完成时更改dataSource\r\n         */\r\n        _this.onSortEnd = function (_a) {\r\n            var oldIndex = _a.oldIndex, newIndex = _a.newIndex;\r\n            var dataSource = _this.state.dataSource;\r\n            if (oldIndex !== newIndex) {\r\n                var oldItem = dataSource[oldIndex];\r\n                var newData = dataSource.filter(function (_, i) { return i !== oldIndex; });\r\n                newData.splice(newIndex, 0, oldItem);\r\n                _this.setState({ isSort: true, dataSource: newData });\r\n            }\r\n        };\r\n        return _this;\r\n    }\r\n    SortableTable.getDerivedStateFromProps = function (nextProps, prevState) {\r\n        if (!prevState.isSort &&\r\n            JSON.stringify(nextProps.dataSource) !== JSON.stringify(prevState.dataSource)) {\r\n            return {\r\n                dataSource: nextProps.dataSource,\r\n            };\r\n        }\r\n        if (prevState.isSort) {\r\n            return {\r\n                isSort: false,\r\n            };\r\n        }\r\n        return null;\r\n    };\r\n    SortableTable.prototype.render = function () {\r\n        var _a = this.props, sortable = _a.sortable, others = __rest(_a, [\"sortable\"]);\r\n        return (React.createElement(Table, __assign({}, others, { dataSource: this.state.dataSource, components: {\r\n                body: {\r\n                    wrapper: this.DraggableContainer,\r\n                    row: this.DraggableBodyRow,\r\n                },\r\n            } })));\r\n    };\r\n    return SortableTable;\r\n}(React.Component));\r\nexport default SortableTable;\r\n//# sourceMappingURL=sortabletable.js.map"],"names":["__assign","__extends","__rest","Table","React","SortableContainer","SortableElement","selectorPrefix","SortableItem","props","createElement","SortableWrapper","SortableTable","_super","_this","apply","this","arguments","state","dataSource","isSort","DraggableBodyRow","_a","className","style","restProps","_b","rowKey","index","findIndex","x","sortable","itemProps","DraggableContainer","containerProps","helperClass","concat","onSortEnd","distance","oldItem","oldIndex","newIndex","newData","filter","_","i","splice","setState","getDerivedStateFromProps","nextProps","prevState","JSON","stringify","prototype","render","others","components","body","wrapper","row","Component"],"mappings":"OAASA,SAAUC,UAAWC,MAAqB,KAAP,eAQnCC,KAAmB,KAAN,cACfC,UAAW,eACTC,kBAAmBC,eAA2C,KAApB,4BAC1CC,cAAmC,KAAb,cAC/B,IAAIC,aAAeF,gBAAgB,SAAUG,GAAS,OAAOL,MAAMM,cAAc,KAAMV,SAAS,GAAIS,CAAK,CAAC,CAAG,CAAC,EAC1GE,gBAAkBN,kBAAkB,SAAUI,GAAS,OAAOL,MAAMM,cAAc,QAASV,SAAS,GAAIS,CAAK,CAAC,CAAG,CAAC,EAClHG,cAA+B,SAAUC,GAEzC,SAASD,IACL,IAAIE,EAAmB,OAAXD,GAAmBA,EAAOE,MAAMC,KAAMC,SAAS,GAAKD,KA2ChE,OA1CAF,EAAMI,MAAQ,CACVC,WAAYL,EAAML,MAAMU,YAAc,GACtCC,OAAQ,CAAA,CACZ,EAIAN,EAAMO,iBAAmB,SAAUC,GACfA,EAAGC,UAAmBD,EAAGE,MAAzC,IAAgDC,EAAYvB,OAAOoB,EAAI,CAAC,YAAa,QAAQ,EACzFH,EAAaL,EAAMI,MAAMC,WACzBO,EAAKZ,EAAML,MAAMkB,OAAQA,EAAgB,KAAA,IAAPD,EAAgB,KAAOA,EACzDE,EAAQT,EAAWU,UAAU,SAAUC,GAEvC,OAAOA,EADGH,GAA4B,YAAlB,OAAOA,EAAwBA,EAAOG,CAAC,EAAIH,KAC7CF,EAAU,eAChC,CAAC,EACD,OAEArB,MAAMM,cAAcF,aAAcR,SAAS,CAAE4B,MAAOA,CAAM,EAAId,EAAML,MAAMsB,UACtC,WAAhC,OAAOjB,EAAML,MAAMsB,UACnBjB,EAAML,MAAMsB,SAASC,UAAYP,CAAS,CAAE,CACpD,EAIAX,EAAMmB,mBAAqB,SAAUC,GAAkB,OAEvD9B,MAAMM,cAAcC,gBAAiBX,SAAS,CAAEmC,YAAa,GAAGC,OAAO7B,eAAgB,eAAe,EAAG8B,UAAWvB,EAAMuB,UAAWC,SAAU,CAAE,EAAIxB,EAAML,MAAMsB,UAC7H,WAAhC,OAAOjB,EAAML,MAAMsB,UACnBjB,EAAML,MAAMsB,SAASG,eAAiBA,CAAc,CAAE,CAAG,EAI7DpB,EAAMuB,UAAY,SAAUf,GACxB,IAGQiB,EAHJC,EAAWlB,EAAGkB,SAAUC,EAAWnB,EAAGmB,SACtCtB,EAAaL,EAAMI,MAAMC,WACzBqB,IAAaC,IACTF,EAAUpB,EAAWqB,IACrBE,EAAUvB,EAAWwB,OAAO,SAAUC,EAAGC,GAAK,OAAOA,IAAML,CAAU,CAAC,GAClEM,OAAOL,EAAU,EAAGF,CAAO,EACnCzB,EAAMiC,SAAS,CAAE3B,OAAQ,CAAA,EAAMD,WAAYuB,CAAQ,CAAC,EAE5D,EACO5B,CACX,CAwBA,OAtEAb,UAAUW,EAAeC,CAAM,EA+C/BD,EAAcoC,yBAA2B,SAAUC,EAAWC,GAC1D,OAAKA,EAAU9B,QACX+B,KAAKC,UAAUH,EAAU9B,UAAU,IAAMgC,KAAKC,UAAUF,EAAU/B,UAAU,EAK5E+B,EAAU9B,OACH,CACHA,OAAQ,CAAA,CACZ,EAEG,KATI,CACHD,WAAY8B,EAAU9B,UAC1B,CAQR,EACAP,EAAcyC,UAAUC,OAAS,WAC7B,IAAIhC,EAAKN,KAAKP,MAA+B8C,GAAbjC,EAAGS,SAAmB7B,OAAOoB,EAAI,CAAC,WAAW,GAC7E,OAAQlB,MAAMM,cAAcP,MAAOH,SAAS,GAAIuD,EAAQ,CAAEpC,WAAYH,KAAKE,MAAMC,WAAYqC,WAAY,CACjGC,KAAM,CACFC,QAAS1C,KAAKiB,mBACd0B,IAAK3C,KAAKK,gBACd,CACJ,CAAE,CAAC,CAAE,CACb,EACOT,CACX,EAAER,MAAMwD,SAAU,iBACHhD"}