var __extends=this&&this.__extends||function(){var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)};return function(e,t){function o(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}}(),__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,o=1,r=arguments.length;o<r;o++)for(var n in t=arguments[o])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},__rest=this&&this.__rest||function(e,t){var o={};for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(o[n[r]]=e[n[r]]);return o};import React from"react";import classNames from"classnames";import{Form,Button,Skeleton,Table,List,Checkbox}from"antd";import FormItemCreator from"@baifendian/adhere-ui-formitemcreator";import intl from"@baifendian/adhere-util-intl";import{cloneDeep}from"lodash";import SortableTable from"./sortabletable";import{ToolbarSelectAll,ToolbarReload,ToolbarSetting}from"./tablelisttoolbar";import Util from"./util";var selectorPrefix="adhere-ui-tablelist",defaultRowKey="id",TableList=function(t){function e(e){var g=t.call(this,e)||this;g.renderToolbar=function(){if(g.props.toolbar){var e=g.getModeProps(),t=e.dataSource,o=e.rowKey,r=e.pagination,n=g.props.toolbar,a=n.className,l=n.title,s=n.total,i=n.selectAll,c=n.search,u=n.reload,m=n.setting,d=n.toolbarOptionRender,f=g.state,e=f.selectedColumnKeys,n=f.tableColumns,f=g.getRowSelection();return React.createElement("div",{className:classNames(a,selectorPrefix+"-toolbar")},React.createElement("div",{className:selectorPrefix+"-toolbar-left"},l?React.createElement("span",{className:selectorPrefix+"-toolbar-left-title"},l):null,s?React.createElement("span",{className:selectorPrefix+"-toolbar-left-total"},!0===s?intl.vHtml("共 <em>{n}</em> 条",{n:r&&r.total}):s):null,i?React.createElement(ToolbarSelectAll,{selectAll:i,dataSource:t,rowSelection:f,rowKey:o,setSelectAll:function(e){return g.setState({selectAll:e})}}):null),React.createElement("div",{className:selectorPrefix+"-toolbar-right"},d,c?React.createElement(FormItemCreator,{columns:g.getFormColumns(c||[],"default",!0)}):null,u?React.createElement(ToolbarReload,{reload:u,onSearch:g.onSearch}):null,m?React.createElement(ToolbarSetting,{setting:m,tableColumns:n,onSettingChange:g.onSettingChange,onSettingSortEnd:g.onSettingSortEnd,selectedColumnKeys:e}):null))}},g.renderList=function(){if(g.props.list){var e=g.getModeProps(),r=e.rowKey,t=e.pagination,o=e.loading,n=e.renderItem,e=__rest(e,["rowKey","pagination","loading","renderItem"]),a=g.getRowSelection();return React.createElement(List,__assign({rowKey:r,pagination:g.getPagination(t),loading:g.getLoading(o),renderItem:function(t,e){var o="function"==typeof r?r(t):r;return React.createElement(List.Item,null,React.createElement(React.Fragment,null,a?React.createElement(Checkbox,{checked:a.selectedRowKeys.includes(t[o]),onChange:function(e){e.target.checked?(a.selectedRowKeys.push(t[o]),a.selectedRows.push(t),a.onChange(a.selectedRowKeys,a.selectedRows)):a.onChange(a.selectedRowKeys.filter(function(e){return e!==t[o]}),a.selectedRows.filter(function(e){return e[o]!==t[o]}))}}):null,n&&n(t,e)))}},e))}},g.renderTable=function(){if(g.props.table){var e=g.state,t=e.selectedColumnKeys,o=e.tableColumns,r=g.getModeProps(),n=r.sortable,a=r.pagination,l=r.loading,s=r.dataSource,e=(r.columns,r.rowKey),r=(r.rowSelection,__rest(r,["sortable","pagination","loading","dataSource","columns","rowKey","rowSelection"])),r=__assign({pagination:g.getPagination(a),loading:g.getLoading(l),rowSelection:g.getRowSelection(),columns:o.filter(function(e){return t.includes(e.key)}),dataSource:s,onChange:g.onTableChange},r);return n?React.createElement(SortableTable,__assign({ref:function(e){g.SortableTableRef=e},rowKey:e},r,{sortable:n})):React.createElement(Table,__assign({rowKey:e},r))}};e=new Util(g);g.getModeProps=e.getModeProps,g.getDefaultSelectedColumnKeys=e.getDefaultSelectedColumnKeys,g.getFormColumns=e.getFormColumns,g.getSortDataSource=e.getSortDataSource,g.getParams=e.getParams,g.getRowSelection=e.getRowSelection,g.getPagination=e.getPagination,g.getLoading=e.getLoading,g.getTableColumns=e.getTableColumns,g.fetchList=e.fetchList,g.onSearch=e.onSearch,g.onResetSearch=e.onResetSearch,g.onSettingChange=e.onSettingChange,g.onSettingSortEnd=e.onSettingSortEnd,g.onTableChange=e.onTableChange,g.searchFormRef=React.createRef();e=g.getModeProps();return g.state={firstLoading:!0,loading:!1,selectedColumnKeys:g.props.table?g.getDefaultSelectedColumnKeys(g.props.table.columns):[],tableColumns:[],params:{page:1,limit:e&&e.pagination&&e.pagination.defaultPageSize||10}},g}return __extends(e,t),e.getDerivedStateFromProps=function(e,t){var o=(e[e.mode||"table"]||{}).dataSource;return!e.request&&null!=t&&t.firstLoading&&o||e.request&&null!=t&&t.firstLoading&&null!=t&&t.firstRequest&&o?{firstLoading:!1}:null},e.prototype.componentDidMount=function(){var e=this,t=this.getModeProps();this.props.request?this.setState({firstRequest:!0},function(){return e.fetchList()}):t.dataSource&&this.setState({firstLoading:!1}),this.setState({tableColumns:this.getTableColumns()})},e.prototype.shouldComponentUpdate=function(e,o){var t=e[e.mode||"table"]||{},r=this.getModeProps();if(o.selectAll&&JSON.stringify(t.dataSource)!==JSON.stringify(r.dataSource)){var r=t.dataSource,t=t.rowKey,n=void 0===t?defaultRowKey:t,t=(r||[]).map(function(e){return e["function"==typeof n?n(e):n]}).filter(function(e){var t;return!(null!==(t=null===(t=o.selectAll)||void 0===t?void 0:t.exceptKeys)&&void 0!==t&&t.includes(e))});return"table"===e.mode&&e.table&&e.table.rowSelection&&e.table.rowSelection.onChange?(e.table.rowSelection.onChange(t,cloneDeep(r)),!1):(this.setState({selectedRowKeys:t,selectedRows:r}),!1)}return!0},e.prototype.renderSearch=function(){var e=this,t=this.props.search;if(t){var o=t.className,r=t.beforeContent,n=t.afterContent,a=t.optionRender,l=t.columns,s=t.searchText,i=t.resetText,c=t.size,c=void 0===c?"middle":c;return t?React.createElement("div",{className:classNames(o,selectorPrefix+"-search")},r,React.createElement(Form,{layout:"inline",ref:this.searchFormRef,className:classNames(selectorPrefix+"-search-form",((o={})[selectorPrefix+"-search-form-havebefore"]=r,o[selectorPrefix+"-search-form-haveafter"]=n,o))},React.createElement("div",{className:"ant-form-search"},React.createElement(FormItemCreator,{columns:this.getFormColumns(l||[],c,t.hasOwnProperty("optionRender")&&!a)})),t.hasOwnProperty("optionRender")?a:React.createElement("div",{className:"ant-form-btngroup"},React.createElement(Button,{onClick:function(){return e.onResetSearch()},size:c},i||intl.v("重置")),React.createElement(Button,{type:"primary",onClick:function(){return e.onSearch()},size:c},s||intl.v("搜索")))),n):null}},e.prototype.renderContent=function(){var e=this.props.mode;return React.createElement("div",{className:selectorPrefix+"-content"},this.renderToolbar(),this.state.firstLoading?this.renderLoading():"list"===e?this.renderList():this.renderTable())},e.prototype.renderLoading=function(){return React.createElement(Skeleton,{paragraph:{rows:10},title:!1})},e.prototype.render=function(){var t=this,e=this.props.className;return React.createElement("div",{className:classNames(selectorPrefix,e),ref:function(e){t.TableListRef=e}},this.renderSearch(),this.renderContent())},e}(React.Component);TableList.defaultProps={mode:"table"};export default TableList;
//# sourceMappingURL=tablelist.js.map
