import{__assign,__extends,__rest}from"tslib";import{Button,Checkbox,Form,List,Skeleton,Table}from"antd";import classNames from"classnames";import{cloneDeep}from"lodash";import React from"react";import FormItemCreator from"@baifendian/adhere-ui-formitemcreator";import intl from"@baifendian/adhere-util-intl";import SortableTable from"./sortabletable";import{ToolbarReload,ToolbarSelectAll,ToolbarSetting}from"./tablelisttoolbar";import Util from"./util";var selectorPrefix="adhere-ui-tablelist",defaultRowKey="id",TableList=function(t){function e(e){var f=t.call(this,e)||this,e=(f.renderToolbar=function(){var e,t,o,a,n,r,l,s,i,c,m,u,d,g;if(f.props.toolbar)return e=(o=f.getModeProps()).dataSource,t=o.rowKey,o=o.pagination,a=(m=f.props.toolbar).className,n=m.title,r=m.total,l=m.selectAll,s=m.search,i=m.reload,c=m.setting,m=m.toolbarOptionRender,u=(d=f.state).selectedColumnKeys,d=d.tableColumns,g=f.getRowSelection(),React.createElement("div",{className:classNames(a,"".concat(selectorPrefix,"-toolbar"))},React.createElement("div",{className:"".concat(selectorPrefix,"-toolbar-left")},n?React.createElement("span",{className:"".concat(selectorPrefix,"-toolbar-left-title")},n):null,r?React.createElement("span",{className:"".concat(selectorPrefix,"-toolbar-left-total")},!0===r?intl.vHtml("共 <em>{n}</em> 条",{n:o&&o.total}):r):null,l?React.createElement(ToolbarSelectAll,{selectAll:l,dataSource:e,rowSelection:g,rowKey:t,setSelectAll:function(e){return f.setState({selectAll:e})}}):null),React.createElement("div",{className:"".concat(selectorPrefix,"-toolbar-right")},m,s?React.createElement(FormItemCreator,{columns:f.getFormColumns(s||[],"default",!0)}):null,i?React.createElement(ToolbarReload,{reload:i,onSearch:f.onSearch}):null,c?React.createElement(ToolbarSetting,{setting:c,tableColumns:d,onSettingChange:f.onSettingChange,onSettingSortEnd:f.onSettingSortEnd,selectedColumnKeys:u}):null))},f.renderList=function(){var a,e,t,n,o,r;if(f.props.list)return o=f.getModeProps(),a=o.rowKey,e=o.pagination,t=o.loading,n=o.renderItem,o=__rest(o,["rowKey","pagination","loading","renderItem"]),r=f.getRowSelection(),React.createElement(List,__assign({rowKey:a,pagination:f.getPagination(e),loading:f.getLoading(t),renderItem:function(t,e){var o="function"==typeof a?a(t):a;return React.createElement(List.Item,null,React.createElement(React.Fragment,null,r?React.createElement(Checkbox,{checked:r.selectedRowKeys.includes(t[o]),onChange:function(e){e.target.checked?(r.selectedRowKeys.push(t[o]),r.selectedRows.push(t),r.onChange(r.selectedRowKeys,r.selectedRows)):r.onChange(r.selectedRowKeys.filter(function(e){return e!==t[o]}),r.selectedRows.filter(function(e){return e[o]!==t[o]}))}}):null,n&&n(t,e)))}},o))},f.renderTable=function(){var t,e,o,a,n,r,l,s;if(f.props.table)return e=f.state,t=e.selectedColumnKeys,e=e.tableColumns,o=(l=f.getModeProps()).sortable,s=l.pagination,a=l.loading,n=l.dataSource,l.columns,r=l.rowKey,l.rowSelection,l=__rest(l,["sortable","pagination","loading","dataSource","columns","rowKey","rowSelection"]),s=__assign({pagination:f.getPagination(s),loading:f.getLoading(a),rowSelection:f.getRowSelection(),columns:e.filter(function(e){return t.includes(e.key)}),dataSource:n,onChange:f.onTableChange},l),o?React.createElement(SortableTable,__assign({ref:function(e){f.SortableTableRef=e},rowKey:r},s,{sortable:o})):React.createElement(Table,__assign({rowKey:r},s))},new Util(f)),e=(f.getModeProps=e.getModeProps,f.getDefaultSelectedColumnKeys=e.getDefaultSelectedColumnKeys,f.getFormColumns=e.getFormColumns,f.getSortDataSource=e.getSortDataSource,f.getParams=e.getParams,f.getRowSelection=e.getRowSelection,f.getPagination=e.getPagination,f.getLoading=e.getLoading,f.getTableColumns=e.getTableColumns,f.fetchList=e.fetchList,f.onSearch=e.onSearch,f.onResetSearch=e.onResetSearch,f.onSettingChange=e.onSettingChange,f.onSettingSortEnd=e.onSettingSortEnd,f.onTableChange=e.onTableChange,f.searchFormRef=React.createRef(),f.getModeProps());return f.state={firstLoading:!0,loading:!1,selectedColumnKeys:f.props.table?f.getDefaultSelectedColumnKeys(f.props.table.columns):[],tableColumns:[],params:{page:1,limit:e&&e.pagination&&e.pagination.defaultPageSize||10}},f}return __extends(e,t),e.getDerivedStateFromProps=function(e,t){var o=(e[e.mode||"table"]||{}).dataSource;return!e.request&&null!=t&&t.firstLoading&&o||e.request&&null!=t&&t.firstLoading&&null!=t&&t.firstRequest&&o?{firstLoading:!1}:null},e.prototype.componentDidMount=function(){var e=this,t=this.getModeProps();this.props.request?this.setState({firstRequest:!0},function(){return e.fetchList()}):t.dataSource&&this.setState({firstLoading:!1}),this.setState({tableColumns:this.getTableColumns()})},e.prototype.shouldComponentUpdate=function(e,o){var t,a=e[e.mode||"table"]||{},n=this.getModeProps();return!o.selectAll||JSON.stringify(a.dataSource)===JSON.stringify(n.dataSource)||(n=a.dataSource,a=a.rowKey,t=void 0===a?defaultRowKey:a,a=(n||[]).map(function(e){return e["function"==typeof t?t(e):t]}).filter(function(e){var t;return!(null!=(t=null==(t=o.selectAll)?void 0:t.exceptKeys)&&t.includes(e))}),"table"===e.mode&&e.table&&e.table.rowSelection&&e.table.rowSelection.onChange?e.table.rowSelection.onChange(a,cloneDeep(n)):this.setState({selectedRowKeys:a,selectedRows:n}),!1)},e.prototype.renderSearch=function(){var e,t,o,a,n,r,l,s,i=this,c=this.props.search;if(c)return e=c.className,t=c.beforeContent,o=c.afterContent,a=c.optionRender,n=c.columns,r=c.searchText,l=c.resetText,s=void 0===(s=c.size)?"middle":s,c?React.createElement("div",{className:classNames(e,"".concat(selectorPrefix,"-search"))},t,React.createElement(Form,{layout:"inline",ref:this.searchFormRef,className:classNames("".concat(selectorPrefix,"-search-form"),((e={})["".concat(selectorPrefix,"-search-form-havebefore")]=t,e["".concat(selectorPrefix,"-search-form-haveafter")]=o,e))},React.createElement("div",{className:"ant-form-search"},React.createElement(FormItemCreator,{columns:this.getFormColumns(n||[],s,c.hasOwnProperty("optionRender")&&!a)})),c.hasOwnProperty("optionRender")?a:React.createElement("div",{className:"ant-form-btngroup"},React.createElement(Button,{onClick:function(){return i.onResetSearch()},size:s},l||intl.v("重置")),React.createElement(Button,{type:"primary",onClick:function(){return i.onSearch()},size:s},r||intl.v("搜索")))),o):null},e.prototype.renderContent=function(){var e=this.props.mode;return React.createElement("div",{className:"".concat(selectorPrefix,"-content")},this.renderToolbar(),this.state.firstLoading?this.renderLoading():"list"===e?this.renderList():this.renderTable())},e.prototype.renderLoading=function(){return React.createElement(Skeleton,{paragraph:{rows:10},title:!1})},e.prototype.render=function(){var t=this,e=this.props.className;return React.createElement("div",{className:classNames(selectorPrefix,e),ref:function(e){t.TableListRef=e}},this.renderSearch(),this.renderContent())},e}(React.PureComponent);TableList.defaultProps={mode:"table"};export default TableList;export{selectorPrefix};
//# sourceMappingURL=tablelist.js.map
