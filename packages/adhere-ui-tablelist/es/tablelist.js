import _Skeleton from"antd/es/skeleton";import _Button from"antd/es/button";import _Form from"antd/es/form";import _Table from"antd/es/table";import _Checkbox from"antd/es/checkbox";import _List from"antd/es/list";var __extends=this&&this.__extends||function(){var r=function(e,t){return(r=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}))(e,t)};return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function o(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}}(),__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,o=1,r=arguments.length;o<r;o++)for(var n in t=arguments[o])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},__rest=this&&this.__rest||function(e,t){var o={};for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(o[n[r]]=e[n[r]]);return o};import classNames from"classnames";import{cloneDeep}from"lodash";import React from"react";import FormItemCreator from"@baifendian/adhere-ui-formitemcreator";import intl from"@baifendian/adhere-util-intl";import SortableTable from"./sortabletable";import{ToolbarReload,ToolbarSelectAll,ToolbarSetting}from"./tablelisttoolbar";import Util from"./util";var selectorPrefix="adhere-ui-tablelist",defaultRowKey="id",TableList=function(t){function e(e){var p=t.call(this,e)||this,e=(p.renderToolbar=function(){var e,t,o,r,n,a,l,s,i,c,u,m,f,d;if(p.props.toolbar)return e=(o=p.getModeProps()).dataSource,t=o.rowKey,o=o.pagination,r=(u=p.props.toolbar).className,n=u.title,a=u.total,l=u.selectAll,s=u.search,i=u.reload,c=u.setting,u=u.toolbarOptionRender,m=(f=p.state).selectedColumnKeys,f=f.tableColumns,d=p.getRowSelection(),React.createElement("div",{className:classNames(r,"".concat(selectorPrefix,"-toolbar"))},React.createElement("div",{className:"".concat(selectorPrefix,"-toolbar-left")},n?React.createElement("span",{className:"".concat(selectorPrefix,"-toolbar-left-title")},n):null,a?React.createElement("span",{className:"".concat(selectorPrefix,"-toolbar-left-total")},!0===a?intl.vHtml("共 <em>{n}</em> 条",{n:o&&o.total}):a):null,l?React.createElement(ToolbarSelectAll,{selectAll:l,dataSource:e,rowSelection:d,rowKey:t,setSelectAll:function(e){return p.setState({selectAll:e})}}):null),React.createElement("div",{className:"".concat(selectorPrefix,"-toolbar-right")},u,s?React.createElement(FormItemCreator,{columns:p.getFormColumns(s||[],"default",!0)}):null,i?React.createElement(ToolbarReload,{reload:i,onSearch:p.onSearch}):null,c?React.createElement(ToolbarSetting,{setting:c,tableColumns:f,onSettingChange:p.onSettingChange,onSettingSortEnd:p.onSettingSortEnd,selectedColumnKeys:m}):null))},p.renderList=function(){var r,e,t,n,o,a;if(p.props.list)return o=p.getModeProps(),r=o.rowKey,e=o.pagination,t=o.loading,n=o.renderItem,o=__rest(o,["rowKey","pagination","loading","renderItem"]),a=p.getRowSelection(),React.createElement(_List,__assign({rowKey:r,pagination:p.getPagination(e),loading:p.getLoading(t),renderItem:function(t,e){var o="function"==typeof r?r(t):r;return React.createElement(_List.Item,null,React.createElement(React.Fragment,null,a?React.createElement(_Checkbox,{checked:a.selectedRowKeys.includes(t[o]),onChange:function(e){e.target.checked?(a.selectedRowKeys.push(t[o]),a.selectedRows.push(t),a.onChange(a.selectedRowKeys,a.selectedRows)):a.onChange(a.selectedRowKeys.filter(function(e){return e!==t[o]}),a.selectedRows.filter(function(e){return e[o]!==t[o]}))}}):null,n&&n(t,e)))}},o))},p.renderTable=function(){var t,e,o,r,n,a,l,s;if(p.props.table)return e=p.state,t=e.selectedColumnKeys,e=e.tableColumns,o=(l=p.getModeProps()).sortable,s=l.pagination,r=l.loading,n=l.dataSource,l.columns,a=l.rowKey,l.rowSelection,l=__rest(l,["sortable","pagination","loading","dataSource","columns","rowKey","rowSelection"]),s=__assign({pagination:p.getPagination(s),loading:p.getLoading(r),rowSelection:p.getRowSelection(),columns:e.filter(function(e){return t.includes(e.key)}),dataSource:n,onChange:p.onTableChange},l),o?React.createElement(SortableTable,__assign({ref:function(e){p.SortableTableRef=e},rowKey:a},s,{sortable:o})):React.createElement(_Table,__assign({rowKey:a},s))},new Util(p)),e=(p.getModeProps=e.getModeProps,p.getDefaultSelectedColumnKeys=e.getDefaultSelectedColumnKeys,p.getFormColumns=e.getFormColumns,p.getSortDataSource=e.getSortDataSource,p.getParams=e.getParams,p.getRowSelection=e.getRowSelection,p.getPagination=e.getPagination,p.getLoading=e.getLoading,p.getTableColumns=e.getTableColumns,p.fetchList=e.fetchList,p.onSearch=e.onSearch,p.onResetSearch=e.onResetSearch,p.onSettingChange=e.onSettingChange,p.onSettingSortEnd=e.onSettingSortEnd,p.onTableChange=e.onTableChange,p.searchFormRef=React.createRef(),p.getModeProps());return p.state={firstLoading:!0,loading:!1,selectedColumnKeys:p.props.table?p.getDefaultSelectedColumnKeys(p.props.table.columns):[],tableColumns:[],params:{page:1,limit:e&&e.pagination&&e.pagination.defaultPageSize||10}},p}return __extends(e,t),e.getDerivedStateFromProps=function(e,t){var o=(null!=(o=e[e.mode||"table"])?o:{}).dataSource;return!e.request&&null!=t&&t.firstLoading&&o||e.request&&null!=t&&t.firstLoading&&null!=t&&t.firstRequest&&o?{firstLoading:!1}:null},e.prototype.componentDidMount=function(){var e=this,t=this.getModeProps();this.props.request?this.setState({firstRequest:!0},function(){return e.fetchList()}):t.dataSource&&this.setState({firstLoading:!1}),this.setState({tableColumns:this.getTableColumns()})},e.prototype.shouldComponentUpdate=function(e,o){var t,r=null!=(r=e[e.mode||"table"])?r:{},n=this.getModeProps();return!o.selectAll||JSON.stringify(r.dataSource)===JSON.stringify(n.dataSource)||(n=r.dataSource,r=r.rowKey,t=void 0===r?defaultRowKey:r,r=(n||[]).map(function(e){return e["function"==typeof t?t(e):t]}).filter(function(e){var t;return!(null!=(t=null==(t=o.selectAll)?void 0:t.exceptKeys)&&t.includes(e))}),"table"===e.mode&&e.table&&e.table.rowSelection&&e.table.rowSelection.onChange?e.table.rowSelection.onChange(r,cloneDeep(n)):this.setState({selectedRowKeys:r,selectedRows:n}),!1)},e.prototype.renderSearch=function(){var e,t,o,r,n,a,l,s,i=this,c=this.props.search;if(c)return e=c.className,t=c.beforeContent,o=c.afterContent,r=c.optionRender,n=c.columns,a=c.searchText,l=c.resetText,s=void 0===(s=c.size)?"middle":s,c?React.createElement("div",{className:classNames(e,"".concat(selectorPrefix,"-search"))},t,React.createElement(_Form,{layout:"inline",ref:this.searchFormRef,className:classNames("".concat(selectorPrefix,"-search-form"),((e={})["".concat(selectorPrefix,"-search-form-havebefore")]=t,e["".concat(selectorPrefix,"-search-form-haveafter")]=o,e))},React.createElement("div",{className:"ant-form-search"},React.createElement(FormItemCreator,{columns:this.getFormColumns(n||[],s,c.hasOwnProperty("optionRender")&&!r)})),c.hasOwnProperty("optionRender")?r:React.createElement("div",{className:"ant-form-btngroup"},React.createElement(_Button,{onClick:function(){return i.onResetSearch()},size:s},l||intl.v("重置")),React.createElement(_Button,{type:"primary",onClick:function(){return i.onSearch()},size:s},a||intl.v("搜索")))),o):null},e.prototype.renderContent=function(){var e=this.props.mode;return React.createElement("div",{className:"".concat(selectorPrefix,"-content")},this.renderToolbar(),this.state.firstLoading?this.renderLoading():"list"===e?this.renderList():this.renderTable())},e.prototype.renderLoading=function(){return React.createElement(_Skeleton,{paragraph:{rows:10},title:!1})},e.prototype.render=function(){var t=this,e=this.props.className;return React.createElement("div",{className:classNames(selectorPrefix,e),ref:function(e){t.TableListRef=e}},this.renderSearch(),this.renderContent())},e}(React.PureComponent);TableList.defaultProps={mode:"table"};export default TableList;export{selectorPrefix};
//# sourceMappingURL=tablelist.js.map
