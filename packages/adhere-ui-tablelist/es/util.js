import _Tooltip from"antd/es/tooltip";import"core-js/modules/es.array.map.js";import"core-js/modules/es.array.filter.js";import"core-js/modules/es.object.to-string.js";import"core-js/modules/es.array.includes.js";import"core-js/modules/es.string.includes.js";import"core-js/modules/es.array.concat.js";import"core-js/modules/es.array.find.js";import"core-js/modules/es.regexp.to-string.js";import"core-js/modules/es.array.splice.js";import"core-js/modules/es.regexp.exec.js";import"core-js/modules/es.string.replace.js";import{__assign}from"tslib";import{difference,isEmpty,union}from"lodash";import moment from"moment";import React from"react";import FormItemCreator from"@baifendian/adhere-ui-formitemcreator";import intl from"@baifendian/adhere-util-intl";var Util=function(e){var a=this;this.getModeProps=function(){return __assign({rowKey:"id"},a.ins.props[a.ins.props.mode||"table"])},this.getDefaultSelectedColumnKeys=function(e){var t=a.getModeProps().showNumber,e=(e||[]).filter(function(e){return e.show||!e.hasOwnProperty("show")}).map(function(e){return e.key});return t&&!e.includes("xuhao")&&e.unshift((null==t?void 0:t.key)||"xuhao"),e},this.getRowSelection=function(){var e=a.ins.state,t=e.selectedRowKeys,t=void 0===t?[]:t,n=e.selectedRows,n=void 0===n?[]:n,e=e.selectAll,s=a.getModeProps().rowSelection;return s?__assign(__assign({clearOnChange:!1},s),{onChange:a.onSelectChange,selectedRowKeys:s.selectedRowKeys||t,selectedRows:n,selectAll:e}):null},this.getSortDataSource=function(){return a.ins.SortableTableRef.state.dataSource},this.getParams=function(){var e=a.ins.props.params,t={};return a.ins.searchFormRef&&a.ins.searchFormRef.current&&(t=a.ins.searchFormRef.current.getFieldsValue()),__assign(__assign(__assign({},t),a.ins.state.params),e)},this.getFormColumns=function(e,t,s){return e.map(function(e){var n=e;return n.contentProps=n.contentProps||{},n.contentProps.size=t,n.type!==FormItemCreator.RANGEPICKER&&n.type!==FormItemCreator.SELECT||(n.contentProps=__assign({getPopupContainer:function(){return a.ins.TableListRef}},n.contentProps)),n.type===FormItemCreator.SELECT&&(n.contentProps=__assign({style:{width:"150px"},allowClear:!0},n.contentProps)),s&&(n.contentProps=__assign({onSearch:n.type===FormItemCreator.SEARCH?function(e){var t;return a.onSearch(((t={})[n.name]=e,t))}:null,onPressEnter:n.type!==FormItemCreator.SEARCH?function(e){var t;return a.onSearch(((t={})[n.name]=[FormItemCreator.INPUT,FormItemCreator.TEXTAREA,FormItemCreator.NUMBER].includes(n.type)?e.target.value:e,t))}:null},n.contentProps)),n})},this.getPagination=function(e){var t=a.ins.state.params;return __assign({size:"default",defaultPageSize:10,current:t.page,pageSize:t.limit,showSizeChanger:!0,pageSizeOptions:["10","20","50"],showQuickJumper:!0,showTotal:function(e,t){var n=t[0],t=t[1];return"当前 ".concat(n,"-").concat(t,"/共 ").concat(e," 条")},onChange:a.onPageChange,onShowSizeChange:a.onPageChange},e)},this.getTableColumns=function(){var s=a.ins.state.params,e=a.getModeProps(),t=e.columns,e=e.showNumber,t=(t||[]).map(function(r){var e;return __assign(__assign({},r),{render:function(t,e,n){var s="";return s=r.render?r.render(t,e,n):"date"===r.valueType?t?moment(t).format("L"):"-":"datetime"===r.valueType?t?moment(t).format("LLL"):"-":"map"===r.valueType&&r.map?(e=t&&(r.map||[]).find(function(e){return e.value.toString()===t.toString()}),t&&e?e.label:"-"):t,null!=r&&r.ellipsis?React.createElement(_Tooltip,{title:s,placement:"topLeft"},s):s},filtered:(null==(e=r.filters)?void 0:e.length)&&s[r.key]})});return e&&!t.find(function(e){return"xuhao"===e.key})&&t.unshift(__assign({title:intl.v("序号"),dataIndex:"xuhao",key:"xuhao",width:80,render:function(e,t,n){return(s.page-1)*s.limit+n+1}},e)),t},this.getLoading=function(e){return!(!e&&!a.ins.state.loading)&&(e&&e.hasOwnProperty("size")?e:{size:"large"})},this.fetchList=function(e){e=__assign(__assign({},a.getParams()),e);a.ins.props.request&&(a.ins.setState({loading:!0}),a.ins.props.request(e).then(function(){a.ins.setState({loading:!1})}))},this.onSearch=function(e){var t=a.ins.state.params,n=a.getRowSelection();n&&!n.selectAll&&n.clearOnChange&&n.onChange([],[]),a.ins.setState({params:__assign(__assign(__assign({},t),e),{page:1})},function(){a.fetchList()})},this.onResetSearch=function(){var e=a.ins.state.params,t=a.getRowSelection();a.ins.searchFormRef&&a.ins.searchFormRef.current&&a.ins.searchFormRef.current.resetFields(),e.page=1,t&&t.onChange([],[]),a.ins.setState({params:e},function(){a.fetchList()})},this.onSettingChange=function(e){a.ins.setState({selectedColumnKeys:e})},this.onSettingSortEnd=function(e){var t,n=e.oldIndex,e=e.newIndex,s=a.ins.state.tableColumns;n!==e&&(t=s[n],(s=s.filter(function(e,t){return t!==n})).splice(e,0,t),a.ins.setState({tableColumns:s}))},this.onTableChange=function(e,t,n){if(!isEmpty(n)||!isEmpty(t)){var s,r=__assign(__assign({},a.ins.state.params),{order:null==(o=null==n?void 0:n.order)?void 0:o.replace("end",""),sidx:null==n?void 0:n.field});for(s in t)r[s]=t[s].join(","),r.page=1;var o=a.getRowSelection();o&&!o.selectAll&&o.clearOnChange&&o.onChange([],[]),a.ins.setState({params:r},function(){return a.fetchList()})}},this.onSelectChange=function(e,t){var n=a.getModeProps(),s=n.dataSource,r=n.rowKey,n=n.rowSelection,o=a.ins.state.selectAll;a.ins.state.selectAll&&(s=s.map(function(e){return e[r]}),o=union(o.exceptKeys||[],difference(s,e)),a.ins.setState({selectAll:!o.length||{exceptKeys:o}})),null!=n&&n.onChange?n.onChange(e,t):a.ins.setState({selectedRowKeys:e,selectedRows:t})},this.onPageChange=function(e,t){var n=a.ins.state.params,s=a.getRowSelection();s&&!s.selectAll&&s.clearOnChange&&s.onChange([],[]),a.ins.setState({params:__assign(__assign({},n),{page:e,limit:t})},function(){return a.fetchList()})},this.onDelete=function(t){void 0===t&&(t=[]);var e=a.getModeProps(),n=e.pagination,s=e.rowKey,e=n.total,n=a.ins.state.params,r=n.page,n=n.limit;e%n==1&&r===Math.ceil(e/n)?a.ins.setState({params:__assign(__assign({},a.ins.state.params),{page:r-t.length||1})},function(){return a.fetchList()}):((e=a.getRowSelection())&&(n=e.selectedRowKeys.filter(function(e){return!t.includes(e)}),r=e.selectedRows.filter(function(e){return!t.includes(e[s])}),e.onChange(n,r)),a.fetchList())},this.ins=e};export default Util;
//# sourceMappingURL=util.js.map
