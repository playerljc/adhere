var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,o=1,r=arguments.length;o<r;o++)for(var n in t=arguments[o])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},__rest=this&&this.__rest||function(e,t){var o={};for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(o[n[r]]=e[n[r]]);return o};import Feature from"ol/Feature.js";import Map from"ol/Map";import Overlay from"ol/Overlay.js";import View from"ol/View";import{defaults as defaultControls}from"ol/control.js";import MousePosition from"ol/control/MousePosition.js";import ScaleLine from"ol/control/ScaleLine.js";import Zoom from"ol/control/Zoom.js";import{createStringXY}from"ol/coordinate";import{boundingExtent,getBottomLeft,getTopRight}from"ol/extent.js";import{LineString,Point}from"ol/geom";import Circle from"ol/geom/Circle";import LinearRing from"ol/geom/LinearRing";import Polygon from"ol/geom/Polygon";import Draw,{createBox}from"ol/interaction/Draw.js";import Modify from"ol/interaction/Modify";import{Heatmap as HeatMapLayer,Vector as VectorLayer}from"ol/layer.js";import{fromLonLat,toLonLat,transform,transformExtent}from"ol/proj.js";import{Vector as VectorSource}from"ol/source.js";import{Circle as CircleStyle,Fill,Icon,RegularShape,Stroke,Style}from"ol/style.js";import Text from"ol/style/Text";import{v4}from"uuid";import Resource from"@baifendian/adhere-util-resource";import GeoLayer from"./geolayer";import*as TitleLayer from"./titlelayer";import WindLayer from"./windlayer";var EARTH_RADIUS=Resource.Dict.value.ResourceGisEarthRadius.value,DEFAULT_COLOE="#1788F3";function getMinZoom(e){e=e.clientWidth;return Math.ceil(Math.LOG2E*Math.log(e/256))}function transformLonLat(e){return transform(e,Resource.Dict.value.ResourceGisEpsg3857.value,Resource.Dict.value.ResourceGisEpsg4326.value)}export default{SHOWBASESTATION_MINZOOM:5,createMap:function(e){var t=e.config,o=e.fitZoom,r=e.zoom,r=void 0===r?getMinZoom(t.target)||3:r,n=e.minZoom,n=void 0===n?getMinZoom(t.target)||3:n,a=e.maxZoom,a=void 0===a?Resource.Dict.value.ResourceGisMapMaxZoom.value:a,i=e.center,i=void 0===i?Resource.Dict.value.ResourceGisXinbeiquCenterPoint.value:i,c=e.extent,s=void 0===c?Resource.Dict.value.ResourceGisXinbeiquMapExtent.value:c,c=e.layers,e=void 0===c?[TitleLayer.getOSMTileLayer()]:c,u=new Map(__assign(__assign({},t),{controls:defaultControls({attributionOptions:{collapsible:!1}}).extend([new Zoom,new ScaleLine,new MousePosition({coordinateFormat:createStringXY(5),projection:Resource.Dict.value.ResourceGisEpsg4326.value})]),pixelRatio:1,view:new View({center:fromLonLat(i),minZoom:n,maxZoom:a,zoom:r,extent:transformExtent(boundingExtent(s),Resource.Dict.value.ResourceGisEpsg4326.value,Resource.Dict.value.ResourceGisEpsg3857.value)}),layers:e}));return setTimeout(function(){var e;e=o||(e=[].concat(fromLonLat(s[0])).concat(fromLonLat(s[1])),e=u.getView().getResolutionForExtent(e),u.getView().getZoomForResolution(e)),u.getView().setZoom(e)},100),u},setOverlayState:function(e,t){e.setPosition(t)},addClickListener:function(){var e,i;return function(t,o,r,n,a){void 0===r&&(r=function(e){}),void 0===n&&(n=function(e){});e&&t.un("click",e),i&&t.un("pointermove",i),e=function(e){e.dragging||(e=e.pixel,t.forEachFeatureAtPixel(e,function(e,t){return(t===o?r:n)(e),!0}))},i=function(e){e.dragging||t.forEachFeatureAtPixel(e.pixel,function(e,t){return a(t===o?"pointer":""),!0})},t.on("click",e),t.on("pointermove",i)}}(),addHoverListener:function(){var e;return function(r,n,a,i){e&&r.un("pointermove",e),e=function(e){var o;e.dragging||(e=r.getEventPixel(e.originalEvent),o=!1,r.forEachFeatureAtPixel(e,function(e,t){return o=!0,(t===n?(r.getTarget().style.cursor="pointer",a):(r.getTarget().style.cursor="",i))(e),!0}),o||i())},r.on("pointermove",e)}}(),addGeoLayer:function(e,t,o,r){t=new GeoLayer(t,o=void 0===o?function(){}:o,r=void 0===r?0:r);return e.addLayer(t),t},addWindLayer:function(e,t,o,r){void 0===r&&(r=0);r=new WindLayer(t,o);return e.addLayer(r),r},addVectorLayer:function(e,t){var o=new VectorSource,t=new VectorLayer({source:o,zIndex:t});return e.addLayer(t),{vectorLayer:t,vectorSource:o}},createHeatMapLayer:function(e){var t=new VectorSource;return{layer:new HeatMapLayer(__assign({source:t,gradient:["#00005c","#020288","#0202c0","#0ff","#0f0","#ff0","#f00"],weight:function(){return 1},shadow:500,blur:15,radius:20},e)),vectorSource:t}},drawCircle:function(e){var t=e.center,o=e.radius,r=e.color,r=void 0===r?"rgba(23,136,243,.2)":r,n=e.strokeColor,n=void 0===n?DEFAULT_COLOE:n,a=e.strokeWidth,a=void 0===a?2:a,i=e.zIndex,i=void 0===i?Resource.Dict.value.ResourceNormalMaxZIndex.value:i,c=e.id,c=void 0===c?v4():c,e=e.propertys,e=void 0===e?{}:e,i=new Feature(__assign({zIndex:i,geometry:new Circle(t,o)},e));return i.setId(c),i.setStyle(new Style({fill:new Fill({color:r}),stroke:new Stroke({width:a,color:n})})),i},drawPolygon:function(e){var t=e.points,o=e.color,o=void 0===o?"rgba(23,136,243,.2)":o,r=e.strokeColor,r=void 0===r?DEFAULT_COLOE:r,n=e.strokeWidth,n=void 0===n?2:n,a=e.zIndex,a=void 0===a?Resource.Dict.value.ResourceNormalMaxZIndex.value:a,i=e.id,i=void 0===i?v4():i,e=e.propertys,e=void 0===e?{}:e,a=new Feature(__assign({zIndex:a,geometry:new Polygon(t)},e));return a.setId(i),a.setStyle(new Style({fill:new Fill({color:o}),stroke:new Stroke({width:n,color:r})})),a},drawCirclePoint:function(e){var t=e.id,o=e.pos,r=e.fillOpt,r=void 0===r?{color:"rgba(23,136,243,.2)"}:r,n=e.strokeOpt,n=void 0===n?{width:2,color:DEFAULT_COLOE}:n,a=e.radius,a=void 0===a?10:a,i=e.textOpt,i=void 0===i?{}:i,c=e.zIndex,c=void 0===c?1:c,s=e.text,s=void 0===s?"":s,e=e.propertys,e=void 0===e?{}:e,o=new Feature(__assign({zIndex:Resource.Dict.value.ResourceNormalMaxZIndex.value,geometry:new Point(o)},e));return o.setId(t),o.setStyle(new Style({image:new CircleStyle({fill:new Fill(r),stroke:new Stroke(n),radius:a}),text:new Text(__assign({text:s,textAlign:"center",fill:new Fill({color:"#fff"})},i)),zIndex:c})),o},drawRegularShapePoint:function(e){var t=e.id,o=e.pos,r=e.fillOpt,r=void 0===r?{color:"rgba(23,136,243,.2)"}:r,n=e.strokeOpt,n=void 0===n?{width:2,color:DEFAULT_COLOE}:n,a=e.text,a=void 0===a?"":a,i=e.textOpt,i=void 0===i?{}:i,c=e.zIndex,c=void 0===c?1:c,s=e.propertys,s=void 0===s?{}:s,e=__rest(e,["id","pos","fillOpt","strokeOpt","text","textOpt","zIndex","propertys"]),o=new Feature(__assign({zIndex:Resource.Dict.value.ResourceNormalMaxZIndex.value,geometry:new Point(o)},s));return o.setId(t),o.setStyle(new Style({image:new RegularShape(__assign({fill:new Fill(r),stroke:new Stroke(n)},e)),text:new Text(__assign({text:a,textAlign:"center",fill:new Fill({color:"#fff"})},i)),zIndex:c})),o},drawImagePoint:function(e){var t=e.id,o=e.pos,r=e.zIndex,r=void 0===r?1:r,n=e.src,a=e.color,i=e.opacity,c=e.scale,s=e.anchor,u=e.rotation,u=void 0===u?0:u,l=e.offset,l=void 0===l?[0,0]:l,d=e.offsetOrigin,f=e.size,g=e.text,g=void 0===g?"":g,m=e.textOpt,m=void 0===m?{}:m,e=e.propertys,e=void 0===e?{}:e,o=new Feature(__assign({zIndex:Resource.Dict.value.ResourceNormalMaxZIndex.value,geometry:new Point(o)},e));return o.setId(t),o.setStyle(new Style({image:new Icon({color:a,src:n,anchor:s,opacity:i,scale:c,rotation:u,offset:l,offsetOrigin:d,size:f}),fill:new Fill({color:"#fff"}),text:new Text(__assign({text:g,textAlign:"center",fill:new Fill({color:"#fff"})},m)),zIndex:r})),o},createRegularPolygonCurve:function(e,t,o,r,n){for(var a=360-r,i=Math.PI*(1/o-.5),c=(a&&(i+=a/180*Math.PI),[]),s=0;s<o;++s){var u=i+2*(s*((360-a)/360))*Math.PI/o,l=e[0]+t*Math.cos(u),u=e[1]+t*Math.sin(u);c.push([l,u])}0!=a&&c.push(e);var d=new LinearRing(c),n=(d.rotate(Math.PI-(n-r/2)/180*Math.PI,e),new Polygon([c])),r=d.A;return n.A=r,n},removeFeature:function(e,t){e.removeFeature(t)},removeAllFeature:function(e){e.clear()},removeAllOverlay:function(e){e.getOverlays().clear()},setMapCenterAnimate:function(e){var t=e.map,o=e.point,e=e.duration,e=void 0===e?600:e;t.getView().animate({center:o,duration:e})},drawLine:function(e){var t=e.points,o=e.width,r=e.color,n=e.lineCap,n=void 0===n?"square":n,e=e.lineJoin,e=void 0===e?"round":e,t=new Feature({geometry:new LineString(t)});return t.setStyle(new Style({stroke:new Stroke({width:o,color:r,lineCap:n,lineJoin:e})})),t},createInteraction:function(e,t){var o=t.onDrawStart,t=new Draw(t);return t.on("drawstart",function(e){o&&o(e)}),e.addInteraction(t),t},polygonInteraction:function(e){var a=e.map,t=e.freehand,t=void 0===t||t,o=e.vectorSource,i=e.onDrawEnd,e=__rest(e,["map","freehand","vectorSource","onDrawEnd"]),o=this.createInteraction(a,__assign({source:o,type:"Polygon",freehand:t},e));return o.on("drawend",function(e){e.feature.setId(v4());var t=e.feature.getGeometry(),o=[],r=t.getCoordinates()[0].map(function(e){return o.push(transformLonLat(e)),e}),n=a.getView().getCenter();i&&i({e:e,geometry:t,coordinates:r,lonlats:o,centerp:n,transformCenterp:transformLonLat(n)})}),o},circleInteraction:function(e){var t=e.map,o=e.vectorSource,n=e.onDrawEnd,e=__rest(e,["map","vectorSource","onDrawEnd"]),t=this.createInteraction(t,__assign({source:o,type:"Circle",freehand:!0},e));return t.on("drawend",function(e){var t=e.feature.getGeometry(),o=t.getRadius(),r=t.getCenter();e.feature.setId(v4()),n&&n({e:e,geometry:t,radius:o,center:r,transformCenter:transformLonLat(r)})}),t},boxInteraction:function(e){var n=e.map,t=e.vectorSource,a=e.onDrawEnd,e=__rest(e,["map","vectorSource","onDrawEnd"]),t=this.createInteraction(n,__assign({source:t,type:"Circle",freehand:!0,geometryFunction:createBox()},e));return t.on("drawend",function(e){e.feature.setId(v4());var t=e.feature.getGeometry(),o=t.getCoordinates()[0].map(function(e){return e}),r=n.getView().getCenter();a&&a({e:e,geometry:t,coordinates:o,centerp:r})}),t},linStringInteraction:function(e){var i=e.map,t=e.freehand,t=void 0===t||t,o=e.vectorSource,c=e.onDrawEnd,e=__rest(e,["map","freehand","vectorSource","onDrawEnd"]),o=this.createInteraction(i,__assign({source:o,type:"LineString",freehand:t},e));return o.on("drawend",function(e){e.feature.setId(v4());var t=e.feature.getGeometry(),o=[],r=t.getCoordinates().map(function(e){return o.push(transformLonLat(e)),e}),n=i.getView().getCenter(),a=t.getLength().toFixed(3);c&&c({e:e,geometry:t,coordinates:r,lonlats:o,centerp:n,mileage:a,transformCenterp:transformLonLat(n)})}),o},createModifyInteraction:function(e){var t=e.map,o=e.vectorSource,r=e.onModifyEnd,e=new Modify({source:o});return e.on("modifyend",function(e){var t=e.features.getArray(),t=t[t.length-1].getGeometry();r({e:e,geometry:t})}),t.addInteraction(e),e},removeInteraction:function(e,t){e.removeInteraction(t)},removeInteractionAll:function(e){e.getInteractions().clear()},mapFit:function(e,t,o){void 0===t&&(t={}),0!==(e=void 0===e?[]:e).length&&o.getView().fit(e,__assign({padding:[40,40,40,40],constrainResolution:!1,nearest:!0,duration:200},t))},addArrowsSource:function(e){for(var t=e.points,o=e.color,r=e.icon,n=[],a=0;a<t.length-1;a++){var i=t[a],c=t[a+1],s=c[0]-i[0],i=c[1]-i[1],i=Math.atan2(i,s),s=new Feature({geometry:new Point(c)});s.setStyle(new Style({image:new Icon({color:o,src:r,anchor:[.5,.5],rotateWithView:!0,rotation:-i})})),n.push(s)}return n},addArrowsOverlay:function(e,t,o,r){for(var n=0;n<r.length-1;n++){var a=r[n],i=r[n+1],c=i[0]-a[0],a=i[1]-a[1],a=Math.atan2(a,c)*(180/Math.PI),c=document.createElement("div");c.className="fa fa-caret-right overleayArrowPoint",c.style.transform="rotate(".concat(-a,"deg)"),c.style.color=o,t.appendChild(c),this.addOverlay(e,i,c)}},addOverlay:function(e,t,o){t=new Overlay(t);return e.addOverlay(t),t},getRad:function(e){return e*Math.PI/180},getExtentByCoordinates:function(e){if(0===e.length)return[];if(1===e.length)return[].concat(e[0],e[0]);for(var t=[],o=[],r=0;r<e.length;r++){var n=e[r];t.push(n[0]),o.push(n[1])}return t.sort(function(e,t){return e<t?-1:t<e?1:0}),o.sort(function(e,t){return e<t?-1:t<e?1:0}),[t[0],o[0],t[t.length-1],o[o.length-1]]},getExtentByVectorSource:function(e,t){e=this.getCectorSourceCoordinates(e,t=void 0===t?"Point":t);return this.getExtentByCoordinates(e)},getCectorSourceCoordinates:function(e,r){void 0===r&&(r="Point");var n=[];return e.getFeatures().filter(function(e){return e.getGeometry().getType()===r}).map(function(e){var t,o,e=e.getGeometry();"Circle"===r?(t=e.getExtent(),n.push([t[0],t[1]]),n.push([t[2],t[3]])):"Point"===r?(o=e.getCoordinates(),n.push(o)):(o=e.getCoordinates(),n=n.concat(o))}),n},getCenterByCoordinates:function(e,r){void 0===r&&(r="Point");var n=[];return e.getFeatures().filter(function(e){return e.getGeometry().getType()===r}).map(function(e){var t,o,e=e.getGeometry();"Circle"===r?(t=e.getExtent(),n.push([t[0],t[1]]),n.push([t[2],t[3]])):"Point"===r?(o=e.getCoordinates(),n.push(o)):(o=e.getCoordinates(),n=n.concat(o))}),this.getCenterByPoints(n)},getCenterByPoints:function(e){for(var t=[],o=[],r=0;r<e.length;r++){var n=transform(e[r],Resource.Dict.value.ResourceGisEpsg3857.value,Resource.Dict.value.ResourceGisEpsg4326.value);t.push(n[0]),o.push(n[1])}return{centerLon:Math.min.apply(Math,t)+(Math.max.apply(Math,t)-Math.min.apply(Math,t))/2,centerLat:Math.min.apply(Math,o)+(Math.max.apply(Math,o)-Math.min.apply(Math,o))/2}},getPointsExtent:function(e){for(var t=[],o=[],r=0;r<e.length;r++){var n=transform(e[r],Resource.Dict.value.ResourceGisEpsg4326.value,Resource.Dict.value.ResourceGisEpsg3857.value);t.push(n[0]),o.push(n[1])}return{leftTop:[Math.min.apply(Math,t),Math.min.apply(Math,o)],rightBottom:[Math.max.apply(Math,t),Math.max.apply(Math,o)]}},getFlatternDistance:function(e,t,o,r){var n=this.getRad((e+o)/2),e=this.getRad((e-o)/2),o=this.getRad((t-r)/2),t=EARTH_RADIUS,r=Math.sin(e),e=Math.sin(o),o=Math.sin(n),n=(r*=r)*(1-(e*=e))+(1-(o*=o))*e,e=(1-r)*(1-e)+o*e,a=Math.atan(Math.sqrt(n/e)),i=Math.sqrt(n*e)/a;return 2*a*t*(1+1/298.257*((3*i-1)/2/e*o*(1-r)-(3*i+1)/2/n*(1-o)*r))},wrapLon:function(e){return e-360*Math.floor((e+180)/360)},getMapExtent:function(e){var t,o,r;return!!e&&(e=e.getView().calculateExtent(e.getSize()),t=toLonLat(getBottomLeft(e)),o=(e=toLonLat(getTopRight(e)))[1],e=this.wrapLon(e[0]),[{lon:r=this.wrapLon(t[0]),lat:o},{lon:e,lat:o},{lon:e,lat:e=t[1]},{lon:r,lat:e},{lon:r,lat:o}])},getFeaturesInExtent:function(e,t){t=t.getGeometry().getExtent();return e.getLayers().getArray()[1].getSource().getFeaturesInExtent(t)},getLayersCount:function(e){return e.getLayers().getLength()},rgb:function(){return"("+Math.floor(256*Math.random())+","+Math.floor(256*Math.random())+","+Math.floor(256*Math.random())+")"},color16:function(){var e=Math.floor(256*Math.random()),t=Math.floor(256*Math.random()),o=Math.floor(256*Math.random());return"#"+e.toString(16)+t.toString(16)+o.toString(16)},getLineColor:function(e){return 0<=e&&e<=9?["red","green","blue","yellow","gray","#0000cc","#99ffff","#000000","#003333","#ff6600"][e]:this.color16()},downLoadMap:function(e){e.once("postcompose",function(e){var e=e.context.canvas.toDataURL(),t=document.createElement("a"),o=new MouseEvent("click");t.download="map",t.href=e,t.dispatchEvent(o)}),e.renderSync()}};
//# sourceMappingURL=util.js.map
