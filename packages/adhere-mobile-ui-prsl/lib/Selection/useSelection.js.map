{"version":3,"file":"useSelection.js","sources":["Selection/useSelection.js"],"sourcesContent":["\"use strict\";\n\nvar __spreadArray = void 0 && (void 0).__spreadArray || function (to, from, pack) {\n  if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n    if (ar || !(i in from)) {\n      if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n      ar[i] = from[i];\n    }\n  }\n  return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar __importDefault = void 0 && (void 0).__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar ahooks_1 = require(\"ahooks\");\nvar lodash_difference_1 = __importDefault(require(\"lodash.difference\"));\nvar react_1 = require(\"react\");\nvar DEFAULT_SELECTION_MULTIPLE = true;\nfunction UseSelection(_a) {\n  var selectedRowKeys = _a.selectedRowKeys,\n    selectionMultiple = _a.selectionMultiple,\n    mode = _a.mode,\n    dataSource = _a.dataSource,\n    rowKey = _a.rowKey;\n  var _b = (0, react_1.useState)(selectedRowKeys !== null && selectedRowKeys !== void 0 ? selectedRowKeys : []),\n    targetSelectedRowKeys = _b[0],\n    setTargetSelectedRowKeys = _b[1];\n  var _c = (0, react_1.useState)(selectedRowKeys !== null && selectedRowKeys !== void 0 ? selectedRowKeys : []),\n    optionSelectedRowKeys = _c[0],\n    setOptionSelectedRowKeys = _c[1];\n  var targetSelectedRowKeysRef = (0, ahooks_1.useLatest)(targetSelectedRowKeys);\n  var optionSelectedRowKeysRef = (0, ahooks_1.useLatest)(optionSelectedRowKeys);\n  var isUseSelectionMode = (0, react_1.useMemo)(function () {\n    return mode === 'selection';\n  }, [mode]);\n  var isSelectionMultiple = (0, react_1.useMemo)(function () {\n    return selectionMultiple !== null && selectionMultiple !== void 0 ? selectionMultiple : DEFAULT_SELECTION_MULTIPLE;\n  }, [selectionMultiple]);\n  var finish = function finish() {\n    var _preSelectedRowKeys = __spreadArray([], targetSelectedRowKeysRef.current, true);\n    var _targetSelectedRowKeys = __spreadArray([], optionSelectedRowKeysRef.current, true);\n    setTargetSelectedRowKeys(_targetSelectedRowKeys);\n    var removed = (0, lodash_difference_1.default)(_preSelectedRowKeys, _targetSelectedRowKeys);\n    var added = (0, lodash_difference_1.default)(_targetSelectedRowKeys, _preSelectedRowKeys);\n    return {\n      selectedRowKeys: _targetSelectedRowKeys,\n      selectedRows: _targetSelectedRowKeys.map(function (_id) {\n        return dataSource.find(function (r) {\n          return (r === null || r === void 0 ? void 0 : r[rowKey]) === _id;\n        });\n      }),\n      changeRowKeys: __spreadArray(__spreadArray([], removed !== null && removed !== void 0 ? removed : [], true), added !== null && added !== void 0 ? added : [], true),\n      info: {\n        type: (added !== null && added !== void 0 ? added : []).length ? 'select' : 'unselect'\n      }\n    };\n  };\n  var cancel = function cancel() {\n    setOptionSelectedRowKeys(__spreadArray([], targetSelectedRowKeysRef.current, true));\n  };\n  function selectionChange(_checked, _id) {\n    setOptionSelectedRowKeys(function (_optionSelectedRowKeys) {\n      if (_checked) {\n        if (isSelectionMultiple) {\n          return __spreadArray(__spreadArray([], _optionSelectedRowKeys, true), [_id], false);\n        } else {\n          return [_id];\n        }\n      } else {\n        if (isSelectionMultiple) {\n          return _optionSelectedRowKeys.filter(function (_v) {\n            return _v !== _id;\n          });\n        } else {\n          return [];\n        }\n      }\n    });\n  }\n  function selectionAllChange(_checkAll) {\n    setOptionSelectedRowKeys(function (_optionSelectedRowKeys) {\n      if (_checkAll) {\n        return __spreadArray([], dataSource.map(function (t) {\n          return t[rowKey];\n        }), true);\n      } else {\n        return [];\n      }\n    });\n  }\n  (0, ahooks_1.useUpdateEffect)(function () {\n    setTargetSelectedRowKeys(selectedRowKeys !== null && selectedRowKeys !== void 0 ? selectedRowKeys : []);\n    setOptionSelectedRowKeys(selectedRowKeys !== null && selectedRowKeys !== void 0 ? selectedRowKeys : []);\n  }, [selectedRowKeys]);\n  return {\n    optionSelectedRowKeys: optionSelectedRowKeys,\n    targetSelectedRowKeys: targetSelectedRowKeys,\n    isUseSelectionMode: isUseSelectionMode,\n    isSelectionMultiple: isSelectionMultiple,\n    selectionChange: selectionChange,\n    selectionAllChange: selectionAllChange,\n    finish: finish,\n    cancel: cancel\n  };\n}\nexports.default = UseSelection;"],"names":["__spreadArray","to","from","pack","arguments","length","ar","i","l","Array","prototype","slice","call","concat","__importDefault","mod","__esModule","default","ahooks_1","Object","defineProperty","exports","value","require","lodash_difference_1","react_1","DEFAULT_SELECTION_MULTIPLE","UseSelection","_a","selectedRowKeys","selectionMultiple","mode","dataSource","rowKey","_b","useState","targetSelectedRowKeys","setTargetSelectedRowKeys","_c","optionSelectedRowKeys","setOptionSelectedRowKeys","targetSelectedRowKeysRef","useLatest","optionSelectedRowKeysRef","isUseSelectionMode","useMemo","isSelectionMultiple","useUpdateEffect","selectionChange","_checked","_id","_optionSelectedRowKeys","filter","_v","selectionAllChange","_checkAll","map","t","finish","_preSelectedRowKeys","current","_targetSelectedRowKeys","removed","added","selectedRows","find","r","changeRowKeys","info","type","cancel"],"mappings":"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"}