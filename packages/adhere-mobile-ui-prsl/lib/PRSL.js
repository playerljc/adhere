"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_typeof2=_interopRequireDefault(require("@babel/runtime/helpers/typeof")),__assign=function(){return(__assign=Object.assign||function(e){for(var r,t=1,a=arguments.length;t<a;t++)for(var l in r=arguments[t])Object.prototype.hasOwnProperty.call(r,l)&&(e[l]=r[l]);return e}).apply(this,arguments)},__createBinding=Object.create?function(e,r,t,a){void 0===a&&(a=t);var l=Object.getOwnPropertyDescriptor(r,t);l&&("get"in l?r.__esModule:!l.writable&&!l.configurable)||(l={enumerable:!0,get:function(){return r[t]}}),Object.defineProperty(e,a,l)}:function(e,r,t,a){e[a=void 0===a?t:a]=r[t]},__setModuleDefault=Object.create?function(e,r){Object.defineProperty(e,"default",{enumerable:!0,value:r})}:function(e,r){e.default=r},__importStar=function(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)"default"!==t&&Object.prototype.hasOwnProperty.call(e,t)&&__createBinding(r,e,t);return __setModuleDefault(r,e),r},__spreadArray=function(e,r,t){if(t||2===arguments.length)for(var a,l=0,n=r.length;l<n;l++)!a&&l in r||((a=a||Array.prototype.slice.call(r,0,l))[l]=r[l]);return e.concat(a||Array.prototype.slice.call(r))},__importDefault=function(e){return e&&e.__esModule?e:{default:e}},ahooks_1=(Object.defineProperty(exports,"__esModule",{value:!0}),require("ahooks")),antd_mobile_1=require("antd-mobile"),classnames_1=__importDefault(require("classnames")),lodash_isempty_1=__importDefault(require("lodash.isempty")),react_1=__importStar(require("react")),use_immer_1=require("use-immer"),adhere_ui_backtopanimation_1=__importDefault(require("@baifendian/adhere-ui-backtopanimation")),adhere_ui_scrollload_1=__importDefault(require("@baifendian/adhere-ui-scrollload")),adhere_util_intl_1=__importDefault(require("@baifendian/adhere-util-intl")),Context_1=__importDefault(require("./Context")),PRSLItem_1=__importDefault(require("./PRSLItem")),SearchKeyWord_1=__importDefault(require("./SearchKeyWord")),Selection_1=require("./Selection"),Toolbar_1=__importDefault(require("./Toolbar")),selectorPrefix="adhere-mobile-ui-prsl",DEFAULT_PAGING_SIZE=30,DEFAULT_PAGING_PAGE=1,DEFAULT_DISTANCE=50,DEFAULT_TOOLBAR_COLLAPSE_COUNT=3,DEFAULT_SEARCH_KEY_WORD_HISTORY_STORE_TYPE="session",DEFAULT_ROW_KEY="id",InternalPRSL=(0,react_1.memo)((0,react_1.forwardRef)(function(e){var r=e.className,r=void 0===r?"":r,O=e.style,t=e.innerClassName,a=void 0===t?"":t,l=e.innerStyle,t=e.isLoading,t=void 0===t||t,n=e.isUseFirstLoading,n=void 0===n||n,o=e.firstLoading,i=e.pullToRefreshProps,B=e.onRefreshBefore,u=e.paging,s=e.onRefresh,c=e.rowKey,d=e.showKeyWordSearchBar,F=void 0===d||d,k=e.searchKeyWordBarProps,d=e.searchKeyWordWrapperClassName,x=void 0===d?"":d,U=e.searchKeyWordWrapperStyle,I=e.searchKeyWordMode,q=e.searchKeyWordHistoryMaxSize,G=e.isSearchKeyWordHistoryIntoStore,j=e.searchKeyWordHistoryStoreType,_=e.defaultSearchKeyWord,d=e.showToolBar,z=void 0===d||d,d=e.showTotal,Y=e.renderToolBar,H=e.afterToolBarRender,Z=e.beforeToolBarRender,J=e.beforeToolBarRenderClassName,J=void 0===J?"":J,Q=e.beforeToolBarRenderStyle,X=e.afterToolBarRenderClassName,X=void 0===X?"":X,$=e.afterToolBarRenderStyle,f=e.toolbarWrapperClassName,f=void 0===f?"":f,ee=e.toolbarWrapperStyle,re=e.toolbarCollapseCount,re=void 0===re?DEFAULT_TOOLBAR_COLLAPSE_COUNT:re,te=e.toolbarConfig,g=e.scrollLoadProps,ae=e.onLoadMore,le=e.loadMoreLoading,m=e.showBackTopAnimation,ne=void 0===m||m,oe=e.backTopAnimationProps,ie=e.scrollLoadBeforeRender,ue=e.scrollLoadAfterRender,m=e.scrollLoadBeforeRenderClassName,se=void 0===m?"":m,ce=e.scrollLoadBeforeRenderStyle,m=e.scrollLoadAfterRenderClassName,de=void 0===m?"":m,_e=e.scrollLoadAfterRenderStyle,fe=e.beforeRender,ge=e.afterRender,m=e.beforeRenderClassName,me=void 0===m?"":m,pe=e.beforeRenderStyle,m=e.afterRenderClassName,Se=void 0===m?"":m,he=e.afterRenderStyle,m=e.isShowFilterTrigger,ve=e.renderFilterTrigger,ye=e.isShowSortTrigger,Te=e.renderSortTrigger,Re=e.isShowViewSettingTrigger,Pe=e.renderViewSettingTrigger,Ee=e.viewSettingTriggerMode,be=e.viewSettingTriggerProps,Me=e.renderViewSetting,Ae=e.viewSettingConfig,Ce=e.defaultViewSettingValue,Le=e.onViewSetting,we=e.onViewSettingReset,Ne=e.loadData,Ke=e.renderEmpty,Ve=e.renderOffLine,We=e.filterTriggerMode,De=e.filterTriggerProps,Oe=e.renderFilter,Be=e.filterFormProps,Fe=e.filterConfig,p=e.defaultFilterValues,ke=e.sortTriggerMode,xe=e.sortTriggerProps,Ue=e.renderSort,Ie=e.sortConfig,S=e.defaultSortValues,qe=e.isUseLocal,Ge=e.selectedRowKeys,je=e.selectionMultiple,ze=e.onSelectChange,h=e.children,e=(0,ahooks_1.useNetwork)(),Ye=(0,ahooks_1.useUpdate)(),v=(0,react_1.useState)({data:[],total:0}),y=v[0],He=v[1],v=(0,react_1.useState)("normal"),T=v[0],Ze=v[1],Je=(0,react_1.useMemo)(function(){return null!=c?c:DEFAULT_ROW_KEY},[c]),v=(0,Selection_1.useSelection)({selectedRowKeys:Ge,selectionMultiple:je,mode:T,dataSource:y.data,rowKey:Je}),Qe=v.optionSelectedRowKeys,R=v.isUseSelectionMode,Xe=v.isSelectionMultiple,$e=v.finish,er=v.cancel,Ge=v.selectionChange,je=v.selectionAllChange,T=(0,use_immer_1.useImmer)({searchKeyWord:null!=_?_:"",filterValues:null!=p?p:{},sortValues:null!=S?S:[]}),P=T[0],E=T[1],v=(0,react_1.useRef)(!0),T=(0,react_1.useRef)(!1),b=(0,react_1.useRef)({page:void 0!==u&&"object"===(0,_typeof2.default)(u)&&null!=(w=u.page)?w:DEFAULT_PAGING_PAGE,pageSize:void 0!==u&&"object"===(0,_typeof2.default)(u)&&null!=(w=u.defaultPageSize)?w:DEFAULT_PAGING_SIZE}),M=(0,react_1.useMemo)(function(){return"boolean"!=typeof u||u},[u]),A=(0,react_1.useRef)(),rr=(0,react_1.useRef)(void 0),C=(0,react_1.useRef)(null),L=(0,react_1.useRef)(adhere_ui_scrollload_1.default.NORMAL),w=(0,react_1.useCallback)(function(){var e;return null!=(e=null==o?void 0:o())?e:nr},[o]),tr=(0,react_1.useCallback)(function(){var e;return null!=(e=null==le?void 0:le())?e:or},[le]),N=(0,react_1.useMemo)(function(){return"boolean"!=typeof qe||qe},[qe]),K=(0,react_1.useMemo)(function(){var e,r=P.searchKeyWord,t=void 0===r?"":r,r=P.filterValues,a=void 0===r?{}:r,r=P.sortValues,r=void 0===r?[]:r,l=null!=(l=y.data)?l:[];return(null!=r?r:[]).length&&(l=r.reduce(function(e,r){var t=r.order,a=r.name;return e=e.sort(function(e,r){return"asc"===t?e[a]>r[a]?1:e[a]<r[a]?-1:0:e[a]<r[a]?1:e[a]>r[a]?-1:0}),__spreadArray([],e,!0)},null!=(e=y.data)?e:[])),l=!t&&(0,lodash_isempty_1.default)(a)&&!r.length?l:l.filter(function(r){return t?Object.keys(r).some(function(e){return-1!==r[e].indexOf(t)}):!!(0,lodash_isempty_1.default)(a)||Object.keys(a).filter(function(e){return!!a[e]}).every(function(e){return-1!==r[e].indexOf(a[e])})})},[P,y]),V=(0,react_1.useMemo)(function(){var e,r;return N?(r=K,M&&(e=(b.current.page-1)*b.current.pageSize,r=K.slice(e,b.current.page*b.current.pageSize),1!==b.current.page)&&(r=__spreadArray(__spreadArray([],K.slice(0,e),!0),r,!0)),{total:K.length,data:r}):y},[y,K,N,M,b.current.page,b.current.pageSize]),ar=(0,react_1.useCallback)(function(){return!V.data.length},[V.data]),lr=(0,react_1.useMemo)(function(){var e;return(null!=(e=null==V?void 0:V.total)?e:0)/b.current.pageSize},[b.current.pageSize,V.total]),nr=(0,react_1.useMemo)(function(){return react_1.default.createElement("div",{className:"".concat(selectorPrefix,"-first-loading")},react_1.default.createElement(antd_mobile_1.Skeleton.Title,{animated:!0}),react_1.default.createElement(antd_mobile_1.Skeleton.Paragraph,{lineCount:25,animated:!0}))},[]),or=(0,react_1.useMemo)(function(){return react_1.default.createElement("div",{className:"".concat(selectorPrefix,"-load-more-loading")},react_1.default.createElement("div",{className:"".concat(selectorPrefix,"-load-more-loading-dot")},react_1.default.createElement(antd_mobile_1.DotLoading,{color:"primary"})),react_1.default.createElement("div",null,"".concat(adhere_util_intl_1.default.v("数据加载中")),"..."))},[]),ir=(0,react_1.useMemo)(function(){var e;return null!=(e=null==Ve?void 0:Ve())?e:react_1.default.createElement(antd_mobile_1.ErrorBlock,{status:"disconnected"},react_1.default.createElement(antd_mobile_1.Button,{color:"primary",onClick:function(){Ye()}},adhere_util_intl_1.default.v("点击重试")))},[Ve]),ur=(0,react_1.useMemo)(function(){var e;return react_1.default.createElement(SearchKeyWord_1.default,{className:null!=x?x:"",style:null!=U?U:{},searchKeyWordBarProps:k,searchKeyWordMode:null!=I?I:"normal",searchKeyWordHistoryMaxSize:null!=q?q:DEFAULT_DISTANCE,isSearchKeyWordHistoryIntoStore:null==G||G,searchKeyWordHistoryStoreType:null!=j?j:DEFAULT_SEARCH_KEY_WORD_HISTORY_STORE_TYPE,disabled:R,defaultSearchKeyWord:null!=(e=P.searchKeyWord)?e:"",onSearch:vr,onSearchClear:yr})},[x,U,k,I,q,P.searchKeyWord,R]),sr=react_1.default.createElement(Toolbar_1.default,{className:f,style:ee,showTotal:d,renderToolBar:Y,afterToolBarRender:H,beforeToolBarRender:Z,beforeToolBarRenderClassName:J,beforeToolBarRenderStyle:Q,afterToolBarRenderClassName:X,afterToolBarRenderStyle:$,isShowFilterTrigger:m,renderFilterTrigger:ve,isShowSortTrigger:ye,renderSortTrigger:Te,isShowViewSettingTrigger:Re,renderViewSettingTrigger:Pe,viewSettingTriggerMode:Ee,viewSettingTriggerProps:be,renderViewSetting:Me,viewSettingConfig:Ae,defaultViewSettingValue:Ce,onViewSetting:Le,onViewSettingReset:we,toolbarCollapseCount:re,toolbarConfig:te,total:null!=(f=null==V?void 0:V.total)?f:0,filterTriggerMode:We,filterTriggerProps:De,renderFilter:Oe,filterFormProps:Be,filterConfig:Fe,defaultFilterValues:P.filterValues,onFilter:function(r){if(D(),E(function(e){e.filterValues=r}),N)return Promise.resolve();return W(__assign(__assign({},P),{filterValues:r}))},onFilterReset:function(){if(D(),E(function(e){e.filterValues={}}),N)return Promise.resolve();return W(__assign(__assign({},P),{filterValues:{}}))},sortTriggerMode:ke,sortTriggerProps:xe,renderSort:Ue,sortConfig:Ie,defaultSortValues:P.sortValues,disabled:R,onSort:function(r){if(D(),E(function(e){e.sortValues=r}),N)return Promise.resolve();return W(__assign(__assign({},P),{sortValues:r}))},onSortReset:function(){if(D(),E(function(e){e.sortValues=[]}),N)return Promise.resolve();return W(__assign(__assign({},P),{sortValues:[]}))}}),cr=(0,react_1.useMemo)(function(){var e=null==fe?void 0:fe();return e&&react_1.default.createElement("div",{className:(0,classnames_1.default)("".concat(selectorPrefix,"-inner-before"),null!=me?me:""),style:null!=pe?pe:{}},e)},[fe,me,pe]),dr=(0,react_1.useMemo)(function(){var e=null==ge?void 0:ge();return e&&react_1.default.createElement("div",{className:(0,classnames_1.default)("".concat(selectorPrefix,"-inner-after"),null!=Se?Se:""),style:null!=he?he:{}},e)},[ge,Se,he]),_r=(0,react_1.useMemo)(function(){var e=null==ie?void 0:ie();return e&&react_1.default.createElement("div",{className:(0,classnames_1.default)("".concat(selectorPrefix,"-scroll-before"),null!=se?se:""),style:null!=ce?ce:{}},e)},[ie,se,ce]),fr=(0,react_1.useMemo)(function(){var e=null==ue?void 0:ue();return e&&react_1.default.createElement("div",{className:(0,classnames_1.default)("".concat(selectorPrefix,"-scroll-after"),null!=de?de:""),style:null!=_e?_e:{}},e)},[ue,de,_e]),gr=(0,react_1.useMemo)(function(){var e;return react_1.default.createElement(adhere_ui_scrollload_1.default,__assign({ref:A,renderLoading:tr,distance:(null==g?void 0:g.distance)||50,onScrollBottom:Pr},g||{},{disabled:R,className:(0,classnames_1.default)("".concat(selectorPrefix,"-scroll-load"),null!=(e=null==g?void 0:g.className)?e:"")}),(e=null==h?void 0:h(V.data),!R||Xe?e:react_1.default.createElement(antd_mobile_1.Radio.Group,null,e)))},[tr,g,h,R,V.data]),mr=(0,react_1.useMemo)(function(){return react_1.default.createElement("div",{className:"".concat(selectorPrefix,"-scroll"),ref:rr},null==h?void 0:h(V.data))},[h,V.data]),pr=(0,react_1.useMemo)(function(){return react_1.default.createElement(adhere_ui_backtopanimation_1.default,__assign({},null!=oe?oe:{},{getContainer:Tr,onTrigger:function(){return Promise.resolve()}}))},[oe]),Sr=(0,react_1.useMemo)(function(){var e;return react_1.default.createElement(antd_mobile_1.PullToRefresh,__assign({},null!=i?i:{},{onRefresh:Rr,disabled:R}),_r,ar()&&(null!=(e=null==Ke?void 0:Ke())?e:react_1.default.createElement(antd_mobile_1.ErrorBlock,{status:"empty"})),!ar()&&M&&gr,!ar()&&!M&&mr,fr,ne&&pr)},[u,i,_r,fr,gr,mr,ne,pr,R,Ke,M]),ee=(0,react_1.useCallback)(function(){return react_1.default.createElement(react_1.default.Fragment,null,react_1.default.createElement("div",{className:"".concat(selectorPrefix,"-header")},react_1.default.createElement("div",{className:"".concat(selectorPrefix,"-header-main")},F&&ur),react_1.default.createElement("div",{className:"".concat(selectorPrefix,"-header-extra")},react_1.default.createElement(Selection_1.SelectionManageButton,{isUseSelectionMode:R,onChange:function(e){Ze(e?"selection":"normal")},onFinish:function(){var e=$e(),r=e.selectedRows,t=e.selectedRowKeys,a=e.changeRowKeys,e=e.info;null!=ze&&ze(t,r,a,e)},onCancel:er}))),z&&sr,react_1.default.createElement("div",{className:(0,classnames_1.default)("".concat(selectorPrefix,"-inner"),null!=a?a:""),style:null!=l?l:{}},cr,Sr,dr),R&&Xe&&react_1.default.createElement(Selection_1.SelectionCheckAllManage,null))},[F,ur,z,sr,a,l,cr,Sr,dr,R]);function W(e){return Ne?Ne(__assign(__assign({},b.current),e)).then(function(e){return He(e),e}):Promise.resolve()}function D(){var e,r,t=null===Tr?void 0:Tr();t&&(t.scrollTop=0),null!=(e=null==(t=null==A?void 0:A.current)?void 0:t.hideAll)&&e.call(t),C.current=null,L.current=adhere_ui_scrollload_1.default.NORMAL,b.current.page=void 0!==u&&"object"===(0,_typeof2.default)(u)&&null!=(r=u.page)?r:DEFAULT_PAGING_PAGE,b.current.pageSize=void 0!==u&&"object"===(0,_typeof2.default)(u)&&null!=(r=u.defaultPageSize)?r:DEFAULT_PAGING_SIZE}function hr(){D(),E(function(e){e.searchKeyWord=_,e.filterValues=p,e.sortValues=S})}function vr(r){D(),E(function(e){e.searchKeyWord=r}),N||W(__assign(__assign({},P),{searchKeyWord:r}))}function yr(){D(),E(function(e){e.searchKeyWord=""}),N||W(__assign(__assign({},P),{searchKeyWord:""}))}function Tr(){var e;return null!=(e=null!=(e=null==(e=A.current)?void 0:e.getScrollContainer())?e:rr.current)?e:document.body}function Rr(){var e={searchKeyWord:_,filterValues:p,sortValues:S},r=B?B(__assign(__assign({},b.current),e)):Promise.resolve();return s?r.then(function(){return hr(),N||null==s?void 0:s(__assign(__assign({},b.current),e)).then(function(e){He(e)})}):Promise.resolve(y)}function Pr(e){if(L.current===adhere_ui_scrollload_1.default.EMPTY)L.current=adhere_ui_scrollload_1.default.EMPTY,e(adhere_ui_scrollload_1.default.EMPTY);else{if(C.current=e,!N)return null==ae?void 0:ae(__assign({page:b.current.page+1,pageSize:b.current.pageSize},P)).then(function(r){b.current.page+=1,He(function(e){return e.total=r.total,e.data=__spreadArray(__spreadArray([],e.data,!0),r.data,!0),__assign({},e)})});b.current.page+=1,Ye()}}return(0,ahooks_1.useMount)(function(){W({searchKeyWord:_,filterValues:p,sortValues:S})}),(0,ahooks_1.useUpdateEffect)(function(){C.current&&(L.current=b.current.page<lr?adhere_ui_scrollload_1.default.NORMAL:adhere_ui_scrollload_1.default.EMPTY,C.current(L.current))},[y.data,lr,b.current.page]),(0,ahooks_1.useUpdateEffect)(function(){hr(),W({searchKeyWord:_,filterValues:p,sortValues:S})},[_,S,p,N]),react_1.default.createElement(Context_1.default.Provider,{value:{isUseSelectionMode:function(){return R},getRowKey:function(){return Je},getOptionSelectedRowKeys:function(){return null!=Qe?Qe:[]},selectionChange:Ge,selectionAllChange:je,getDatasourceLength:function(){return y.data.length},getSelectionMultiple:function(){return Xe}}},react_1.default.createElement("div",{className:(0,classnames_1.default)(selectorPrefix,null!=r?r:""),style:null!=O?O:{}},e.online&&(n&&(v.current&&!T.current&&t&&(T.current=!0),v.current&&T.current&&!t&&(v.current=!1,T.current=!1),v.current)?w:ee)(),!e.online&&ir))})),PRSL=InternalPRSL;PRSL.displayName="PRSL",PRSL.Item=PRSLItem_1.default,exports.default=PRSL;
//# sourceMappingURL=PRSL.js.map
