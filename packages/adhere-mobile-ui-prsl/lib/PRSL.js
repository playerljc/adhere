"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_typeof2=_interopRequireDefault(require("@babel/runtime/helpers/typeof")),__assign=function(){return(__assign=Object.assign||function(e){for(var r,t=1,a=arguments.length;t<a;t++)for(var l in r=arguments[t])Object.prototype.hasOwnProperty.call(r,l)&&(e[l]=r[l]);return e}).apply(this,arguments)},__createBinding=Object.create?function(e,r,t,a){void 0===a&&(a=t);var l=Object.getOwnPropertyDescriptor(r,t);l&&("get"in l?r.__esModule:!l.writable&&!l.configurable)||(l={enumerable:!0,get:function(){return r[t]}}),Object.defineProperty(e,a,l)}:function(e,r,t,a){e[a=void 0===a?t:a]=r[t]},__setModuleDefault=Object.create?function(e,r){Object.defineProperty(e,"default",{enumerable:!0,value:r})}:function(e,r){e.default=r},__importStar=function(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)"default"!==t&&Object.prototype.hasOwnProperty.call(e,t)&&__createBinding(r,e,t);return __setModuleDefault(r,e),r},__spreadArray=function(e,r,t){if(t||2===arguments.length)for(var a,l=0,o=r.length;l<o;l++)!a&&l in r||((a=a||Array.prototype.slice.call(r,0,l))[l]=r[l]);return e.concat(a||Array.prototype.slice.call(r))},__importDefault=function(e){return e&&e.__esModule?e:{default:e}},ahooks_1=(Object.defineProperty(exports,"__esModule",{value:!0}),require("ahooks")),antd_mobile_1=require("antd-mobile"),classnames_1=__importDefault(require("classnames")),lodash_isempty_1=__importDefault(require("lodash.isempty")),react_1=__importStar(require("react")),use_immer_1=require("use-immer"),adhere_ui_backtopanimation_1=__importDefault(require("@baifendian/adhere-ui-backtopanimation")),adhere_ui_scrollload_1=__importDefault(require("@baifendian/adhere-ui-scrollload")),adhere_util_intl_1=__importDefault(require("@baifendian/adhere-util-intl")),SearchKeyWord_1=__importDefault(require("./SearchKeyWord")),Toolbar_1=__importDefault(require("./Toolbar")),selectorPrefix="adhere-mobile-ui-prsl",DEFAULT_PAGING_SIZE=30,DEFAULT_PAGING_PAGE=1,DEFAULT_DISTANCE=50,DEFAULT_TOOLBAR_COLLAPSE_COUNT=3,PRSL=(0,react_1.memo)((0,react_1.forwardRef)(function(e){var r=e.className,r=void 0===r?"":r,t=e.style,t=void 0===t?{}:t,a=e.innerClassName,l=void 0===a?"":a,a=e.innerStyle,o=void 0===a?{}:a,a=e.isLoading,a=void 0===a||a,n=e.isUseFirstLoading,n=void 0===n||n,i=e.firstLoading,u=e.pullToRefreshProps,s=void 0===u?{}:u,F=e.onRefreshBefore,c=e.paging,d=e.onRefresh,u=e.showKeyWordSearchBar,K=void 0===u||u,k=e.searchKeyWordBarProps,u=e.searchKeyWordWrapperClassName,_=void 0===u?"":u,u=e.searchKeyWordWrapperStyle,f=void 0===u?{}:u,m=e.searchKeyWordMode,u=e.searchKeyWordHistoryMaxSize,w=void 0===u?DEFAULT_DISTANCE:u,g=e.defaultSearchKeyWord,u=e.showToolBar,U=void 0===u||u,u=e.showTotal,x=e.renderToolBar,q=e.afterToolBarRender,j=e.beforeToolBarRender,G=e.beforeToolBarRenderClassName,G=void 0===G?"":G,z=e.beforeToolBarRenderStyle,z=void 0===z?{}:z,I=e.afterToolBarRenderClassName,I=void 0===I?"":I,Y=e.afterToolBarRenderStyle,Y=void 0===Y?{}:Y,p=e.toolbarWrapperClassName,p=void 0===p?"":p,v=e.toolbarWrapperStyle,v=void 0===v?{}:v,Z=e.toolbarCollapseCount,Z=void 0===Z?DEFAULT_TOOLBAR_COLLAPSE_COUNT:Z,H=e.toolbarConfig,h=e.scrollLoadProps,J=e.onLoadMore,Q=e.loadMoreLoading,y=e.showBackTopAnimation,X=void 0===y||y,$=e.backTopAnimationProps,ee=e.scrollLoadBeforeRender,re=e.scrollLoadAfterRender,y=e.scrollLoadBeforeRenderClassName,te=void 0===y?"":y,y=e.scrollLoadBeforeRenderStyle,ae=void 0===y?{}:y,y=e.scrollLoadAfterRenderClassName,le=void 0===y?"":y,y=e.scrollLoadAfterRenderStyle,oe=void 0===y?{}:y,ne=e.beforeRender,ie=e.afterRender,y=e.beforeRenderClassName,ue=void 0===y?"":y,y=e.beforeRenderStyle,se=void 0===y?{}:y,y=e.afterRenderClassName,ce=void 0===y?"":y,y=e.afterRenderStyle,de=void 0===y?{}:y,y=e.isShowFilterTrigger,_e=e.renderFilterTrigger,fe=e.isShowSortTrigger,me=e.renderSortTrigger,ge=e.isShowViewSettingTrigger,pe=e.renderViewSettingTrigger,ve=e.loadData,he=e.renderEmpty,ye=(e.renderOffLine,e.filterTriggerMode),Se=e.filterTriggerProps,Te=e.renderFilter,be=e.filterFormProps,Pe=e.filterConfig,S=e.defaultFilterValues,Ee=e.sortTriggerMode,Re=e.sortTriggerProps,Ae=e.renderSort,Ne=e.sortConfig,T=e.defaultSortValues,Le=e.isUseLocal,Me=e.children,Ce=((0,ahooks_1.useNetwork)(),(0,ahooks_1.useUpdate)()),e=(0,react_1.useState)({data:[],total:0}),b=e[0],De=e[1],e=(0,use_immer_1.useImmer)({searchKeyWord:null!=g?g:"",filterValues:null!=S?S:{},sortValues:null!=T?T:[]}),P=e[0],E=e[1],e=(0,react_1.useRef)(!0),R=(0,react_1.useRef)(!1),A=(0,react_1.useRef)({page:void 0!==c&&"object"===(0,_typeof2.default)(c)&&null!=(C=c.page)?C:DEFAULT_PAGING_PAGE,pageSize:void 0!==c&&"object"===(0,_typeof2.default)(c)&&null!=(C=c.defaultPageSize)?C:DEFAULT_PAGING_SIZE}),N=(0,react_1.useRef)(),L=(0,react_1.useRef)(null),M=(0,react_1.useRef)(adhere_ui_scrollload_1.default.NORMAL),C=(0,react_1.useCallback)(function(){var e;return null!=(e=null==i?void 0:i())?e:Oe},[i]),Ve=(0,react_1.useCallback)(function(){var e;return null!=(e=null==Q?void 0:Q())?e:Fe},[Q]),D=(0,react_1.useMemo)(function(){return"boolean"!=typeof Le||D},[Le]),V=(0,react_1.useMemo)(function(){var e=P.searchKeyWord,t=void 0===e?"":e,e=P.filterValues,a=void 0===e?{}:e,e=P.sortValues,e=void 0===e?[]:e,r=null!=(r=b.data)?r:[];return(null!=e?e:[]).length&&(r=e.reduce(function(e,r){var t=r.order,a=r.name;return e=e.sort(function(e,r){return"asc"===t?e[a]>r[a]?1:e[a]<r[a]?-1:0:e[a]<r[a]?1:e[a]>r[a]?-1:0}),__spreadArray([],e,!0)},b.data)),r=!t&&(0,lodash_isempty_1.default)(a)&&!e.length?r:r.filter(function(r){return t?Object.keys(r).some(function(e){return-1!==r[e].indexOf(t)}):!!(0,lodash_isempty_1.default)(a)||Object.keys(a).every(function(e){return-1!==r[e].indexOf(a[e])})})},[P,b]),W=(0,react_1.useMemo)(function(){var e,r;return D?(e=(A.current.page-1)*A.current.pageSize,r=V.slice(e,A.current.page*A.current.pageSize),1!==A.current.page&&(r=__spreadArray(__spreadArray([],V.slice(0,e),!0),r,!0)),{total:V.length,data:r}):b},[b,V,D,A.current.page,A.current.pageSize]),We=(0,react_1.useCallback)(function(){return!W.data.length},[W.data]),Be=(0,react_1.useMemo)(function(){var e;return(null!=(e=null==W?void 0:W.total)?e:0)/A.current.pageSize},[A.current.pageSize,W.total]),Oe=(0,react_1.useMemo)(function(){return react_1.default.createElement("div",{className:"".concat(selectorPrefix,"-first-loading")},react_1.default.createElement(antd_mobile_1.Skeleton.Title,{animated:!0}),react_1.default.createElement(antd_mobile_1.Skeleton.Paragraph,{lineCount:25,animated:!0}))},[]),Fe=(0,react_1.useMemo)(function(){return react_1.default.createElement("div",{className:"".concat(selectorPrefix,"-load-more-loading")},react_1.default.createElement("div",{className:"".concat(selectorPrefix,"-load-more-loading-dot")},react_1.default.createElement(antd_mobile_1.DotLoading,{color:"primary"})),react_1.default.createElement("div",null,"".concat(adhere_util_intl_1.default.v("数据加载中")),"..."))},[]),Ke=(0,react_1.useMemo)(function(){var e;return react_1.default.createElement(SearchKeyWord_1.default,{className:null!=_?_:"",style:null!=f?f:{},searchKeyWordBarProps:k,searchKeyWordMode:null!=m?m:"normal",searchKeyWordHistoryMaxSize:null!=w?w:DEFAULT_DISTANCE,defaultSearchKeyWord:null!=(e=P.searchKeyWord)?e:"",onSearch:Ye,onSearchClear:Ze})},[_,f,k,m,w,P.searchKeyWord]),ke=react_1.default.createElement(Toolbar_1.default,{className:p,style:v,showTotal:u,renderToolBar:x,afterToolBarRender:q,beforeToolBarRender:j,beforeToolBarRenderClassName:G,beforeToolBarRenderStyle:z,afterToolBarRenderClassName:I,afterToolBarRenderStyle:Y,isShowFilterTrigger:y,renderFilterTrigger:_e,isShowSortTrigger:fe,renderSortTrigger:me,isShowViewSettingTrigger:ge,renderViewSettingTrigger:pe,toolbarCollapseCount:Z,toolbarConfig:H,total:null!=(p=null==W?void 0:W.total)?p:0,filterTriggerMode:ye,filterTriggerProps:Se,renderFilter:Te,filterFormProps:be,filterConfig:Pe,defaultFilterValues:P.filterValues,onFilter:function(r){if(O(),E(function(e){e.filterValues=r}),D)return Promise.resolve();return B(__assign(__assign({},P),{filterValues:r}))},onFilterReset:function(){if(O(),E(function(e){e.filterValues={}}),D)return Promise.resolve();return B(__assign(__assign({},P),{filterValues:{}}))},sortTriggerMode:Ee,sortTriggerProps:Re,renderSort:Ae,sortConfig:Ne,defaultSortValues:P.sortValues,onSort:function(r){if(O(),E(function(e){e.sortValues=r}),D)return Promise.resolve();return B(__assign(__assign({},P),{sortValues:r}))},onSortReset:function(){if(O(),E(function(e){e.sortValues=[]}),D)return Promise.resolve();return B(__assign(__assign({},P),{sortValues:[]}))}}),we=(0,react_1.useMemo)(function(){var e=null==ne?void 0:ne();return e&&react_1.default.createElement("div",{className:(0,classnames_1.default)("".concat(selectorPrefix,"-inner-before"),null!=ue?ue:""),style:null!=se?se:{}},e)},[ne,ue,se]),Ue=(0,react_1.useMemo)(function(){var e=null==ie?void 0:ie();return e&&react_1.default.createElement("div",{className:(0,classnames_1.default)("".concat(selectorPrefix,"-inner-after"),null!=ce?ce:""),style:null!=de?de:{}},e)},[ie,ce,de]),xe=(0,react_1.useMemo)(function(){var e=null==ee?void 0:ee();return e&&react_1.default.createElement("div",{className:(0,classnames_1.default)("".concat(selectorPrefix,"-scroll-before"),null!=te?te:""),style:null!=ae?ae:{}},e)},[ee,te,ae]),qe=(0,react_1.useMemo)(function(){var e=null==re?void 0:re();return e&&react_1.default.createElement("div",{className:(0,classnames_1.default)("".concat(selectorPrefix,"-scroll-after"),null!=le?le:""),style:null!=oe?oe:{}},e)},[re,le,oe]),je=(0,react_1.useMemo)(function(){var e;return react_1.default.createElement(react_1.default.Fragment,null,We()&&(null!=(e=null==he?void 0:he())?e:react_1.default.createElement(antd_mobile_1.ErrorBlock,{status:"empty"})),!We()&&react_1.default.createElement(adhere_ui_scrollload_1.default,__assign({ref:N,renderLoading:Ve,distance:(null==h?void 0:h.distance)||50,onScrollBottom:Qe},h||{},{className:(0,classnames_1.default)("".concat(selectorPrefix,"-scroll-load"),null!=(e=null==h?void 0:h.className)?e:"")}),null==Me?void 0:Me(W.data)))},[Ve,h,Me,W.data,We,he]),Ge=(0,react_1.useMemo)(function(){return react_1.default.createElement(adhere_ui_backtopanimation_1.default,__assign({},null!=$?$:{},{getContainer:He,onTrigger:function(){return Promise.resolve()}}))},[$]),ze=(0,react_1.useMemo)(function(){return react_1.default.createElement(antd_mobile_1.PullToRefresh,__assign({},null!=s?s:{},{onRefresh:Je}),xe,je,qe,X&&Ge)},[s,xe,qe,je,X,Ge]),v=(0,react_1.useCallback)(function(){return react_1.default.createElement(react_1.default.Fragment,null,K&&Ke,U&&ke,react_1.default.createElement("div",{className:(0,classnames_1.default)("".concat(selectorPrefix,"-inner"),null!=l?l:""),style:null!=o?o:{}},we,ze,Ue))},[K,Ke,U,ke,l,o,we,ze,Ue]);function B(e){return ve?ve(__assign(__assign({},A.current),e)).then(function(e){return De(e),e}):Promise.resolve()}function O(){var e,r,t=null===He?void 0:He();t&&(t.scrollTop=0),null!=(e=null==(t=null==N?void 0:N.current)?void 0:t.hideAll)&&e.call(t),L.current=null,M.current=adhere_ui_scrollload_1.default.NORMAL,A.current.page=void 0!==c&&"object"===(0,_typeof2.default)(c)&&null!=(r=c.page)?r:DEFAULT_PAGING_PAGE,A.current.pageSize=void 0!==c&&"object"===(0,_typeof2.default)(c)&&null!=(r=c.defaultPageSize)?r:DEFAULT_PAGING_SIZE}function Ie(){O(),E(function(e){e.searchKeyWord=g,e.filterValues=S,e.sortValues=T})}function Ye(r){O(),E(function(e){e.searchKeyWord=r}),D||B(__assign(__assign({},P),{searchKeyWord:r}))}function Ze(){O(),E(function(e){e.searchKeyWord=""}),D||B(__assign(__assign({},P),{searchKeyWord:""}))}function He(){var e;return null!=(e=null==(e=N.current)?void 0:e.getScrollContainer())?e:document.body}function Je(){var e={searchKeyWord:g,filterValues:S,sortValues:T},r=F?F(__assign(__assign({},A.current),e)):Promise.resolve();return d?r.then(function(){return Ie(),D||null==d?void 0:d(__assign(__assign({},A.current),e)).then(function(e){De(e)})}):Promise.resolve(b)}function Qe(e){if(M.current===adhere_ui_scrollload_1.default.EMPTY)M.current=adhere_ui_scrollload_1.default.EMPTY,e(adhere_ui_scrollload_1.default.EMPTY);else{if(L.current=e,!D)return null==J?void 0:J(__assign({page:A.current.page+1,pageSize:A.current.pageSize},P)).then(function(r){A.current.page+=1,De(function(e){return e.total=r.total,e.data=__spreadArray(__spreadArray([],e.data,!0),r.data,!0),__assign({},e)})});A.current.page+=1,Ce()}}return(0,ahooks_1.useMount)(function(){B({searchKeyWord:g,filterValues:S,sortValues:T})}),(0,ahooks_1.useUpdateEffect)(function(){L.current&&(M.current=A.current.page<Be?adhere_ui_scrollload_1.default.NORMAL:adhere_ui_scrollload_1.default.EMPTY,L.current(M.current))},[b.data,Be,A.current.page]),(0,ahooks_1.useUpdateEffect)(function(){Ie(),B({searchKeyWord:g,filterValues:S,sortValues:T})},[g,T,S,D]),react_1.default.createElement("div",{className:(0,classnames_1.default)(selectorPrefix,null!=r?r:""),style:null!=t?t:{}},(n&&(e.current&&!R.current&&a&&(R.current=!0),e.current&&R.current&&!a&&(e.current=!1,R.current=!1),e.current)?C:v)())}));PRSL.displayName="PRSL",exports.default=PRSL;
//# sourceMappingURL=PRSL.js.map
