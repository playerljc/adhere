{"version":3,"file":"index.js","sources":["SearchKeyWord/index.js"],"sourcesContent":["\"use strict\";\n\nvar __assign = void 0 && (void 0).__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n    return t;\n  };\n  return __assign.apply(this, arguments);\n};\nvar __createBinding = void 0 && (void 0).__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n    desc = {\n      enumerable: true,\n      get: function get() {\n        return m[k];\n      }\n    };\n  }\n  Object.defineProperty(o, k2, desc);\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\nvar __setModuleDefault = void 0 && (void 0).__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\nvar __importStar = void 0 && (void 0).__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  __setModuleDefault(result, mod);\n  return result;\n};\nvar __importDefault = void 0 && (void 0).__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar ahooks_1 = require(\"ahooks\");\nvar antd_mobile_1 = require(\"antd-mobile\");\nvar classnames_1 = __importDefault(require(\"classnames\"));\nvar react_1 = __importStar(require(\"react\"));\nvar use_immer_1 = require(\"use-immer\");\nvar adhere_ui_popup_1 = __importDefault(require(\"@baifendian/adhere-ui-popup\"));\nvar adhere_util_intl_1 = __importDefault(require(\"@baifendian/adhere-util-intl\"));\nvar adhere_util_preferences_1 = __importDefault(require(\"@baifendian/adhere-util-preferences\"));\nvar SearchHistory_1 = __importDefault(require(\"./SearchHistory\"));\nvar SearchHistoryReducer_1 = __importDefault(require(\"./SearchHistoryReducer\"));\nvar selectorPrefix = 'adhere-mobile-ui-prsl-search-keyword';\nvar HISTORY_STORE_KEY = 'adhere-mobile-ui-prsl';\n/**\n * SearchKeyWord\n * @description 关键词搜索部分\n */\nvar SearchKeyWord = (0, react_1.memo)(function (_a) {\n  var className = _a.className,\n    style = _a.style,\n    searchKeyWordBarProps = _a.searchKeyWordBarProps,\n    searchKeyWordMode = _a.searchKeyWordMode,\n    searchKeyWordHistoryMaxSize = _a.searchKeyWordHistoryMaxSize,\n    isSearchKeyWordHistoryIntoStore = _a.isSearchKeyWordHistoryIntoStore,\n    searchKeyWordHistoryStoreType = _a.searchKeyWordHistoryStoreType,\n    defaultSearchKeyWord = _a.defaultSearchKeyWord,\n    _b = _a.disabled,\n    disabled = _b === void 0 ? false : _b,\n    onSearch = _a.onSearch,\n    onSearchClear = _a.onSearchClear;\n  var triggerRef = (0, react_1.useRef)(null);\n  var searchRef = (0, react_1.useRef)();\n  var _c = (0, use_immer_1.useImmerReducer)((0, SearchHistoryReducer_1.default)(searchKeyWordHistoryMaxSize), getDefaultHistoryData()),\n    historyData = _c[0],\n    dispatch = _c[1];\n  function getDefaultHistoryData() {\n    var _a, _b;\n    if (isSearchKeyWordHistoryIntoStore) {\n      if (searchKeyWordHistoryStoreType === 'session') {\n        return (_a = adhere_util_preferences_1.default.getObjectBySession(HISTORY_STORE_KEY)) !== null && _a !== void 0 ? _a : [];\n      } else if (searchKeyWordHistoryStoreType === 'local') {\n        return (_b = adhere_util_preferences_1.default.getObjectByLocal(HISTORY_STORE_KEY)) !== null && _b !== void 0 ? _b : [];\n      }\n      return [];\n    }\n    return [];\n  }\n  function search(value) {\n    onSearch === null || onSearch === void 0 ? void 0 : onSearch(value);\n  }\n  function clear() {\n    onSearchClear === null || onSearchClear === void 0 ? void 0 : onSearchClear();\n  }\n  function addHistory(kw) {\n    dispatch({\n      type: 'add',\n      addKw: kw\n    });\n  }\n  function removeHistory(id) {\n    dispatch({\n      type: 'remove',\n      removeId: id\n    });\n  }\n  function listHistory(list) {\n    dispatch({\n      type: 'list',\n      list: list\n    });\n  }\n  var isUseHistoryMode = (0, react_1.useMemo)(function () {\n    return searchKeyWordMode === 'history';\n  }, [searchKeyWordMode]);\n  (0, ahooks_1.useMount)(function () {\n    var _a;\n    if (triggerRef.current && ((_a = triggerRef.current) === null || _a === void 0 ? void 0 : _a.nativeElement)) {\n      triggerRef.current.nativeElement.setAttribute('readonly', '');\n    }\n  });\n  (0, react_1.useEffect)(function () {\n    if (!searchRef.current || !searchRef.current.nativeElement) return;\n    if (disabled) {\n      searchRef.current.nativeElement.setAttribute('readonly', '');\n    } else {\n      searchRef.current.nativeElement.removeAttribute('readonly');\n    }\n  }, [disabled]);\n  (0, ahooks_1.useUpdateEffect)(function () {\n    listHistory(getDefaultHistoryData());\n  }, [searchKeyWordHistoryStoreType, isSearchKeyWordHistoryIntoStore]);\n  (0, ahooks_1.useUpdateEffect)(function () {\n    if (isSearchKeyWordHistoryIntoStore) {\n      if (searchKeyWordHistoryStoreType === 'session') {\n        adhere_util_preferences_1.default.putObjectBySession(HISTORY_STORE_KEY, historyData);\n      } else if (searchKeyWordHistoryStoreType === 'local') {\n        adhere_util_preferences_1.default.putObjectByLocal(HISTORY_STORE_KEY, historyData);\n      }\n    }\n  }, [historyData, searchKeyWordHistoryStoreType, isSearchKeyWordHistoryIntoStore]);\n  return react_1.default.createElement(\"div\", {\n    key: defaultSearchKeyWord,\n    className: (0, classnames_1.default)(\"\".concat(selectorPrefix, \"-wrapper\"), className !== null && className !== void 0 ? className : ''),\n    style: style !== null && style !== void 0 ? style : {}\n  }, (disabled || !isUseHistoryMode) && react_1.default.createElement(antd_mobile_1.SearchBar\n  // @ts-ignore\n  , __assign({\n    // @ts-ignore\n    ref: searchRef,\n    defaultValue: defaultSearchKeyWord !== null && defaultSearchKeyWord !== void 0 ? defaultSearchKeyWord : '',\n    onSearch: search,\n    onClear: clear\n  }, searchKeyWordBarProps)), isUseHistoryMode && !disabled && react_1.default.createElement(adhere_ui_popup_1.default.Trigger, {\n    renderTrigger: function renderTrigger() {\n      return react_1.default.createElement(antd_mobile_1.SearchBar, __assign({\n        ref: triggerRef,\n        clearable: false,\n        className: \"\".concat(selectorPrefix, \"-trigger\"),\n        defaultValue: defaultSearchKeyWord !== null && defaultSearchKeyWord !== void 0 ? defaultSearchKeyWord : ''\n      }, searchKeyWordBarProps));\n    },\n    title: adhere_util_intl_1.default.v('查询历史'),\n    actions: []\n  }, react_1.default.createElement(SearchHistory_1.default, {\n    title: adhere_util_intl_1.default.v('查询历史'),\n    searchKeyWordBarProps: {\n      placeholder: adhere_util_intl_1.default.v('请输入关查询键字')\n    },\n    defaultSearchKeyWord: defaultSearchKeyWord !== null && defaultSearchKeyWord !== void 0 ? defaultSearchKeyWord : '',\n    onSearch: onSearch,\n    onSearchClear: onSearchClear,\n    historyData: historyData,\n    addHistory: addHistory,\n    removeHistory: removeHistory,\n    clearHistory: function clearHistory() {\n      listHistory([]);\n    },\n    closeSelf: function closeSelf() {\n      adhere_ui_popup_1.default.closeAll();\n    }\n  })));\n});\nSearchKeyWord.displayName = 'SearchKeyWord';\nexports.default = SearchKeyWord;"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","this","__createBinding","create","o","m","k","k2","undefined","desc","getOwnPropertyDescriptor","__esModule","writable","configurable","enumerable","get","defineProperty","__setModuleDefault","v","value","__importStar","mod","result","__importDefault","default","ahooks_1","exports","require","antd_mobile_1","classnames_1","react_1","use_immer_1","adhere_ui_popup_1","adhere_util_intl_1","adhere_util_preferences_1","SearchHistory_1","SearchHistoryReducer_1","selectorPrefix","HISTORY_STORE_KEY","SearchKeyWord","memo","_a","className","style","searchKeyWordBarProps","searchKeyWordMode","searchKeyWordHistoryMaxSize","isSearchKeyWordHistoryIntoStore","searchKeyWordHistoryStoreType","defaultSearchKeyWord","_b","disabled","onSearch","onSearchClear","triggerRef","useRef","searchRef","_c","useImmerReducer","getDefaultHistoryData","historyData","dispatch","getObjectBySession","getObjectByLocal","listHistory","list","type","isUseHistoryMode","useMemo","useMount","current","nativeElement","setAttribute","useEffect","removeAttribute","useUpdateEffect","putObjectBySession","putObjectByLocal","createElement","key","concat","SearchBar","ref","defaultValue","onClear","Trigger","renderTrigger","clearable","title","actions","placeholder","addHistory","kw","addKw","removeHistory","id","removeId","clearHistory","closeSelf","closeAll","displayName"],"mappings":"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"}