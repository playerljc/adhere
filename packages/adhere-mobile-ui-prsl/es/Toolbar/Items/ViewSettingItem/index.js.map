{"version":3,"file":"index.js","sources":["Toolbar/Items/ViewSettingItem/index.js"],"sourcesContent":["import _Popup from \"@baifendian/adhere-mobile-ui-anthoc/es/popup\";\nimport _Dialog from \"@baifendian/adhere-mobile-ui-anthoc/es/dialog\";\nimport _Modal from \"@baifendian/adhere-mobile-ui-anthoc/es/modal\";\nimport _CheckList from \"antd-mobile/es/components/check-list\";\nimport _AppstoreOutline from \"antd-mobile-icons/es/AppstoreOutline\";\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n    return t;\n  };\n  return __assign.apply(this, arguments);\n};\nimport { useUpdateEffect } from 'ahooks';\nimport React, { useCallback, useMemo, useState } from 'react';\nimport AdherePopup from '@baifendian/adhere-ui-popup';\nimport Intl from '@baifendian/adhere-util-intl';\nimport NormalItem from '../NormalItem';\nvar selectorPrefix = 'adhere-mobile-ui-prsl-toolbar-view-setting-item';\nvar ViewSettingItem = function (_a) {\n  var children = _a.children,\n    disabled = _a.disabled,\n    _b = _a.viewSettingTriggerMode,\n    viewSettingTriggerMode = _b === void 0 ? 'popup-bottom' : _b,\n    viewSettingTriggerProps = _a.viewSettingTriggerProps,\n    renderViewSetting = _a.renderViewSetting,\n    viewSettingConfig = _a.viewSettingConfig,\n    defaultViewSettingValue = _a.defaultViewSettingValue,\n    onViewSetting = _a.onViewSetting,\n    onViewSettingReset = _a.onViewSettingReset;\n  var _c = useState(defaultViewSettingValue !== null && defaultViewSettingValue !== void 0 ? defaultViewSettingValue : 'normal'),\n    viewSettingValue = _c[0],\n    setViewSettingValue = _c[1];\n  var targetViewSettingValue = useMemo(function () {\n    if (Array.isArray(viewSettingValue)) return viewSettingValue;\n    if (!viewSettingValue) return [];\n    return [viewSettingValue];\n  }, [viewSettingValue]);\n  var defaultElement = /*#__PURE__*/React.createElement(NormalItem, {\n    key: \"view-setting-item\",\n    className: selectorPrefix,\n    icon: /*#__PURE__*/React.createElement(_AppstoreOutline, null),\n    label: Intl.v('视图')\n  });\n  var triggerElement = useMemo(function () {\n    var _a;\n    return (_a = children === null || children === void 0 ? void 0 : children(defaultElement)) !== null && _a !== void 0 ? _a : defaultElement;\n  }, [children, defaultElement]);\n  var actions = useMemo(function () {\n    if (viewSettingTriggerMode === 'adhere-popup') {\n      return [{\n        key: 'reset',\n        type: 'primary',\n        children: Intl.v('重置'),\n        onClick: reset\n      }];\n    }\n    return [{\n      key: 'reset',\n      primary: true,\n      text: Intl.v('重置'),\n      onClick: reset\n    }];\n  }, [viewSettingTriggerMode]);\n  var renderViewSettingElement = useCallback(function (_a) {\n    var close = _a.close;\n    if (renderViewSetting) {\n      return renderViewSetting === null || renderViewSetting === void 0 ? void 0 : renderViewSetting(viewSettingValue !== null && viewSettingValue !== void 0 ? viewSettingValue : 'normal');\n    }\n    return /*#__PURE__*/React.createElement(_CheckList, {\n      className: \"\".concat(selectorPrefix, \"-list\"),\n      value: targetViewSettingValue,\n      defaultValue: targetViewSettingValue,\n      multiple: false,\n      onChange: function (v) {\n        var _viewSettingValue = v.length ? v[0] : 'normal';\n        setViewSettingValue(_viewSettingValue);\n        viewSetting(_viewSettingValue);\n        if (viewSettingTriggerMode === 'adhere-popup') {\n          AdherePopup.closeAll();\n        } else {\n          close === null || close === void 0 ? void 0 : close();\n        }\n      }\n    }, viewSettingConfig === null || viewSettingConfig === void 0 ? void 0 : viewSettingConfig.map(function (_viewSettingValue) {\n      return /*#__PURE__*/React.createElement(_CheckList.Item, {\n        key: _viewSettingValue.name,\n        value: _viewSettingValue.name,\n        className: \"\".concat(selectorPrefix, \"-list-item\")\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"\".concat(selectorPrefix, \"-list-item-label\")\n      }, _viewSettingValue.label));\n    }));\n  }, [renderViewSetting, viewSettingConfig, viewSettingTriggerMode, targetViewSettingValue]);\n  var triggerContext = useMemo(function () {\n    if (viewSettingTriggerMode === 'modal') {\n      return /*#__PURE__*/React.createElement(_Modal.Context.Consumer, null, function (value) {\n        return renderViewSettingElement(value);\n      });\n    } else if (viewSettingTriggerMode === 'dialog') {\n      return /*#__PURE__*/React.createElement(_Dialog.Context.Consumer, null, function (value) {\n        return renderViewSettingElement(value);\n      });\n    } else if (viewSettingTriggerMode === 'popup-bottom') {\n      return /*#__PURE__*/React.createElement(_Popup.Context.Consumer, null, function (value) {\n        return renderViewSettingElement(value);\n      });\n    } else {\n      return renderViewSettingElement;\n    }\n  }, [viewSettingTriggerMode, renderViewSettingElement]);\n  var childrenElement = useMemo(function () {\n    var commonProps = __assign({}, viewSettingTriggerProps);\n    // hoc\n    if (['popup-bottom', 'popup-top', 'modal', 'dialog'].includes(viewSettingTriggerMode !== null && viewSettingTriggerMode !== void 0 ? viewSettingTriggerMode : '')) {\n      var hocProps = __assign(__assign({}, commonProps), {\n        actions: actions,\n        popoverTriggerProps: __assign(__assign({}, viewSettingTriggerProps === null || viewSettingTriggerProps === void 0 ? void 0 : viewSettingTriggerProps.popoverTriggerProps), {\n          renderTrigger: function () {\n            return triggerElement;\n          }\n        })\n      });\n      // Popup\n      if (['popup-bottom', 'popup-top'].includes(viewSettingTriggerMode !== null && viewSettingTriggerMode !== void 0 ? viewSettingTriggerMode : '')) {\n        var position = new Map([['popup-bottom', 'bottom'], ['popup-top', 'top']]);\n        var popupProps = __assign(__assign({}, hocProps), {\n          position: position.get(viewSettingTriggerMode !== null && viewSettingTriggerMode !== void 0 ? viewSettingTriggerMode : '')\n        });\n        return /*#__PURE__*/React.createElement(_Popup.Trigger, __assign({\n          disabled: disabled\n        }, popupProps), triggerContext);\n      }\n      // Modal\n      else if (viewSettingTriggerMode === 'modal') {\n        return /*#__PURE__*/React.createElement(_Modal.TriggerPrompt, __assign({\n          disabled: disabled\n        }, hocProps), triggerContext);\n      }\n      // Dialog\n      else if (viewSettingTriggerMode === 'dialog') {\n        return /*#__PURE__*/React.createElement(_Dialog.TriggerPrompt, __assign({\n          disabled: disabled\n        }, hocProps), triggerContext);\n      }\n    }\n    // adhere-popup\n    else if (viewSettingTriggerMode === 'adhere-popup') {\n      return /*#__PURE__*/React.createElement(AdherePopup.Trigger, __assign({}, commonProps, {\n        disabled: disabled,\n        renderTrigger: function () {\n          return triggerElement;\n        },\n        actions: actions\n      }), triggerContext);\n    }\n  }, [viewSettingTriggerMode, viewSettingTriggerProps, triggerElement, triggerContext, actions]);\n  function viewSetting(viewSettingValue) {\n    setViewSettingValue(viewSettingValue);\n    return onViewSetting === null || onViewSetting === void 0 ? void 0 : onViewSetting(viewSettingValue !== null && viewSettingValue !== void 0 ? viewSettingValue : 'normal');\n  }\n  function reset() {\n    setViewSettingValue(defaultViewSettingValue !== null && defaultViewSettingValue !== void 0 ? defaultViewSettingValue : 'normal');\n    if (!onViewSettingReset) return Promise.resolve();\n    return onViewSettingReset === null || onViewSettingReset === void 0 ? void 0 : onViewSettingReset();\n  }\n  useUpdateEffect(function () {\n    setViewSettingValue(defaultViewSettingValue !== null && defaultViewSettingValue !== void 0 ? defaultViewSettingValue : 'normal');\n  }, [defaultViewSettingValue]);\n  return childrenElement;\n};\nViewSettingItem.displayName = 'ViewSettingItem';\nexport default ViewSettingItem;"],"names":["_Popup","_Dialog","_Modal","_CheckList","_AppstoreOutline","__assign","this","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","useUpdateEffect","React","useCallback","useMemo","useState","AdherePopup","Intl","NormalItem","selectorPrefix","ViewSettingItem","_a","children","disabled","_b","viewSettingTriggerMode","viewSettingTriggerProps","renderViewSetting","viewSettingConfig","defaultViewSettingValue","onViewSetting","onViewSettingReset","_c","viewSettingValue","setViewSettingValue","targetViewSettingValue","Array","isArray","defaultElement","createElement","key","className","icon","label","v","triggerElement","actions","type","onClick","reset","primary","text","renderViewSettingElement","close","concat","value","defaultValue","multiple","onChange","_viewSettingValue","closeAll","map","Item","name","triggerContext","Context","Consumer","childrenElement","hocProps","popupProps","commonProps","includes","popoverTriggerProps","renderTrigger","position","Map","get","Trigger","TriggerPrompt","Promise","resolve","displayName"],"mappings":"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"}