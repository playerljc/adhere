{"version":3,"file":"index.js","sources":["Toolbar/Items/FilterItem/index.js"],"sourcesContent":["import _Dialog from \"@baifendian/adhere-mobile-ui-anthoc/es/dialog\";\nimport _Modal from \"@baifendian/adhere-mobile-ui-anthoc/es/modal\";\nimport _Popup from \"@baifendian/adhere-mobile-ui-anthoc/es/popup\";\nimport _FilterOutline from \"antd-mobile-icons/es/FilterOutline\";\nimport _Form from \"antd-mobile/es/components/form\";\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n    return t;\n  };\n  return __assign.apply(this, arguments);\n};\nimport { useMount, useUpdateEffect } from 'ahooks';\nimport isPrimaryEmpty from 'lodash.isempty';\nimport React, { useMemo } from 'react';\nimport AdherePopup from '@baifendian/adhere-ui-popup';\nimport Intl from '@baifendian/adhere-util-intl';\nimport NormalItem from '../NormalItem';\nvar selectorPrefix = 'adhere-mobile-ui-prsl-toolbar-filter-item';\n/**\n * FilterItem\n * @param children\n * @param disabled\n * @param filterTriggerMode\n * @param filterTriggerProps\n * @param renderFilter\n * @param filterFormProps\n * @param filterConfig\n * @param defaultFilterValues\n * @param onFilter\n * @param onFilterReset\n * @constructor\n */\nvar FilterItem = function FilterItem(_a) {\n  var children = _a.children,\n    disabled = _a.disabled,\n    _b = _a.filterTriggerMode,\n    filterTriggerMode = _b === void 0 ? 'popup-bottom' : _b,\n    _c = _a.filterTriggerProps,\n    filterTriggerProps = _c === void 0 ? {} : _c,\n    renderFilter = _a.renderFilter,\n    filterFormProps = _a.filterFormProps,\n    filterConfig = _a.filterConfig,\n    defaultFilterValues = _a.defaultFilterValues,\n    onFilter = _a.onFilter,\n    onFilterReset = _a.onFilterReset;\n  var form = _Form.useForm()[0];\n  var defaultElement = /*#__PURE__*/React.createElement(NormalItem, {\n    key: \"filter-item\",\n    className: selectorPrefix,\n    icon: /*#__PURE__*/React.createElement(_FilterOutline, null),\n    label: Intl.v('筛选')\n  });\n  var triggerElement = useMemo(function () {\n    var _a;\n    return (_a = children === null || children === void 0 ? void 0 : children(defaultElement)) !== null && _a !== void 0 ? _a : defaultElement;\n  }, [children, defaultElement]);\n  var actions = useMemo(function () {\n    if (filterTriggerMode === 'adhere-popup') {\n      return [{\n        key: 'ok',\n        type: 'primary',\n        children: Intl.v('确定'),\n        onClick: search\n      }, {\n        key: 'reset',\n        type: 'primary',\n        children: Intl.v('重置'),\n        onClick: reset\n      }];\n    }\n    return [{\n      key: 'ok',\n      primary: true,\n      text: Intl.v('确定'),\n      onClick: search\n    }, {\n      key: 'reset',\n      primary: true,\n      text: Intl.v('重置'),\n      onClick: reset\n    }];\n  }, [filterTriggerMode]);\n  var searchElement = useMemo(function () {\n    if (renderFilter) {\n      return renderFilter === null || renderFilter === void 0 ? void 0 : renderFilter(defaultFilterValues !== null && defaultFilterValues !== void 0 ? defaultFilterValues : {});\n    }\n    return /*#__PURE__*/React.createElement(_Form, __assign({\n      form: form,\n      layout: \"horizontal\"\n    }, filterFormProps), filterConfig === null || filterConfig === void 0 ? void 0 : filterConfig.map(function (_a) {\n      var key = _a.key,\n        name = _a.name,\n        label = _a.label,\n        formItemProps = _a.formItemProps,\n        render = _a.render;\n      return /*#__PURE__*/React.createElement(_Form.Item, __assign({\n        key: key,\n        name: name,\n        label: label\n      }, formItemProps !== null && formItemProps !== void 0 ? formItemProps : {}), render === null || render === void 0 ? void 0 : render(form));\n    }));\n  }, [renderFilter, defaultFilterValues]);\n  var childrenElement = useMemo(function () {\n    var commonProps = __assign({}, filterTriggerProps);\n    // hoc\n    if (['popup-bottom', 'popup-top', 'modal', 'dialog'].includes(filterTriggerMode !== null && filterTriggerMode !== void 0 ? filterTriggerMode : '')) {\n      var hocProps = __assign(__assign({}, commonProps), {\n        actions: actions,\n        popoverTriggerProps: __assign(__assign({}, filterTriggerProps === null || filterTriggerProps === void 0 ? void 0 : filterTriggerProps.popoverTriggerProps), {\n          renderTrigger: function renderTrigger() {\n            return triggerElement;\n          }\n        })\n      });\n      // Popup\n      if (['popup-bottom', 'popup-top'].includes(filterTriggerMode !== null && filterTriggerMode !== void 0 ? filterTriggerMode : '')) {\n        var position = new Map([['popup-bottom', 'bottom'], ['popup-top', 'top']]);\n        var popupProps = __assign(__assign({}, hocProps), {\n          position: position.get(filterTriggerMode !== null && filterTriggerMode !== void 0 ? filterTriggerMode : '')\n        });\n        return /*#__PURE__*/React.createElement(_Popup.Trigger, __assign({\n          disabled: disabled\n        }, popupProps), searchElement);\n      }\n      // Modal\n      else if (filterTriggerMode === 'modal') {\n        return /*#__PURE__*/React.createElement(_Modal.TriggerPrompt, __assign({\n          disabled: disabled\n        }, hocProps), searchElement);\n      }\n      // Dialog\n      else if (filterTriggerMode === 'dialog') {\n        return /*#__PURE__*/React.createElement(_Dialog.TriggerPrompt, __assign({\n          disabled: disabled\n        }, hocProps), searchElement);\n      }\n    }\n    // adhere-popup\n    else if (filterTriggerMode === 'adhere-popup') {\n      return /*#__PURE__*/React.createElement(AdherePopup.Trigger, __assign({}, commonProps, {\n        disabled: disabled,\n        renderTrigger: function renderTrigger() {\n          return triggerElement;\n        },\n        actions: actions\n      }), searchElement);\n    }\n  }, [filterTriggerMode, filterTriggerProps, triggerElement, searchElement, actions, disabled]);\n  function search() {\n    if (!onFilter) return Promise.resolve();\n    var filterData = form ? form.getFieldsValue() : defaultFilterValues;\n    return onFilter === null || onFilter === void 0 ? void 0 : onFilter(filterData);\n  }\n  function reset() {\n    // @ts-ignore\n    form === null || form === void 0 ? void 0 : form.resetFields(isPrimaryEmpty(defaultFilterValues) ? undefined : defaultFilterValues);\n    if (!onFilterReset) {\n      return Promise.resolve();\n    }\n    return onFilterReset === null || onFilterReset === void 0 ? void 0 : onFilterReset();\n  }\n  useMount(function () {\n    if (!form) return;\n    form.setFieldsValue(defaultFilterValues);\n  });\n  useUpdateEffect(function () {\n    if (!form) return;\n    if (!defaultFilterValues) {\n      form.resetFields();\n    } else {\n      form.setFieldsValue(defaultFilterValues);\n    }\n  }, [defaultFilterValues]);\n  return childrenElement;\n};\nFilterItem.displayName = 'FilterItem';\nexport default FilterItem;"],"names":["_Dialog","_Modal","_Popup","_FilterOutline","_Form","__assign","this","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","useMount","useUpdateEffect","isPrimaryEmpty","React","useMemo","AdherePopup","Intl","NormalItem","selectorPrefix","FilterItem","_a","children","disabled","_b","filterTriggerMode","_c","filterTriggerProps","renderFilter","filterFormProps","filterConfig","defaultFilterValues","onFilter","onFilterReset","form","useForm","defaultElement","createElement","key","className","icon","label","v","triggerElement","actions","type","onClick","search","reset","primary","text","searchElement","layout","map","name","formItemProps","render","Item","childrenElement","hocProps","popupProps","commonProps","includes","popoverTriggerProps","renderTrigger","position","Map","get","Trigger","TriggerPrompt","filterData","getFieldsValue","Promise","resolve","resetFields","undefined","setFieldsValue","displayName"],"mappings":"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"}