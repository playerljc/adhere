{"version":3,"file":"index.js","sources":["SearchKeyWord/index.js"],"sourcesContent":["import _SearchBar from \"antd-mobile/es/components/search-bar\";\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n    return t;\n  };\n  return __assign.apply(this, arguments);\n};\nimport { useMount, useUpdateEffect } from 'ahooks';\nimport classNames from 'classnames';\nimport React, { memo, useEffect, useMemo, useRef } from 'react';\nimport { useImmerReducer } from 'use-immer';\nimport AdherePopup from '@baifendian/adhere-ui-popup';\nimport Intl from '@baifendian/adhere-util-intl';\nimport Preferences from '@baifendian/adhere-util-preferences';\nimport SearchHistory from './SearchHistory';\nimport SearchHistoryReducer from './SearchHistoryReducer';\nvar selectorPrefix = 'adhere-mobile-ui-prsl-search-keyword';\nvar HISTORY_STORE_KEY = 'adhere-mobile-ui-prsl';\n/**\n * SearchKeyWord\n * @description 关键词搜索部分\n */\nvar SearchKeyWord = /*#__PURE__*/memo(function (_a) {\n  var className = _a.className,\n    style = _a.style,\n    searchKeyWordBarProps = _a.searchKeyWordBarProps,\n    searchKeyWordMode = _a.searchKeyWordMode,\n    searchKeyWordHistoryMaxSize = _a.searchKeyWordHistoryMaxSize,\n    isSearchKeyWordHistoryIntoStore = _a.isSearchKeyWordHistoryIntoStore,\n    searchKeyWordHistoryStoreType = _a.searchKeyWordHistoryStoreType,\n    defaultSearchKeyWord = _a.defaultSearchKeyWord,\n    _b = _a.disabled,\n    disabled = _b === void 0 ? false : _b,\n    onSearch = _a.onSearch,\n    onSearchClear = _a.onSearchClear;\n  var triggerRef = useRef(null);\n  var searchRef = useRef();\n  var _c = useImmerReducer(SearchHistoryReducer(searchKeyWordHistoryMaxSize), getDefaultHistoryData()),\n    historyData = _c[0],\n    dispatch = _c[1];\n  function getDefaultHistoryData() {\n    var _a, _b;\n    if (isSearchKeyWordHistoryIntoStore) {\n      if (searchKeyWordHistoryStoreType === 'session') {\n        return (_a = Preferences.getObjectBySession(HISTORY_STORE_KEY)) !== null && _a !== void 0 ? _a : [];\n      } else if (searchKeyWordHistoryStoreType === 'local') {\n        return (_b = Preferences.getObjectByLocal(HISTORY_STORE_KEY)) !== null && _b !== void 0 ? _b : [];\n      }\n      return [];\n    }\n    return [];\n  }\n  function search(value) {\n    onSearch === null || onSearch === void 0 ? void 0 : onSearch(value);\n  }\n  function clear() {\n    onSearchClear === null || onSearchClear === void 0 ? void 0 : onSearchClear();\n  }\n  function addHistory(kw) {\n    dispatch({\n      type: 'add',\n      addKw: kw\n    });\n  }\n  function removeHistory(id) {\n    dispatch({\n      type: 'remove',\n      removeId: id\n    });\n  }\n  function listHistory(list) {\n    dispatch({\n      type: 'list',\n      list: list\n    });\n  }\n  var isUseHistoryMode = useMemo(function () {\n    return searchKeyWordMode === 'history';\n  }, [searchKeyWordMode]);\n  useMount(function () {\n    var _a;\n    if (triggerRef.current && ((_a = triggerRef.current) === null || _a === void 0 ? void 0 : _a.nativeElement)) {\n      triggerRef.current.nativeElement.setAttribute('readonly', '');\n    }\n  });\n  useEffect(function () {\n    if (!searchRef.current || !searchRef.current.nativeElement) return;\n    if (disabled) {\n      searchRef.current.nativeElement.setAttribute('readonly', '');\n    } else {\n      searchRef.current.nativeElement.removeAttribute('readonly');\n    }\n  }, [disabled]);\n  useUpdateEffect(function () {\n    listHistory(getDefaultHistoryData());\n  }, [searchKeyWordHistoryStoreType, isSearchKeyWordHistoryIntoStore]);\n  useUpdateEffect(function () {\n    if (isSearchKeyWordHistoryIntoStore) {\n      if (searchKeyWordHistoryStoreType === 'session') {\n        Preferences.putObjectBySession(HISTORY_STORE_KEY, historyData);\n      } else if (searchKeyWordHistoryStoreType === 'local') {\n        Preferences.putObjectByLocal(HISTORY_STORE_KEY, historyData);\n      }\n    }\n  }, [historyData, searchKeyWordHistoryStoreType, isSearchKeyWordHistoryIntoStore]);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    key: defaultSearchKeyWord,\n    className: classNames(\"\".concat(selectorPrefix, \"-wrapper\"), className !== null && className !== void 0 ? className : ''),\n    style: style !== null && style !== void 0 ? style : {}\n  }, (disabled || !isUseHistoryMode) && /*#__PURE__*/React.createElement(_SearchBar, __assign({\n    // @ts-ignore\n    ref: searchRef,\n    defaultValue: defaultSearchKeyWord !== null && defaultSearchKeyWord !== void 0 ? defaultSearchKeyWord : '',\n    onSearch: search,\n    onClear: clear\n  }, searchKeyWordBarProps)), isUseHistoryMode && !disabled && /*#__PURE__*/React.createElement(AdherePopup.Trigger, {\n    renderTrigger: function renderTrigger() {\n      return /*#__PURE__*/React.createElement(_SearchBar, __assign({\n        ref: triggerRef,\n        clearable: false,\n        className: \"\".concat(selectorPrefix, \"-trigger\"),\n        defaultValue: defaultSearchKeyWord !== null && defaultSearchKeyWord !== void 0 ? defaultSearchKeyWord : ''\n      }, searchKeyWordBarProps));\n    },\n    title: Intl.v('查询历史'),\n    actions: []\n  }, /*#__PURE__*/React.createElement(SearchHistory, {\n    title: Intl.v('查询历史'),\n    searchKeyWordBarProps: {\n      placeholder: Intl.v('请输入关查询键字')\n    },\n    defaultSearchKeyWord: defaultSearchKeyWord !== null && defaultSearchKeyWord !== void 0 ? defaultSearchKeyWord : '',\n    onSearch: onSearch,\n    onSearchClear: onSearchClear,\n    historyData: historyData,\n    addHistory: addHistory,\n    removeHistory: removeHistory,\n    clearHistory: function clearHistory() {\n      listHistory([]);\n    },\n    closeSelf: function closeSelf() {\n      AdherePopup.closeAll();\n    }\n  })));\n});\nSearchKeyWord.displayName = 'SearchKeyWord';\nexport default SearchKeyWord;"],"names":["_SearchBar","__assign","this","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","useMount","useUpdateEffect","classNames","React","memo","useEffect","useMemo","useRef","useImmerReducer","AdherePopup","Intl","Preferences","SearchHistory","SearchHistoryReducer","selectorPrefix","HISTORY_STORE_KEY","SearchKeyWord","_a","className","style","searchKeyWordBarProps","searchKeyWordMode","searchKeyWordHistoryMaxSize","isSearchKeyWordHistoryIntoStore","searchKeyWordHistoryStoreType","defaultSearchKeyWord","_b","disabled","onSearch","onSearchClear","triggerRef","searchRef","_c","getDefaultHistoryData","historyData","dispatch","getObjectBySession","getObjectByLocal","listHistory","list","type","isUseHistoryMode","current","nativeElement","setAttribute","removeAttribute","putObjectBySession","putObjectByLocal","createElement","key","concat","ref","defaultValue","value","onClear","Trigger","renderTrigger","clearable","title","v","actions","placeholder","addHistory","kw","addKw","removeHistory","id","removeId","clearHistory","closeSelf","closeAll","displayName"],"mappings":"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"}