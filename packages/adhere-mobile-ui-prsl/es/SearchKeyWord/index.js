import _SearchBar from"antd-mobile/es/components/search-bar";var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var r,t=1,a=arguments.length;t<a;t++)for(var o in r=arguments[t])Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o]);return e}).apply(this,arguments)};import{useMount,useUpdateEffect}from"ahooks";import classNames from"classnames";import React,{memo,useEffect,useMemo,useRef}from"react";import{useImmerReducer}from"use-immer";import AdherePopup from"@baifendian/adhere-ui-popup";import Intl from"@baifendian/adhere-util-intl";import Preferences from"@baifendian/adhere-util-preferences";import SearchHistory from"./SearchHistory";import SearchHistoryReducer from"./SearchHistoryReducer";var selectorPrefix="adhere-mobile-ui-prsl-search-keyword",HISTORY_STORE_KEY="adhere-mobile-ui-prsl",SearchKeyWord=memo(function(e){var r=e.className,t=e.style,a=e.searchKeyWordBarProps,o=e.searchKeyWordMode,n=e.searchKeyWordHistoryMaxSize,c=e.isSearchKeyWordHistoryIntoStore,s=e.searchKeyWordHistoryStoreType,i=e.defaultSearchKeyWord,l=e.disabled,u=void 0!==l&&l,f=e.onSearch,m=e.onSearchClear,d=useRef(null),h=useRef(),l=useImmerReducer(SearchHistoryReducer(n),S()),y=l[0],p=l[1];function S(){var e;return c?"session"===s?null!=(e=Preferences.getObjectBySession(HISTORY_STORE_KEY))?e:[]:"local"===s&&null!=(e=Preferences.getObjectByLocal(HISTORY_STORE_KEY))?e:[]:[]}function E(e){p({type:"list",list:e})}e=useMemo(function(){return"history"===o},[o]);return useMount(function(){var e;d.current&&null!=(e=d.current)&&e.nativeElement&&d.current.nativeElement.setAttribute("readonly","")}),useEffect(function(){h.current&&h.current.nativeElement&&(u?h.current.nativeElement.setAttribute("readonly",""):h.current.nativeElement.removeAttribute("readonly"))},[u]),useUpdateEffect(function(){E(S())},[s,c]),useUpdateEffect(function(){c&&("session"===s?Preferences.putObjectBySession(HISTORY_STORE_KEY,y):"local"===s&&Preferences.putObjectByLocal(HISTORY_STORE_KEY,y))},[y,s,c]),React.createElement("div",{key:i,className:classNames("".concat(selectorPrefix,"-wrapper"),null!=r?r:""),style:null!=t?t:{}},(u||!e)&&React.createElement(_SearchBar,__assign({ref:h,defaultValue:null!=i?i:"",onSearch:function(e){null!=f&&f(e)},onClear:function(){null!=m&&m()}},a)),e&&!u&&React.createElement(AdherePopup.Trigger,{renderTrigger:function(){return React.createElement(_SearchBar,__assign({ref:d,clearable:!1,className:"".concat(selectorPrefix,"-trigger"),defaultValue:null!=i?i:""},a))},title:Intl.v("查询历史"),actions:[]},React.createElement(SearchHistory,{title:Intl.v("查询历史"),searchKeyWordBarProps:{placeholder:Intl.v("请输入关查询键字")},defaultSearchKeyWord:null!=i?i:"",onSearch:f,onSearchClear:m,historyData:y,addHistory:function(e){p({type:"add",addKw:e})},removeHistory:function(e){p({type:"remove",removeId:e})},clearHistory:function(){E([])},closeSelf:function(){AdherePopup.closeAll()}})))});SearchKeyWord.displayName="SearchKeyWord";export default SearchKeyWord;
//# sourceMappingURL=index.js.map
