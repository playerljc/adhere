{"version":3,"file":"expression.js","sources":["expression.js"],"sourcesContent":["\"use strict\";\n\nvar __createBinding = void 0 && (void 0).__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n    desc = {\n      enumerable: true,\n      get: function get() {\n        return m[k];\n      }\n    };\n  }\n  Object.defineProperty(o, k2, desc);\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\nvar __setModuleDefault = void 0 && (void 0).__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\nvar __importStar = void 0 && (void 0).__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  __setModuleDefault(result, mod);\n  return result;\n};\nvar __importDefault = void 0 && (void 0).__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.selectorPrefix = void 0;\nvar ahooks_1 = require(\"ahooks\");\nvar antd_1 = require(\"antd\");\nvar classnames_1 = __importDefault(require(\"classnames\"));\nvar react_1 = __importStar(require(\"react\"));\nvar icons_1 = require(\"@ant-design/icons\");\nvar adhere_ui_hooks_1 = __importDefault(require(\"@baifendian/adhere-ui-hooks\"));\nvar adhere_util_1 = __importDefault(require(\"@baifendian/adhere-util\"));\nvar adhere_util_intl_1 = __importDefault(require(\"@baifendian/adhere-util-intl\"));\nvar View_1 = __importDefault(require(\"./View\"));\nvar getCurrentParentElementWithCursor = adhere_util_1.default.getCurrentParentElementWithCursor,\n  getCurrentElementWithCursor = adhere_util_1.default.getCurrentElementWithCursor,\n  setCursorToEnd = adhere_util_1.default.setCursorToEnd,\n  setCursorPositionToNode = adhere_util_1.default.setCursorPositionToNode,\n  setCursorPosition = adhere_util_1.default.setCursorPosition,\n  getCursorIndex = adhere_util_1.default.getCursorIndex;\n// 缺省的触发字符code\nvar defaultTriggerCharCode = 32;\n// html的空格\nvar htmlSpace = '&nbsp;';\nvar useSetState = adhere_ui_hooks_1.default.useSetState;\nexports.selectorPrefix = 'adhere-ui-expression';\n/**\n * Expression\n * @param className\n * @param style\n * @param editorClassName\n * @param editorStyle\n * @param operatorWrapClassName\n * @param operatorWrapStyle\n * @param quickTipWrapClassName\n * @param quickTipWrapStyle\n * @param textClassName\n * @param operatorClassName\n * @param value\n * @param placeholder\n * @param triggerCharCode\n * @param quickTipProp\n * @param quickTipDataSource\n * @param disableQuickTip\n * @param operators\n * @param onChange\n * @param onContinuousTextChange\n * @param onEditorInputEnd\n * @param onEditorBlurEnd\n * @param onEditorKeyDownEnd\n * @param onEditorPasteEnd\n * @param ref\n * @constructor\n */\nvar Expression = function Expression(_a, ref) {\n  var _b, _c, _d;\n  var className = _a.className,\n    style = _a.style,\n    editorClassName = _a.editorClassName,\n    editorStyle = _a.editorStyle,\n    operatorWrapClassName = _a.operatorWrapClassName,\n    operatorWrapStyle = _a.operatorWrapStyle,\n    quickTipWrapClassName = _a.quickTipWrapClassName,\n    quickTipWrapStyle = _a.quickTipWrapStyle,\n    textClassName = _a.textClassName,\n    operatorClassName = _a.operatorClassName,\n    value = _a.value,\n    placeholder = _a.placeholder,\n    triggerCharCode = _a.triggerCharCode,\n    quickTipProp = _a.quickTipProp,\n    quickTipDataSource = _a.quickTipDataSource,\n    disableQuickTip = _a.disableQuickTip,\n    operators = _a.operators,\n    onChange = _a.onChange,\n    onContinuousTextChange = _a.onContinuousTextChange,\n    onEditorInputEnd = _a.onEditorInputEnd,\n    onEditorBlurEnd = _a.onEditorBlurEnd,\n    onEditorKeyDownEnd = _a.onEditorKeyDownEnd,\n    onEditorPasteEnd = _a.onEditorPasteEnd;\n  var operatorsConfig = (0, react_1.useMemo)(function () {\n    return operators !== null && operators !== void 0 ? operators : [{\n      label: '()',\n      value: '()',\n      type: 'brackets'\n    }, {\n      label: 'AND',\n      value: 'AND',\n      type: 'binary'\n    }, {\n      label: 'OR',\n      value: 'OR',\n      type: 'binary'\n    }, {\n      label: 'NOT',\n      value: 'NOT',\n      type: 'unary'\n    }];\n  }, [operators]);\n  // contextRef\n  var contextRef = (0, react_1.useRef)(null);\n  // input对象\n  var editorRef = (0, react_1.useRef)(null);\n  // 运算符下拉\n  var operatorsRef = (0, react_1.useRef)(null);\n  // quickTipRef\n  var quickTipRef = (0, react_1.useRef)(null);\n  // placeholder\n  var placeholderRef = (0, react_1.useRef)(null);\n  // 光标输入处的父元素\n  var cursorContextParentElement = (0, react_1.useRef)(null);\n  // 光标输入处的元素\n  var cursorContextElement = (0, react_1.useRef)(null);\n  // 光标的索引\n  var cursorIndex = (0, react_1.useRef)(-1);\n  // 之前光标的索引\n  var preCursorIndex = (0, react_1.useRef)(0);\n  // 之前光标处的元素\n  var preCursorContextElement = (0, react_1.useRef)(null);\n  // 连续输入的字符\n  var continuousText = (0, react_1.useRef)('');\n  // 若干可见字符的输入之前，而这些可见字符的输入可能需要一连串的键盘操作、点击输入法的备选词等\n  var comStart = (0, react_1.useRef)(false);\n  var _e = useSetState(false),\n    operatorsShow = _e[0],\n    setOperatorsShow = _e[1];\n  var _f = useSetState(false),\n    quickTipShow = _f[0],\n    setQuickTipShow = _f[1];\n  var _g = useSetState(true),\n    placeholderShow = _g[0],\n    setPlaceholderShow = _g[1];\n  var triggerChar = (0, react_1.useMemo)(function () {\n    return String.fromCharCode(triggerCharCode !== null && triggerCharCode !== void 0 ? triggerCharCode : defaultTriggerCharCode);\n  }, [triggerCharCode]);\n  (0, ahooks_1.useUpdateLayoutEffect)(function () {\n    onReady();\n  }, [value]);\n  (0, ahooks_1.useMount)(function () {\n    var editor = getEditorEl();\n    if (editor) {\n      editor.innerHTML = value !== null && value !== void 0 ? value : '';\n    }\n    setCursorToEnd(editor);\n    onReady();\n  });\n  (0, react_1.useImperativeHandle)(ref, function () {\n    return {\n      setValue: function setValue(_value) {\n        var editor = getEditorEl();\n        if (editor) {\n          editor.innerHTML = _value !== null && _value !== void 0 ? _value : '';\n        }\n        setCursorToEnd(editor);\n        onReady();\n      },\n      getValue: function getValue() {\n        var _a;\n        return (_a = getEditorEl()) === null || _a === void 0 ? void 0 : _a.innerHTML;\n      },\n      isEditorEmpty: isEditorEmpty,\n      showQuickTip: showQuickTip,\n      showOperators: showOperators,\n      hideQuickTip: hideQuickTip,\n      hideOperators: hideOperators\n    };\n  });\n  /**\n   * onReady\n   * @description 组件mount\n   */\n  function onReady() {\n    initial();\n  }\n  /**\n   * initial\n   * @description 初始化\n   */\n  function initial() {\n    if (isEditorEmpty()) {\n      showPlaceholder();\n    } else {\n      hidePlaceholder();\n    }\n  }\n  /**\n   * getEditorEl\n   * @return {HTMLElement}\n   */\n  function getEditorEl() {\n    var _a;\n    if (isFont()) {\n      return (_a = editorRef === null || editorRef === void 0 ? void 0 : editorRef.current) === null || _a === void 0 ? void 0 : _a.firstElementChild;\n    } else {\n      return editorRef === null || editorRef === void 0 ? void 0 : editorRef.current;\n    }\n  }\n  /**\n   * isEditorEmpty\n   * @description 编辑器是否为空\n   * @return {boolean}\n   */\n  function isEditorEmpty() {\n    var _a, _b, _c;\n    return ((_c = (_b = (_a = getEditorEl()) === null || _a === void 0 ? void 0 : _a.innerHTML) === null || _b === void 0 ? void 0 : _b.trim) === null || _c === void 0 ? void 0 : _c.call(_b)) === '';\n  }\n  function getCursorPosition() {\n    var x = 0;\n    var y = 0;\n    if (window.getSelection) {\n      var selection = window.getSelection();\n      if (selection && selection.rangeCount > 0) {\n        var range = selection.getRangeAt(0);\n        var rect = range.getBoundingClientRect();\n        x = rect.left;\n        y = rect.top;\n      }\n    }\n    return {\n      x: x,\n      y: y\n    };\n  }\n  /**\n   * showOperators\n   * @description 显示运算符选择下拉\n   */\n  function showOperators() {\n    var point = getCursorPosition();\n    if (operatorsRef.current) {\n      operatorsRef.current.style.left = \"\".concat(point.x + 10, \"px\");\n      operatorsRef.current.style.top = \"\".concat(point.y + 25, \"px\");\n    }\n    setOperatorsShow(true, function () {});\n  }\n  /**\n   * hideOperators\n   * @description 关闭运算符选择下拉\n   */\n  function hideOperators() {\n    setOperatorsShow(false);\n  }\n  /**\n   * showQuickTip\n   */\n  function showQuickTip() {\n    setQuickTipShow(true);\n  }\n  /**\n   * hideOperators\n   * @description 关闭运算符选择下拉\n   */\n  function hideQuickTip() {\n    setQuickTipShow(false);\n  }\n  /**\n   * showPlaceholder\n   * @description 显示placeholder\n   */\n  function showPlaceholder() {\n    setPlaceholderShow(true);\n  }\n  /**\n   * hidePlaceholder\n   * @description 隐藏placeholder\n   */\n  function hidePlaceholder() {\n    setPlaceholderShow(false);\n  }\n  /**\n   * createTextElement\n   * @description 创建文本元素\n   * @param {string} html 文本的内容\n   * @return {HTMLSpanElement}\n   */\n  function createTextElement(html) {\n    var textElement = document.createElement('span');\n    textElement.className = (0, classnames_1.default)('text', textClassName !== null && textClassName !== void 0 ? textClassName : '');\n    textElement.innerHTML = html;\n    return textElement;\n  }\n  /**\n   * createOperatorElement\n   * @description 创建运算符元素\n   * @param {string} text 元素的文本\n   * @return {HTMLSpanElement}\n   */\n  function createOperatorElement(text) {\n    var operatorElement = document.createElement('span');\n    operatorElement.className = (0, classnames_1.default)('operator', operatorClassName !== null && operatorClassName !== void 0 ? operatorClassName : '');\n    operatorElement.setAttribute('contenteditable', 'false');\n    operatorElement.innerText = text;\n    return operatorElement;\n  }\n  /**\n   * isFont\n   * @description 是否是font元素\n   * @return {boolean}\n   */\n  function isFont() {\n    var _a, _b, _c, _d;\n    return ((_d = (_c = (_b = (_a = editorRef === null || editorRef === void 0 ? void 0 : editorRef.current) === null || _a === void 0 ? void 0 : _a.firstElementChild) === null || _b === void 0 ? void 0 : _b.tagName) === null || _c === void 0 ? void 0 : _c.toLowerCase) === null || _d === void 0 ? void 0 : _d.call(_c)) === 'font';\n  }\n  /**\n   * setContinuousText\n   * @description 设置连续输入的字符\n   * @param {string} text 当前输入的文本\n   */\n  function setContinuousText(text) {\n    if (!preCursorContextElement.current || preCursorContextElement.current === cursorContextElement.current && preCursorIndex.current + 1 === cursorIndex.current) {\n      preCursorIndex.current = cursorIndex.current;\n      preCursorContextElement.current = cursorContextElement.current;\n      continuousText.current += text;\n    } else {\n      preCursorIndex.current = cursorIndex.current;\n      preCursorContextElement.current = cursorContextElement.current;\n      continuousText.current = text;\n    }\n  }\n  /**\n   * onEditorCompositionStart\n   * @description 编辑框输入中文开始\n   */\n  function onEditorCompositionStart() {\n    comStart.current = true;\n    // console.log('中文输入：开始');\n  }\n  /**\n   * onEditorCompositionEnd\n   * @description 编辑框输入中文结束\n   * @param e\n   */\n  function onEditorCompositionEnd(e) {\n    comStart.current = false;\n    // console.log('中文输入：结束');\n    onEditorInput(e);\n  }\n  /**\n   * onEditorInput\n   * @description 编辑框input\n   */\n  function onEditorInput(e) {\n    var _a;\n    if (comStart.current) return; // 中文输入过程中不截断\n    if (cursorContextElement) {\n      cursorContextElement.current = getCurrentElementWithCursor();\n    }\n    if (cursorContextParentElement) {\n      cursorContextParentElement.current = getCurrentParentElementWithCursor();\n    }\n    cursorIndex.current = getCursorIndex();\n    if (isEditorEmpty()) {\n      showPlaceholder();\n    } else {\n      hidePlaceholder();\n    }\n    var text = e.nativeEvent.data;\n    if (text !== null) {\n      setContinuousText(text);\n      if (!disableQuickTip) {\n        onContinuousTextChange === null || onContinuousTextChange === void 0 ? void 0 : onContinuousTextChange(continuousText.current);\n      }\n    }\n    if (!disableQuickTip) {\n      if (text !== triggerChar) {\n        showQuickTip();\n      }\n    }\n    // input输入结束\n    if (text !== triggerChar) {\n      onEditorInputEnd === null || onEditorInputEnd === void 0 ? void 0 : onEditorInputEnd(text, continuousText.current);\n    }\n    // onChange\n    onChange === null || onChange === void 0 ? void 0 : onChange((_a = editorRef === null || editorRef === void 0 ? void 0 : editorRef.current) === null || _a === void 0 ? void 0 : _a.innerHTML);\n  }\n  /**\n   * onEditorPaste\n   * @description 编辑框粘贴\n   * @param e\n   */\n  function onEditorPaste(e) {\n    // 禁止粘贴内容\n    e.preventDefault();\n    onEditorPasteEnd === null || onEditorPasteEnd === void 0 ? void 0 : onEditorPasteEnd(e);\n  }\n  /**\n   * onEditorKeyDown\n   * @description 编辑框keyDown\n   * @param e\n   * @return {boolean}\n   */\n  function onEditorKeyDown(e) {\n    // 默认空格\n    if (e.keyCode === (triggerCharCode !== null && triggerCharCode !== void 0 ? triggerCharCode : defaultTriggerCharCode)) {\n      hideQuickTip();\n      showOperators();\n      onEditorKeyDownEnd === null || onEditorKeyDownEnd === void 0 ? void 0 : onEditorKeyDownEnd(e);\n      return false;\n    }\n    // 屏蔽回车操作\n    if (e.keyCode === 13) {\n      hideOperators();\n      e.stopPropagation();\n      e.preventDefault();\n      onEditorKeyDownEnd === null || onEditorKeyDownEnd === void 0 ? void 0 : onEditorKeyDownEnd(e);\n      return false;\n    }\n    hideOperators();\n    onEditorKeyDownEnd === null || onEditorKeyDownEnd === void 0 ? void 0 : onEditorKeyDownEnd(e);\n  }\n  /**\n   * onEditorBlur\n   * @description 编辑框失去焦点\n   */\n  function onEditorBlur(e) {\n    e.stopPropagation();\n    e.preventDefault();\n    if (isEditorEmpty()) {\n      showPlaceholder();\n    } else {\n      hidePlaceholder();\n    }\n    onEditorBlurEnd === null || onEditorBlurEnd === void 0 ? void 0 : onEditorBlurEnd(e);\n  }\n  /**\n   * onOperatorsClick\n   * @description 选择运算符\n   * @param {string} operator\n   * @param {OperatorType} operatorType\n   */\n  function onOperatorsClick(operator, operatorType) {\n    var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u, _v, _w, _x, _y;\n    if (operator) {\n      var editor = getEditorEl();\n      // 括号\n      if (operatorType === 'brackets') {\n        var left = operator[0];\n        var right = operator[1];\n        var leftElement = createOperatorElement(left);\n        var rightElement = createOperatorElement(right);\n        var textElement = createTextElement(\"\".concat(htmlSpace).concat(htmlSpace));\n        // 如果是在editor的文本中进行的编辑\n        if (cursorContextParentElement.current === editor) {\n          var text = (_a = cursorContextElement === null || cursorContextElement === void 0 ? void 0 : cursorContextElement.current) === null || _a === void 0 ? void 0 : _a.textContent;\n          var startElement = createTextElement((_b = text === null || text === void 0 ? void 0 : text.substring) === null || _b === void 0 ? void 0 : _b.call(text, 0, cursorIndex.current + 1));\n          var endElement = createTextElement((_c = text === null || text === void 0 ? void 0 : text.substring) === null || _c === void 0 ? void 0 : _c.call(text, cursorIndex.current + 1));\n          var df = document.createDocumentFragment();\n          df.appendChild(startElement);\n          df.appendChild(leftElement);\n          df.appendChild(textElement);\n          df.appendChild(rightElement);\n          if (endElement && endElement.textContent) {\n            endElement.textContent.length !== 0 && df.appendChild(endElement);\n          }\n          (_d = editor === null || editor === void 0 ? void 0 : editor.replaceChild) === null || _d === void 0 ? void 0 : _d.call(editor, df, cursorContextElement.current);\n          setCursorPosition(textElement, 1);\n        }\n        // 如果是在text文本中进行的编辑\n        else {\n          var text = (_e = cursorContextElement === null || cursorContextElement === void 0 ? void 0 : cursorContextElement.current) === null || _e === void 0 ? void 0 : _e.textContent;\n          var startElement = createTextElement((_f = text === null || text === void 0 ? void 0 : text.substring) === null || _f === void 0 ? void 0 : _f.call(text, 0, cursorIndex.current));\n          var endElement = createTextElement((_g = text === null || text === void 0 ? void 0 : text.substring) === null || _g === void 0 ? void 0 : _g.call(text, cursorIndex.current));\n          var df = document.createDocumentFragment();\n          df.appendChild(startElement);\n          df.appendChild(startElement);\n          df.appendChild(leftElement);\n          df.appendChild(textElement);\n          df.appendChild(rightElement);\n          if (endElement && endElement.textContent) {\n            endElement.textContent.length !== 0 && df.appendChild(endElement);\n          }\n          (_k = (_j = (_h = cursorContextParentElement === null || cursorContextParentElement === void 0 ? void 0 : cursorContextParentElement.current) === null || _h === void 0 ? void 0 : _h.parentElement) === null || _j === void 0 ? void 0 : _j.replaceChild) === null || _k === void 0 ? void 0 : _k.call(_j, df, cursorContextParentElement.current);\n          setCursorPosition(textElement, 1);\n        }\n      }\n      // 其他符号\n      else {\n        var operatorElement = createOperatorElement(operator);\n        var textElement = createTextElement(htmlSpace);\n        // 如果是在editor的文本中进行的编辑\n        if (cursorContextParentElement.current === editor) {\n          // 光标所在的元素现在是text元素\n          // let parentElement = getInsertParentElement();\n          // parentElement.appendChild(operatorElement);\n          // parentElement.appendChild(textElement);\n          // setCursorToEnd(parentElement);\n          var text = (_l = cursorContextElement === null || cursorContextElement === void 0 ? void 0 : cursorContextElement.current) === null || _l === void 0 ? void 0 : _l.textContent;\n          var startElement = createTextElement((_m = text === null || text === void 0 ? void 0 : text.substring) === null || _m === void 0 ? void 0 : _m.call(text, 0, cursorIndex.current + 1));\n          var endElement = createTextElement((_o = text === null || text === void 0 ? void 0 : text.substring) === null || _o === void 0 ? void 0 : _o.call(text, cursorIndex.current + 1));\n          var df = document.createDocumentFragment();\n          df.appendChild(startElement);\n          df.appendChild(operatorElement);\n          df.appendChild(textElement);\n          if (endElement && endElement.textContent) {\n            endElement.textContent.length !== 0 && df.appendChild(endElement);\n          }\n          editor === null || editor === void 0 ? void 0 : editor.replaceChild(df, cursorContextElement.current);\n          setCursorPosition(textElement, 0);\n        }\n        // 如果是在text文本中进行的编辑\n        // @ts-ignore\n        else if ((_r = (_q = (_p = cursorContextParentElement === null || cursorContextParentElement === void 0 ? void 0 : cursorContextParentElement.current) === null || _p === void 0 ? void 0 : _p.classList) === null || _q === void 0 ? void 0 : _q.contains) === null || _r === void 0 ? void 0 : _r.call(_q, 'text')) {\n          var text = (_s = cursorContextElement === null || cursorContextElement === void 0 ? void 0 : cursorContextElement.current) === null || _s === void 0 ? void 0 : _s.textContent;\n          var startElement = createTextElement((_t = text === null || text === void 0 ? void 0 : text.substring) === null || _t === void 0 ? void 0 : _t.call(text, 0, cursorIndex.current));\n          var endElement = createTextElement((_u = text === null || text === void 0 ? void 0 : text.substring) === null || _u === void 0 ? void 0 : _u.call(text, cursorIndex.current));\n          var df = document.createDocumentFragment();\n          df.appendChild(startElement);\n          df.appendChild(operatorElement);\n          df.appendChild(textElement);\n          if (endElement && endElement.textContent) {\n            endElement.textContent.length !== 0 && df.appendChild(endElement);\n          }\n          (_x = (_w = (_v = cursorContextParentElement === null || cursorContextParentElement === void 0 ? void 0 : cursorContextParentElement.current) === null || _v === void 0 ? void 0 : _v.parentElement) === null || _w === void 0 ? void 0 : _w.replaceChild) === null || _x === void 0 ? void 0 : _x.call(_w, df, cursorContextParentElement.current);\n          setCursorPosition(textElement, 0);\n        }\n      }\n      onChange === null || onChange === void 0 ? void 0 : onChange((_y = editorRef === null || editorRef === void 0 ? void 0 : editorRef.current) === null || _y === void 0 ? void 0 : _y.innerHTML);\n    }\n    hideOperators();\n  }\n  /**\n   * onQuickTipClick\n   * @description 选额智能提示\n   * @param e\n   * @param item\n   */\n  function onQuickTipClick(e, item) {\n    var _a, _b, _c, _d;\n    var tip = item[quickTipProp !== null && quickTipProp !== void 0 ? quickTipProp : 'value'];\n    var editor = getEditorEl();\n    // java\n    if (tip) {\n      // 111\n      var text = ((_a = cursorContextElement.current) === null || _a === void 0 ? void 0 : _a.textContent) || '';\n      var startIndex = text.lastIndexOf(continuousText.current, preCursorIndex.current);\n      // 111(java) -> 111java\n      // (java)111 -> java111\n      // 1(java)11 -> 1java11\n      var endIndex = startIndex + continuousText.current.length;\n      var df_1 = document.createDocumentFragment();\n      var startTextNode = document.createTextNode(text.substring(0, startIndex));\n      var endTextNode = document.createTextNode(text.substring(endIndex));\n      var collapseEl = document.createElement('div');\n      collapseEl.innerHTML = tip;\n      df_1.appendChild(startTextNode);\n      Array.from(collapseEl.childNodes).forEach(function (el) {\n        df_1.appendChild(el);\n      });\n      df_1.appendChild(endTextNode);\n      if (contextRef.current === cursorContextParentElement.current) {\n        editor.innerHTML = '';\n        editor.appendChild(df_1);\n      } else if (editor === cursorContextParentElement.current) {\n        if ((_b = cursorContextElement === null || cursorContextElement === void 0 ? void 0 : cursorContextElement.current) === null || _b === void 0 ? void 0 : _b.parentElement) {\n          cursorContextElement.current.parentElement.replaceChild(df_1, cursorContextElement.current);\n        }\n      } else {\n        if ((_c = cursorContextParentElement === null || cursorContextParentElement === void 0 ? void 0 : cursorContextParentElement.current) === null || _c === void 0 ? void 0 : _c.parentElement) {\n          cursorContextParentElement.current.parentElement.replaceChild(df_1, cursorContextParentElement.current);\n        }\n      }\n      setCursorPositionToNode(endTextNode, 0);\n      onChange === null || onChange === void 0 ? void 0 : onChange((_d = editorRef === null || editorRef === void 0 ? void 0 : editorRef.current) === null || _d === void 0 ? void 0 : _d.innerHTML);\n    }\n    hideQuickTip();\n    hidePlaceholder();\n  }\n  // 获取插入的父元素\n  // function getInsertParentElement() {\n  //   return cursorContextParentElement.current === editor.current\n  //     ? cursorContextParentElement.current\n  //     : cursorContextParentElement.current.parentElement;\n  // }\n  return react_1.default.createElement(\"div\", {\n    ref: contextRef,\n    className: (0, classnames_1.default)(exports.selectorPrefix, className !== null && className !== void 0 ? className : ''),\n    style: style !== null && style !== void 0 ? style : {}\n  }, react_1.default.createElement(\"div\", {\n    ref: editorRef,\n    className: (0, classnames_1.default)(\"\".concat(exports.selectorPrefix, \"-editor\"), editorClassName !== null && editorClassName !== void 0 ? editorClassName : ''),\n    style: editorStyle !== null && editorStyle !== void 0 ? editorStyle : {},\n    contentEditable: \"true\",\n    onInput: onEditorInput,\n    onKeyDown: onEditorKeyDown,\n    onBlur: onEditorBlur,\n    onCompositionStart: onEditorCompositionStart,\n    onCompositionEnd: onEditorCompositionEnd,\n    onPaste: onEditorPaste\n  }), react_1.default.createElement(\"div\", {\n    className: (0, classnames_1.default)(\"\".concat(exports.selectorPrefix, \"-editor-placeholder\"), (_b = {}, _b[\"\".concat(exports.selectorPrefix, \"-editor-placeholder--show\")] = placeholderShow, _b)),\n    ref: placeholderRef\n  }, placeholder !== null && placeholder !== void 0 ? placeholder : adhere_util_intl_1.default.v('请输入关键词')), react_1.default.createElement(\"ul\", {\n    ref: operatorsRef,\n    className: (0, classnames_1.default)(\"\".concat(exports.selectorPrefix, \"-operators\"), operatorWrapClassName !== null && operatorWrapClassName !== void 0 ? operatorWrapClassName : '', (_c = {}, _c[\"\".concat(exports.selectorPrefix, \"-operators--show\")] = operatorsShow, _c)),\n    style: operatorWrapStyle !== null && operatorWrapStyle !== void 0 ? operatorWrapStyle : {}\n  }, react_1.default.createElement(\"li\", null, react_1.default.createElement(\"i\", {\n    onClick: function onClick() {\n      return hideOperators();\n    }\n  }, react_1.default.createElement(icons_1.CloseCircleOutlined, {\n    rev: null\n  }))), operatorsConfig.map(function (_a) {\n    var label = _a.label,\n      value = _a.value,\n      type = _a.type;\n    return react_1.default.createElement(\"li\", {\n      key: value,\n      onClick: function onClick() {\n        onOperatorsClick(value, type);\n      }\n    }, label);\n  })), react_1.default.createElement(\"ul\", {\n    ref: quickTipRef,\n    className: (0, classnames_1.default)(\"\".concat(exports.selectorPrefix, \"-quick-tips\"), quickTipWrapClassName !== null && quickTipWrapClassName !== void 0 ? quickTipWrapClassName : '', (_d = {}, _d[\"\".concat(exports.selectorPrefix, \"-quick-tips--show\")] = quickTipShow, _d)),\n    style: quickTipWrapStyle !== null && quickTipWrapStyle !== void 0 ? quickTipWrapStyle : {}\n  }, react_1.default.createElement(\"li\", null, react_1.default.createElement(\"i\", {\n    onClick: function onClick() {\n      return hideQuickTip();\n    }\n  }, react_1.default.createElement(icons_1.CloseCircleOutlined, {\n    rev: null\n  }))), !(quickTipDataSource || []).length && react_1.default.createElement(\"li\", null, react_1.default.createElement(antd_1.Empty, null)), !!(quickTipDataSource || []).length && (quickTipDataSource || []).map(function (t, _index) {\n    return react_1.default.createElement(\"li\", {\n      key: t.value,\n      onClick: function onClick(e) {\n        return onQuickTipClick(e, t);\n      }\n    }, t.label);\n  })));\n};\nvar Wrap = (0, react_1.memo)((0, react_1.forwardRef)(Expression));\n// @ts-ignore\nWrap.View = View_1.default;\n/**\n * parse\n * @description 解析\n * @param {string} queryHtml\n * @param {(value: { nodeType: number; value: string | null }) => string} callback\n * @return {string}\n */\n// @ts-ignore\nWrap.parse = function (queryHtml, callback) {\n  var _a, _b;\n  if (!queryHtml) return '';\n  var context = document.createElement('div');\n  context.innerHTML = queryHtml;\n  if (((_b = (_a = context === null || context === void 0 ? void 0 : context.firstElementChild) === null || _a === void 0 ? void 0 : _a.tagName) === null || _b === void 0 ? void 0 : _b.toLowerCase()) === 'font') {\n    context.innerHTML = context.firstElementChild.innerHTML;\n  }\n  var result = '';\n  result = Array.from(context.childNodes).map(function (node) {\n    var _a, _b, _c;\n    // 元素节点\n    if (node.nodeType === 1) {\n      // 文本节点\n      if (node.classList.contains('text')) {\n        return (_a = callback === null || callback === void 0 ? void 0 : callback({\n          nodeType: 3,\n          value: node.textContent\n        })) !== null && _a !== void 0 ? _a : '';\n      }\n      // 运算符\n      else if (node.classList.contains('operator')) {\n        return (_b = callback === null || callback === void 0 ? void 0 : callback({\n          nodeType: 1,\n          value: node.textContent\n        })) !== null && _b !== void 0 ? _b : '';\n      }\n    }\n    // 文本节点\n    else if (node.nodeType === 3) {\n      return (_c = callback === null || callback === void 0 ? void 0 : callback({\n        nodeType: 3,\n        value: node.textContent\n      })) !== null && _c !== void 0 ? _c : '';\n    }\n    return '';\n  }).join('');\n  return result;\n};\n/**\n * validator\n * @return {{validator(*, *): (Promise<void>)}}\n */\n// @ts-ignore\nWrap.validator = function () {\n  return {\n    validator: function validator(_, value) {\n      var context = document.createElement('div');\n      context.innerHTML = value;\n      if (context.innerText) {\n        return Promise.resolve();\n      }\n      return Promise.reject(new Error(adhere_util_intl_1.default.v('请输入关键字')));\n    }\n  };\n};\nexports.default = Wrap;"],"names":["__createBinding","Object","create","o","m","k","k2","undefined","desc","getOwnPropertyDescriptor","__esModule","writable","configurable","enumerable","get","defineProperty","__setModuleDefault","v","value","__importStar","mod","result","prototype","hasOwnProperty","call","__importDefault","default","ahooks_1","exports","selectorPrefix","require","antd_1","classnames_1","react_1","icons_1","adhere_ui_hooks_1","adhere_util_1","adhere_util_intl_1","View_1","getCurrentParentElementWithCursor","getCurrentElementWithCursor","setCursorToEnd","setCursorPositionToNode","setCursorPosition","getCursorIndex","defaultTriggerCharCode","htmlSpace","useSetState","Expression","_a","ref","className","style","editorClassName","editorStyle","operatorWrapClassName","operatorWrapStyle","quickTipWrapClassName","quickTipWrapStyle","textClassName","operatorClassName","placeholder","triggerCharCode","quickTipProp","quickTipDataSource","disableQuickTip","operators","onChange","onContinuousTextChange","onEditorInputEnd","onEditorBlurEnd","onEditorKeyDownEnd","onEditorPasteEnd","operatorsConfig","useMemo","label","type","contextRef","useRef","editorRef","operatorsRef","quickTipRef","placeholderRef","cursorContextParentElement","cursorContextElement","cursorIndex","preCursorIndex","preCursorContextElement","continuousText","comStart","_e","operatorsShow","setOperatorsShow","_f","quickTipShow","setQuickTipShow","_g","placeholderShow","setPlaceholderShow","triggerChar","String","fromCharCode","onReady","isEditorEmpty","showPlaceholder","hidePlaceholder","getEditorEl","_c","_d","_b","current","firstElementChild","tagName","toLowerCase","innerHTML","trim","showOperators","y","x","window","getSelection","selection","rangeCount","rect","getRangeAt","getBoundingClientRect","left","top","point","concat","hideOperators","showQuickTip","hideQuickTip","createTextElement","html","textElement","document","createElement","createOperatorElement","text","operatorElement","setAttribute","innerText","onEditorInput","e","nativeEvent","data","useUpdateLayoutEffect","useMount","editor","useImperativeHandle","setValue","_value","getValue","contentEditable","onInput","onKeyDown","keyCode","stopPropagation","preventDefault","onBlur","onCompositionStart","onCompositionEnd","onPaste","onClick","CloseCircleOutlined","rev","map","key","operator","operatorType","rightElement","startElement","endElement","df","right","leftElement","textContent","substring","createDocumentFragment","appendChild","length","replaceChild","_k","_j","_h","parentElement","_m","_l","_o","_r","_q","_p","classList","contains","_t","_s","_u","_x","_w","_v","_y","Empty","t","_index","tip","item","endIndex","startIndex","lastIndexOf","df_1","startTextNode","createTextNode","endTextNode","collapseEl","Array","from","childNodes","forEach","el","Wrap","memo","forwardRef","View","parse","queryHtml","callback","context","node","nodeType","join","validator","_","Promise","resolve","reject","Error"],"mappings":"AAAA,aAEA,IAAIA,gBAAyDC,OAAOC,OAAS,SAAUC,EAAGC,EAAGC,EAAGC,GACnFC,KAAAA,IAAPD,IAAkBA,EAAKD,GAC3B,IAAIG,EAAOP,OAAOQ,yBAAyBL,EAAGC,CAAC,EAC1CG,IAAS,QAASA,EAAQJ,EAAEM,WAAaF,CAAAA,EAAKG,UAAYH,CAAAA,EAAKI,gBAClEJ,EAAO,CACLK,WAAY,CAAA,EACZC,IAAK,WACH,OAAOV,EAAEC,EACX,CACF,GAEFJ,OAAOc,eAAeZ,EAAGG,EAAIE,CAAI,CACnC,EAAI,SAAUL,EAAGC,EAAGC,EAAGC,GAErBH,EADsBG,EAAXC,KAAAA,IAAPD,EAAuBD,EACzBC,GAAMF,EAAEC,EACZ,EACIW,mBAA+Df,OAAOC,OAAS,SAAUC,EAAGc,GAC9FhB,OAAOc,eAAeZ,EAAG,UAAW,CAClCU,WAAY,CAAA,EACZK,MAAOD,CACT,CAAC,CACH,EAAI,SAAUd,EAAGc,GACfd,EAAW,QAAIc,CACjB,EACIE,aAAkD,SAAUC,GAC9D,GAAIA,GAAOA,EAAIV,WAAY,OAAOU,EAClC,IAAIC,EAAS,GACb,GAAW,MAAPD,EAAa,IAAK,IAAIf,KAAKe,EAAe,YAANf,GAAmBJ,OAAOqB,UAAUC,eAAeC,KAAKJ,EAAKf,CAAC,GAAGL,gBAAgBqB,EAAQD,EAAKf,CAAC,EAEvI,OADAW,mBAAmBK,EAAQD,CAAG,EACvBC,CACT,EACII,gBAAwD,SAAUL,GACpE,OAAOA,GAAOA,EAAIV,WAAaU,EAAM,CACnCM,QAAWN,CACb,CACF,EAKIO,UAJJ1B,OAAOc,eAAea,QAAS,aAAc,CAC3CV,MAAO,CAAA,CACT,CAAC,EACDU,QAAQC,eAAiB,KAAA,EACVC,QAAQ,QAAQ,GAC3BC,OAASD,QAAQ,MAAM,EACvBE,aAAeP,gBAAgBK,QAAQ,YAAY,CAAC,EACpDG,QAAUd,aAAaW,QAAQ,OAAO,CAAC,EACvCI,QAAUJ,QAAQ,mBAAmB,EACrCK,kBAAoBV,gBAAgBK,QAAQ,6BAA6B,CAAC,EAC1EM,cAAgBX,gBAAgBK,QAAQ,yBAAyB,CAAC,EAClEO,mBAAqBZ,gBAAgBK,QAAQ,8BAA8B,CAAC,EAC5EQ,OAASb,gBAAgBK,QAAQ,QAAQ,CAAC,EAC1CS,kCAAoCH,cAAcV,QAAQa,kCAC5DC,4BAA8BJ,cAAcV,QAAQc,4BACpDC,eAAiBL,cAAcV,QAAQe,eACvCC,wBAA0BN,cAAcV,QAAQgB,wBAChDC,kBAAoBP,cAAcV,QAAQiB,kBAC1CC,eAAiBR,cAAcV,QAAQkB,eAErCC,uBAAyB,GAEzBC,UAAY,SACZC,YAAcZ,kBAAkBT,QAAQqB,YA8BxCC,YA7BJpB,QAAQC,eAAiB,uBA6BR,SAAoBoB,EAAIC,GACvC,IACIC,EAAYF,EAAGE,UACjBC,EAAQH,EAAGG,MACXC,EAAkBJ,EAAGI,gBACrBC,EAAcL,EAAGK,YACjBC,EAAwBN,EAAGM,sBAC3BC,EAAoBP,EAAGO,kBACvBC,EAAwBR,EAAGQ,sBAC3BC,EAAoBT,EAAGS,kBACvBC,EAAgBV,EAAGU,cACnBC,EAAoBX,EAAGW,kBACvB1C,EAAQ+B,EAAG/B,MACX2C,EAAcZ,EAAGY,YACjBC,EAAkBb,EAAGa,gBACrBC,EAAed,EAAGc,aAClBC,EAAqBf,EAAGe,mBACxBC,EAAkBhB,EAAGgB,gBACrBC,EAAYjB,EAAGiB,UACfC,EAAWlB,EAAGkB,SACdC,EAAyBnB,EAAGmB,uBAC5BC,EAAmBpB,EAAGoB,iBACtBC,EAAkBrB,EAAGqB,gBACrBC,EAAqBtB,EAAGsB,mBACxBC,EAAmBvB,EAAGuB,iBACpBC,GAAkB,EAAIxC,QAAQyC,SAAS,WACzC,OAAOR,MAAAA,EAA6CA,EAAY,CAAC,CAC/DS,MAAO,KACPzD,MAAO,KACP0D,KAAM,UACR,EAAG,CACDD,MAAO,MACPzD,MAAO,MACP0D,KAAM,QACR,EAAG,CACDD,MAAO,KACPzD,MAAO,KACP0D,KAAM,QACR,EAAG,CACDD,MAAO,MACPzD,MAAO,MACP0D,KAAM,OACR,EACF,EAAG,CAACV,EAAU,EAEVW,GAAa,EAAI5C,QAAQ6C,QAAQ,IAAI,EAErCC,GAAY,EAAI9C,QAAQ6C,QAAQ,IAAI,EAEpCE,GAAe,EAAI/C,QAAQ6C,QAAQ,IAAI,EAEvCG,GAAc,EAAIhD,QAAQ6C,QAAQ,IAAI,EAEtCI,GAAiB,EAAIjD,QAAQ6C,QAAQ,IAAI,EAEzCK,GAA6B,EAAIlD,QAAQ6C,QAAQ,IAAI,EAErDM,GAAuB,EAAInD,QAAQ6C,QAAQ,IAAI,EAE/CO,GAAc,EAAIpD,QAAQ6C,QAAQ,CAAC,CAAC,EAEpCQ,GAAiB,EAAIrD,QAAQ6C,QAAQ,CAAC,EAEtCS,GAA0B,EAAItD,QAAQ6C,QAAQ,IAAI,EAElDU,GAAiB,EAAIvD,QAAQ6C,QAAQ,EAAE,EAEvCW,GAAW,EAAIxD,QAAQ6C,QAAQ,CAAA,CAAK,EACpCY,EAAK3C,YAAY,CAAA,CAAK,EACxB4C,EAAgBD,EAAG,GACnBE,EAAmBF,EAAG,GACpBG,EAAK9C,YAAY,CAAA,CAAK,EACxB+C,EAAeD,EAAG,GAClBE,EAAkBF,EAAG,GACnBG,EAAKjD,YAAY,CAAA,CAAI,EACvBkD,EAAkBD,EAAG,GACrBE,EAAqBF,EAAG,GACtBG,GAAc,EAAIlE,QAAQyC,SAAS,WACrC,OAAO0B,OAAOC,aAAavC,MAAAA,EAAyDA,EAAkBjB,sBAAsB,CAC9H,EAAG,CAACiB,EAAgB,EAqCpB,SAASwC,KAQHC,EAAc,EAChBC,EAEAC,GAFgB,CAPpB,CAgBA,SAASC,IACP,IA8GYC,EAAIC,EA7GhB,MA8GgU,UAAxT,OAACA,EAAK,OAACD,EAAK,OAACE,EAAK,OAAC5D,EAAK8B,MAAAA,EAA6C,KAAA,EAASA,EAAU+B,SAAqC,KAAA,EAAS7D,EAAG8D,mBAA+C,KAAA,EAASF,EAAGG,SAAqC,KAAA,EAASL,EAAGM,aAAyC,KAAA,EAASL,EAAGpF,KAAKmF,CAAE,GA7GhT,OAAC1D,EAAK8B,MAAAA,EAA6C,KAAA,EAASA,EAAU+B,SAAqC,KAAA,EAAS7D,EAAG8D,kBAEvHhC,MAAAA,EAA6C,KAAA,EAASA,EAAU+B,OAE3E,CAMA,SAASP,IACP,IAAQM,EAAIF,EACZ,MAAgM,MAAxL,OAACA,EAAK,OAACE,EAAK,OAAC5D,EAAKyD,EAAY,GAA+B,KAAA,EAASzD,EAAGiE,WAAuC,KAAA,EAASL,EAAGM,MAAkC,KAAA,EAASR,EAAGnF,KAAKqF,CAAE,EAC3L,CAsBA,SAASO,KAnBHC,EADAC,EAAI,EAEJC,OAAOC,eACLC,EAAYF,OAAOC,aAAa,IACI,EAAvBC,EAAUC,aAGzBJ,GADIK,EADQF,EAAUG,WAAW,CAAC,EACjBC,sBAAsB,GAC9BC,KACTT,EAAIM,EAAKI,KAab,IArBIT,EACAD,EAoBAW,EAVG,CACLV,EAAGA,EACHD,EAAGA,CACL,EAQIrC,EAAa8B,UACf9B,EAAa8B,QAAQ1D,MAAM0E,KAAO,GAAGG,OAAOD,EAAMV,EAAI,GAAI,IAAI,EAC9DtC,EAAa8B,QAAQ1D,MAAM2E,IAAM,GAAGE,OAAOD,EAAMX,EAAI,GAAI,IAAI,GAE/DzB,EAAiB,CAAA,EAAM,YAAc,CACvC,CAKA,SAASsC,IACPtC,EAAiB,CAAA,CAAK,CACxB,CAIA,SAASuC,KACPpC,EAAgB,CAAA,CAAI,CACtB,CAKA,SAASqC,IACPrC,EAAgB,CAAA,CAAK,CACvB,CAKA,SAASS,IACPN,EAAmB,CAAA,CAAI,CACzB,CAKA,SAASO,IACPP,EAAmB,CAAA,CAAK,CAC1B,CAOA,SAASmC,EAAkBC,GACzB,IAAIC,EAAcC,SAASC,cAAc,MAAM,EAG/C,OAFAF,EAAYpF,WAAY,EAAInB,aAAaN,SAAS,OAAQiC,MAAAA,EAAqDA,EAAgB,EAAE,EACjI4E,EAAYrB,UAAYoB,EACjBC,CACT,CAOA,SAASG,EAAsBC,GAC7B,IAAIC,EAAkBJ,SAASC,cAAc,MAAM,EAInD,OAHAG,EAAgBzF,WAAY,EAAInB,aAAaN,SAAS,WAAYkC,MAAAA,EAA6DA,EAAoB,EAAE,EACrJgF,EAAgBC,aAAa,kBAAmB,OAAO,EACvDD,EAAgBE,UAAYH,EACrBC,CACT,CAgDA,SAASG,GAAcC,GACrB,IAlCyBL,EAmCrBlD,EAASqB,UACT1B,IACFA,EAAqB0B,QAAUtE,4BAA4B,GAEzD2C,IACFA,EAA2B2B,QAAUvE,kCAAkC,GAEzE8C,EAAYyB,QAAUlE,eAAe,GACjC2D,EAAc,EAChBC,EAEAC,GAFgB,EAKL,QADTkC,EAAOK,EAAEC,YAAYC,QAhDAP,EAkDLA,EAjDhB,CAACpD,EAAwBuB,SAAWvB,EAAwBuB,UAAY1B,EAAqB0B,SAAWxB,EAAewB,QAAU,IAAMzB,EAAYyB,SACrJxB,EAAewB,QAAUzB,EAAYyB,QACrCvB,EAAwBuB,QAAU1B,EAAqB0B,QACvDtB,EAAesB,SAAW6B,IAE1BrD,EAAewB,QAAUzB,EAAYyB,QACrCvB,EAAwBuB,QAAU1B,EAAqB0B,QACvDtB,EAAesB,QAAU6B,GA2CpB1E,GACHG,MAAAA,GAAgFA,EAAuBoB,EAAesB,OAAO,GAG5H7C,GACC0E,IAASxC,GACXgC,GAAa,EAIbQ,IAASxC,GACX9B,MAAAA,GAAoEA,EAAiBsE,EAAMnD,EAAesB,OAAO,EAGnH3C,MAAAA,GAAoDA,EAAS,OAAClB,EAAK8B,MAAAA,EAA6C,KAAA,EAASA,EAAU+B,SAAqC,KAAA,EAAS7D,EAAGiE,SAAS,EAC/L,CAuMA,OAtbA,EAAIvF,SAASwH,uBAAuB,WAClC7C,EAAQ,CACV,EAAG,CAACpF,EAAM,GACV,EAAIS,SAASyH,UAAU,WACrB,IAAIC,EAAS3C,EAAY,EACrB2C,IACFA,EAAOnC,UAAYhG,MAAAA,EAAqCA,EAAQ,IAElEuB,eAAe4G,CAAM,EACrB/C,EAAQ,CACV,CAAC,GACD,EAAIrE,QAAQqH,qBAAqBpG,EAAK,WACpC,MAAO,CACLqG,SAAU,SAAkBC,GAC1B,IAAIH,EAAS3C,EAAY,EACrB2C,IACFA,EAAOnC,UAAYsC,MAAAA,EAAuCA,EAAS,IAErE/G,eAAe4G,CAAM,EACrB/C,EAAQ,CACV,EACAmD,SAAU,WACR,IAAIxG,EACJ,OAAO,OAACA,EAAKyD,EAAY,GAA+B,KAAA,EAASzD,EAAGiE,SACtE,EACAX,cAAeA,EACf4B,aAAcA,GACdf,cAAeA,GACfgB,aAAcA,EACdF,cAAeA,CACjB,CACF,CAAC,EAuZMjG,QAAQP,QAAQ+G,cAAc,MAAO,CAC1CvF,IAAK2B,EACL1B,WAAW,EAAInB,aAAaN,SAASE,QAAQC,eAAgBsB,MAAAA,EAA6CA,EAAY,EAAE,EACxHC,MAAOA,MAAAA,EAAqCA,EAAQ,EACtD,EAAGnB,QAAQP,QAAQ+G,cAAc,MAAO,CACtCvF,IAAK6B,EACL5B,WAAW,EAAInB,aAAaN,SAAS,GAAGuG,OAAOrG,QAAQC,eAAgB,SAAS,EAAGwB,MAAAA,EAAyDA,EAAkB,EAAE,EAChKD,MAAOE,MAAAA,EAAiDA,EAAc,GACtEoG,gBAAiB,OACjBC,QAASZ,GACTa,UAhMF,SAAyBZ,GAEvB,OAAIA,EAAEa,WAAa/F,MAAAA,EAAyDA,EAAkBjB,yBAC5FuF,EAAa,EACbhB,GAAc,EACd7C,MAAAA,GAAwEA,EAAmByE,CAAC,EACrF,CAAA,GAGS,KAAdA,EAAEa,SACJ3B,EAAc,EACdc,EAAEc,gBAAgB,EAClBd,EAAEe,eAAe,EACjBxF,MAAAA,GAAwEA,EAAmByE,CAAC,EACrF,CAAA,IAETd,EAAc,EAAdA,KACA3D,MAAAA,GAAwEA,EAAmByE,CAAC,GAC9F,EA+KEgB,OA1KF,SAAsBhB,GACpBA,EAAEc,gBAAgB,EAClBd,EAAEe,eAAe,GACbxD,EAAc,EAChBC,EAEAC,GAFgB,EAIlBnC,MAAAA,GAAkEA,EAAgB0E,CAAC,CACrF,EAkKEiB,mBAtQF,WACExE,EAASqB,QAAU,CAAA,CAErB,EAoQEoD,iBA9PF,SAAgClB,GAC9BvD,EAASqB,QAAU,CAAA,EAEnBiC,GAAcC,CAAC,CACjB,EA2PEmB,QA/MF,SAAuBnB,GAErBA,EAAEe,eAAe,EACjBvF,MAAAA,GAAoEA,EAAiBwE,CAAC,CACxF,CA4MA,CAAC,EAAG/G,QAAQP,QAAQ+G,cAAc,MAAO,CACvCtF,WAAW,EAAInB,aAAaN,SAAS,GAAGuG,OAAOrG,QAAQC,eAAgB,qBAAqB,IAAIgF,EAAK,IAAO,GAAGoB,OAAOrG,QAAQC,eAAgB,2BAA2B,GAAKoE,EAAiBY,EAAG,EAClM3D,IAAKgC,CACP,EAAGrB,MAAAA,EAAiDA,EAAcxB,mBAAmBX,QAAQT,EAAE,QAAQ,CAAC,EAAGgB,QAAQP,QAAQ+G,cAAc,KAAM,CAC7IvF,IAAK8B,EACL7B,WAAW,EAAInB,aAAaN,SAAS,GAAGuG,OAAOrG,QAAQC,eAAgB,YAAY,EAAG0B,MAAAA,EAAqEA,EAAwB,KAAKoD,EAAK,IAAO,GAAGsB,OAAOrG,QAAQC,eAAgB,kBAAkB,GAAK8D,EAAegB,EAAG,EAC/QvD,MAAOI,MAAAA,EAA6DA,EAAoB,EAC1F,EAAGvB,QAAQP,QAAQ+G,cAAc,KAAM,KAAMxG,QAAQP,QAAQ+G,cAAc,IAAK,CAC9E2B,QACSlC,CAEX,EAAGjG,QAAQP,QAAQ+G,cAAcvG,QAAQmI,oBAAqB,CAC5DC,IAAK,IACP,CAAC,CAAC,CAAC,EAAG7F,EAAgB8F,IAAI,SAAUtH,GAClC,IAAI0B,EAAQ1B,EAAG0B,MACbzD,EAAQ+B,EAAG/B,MACX0D,EAAO3B,EAAG2B,KACZ,OAAO3C,QAAQP,QAAQ+G,cAAc,KAAM,CACzC+B,IAAKtJ,EACLkJ,QAAS,WAjLb,IAA0BK,EAAUC,EAG5BrB,EAMEsB,EAsCA/B,EACAL,EAwBEI,EACAiC,EACAC,EACAC,EA3EwBJ,EAkLN9F,GAlLJ6F,EAkLHvJ,KA/KfmI,EAAS3C,EAAY,EAEJ,aAAjBgE,GACE5C,EAAO2C,EAAS,GAChBM,EAAQN,EAAS,GACjBO,EAActC,EAAsBZ,CAAI,EACxC6C,EAAejC,EAAsBqC,CAAK,EAC1CxC,EAAcF,EAAkB,GAAGJ,OAAOnF,SAAS,EAAEmF,OAAOnF,SAAS,CAAC,EAEtEqC,EAA2B2B,UAAYuC,GAErCuB,EAAevC,EAAkB,OAACxB,EAAK8B,OAAAA,EADhC,OAAC1F,EAAKmC,MAAAA,EAAmE,KAAA,EAASA,EAAqB0B,SAAqC,KAAA,EAAS7D,EAAGgI,aACrF,KAAA,EAAStC,EAAKuC,WAAuC,KAAA,EAASrE,EAAGrF,KAAKmH,EAAM,EAAGtD,EAAYyB,QAAU,CAAC,CAAC,EACjL+D,EAAaxC,EAAkB,OAAC1B,EAAKgC,MAAAA,EAAmC,KAAA,EAASA,EAAKuC,WAAuC,KAAA,EAASvE,EAAGnF,KAAKmH,EAAMtD,EAAYyB,QAAU,CAAC,CAAC,GAEhLgE,EADStC,SAAS2C,uBAAuB,GACtCC,YAAYR,CAAY,EAC3BE,EAAGM,YAAYJ,CAAW,EAC1BF,EAAGM,YAAY7C,CAAW,EAC1BuC,EAAGM,YAAYT,CAAY,EACvBE,GAAcA,EAAWI,aACO,IAAlCJ,EAAWI,YAAYI,QAAgBP,EAAGM,YAAYP,CAAU,EAElE,OAACjE,EAAKyC,MAAAA,EAAuC,KAAA,EAASA,EAAOiC,eAAmD1E,EAAGpF,KAAK6H,EAAQyB,EAAI1F,EAAqB0B,OAAO,IAM5J8D,EAAevC,EAAkB,OAACxC,EAAK8C,OAAAA,EADhC,OAACjD,EAAKN,MAAAA,EAAmE,KAAA,EAASA,EAAqB0B,SAAqC,KAAA,EAASpB,EAAGuF,aACrF,KAAA,EAAStC,EAAKuC,WAAuC,KAAA,EAASrF,EAAGrE,KAAKmH,EAAM,EAAGtD,EAAYyB,OAAO,CAAC,EAC7K+D,EAAaxC,EAAkB,OAACrC,EAAK2C,MAAAA,EAAmC,KAAA,EAASA,EAAKuC,WAAuC,KAAA,EAASlF,EAAGxE,KAAKmH,EAAMtD,EAAYyB,OAAO,CAAC,GAE5KgE,EADStC,SAAS2C,uBAAuB,GACtCC,YAAYR,CAAY,EAC3BE,EAAGM,YAAYR,CAAY,EAC3BE,EAAGM,YAAYJ,CAAW,EAC1BF,EAAGM,YAAY7C,CAAW,EAC1BuC,EAAGM,YAAYT,CAAY,EACvBE,GAAcA,EAAWI,aACO,IAAlCJ,EAAWI,YAAYI,QAAgBP,EAAGM,YAAYP,CAAU,EAElE,OAACU,EAAK,OAACC,EAAK,OAACC,EAAKtG,MAAAA,EAA+E,KAAA,EAASA,EAA2B2B,SAAqC,KAAA,EAAS2E,EAAGC,eAA2C,KAAA,EAASF,EAAGF,eAAmDC,EAAG/J,KAAKgK,EAAIV,EAAI3F,EAA2B2B,OAAO,GAClVnE,kBAAkB4F,EAAa,CAAC,IAK9BK,EAAkBF,EAAsB+B,CAAQ,EAChDlC,EAAcF,EAAkBvF,SAAS,EAEzCqC,EAA2B2B,UAAYuC,GAOrCuB,EAAevC,EAAkB,OAACsD,EAAKhD,OAAAA,EADhC,OAACiD,EAAKxG,MAAAA,EAAmE,KAAA,EAASA,EAAqB0B,SAAqC,KAAA,EAAS8E,EAAGX,aACrF,KAAA,EAAStC,EAAKuC,WAAuC,KAAA,EAASS,EAAGnK,KAAKmH,EAAM,EAAGtD,EAAYyB,QAAU,CAAC,CAAC,EACjL+D,EAAaxC,EAAkB,OAACwD,EAAKlD,MAAAA,EAAmC,KAAA,EAASA,EAAKuC,WAAuC,KAAA,EAASW,EAAGrK,KAAKmH,EAAMtD,EAAYyB,QAAU,CAAC,CAAC,GAEhLgE,EADStC,SAAS2C,uBAAuB,GACtCC,YAAYR,CAAY,EAC3BE,EAAGM,YAAYxC,CAAe,EAC9BkC,EAAGM,YAAY7C,CAAW,EACtBsC,GAAcA,EAAWI,aACO,IAAlCJ,EAAWI,YAAYI,QAAgBP,EAAGM,YAAYP,CAAU,EAElExB,MAAAA,GAAgDA,EAAOiC,aAAaR,EAAI1F,EAAqB0B,OAAO,EACpGnE,kBAAkB4F,EAAa,CAAC,GAIzB,OAACuD,EAAK,OAACC,EAAK,OAACC,EAAK7G,MAAAA,EAA+E,KAAA,EAASA,EAA2B2B,SAAqC,KAAA,EAASkF,EAAGC,WAAuC,KAAA,EAASF,EAAGG,WAA+CJ,EAAGtK,KAAKuK,EAAI,MAAM,IAE7SnB,EAAevC,EAAkB,OAAC8D,EAAKxD,OAAAA,EADhC,OAACyD,EAAKhH,MAAAA,EAAmE,KAAA,EAASA,EAAqB0B,SAAqC,KAAA,EAASsF,EAAGnB,aACrF,KAAA,EAAStC,EAAKuC,WAAuC,KAAA,EAASiB,EAAG3K,KAAKmH,EAAM,EAAGtD,EAAYyB,OAAO,CAAC,EAC7K+D,EAAaxC,EAAkB,OAACgE,EAAK1D,MAAAA,EAAmC,KAAA,EAASA,EAAKuC,WAAuC,KAAA,EAASmB,EAAG7K,KAAKmH,EAAMtD,EAAYyB,OAAO,CAAC,GAE5KgE,EADStC,SAAS2C,uBAAuB,GACtCC,YAAYR,CAAY,EAC3BE,EAAGM,YAAYxC,CAAe,EAC9BkC,EAAGM,YAAY7C,CAAW,EACtBsC,GAAcA,EAAWI,aACO,IAAlCJ,EAAWI,YAAYI,QAAgBP,EAAGM,YAAYP,CAAU,EAElE,OAACyB,EAAK,OAACC,EAAK,OAACC,EAAKrH,MAAAA,EAA+E,KAAA,EAASA,EAA2B2B,SAAqC,KAAA,EAAS0F,EAAGd,eAA2C,KAAA,EAASa,EAAGjB,eAAmDgB,EAAG9K,KAAK+K,EAAIzB,EAAI3F,EAA2B2B,OAAO,EAClVnE,kBAAkB4F,EAAa,CAAC,IAGpCpE,MAAAA,IAAoDA,EAAS,OAACsI,EAAK1H,MAAAA,EAA6C,KAAA,EAASA,EAAU+B,SAAqC,KAAA,EAAS2F,EAAGvF,SAAS,EAE/LgB,EAAc,CA2FZ,CACF,EAAGvD,CAAK,CACV,CAAC,CAAC,EAAG1C,QAAQP,QAAQ+G,cAAc,KAAM,CACvCvF,IAAK+B,EACL9B,WAAW,EAAInB,aAAaN,SAAS,GAAGuG,OAAOrG,QAAQC,eAAgB,aAAa,EAAG4B,MAAAA,EAAqEA,EAAwB,KAAKmD,EAAK,IAAO,GAAGqB,OAAOrG,QAAQC,eAAgB,mBAAmB,GAAKiE,EAAcc,EAAG,EAChRxD,MAAOM,MAAAA,EAA6DA,EAAoB,EAC1F,EAAGzB,QAAQP,QAAQ+G,cAAc,KAAM,KAAMxG,QAAQP,QAAQ+G,cAAc,IAAK,CAC9E2B,QACShC,CAEX,EAAGnG,QAAQP,QAAQ+G,cAAcvG,QAAQmI,oBAAqB,CAC5DC,IAAK,IACP,CAAC,CAAC,CAAC,EAAG,EAAEtG,GAAsB,IAAIqH,QAAUpJ,QAAQP,QAAQ+G,cAAc,KAAM,KAAMxG,QAAQP,QAAQ+G,cAAc1G,OAAO2K,MAAO,IAAI,CAAC,EAAG,CAAC,EAAE1I,GAAsB,IAAIqH,SAAWrH,GAAsB,IAAIuG,IAAI,SAAUoC,EAAGC,GAC3N,OAAO3K,QAAQP,QAAQ+G,cAAc,KAAM,CACzC+B,IAAKmC,EAAEzL,MACPkJ,QAAS,SAAiBpB,GACxB,OAjGA6D,GAFsBC,EAmGIH,GAjGf5I,MAAAA,EAAmDA,EAAe,SAC7EsF,EAAS3C,EAAY,EAErBmG,IAOEE,GAJAC,GADArE,GAAQ,OAAC1F,EAAKmC,EAAqB0B,SAAqC,KAAA,EAAS7D,EAAGgI,cAAgB,IAClFgC,YAAYzH,EAAesB,QAASxB,EAAewB,OAAO,GAIpDtB,EAAesB,QAAQuE,OAC/C6B,EAAO1E,SAAS2C,uBAAuB,EACvCgC,EAAgB3E,SAAS4E,eAAezE,EAAKuC,UAAU,EAAG8B,CAAU,CAAC,EACrEK,EAAc7E,SAAS4E,eAAezE,EAAKuC,UAAU6B,CAAQ,CAAC,GAC9DO,EAAa9E,SAASC,cAAc,KAAK,GAClCvB,UAAY2F,EACvBK,EAAK9B,YAAY+B,CAAa,EAC9BI,MAAMC,KAAKF,EAAWG,UAAU,EAAEC,QAAQ,SAAUC,GAClDT,EAAK9B,YAAYuC,CAAE,CACrB,CAAC,EACDT,EAAK9B,YAAYiC,CAAW,EACxBxI,EAAWiC,UAAY3B,EAA2B2B,SACpDuC,EAAOnC,UAAY,GACnBmC,EAAO+B,YAAY8B,CAAI,GACd7D,IAAWlE,EAA2B2B,QAC3C,OAACD,EAAKzB,MAAAA,EAAmE,KAAA,EAASA,EAAqB0B,UAA8CD,EAAG6E,eAC1JtG,EAAqB0B,QAAQ4E,cAAcJ,aAAa4B,EAAM9H,EAAqB0B,OAAO,EAGxF,OAACH,EAAKxB,MAAAA,EAA+E,KAAA,EAASA,EAA2B2B,UAA8CH,EAAG+E,eAC5KvG,EAA2B2B,QAAQ4E,cAAcJ,aAAa4B,EAAM/H,EAA2B2B,OAAO,EAG1GpE,wBAAwB2K,EAAa,CAAC,EACtClJ,MAAAA,IAAoDA,EAAS,OAACyC,EAAK7B,MAAAA,EAA6C,KAAA,EAASA,EAAU+B,SAAqC,KAAA,EAASF,EAAGM,SAAS,EAE/LkB,EAAa,EAjCb,KAkCA3B,EAAgB,EAvClB,IAA4BqG,EAapBI,EACAC,EACAE,EACAC,EAbFjE,CAiGF,CACF,EAAGsD,EAAEhI,KAAK,CACZ,CAAC,CAAC,CAAC,CACL,GACIiJ,MAAO,EAAI3L,QAAQ4L,OAAM,EAAI5L,QAAQ6L,YAAY9K,UAAU,CAAC,EAEhE4K,KAAKG,KAAOzL,OAAOZ,QASnBkM,KAAKI,MAAQ,SAAUC,EAAWC,GAChC,IAEIC,EADJ,OAAKF,IACDE,EAAU3F,SAASC,cAAc,KAAK,GAClCvB,UAAY+G,EACsL,UAArM,OAACpH,EAAK,OAAC5D,EAAKkL,MAAAA,EAAyC,KAAA,EAASA,EAAQpH,mBAA+C,KAAA,EAAS9D,EAAG+D,SAAqC,KAAA,EAASH,EAAGI,YAAY,KACjMkH,EAAQjH,UAAYiH,EAAQpH,kBAAkBG,WAGvCqG,MAAMC,KAAKW,EAAQV,UAAU,EAAElD,IAAI,SAAU6D,GACpD,IAAYzH,EAEZ,GAAsB,IAAlByH,EAAKC,SAAgB,CAEvB,GAAID,EAAKnC,UAAUC,SAAS,MAAM,EAChC,OAAO,OAACjJ,EAAKiL,MAAAA,EAA2C,KAAA,EAASA,EAAS,CACxEG,SAAU,EACVnN,MAAOkN,EAAKnD,WACd,CAAC,GAA+BhI,EAAK,GAGlC,GAAImL,EAAKnC,UAAUC,SAAS,UAAU,EACzC,OAAO,OAACrF,EAAKqH,MAAAA,EAA2C,KAAA,EAASA,EAAS,CACxEG,SAAU,EACVnN,MAAOkN,EAAKnD,WACd,CAAC,GAA+BpE,EAAK,EAEzC,MAEK,GAAsB,IAAlBuH,EAAKC,SACZ,OAAO,OAAC1H,EAAKuH,MAAAA,EAA2C,KAAA,EAASA,EAAS,CACxEG,SAAU,EACVnN,MAAOkN,EAAKnD,WACd,CAAC,GAA+BtE,EAAK,GAEvC,MAAO,EACT,CAAC,EAAE2H,KAAK,EAAE,GAlCa,EAoCzB,EAMAV,KAAKW,UAAY,WACf,MAAO,CACLA,UAAW,SAAmBC,EAAGtN,GAC/B,IAAIiN,EAAU3F,SAASC,cAAc,KAAK,EAE1C,OADA0F,EAAQjH,UAAYhG,EAChBiN,EAAQrF,UACH2F,QAAQC,QAAQ,EAElBD,QAAQE,OAAO,IAAIC,MAAMvM,mBAAmBX,QAAQT,EAAE,QAAQ,CAAC,CAAC,CACzE,CACF,CACF,EACAW,QAAQF,QAAUkM"}