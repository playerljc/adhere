{"version":3,"file":"Expression.js","sources":["Expression.js"],"sourcesContent":["import _Empty from \"antd/es/empty\";\nimport _CloseCircleOutlined from \"@ant-design/icons/es/icons/CloseCircleOutlined\";\nimport { useMount, useUpdateLayoutEffect } from 'ahooks';\nimport classNames from 'classnames';\nimport React, { forwardRef, memo, useImperativeHandle, useMemo, useRef } from 'react';\nimport Hooks from '@baifendian/adhere-ui-hooks';\nimport Util from '@baifendian/adhere-util';\nimport Intl from '@baifendian/adhere-util-intl';\nimport View from './View';\nimport { ElasticSearch, Math, Sql } from './operators';\nvar getCurrentParentElementWithCursor = Util.getCurrentParentElementWithCursor,\n  getCurrentElementWithCursor = Util.getCurrentElementWithCursor,\n  setCursorToEnd = Util.setCursorToEnd,\n  setCursorPositionToNode = Util.setCursorPositionToNode,\n  setCursorPosition = Util.setCursorPosition,\n  getCursorIndex = Util.getCursorIndex,\n  getCursorRectByDocument = Util.getCursorRectByDocument,\n  isString = Util.isString,\n  isFunction = Util.isFunction;\n// 缺省的触发字符code\nvar defaultTriggerCharCode = 32;\n// html的空格\nvar htmlSpace = '&nbsp;';\n// 弹层的宽度\nvar modalWidth = 300;\nvar useSetState = Hooks.useSetState;\nexport var selectorPrefix = 'adhere-ui-expression';\n/**\n * Expression\n * @param className\n * @param style\n * @param editorClassName\n * @param editorStyle\n * @param operatorWrapClassName\n * @param operatorWrapStyle\n * @param quickTipWrapClassName\n * @param quickTipWrapStyle\n * @param textClassName\n * @param operatorClassName\n * @param value\n * @param placeholder\n * @param triggerCharCode\n * @param quickTipProp\n * @param quickTipDataSource\n * @param disableQuickTip\n * @param operators\n * @param allowClear\n * @param onChange\n * @param onContinuousTextChange\n * @param onEditorInputEnd\n * @param onEditorBlurEnd\n * @param onEditorKeyDownEnd\n * @param onEditorPasteEnd\n * @param ref\n * @constructor\n */\nvar InternalExpression = /*#__PURE__*/memo( /*#__PURE__*/forwardRef(function (_a, ref) {\n  var _b, _c, _d, _e;\n  var className = _a.className,\n    style = _a.style,\n    editorClassName = _a.editorClassName,\n    editorStyle = _a.editorStyle,\n    operatorWrapClassName = _a.operatorWrapClassName,\n    operatorWrapStyle = _a.operatorWrapStyle,\n    quickTipWrapClassName = _a.quickTipWrapClassName,\n    quickTipWrapStyle = _a.quickTipWrapStyle,\n    textClassName = _a.textClassName,\n    operatorClassName = _a.operatorClassName,\n    value = _a.value,\n    placeholder = _a.placeholder,\n    triggerCharCode = _a.triggerCharCode,\n    quickTipProp = _a.quickTipProp,\n    quickTipDataSource = _a.quickTipDataSource,\n    disableQuickTip = _a.disableQuickTip,\n    operators = _a.operators,\n    allowClear = _a.allowClear,\n    onChange = _a.onChange,\n    onContinuousTextChange = _a.onContinuousTextChange,\n    onEditorInputEnd = _a.onEditorInputEnd,\n    onEditorBlurEnd = _a.onEditorBlurEnd,\n    onEditorKeyDownEnd = _a.onEditorKeyDownEnd,\n    onEditorPasteEnd = _a.onEditorPasteEnd;\n  var operatorsConfig = useMemo(function () {\n    return operators !== null && operators !== void 0 ? operators : ElasticSearch;\n  }, [operators]);\n  // contextRef\n  var contextRef = useRef(null);\n  // input对象\n  var editorRef = useRef(null);\n  // 运算符下拉\n  var operatorsRef = useRef(null);\n  // quickTipRef\n  var quickTipRef = useRef(null);\n  // placeholder\n  var placeholderRef = useRef(null);\n  // 光标输入处的父元素\n  var cursorContextParentElement = useRef(null);\n  // 光标输入处的元素\n  var cursorContextElement = useRef(null);\n  // 光标的索引\n  var cursorIndex = useRef(-1);\n  // 之前光标的索引\n  var preCursorIndex = useRef(0);\n  // 之前光标处的元素\n  var preCursorContextElement = useRef(null);\n  // 连续输入的字符\n  var continuousText = useRef('');\n  // 若干可见字符的输入之前，而这些可见字符的输入可能需要一连串的键盘操作、点击输入法的备选词等\n  var comStart = useRef(false);\n  var _f = useSetState(false),\n    operatorsShow = _f[0],\n    setOperatorsShow = _f[1];\n  var _g = useSetState(false),\n    quickTipShow = _g[0],\n    setQuickTipShow = _g[1];\n  var _h = useSetState(true),\n    placeholderShow = _h[0],\n    setPlaceholderShow = _h[1];\n  // allowClear是否显示\n  var _j = useSetState(false),\n    showAllowClear = _j[0],\n    setShowAllClear = _j[1];\n  var triggerChar = useMemo(function () {\n    return String.fromCharCode(triggerCharCode !== null && triggerCharCode !== void 0 ? triggerCharCode : defaultTriggerCharCode);\n  }, [triggerCharCode]);\n  useMount(function () {\n    var editor = getEditorEl();\n    if (editor) {\n      editor.innerHTML = value !== null && value !== void 0 ? value : '';\n    }\n    setCursorToEnd(editor);\n    onReady();\n  });\n  useUpdateLayoutEffect(function () {\n    onReady();\n  }, [value]);\n  useImperativeHandle(ref, function () {\n    return {\n      setValue: function (_value) {\n        var editor = getEditorEl();\n        if (editor) {\n          editor.innerHTML = _value !== null && _value !== void 0 ? _value : '';\n        }\n        setCursorToEnd(editor);\n        onReady();\n      },\n      getValue: function () {\n        var _a;\n        return (_a = getEditorEl()) === null || _a === void 0 ? void 0 : _a.innerHTML;\n      },\n      isEditorEmpty: isEditorEmpty,\n      showOperators: showOperators,\n      hideOperators: hideOperators,\n      showQuickTip: showQuickTip,\n      hideQuickTip: hideQuickTip,\n      clear: clear\n    };\n  });\n  /**\n   * onReady\n   * @description 组件mount\n   */\n  function onReady() {\n    initial();\n  }\n  /**\n   * initial\n   * @description 初始化\n   */\n  function initial() {\n    if (isEditorEmpty()) {\n      showPlaceholder();\n    } else {\n      hidePlaceholder();\n    }\n  }\n  /**\n   * getEditorEl\n   * @return {HTMLElement}\n   */\n  function getEditorEl() {\n    var _a;\n    if (isFont()) {\n      return (_a = editorRef === null || editorRef === void 0 ? void 0 : editorRef.current) === null || _a === void 0 ? void 0 : _a.firstElementChild;\n    } else {\n      return editorRef === null || editorRef === void 0 ? void 0 : editorRef.current;\n    }\n  }\n  /**\n   * isEditorEmpty\n   * @description 编辑器是否为空\n   * @return {boolean}\n   */\n  function isEditorEmpty() {\n    var _a, _b, _c;\n    return ((_c = (_b = (_a = getEditorEl()) === null || _a === void 0 ? void 0 : _a.innerHTML) === null || _b === void 0 ? void 0 : _b.trim) === null || _c === void 0 ? void 0 : _c.call(_b)) === '';\n  }\n  /**\n   * clear\n   * @description 清空内容\n   */\n  function clear() {\n    var contextEditor = getEditorEl();\n    if (contextEditor) {\n      contextEditor.innerHTML = '';\n      hideOperators();\n      hideQuickTip();\n      showPlaceholder();\n      setShowAllClear(false);\n    }\n  }\n  /**\n   * containsEntityCharacters\n   * @description 判断是否是实体字符\n   * @param str\n   */\n  function containsEntityCharacters(str) {\n    var entityRegex = /^&#\\d+;/gim;\n    return entityRegex.test(str);\n  }\n  /**\n   * showModal\n   * @description 显示Modal\n   * @param {HTMLElement} currentEl\n   * @param {Function} callback\n   */\n  function showModal(currentEl, callback) {\n    var _a, _b, _c, _d;\n    var point = getCursorRectByDocument();\n    if (point && currentEl) {\n      var contextWidth = (_a = contextRef.current) === null || _a === void 0 ? void 0 : _a.offsetWidth;\n      var contextHeight = (_b = contextRef === null || contextRef === void 0 ? void 0 : contextRef.current) === null || _b === void 0 ? void 0 : _b.offsetHeight;\n      var contextRect = (_d = (_c = contextRef.current) === null || _c === void 0 ? void 0 : _c.getBoundingClientRect) === null || _d === void 0 ? void 0 : _d.call(_c);\n      if (!!contextWidth && !!contextHeight && contextRef && currentEl && contextRect) {\n        if ((point === null || point === void 0 ? void 0 : point.x) === 0 && (point === null || point === void 0 ? void 0 : point.y) === 0) {\n          currentEl.style.left = \"\".concat(contextRect.x + 20, \"px\");\n          currentEl.style.top = \"\".concat(contextRect.y + contextHeight - 2, \"px\");\n        } else if ((contextRect === null || contextRect === void 0 ? void 0 : contextRect.x) + contextWidth - (point === null || point === void 0 ? void 0 : point.x) < modalWidth) {\n          currentEl.style.left = \"\".concat(contextRect.x + contextWidth - modalWidth - 10, \"px\");\n          currentEl.style.top = \"\".concat(point.y + 25, \"px\");\n        } else {\n          currentEl.style.left = \"\".concat(point.x + 10, \"px\");\n          currentEl.style.top = \"\".concat(point.y + 25, \"px\");\n        }\n      }\n    }\n    callback === null || callback === void 0 ? void 0 : callback();\n  }\n  /**\n   * showOperators\n   * @description 显示运算符选择下拉\n   */\n  function showOperators() {\n    showModal(operatorsRef.current, function () {\n      return setOperatorsShow(true, function () {});\n    });\n  }\n  /**\n   * hideOperators\n   * @description 关闭运算符选择下拉\n   */\n  function hideOperators() {\n    setOperatorsShow(false);\n  }\n  /**\n   * showQuickTip\n   */\n  function showQuickTip() {\n    showModal(quickTipRef.current, function () {\n      return setQuickTipShow(true);\n    });\n  }\n  /**\n   * hideOperators\n   * @description 关闭运算符选择下拉\n   */\n  function hideQuickTip() {\n    setQuickTipShow(false);\n  }\n  /**\n   * showPlaceholder\n   * @description 显示placeholder\n   */\n  function showPlaceholder() {\n    setPlaceholderShow(true);\n  }\n  /**\n   * hidePlaceholder\n   * @description 隐藏placeholder\n   */\n  function hidePlaceholder() {\n    setPlaceholderShow(false);\n  }\n  /**\n   * createTextElement\n   * @description 创建文本元素\n   * @param {string} html 文本的内容\n   * @return {HTMLSpanElement}\n   */\n  function createTextElement(html) {\n    var targetTextClassName = '';\n    if (isString(textClassName)) {\n      targetTextClassName = textClassName;\n    } else if (isFunction(textClassName)) {\n      targetTextClassName = textClassName(html);\n    }\n    var textElement = document.createElement('span');\n    textElement.className = classNames('text', targetTextClassName !== null && targetTextClassName !== void 0 ? targetTextClassName : '');\n    textElement.innerHTML = html;\n    return textElement;\n  }\n  /**\n   * createOperatorElement\n   * @description 创建运算符元素\n   * @param {string} text 元素的文本\n   * @return {HTMLSpanElement}\n   */\n  function createOperatorElement(text) {\n    var targetOperatorClassName = '';\n    if (isString(operatorClassName)) {\n      targetOperatorClassName = operatorClassName;\n    } else if (isFunction(operatorClassName)) {\n      targetOperatorClassName = operatorClassName(text);\n    }\n    var operatorElement = document.createElement('span');\n    operatorElement.className = classNames('operator', targetOperatorClassName !== null && targetOperatorClassName !== void 0 ? targetOperatorClassName : '');\n    operatorElement.setAttribute('contenteditable', 'false');\n    operatorElement.innerHTML = text;\n    return operatorElement;\n  }\n  /**\n   * isFont\n   * @description 是否是font元素\n   * @return {boolean}\n   */\n  function isFont() {\n    var _a, _b, _c, _d;\n    return ((_d = (_c = (_b = (_a = editorRef === null || editorRef === void 0 ? void 0 : editorRef.current) === null || _a === void 0 ? void 0 : _a.firstElementChild) === null || _b === void 0 ? void 0 : _b.tagName) === null || _c === void 0 ? void 0 : _c.toLowerCase) === null || _d === void 0 ? void 0 : _d.call(_c)) === 'font';\n  }\n  /**\n   * setContinuousText\n   * @description 设置连续输入的字符\n   * @param {string} text 当前输入的文本\n   */\n  function setContinuousText(text) {\n    if (!preCursorContextElement.current || preCursorContextElement.current === cursorContextElement.current && preCursorIndex.current + 1 === cursorIndex.current) {\n      preCursorIndex.current = cursorIndex.current;\n      preCursorContextElement.current = cursorContextElement.current;\n      continuousText.current += text;\n    } else {\n      preCursorIndex.current = cursorIndex.current;\n      preCursorContextElement.current = cursorContextElement.current;\n      continuousText.current = text;\n    }\n  }\n  /**\n   * onEditorCompositionStart\n   * @description 编辑框输入中文开始\n   */\n  function onEditorCompositionStart() {\n    comStart.current = true;\n    // console.log('中文输入：开始');\n  }\n  /**\n   * onEditorCompositionEnd\n   * @description 编辑框输入中文结束\n   * @param e\n   */\n  function onEditorCompositionEnd(e) {\n    comStart.current = false;\n    // console.log('中文输入：结束');\n    onEditorInput(e);\n  }\n  /**\n   * onEditorInput\n   * @description 编辑框input\n   */\n  function onEditorInput(e) {\n    var _a, _b;\n    if (comStart.current) return; // 中文输入过程中不截断\n    if (cursorContextElement) {\n      cursorContextElement.current = getCurrentElementWithCursor();\n    }\n    if (cursorContextParentElement) {\n      cursorContextParentElement.current = getCurrentParentElementWithCursor();\n    }\n    cursorIndex.current = getCursorIndex();\n    if (isEditorEmpty()) {\n      showPlaceholder();\n    } else {\n      hidePlaceholder();\n    }\n    var text = e.nativeEvent.data;\n    if (text !== null) {\n      setContinuousText(text);\n      if (!disableQuickTip) {\n        onContinuousTextChange === null || onContinuousTextChange === void 0 ? void 0 : onContinuousTextChange(continuousText.current);\n      }\n    } else {\n      if (!disableQuickTip) {\n        onContinuousTextChange === null || onContinuousTextChange === void 0 ? void 0 : onContinuousTextChange((_a = cursorContextElement === null || cursorContextElement === void 0 ? void 0 : cursorContextElement.current) === null || _a === void 0 ? void 0 : _a.textContent);\n      }\n      // console.log('cursorContextElement', cursorContextElement.current?.textContent);\n    }\n    if (!disableQuickTip) {\n      if (text !== triggerChar) {\n        showQuickTip();\n      }\n    }\n    // input输入结束\n    if (text !== triggerChar) {\n      onEditorInputEnd === null || onEditorInputEnd === void 0 ? void 0 : onEditorInputEnd(text, continuousText.current);\n    }\n    // onChange\n    onChange === null || onChange === void 0 ? void 0 : onChange((_b = editorRef === null || editorRef === void 0 ? void 0 : editorRef.current) === null || _b === void 0 ? void 0 : _b.innerHTML);\n    setShowAllClear(!isEditorEmpty());\n  }\n  /**\n   * onEditorPaste\n   * @description 编辑框粘贴\n   * @param e\n   */\n  function onEditorPaste(e) {\n    // 禁止粘贴内容\n    e.preventDefault();\n    onEditorPasteEnd === null || onEditorPasteEnd === void 0 ? void 0 : onEditorPasteEnd(e);\n  }\n  /**\n   * onEditorKeyDown\n   * @description 编辑框keyDown\n   * @param e\n   * @return {boolean}\n   */\n  function onEditorKeyDown(e) {\n    // 默认空格\n    if (e.keyCode === (triggerCharCode !== null && triggerCharCode !== void 0 ? triggerCharCode : defaultTriggerCharCode)) {\n      hideQuickTip();\n      showOperators();\n      onEditorKeyDownEnd === null || onEditorKeyDownEnd === void 0 ? void 0 : onEditorKeyDownEnd(e);\n      return false;\n    }\n    // 屏蔽回车操作\n    if (e.keyCode === 13) {\n      hideOperators();\n      e.stopPropagation();\n      e.preventDefault();\n      onEditorKeyDownEnd === null || onEditorKeyDownEnd === void 0 ? void 0 : onEditorKeyDownEnd(e);\n      return false;\n    }\n    hideOperators();\n    onEditorKeyDownEnd === null || onEditorKeyDownEnd === void 0 ? void 0 : onEditorKeyDownEnd(e);\n  }\n  /**\n   * onEditorBlur\n   * @description 编辑框失去焦点\n   */\n  function onEditorBlur(e) {\n    e.stopPropagation();\n    e.preventDefault();\n    if (isEditorEmpty()) {\n      showPlaceholder();\n    } else {\n      hidePlaceholder();\n    }\n    onEditorBlurEnd === null || onEditorBlurEnd === void 0 ? void 0 : onEditorBlurEnd(e);\n  }\n  /**\n   * onOperatorsClick\n   * @description 选择运算符\n   * @param {string} operator\n   * @param {OperatorType} operatorType\n   */\n  function onOperatorsClick(operator, operatorType) {\n    var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u, _v, _w, _x, _y;\n    if (operator) {\n      var editor = getEditorEl();\n      // 括号\n      if (operatorType === 'brackets') {\n        var left = operator[0];\n        var right = operator[1];\n        if (containsEntityCharacters(operator)) {\n          var arr = operator.split(';').filter(function (t) {\n            return t;\n          });\n          left = arr[0];\n          right = arr[1];\n        }\n        var leftElement = createOperatorElement(left);\n        var rightElement = createOperatorElement(right);\n        var textElement = createTextElement(\"\".concat(htmlSpace).concat(htmlSpace));\n        // 如果是在editor的文本中进行的编辑\n        if (cursorContextParentElement.current === editor) {\n          var text = (_a = cursorContextElement === null || cursorContextElement === void 0 ? void 0 : cursorContextElement.current) === null || _a === void 0 ? void 0 : _a.textContent;\n          var startElement = createTextElement((_b = text === null || text === void 0 ? void 0 : text.substring) === null || _b === void 0 ? void 0 : _b.call(text, 0, cursorIndex.current + 1));\n          var endElement = createTextElement((_c = text === null || text === void 0 ? void 0 : text.substring) === null || _c === void 0 ? void 0 : _c.call(text, cursorIndex.current + 1));\n          var df = document.createDocumentFragment();\n          df.appendChild(startElement);\n          df.appendChild(leftElement);\n          df.appendChild(textElement);\n          df.appendChild(rightElement);\n          if (endElement && endElement.textContent) {\n            endElement.textContent.length !== 0 && df.appendChild(endElement);\n          }\n          (_d = editor === null || editor === void 0 ? void 0 : editor.replaceChild) === null || _d === void 0 ? void 0 : _d.call(editor, df, cursorContextElement.current);\n          setCursorPosition(textElement, 1);\n        }\n        // 如果是在text文本中进行的编辑\n        else {\n          var text = (_e = cursorContextElement === null || cursorContextElement === void 0 ? void 0 : cursorContextElement.current) === null || _e === void 0 ? void 0 : _e.textContent;\n          var startElement = createTextElement((_f = text === null || text === void 0 ? void 0 : text.substring) === null || _f === void 0 ? void 0 : _f.call(text, 0, cursorIndex.current));\n          var endElement = createTextElement((_g = text === null || text === void 0 ? void 0 : text.substring) === null || _g === void 0 ? void 0 : _g.call(text, cursorIndex.current));\n          var df = document.createDocumentFragment();\n          df.appendChild(startElement);\n          df.appendChild(startElement);\n          df.appendChild(leftElement);\n          df.appendChild(textElement);\n          df.appendChild(rightElement);\n          if (endElement && endElement.textContent) {\n            endElement.textContent.length !== 0 && df.appendChild(endElement);\n          }\n          (_k = (_j = (_h = cursorContextParentElement === null || cursorContextParentElement === void 0 ? void 0 : cursorContextParentElement.current) === null || _h === void 0 ? void 0 : _h.parentElement) === null || _j === void 0 ? void 0 : _j.replaceChild) === null || _k === void 0 ? void 0 : _k.call(_j, df, cursorContextParentElement.current);\n          setCursorPosition(textElement, 1);\n        }\n      }\n      // 其他符号\n      else {\n        var operatorElement = createOperatorElement(operator);\n        var textElement = createTextElement(htmlSpace);\n        // 如果是在editor的文本中进行的编辑\n        if (cursorContextParentElement.current === editor) {\n          // 光标所在的元素现在是text元素\n          // let parentElement = getInsertParentElement();\n          // parentElement.appendChild(operatorElement);\n          // parentElement.appendChild(textElement);\n          // setCursorToEnd(parentElement);\n          var text = (_l = cursorContextElement === null || cursorContextElement === void 0 ? void 0 : cursorContextElement.current) === null || _l === void 0 ? void 0 : _l.textContent;\n          var startElement = createTextElement((_m = text === null || text === void 0 ? void 0 : text.substring) === null || _m === void 0 ? void 0 : _m.call(text, 0, cursorIndex.current + 1));\n          var endElement = createTextElement((_o = text === null || text === void 0 ? void 0 : text.substring) === null || _o === void 0 ? void 0 : _o.call(text, cursorIndex.current + 1));\n          var df = document.createDocumentFragment();\n          df.appendChild(startElement);\n          df.appendChild(operatorElement);\n          df.appendChild(textElement);\n          if (endElement && endElement.textContent) {\n            endElement.textContent.length !== 0 && df.appendChild(endElement);\n          }\n          editor === null || editor === void 0 ? void 0 : editor.replaceChild(df, cursorContextElement.current);\n          setCursorPosition(textElement, 0);\n        }\n        // 如果是在text文本中进行的编辑\n        // @ts-ignore\n        else if ((_r = (_q = (_p = cursorContextParentElement === null || cursorContextParentElement === void 0 ? void 0 : cursorContextParentElement.current) === null || _p === void 0 ? void 0 : _p.classList) === null || _q === void 0 ? void 0 : _q.contains) === null || _r === void 0 ? void 0 : _r.call(_q, 'text')) {\n          var text = (_s = cursorContextElement === null || cursorContextElement === void 0 ? void 0 : cursorContextElement.current) === null || _s === void 0 ? void 0 : _s.textContent;\n          var startElement = createTextElement((_t = text === null || text === void 0 ? void 0 : text.substring) === null || _t === void 0 ? void 0 : _t.call(text, 0, cursorIndex.current));\n          var endElement = createTextElement((_u = text === null || text === void 0 ? void 0 : text.substring) === null || _u === void 0 ? void 0 : _u.call(text, cursorIndex.current));\n          var df = document.createDocumentFragment();\n          df.appendChild(startElement);\n          df.appendChild(operatorElement);\n          df.appendChild(textElement);\n          if (endElement && endElement.textContent) {\n            endElement.textContent.length !== 0 && df.appendChild(endElement);\n          }\n          (_x = (_w = (_v = cursorContextParentElement === null || cursorContextParentElement === void 0 ? void 0 : cursorContextParentElement.current) === null || _v === void 0 ? void 0 : _v.parentElement) === null || _w === void 0 ? void 0 : _w.replaceChild) === null || _x === void 0 ? void 0 : _x.call(_w, df, cursorContextParentElement.current);\n          setCursorPosition(textElement, 0);\n        }\n      }\n      onChange === null || onChange === void 0 ? void 0 : onChange((_y = editorRef === null || editorRef === void 0 ? void 0 : editorRef.current) === null || _y === void 0 ? void 0 : _y.innerHTML);\n    }\n    hideOperators();\n  }\n  /**\n   * onQuickTipClick\n   * @description 选额智能提示\n   * @param e\n   * @param item\n   */\n  function onQuickTipClick(e, item) {\n    var _a, _b, _c, _d;\n    var tip = item[quickTipProp !== null && quickTipProp !== void 0 ? quickTipProp : 'value'];\n    var editor = getEditorEl();\n    // java\n    if (tip) {\n      // 111\n      var text = ((_a = cursorContextElement.current) === null || _a === void 0 ? void 0 : _a.textContent) || '';\n      var startIndex = text.lastIndexOf(continuousText.current, preCursorIndex.current);\n      // 111(java) -> 111java\n      // (java)111 -> java111\n      // 1(java)11 -> 1java11\n      var endIndex = startIndex + continuousText.current.length;\n      var df_1 = document.createDocumentFragment();\n      var startTextNode = document.createTextNode(text.substring(0, startIndex));\n      var endTextNode = document.createTextNode(text.substring(endIndex));\n      var collapseEl = document.createElement('div');\n      collapseEl.innerHTML = tip;\n      df_1.appendChild(startTextNode);\n      Array.from(collapseEl.childNodes).forEach(function (el) {\n        df_1.appendChild(el);\n      });\n      df_1.appendChild(endTextNode);\n      if (contextRef.current === cursorContextParentElement.current) {\n        editor.innerHTML = '';\n        editor.appendChild(df_1);\n      } else if (editor === cursorContextParentElement.current) {\n        if ((_b = cursorContextElement === null || cursorContextElement === void 0 ? void 0 : cursorContextElement.current) === null || _b === void 0 ? void 0 : _b.parentElement) {\n          cursorContextElement.current.parentElement.replaceChild(df_1, cursorContextElement.current);\n        }\n      } else {\n        if ((_c = cursorContextParentElement === null || cursorContextParentElement === void 0 ? void 0 : cursorContextParentElement.current) === null || _c === void 0 ? void 0 : _c.parentElement) {\n          cursorContextParentElement.current.parentElement.replaceChild(df_1, cursorContextParentElement.current);\n        }\n      }\n      setCursorPositionToNode(endTextNode, 0);\n      onChange === null || onChange === void 0 ? void 0 : onChange((_d = editorRef === null || editorRef === void 0 ? void 0 : editorRef.current) === null || _d === void 0 ? void 0 : _d.innerHTML);\n    }\n    hideQuickTip();\n    hidePlaceholder();\n  }\n  // 获取插入的父元素\n  // function getInsertParentElement() {\n  //   return cursorContextParentElement.current === editor.current\n  //     ? cursorContextParentElement.current\n  //     : cursorContextParentElement.current.parentElement;\n  // }\n  return /*#__PURE__*/React.createElement(\"div\", {\n    ref: contextRef,\n    className: classNames(selectorPrefix, className !== null && className !== void 0 ? className : ''),\n    style: style !== null && style !== void 0 ? style : {}\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    ref: editorRef,\n    className: classNames(\"\".concat(selectorPrefix, \"-editor\"), editorClassName !== null && editorClassName !== void 0 ? editorClassName : '', (_b = {}, _b[\"\".concat(selectorPrefix, \"-editor--show-clear\")] = !!allowClear, _b)),\n    style: editorStyle !== null && editorStyle !== void 0 ? editorStyle : {},\n    contentEditable: \"true\",\n    onInput: onEditorInput,\n    onKeyDown: onEditorKeyDown,\n    onBlur: onEditorBlur,\n    onCompositionStart: onEditorCompositionStart,\n    onCompositionEnd: onEditorCompositionEnd,\n    onPaste: onEditorPaste\n  }), !!allowClear && showAllowClear && ( /*#__PURE__*/React.createElement(\"div\", {\n    className: \"\".concat(selectorPrefix, \"-editor-clear\")\n  }, /*#__PURE__*/React.createElement(_CloseCircleOutlined, {\n    onClick: function () {\n      var _a;\n      clear();\n      // @ts-ignore\n      (_a = getEditorEl()) === null || _a === void 0 ? void 0 : _a.focus();\n    }\n  }))), /*#__PURE__*/React.createElement(\"div\", {\n    className: classNames(\"\".concat(selectorPrefix, \"-editor-placeholder\"), (_c = {}, _c[\"\".concat(selectorPrefix, \"-editor-placeholder--show\")] = placeholderShow, _c)),\n    ref: placeholderRef\n  }, placeholder !== null && placeholder !== void 0 ? placeholder : Intl.v('请输入关键词')), /*#__PURE__*/React.createElement(\"div\", {\n    ref: operatorsRef,\n    className: classNames(\"\".concat(selectorPrefix, \"-operators\"), operatorWrapClassName !== null && operatorWrapClassName !== void 0 ? operatorWrapClassName : '', (_d = {}, _d[\"\".concat(selectorPrefix, \"-operators--show\")] = operatorsShow, _d)),\n    style: operatorWrapStyle !== null && operatorWrapStyle !== void 0 ? operatorWrapStyle : {}\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: classNames(\"\".concat(selectorPrefix, \"-operators-header\"))\n  }, /*#__PURE__*/React.createElement(\"i\", {\n    onClick: function () {\n      return hideOperators();\n    }\n  }, /*#__PURE__*/React.createElement(_CloseCircleOutlined, null))), /*#__PURE__*/React.createElement(\"ul\", {\n    className: classNames(\"\".concat(selectorPrefix, \"-operators-main\"))\n  }, operatorsConfig.map(function (_a) {\n    var label = _a.label,\n      value = _a.value,\n      type = _a.type;\n    return /*#__PURE__*/React.createElement(\"li\", {\n      key: value,\n      onClick: function () {\n        onOperatorsClick(value, type);\n      },\n      dangerouslySetInnerHTML: {\n        __html: label\n      }\n    });\n  }))), /*#__PURE__*/React.createElement(\"div\", {\n    ref: quickTipRef,\n    className: classNames(\"\".concat(selectorPrefix, \"-quick-tips\"), quickTipWrapClassName !== null && quickTipWrapClassName !== void 0 ? quickTipWrapClassName : '', (_e = {}, _e[\"\".concat(selectorPrefix, \"-quick-tips--show\")] = quickTipShow, _e)),\n    style: quickTipWrapStyle !== null && quickTipWrapStyle !== void 0 ? quickTipWrapStyle : {}\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: classNames(\"\".concat(selectorPrefix, \"-quick-tips-header\"))\n  }, /*#__PURE__*/React.createElement(\"i\", {\n    onClick: function () {\n      return hideQuickTip();\n    }\n  }, /*#__PURE__*/React.createElement(_CloseCircleOutlined, null))), !(quickTipDataSource || []).length && ( /*#__PURE__*/React.createElement(\"div\", null, /*#__PURE__*/React.createElement(_Empty, null))), /*#__PURE__*/React.createElement(\"ul\", {\n    className: classNames(\"\".concat(selectorPrefix, \"-quick-tips-main\"))\n  }, !!(quickTipDataSource || []).length && (quickTipDataSource || []).map(function (t, _index) {\n    return /*#__PURE__*/React.createElement(\"li\", {\n      key: t.value,\n      onClick: function (e) {\n        return onQuickTipClick(e, t);\n      }\n    }, t.label);\n  }))));\n}));\nvar Expression = InternalExpression;\nExpression.View = View;\nExpression.ElasticSearchOptions = ElasticSearch;\nExpression.SqlOptions = Sql;\nExpression.MathOptions = Math;\n/**\n * parse\n * @description 解析\n * @param {string} queryHtml\n * @param {(value: { nodeType: number; value: string | null }) => string} callback\n * @return {string}\n */\nExpression.parse = function (queryHtml, callback) {\n  var _a, _b;\n  if (!queryHtml) return '';\n  var context = document.createElement('div');\n  context.innerHTML = queryHtml;\n  if (((_b = (_a = context === null || context === void 0 ? void 0 : context.firstElementChild) === null || _a === void 0 ? void 0 : _a.tagName) === null || _b === void 0 ? void 0 : _b.toLowerCase()) === 'font') {\n    context.innerHTML = context.firstElementChild.innerHTML;\n  }\n  var result = '';\n  result = Array.from(context.childNodes).map(function (node) {\n    var _a, _b, _c;\n    // 元素节点\n    if (node.nodeType === 1) {\n      // 文本节点\n      if (node.classList.contains('text')) {\n        return (_a = callback === null || callback === void 0 ? void 0 : callback({\n          nodeType: 3,\n          value: node.textContent\n        })) !== null && _a !== void 0 ? _a : '';\n      }\n      // 运算符\n      else if (node.classList.contains('operator')) {\n        return (_b = callback === null || callback === void 0 ? void 0 : callback({\n          nodeType: 1,\n          value: node.textContent\n        })) !== null && _b !== void 0 ? _b : '';\n      }\n    }\n    // 文本节点\n    else if (node.nodeType === 3) {\n      return (_c = callback === null || callback === void 0 ? void 0 : callback({\n        nodeType: 3,\n        value: node.textContent\n      })) !== null && _c !== void 0 ? _c : '';\n    }\n    return '';\n  }).join('');\n  return result;\n};\n/**\n * validator\n * @return {{validator(*, *): (Promise<void>)}}\n */\nExpression.validator = function () {\n  return {\n    validator: function (_, value) {\n      var context = document.createElement('div');\n      context.innerHTML = value;\n      if (context.innerText) {\n        return Promise.resolve();\n      }\n      return Promise.reject(new Error(Intl.v('请输入关键字')));\n    }\n  };\n};\nExpression.displayName = 'Expression';\nexport default Expression;"],"names":["_Empty","_CloseCircleOutlined","useMount","useUpdateLayoutEffect","classNames","React","forwardRef","memo","useImperativeHandle","useMemo","useRef","Hooks","Util","Intl","View","ElasticSearch","Math","Sql","getCurrentParentElementWithCursor","getCurrentElementWithCursor","setCursorToEnd","setCursorPositionToNode","setCursorPosition","getCursorIndex","getCursorRectByDocument","isString","isFunction","defaultTriggerCharCode","htmlSpace","modalWidth","useSetState","selectorPrefix","InternalExpression","_a","ref","className","style","editorClassName","editorStyle","operatorWrapClassName","operatorWrapStyle","quickTipWrapClassName","quickTipWrapStyle","textClassName","operatorClassName","value","placeholder","triggerCharCode","quickTipProp","quickTipDataSource","disableQuickTip","operators","allowClear","onChange","onContinuousTextChange","onEditorInputEnd","onEditorBlurEnd","onEditorKeyDownEnd","onEditorPasteEnd","operatorsConfig","contextRef","editorRef","operatorsRef","quickTipRef","placeholderRef","cursorContextParentElement","cursorContextElement","cursorIndex","preCursorIndex","preCursorContextElement","continuousText","comStart","_f","operatorsShow","setOperatorsShow","_g","quickTipShow","setQuickTipShow","_h","placeholderShow","setPlaceholderShow","_j","showAllowClear","setShowAllClear","triggerChar","String","fromCharCode","onReady","isEditorEmpty","showPlaceholder","hidePlaceholder","getEditorEl","_c","_d","_b","current","firstElementChild","tagName","toLowerCase","call","innerHTML","trim","clear","contextEditor","hideOperators","hideQuickTip","showModal","currentEl","callback","contextWidth","contextHeight","contextRect","point","offsetWidth","offsetHeight","getBoundingClientRect","x","y","left","concat","top","showOperators","showQuickTip","createTextElement","html","targetTextClassName","textElement","document","createElement","createOperatorElement","text","targetOperatorClassName","operatorElement","setAttribute","onEditorInput","e","nativeEvent","data","textContent","editor","setValue","_value","getValue","contentEditable","onInput","onKeyDown","keyCode","stopPropagation","preventDefault","onBlur","onCompositionStart","onCompositionEnd","onPaste","onClick","focus","v","map","label","type","key","operator","operatorType","leftElement","startElement","endElement","df","right","test","arr","split","filter","t","rightElement","substring","createDocumentFragment","appendChild","length","replaceChild","_e","_k","parentElement","_m","_l","_o","_r","_q","_p","classList","contains","_t","_s","_u","_x","_w","_v","_y","dangerouslySetInnerHTML","__html","_index","tip","item","endIndex","startIndex","lastIndexOf","df_1","startTextNode","createTextNode","endTextNode","collapseEl","Array","from","childNodes","forEach","el","Expression","ElasticSearchOptions","SqlOptions","MathOptions","parse","queryHtml","context","node","nodeType","join","validator","_","innerText","Promise","resolve","reject","Error","displayName"],"mappings":"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"}