{"version":3,"file":"expression.js","sources":["expression.js"],"sourcesContent":["import _Empty from \"antd/es/empty\";\nimport _CloseCircleOutlined from \"@ant-design/icons/es/icons/CloseCircleOutlined\";\nimport { useMount, useUpdateLayoutEffect } from 'ahooks';\nimport classNames from 'classnames';\nimport React, { forwardRef, memo, useImperativeHandle, useMemo, useRef } from 'react';\nimport Hooks from '@baifendian/adhere-ui-hooks';\nimport Util from '@baifendian/adhere-util';\nimport Intl from '@baifendian/adhere-util-intl';\nimport View from './View';\nvar getCurrentParentElementWithCursor = Util.getCurrentParentElementWithCursor,\n  getCurrentElementWithCursor = Util.getCurrentElementWithCursor,\n  setCursorToEnd = Util.setCursorToEnd,\n  setCursorPositionToNode = Util.setCursorPositionToNode,\n  setCursorPosition = Util.setCursorPosition,\n  getCursorIndex = Util.getCursorIndex;\n// 缺省的触发字符code\nvar defaultTriggerCharCode = 32;\n// html的空格\nvar htmlSpace = '&nbsp;';\nvar useSetState = Hooks.useSetState;\nexport var selectorPrefix = 'adhere-ui-expression';\n/**\n * Expression\n * @param className\n * @param style\n * @param editorClassName\n * @param editorStyle\n * @param operatorWrapClassName\n * @param operatorWrapStyle\n * @param quickTipWrapClassName\n * @param quickTipWrapStyle\n * @param textClassName\n * @param operatorClassName\n * @param value\n * @param placeholder\n * @param triggerCharCode\n * @param quickTipProp\n * @param quickTipDataSource\n * @param disableQuickTip\n * @param operators\n * @param onChange\n * @param onContinuousTextChange\n * @param onEditorInputEnd\n * @param onEditorBlurEnd\n * @param onEditorKeyDownEnd\n * @param onEditorPasteEnd\n * @param ref\n * @constructor\n */\nvar Expression = function Expression(_a, ref) {\n  var _b, _c, _d;\n  var className = _a.className,\n    style = _a.style,\n    editorClassName = _a.editorClassName,\n    editorStyle = _a.editorStyle,\n    operatorWrapClassName = _a.operatorWrapClassName,\n    operatorWrapStyle = _a.operatorWrapStyle,\n    quickTipWrapClassName = _a.quickTipWrapClassName,\n    quickTipWrapStyle = _a.quickTipWrapStyle,\n    textClassName = _a.textClassName,\n    operatorClassName = _a.operatorClassName,\n    value = _a.value,\n    placeholder = _a.placeholder,\n    triggerCharCode = _a.triggerCharCode,\n    quickTipProp = _a.quickTipProp,\n    quickTipDataSource = _a.quickTipDataSource,\n    disableQuickTip = _a.disableQuickTip,\n    operators = _a.operators,\n    onChange = _a.onChange,\n    onContinuousTextChange = _a.onContinuousTextChange,\n    onEditorInputEnd = _a.onEditorInputEnd,\n    onEditorBlurEnd = _a.onEditorBlurEnd,\n    onEditorKeyDownEnd = _a.onEditorKeyDownEnd,\n    onEditorPasteEnd = _a.onEditorPasteEnd;\n  var operatorsConfig = useMemo(function () {\n    return operators !== null && operators !== void 0 ? operators : [{\n      label: '()',\n      value: '()',\n      type: 'brackets'\n    }, {\n      label: 'AND',\n      value: 'AND',\n      type: 'binary'\n    }, {\n      label: 'OR',\n      value: 'OR',\n      type: 'binary'\n    }, {\n      label: 'NOT',\n      value: 'NOT',\n      type: 'unary'\n    }];\n  }, [operators]);\n  // contextRef\n  var contextRef = useRef(null);\n  // input对象\n  var editorRef = useRef(null);\n  // 运算符下拉\n  var operatorsRef = useRef(null);\n  // quickTipRef\n  var quickTipRef = useRef(null);\n  // placeholder\n  var placeholderRef = useRef(null);\n  // 光标输入处的父元素\n  var cursorContextParentElement = useRef(null);\n  // 光标输入处的元素\n  var cursorContextElement = useRef(null);\n  // 光标的索引\n  var cursorIndex = useRef(-1);\n  // 之前光标的索引\n  var preCursorIndex = useRef(0);\n  // 之前光标处的元素\n  var preCursorContextElement = useRef(null);\n  // 连续输入的字符\n  var continuousText = useRef('');\n  // 若干可见字符的输入之前，而这些可见字符的输入可能需要一连串的键盘操作、点击输入法的备选词等\n  var comStart = useRef(false);\n  var _e = useSetState(false),\n    operatorsShow = _e[0],\n    setOperatorsShow = _e[1];\n  var _f = useSetState(false),\n    quickTipShow = _f[0],\n    setQuickTipShow = _f[1];\n  var _g = useSetState(true),\n    placeholderShow = _g[0],\n    setPlaceholderShow = _g[1];\n  var triggerChar = useMemo(function () {\n    return String.fromCharCode(triggerCharCode !== null && triggerCharCode !== void 0 ? triggerCharCode : defaultTriggerCharCode);\n  }, [triggerCharCode]);\n  useUpdateLayoutEffect(function () {\n    onReady();\n  }, [value]);\n  useMount(function () {\n    var editor = getEditorEl();\n    if (editor) {\n      editor.innerHTML = value !== null && value !== void 0 ? value : '';\n    }\n    setCursorToEnd(editor);\n    onReady();\n  });\n  useImperativeHandle(ref, function () {\n    return {\n      setValue: function setValue(_value) {\n        var editor = getEditorEl();\n        if (editor) {\n          editor.innerHTML = _value !== null && _value !== void 0 ? _value : '';\n        }\n        setCursorToEnd(editor);\n        onReady();\n      },\n      getValue: function getValue() {\n        var _a;\n        return (_a = getEditorEl()) === null || _a === void 0 ? void 0 : _a.innerHTML;\n      },\n      isEditorEmpty: isEditorEmpty,\n      showQuickTip: showQuickTip,\n      showOperators: showOperators,\n      hideQuickTip: hideQuickTip,\n      hideOperators: hideOperators\n    };\n  });\n  /**\n   * onReady\n   * @description 组件mount\n   */\n  function onReady() {\n    initial();\n  }\n  /**\n   * initial\n   * @description 初始化\n   */\n  function initial() {\n    if (isEditorEmpty()) {\n      showPlaceholder();\n    } else {\n      hidePlaceholder();\n    }\n  }\n  /**\n   * getEditorEl\n   * @return {HTMLElement}\n   */\n  function getEditorEl() {\n    var _a;\n    if (isFont()) {\n      return (_a = editorRef === null || editorRef === void 0 ? void 0 : editorRef.current) === null || _a === void 0 ? void 0 : _a.firstElementChild;\n    } else {\n      return editorRef === null || editorRef === void 0 ? void 0 : editorRef.current;\n    }\n  }\n  /**\n   * isEditorEmpty\n   * @description 编辑器是否为空\n   * @return {boolean}\n   */\n  function isEditorEmpty() {\n    var _a, _b, _c;\n    return ((_c = (_b = (_a = getEditorEl()) === null || _a === void 0 ? void 0 : _a.innerHTML) === null || _b === void 0 ? void 0 : _b.trim) === null || _c === void 0 ? void 0 : _c.call(_b)) === '';\n  }\n  function getCursorPosition() {\n    var x = 0;\n    var y = 0;\n    if (window.getSelection) {\n      var selection = window.getSelection();\n      if (selection && selection.rangeCount > 0) {\n        var range = selection.getRangeAt(0);\n        var rect = range.getBoundingClientRect();\n        x = rect.left;\n        y = rect.top;\n      }\n    }\n    return {\n      x: x,\n      y: y\n    };\n  }\n  /**\n   * showOperators\n   * @description 显示运算符选择下拉\n   */\n  function showOperators() {\n    var point = getCursorPosition();\n    if (operatorsRef.current) {\n      operatorsRef.current.style.left = \"\".concat(point.x + 10, \"px\");\n      operatorsRef.current.style.top = \"\".concat(point.y + 25, \"px\");\n    }\n    setOperatorsShow(true, function () {});\n  }\n  /**\n   * hideOperators\n   * @description 关闭运算符选择下拉\n   */\n  function hideOperators() {\n    setOperatorsShow(false);\n  }\n  /**\n   * showQuickTip\n   */\n  function showQuickTip() {\n    setQuickTipShow(true);\n  }\n  /**\n   * hideOperators\n   * @description 关闭运算符选择下拉\n   */\n  function hideQuickTip() {\n    setQuickTipShow(false);\n  }\n  /**\n   * showPlaceholder\n   * @description 显示placeholder\n   */\n  function showPlaceholder() {\n    setPlaceholderShow(true);\n  }\n  /**\n   * hidePlaceholder\n   * @description 隐藏placeholder\n   */\n  function hidePlaceholder() {\n    setPlaceholderShow(false);\n  }\n  /**\n   * createTextElement\n   * @description 创建文本元素\n   * @param {string} html 文本的内容\n   * @return {HTMLSpanElement}\n   */\n  function createTextElement(html) {\n    var textElement = document.createElement('span');\n    textElement.className = classNames('text', textClassName !== null && textClassName !== void 0 ? textClassName : '');\n    textElement.innerHTML = html;\n    return textElement;\n  }\n  /**\n   * createOperatorElement\n   * @description 创建运算符元素\n   * @param {string} text 元素的文本\n   * @return {HTMLSpanElement}\n   */\n  function createOperatorElement(text) {\n    var operatorElement = document.createElement('span');\n    operatorElement.className = classNames('operator', operatorClassName !== null && operatorClassName !== void 0 ? operatorClassName : '');\n    operatorElement.setAttribute('contenteditable', 'false');\n    operatorElement.innerText = text;\n    return operatorElement;\n  }\n  /**\n   * isFont\n   * @description 是否是font元素\n   * @return {boolean}\n   */\n  function isFont() {\n    var _a, _b, _c, _d;\n    return ((_d = (_c = (_b = (_a = editorRef === null || editorRef === void 0 ? void 0 : editorRef.current) === null || _a === void 0 ? void 0 : _a.firstElementChild) === null || _b === void 0 ? void 0 : _b.tagName) === null || _c === void 0 ? void 0 : _c.toLowerCase) === null || _d === void 0 ? void 0 : _d.call(_c)) === 'font';\n  }\n  /**\n   * setContinuousText\n   * @description 设置连续输入的字符\n   * @param {string} text 当前输入的文本\n   */\n  function setContinuousText(text) {\n    if (!preCursorContextElement.current || preCursorContextElement.current === cursorContextElement.current && preCursorIndex.current + 1 === cursorIndex.current) {\n      preCursorIndex.current = cursorIndex.current;\n      preCursorContextElement.current = cursorContextElement.current;\n      continuousText.current += text;\n    } else {\n      preCursorIndex.current = cursorIndex.current;\n      preCursorContextElement.current = cursorContextElement.current;\n      continuousText.current = text;\n    }\n  }\n  /**\n   * onEditorCompositionStart\n   * @description 编辑框输入中文开始\n   */\n  function onEditorCompositionStart() {\n    comStart.current = true;\n    // console.log('中文输入：开始');\n  }\n  /**\n   * onEditorCompositionEnd\n   * @description 编辑框输入中文结束\n   * @param e\n   */\n  function onEditorCompositionEnd(e) {\n    comStart.current = false;\n    // console.log('中文输入：结束');\n    onEditorInput(e);\n  }\n  /**\n   * onEditorInput\n   * @description 编辑框input\n   */\n  function onEditorInput(e) {\n    var _a;\n    if (comStart.current) return; // 中文输入过程中不截断\n    if (cursorContextElement) {\n      cursorContextElement.current = getCurrentElementWithCursor();\n    }\n    if (cursorContextParentElement) {\n      cursorContextParentElement.current = getCurrentParentElementWithCursor();\n    }\n    cursorIndex.current = getCursorIndex();\n    if (isEditorEmpty()) {\n      showPlaceholder();\n    } else {\n      hidePlaceholder();\n    }\n    var text = e.nativeEvent.data;\n    if (text !== null) {\n      setContinuousText(text);\n      if (!disableQuickTip) {\n        onContinuousTextChange === null || onContinuousTextChange === void 0 ? void 0 : onContinuousTextChange(continuousText.current);\n      }\n    }\n    if (!disableQuickTip) {\n      if (text !== triggerChar) {\n        showQuickTip();\n      }\n    }\n    // input输入结束\n    if (text !== triggerChar) {\n      onEditorInputEnd === null || onEditorInputEnd === void 0 ? void 0 : onEditorInputEnd(text, continuousText.current);\n    }\n    // onChange\n    onChange === null || onChange === void 0 ? void 0 : onChange((_a = editorRef === null || editorRef === void 0 ? void 0 : editorRef.current) === null || _a === void 0 ? void 0 : _a.innerHTML);\n  }\n  /**\n   * onEditorPaste\n   * @description 编辑框粘贴\n   * @param e\n   */\n  function onEditorPaste(e) {\n    // 禁止粘贴内容\n    e.preventDefault();\n    onEditorPasteEnd === null || onEditorPasteEnd === void 0 ? void 0 : onEditorPasteEnd(e);\n  }\n  /**\n   * onEditorKeyDown\n   * @description 编辑框keyDown\n   * @param e\n   * @return {boolean}\n   */\n  function onEditorKeyDown(e) {\n    // 默认空格\n    if (e.keyCode === (triggerCharCode !== null && triggerCharCode !== void 0 ? triggerCharCode : defaultTriggerCharCode)) {\n      hideQuickTip();\n      showOperators();\n      onEditorKeyDownEnd === null || onEditorKeyDownEnd === void 0 ? void 0 : onEditorKeyDownEnd(e);\n      return false;\n    }\n    // 屏蔽回车操作\n    if (e.keyCode === 13) {\n      hideOperators();\n      e.stopPropagation();\n      e.preventDefault();\n      onEditorKeyDownEnd === null || onEditorKeyDownEnd === void 0 ? void 0 : onEditorKeyDownEnd(e);\n      return false;\n    }\n    hideOperators();\n    onEditorKeyDownEnd === null || onEditorKeyDownEnd === void 0 ? void 0 : onEditorKeyDownEnd(e);\n  }\n  /**\n   * onEditorBlur\n   * @description 编辑框失去焦点\n   */\n  function onEditorBlur(e) {\n    e.stopPropagation();\n    e.preventDefault();\n    if (isEditorEmpty()) {\n      showPlaceholder();\n    } else {\n      hidePlaceholder();\n    }\n    onEditorBlurEnd === null || onEditorBlurEnd === void 0 ? void 0 : onEditorBlurEnd(e);\n  }\n  /**\n   * onOperatorsClick\n   * @description 选择运算符\n   * @param {string} operator\n   * @param {OperatorType} operatorType\n   */\n  function onOperatorsClick(operator, operatorType) {\n    var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u, _v, _w, _x, _y;\n    if (operator) {\n      var editor = getEditorEl();\n      // 括号\n      if (operatorType === 'brackets') {\n        var left = operator[0];\n        var right = operator[1];\n        var leftElement = createOperatorElement(left);\n        var rightElement = createOperatorElement(right);\n        var textElement = createTextElement(\"\".concat(htmlSpace).concat(htmlSpace));\n        // 如果是在editor的文本中进行的编辑\n        if (cursorContextParentElement.current === editor) {\n          var text = (_a = cursorContextElement === null || cursorContextElement === void 0 ? void 0 : cursorContextElement.current) === null || _a === void 0 ? void 0 : _a.textContent;\n          var startElement = createTextElement((_b = text === null || text === void 0 ? void 0 : text.substring) === null || _b === void 0 ? void 0 : _b.call(text, 0, cursorIndex.current + 1));\n          var endElement = createTextElement((_c = text === null || text === void 0 ? void 0 : text.substring) === null || _c === void 0 ? void 0 : _c.call(text, cursorIndex.current + 1));\n          var df = document.createDocumentFragment();\n          df.appendChild(startElement);\n          df.appendChild(leftElement);\n          df.appendChild(textElement);\n          df.appendChild(rightElement);\n          if (endElement && endElement.textContent) {\n            endElement.textContent.length !== 0 && df.appendChild(endElement);\n          }\n          (_d = editor === null || editor === void 0 ? void 0 : editor.replaceChild) === null || _d === void 0 ? void 0 : _d.call(editor, df, cursorContextElement.current);\n          setCursorPosition(textElement, 1);\n        }\n        // 如果是在text文本中进行的编辑\n        else {\n          var text = (_e = cursorContextElement === null || cursorContextElement === void 0 ? void 0 : cursorContextElement.current) === null || _e === void 0 ? void 0 : _e.textContent;\n          var startElement = createTextElement((_f = text === null || text === void 0 ? void 0 : text.substring) === null || _f === void 0 ? void 0 : _f.call(text, 0, cursorIndex.current));\n          var endElement = createTextElement((_g = text === null || text === void 0 ? void 0 : text.substring) === null || _g === void 0 ? void 0 : _g.call(text, cursorIndex.current));\n          var df = document.createDocumentFragment();\n          df.appendChild(startElement);\n          df.appendChild(startElement);\n          df.appendChild(leftElement);\n          df.appendChild(textElement);\n          df.appendChild(rightElement);\n          if (endElement && endElement.textContent) {\n            endElement.textContent.length !== 0 && df.appendChild(endElement);\n          }\n          (_k = (_j = (_h = cursorContextParentElement === null || cursorContextParentElement === void 0 ? void 0 : cursorContextParentElement.current) === null || _h === void 0 ? void 0 : _h.parentElement) === null || _j === void 0 ? void 0 : _j.replaceChild) === null || _k === void 0 ? void 0 : _k.call(_j, df, cursorContextParentElement.current);\n          setCursorPosition(textElement, 1);\n        }\n      }\n      // 其他符号\n      else {\n        var operatorElement = createOperatorElement(operator);\n        var textElement = createTextElement(htmlSpace);\n        // 如果是在editor的文本中进行的编辑\n        if (cursorContextParentElement.current === editor) {\n          // 光标所在的元素现在是text元素\n          // let parentElement = getInsertParentElement();\n          // parentElement.appendChild(operatorElement);\n          // parentElement.appendChild(textElement);\n          // setCursorToEnd(parentElement);\n          var text = (_l = cursorContextElement === null || cursorContextElement === void 0 ? void 0 : cursorContextElement.current) === null || _l === void 0 ? void 0 : _l.textContent;\n          var startElement = createTextElement((_m = text === null || text === void 0 ? void 0 : text.substring) === null || _m === void 0 ? void 0 : _m.call(text, 0, cursorIndex.current + 1));\n          var endElement = createTextElement((_o = text === null || text === void 0 ? void 0 : text.substring) === null || _o === void 0 ? void 0 : _o.call(text, cursorIndex.current + 1));\n          var df = document.createDocumentFragment();\n          df.appendChild(startElement);\n          df.appendChild(operatorElement);\n          df.appendChild(textElement);\n          if (endElement && endElement.textContent) {\n            endElement.textContent.length !== 0 && df.appendChild(endElement);\n          }\n          editor === null || editor === void 0 ? void 0 : editor.replaceChild(df, cursorContextElement.current);\n          setCursorPosition(textElement, 0);\n        }\n        // 如果是在text文本中进行的编辑\n        // @ts-ignore\n        else if ((_r = (_q = (_p = cursorContextParentElement === null || cursorContextParentElement === void 0 ? void 0 : cursorContextParentElement.current) === null || _p === void 0 ? void 0 : _p.classList) === null || _q === void 0 ? void 0 : _q.contains) === null || _r === void 0 ? void 0 : _r.call(_q, 'text')) {\n          var text = (_s = cursorContextElement === null || cursorContextElement === void 0 ? void 0 : cursorContextElement.current) === null || _s === void 0 ? void 0 : _s.textContent;\n          var startElement = createTextElement((_t = text === null || text === void 0 ? void 0 : text.substring) === null || _t === void 0 ? void 0 : _t.call(text, 0, cursorIndex.current));\n          var endElement = createTextElement((_u = text === null || text === void 0 ? void 0 : text.substring) === null || _u === void 0 ? void 0 : _u.call(text, cursorIndex.current));\n          var df = document.createDocumentFragment();\n          df.appendChild(startElement);\n          df.appendChild(operatorElement);\n          df.appendChild(textElement);\n          if (endElement && endElement.textContent) {\n            endElement.textContent.length !== 0 && df.appendChild(endElement);\n          }\n          (_x = (_w = (_v = cursorContextParentElement === null || cursorContextParentElement === void 0 ? void 0 : cursorContextParentElement.current) === null || _v === void 0 ? void 0 : _v.parentElement) === null || _w === void 0 ? void 0 : _w.replaceChild) === null || _x === void 0 ? void 0 : _x.call(_w, df, cursorContextParentElement.current);\n          setCursorPosition(textElement, 0);\n        }\n      }\n      onChange === null || onChange === void 0 ? void 0 : onChange((_y = editorRef === null || editorRef === void 0 ? void 0 : editorRef.current) === null || _y === void 0 ? void 0 : _y.innerHTML);\n    }\n    hideOperators();\n  }\n  /**\n   * onQuickTipClick\n   * @description 选额智能提示\n   * @param e\n   * @param item\n   */\n  function onQuickTipClick(e, item) {\n    var _a, _b, _c, _d;\n    var tip = item[quickTipProp !== null && quickTipProp !== void 0 ? quickTipProp : 'value'];\n    var editor = getEditorEl();\n    // java\n    if (tip) {\n      // 111\n      var text = ((_a = cursorContextElement.current) === null || _a === void 0 ? void 0 : _a.textContent) || '';\n      var startIndex = text.lastIndexOf(continuousText.current, preCursorIndex.current);\n      // 111(java) -> 111java\n      // (java)111 -> java111\n      // 1(java)11 -> 1java11\n      var endIndex = startIndex + continuousText.current.length;\n      var df_1 = document.createDocumentFragment();\n      var startTextNode = document.createTextNode(text.substring(0, startIndex));\n      var endTextNode = document.createTextNode(text.substring(endIndex));\n      var collapseEl = document.createElement('div');\n      collapseEl.innerHTML = tip;\n      df_1.appendChild(startTextNode);\n      Array.from(collapseEl.childNodes).forEach(function (el) {\n        df_1.appendChild(el);\n      });\n      df_1.appendChild(endTextNode);\n      if (contextRef.current === cursorContextParentElement.current) {\n        editor.innerHTML = '';\n        editor.appendChild(df_1);\n      } else if (editor === cursorContextParentElement.current) {\n        if ((_b = cursorContextElement === null || cursorContextElement === void 0 ? void 0 : cursorContextElement.current) === null || _b === void 0 ? void 0 : _b.parentElement) {\n          cursorContextElement.current.parentElement.replaceChild(df_1, cursorContextElement.current);\n        }\n      } else {\n        if ((_c = cursorContextParentElement === null || cursorContextParentElement === void 0 ? void 0 : cursorContextParentElement.current) === null || _c === void 0 ? void 0 : _c.parentElement) {\n          cursorContextParentElement.current.parentElement.replaceChild(df_1, cursorContextParentElement.current);\n        }\n      }\n      setCursorPositionToNode(endTextNode, 0);\n      onChange === null || onChange === void 0 ? void 0 : onChange((_d = editorRef === null || editorRef === void 0 ? void 0 : editorRef.current) === null || _d === void 0 ? void 0 : _d.innerHTML);\n    }\n    hideQuickTip();\n    hidePlaceholder();\n  }\n  // 获取插入的父元素\n  // function getInsertParentElement() {\n  //   return cursorContextParentElement.current === editor.current\n  //     ? cursorContextParentElement.current\n  //     : cursorContextParentElement.current.parentElement;\n  // }\n  return /*#__PURE__*/React.createElement(\"div\", {\n    ref: contextRef,\n    className: classNames(selectorPrefix, className !== null && className !== void 0 ? className : ''),\n    style: style !== null && style !== void 0 ? style : {}\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    ref: editorRef,\n    className: classNames(\"\".concat(selectorPrefix, \"-editor\"), editorClassName !== null && editorClassName !== void 0 ? editorClassName : ''),\n    style: editorStyle !== null && editorStyle !== void 0 ? editorStyle : {},\n    contentEditable: \"true\",\n    onInput: onEditorInput,\n    onKeyDown: onEditorKeyDown,\n    onBlur: onEditorBlur,\n    onCompositionStart: onEditorCompositionStart,\n    onCompositionEnd: onEditorCompositionEnd,\n    onPaste: onEditorPaste\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: classNames(\"\".concat(selectorPrefix, \"-editor-placeholder\"), (_b = {}, _b[\"\".concat(selectorPrefix, \"-editor-placeholder--show\")] = placeholderShow, _b)),\n    ref: placeholderRef\n  }, placeholder !== null && placeholder !== void 0 ? placeholder : Intl.v('请输入关键词')), /*#__PURE__*/React.createElement(\"ul\", {\n    ref: operatorsRef,\n    className: classNames(\"\".concat(selectorPrefix, \"-operators\"), operatorWrapClassName !== null && operatorWrapClassName !== void 0 ? operatorWrapClassName : '', (_c = {}, _c[\"\".concat(selectorPrefix, \"-operators--show\")] = operatorsShow, _c)),\n    style: operatorWrapStyle !== null && operatorWrapStyle !== void 0 ? operatorWrapStyle : {}\n  }, /*#__PURE__*/React.createElement(\"li\", null, /*#__PURE__*/React.createElement(\"i\", {\n    onClick: function onClick() {\n      return hideOperators();\n    }\n  }, /*#__PURE__*/React.createElement(_CloseCircleOutlined, {\n    rev: null\n  }))), operatorsConfig.map(function (_a) {\n    var label = _a.label,\n      value = _a.value,\n      type = _a.type;\n    return /*#__PURE__*/React.createElement(\"li\", {\n      key: value,\n      onClick: function onClick() {\n        onOperatorsClick(value, type);\n      }\n    }, label);\n  })), /*#__PURE__*/React.createElement(\"ul\", {\n    ref: quickTipRef,\n    className: classNames(\"\".concat(selectorPrefix, \"-quick-tips\"), quickTipWrapClassName !== null && quickTipWrapClassName !== void 0 ? quickTipWrapClassName : '', (_d = {}, _d[\"\".concat(selectorPrefix, \"-quick-tips--show\")] = quickTipShow, _d)),\n    style: quickTipWrapStyle !== null && quickTipWrapStyle !== void 0 ? quickTipWrapStyle : {}\n  }, /*#__PURE__*/React.createElement(\"li\", null, /*#__PURE__*/React.createElement(\"i\", {\n    onClick: function onClick() {\n      return hideQuickTip();\n    }\n  }, /*#__PURE__*/React.createElement(_CloseCircleOutlined, {\n    rev: null\n  }))), !(quickTipDataSource || []).length && /*#__PURE__*/React.createElement(\"li\", null, /*#__PURE__*/React.createElement(_Empty, null)), !!(quickTipDataSource || []).length && (quickTipDataSource || []).map(function (t, _index) {\n    return /*#__PURE__*/React.createElement(\"li\", {\n      key: t.value,\n      onClick: function onClick(e) {\n        return onQuickTipClick(e, t);\n      }\n    }, t.label);\n  })));\n};\nvar Wrap = /*#__PURE__*/memo( /*#__PURE__*/forwardRef(Expression));\n// @ts-ignore\nWrap.View = View;\n/**\n * parse\n * @description 解析\n * @param {string} queryHtml\n * @param {(value: { nodeType: number; value: string | null }) => string} callback\n * @return {string}\n */\n// @ts-ignore\nWrap.parse = function (queryHtml, callback) {\n  var _a, _b;\n  if (!queryHtml) return '';\n  var context = document.createElement('div');\n  context.innerHTML = queryHtml;\n  if (((_b = (_a = context === null || context === void 0 ? void 0 : context.firstElementChild) === null || _a === void 0 ? void 0 : _a.tagName) === null || _b === void 0 ? void 0 : _b.toLowerCase()) === 'font') {\n    context.innerHTML = context.firstElementChild.innerHTML;\n  }\n  var result = '';\n  result = Array.from(context.childNodes).map(function (node) {\n    var _a, _b, _c;\n    // 元素节点\n    if (node.nodeType === 1) {\n      // 文本节点\n      if (node.classList.contains('text')) {\n        return (_a = callback === null || callback === void 0 ? void 0 : callback({\n          nodeType: 3,\n          value: node.textContent\n        })) !== null && _a !== void 0 ? _a : '';\n      }\n      // 运算符\n      else if (node.classList.contains('operator')) {\n        return (_b = callback === null || callback === void 0 ? void 0 : callback({\n          nodeType: 1,\n          value: node.textContent\n        })) !== null && _b !== void 0 ? _b : '';\n      }\n    }\n    // 文本节点\n    else if (node.nodeType === 3) {\n      return (_c = callback === null || callback === void 0 ? void 0 : callback({\n        nodeType: 3,\n        value: node.textContent\n      })) !== null && _c !== void 0 ? _c : '';\n    }\n    return '';\n  }).join('');\n  return result;\n};\n/**\n * validator\n * @return {{validator(*, *): (Promise<void>)}}\n */\n// @ts-ignore\nWrap.validator = function () {\n  return {\n    validator: function validator(_, value) {\n      var context = document.createElement('div');\n      context.innerHTML = value;\n      if (context.innerText) {\n        return Promise.resolve();\n      }\n      return Promise.reject(new Error(Intl.v('请输入关键字')));\n    }\n  };\n};\nexport default Wrap;"],"names":["_Empty","_CloseCircleOutlined","useMount","useUpdateLayoutEffect","classNames","React","forwardRef","memo","useImperativeHandle","useMemo","useRef","Hooks","Util","Intl","View","getCurrentParentElementWithCursor","getCurrentElementWithCursor","setCursorToEnd","setCursorPositionToNode","setCursorPosition","getCursorIndex","defaultTriggerCharCode","htmlSpace","useSetState","selectorPrefix","Expression","_a","ref","className","style","editorClassName","editorStyle","operatorWrapClassName","operatorWrapStyle","quickTipWrapClassName","quickTipWrapStyle","textClassName","operatorClassName","value","placeholder","triggerCharCode","quickTipProp","quickTipDataSource","disableQuickTip","operators","onChange","onContinuousTextChange","onEditorInputEnd","onEditorBlurEnd","onEditorKeyDownEnd","onEditorPasteEnd","operatorsConfig","label","type","contextRef","editorRef","operatorsRef","quickTipRef","placeholderRef","cursorContextParentElement","cursorContextElement","cursorIndex","preCursorIndex","preCursorContextElement","continuousText","comStart","_e","operatorsShow","setOperatorsShow","_f","quickTipShow","setQuickTipShow","_g","placeholderShow","setPlaceholderShow","triggerChar","String","fromCharCode","onReady","isEditorEmpty","showPlaceholder","hidePlaceholder","getEditorEl","_c","_d","_b","current","firstElementChild","tagName","toLowerCase","call","innerHTML","trim","showOperators","y","x","window","getSelection","selection","rangeCount","rect","getRangeAt","getBoundingClientRect","left","top","point","concat","hideOperators","showQuickTip","hideQuickTip","createTextElement","html","textElement","document","createElement","createOperatorElement","text","operatorElement","setAttribute","innerText","onEditorInput","e","nativeEvent","data","editor","setValue","_value","getValue","contentEditable","onInput","onKeyDown","keyCode","stopPropagation","preventDefault","onBlur","onCompositionStart","onCompositionEnd","onPaste","v","onClick","rev","map","key","operator","operatorType","rightElement","startElement","endElement","df","right","leftElement","textContent","substring","createDocumentFragment","appendChild","length","replaceChild","_k","_j","_h","parentElement","_m","_l","_o","_r","_q","_p","classList","contains","_t","_s","_u","_x","_w","_v","_y","t","_index","tip","item","endIndex","startIndex","lastIndexOf","df_1","startTextNode","createTextNode","endTextNode","collapseEl","Array","from","childNodes","forEach","el","Wrap","parse","queryHtml","callback","context","node","nodeType","join","validator","_","Promise","resolve","reject","Error"],"mappings":"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"}