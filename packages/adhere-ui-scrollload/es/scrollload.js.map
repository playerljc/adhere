{"version":3,"file":"scrollload.js","sources":["scrollload.js"],"sourcesContent":["var __assign = (this && this.__assign) || function () {\r\n    __assign = Object.assign || function(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n                t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\nimport React, { forwardRef, useImperativeHandle, useRef, useLayoutEffect, } from 'react';\r\nimport classNames from 'classnames';\r\nimport Intl from '@baifendian/adhere-util-intl';\r\nvar selectorPrefix = 'adhere-ui-scrollload';\r\nvar EMPTY = 'empty';\r\nvar ERROR = 'error';\r\nvar NORMAL = 'normal';\r\nvar ScrollLoad = function (props, ref) {\r\n    var _a = props.className, className = _a === void 0 ? '' : _a, _b = props.style, style = _b === void 0 ? {} : _b, children = props.children, getScrollContainer = props.getScrollContainer, _c = props.distance, distance = _c === void 0 ? 50 : _c, onScrollBottom = props.onScrollBottom, onEmptyClick = props.onEmptyClick, onErrorClick = props.onErrorClick, renderLoading = props.renderLoading, _d = props.loadClassName, loadClassName = _d === void 0 ? '' : _d, _e = props.loadStyle, loadStyle = _e === void 0 ? {} : _e, renderEmpty = props.renderEmpty, _f = props.emptyClassName, emptyClassName = _f === void 0 ? '' : _f, _g = props.emptyStyle, emptyStyle = _g === void 0 ? {} : _g, renderError = props.renderError, _h = props.errorClassName, errorClassName = _h === void 0 ? '' : _h, _j = props.errorStyle, errorStyle = _j === void 0 ? {} : _j;\r\n    var lock = useRef(false); // 锁\r\n    var el = useRef(null);\r\n    var loadEl = useRef(null);\r\n    var emptyEl = useRef(null);\r\n    var errorEl = useRef(null);\r\n    function _getScrollContainer() {\r\n        return getScrollContainer ? getScrollContainer() : el.current;\r\n    }\r\n    function initEvents() {\r\n        var _a, _b, _c;\r\n        (_a = _getScrollContainer()) === null || _a === void 0 ? void 0 : _a.addEventListener('scroll', _onScroll);\r\n        (_b = emptyEl.current) === null || _b === void 0 ? void 0 : _b.addEventListener('click', _onEmptyClick);\r\n        (_c = errorEl.current) === null || _c === void 0 ? void 0 : _c.addEventListener('click', _onErrorClick);\r\n    }\r\n    function removeEvents() {\r\n        var _a, _b, _c;\r\n        (_a = _getScrollContainer()) === null || _a === void 0 ? void 0 : _a.removeEventListener('scroll', _onScroll);\r\n        (_b = emptyEl.current) === null || _b === void 0 ? void 0 : _b.removeEventListener('click', _onEmptyClick);\r\n        (_c = errorEl.current) === null || _c === void 0 ? void 0 : _c.removeEventListener('click', _onErrorClick);\r\n    }\r\n    function _onScroll() {\r\n        var el = _getScrollContainer();\r\n        var bottomHeight = el.scrollHeight - el.offsetHeight;\r\n        var scrollTop = el.scrollTop;\r\n        /**\r\n         * 条件完全相等或误差值在1之间\r\n         */\r\n        if (onScrollBottom && Math.abs(scrollTop - bottomHeight) <= distance) {\r\n            if (lock.current)\r\n                return;\r\n            lock.current = true;\r\n            // 先显示loading\r\n            loadEl.current.style.display = 'flex';\r\n            /**\r\n             * 完成\r\n             * @param {string} status [empty(没有数据) | error(有错误) | normal(正常)]\r\n             */\r\n            onScrollBottom(function (status) {\r\n                loadEl.current.style.display = 'none';\r\n                if (status === EMPTY) {\r\n                    emptyEl.current.style.display = 'block';\r\n                }\r\n                else if (status === ERROR) {\r\n                    errorEl.current.style.display = 'block';\r\n                }\r\n                lock.current = false;\r\n            });\r\n        }\r\n    }\r\n    function _onEmptyClick() {\r\n        onEmptyClick && onEmptyClick();\r\n    }\r\n    function _onErrorClick() {\r\n        onErrorClick && onErrorClick();\r\n    }\r\n    /**\r\n     * hideAll\r\n     */\r\n    function hideAll() {\r\n        loadEl.current.style.display = 'none';\r\n        errorEl.current.style.display = 'none';\r\n        emptyEl.current.style.display = 'none';\r\n    }\r\n    function _renderLoading() {\r\n        if (renderLoading) {\r\n            return (React.createElement(\"div\", { className: classNames(selectorPrefix + \"-load\", loadClassName || ''), style: __assign({}, loadStyle), ref: loadEl }, renderLoading()));\r\n        }\r\n        return (React.createElement(\"div\", { className: classNames(selectorPrefix + \"-load\", 'standard', loadClassName || ''), style: loadStyle || {}, ref: loadEl }, Intl.v('数据加载中')));\r\n    }\r\n    function _renderEmpty() {\r\n        if (renderEmpty) {\r\n            return (React.createElement(\"div\", { className: classNames(selectorPrefix + \"-empty\", emptyClassName || ''), style: emptyStyle || {}, ref: emptyEl }, renderEmpty()));\r\n        }\r\n        return (React.createElement(\"div\", { className: classNames(selectorPrefix + \"-empty\", emptyClassName || ''), style: emptyStyle || {}, ref: emptyEl },\r\n            \"~\",\r\n            Intl.v('没有更多')));\r\n    }\r\n    function _renderError() {\r\n        if (renderError) {\r\n            return (React.createElement(\"div\", { className: classNames(selectorPrefix + \"-error\", errorClassName || ''), style: errorStyle || {}, ref: errorEl }, renderError()));\r\n        }\r\n        return (React.createElement(\"div\", { className: classNames(selectorPrefix + \"-error\", errorClassName || ''), style: errorStyle || {}, ref: errorEl }, Intl.v('出现错误')));\r\n    }\r\n    useImperativeHandle(ref, function () { return ({\r\n        hideAll: hideAll,\r\n    }); });\r\n    useLayoutEffect(function () {\r\n        initEvents();\r\n        return function () { return removeEvents(); };\r\n    });\r\n    return (React.createElement(\"div\", { className: classNames(selectorPrefix, className || ''), style: __assign(__assign({}, (style || {})), { overflowY: _getScrollContainer() === el.current ? 'auto' : 'initial' }), ref: el },\r\n        children,\r\n        _renderLoading(),\r\n        _renderEmpty(),\r\n        _renderError()));\r\n};\r\n// @ts-ignore\r\nvar ScrollLoadHOC = forwardRef(ScrollLoad);\r\nScrollLoadHOC.EMPTY = 'empty';\r\nScrollLoadHOC.ERROR = 'error';\r\nScrollLoadHOC.NORMAL = 'normal';\r\nexport default ScrollLoadHOC;\r\n"],"names":["__assign","this","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","React","forwardRef","useImperativeHandle","useRef","useLayoutEffect","classNames","Intl","selectorPrefix","EMPTY","ERROR","NORMAL","ScrollLoad","props","ref","_a","className","_b","style","children","getScrollContainer","_c","distance","onScrollBottom","onEmptyClick","onErrorClick","renderLoading","_d","loadClassName","_e","loadStyle","renderEmpty","_f","emptyClassName","_g","emptyStyle","renderError","_h","errorClassName","_j","errorStyle","lock","el","loadEl","emptyEl","errorEl","_getScrollContainer","current","_onScroll","bottomHeight","scrollHeight","offsetHeight","scrollTop","Math","abs","display","status","_onEmptyClick","_onErrorClick","hideAll","addEventListener","removeEventListener","createElement","overflowY","v","ScrollLoadHOC"],"mappings":"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"}