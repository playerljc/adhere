{"version":3,"file":"ScrollLoad.js","sources":["ScrollLoad.js"],"sourcesContent":["var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nimport { useUpdateEffect } from 'ahooks';\nimport classNames from 'classnames';\nimport React, { forwardRef, memo, useCallback, useImperativeHandle, useLayoutEffect, useRef, } from 'react';\nimport Intl from '@baifendian/adhere-util-intl';\nvar selectorPrefix = 'adhere-ui-scroll-load';\nvar EMPTY = 'empty';\nvar HIDE_EMPTY = 'hide_empty';\nvar ERROR = 'error';\nvar NORMAL = 'normal';\nvar InternalScrollLoad = memo(forwardRef(function (props, ref) {\n    var _a = props.className, className = _a === void 0 ? '' : _a, _b = props.style, style = _b === void 0 ? {} : _b, _c = props.loadClassName, loadClassName = _c === void 0 ? '' : _c, _d = props.loadStyle, loadStyle = _d === void 0 ? {} : _d, _e = props.emptyClassName, emptyClassName = _e === void 0 ? '' : _e, _f = props.emptyStyle, emptyStyle = _f === void 0 ? {} : _f, _g = props.errorClassName, errorClassName = _g === void 0 ? '' : _g, _h = props.errorStyle, errorStyle = _h === void 0 ? {} : _h, getScrollContainer = props.getScrollContainer, _j = props.distance, distance = _j === void 0 ? 50 : _j, renderLoading = props.renderLoading, renderEmpty = props.renderEmpty, renderError = props.renderError, onScrollBottom = props.onScrollBottom, onEmptyClick = props.onEmptyClick, onErrorClick = props.onErrorClick, _k = props.disabled, disabled = _k === void 0 ? false : _k, children = props.children, attrs = __rest(props, [\"className\", \"style\", \"loadClassName\", \"loadStyle\", \"emptyClassName\", \"emptyStyle\", \"errorClassName\", \"errorStyle\", \"getScrollContainer\", \"distance\", \"renderLoading\", \"renderEmpty\", \"renderError\", \"onScrollBottom\", \"onEmptyClick\", \"onErrorClick\", \"disabled\", \"children\"]);\n    var currentStatus = useRef(NORMAL);\n    var lock = useRef(false); // 锁\n    var el = useRef(null);\n    var loadEl = useRef(null);\n    var emptyEl = useRef(null);\n    var errorEl = useRef(null);\n    function _getScrollContainer() {\n        return getScrollContainer ? getScrollContainer() : el.current;\n    }\n    function initEvents() {\n        var _a, _b, _c;\n        if (!disabled) {\n            (_a = _getScrollContainer()) === null || _a === void 0 ? void 0 : _a.addEventListener('scroll', _onScroll);\n        }\n        (_b = emptyEl.current) === null || _b === void 0 ? void 0 : _b.addEventListener('click', _onEmptyClick);\n        (_c = errorEl.current) === null || _c === void 0 ? void 0 : _c.addEventListener('click', _onErrorClick);\n    }\n    function removeEvents() {\n        var _a, _b, _c;\n        if (!disabled) {\n            (_a = _getScrollContainer()) === null || _a === void 0 ? void 0 : _a.removeEventListener('scroll', _onScroll);\n        }\n        (_b = emptyEl.current) === null || _b === void 0 ? void 0 : _b.removeEventListener('click', _onEmptyClick);\n        (_c = errorEl.current) === null || _c === void 0 ? void 0 : _c.removeEventListener('click', _onErrorClick);\n    }\n    function _onScroll() {\n        var el = _getScrollContainer();\n        var bottomHeight = el.scrollHeight - el.offsetHeight;\n        var scrollTop = el.scrollTop;\n        /**\n         * 条件完全相等或误差值在1之间\n         */\n        if (onScrollBottom && Math.abs(scrollTop - bottomHeight) <= distance) {\n            if ([EMPTY, HIDE_EMPTY].includes(currentStatus.current))\n                return;\n            if (lock.current)\n                return;\n            lock.current = true;\n            // 先显示loading\n            loadEl.current.style.display = 'flex';\n            /**\n             * 完成\n             * @param {string} status [empty(没有数据) | error(有错误) | normal(正常)]\n             */\n            onScrollBottom(function (status) {\n                currentStatus.current = status;\n                loadEl.current.style.display = 'none';\n                if (currentStatus.current === EMPTY) {\n                    emptyEl.current.style.display = 'block';\n                }\n                else if (currentStatus.current === ERROR) {\n                    errorEl.current.style.display = 'block';\n                }\n                else if (currentStatus.current === HIDE_EMPTY) {\n                    emptyEl.current.style.display = 'none';\n                }\n                lock.current = false;\n            });\n        }\n    }\n    function _onEmptyClick() {\n        onEmptyClick && onEmptyClick();\n    }\n    function _onErrorClick() {\n        onErrorClick && onErrorClick();\n    }\n    /**\n     * hideAll\n     */\n    function hideAll() {\n        currentStatus.current = NORMAL;\n        loadEl.current.style.display = 'none';\n        errorEl.current.style.display = 'none';\n        emptyEl.current.style.display = 'none';\n    }\n    var _renderLoading = useCallback(function () {\n        if (renderLoading) {\n            return (React.createElement(\"div\", { className: classNames(\"\".concat(selectorPrefix, \"-load\"), loadClassName), style: loadStyle !== null && loadStyle !== void 0 ? loadStyle : {}, ref: loadEl }, renderLoading()));\n        }\n        return (React.createElement(\"div\", { className: classNames(\"\".concat(selectorPrefix, \"-load\"), 'standard', loadClassName), style: loadStyle !== null && loadStyle !== void 0 ? loadStyle : {}, ref: loadEl }, Intl.v('数据加载中')));\n    }, [renderLoading, loadClassName, loadStyle]);\n    var _renderEmpty = useCallback(function () {\n        if (renderEmpty) {\n            return (React.createElement(\"div\", { className: classNames(\"\".concat(selectorPrefix, \"-empty\"), emptyClassName), style: emptyStyle !== null && emptyStyle !== void 0 ? emptyStyle : {}, ref: emptyEl }, renderEmpty()));\n        }\n        return (React.createElement(\"div\", { className: classNames(\"\".concat(selectorPrefix, \"-empty\"), emptyClassName), style: emptyStyle !== null && emptyStyle !== void 0 ? emptyStyle : {}, ref: emptyEl },\n            \"~\",\n            Intl.v('没有更多')));\n    }, [renderEmpty, emptyClassName, emptyStyle]);\n    var _renderError = useCallback(function () {\n        if (renderError) {\n            return (React.createElement(\"div\", { className: classNames(\"\".concat(selectorPrefix, \"-error\"), errorClassName), style: errorStyle !== null && errorStyle !== void 0 ? errorStyle : {}, ref: errorEl }, renderError()));\n        }\n        return (React.createElement(\"div\", { className: classNames(\"\".concat(selectorPrefix, \"-error\"), errorClassName), style: errorStyle !== null && errorStyle !== void 0 ? errorStyle : {}, ref: errorEl }, Intl.v('出现错误')));\n    }, [renderError, errorClassName, errorStyle]);\n    useImperativeHandle(ref, function () { return ({\n        hideAll: hideAll,\n        getScrollContainer: function () { return _getScrollContainer(); },\n    }); });\n    useLayoutEffect(function () {\n        initEvents();\n        return function () { return removeEvents(); };\n    });\n    useUpdateEffect(function () {\n        var _a, _b, _c;\n        if (disabled) {\n            (_a = _getScrollContainer()) === null || _a === void 0 ? void 0 : _a.removeEventListener('scroll', _onScroll);\n        }\n        else {\n            (_b = _getScrollContainer()) === null || _b === void 0 ? void 0 : _b.removeEventListener('scroll', _onScroll);\n            (_c = _getScrollContainer()) === null || _c === void 0 ? void 0 : _c.addEventListener('scroll', _onScroll);\n        }\n        return function () {\n            var _a;\n            (_a = _getScrollContainer()) === null || _a === void 0 ? void 0 : _a.removeEventListener('scroll', _onScroll);\n        };\n    }, [disabled]);\n    return (React.createElement(\"div\", __assign({}, attrs, { className: classNames(selectorPrefix, className), style: __assign(__assign({}, (style !== null && style !== void 0 ? style : {})), { overflowY: _getScrollContainer() === el.current ? 'auto' : 'initial' }), ref: el }),\n        children,\n        _renderLoading(),\n        _renderEmpty(),\n        _renderError()));\n}));\nvar ScrollLoad = InternalScrollLoad;\nScrollLoad.displayName = 'ScrollLoad';\nScrollLoad.EMPTY = EMPTY;\nScrollLoad.ERROR = ERROR;\nScrollLoad.NORMAL = NORMAL;\nScrollLoad.HIDE_EMPTY = HIDE_EMPTY;\nexport default ScrollLoad;\n"],"names":["__assign","this","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","__rest","e","indexOf","getOwnPropertySymbols","propertyIsEnumerable","useUpdateEffect","classNames","React","forwardRef","memo","useCallback","useImperativeHandle","useLayoutEffect","useRef","Intl","selectorPrefix","EMPTY","HIDE_EMPTY","ERROR","NORMAL","InternalScrollLoad","props","ref","_a","className","_b","style","_c","loadClassName","_d","loadStyle","_e","emptyClassName","_f","emptyStyle","_g","errorClassName","_h","errorStyle","getScrollContainer","_j","distance","renderLoading","renderEmpty","renderError","onScrollBottom","onEmptyClick","onErrorClick","_k","disabled","children","attrs","currentStatus","lock","el","loadEl","emptyEl","errorEl","_getScrollContainer","current","_onScroll","bottomHeight","scrollHeight","offsetHeight","scrollTop","Math","abs","includes","display","status","_onEmptyClick","_onErrorClick","hideAll","_renderLoading","createElement","concat","v","_renderEmpty","_renderError","addEventListener","removeEventListener","overflowY","ScrollLoad","displayName"],"mappings":"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"}