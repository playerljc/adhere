{"version":3,"file":"scrollload.js","sources":["scrollload.js"],"sourcesContent":["var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nimport classNames from 'classnames';\nimport React, { forwardRef, memo, useCallback, useImperativeHandle, useLayoutEffect, useRef, } from 'react';\nimport Intl from '@baifendian/adhere-util-intl';\nvar selectorPrefix = 'adhere-ui-scroll-load';\nvar EMPTY = 'empty';\nvar ERROR = 'error';\nvar NORMAL = 'normal';\nvar ScrollLoad = function (props, ref) {\n    var _a = props.className, className = _a === void 0 ? '' : _a, _b = props.style, style = _b === void 0 ? {} : _b, children = props.children, getScrollContainer = props.getScrollContainer, _c = props.distance, distance = _c === void 0 ? 50 : _c, onScrollBottom = props.onScrollBottom, onEmptyClick = props.onEmptyClick, onErrorClick = props.onErrorClick, renderLoading = props.renderLoading, _d = props.loadClassName, loadClassName = _d === void 0 ? '' : _d, _e = props.loadStyle, loadStyle = _e === void 0 ? {} : _e, renderEmpty = props.renderEmpty, _f = props.emptyClassName, emptyClassName = _f === void 0 ? '' : _f, _g = props.emptyStyle, emptyStyle = _g === void 0 ? {} : _g, renderError = props.renderError, _h = props.errorClassName, errorClassName = _h === void 0 ? '' : _h, _j = props.errorStyle, errorStyle = _j === void 0 ? {} : _j, attrs = __rest(props, [\"className\", \"style\", \"children\", \"getScrollContainer\", \"distance\", \"onScrollBottom\", \"onEmptyClick\", \"onErrorClick\", \"renderLoading\", \"loadClassName\", \"loadStyle\", \"renderEmpty\", \"emptyClassName\", \"emptyStyle\", \"renderError\", \"errorClassName\", \"errorStyle\"]);\n    var lock = useRef(false); // 锁\n    var el = useRef(null);\n    var loadEl = useRef(null);\n    var emptyEl = useRef(null);\n    var errorEl = useRef(null);\n    function _getScrollContainer() {\n        return getScrollContainer ? getScrollContainer() : el.current;\n    }\n    function initEvents() {\n        var _a, _b, _c;\n        (_a = _getScrollContainer()) === null || _a === void 0 ? void 0 : _a.addEventListener('scroll', _onScroll);\n        (_b = emptyEl.current) === null || _b === void 0 ? void 0 : _b.addEventListener('click', _onEmptyClick);\n        (_c = errorEl.current) === null || _c === void 0 ? void 0 : _c.addEventListener('click', _onErrorClick);\n    }\n    function removeEvents() {\n        var _a, _b, _c;\n        (_a = _getScrollContainer()) === null || _a === void 0 ? void 0 : _a.removeEventListener('scroll', _onScroll);\n        (_b = emptyEl.current) === null || _b === void 0 ? void 0 : _b.removeEventListener('click', _onEmptyClick);\n        (_c = errorEl.current) === null || _c === void 0 ? void 0 : _c.removeEventListener('click', _onErrorClick);\n    }\n    function _onScroll() {\n        var el = _getScrollContainer();\n        var bottomHeight = el.scrollHeight - el.offsetHeight;\n        var scrollTop = el.scrollTop;\n        /**\n         * 条件完全相等或误差值在1之间\n         */\n        if (onScrollBottom && Math.abs(scrollTop - bottomHeight) <= distance) {\n            if (lock.current)\n                return;\n            lock.current = true;\n            // 先显示loading\n            loadEl.current.style.display = 'flex';\n            /**\n             * 完成\n             * @param {string} status [empty(没有数据) | error(有错误) | normal(正常)]\n             */\n            onScrollBottom(function (status) {\n                loadEl.current.style.display = 'none';\n                if (status === EMPTY) {\n                    emptyEl.current.style.display = 'block';\n                }\n                else if (status === ERROR) {\n                    errorEl.current.style.display = 'block';\n                }\n                lock.current = false;\n            });\n        }\n    }\n    function _onEmptyClick() {\n        onEmptyClick && onEmptyClick();\n    }\n    function _onErrorClick() {\n        onErrorClick && onErrorClick();\n    }\n    /**\n     * hideAll\n     */\n    function hideAll() {\n        loadEl.current.style.display = 'none';\n        errorEl.current.style.display = 'none';\n        emptyEl.current.style.display = 'none';\n    }\n    var _renderLoading = useCallback(function () {\n        if (renderLoading) {\n            return (React.createElement(\"div\", { className: classNames(\"\".concat(selectorPrefix, \"-load\"), loadClassName), style: loadStyle !== null && loadStyle !== void 0 ? loadStyle : {}, ref: loadEl }, renderLoading()));\n        }\n        return (React.createElement(\"div\", { className: classNames(\"\".concat(selectorPrefix, \"-load\"), 'standard', loadClassName), style: loadStyle !== null && loadStyle !== void 0 ? loadStyle : {}, ref: loadEl }, Intl.v('数据加载中')));\n    }, [renderLoading, loadClassName, loadStyle]);\n    var _renderEmpty = useCallback(function () {\n        if (renderEmpty) {\n            return (React.createElement(\"div\", { className: classNames(\"\".concat(selectorPrefix, \"-empty\"), emptyClassName), style: emptyStyle !== null && emptyStyle !== void 0 ? emptyStyle : {}, ref: emptyEl }, renderEmpty()));\n        }\n        return (React.createElement(\"div\", { className: classNames(\"\".concat(selectorPrefix, \"-empty\"), emptyClassName), style: emptyStyle !== null && emptyStyle !== void 0 ? emptyStyle : {}, ref: emptyEl },\n            \"~\",\n            Intl.v('没有更多')));\n    }, [renderEmpty, emptyClassName, emptyStyle]);\n    var _renderError = useCallback(function () {\n        if (renderError) {\n            return (React.createElement(\"div\", { className: classNames(\"\".concat(selectorPrefix, \"-error\"), errorClassName), style: errorStyle !== null && errorStyle !== void 0 ? errorStyle : {}, ref: errorEl }, renderError()));\n        }\n        return (React.createElement(\"div\", { className: classNames(\"\".concat(selectorPrefix, \"-error\"), errorClassName), style: errorStyle !== null && errorStyle !== void 0 ? errorStyle : {}, ref: errorEl }, Intl.v('出现错误')));\n    }, [renderError, errorClassName, errorStyle]);\n    useImperativeHandle(ref, function () { return ({\n        hideAll: hideAll,\n    }); });\n    useLayoutEffect(function () {\n        initEvents();\n        return function () { return removeEvents(); };\n    });\n    return (React.createElement(\"div\", __assign({}, attrs, { className: classNames(selectorPrefix, className), style: __assign(__assign({}, (style !== null && style !== void 0 ? style : {})), { overflowY: _getScrollContainer() === el.current ? 'auto' : 'initial' }), ref: el }),\n        children,\n        _renderLoading(),\n        _renderEmpty(),\n        _renderError()));\n};\n// @ts-ignore\nvar ScrollLoadHOC = memo(forwardRef(ScrollLoad));\nScrollLoadHOC.EMPTY = 'empty';\nScrollLoadHOC.ERROR = 'error';\nScrollLoadHOC.NORMAL = 'normal';\nexport default ScrollLoadHOC;\n"],"names":["__assign","this","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","__rest","e","indexOf","getOwnPropertySymbols","propertyIsEnumerable","classNames","React","forwardRef","memo","useCallback","useImperativeHandle","useLayoutEffect","useRef","Intl","selectorPrefix","EMPTY","ERROR","NORMAL","ScrollLoad","props","ref","_a","className","_b","style","children","getScrollContainer","_c","distance","onScrollBottom","onEmptyClick","onErrorClick","renderLoading","_d","loadClassName","_e","loadStyle","renderEmpty","_f","emptyClassName","_g","emptyStyle","renderError","_h","errorClassName","_j","errorStyle","attrs","lock","el","loadEl","emptyEl","errorEl","_getScrollContainer","current","_onScroll","bottomHeight","scrollHeight","offsetHeight","scrollTop","Math","abs","display","status","_onEmptyClick","_onErrorClick","hideAll","_renderLoading","createElement","concat","v","_renderEmpty","_renderError","addEventListener","removeEventListener","overflowY","ScrollLoadHOC"],"mappings":"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"}