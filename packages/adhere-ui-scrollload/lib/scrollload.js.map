{"version":3,"file":"scrollload.js","sources":["scrollload.js"],"sourcesContent":["\"use strict\";\r\nvar __assign = (this && this.__assign) || function () {\r\n    __assign = Object.assign || function(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n                t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    var desc = Object.getOwnPropertyDescriptor(m, k);\r\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\r\n      desc = { enumerable: true, get: function() { return m[k]; } };\r\n    }\r\n    Object.defineProperty(o, k2, desc);\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}));\r\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n});\r\nvar __importStar = (this && this.__importStar) || function (mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n};\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar classnames_1 = __importDefault(require(\"classnames\"));\r\nvar react_1 = __importStar(require(\"react\"));\r\nvar adhere_util_intl_1 = __importDefault(require(\"@baifendian/adhere-util-intl\"));\r\nvar selectorPrefix = 'adhere-ui-scrollload';\r\nvar EMPTY = 'empty';\r\nvar ERROR = 'error';\r\nvar NORMAL = 'normal';\r\nvar ScrollLoad = function (props, ref) {\r\n    var _a = props.className, className = _a === void 0 ? '' : _a, _b = props.style, style = _b === void 0 ? {} : _b, children = props.children, getScrollContainer = props.getScrollContainer, _c = props.distance, distance = _c === void 0 ? 50 : _c, onScrollBottom = props.onScrollBottom, onEmptyClick = props.onEmptyClick, onErrorClick = props.onErrorClick, renderLoading = props.renderLoading, _d = props.loadClassName, loadClassName = _d === void 0 ? '' : _d, _e = props.loadStyle, loadStyle = _e === void 0 ? {} : _e, renderEmpty = props.renderEmpty, _f = props.emptyClassName, emptyClassName = _f === void 0 ? '' : _f, _g = props.emptyStyle, emptyStyle = _g === void 0 ? {} : _g, renderError = props.renderError, _h = props.errorClassName, errorClassName = _h === void 0 ? '' : _h, _j = props.errorStyle, errorStyle = _j === void 0 ? {} : _j;\r\n    var lock = (0, react_1.useRef)(false); // 锁\r\n    var el = (0, react_1.useRef)(null);\r\n    var loadEl = (0, react_1.useRef)(null);\r\n    var emptyEl = (0, react_1.useRef)(null);\r\n    var errorEl = (0, react_1.useRef)(null);\r\n    function _getScrollContainer() {\r\n        return getScrollContainer ? getScrollContainer() : el.current;\r\n    }\r\n    function initEvents() {\r\n        var _a, _b, _c;\r\n        (_a = _getScrollContainer()) === null || _a === void 0 ? void 0 : _a.addEventListener('scroll', _onScroll);\r\n        (_b = emptyEl.current) === null || _b === void 0 ? void 0 : _b.addEventListener('click', _onEmptyClick);\r\n        (_c = errorEl.current) === null || _c === void 0 ? void 0 : _c.addEventListener('click', _onErrorClick);\r\n    }\r\n    function removeEvents() {\r\n        var _a, _b, _c;\r\n        (_a = _getScrollContainer()) === null || _a === void 0 ? void 0 : _a.removeEventListener('scroll', _onScroll);\r\n        (_b = emptyEl.current) === null || _b === void 0 ? void 0 : _b.removeEventListener('click', _onEmptyClick);\r\n        (_c = errorEl.current) === null || _c === void 0 ? void 0 : _c.removeEventListener('click', _onErrorClick);\r\n    }\r\n    function _onScroll() {\r\n        var el = _getScrollContainer();\r\n        var bottomHeight = el.scrollHeight - el.offsetHeight;\r\n        var scrollTop = el.scrollTop;\r\n        /**\r\n         * 条件完全相等或误差值在1之间\r\n         */\r\n        if (onScrollBottom && Math.abs(scrollTop - bottomHeight) <= distance) {\r\n            if (lock.current)\r\n                return;\r\n            lock.current = true;\r\n            // 先显示loading\r\n            loadEl.current.style.display = 'flex';\r\n            /**\r\n             * 完成\r\n             * @param {string} status [empty(没有数据) | error(有错误) | normal(正常)]\r\n             */\r\n            onScrollBottom(function (status) {\r\n                loadEl.current.style.display = 'none';\r\n                if (status === EMPTY) {\r\n                    emptyEl.current.style.display = 'block';\r\n                }\r\n                else if (status === ERROR) {\r\n                    errorEl.current.style.display = 'block';\r\n                }\r\n                lock.current = false;\r\n            });\r\n        }\r\n    }\r\n    function _onEmptyClick() {\r\n        onEmptyClick && onEmptyClick();\r\n    }\r\n    function _onErrorClick() {\r\n        onErrorClick && onErrorClick();\r\n    }\r\n    /**\r\n     * hideAll\r\n     */\r\n    function hideAll() {\r\n        loadEl.current.style.display = 'none';\r\n        errorEl.current.style.display = 'none';\r\n        emptyEl.current.style.display = 'none';\r\n    }\r\n    var _renderLoading = (0, react_1.useCallback)(function () {\r\n        if (renderLoading) {\r\n            return (react_1.default.createElement(\"div\", { className: (0, classnames_1.default)(\"\".concat(selectorPrefix, \"-load\"), loadClassName || ''), style: loadStyle || {}, ref: loadEl }, renderLoading()));\r\n        }\r\n        return (react_1.default.createElement(\"div\", { className: (0, classnames_1.default)(\"\".concat(selectorPrefix, \"-load\"), 'standard', loadClassName || ''), style: loadStyle || {}, ref: loadEl }, adhere_util_intl_1.default.v('数据加载中')));\r\n    }, [renderLoading, loadClassName, loadStyle]);\r\n    var _renderEmpty = (0, react_1.useCallback)(function () {\r\n        if (renderEmpty) {\r\n            return (react_1.default.createElement(\"div\", { className: (0, classnames_1.default)(\"\".concat(selectorPrefix, \"-empty\"), emptyClassName || ''), style: emptyStyle || {}, ref: emptyEl }, renderEmpty()));\r\n        }\r\n        return (react_1.default.createElement(\"div\", { className: (0, classnames_1.default)(\"\".concat(selectorPrefix, \"-empty\"), emptyClassName || ''), style: emptyStyle || {}, ref: emptyEl },\r\n            \"~\",\r\n            adhere_util_intl_1.default.v('没有更多')));\r\n    }, [renderEmpty, emptyClassName, emptyStyle]);\r\n    var _renderError = (0, react_1.useCallback)(function () {\r\n        if (renderError) {\r\n            return (react_1.default.createElement(\"div\", { className: (0, classnames_1.default)(\"\".concat(selectorPrefix, \"-error\"), errorClassName || ''), style: errorStyle || {}, ref: errorEl }, renderError()));\r\n        }\r\n        return (react_1.default.createElement(\"div\", { className: (0, classnames_1.default)(\"\".concat(selectorPrefix, \"-error\"), errorClassName || ''), style: errorStyle || {}, ref: errorEl }, adhere_util_intl_1.default.v('出现错误')));\r\n    }, [renderError, errorClassName, errorStyle]);\r\n    (0, react_1.useImperativeHandle)(ref, function () { return ({\r\n        hideAll: hideAll,\r\n    }); });\r\n    (0, react_1.useLayoutEffect)(function () {\r\n        initEvents();\r\n        return function () { return removeEvents(); };\r\n    });\r\n    return (react_1.default.createElement(\"div\", { className: (0, classnames_1.default)(selectorPrefix, className || ''), style: __assign(__assign({}, (style || {})), { overflowY: _getScrollContainer() === el.current ? 'auto' : 'initial' }), ref: el },\r\n        children,\r\n        _renderLoading(),\r\n        _renderEmpty(),\r\n        _renderError()));\r\n};\r\n// @ts-ignore\r\nvar ScrollLoadHOC = (0, react_1.memo)((0, react_1.forwardRef)(ScrollLoad));\r\nScrollLoadHOC.EMPTY = 'empty';\r\nScrollLoadHOC.ERROR = 'error';\r\nScrollLoadHOC.NORMAL = 'normal';\r\nexports.default = ScrollLoadHOC;\r\n"],"names":["__assign","this","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","__createBinding","create","o","m","k","k2","undefined","desc","getOwnPropertyDescriptor","__esModule","writable","configurable","enumerable","get","defineProperty","__setModuleDefault","v","value","__importStar","mod","result","__importDefault","default","classnames_1","exports","require","react_1","adhere_util_intl_1","selectorPrefix","EMPTY","ERROR","NORMAL","ScrollLoad","props","ref","_a","className","_b","style","children","getScrollContainer","_c","distance","onScrollBottom","onEmptyClick","onErrorClick","renderLoading","_d","loadClassName","_e","loadStyle","renderEmpty","_f","emptyClassName","_g","emptyStyle","renderError","_h","errorClassName","_j","errorStyle","lock","useRef","el","loadEl","emptyEl","errorEl","_getScrollContainer","current","_onScroll","bottomHeight","scrollHeight","offsetHeight","scrollTop","Math","abs","display","status","_onEmptyClick","_onErrorClick","hideAll","_renderLoading","useCallback","createElement","concat","_renderEmpty","_renderError","useImperativeHandle","useLayoutEffect","addEventListener","removeEventListener","overflowY","ScrollLoadHOC","memo","forwardRef"],"mappings":"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"}