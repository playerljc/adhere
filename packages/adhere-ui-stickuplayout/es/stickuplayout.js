import React,{forwardRef,useImperativeHandle,useLayoutEffect,useRef}from"react";import classNames from"classnames";import StickupLayoutItem from"./item";var selectorPrefix="adhere-ui-stickuplayout",StickupLayout=function(e,r){var t=e.className,n=e.style,u=e.fixedClassName,c=e.fixedStyle,o=e.innerClassName,i=e.innerStyle,l=e.onChange,e=e.children,a=useRef(null),s=useRef(null),f=useRef(null),d=useRef(!1),m=useRef([]),v=useRef(),p=useRef(null),y=useRef();function h(){return"updateInterval"in screen?screen.updateInterval:16.7}function w(){for(var e,r=f.current.scrollTop,t=0,n=m.current.length-1;t<=n&&t<=m.current.length-1&&n<=m.current.length-1;){var u,c=m.current[u=n+t>>1];if(r>=c.start&&r<c.end){e=c;break}r<c.start?n=u-1:t=1+u}e&&(p.current&&p.current.index===e.index||(p.current=e,s.current.innerHTML=e.dom.outerHTML,l&&l(e.index)))}function x(){var e;d.current=!1,m.current=[],v.current=null===(e=a.current)||void 0===e?void 0:e.querySelectorAll("."+selectorPrefix+"-item-header"),function(){var e=0;m.current=[],p.current=null;for(var r=0,t=v.current.length;r<t;r++){var n=v.current[r],u=e,c=void 0,c=r!==t-1?v.current[r+1].offsetTop-n.offsetHeight:f.current.scrollHeight;if(m.current.push({start:u,end:c,dom:n,index:r}),(e=c)>f.current.scrollHeight-f.current.offsetHeight)break}}(),w(),null!==(e=f.current)&&void 0!==e&&e.removeEventListener("scroll",H),null!==(e=f.current)&&void 0!==e&&e.addEventListener("scroll",H)}function R(t,e){var n,u,c;void 0===t&&(t=0),void 0===e&&(e=300),d.current||("undefined"!=typeof window&&(y.current||(y.current=document.createElement("div"),y.current.className=selectorPrefix+"-mask",window.document.body.appendChild(y.current))),d.current=!0,y.current.style.display="block",n=f.current.scrollTop,u=n,c=f.current.scrollHeight/(e/h()+(e%h()!=0?1:0)),"undefined"!=typeof window&&window.requestAnimationFrame(function e(){function r(){d.current=!1,y.current.style.display="none"}n<t?t<u+c?u=t:u+=c:u-c<t?u=t:u-=c,f.current.scrollTop=u,n<t?t<=u?r():"undefined"!=typeof window&&window.requestAnimationFrame(e):u<=t?r():"undefined"!=typeof window&&window.requestAnimationFrame(e)}))}function k(e,r){e=e.start+v.current[e.index].offsetHeight;0===(r=void 0===r?300:r)?f.current.scrollTop=e:R(e,r)}function H(){w()}return useImperativeHandle(r,function(){return{refresh:x,scrollToByIndex:function(e,r){void 0===r&&(r=300);for(var t,n=0;n<m.current.length;n++)if(m.current[n].index===e){t=m.current[n];break}if(!t)return!1;k(t,r)},scrollToByHeaderEl:function(e,r){void 0===r&&(r=300);for(var t,n=0;n<m.current.length;n++)if(m.current[n].dom===e){t=m.current[n],0;break}if(!t)return!1;k(t,r)}}}),useLayoutEffect(function(){return x(),function(){var e;y.current&&null!==(e=null===(e=y.current)||void 0===e?void 0:e.parentElement)&&void 0!==e&&e.removeChild(y.current)}},[]),React.createElement("div",{className:classNames(selectorPrefix,t),style:n||{},ref:a},React.createElement("div",{className:classNames(selectorPrefix+"-fixed",u),style:c||{},ref:s}),React.createElement("div",{className:classNames(selectorPrefix+"-inner",o),style:i||{},ref:f},e))},StickupLayoutHOC=forwardRef(StickupLayout);StickupLayoutHOC.Item=StickupLayoutItem;export default StickupLayoutHOC;
//# sourceMappingURL=stickuplayout.js.map
