{"version":3,"file":"stickuplayout.js","sources":["stickuplayout.js"],"sourcesContent":["\"use strict\";\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __assign = (this && this.__assign) || function () {\r\n    __assign = Object.assign || function(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n                t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar react_1 = __importDefault(require(\"react\"));\r\nvar prop_types_1 = __importDefault(require(\"prop-types\"));\r\nvar classnames_1 = __importDefault(require(\"classnames\"));\r\nvar item_1 = __importDefault(require(\"./item\"));\r\nvar selectorPrefix = 'adhere-ui-stickuplayout';\r\n/**\r\n * StickupLayout\r\n * @class StickupLayout\r\n * @classdesc StickupLayout\r\n */\r\nvar StickupLayout = /** @class */ (function (_super) {\r\n    __extends(StickupLayout, _super);\r\n    function StickupLayout() {\r\n        var _this = _super !== null && _super.apply(this, arguments) || this;\r\n        _this.onScroll = function () {\r\n            _this.position();\r\n        };\r\n        return _this;\r\n    }\r\n    StickupLayout.prototype.componentDidMount = function () {\r\n        this.initial();\r\n    };\r\n    StickupLayout.prototype.componentWillReceiveProps = function (nextProps, nextContext) {\r\n        this.initial();\r\n    };\r\n    StickupLayout.prototype.componentWillUnmount = function () {\r\n        if (this.maskEl) {\r\n            // @ts-ignore\r\n            this.maskEl.parentElement.removeChild(this.maskEl);\r\n        }\r\n    };\r\n    StickupLayout.prototype.initial = function () {\r\n        this.key = false;\r\n        this.index = [];\r\n        // @ts-ignore\r\n        this.headerEls = this.el.querySelectorAll(\".\" + selectorPrefix + \"-item-header\");\r\n        this.createIndex();\r\n        this.position();\r\n        // @ts-ignore\r\n        this.innerEl.removeEventListener('scroll', this.onScroll);\r\n        // @ts-ignore\r\n        this.innerEl.addEventListener('scroll', this.onScroll);\r\n    };\r\n    StickupLayout.prototype.createIndex = function () {\r\n        var pre = 0;\r\n        this.index = [];\r\n        this.preScrollObj = null;\r\n        // @ts-ignore\r\n        for (var i = 0, len = this.headerEls.length; i < len; i++) {\r\n            // @ts-ignore\r\n            var header = this.headerEls[i];\r\n            var rangeStart = pre;\r\n            var rangeEnd = void 0;\r\n            if (i !== len - 1) {\r\n                // @ts-ignore\r\n                rangeEnd = this.headerEls[i + 1].offsetTop - header.offsetHeight;\r\n            }\r\n            else {\r\n                // @ts-ignore\r\n                rangeEnd = this.innerEl.scrollHeight;\r\n            }\r\n            this.index.push({\r\n                start: rangeStart,\r\n                end: rangeEnd,\r\n                // @ts-ignore\r\n                dom: header,\r\n                index: i,\r\n            });\r\n            pre = rangeEnd;\r\n            // @ts-ignore\r\n            if (pre > this.innerEl.scrollHeight - this.innerEl.offsetHeight) {\r\n                break;\r\n            }\r\n        }\r\n    };\r\n    StickupLayout.prototype.position = function () {\r\n        // @ts-ignore\r\n        var val = this.innerEl.scrollTop;\r\n        var low = 0, \r\n        // @ts-ignore\r\n        high = this.index.length - 1, middle, target;\r\n        // @ts-ignore\r\n        while (low <= high && low <= this.index.length - 1 && high <= this.index.length - 1) {\r\n            middle = (high + low) >> 1;\r\n            // @ts-ignore\r\n            var targetVal = this.index[middle];\r\n            if (val >= targetVal.start && val < targetVal.end) {\r\n                target = targetVal;\r\n                break;\r\n            }\r\n            else if (val < targetVal.start) {\r\n                high = middle - 1;\r\n            }\r\n            else {\r\n                low = middle + 1;\r\n            }\r\n        }\r\n        if (target) {\r\n            if (this.preScrollObj && this.preScrollObj.index === target.index) {\r\n                return false;\r\n            }\r\n            else {\r\n                this.preScrollObj = target;\r\n                // @ts-ignore\r\n                this.fixedEl.innerHTML = target.dom.outerHTML;\r\n                var onChange = this.props.onChange;\r\n                if (onChange) {\r\n                    onChange(target.index);\r\n                }\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * scrollAnimationTo\r\n     * @access private\r\n     * @param {number} targetTop\r\n     * @param {number} duration\r\n     */\r\n    StickupLayout.prototype.scrollAnimationTo = function (targetTop, duration) {\r\n        if (targetTop === void 0) { targetTop = 0; }\r\n        if (duration === void 0) { duration = 300; }\r\n        var self = this;\r\n        if (self.key)\r\n            return;\r\n        this.initMask();\r\n        self.key = true;\r\n        // @ts-ignore\r\n        this.maskEl.style.display = 'block';\r\n        // @ts-ignore\r\n        var srcTop = this.innerEl.scrollTop, scrollVal = srcTop, \r\n        /**\r\n         * 一次滚动的步进\r\n         * @type {number}\r\n         */\r\n        setp = \r\n        // @ts-ignore\r\n        this.innerEl.scrollHeight /\r\n            // @ts-ignore\r\n            (duration / (screen.updateInterval || 16.7) +\r\n                // @ts-ignore\r\n                (duration % (screen.updateInterval || 16.7) !== 0 ? 1 : 0));\r\n        /** *\r\n         * 动画的滚动\r\n         */\r\n        function scrollAnimation() {\r\n            if (srcTop < targetTop) {\r\n                if (scrollVal + setp > targetTop) {\r\n                    scrollVal = targetTop;\r\n                }\r\n                else {\r\n                    scrollVal += setp;\r\n                }\r\n            }\r\n            else if (scrollVal - setp < targetTop) {\r\n                scrollVal = targetTop;\r\n            }\r\n            else {\r\n                scrollVal -= setp;\r\n            }\r\n            // @ts-ignore\r\n            self.innerEl.scrollTop = scrollVal;\r\n            if (srcTop < targetTop) {\r\n                if (scrollVal >= targetTop) {\r\n                    clear();\r\n                }\r\n                else {\r\n                    window.requestAnimationFrame(scrollAnimation);\r\n                }\r\n            }\r\n            else if (scrollVal <= targetTop) {\r\n                clear();\r\n            }\r\n            else {\r\n                window.requestAnimationFrame(scrollAnimation);\r\n            }\r\n            function clear() {\r\n                self.key = false;\r\n                // @ts-ignore\r\n                self.maskEl.style.display = 'none';\r\n            }\r\n        }\r\n        /** *\r\n         * 滚动core\r\n         */\r\n        window.requestAnimationFrame(scrollAnimation);\r\n    };\r\n    /**\r\n     * scrollTo\r\n     * @access private\r\n     * @param {Object} item\r\n     * @param {number} duration\r\n     */\r\n    StickupLayout.prototype.scrollTo = function (item, duration) {\r\n        if (duration === void 0) { duration = 300; }\r\n        // @ts-ignore\r\n        var targetTop = item.start + this.headerEls[item.index].offsetHeight;\r\n        if (duration === 0) {\r\n            // @ts-ignore\r\n            this.innerEl.scrollTop = targetTop;\r\n        }\r\n        else {\r\n            this.scrollAnimationTo(targetTop, duration);\r\n        }\r\n    };\r\n    /**\r\n     * initMask\r\n     * @access private\r\n     */\r\n    StickupLayout.prototype.initMask = function () {\r\n        if (!this.maskEl) {\r\n            this.maskEl = document.createElement('div');\r\n            this.maskEl.className = selectorPrefix + \"-mask\";\r\n            window.document.body.appendChild(this.maskEl);\r\n        }\r\n    };\r\n    /**\r\n     * scrollToByIndex\r\n     * @param {number} index\r\n     * @param {number} duration\r\n     * @return {boolean}\r\n     */\r\n    StickupLayout.prototype.scrollToByIndex = function (index, duration) {\r\n        if (duration === void 0) { duration = 300; }\r\n        var i = 0, item;\r\n        // @ts-ignore\r\n        for (; i < this.index.length; i++) {\r\n            // @ts-ignore\r\n            if (this.index[i].index === index) {\r\n                // @ts-ignore\r\n                item = this.index[i];\r\n                break;\r\n            }\r\n        }\r\n        if (!item)\r\n            return false;\r\n        this.scrollTo(item, duration);\r\n    };\r\n    StickupLayout.prototype.render = function () {\r\n        var _this = this;\r\n        // @ts-ignore\r\n        var _a = this.props, className = _a.className, style = _a.style, fixedClassName = _a.fixedClassName, fixedStyle = _a.fixedStyle, innerClassName = _a.innerClassName, innerStyle = _a.innerStyle, children = _a.children;\r\n        // @ts-ignore\r\n        return (react_1.default.createElement(\"div\", { className: classnames_1.default(selectorPrefix, \r\n            // @ts-ignore\r\n            className.split(' ')), style: __assign({}, style), ref: function (el) { return (_this.el = el); } },\r\n            react_1.default.createElement(\"div\", { className: classnames_1.default(selectorPrefix + \"-fixed\", \r\n                // @ts-ignore\r\n                fixedClassName.split(' ')), style: __assign({}, fixedStyle), ref: function (el) { return (_this.fixedEl = el); } }),\r\n            react_1.default.createElement(\"div\", { className: classnames_1.default(selectorPrefix + \"-inner\", \r\n                // @ts-ignore\r\n                innerClassName.split(' ')), style: __assign({}, innerStyle), ref: function (el) { return (_this.innerEl = el); } }, children)));\r\n    };\r\n    StickupLayout.Item = item_1.default;\r\n    return StickupLayout;\r\n}(react_1.default.Component));\r\nStickupLayout.defaultProps = {\r\n    className: '',\r\n    style: {},\r\n    fixedClassName: '',\r\n    fixedStyle: {},\r\n    innerClassName: '',\r\n    innerStyle: {},\r\n    onChange: function () { },\r\n};\r\nStickupLayout.propTypes = {\r\n    className: prop_types_1.default.string,\r\n    style: prop_types_1.default.object,\r\n    fixedClassName: prop_types_1.default.string,\r\n    fixedStyle: prop_types_1.default.object,\r\n    innerClassName: prop_types_1.default.string,\r\n    innerStyle: prop_types_1.default.object,\r\n    onChange: prop_types_1.default.func,\r\n};\r\nexports.default = StickupLayout;\r\n"],"names":["__extends","this","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","__assign","assign","t","s","i","n","arguments","length","call","apply","__importDefault","mod","__esModule","default","defineProperty","exports","value","react_1","require","prop_types_1","classnames_1","item_1","selectorPrefix","StickupLayout","_super","_this","onScroll","position","componentDidMount","initial","componentWillReceiveProps","nextProps","nextContext","componentWillUnmount","maskEl","parentElement","removeChild","key","index","headerEls","el","querySelectorAll","createIndex","innerEl","removeEventListener","addEventListener","pre","preScrollObj","len","header","rangeEnd","offsetTop","offsetHeight","scrollHeight","push","start","end","dom","middle","target","val","scrollTop","low","high","targetVal","fixedEl","innerHTML","outerHTML","onChange","props","scrollAnimationTo","targetTop","duration","srcTop","scrollVal","setp","self","initMask","style","display","screen","updateInterval","window","requestAnimationFrame","scrollAnimation","clear","scrollTo","item","document","createElement","className","body","appendChild","scrollToByIndex","render","_a","fixedClassName","fixedStyle","innerClassName","innerStyle","children","split","ref","Item","Component","defaultProps","propTypes","string","object","func"],"mappings":"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"}