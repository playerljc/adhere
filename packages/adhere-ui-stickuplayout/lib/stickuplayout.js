"use strict";var __extends=this&&this.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)};return function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}}(),__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var s in t=arguments[i])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var react_1=__importDefault(require("react")),prop_types_1=__importDefault(require("prop-types")),classnames_1=__importDefault(require("classnames")),item_1=__importDefault(require("./item")),selectorPrefix="adhere-ui-stickuplayout",StickupLayout=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.onScroll=function(){e.position()},e}return __extends(e,t),e.prototype.componentDidMount=function(){this.initial()},e.prototype.componentWillReceiveProps=function(e,t){this.initial()},e.prototype.componentWillUnmount=function(){this.maskEl&&this.maskEl.parentElement.removeChild(this.maskEl)},e.prototype.initial=function(){this.key=!1,this.index=[],this.headerEls=this.el.querySelectorAll("."+selectorPrefix+"-item-header"),this.createIndex(),this.position(),this.innerEl.removeEventListener("scroll",this.onScroll),this.innerEl.addEventListener("scroll",this.onScroll)},e.prototype.createIndex=function(){var e=0;this.index=[],this.preScrollObj=null;for(var t=0,i=this.headerEls.length;t<i;t++){var n=this.headerEls[t],s=void 0,s=t!==i-1?this.headerEls[t+1].offsetTop-n.offsetHeight:this.innerEl.scrollHeight;if(this.index.push({start:e,end:s,dom:n,index:t}),(e=s)>this.innerEl.scrollHeight-this.innerEl.offsetHeight)break}},e.prototype.position=function(){for(var e,t,i=this.innerEl.scrollTop,n=0,s=this.index.length-1;n<=s&&n<=this.index.length-1&&s<=this.index.length-1;){e=s+n>>1;var r=this.index[e];if(i>=r.start&&i<r.end){t=r;break}i<r.start?s=e-1:n=1+e}if(t){if(this.preScrollObj&&this.preScrollObj.index===t.index)return!1;this.preScrollObj=t,this.fixedEl.innerHTML=t.dom.outerHTML;var o=this.props.onChange;o&&o(t.index)}},e.prototype.scrollAnimationTo=function(i,e){void 0===i&&(i=0),void 0===e&&(e=300);var n,s,r,o=this;o.key||(this.initMask(),o.key=!0,this.maskEl.style.display="block",n=this.innerEl.scrollTop,s=n,r=this.innerEl.scrollHeight/(e/(screen.updateInterval||16.7)+(e%(screen.updateInterval||16.7)!=0?1:0)),window.requestAnimationFrame(function e(){function t(){o.key=!1,o.maskEl.style.display="none"}n<i?i<s+r?s=i:s+=r:s-r<i?s=i:s-=r,o.innerEl.scrollTop=s,n<i?i<=s?t():window.requestAnimationFrame(e):s<=i?t():window.requestAnimationFrame(e)}))},e.prototype.scrollTo=function(e,t){void 0===t&&(t=300);e=e.start+this.headerEls[e.index].offsetHeight;0===t?this.innerEl.scrollTop=e:this.scrollAnimationTo(e,t)},e.prototype.initMask=function(){this.maskEl||(this.maskEl=document.createElement("div"),this.maskEl.className=selectorPrefix+"-mask",window.document.body.appendChild(this.maskEl))},e.prototype.scrollToByIndex=function(e,t){void 0===t&&(t=300);for(var i,n=0;n<this.index.length;n++)if(this.index[n].index===e){i=this.index[n];break}if(!i)return!1;this.scrollTo(i,t)},e.prototype.render=function(){var t=this,e=this.props,i=e.className,n=e.style,s=e.fixedClassName,r=e.fixedStyle,o=e.innerClassName,l=e.innerStyle,e=e.children;return react_1.default.createElement("div",{className:classnames_1.default(selectorPrefix,i.split(" ")),style:__assign({},n),ref:function(e){return t.el=e}},react_1.default.createElement("div",{className:classnames_1.default(selectorPrefix+"-fixed",s.split(" ")),style:__assign({},r),ref:function(e){return t.fixedEl=e}}),react_1.default.createElement("div",{className:classnames_1.default(selectorPrefix+"-inner",o.split(" ")),style:__assign({},l),ref:function(e){return t.innerEl=e}},e))},e.Item=item_1.default,e}(react_1.default.Component);StickupLayout.defaultProps={className:"",style:{},fixedClassName:"",fixedStyle:{},innerClassName:"",innerStyle:{},onChange:function(){}},StickupLayout.propTypes={className:prop_types_1.default.string,style:prop_types_1.default.object,fixedClassName:prop_types_1.default.string,fixedStyle:prop_types_1.default.object,innerClassName:prop_types_1.default.string,innerStyle:prop_types_1.default.object,onChange:prop_types_1.default.func},exports.default=StickupLayout;
//# sourceMappingURL=stickuplayout.js.map
