"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,r,t,n){void 0===n&&(n=t);var u=Object.getOwnPropertyDescriptor(r,t);u&&("get"in u?r.__esModule:!u.writable&&!u.configurable)||(u={enumerable:!0,get:function(){return r[t]}}),Object.defineProperty(e,n,u)}:function(e,r,t,n){e[n=void 0===n?t:n]=r[t]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,r){Object.defineProperty(e,"default",{enumerable:!0,value:r})}:function(e,r){e.default=r}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)"default"!==t&&Object.prototype.hasOwnProperty.call(e,t)&&__createBinding(r,e,t);return __setModuleDefault(r,e),r},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},classnames_1=(Object.defineProperty(exports,"__esModule",{value:!0}),__importDefault(require("classnames"))),lodash_debounce_1=__importDefault(require("lodash.debounce")),react_1=__importStar(require("react")),resize_observer_1=require("@juggle/resize-observer"),Item_1=__importDefault(require("./Item")),selectorPrefix="adhere-ui-stickup-layout",InternalStickupLayout=(0,react_1.memo)((0,react_1.forwardRef)(function(e,r){var t=e.className,n=e.style,u=e.fixedClassName,c=e.fixedStyle,l=e.innerClassName,a=e.innerStyle,i=e.onChange,e=e.children,o=(0,react_1.useRef)({}),s=(0,react_1.useRef)(null),f=(0,react_1.useRef)(null),d=(0,react_1.useRef)(null),_=(0,react_1.useRef)(!1),m=(0,react_1.useRef)([]),v=(0,react_1.useRef)(),p=(0,react_1.useRef)(null),h=(0,react_1.useRef)();function y(){return"updateInterval"in screen?screen.updateInterval:16.7}function b(){for(var e,r,t=d.current.scrollTop,n=0,u=m.current.length-1;n<=u&&n<=m.current.length-1&&u<=m.current.length-1;){var c,l=m.current[c=u+n>>1];if(t>=l.start&&t<l.end){r=l;break}t<l.start?u=c-1:n=1+c}!r||p.current&&(null==(e=p.current)?void 0:e.index)===r.index||(p.current=r,f.current.innerHTML=r.dom.outerHTML,i&&i(r.index))}function g(){_.current=!1,m.current=[],v.current=null==(r=s.current)?void 0:r.querySelectorAll(".".concat(selectorPrefix,"-item-header"));var e,r,t=0;m.current=[],p.current=null;for(var n=0,u=v.current.length;n<u;n++){var c=v.current[n],l=t,a=void 0,a=n!==u-1?v.current[n+1].offsetTop-c.offsetHeight:d.current.scrollHeight;if(m.current.push({start:l,end:a,dom:c,index:n}),(t=a)>d.current.scrollHeight-d.current.offsetHeight)break}b(),null!=(e=null==(r=d.current)?void 0:r.removeEventListener)&&e.call(r,"scroll",k),null!=(r=null==(e=d.current)?void 0:e.addEventListener)&&r.call(e,"scroll",k)}function w(t,e){var n,u,c;void 0===t&&(t=0),void 0===e&&(e=300),_.current||("undefined"==typeof window||h.current||(h.current=document.createElement("div"),h.current.className="".concat(selectorPrefix,"-mask"),window.document.body.appendChild(h.current)),_.current=!0,h.current.style.display="block",n=d.current.scrollTop,u=n,c=d.current.scrollHeight/(e/y()+(e%y()!=0?1:0)),"undefined"!=typeof window&&window.requestAnimationFrame(function e(){function r(){_.current=!1,h.current.style.display="none"}n<t?t<u+c?u=t:u+=c:u-c<t?u=t:u-=c,d.current.scrollTop=u,n<t?t<=u?r():"undefined"!=typeof window&&window.requestAnimationFrame(e):u<=t?r():"undefined"!=typeof window&&window.requestAnimationFrame(e)}))}function x(e,r){e=e.start+v.current[e.index].offsetHeight;0===(r=void 0===r?300:r)?d.current.scrollTop=e:w(e,r)}function k(){b()}return(0,react_1.useImperativeHandle)(r,function(){return{refresh:g,scrollToByIndex:function(e,r){void 0===r&&(r=300);for(var t,n=0;n<m.current.length;n++)if(m.current[n].index===e){t=m.current[n];break}x(t=t||m.current[m.current.length-1],r)},scrollToByHeaderEl:function(e,r){void 0===r&&(r=300);for(var t,n=0;n<m.current.length;n++)if(m.current[n].dom===e){t=m.current[n],0;break}x(t=t||m.current[m.current.length-1],r)}}}),(0,react_1.useLayoutEffect)(function(){return g(),function(){var e;h.current&&null!=(e=null==(e=h.current)?void 0:e.parentElement)&&e.removeChild(h.current)}},[]),(0,react_1.useLayoutEffect)(function(){var e=(0,lodash_debounce_1.default)(function(){g()},300);return o.current=new resize_observer_1.ResizeObserver(e),o.current.observe(s.current),function(){var e;null!=(e=null==o?void 0:o.current)&&e.disconnect(),h.current&&null!=(e=null==(e=h.current)?void 0:e.parentElement)&&e.removeChild(h.current)}},[]),react_1.default.createElement("div",{className:(0,classnames_1.default)(selectorPrefix,null!=t?t:""),style:null!=n?n:{},ref:s},react_1.default.createElement("div",{className:(0,classnames_1.default)("".concat(selectorPrefix,"-fixed"),null!=u?u:""),style:null!=c?c:{},ref:f}),react_1.default.createElement("div",{className:(0,classnames_1.default)("".concat(selectorPrefix,"-inner"),null!=l?l:""),style:null!=a?a:{},ref:d},e))})),StickupLayout=InternalStickupLayout;StickupLayout.displayName="StickupLayout",StickupLayout.Item=Item_1.default,exports.default=StickupLayout;
//# sourceMappingURL=StickUpLayout.js.map
