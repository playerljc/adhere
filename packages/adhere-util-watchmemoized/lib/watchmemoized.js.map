{"version":3,"file":"watchmemoized.js","sources":["watchmemoized.js"],"sourcesContent":["\"use strict\";\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar cloneDeep_1 = __importDefault(require(\"lodash/cloneDeep\"));\nvar adhere_util_1 = __importDefault(require(\"@baifendian/adhere-util\"));\nvar adhere_util_emitter_1 = __importDefault(require(\"@baifendian/adhere-util-emitter\"));\nvar Events = adhere_util_emitter_1.default.Events;\n/**\n * 原始对象\n */\nvar srcObj = {};\n// 特殊符号\nvar SPECIAL_SYMBOL = '__';\n// 记录对象路径的变量\nvar PATH_SYMBOLS = [\n    \"\".concat(SPECIAL_SYMBOL, \"parentName\").concat(SPECIAL_SYMBOL),\n    \"\".concat(SPECIAL_SYMBOL, \"parent\").concat(SPECIAL_SYMBOL),\n];\nvar PRIVATE_SYMBOL = '$';\n// 创建代理排除的属性前缀\nvar CREATE_PROXY_EXCLUDE_PREFIX = [PRIVATE_SYMBOL, SPECIAL_SYMBOL];\n// 创建代理排除的属性后缀\nvar CREATE_PROXY_EXCLUDE_SUFFIX = [SPECIAL_SYMBOL];\n/**\n * isProxyProperty - 是否是代理属性 一般对$开头的属性不进行任何处理\n * @param property - Object\n * @return {boolean}\n */\nfunction isProxyProperty(property) {\n    return !(CREATE_PROXY_EXCLUDE_PREFIX.some(function (t) { return property.startsWith(t); }) ||\n        CREATE_PROXY_EXCLUDE_SUFFIX.some(function (t) { return property.endsWith(t); }));\n}\n/**\n * createProxy - 创建代理\n * @param srcObj\n * @param noProxy\n * @param events\n * @return Proxy;\n */\nfunction createProxy(srcObj, noProxy, events) {\n    var proxy = new Proxy(srcObj, {\n        /**\n         * set 陷阱的函数\n         * 一般都是在生命周期hook或者事件处理函数中对data的值进行修改，会触发set\n         * @param target\n         * @param key\n         * @param value\n         * @param receiver\n         * @return {boolean}\n         */\n        set: function (target, key, value, receiver) {\n            // 如果不是代理属性则不处理\n            // 比如已$等开头的key不进行处理 或者是计算属性的key\n            if (!isProxyProperty(key)) {\n                return Reflect.set(target, key, value, receiver);\n            }\n            // 是数组\n            if (adhere_util_1.default.isArray(target)) {\n                // console.log(target, key);\n                // console.log('是数组');\n                // 数组的原始长度\n                var srcLength = target.length;\n                var result = Reflect.set(target, key, value, receiver);\n                // 数组在data中的访问表达式\n                var propertyAccessStr = adhere_util_1.default.getPropertyVisitPathStr(target, key);\n                // 对原始对象赋值\n                noProxy[propertyAccessStr] = (0, cloneDeep_1.default)(target);\n                // 数组的当前长度\n                var targetLength = target.length;\n                // watch监听\n                events.trigger(propertyAccessStr, key, value);\n                // 数组是删除\n                if (targetLength < srcLength) {\n                    // @ts-ignore\n                    // console.log('删除', `key:${key}`, `value:${value}`);\n                }\n                // 数组是添加\n                else if (targetLength > srcLength) {\n                    // @ts-ignore\n                    // console.log('添加', `key:${key}`, `value:${value}`);\n                    // 如果可以则会给value继续创建代理\n                    if ((adhere_util_1.default.isObject(value) || adhere_util_1.default.isArray(value)) && !(PATH_SYMBOLS[0] in value)) {\n                        value = createProxy(value, noProxy, events);\n                        // @ts-ignore\n                        value[PATH_SYMBOLS[0]] = \"[\".concat(key, \"]\");\n                        value[PATH_SYMBOLS[1]] = target;\n                        result = Reflect.set(target, key, value, receiver);\n                    }\n                }\n                // 数组修改\n                else {\n                    // @ts-ignore\n                    // console.log('修改', `key:${key}`, `value:${value}`);\n                    // 如果可以则会给value继续创建代理\n                    if ((adhere_util_1.default.isObject(value) || adhere_util_1.default.isArray(value)) && !(PATH_SYMBOLS[0] in value)) {\n                        value = createProxy(value, noProxy, events);\n                        // @ts-ignore\n                        value[PATH_SYMBOLS[0]] = \"[\".concat(key, \"]\");\n                        value[PATH_SYMBOLS[1]] = target;\n                        result = Reflect.set(target, key, value, receiver);\n                    }\n                }\n                // console.log('数组完成');\n                return result;\n            }\n            // 是对象\n            if (adhere_util_1.default.isObject(target)) {\n                // console.log(target, key);\n                // console.log('是对象');\n                // 一个表达式路径 比如a.b.c.d这样的一个路径，key是target的一个键，但是target也是其他对象键的值，\n                // 这个方法会返回追溯到整个的一个访问链\n                var propertyAccessStr = adhere_util_1.default.getPropertyVisitPathStr(target, key);\n                // console.log('propertyAccessStr', propertyAccessStr);\n                var cloneValue = void 0;\n                // watch监听\n                // 新的值\n                var newVal = (0, cloneDeep_1.default)(value);\n                // console.log('newVal', newVal);\n                events.trigger(propertyAccessStr, value, newVal);\n                // 回写原始数据\n                if (!cloneValue) {\n                    cloneValue = (0, cloneDeep_1.default)(value);\n                }\n                noProxy[propertyAccessStr] = cloneValue;\n                // console.log('noProxy[propertyAccessStr]', noProxy[propertyAccessStr]);\n                // 如果不是私有属性且是对象或数组继续loop，给value进行代理\n                if ((adhere_util_1.default.isObject(value) || adhere_util_1.default.isArray(value)) && !(PATH_SYMBOLS[0] in value)) {\n                    value = createProxy(value, noProxy, events);\n                    // 创建value的上下级关系(留着在watch中在原始对象中通过上下级关系找到变量)\n                    value[PATH_SYMBOLS[0]] = key;\n                    value[PATH_SYMBOLS[1]] = target /* [key] */;\n                }\n                // console.log('对象完成');\n                return Reflect.set(target, key, value, receiver);\n            }\n            // console.log('完成');\n            return Reflect.set(target, key, value, receiver);\n        },\n        /**\n         * deleteProperty - 对象删除属性\n         * @param target - 目标对象\n         * @param property - 删除的属性\n         * @return Object\n         */\n        deleteProperty: function (target, property) {\n            if (!isProxyProperty(property)) {\n                return Reflect.deleteProperty(target, property);\n            }\n            // 不处理数组的删除\n            if (adhere_util_1.default.isArray(target)) {\n                return Reflect.deleteProperty(target, property);\n            }\n            var propertyAccessStr = adhere_util_1.default.getPropertyVisitPathStr(target, property);\n            // watch监听\n            events.trigger(propertyAccessStr, property);\n            delete noProxy[propertyAccessStr];\n            return Reflect.deleteProperty(target, property);\n        },\n    });\n    /**\n     * 继续进行迭代，迭代srcObj的所有属性，为srcObj的所有属性都进行代理\n     */\n    for (var p in srcObj) {\n        // obj是Array, 迭代数组\n        // p是0,1,2,3...等索引\n        var objItem = srcObj[p];\n        if (isProxyProperty(p) && (adhere_util_1.default.isObject(objItem) || adhere_util_1.default.isArray(objItem))) {\n            srcObj[p] = createProxy(objItem, noProxy, events);\n            // 创建value的上下级关系\n            // 如果srcObj是数组则记录数组的索引\n            objItem[PATH_SYMBOLS[0]] = adhere_util_1.default.isArray(srcObj) ? \"[\".concat(p, \"]\") : p;\n            objItem[PATH_SYMBOLS[1]] = srcObj;\n        }\n    }\n    return proxy;\n}\n/**\n * WatchMemoized\n */\nvar WatchMemoized = {\n    /**\n     * createRef - 创建一个值(其实就是在srcObj中创建一个属性)\n     * @param defaultValue\n     */\n    createRef: function (defaultValue) {\n        var property = Symbol.for(adhere_util_1.default.uuid());\n        var value = defaultValue;\n        // 在srcObj中创建这个值的property\n        Object.defineProperty(srcObj, property, {\n            enumerable: true,\n            configurable: true,\n            set: function (curValue) {\n                var preVal = value;\n                // console.log('preValue', preVal);\n                value = curValue;\n                // console.log('curValue', curValue);\n                adhere_util_emitter_1.default.trigger(Symbol.keyFor(property), {\n                    oldValue: preVal,\n                    newValue: curValue,\n                });\n            },\n            get: function () {\n                // console.log('get', value);\n                return value;\n            },\n        });\n        return [\n            // 获取值\n            function () { return srcObj[property]; },\n            // 设置值\n            function (value) {\n                srcObj[property] = value;\n            },\n            // 值在srcObj中的property\n            property,\n        ];\n    },\n    // 缓存\n    memoized: {\n        // 监控\n        watch: {\n            /**\n             * watchAll - 对依赖项的监控(所有依赖项全部发生改变才执行handler)\n             * @param handler\n             * @param depends - 依赖项数组(这个数组中的值是createRef返回值中的第三个参数)\n             */\n            all: function (handler, depends) {\n                // 依赖项可能重复，去重的操作\n                depends = Array.from(new Set(__spreadArray([], depends, true)));\n                // 所有订阅的句柄\n                var subscriptionHandlers = [];\n                // 记录有个少个改变\n                var changelog = [];\n                // 改变的处理\n                function changeDetail(type) {\n                    var change = changelog.find(function (t) { return t.type === type; });\n                    if (change) {\n                        change.isChange = true;\n                    }\n                    if (changelog.every(function (e) { return e.isChange; })) {\n                        changelog.forEach(function (e) { return (e.isChange = false); });\n                        handler();\n                    }\n                }\n                // 迭代进行订阅操作\n                depends.forEach(function (depend) {\n                    var type;\n                    // 获取订阅的type，订阅的type就是depend符号的字符串值\n                    if (adhere_util_1.default.isSymbol(depend)) {\n                        type = Symbol.keyFor(depend);\n                    }\n                    else {\n                        type = Symbol.keyFor(depend.property);\n                    }\n                    // changelog赋初值\n                    changelog.push({\n                        type: type,\n                        isChange: false,\n                    });\n                    /**\n                     * onSubscription - 订阅\n                     * @param oldValue\n                     * @param newValue\n                     */\n                    function onSubscription(_a) {\n                        var oldValue = _a.oldValue, newValue = _a.newValue;\n                        // 如果depend直接是符号那么就是浅比较\n                        if (adhere_util_1.default.isSymbol(depend)) {\n                            if (oldValue !== newValue) {\n                                changeDetail(type);\n                            }\n                        }\n                        else {\n                            // 如果进行了细粒度的比较控制\n                            var config = depend;\n                            if (config.mode === 'light') {\n                                // 如果是浅比较\n                                if (oldValue !== newValue) {\n                                    changeDetail(type);\n                                }\n                            }\n                            else if (config.mode === 'deep') {\n                                // 如果是深比较\n                                if (adhere_util_1.default.isRef(oldValue) && adhere_util_1.default.isRef(newValue)) {\n                                    // 只有oldValue和newValue同时为引用类型的时候才进行深度比较(这里的引用类型是obj或者array，并没有function)\n                                    if (JSON.stringify(oldValue) !== JSON.stringify(newValue)) {\n                                        changeDetail(type);\n                                    }\n                                }\n                                else {\n                                    // 否则进行浅比较\n                                    if (oldValue !== newValue) {\n                                        changeDetail(type);\n                                    }\n                                }\n                            }\n                            else if (adhere_util_1.default.isFunction(config.mode)) {\n                                // 如果是自定义比较\n                                var result = config.mode(oldValue, newValue);\n                                if (!result) {\n                                    changeDetail(type);\n                                }\n                            }\n                        }\n                    }\n                    subscriptionHandlers.push({\n                        type: type,\n                        handler: onSubscription,\n                    });\n                    // 进行订阅，依赖项就是订阅项\n                    adhere_util_emitter_1.default.on(type, onSubscription);\n                });\n                // 返回清空所有订阅句柄的方法\n                return function () {\n                    subscriptionHandlers.forEach(function (_a) {\n                        var type = _a.type, handler = _a.handler;\n                        adhere_util_emitter_1.default.remove(type, handler);\n                    });\n                };\n            },\n            /**\n             * watchRace - 对依赖项的监控(只要有一个依赖项发生改变的时候就执行handler)\n             * @param handler\n             * @param depends - 依赖项数组(这个数组中的值是createRef返回值中的第三个参数)\n             */\n            race: function (handler, depends) {\n                // 依赖项可能重复，去重的操作\n                depends = Array.from(new Set(__spreadArray([], depends, true)));\n                // 所有订阅的句柄\n                var subscriptionHandlers = [];\n                // 迭代进行订阅操作\n                depends.forEach(function (depend) {\n                    var type;\n                    // 获取订阅的type，订阅的type就是depend符号的字符串值\n                    if (adhere_util_1.default.isSymbol(depend)) {\n                        type = Symbol.keyFor(depend);\n                    }\n                    else {\n                        type = Symbol.keyFor(depend.property);\n                    }\n                    /**\n                     * onSubscription - 订阅\n                     * @param oldValue\n                     * @param newValue\n                     */\n                    function onSubscription(_a) {\n                        var oldValue = _a.oldValue, newValue = _a.newValue;\n                        // 如果depend直接是符号那么就是浅比较\n                        if (adhere_util_1.default.isSymbol(depend)) {\n                            if (oldValue !== newValue) {\n                                handler();\n                            }\n                        }\n                        else {\n                            // 如果进行了细粒度的比较控制\n                            var config = depend;\n                            if (config.mode === 'light') {\n                                // 如果是浅比较\n                                if (oldValue !== newValue) {\n                                    handler();\n                                }\n                            }\n                            else if (config.mode === 'deep') {\n                                // 如果是深比较\n                                if (adhere_util_1.default.isRef(oldValue) && adhere_util_1.default.isRef(newValue)) {\n                                    // 只有oldValue和newValue同时为引用类型的时候才进行深度比较(这里的引用类型是obj或者array，并没有function)\n                                    if (JSON.stringify(oldValue) !== JSON.stringify(newValue)) {\n                                        handler();\n                                    }\n                                }\n                                else {\n                                    // 否则进行浅比较\n                                    if (oldValue !== newValue) {\n                                        handler();\n                                    }\n                                }\n                            }\n                            else if (adhere_util_1.default.isFunction(config.mode)) {\n                                // 如果是自定义比较\n                                var result = config.mode(oldValue, newValue);\n                                if (!result) {\n                                    handler();\n                                }\n                            }\n                        }\n                    }\n                    subscriptionHandlers.push({\n                        type: type,\n                        handler: onSubscription,\n                    });\n                    // 进行订阅，依赖项就是订阅项\n                    adhere_util_emitter_1.default.on(type, onSubscription);\n                });\n                // 返回清空所有订阅句柄的方法\n                return function () {\n                    subscriptionHandlers.forEach(function (_a) {\n                        var type = _a.type, handler = _a.handler;\n                        adhere_util_emitter_1.default.remove(type, handler);\n                    });\n                };\n            },\n        },\n        /**\n         * createMemoFun - 创建一个memo的Function\n         * @param handler\n         * @param stackMaxSize 最大保存栈\n         * @return Function\n         */\n        createMemoFun: function (handler, stackMaxSize) {\n            if (stackMaxSize === void 0) { stackMaxSize = 10; }\n            // 缓存的值\n            var memoized = [];\n            // 校验连\n            var checkChain = [\n                /**\n                 * 判断长度\n                 * @param depends\n                 * @param params\n                 * @return boolean\n                 */\n                function (depends, params) {\n                    return depends.length === params.length;\n                },\n                /**\n                 * 深比较 depends和params一个一个的比较\n                 * @param depends\n                 * @param params\n                 * @return boolean\n                 */\n                function (depends, params) {\n                    var result = true;\n                    for (var i = 0; i < depends.length; i++) {\n                        var dependVal = depends[i];\n                        var paramVal = params[i];\n                        if (adhere_util_1.default.isRef(dependVal) && adhere_util_1.default.isRef(paramVal)) {\n                            result = JSON.stringify((0, cloneDeep_1.default)(dependVal)) === JSON.stringify((0, cloneDeep_1.default)(paramVal));\n                        }\n                        else {\n                            result = dependVal === paramVal;\n                        }\n                        if (!result)\n                            break;\n                    }\n                    return result;\n                },\n            ];\n            /**\n             * check - 校验\n             * @param depends\n             * @param params\n             * @return boolean\n             */\n            function check(depends, params) {\n                var result = true;\n                for (var i = 0; i < checkChain.length; i++) {\n                    var chain = checkChain[i];\n                    result = chain(depends, params);\n                    if (!result)\n                        break;\n                }\n                return result;\n            }\n            /**\n             * find - 对params进行校验\n             * @param params\n             * @return boolean\n             */\n            function find(params) {\n                if (params === void 0) { params = []; }\n                var result = null;\n                for (var i = 0; i < memoized.length; i++) {\n                    var _a = memoized[i], resultVal = _a.resultVal, depends = _a.depends;\n                    var flag = check(depends, params);\n                    if (flag) {\n                        result = resultVal;\n                        break;\n                    }\n                }\n                return result;\n            }\n            /**\n             * getMemoized - 校验是否有符合的memoized\n             * @param arv\n             * @return object\n             */\n            function getMemoized(arv) {\n                if (arv === void 0) { arv = []; }\n                var result = find(arv);\n                // console.log('find', result);\n                // 没找到返回值\n                if (!result) {\n                    // 调用函数\n                    // @ts-ignore\n                    result = handler.apply(this, arv);\n                    // console.log('callfinish', result);\n                    // 如果memoized大于stackMaxSize\n                    if (memoized.length >= stackMaxSize) {\n                        memoized.shift();\n                    }\n                    // @ts-ignore\n                    if (result instanceof Promise) {\n                        // console.log('函数返回值是Promise');\n                        var p = result.then(function (res) {\n                            // console.log('返回res', res);\n                            return res;\n                        });\n                        memoized.push({\n                            depends: arv,\n                            resultVal: p,\n                        });\n                        return p;\n                    }\n                    else {\n                        memoized.push({\n                            depends: arv,\n                            resultVal: result,\n                        });\n                    }\n                }\n                return result;\n            }\n            return function () {\n                var params = [];\n                for (var _i = 0; _i < arguments.length; _i++) {\n                    params[_i] = arguments[_i];\n                }\n                // @ts-ignore\n                return getMemoized.call(this, params || []);\n            };\n        },\n    },\n    // 监控\n    watch: {\n        /**\n         * create - 创建一个watch对象\n         * @param srcObj\n         * @param listeners\n         * @return Function\n         */\n        create: function (srcObj, listeners) {\n            var events = new Events();\n            // 注册事件\n            if (!adhere_util_1.default.isEmpty(listeners)) {\n                for (var type in listeners) {\n                    events.on(type, listeners[type]);\n                }\n            }\n            // 未被代理的对象\n            var noProxy = (0, cloneDeep_1.default)(srcObj);\n            // 创建代理对象\n            var proxy = createProxy(srcObj, noProxy, events);\n            return {\n                value: proxy,\n                on: function (expression, handler) {\n                    events.on(expression, handler);\n                },\n                remove: function (expression, handler) {\n                    events.remove(expression, handler);\n                },\n            };\n        },\n    },\n    // createMemoFun(fun, depends) {},\n};\nexports.default = WatchMemoized;\n"],"names":["__spreadArray","this","to","from","pack","arguments","length","ar","i","l","Array","prototype","slice","call","concat","__importDefault","mod","__esModule","default","cloneDeep_1","Object","defineProperty","exports","value","require","adhere_util_1","adhere_util_emitter_1","Events","srcObj","SPECIAL_SYMBOL","PATH_SYMBOLS","PRIVATE_SYMBOL","CREATE_PROXY_EXCLUDE_PREFIX","CREATE_PROXY_EXCLUDE_SUFFIX","isProxyProperty","property","some","t","startsWith","endsWith","createProxy","noProxy","events","p","proxy","Proxy","set","target","key","receiver","result","propertyAccessStr","cloneValue","newVal","isArray","srcLength","Reflect","getPropertyVisitPathStr","targetLength","trigger","isObject","deleteProperty","objItem","WatchMemoized","createRef","defaultValue","Symbol","for","uuid","enumerable","configurable","curValue","preVal","keyFor","oldValue","newValue","get","memoized","watch","all","handler","depends","Set","subscriptionHandlers","changelog","changeDetail","type","change","find","isChange","every","e","forEach","depend","onSubscription","_a","config","isSymbol","mode","isRef","JSON","stringify","isFunction","push","on","remove","race","createMemoFun","stackMaxSize","checkChain","params","dependVal","paramVal","resultVal","chain","_i","arv","apply","shift","Promise","then","res","create","listeners","isEmpty","expression"],"mappings":"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"}