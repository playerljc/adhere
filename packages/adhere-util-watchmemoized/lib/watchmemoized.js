var __spreadArray=this&&this.__spreadArray||function(e,r,t){if(t||2===arguments.length)for(var n,i=0,o=r.length;i<o;i++)!n&&i in r||((n=n||Array.prototype.slice.call(r,0,i))[i]=r[i]);return e.concat(n||Array.prototype.slice.call(r))};import cloneDeep from"lodash/cloneDeep";import Util from"@baifendian/adhere-util";import Emitter from"@baifendian/adhere-util-emitter";var Events=Emitter.Events,srcObj={},SPECIAL_SYMBOL="__",PATH_SYMBOLS=["".concat(SPECIAL_SYMBOL,"parentName").concat(SPECIAL_SYMBOL),"".concat(SPECIAL_SYMBOL,"parent").concat(SPECIAL_SYMBOL)],PRIVATE_SYMBOL="$",CREATE_PROXY_EXCLUDE_PREFIX=[PRIVATE_SYMBOL,SPECIAL_SYMBOL],CREATE_PROXY_EXCLUDE_SUFFIX=[SPECIAL_SYMBOL];function isProxyProperty(r){return!(CREATE_PROXY_EXCLUDE_PREFIX.some(function(e){return r.startsWith(e)})||CREATE_PROXY_EXCLUDE_SUFFIX.some(function(e){return r.endsWith(e)}))}function createProxy(e,c,u){var r,t=new Proxy(e,{set:function(e,r,t,n){if(isProxyProperty(r)){var i,o,a,l;if(Util.isArray(e))return l=e.length,i=Reflect.set(e,r,t,n),o=Util.getPropertyVisitPathStr(e,r),c[o]=cloneDeep(e),a=e.length,u.trigger(o,r,t),a<l||!Util.isObject(t)&&!Util.isArray(t)||PATH_SYMBOLS[0]in t||((t=createProxy(t,c,u))[PATH_SYMBOLS[0]]="[".concat(r,"]"),t[PATH_SYMBOLS[1]]=e,i=Reflect.set(e,r,t,n)),i;Util.isObject(e)&&(o=Util.getPropertyVisitPathStr(e,r),a=void 0,l=cloneDeep(t),u.trigger(o,t,l),a=a||cloneDeep(t),c[o]=a,!Util.isObject(t)&&!Util.isArray(t)||PATH_SYMBOLS[0]in t||((t=createProxy(t,c,u))[PATH_SYMBOLS[0]]=r,t[PATH_SYMBOLS[1]]=e))}return Reflect.set(e,r,t,n)},deleteProperty:function(e,r){var t;return isProxyProperty(r)&&!Util.isArray(e)&&(t=Util.getPropertyVisitPathStr(e,r),u.trigger(t,r),delete c[t]),Reflect.deleteProperty(e,r)}});for(r in e){var n=e[r];isProxyProperty(r)&&(Util.isObject(n)||Util.isArray(n))&&(e[r]=createProxy(n,c,u),n[PATH_SYMBOLS[0]]=Util.isArray(e)?"[".concat(r,"]"):r,n[PATH_SYMBOLS[1]]=e)}return t}var WatchMemoized={createRef:function(e){var t=Symbol.for(Util.uuid()),n=e;return Object.defineProperty(srcObj,t,{enumerable:!0,configurable:!0,set:function(e){var r=n;n=e,Emitter.trigger(Symbol.keyFor(t),{oldValue:r,newValue:e})},get:function(){return n}}),[function(){return srcObj[t]},function(e){srcObj[t]=e},t]},memoized:{watch:{all:function(t,e){e=Array.from(new Set(__spreadArray([],e,!0)));var r=[],o=[];function a(r){var e=o.find(function(e){return e.type===r});e&&(e.isChange=!0),o.every(function(e){return e.isChange})&&(o.forEach(function(e){return e.isChange=!1}),t())}return e.forEach(function(n){var i;function e(e){var r,t=e.oldValue,e=e.newValue;Util.isSymbol(n)||"light"===(r=n).mode?t!==e&&a(i):"deep"===r.mode?Util.isRef(t)&&Util.isRef(e)?JSON.stringify(t)!==JSON.stringify(e)&&a(i):t!==e&&a(i):Util.isFunction(r.mode)&&!r.mode(t,e)&&a(i)}i=Util.isSymbol(n)?Symbol.keyFor(n):Symbol.keyFor(n.property),o.push({type:i,isChange:!1}),r.push({type:i,handler:e}),Emitter.on(i,e)}),function(){r.forEach(function(e){var r=e.type,e=e.handler;Emitter.remove(r,e)})}},race:function(i,e){e=Array.from(new Set(__spreadArray([],e,!0)));var t=[];return e.forEach(function(n){var e;function r(e){var r,t=e.oldValue,e=e.newValue;Util.isSymbol(n)||"light"===(r=n).mode?t!==e&&i():"deep"===r.mode?Util.isRef(t)&&Util.isRef(e)?JSON.stringify(t)!==JSON.stringify(e)&&i():t!==e&&i():Util.isFunction(r.mode)&&!r.mode(t,e)&&i()}e=Util.isSymbol(n)?Symbol.keyFor(n):Symbol.keyFor(n.property),t.push({type:e,handler:r}),Emitter.on(e,r)}),function(){t.forEach(function(e){var r=e.type,e=e.handler;Emitter.remove(r,e)})}}},createMemoFun:function(n,i){void 0===i&&(i=10);var o=[],a=[function(e,r){return e.length===r.length},function(e,r){for(var t=!0,n=0;n<e.length;n++){var i=e[n],o=r[n];if(!(t=Util.isRef(i)&&Util.isRef(o)?JSON.stringify(cloneDeep(i))===JSON.stringify(cloneDeep(o)):i===o))break}return t}];function l(e){void 0===e&&(e=[]);for(var r=null,t=0;t<o.length;t++){var n=o[t],i=n.resultVal;if(function(e,r){for(var t=!0,n=0;n<a.length&&(t=(0,a[n])(e,r));n++);return t}(n.depends,e)){r=i;break}}return r}return function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return function(e){if(!(t=l(e=void 0===e?[]:e))){var r,t=n.apply(this,e);if(o.length>=i&&o.shift(),t instanceof Promise)return r=t.then(function(e){return e}),o.push({depends:e,resultVal:r}),r;o.push({depends:e,resultVal:t})}return t}.call(this,e||[])}}},watch:{create:function(e,r){var t=new Events;if(!Util.isEmpty(r))for(var n in r)t.on(n,r[n]);return{value:createProxy(e,cloneDeep(e),t),on:function(e,r){t.on(e,r)},remove:function(e,r){t.remove(e,r)}}}}};export default WatchMemoized;
//# sourceMappingURL=watchmemoized.js.map
